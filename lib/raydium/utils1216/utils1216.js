var Mt=Object.create;var pe=Object.defineProperty,Ot=Object.defineProperties,Et=Object.getOwnPropertyDescriptor,Ft=Object.getOwnPropertyDescriptors,_t=Object.getOwnPropertyNames,Se=Object.getOwnPropertySymbols,Kt=Object.getPrototypeOf,_e=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var rt=(n,e,t)=>e in n?pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,v=(n,e)=>{for(var t in e||(e={}))_e.call(e,t)&&rt(n,t,e[t]);if(Se)for(var t of Se(e))ot.call(e,t)&&rt(n,t,e[t]);return n},Z=(n,e)=>Ot(n,Ft(e));var Be=(n,e)=>{var t={};for(var r in n)_e.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Se)for(var r of Se(n))e.indexOf(r)<0&&ot.call(n,r)&&(t[r]=n[r]);return t};var Vt=(n,e)=>{for(var t in e)pe(n,t,{get:e[t],enumerable:!0})},it=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of _t(e))!_e.call(n,i)&&i!==t&&pe(n,i,{get:()=>e[i],enumerable:!(r=Et(e,i))||r.enumerable});return n};var K=(n,e,t)=>(t=n!=null?Mt(Kt(n)):{},it(e||!n||!n.__esModule?pe(t,"default",{value:n,enumerable:!0}):t,n)),Wt=n=>it(pe({},"__esModule",{value:!0}),n);var rn={};Vt(rn,{default:()=>J});module.exports=Wt(rn);var Q=require("@solana/web3.js"),Dt=require("@solana/spl-token"),tt=K(require("bn.js"));var at=require("@solana/web3.js");var de=require("lodash");var Ke=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},st={},vt={};function U(n){let e=(0,de.get)(st,n);if(!e){let t=(0,de.get)(vt,n);e=new Ke({name:n,logLevel:t}),(0,de.set)(st,n,e)}return e}var Le=require("@solana/spl-token"),Ve=U("Raydium_accountInfo_util");async function Ce(n,e,t){let{batchRequest:r,commitment:i="confirmed",chunkCount:s=100}=v({batchRequest:!1},t),c=We(e,s),o=new Array(c.length).fill([]);if(r){let A=c.map(b=>{let P=n._buildArgs([b.map(w=>w.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:P}}),T=We(A,10);o=(await(await Promise.all(T.map(async b=>await n._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&Ve.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(P=>{if(P){let{data:w,executable:y,lamports:x,owner:l,rentEpoch:B}=P;return w.length!==2&&w[1]!=="base64"&&Ve.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(w[0],"base64"),executable:y,lamports:x,owner:new at.PublicKey(l),rentEpoch:B}}return null})))}else try{o=await Promise.all(c.map(A=>n.getMultipleAccountsInfo(A,i)))}catch(A){A instanceof Error&&Ve.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${A.message}`)}return o.flat()}var j=K(require("bn.js")),Zt=K(require("decimal.js"));var pt=K(require("big.js")),jt=K(require("bn.js"));var ut=K(require("toformat")),Ut=ut.default,fe=Ut;var ge=K(require("big.js")),lt=K(require("bn.js")),mt=K(require("decimal.js-light"));var ie=K(require("bn.js"));var ct=9007199254740991;function Y(n){let e=U("Raydium_parseBigNumberish");if(n instanceof ie.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new ie.default(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=ct||n<=-ct)&&e.logWithError(`BigNumberish number overflow: ${n}`),new ie.default(String(n))):typeof n=="bigint"?new ie.default(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new ie.default(0))}var ke=U("module/fraction"),Ue=fe(ge.default),ye=fe(mt.default),Gt={[0]:ye.ROUND_DOWN,[1]:ye.ROUND_HALF_UP,[2]:ye.ROUND_UP},Ht={[0]:ge.default.roundDown,[1]:ge.default.roundHalfUp,[2]:ge.default.roundUp},O=class{constructor(e,t=new lt.default(1)){this.numerator=Y(e),this.denominator=Y(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new O(this.denominator,this.numerator)}add(e){let t=e instanceof O?e:new O(Y(e));return this.denominator.eq(t.denominator)?new O(this.numerator.add(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof O?e:new O(Y(e));return this.denominator.eq(t.denominator)?new O(this.numerator.sub(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof O?e:new O(Y(e));return new O(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof O?e:new O(Y(e));return new O(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||ke.logWithError(`${e} is not an integer.`),e<=0&&ke.logWithError(`${e} is not positive.`),ye.set({precision:e+1,rounding:Gt[r]});let i=new ye(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||ke.logWithError(`${e} is not an integer.`),e<0&&ke.logWithError(`${e} is negative.`),Ue.DP=e,Ue.RM=Ht[r]||1,new Ue(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Rn=U("Raydium_amount"),Dn=fe(pt.default);var dt=require("@solana/web3.js"),qe=require("@solana/spl-token"),ft={chainId:101,address:dt.PublicKey.default.toBase58(),programId:qe.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},te={chainId:101,address:"So11111111111111111111111111111111111111112",programId:qe.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Ie=require("@solana/web3.js");var D=require("@solana/web3.js"),gt=require("@solana/spl-token");function Ge({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var En=[Ge({pubkey:gt.TOKEN_PROGRAM_ID,isWritable:!1}),Ge({pubkey:D.SystemProgram.programId,isWritable:!1}),Ge({pubkey:D.SYSVAR_RENT_PUBKEY,isWritable:!1})];function yt({publicKey:n,transformSol:e}){let t=ht(n.toString());if(t instanceof D.PublicKey)return e&&t.equals(he)?ve:t;if(e&&t.toString()===he.toBase58())return ve;if(typeof t=="string"){if(t===D.PublicKey.default.toBase58())return D.PublicKey.default;try{return new D.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ht(n){try{return new D.PublicKey(n)}catch{return n}}var Fn=new D.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),_n=new D.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Kn=new D.PublicKey("SysvarRent111111111111111111111111111111111"),Vn=new D.PublicKey("SysvarC1ock11111111111111111111111111111111"),Wn=new D.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),vn=new D.PublicKey("Sysvar1nstructions1111111111111111111111111"),Un=D.SystemProgram.programId,qn=new D.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Gn=new D.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Hn=new D.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),jn=new D.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),zn=new D.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Jn=new D.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Xn=new D.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Yn=new D.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Zn=new D.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Qn=new D.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),$n=new D.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ve=new D.PublicKey("So11111111111111111111111111111111111111112"),he=D.PublicKey.default;var He=class{constructor({mint:e,decimals:t,symbol:r,name:i,skipMint:s=!1,isToken2022:c=!1}){if(e===he.toBase58()||e instanceof Ie.PublicKey&&he.equals(e)){this.decimals=te.decimals,this.symbol=te.symbol,this.name=te.name,this.mint=new Ie.PublicKey(te.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=s?Ie.PublicKey.default:yt({publicKey:e}),this.isToken2022=c}equals(e){return this===e?!0:this.mint.equals(e.mint)}},G=He;G.WSOL=new He(Z(v({},te),{mint:te.address}));var je=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Re=je;Re.SOL=new je(ft);var bt=K(require("bn.js"));var cr=new O(new bt.default(100));var gr=U("Raydium_price");var Xt=require("@solana/web3.js"),Yt=K(require("bn.js"));var Jt=new j.default(0),jr=new j.default(1),zr=new j.default(2),Jr=new j.default(3),Xr=new j.default(5),zt=new j.default(10),Yr=new j.default(100),Zr=new j.default(1e3),Qr=new j.default(1e4);function We(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var en=require("@solana/web3.js"),tn=require("@solana/spl-token");var V=require("@solana/web3.js");var be={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var At=require("@solana/spl-token"),wt=U("Raydium_txUtil"),St=1644;function De(n){let e=[],t=[];return n.microLamports&&(e.push(V.ComputeBudgetProgram.setComputeUnitPrice({microLamports:n.microLamports})),t.push(be.SetComputeUnitPrice)),n.units&&(e.push(V.ComputeBudgetProgram.setComputeUnitLimit({units:n.units})),t.push(be.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function se(n,e){var r,i;let t=e!=null?e:"confirmed";return(i=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:i.blockhash}async function Ne(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let i=setTimeout(r,6e4);n.onSignature(e,s=>{if(clearTimeout(i),!s.err){t("");return}r(Object.assign(s.err,{txId:e}))},"confirmed")})}function ze(n,e){n.length<1&&wt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&wt.logWithError(`no signers provided:, ${e.toString()}`);let t=new V.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<St}catch{return!1}}function Me(n,e){let[t,r]=V.PublicKey.findProgramAddressSync(n,e);return{publicKey:t,nonce:r}}function Te({instructions:n,payer:e,signers:t}){return ze(n,[e,...t])}function xe({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=V.Keypair.generate().publicKey.toString()}){let s=new V.TransactionMessage({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new V.VersionedTransaction(s).serialize()).toString("base64").length<St}catch{return!1}}var Qt=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),$t=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof V.VersionedTransaction&&(e=Qt(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ne(n){let e=[];return n.forEach(t=>{t instanceof V.Transaction&&(t.recentBlockhash||(t.recentBlockhash=At.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=V.Keypair.generate().publicKey)),e.push($t(t))}),console.log("simulate tx string:",e),e}var p=require("@solana/web3.js"),go=new p.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),yo=new p.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ho=new p.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),bo=new p.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),To=new p.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),xo=new p.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Po=new p.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),wo=new p.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ao=new p.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),So=new p.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Bo=new p.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Lo=new p.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Co=new p.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ko=new p.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Io=new p.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ro=new p.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Do=new p.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),No=new p.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Mo=new p.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Oo=new p.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Eo=new p.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Fo=new p.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),_o=new p.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ko=new p.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Vo=new p.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Wo=new p.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),vo=new p.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Uo=new p.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),qo=new p.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Go=new p.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Ho=new p.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var jo={OPEN_BOOK_PROGRAM:new p.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new p.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new p.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new p.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new p.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new p.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new p.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new p.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new p.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new p.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new p.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new p.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:p.PublicKey.default,Router:new p.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new p.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new p.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new p.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new p.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new p.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new p.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new p.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new p.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new p.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new p.PublicKey("Ray1111111111111111111111111111111111111111")};var nn=K(require("bn.js"));var H=require("@solana/web3.js");async function Je({connection:n,address:e,cluster:t="mainnet"}){let r=await Ce(n,[...new Set(e.map(s=>s.toString()))].map(s=>new H.PublicKey(s))),i={};for(let s=0;s<e.length;s++){let c=r[s],o=e[s];if(!c)continue;let A=new H.AddressLookupTableAccount({key:o,state:H.AddressLookupTableAccount.deserialize(c.data)});i[o.toString()]=A,t==="devnet"?ae[o.toString()]=A:Oe[o.toString()]=A}return i}var Oe={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new H.AddressLookupTableAccount({key:new H.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:H.AddressLookupTableAccount.deserialize(Buffer.from("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","base64"))})},ae={},Xe=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ae[e])return ae;let t=new H.PublicKey(e),r=await n.getAccountInfo(t);return r&&(ae[e]=new H.AddressLookupTableAccount({key:t,state:H.AddressLookupTableAccount.deserialize(r.data)})),ae};var I=require("@solana/web3.js"),Bt=K(require("axios"));var Ee=2e3,Fe=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await Bt.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=De(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(I.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new I.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(be.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:s=[],lookupTableAddress:c=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...c.filter(o=>o!==I.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(v({},t||{})):this.build(t)}build(e){var r;let t=new I.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var u;let{recentBlockHash:s,skipPreflight:c=!0,sendAndConfirm:o,notSendToRpc:A}=i||{},T=s!=null?s:await se(this.connection,this.blockhashCommitment);if(t.recentBlockhash=T,this.signers.length&&t.sign(...this.signers),ne([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:o?await(0,I.sendAndConfirmTransaction)(this.connection,t,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:c}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:c}),signedTx:t};if(this.signAllTransactions){let b=await this.signAllTransactions([t]);if(this.signers.length)for(let P of b)try{P.sign(...this.signers)}catch{}return{txId:A?"":await this.connection.sendRawTransaction(b[0].serialize(),{skipPreflight:c}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var T;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:i}=this.build(r),s=t.filter(u=>u.transaction.instructions.length>0),c=[i,...s.map(u=>u.transaction)],o=[this.signers,...s.map(u=>u.signers)],A=[...this.instructionTypes,...s.map(u=>u.instructionTypes).flat()];return(T=this.owner)!=null&&T.signer&&o.forEach(u=>{u.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:c,signers:o,instructionTypes:A,execute:async u=>{var B;let{sequentially:b,onTxUpdate:P,skipTxCount:w=0,recentBlockHash:y,skipPreflight:x=!0}=u||{},l=y!=null?y:await se(this.connection,this.blockhashCommitment);if((B=this.owner)!=null&&B.isKeyPair){if(b){let h=[],C=0;for(let d of c){if(++C,C<=w)continue;let a=await(0,I.sendAndConfirmTransaction)(this.connection,d,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});h.push(a)}return{txIds:h,signedTxs:c}}return{txIds:await await Promise.all(c.map(async h=>(h.recentBlockhash=l,await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:x})))),signedTxs:c}}if(this.signAllTransactions){let h=c.map((d,a)=>(d.recentBlockhash=l,o[a].length&&d.sign(...o[a]),d));ne(h);let C=await this.signAllTransactions(h);if(b){let d=0,a=[],m=async()=>{if(!C[d])return;let S=await this.connection.sendRawTransaction(C[d].serialize(),{skipPreflight:x});a.push({txId:S,status:"sent",signedTx:C[d]}),P==null||P([...a]),d++;let f=!1,L=null,N=null,E=R=>{L!==null&&clearInterval(L),N!==null&&this.connection.removeSignatureListener(N);let M=a.findIndex(F=>F.txId===S);if(M>-1){if(a[M].status==="error"||a[M].status==="success")return;a[M].status=R.err?"error":"success"}P==null||P([...a]),R.err||m()};this.loopMultiTxStatus&&(L=setInterval(async()=>{var R;if(f){clearInterval(L);return}try{let M=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(f=!0,clearInterval(L),E({err:((R=M.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",S))}catch(M){f=!0,clearInterval(L),console.error("getTransaction timeout:",M,S)}},Ee)),N=this.connection.onSignature(S,R=>{if(f){this.connection.removeSignatureListener(N);return}f=!0,E(R)},"confirmed"),this.connection.getSignatureStatus(S)};return await m(),{txIds:a.map(S=>S.txId),signedTxs:C}}else{let d=[];for(let a=0;a<C.length;a+=1){let m=await this.connection.sendRawTransaction(C[a].serialize(),{skipPreflight:x});d.push(m)}return{txIds:d,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var x;let y=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:s}=y,c=Be(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=v(v({},this.cluster==="devnet"?await Xe(this.connection):Oe),t),A=Array.from(new Set([...r,...this.lookupTableAddress])),T=[];for(let l of A)o[l]===void 0&&T.push(new I.PublicKey(l));let u=await Je({connection:this.connection,address:T});for(let[l,B]of Object.entries(u))o[l]=B;let b=i?I.PublicKey.default.toBase58():s!=null?s:await se(this.connection,this.blockhashCommitment),P=new I.TransactionMessage({payerKey:this.feePayer,recentBlockhash:b,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((x=this.owner)==null?void 0:x.signer)&&!this.signers.some(l=>l.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let w=new I.VersionedTransaction(P);return w.sign(this.signers),{builder:this,transaction:w,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async l=>{var d;let{skipPreflight:B=!0,sendAndConfirm:h,notSendToRpc:C}=l||{};if(ne([w]),(d=this.owner)!=null&&d.isKeyPair){let a=await this.connection.sendTransaction(w,{skipPreflight:B});return h&&await Ne(this.connection,a),{txId:a,signedTx:w}}if(this.signAllTransactions){let a=await this.signAllTransactions([w]);if(this.signers.length)for(let m of a)try{m.sign(this.signers)}catch{}return{txId:C?"":await this.connection.sendTransaction(a[0],{skipPreflight:B}),signedTx:a[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:c||{}}}async buildV0MultiTx(e){var T;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:i}=await this.buildV0(r),s=t.filter(u=>u.builder.instructions.length>0),c=[i,...s.map(u=>u.transaction)],o=[this.signers,...s.map(u=>u.signers)],A=[...this.instructionTypes,...s.map(u=>u.instructionTypes).flat()];return(T=this.owner)!=null&&T.signer&&o.forEach(u=>{u.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),c.forEach(async(u,b)=>{u.sign(o[b])}),{builder:this,transactions:c,signers:o,instructionTypes:A,buildProps:r,execute:async u=>{var x;let{sequentially:b,onTxUpdate:P,recentBlockHash:w,skipPreflight:y=!0}=u||{};if(w&&c.forEach(l=>l.message.recentBlockhash=w),ne(c),(x=this.owner)!=null&&x.isKeyPair){if(b){let l=[];for(let B of c){let h=await this.connection.sendTransaction(B,{skipPreflight:y});await Ne(this.connection,h),l.push(h)}return{txIds:l,signedTxs:c}}return{txIds:await Promise.all(c.map(async l=>await this.connection.sendTransaction(l,{skipPreflight:y}))),signedTxs:c}}if(this.signAllTransactions){let l=await this.signAllTransactions(c);if(b){let B=0,h=[],C=async()=>{if(!l[B])return;let d=await this.connection.sendTransaction(l[B],{skipPreflight:y});h.push({txId:d,status:"sent",signedTx:l[B]}),P==null||P([...h]),B++;let a=!1,m=null,S=null,f=L=>{m!==null&&clearInterval(m),S!==null&&this.connection.removeSignatureListener(S);let N=h.findIndex(E=>E.txId===d);if(N>-1){if(h[N].status==="error"||h[N].status==="success")return;h[N].status=L.err?"error":"success"}P==null||P([...h]),L.err||C()};this.loopMultiTxStatus&&(m=setInterval(async()=>{var L;if(a){clearInterval(m);return}try{let N=await this.connection.getTransaction(d,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(a=!0,clearInterval(m),f({err:((L=N.meta)==null?void 0:L.err)||null}),console.log("tx status from getTransaction:",d))}catch(N){a=!0,clearInterval(m),console.error("getTransaction timeout:",N,d)}},Ee)),S=this.connection.onSignature(d,L=>{if(a){this.connection.removeSignatureListener(S);return}a=!0,f(L)},"confirmed"),this.connection.getSignatureStatus(d)};return C(),{txIds:[],signedTxs:l}}else{let B=[];for(let h=0;h<l.length;h+=1){let C=await this.connection.sendTransaction(l[h],{skipPreflight:y});B.push(C)}return{txIds:B,signedTxs:l}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var P;let b=e||{},{splitIns:t=[],computeBudgetConfig:r}=b,i=Be(b,["splitIns","computeBudgetConfig"]),s=r?De(r):{instructions:[],instructionTypes:[]},c=this.signers.reduce((w,y)=>Z(v({},w),{[y.publicKey.toBase58()]:y}),{}),o=[],A=[],T=[],u=0;if(this.allInstructions.forEach(w=>{let y=[...T,w],x=r?[...s.instructions,...y]:y,B=[...new Set(y.map(h=>h.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat()).values()].map(h=>new I.PublicKey(h));if(w!==t[u]&&T.length<12&&(Te({instructions:x,payer:this.feePayer,signers:B})||Te({instructions:y,payer:this.feePayer,signers:B})))T.push(w);else{if(T.length===0)throw Error("item ins too big");u+=w===t[u]?1:0,Te({instructions:r?[...s.instructions,...T]:[...T],payer:this.feePayer,signers:B})?o.push(new I.Transaction().add(...s.instructions,...T)):o.push(new I.Transaction().add(...T)),A.push(Array.from(new Set(T.map(h=>h.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(h=>c[h]).filter(h=>h!==void 0)),T=[w]}}),T.length>0){let y=[...new Set(T.map(x=>x.keys.filter(l=>l.isSigner).map(l=>l.pubkey.toString())).flat()).values()].map(x=>c[x]).filter(x=>x!==void 0);Te({instructions:r?[...s.instructions,...T]:[...T],payer:this.feePayer,signers:y.map(x=>x.publicKey)})?o.push(new I.Transaction().add(...s.instructions,...T)):o.push(new I.Transaction().add(...T)),A.push(y)}return o.forEach(w=>w.feePayer=this.feePayer),(P=this.owner)!=null&&P.signer&&A.forEach(w=>{w.some(y=>y.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:o,signers:A,instructionTypes:this.instructionTypes,execute:async w=>{var d;let{sequentially:y,onTxUpdate:x,skipTxCount:l=0,recentBlockHash:B,skipPreflight:h=!0}=w||{},C=B!=null?B:await se(this.connection,this.blockhashCommitment);if(o.forEach(async(a,m)=>{a.recentBlockhash=C,A[m].length&&a.sign(...A[m])}),ne(o),(d=this.owner)!=null&&d.isKeyPair){if(y){let a=0,m=[];for(let S of o){if(++a,a<=l){m.push("tx skipped");continue}let f=await(0,I.sendAndConfirmTransaction)(this.connection,S,this.signers.find(L=>L.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:h});m.push(f)}return{txIds:m,signedTxs:o}}return{txIds:await Promise.all(o.map(async a=>await this.connection.sendRawTransaction(a.serialize(),{skipPreflight:h}))),signedTxs:o}}if(this.signAllTransactions){let a=await this.signAllTransactions(o.slice(l,o.length)),m=[...o.slice(0,l),...a];if(y){let S=0,f=[],L=async()=>{if(!m[S])return;S<l&&(f.push({txId:"",status:"success",signedTx:m[S]}),x==null||x([...f]),S++,L());let N=await this.connection.sendRawTransaction(m[S].serialize(),{skipPreflight:h});f.push({txId:N,status:"sent",signedTx:m[S]}),x==null||x([...f]),S++;let E=!1,R=null,M=null,F=q=>{R!==null&&clearInterval(R),M!==null&&this.connection.removeSignatureListener(M);let _=f.findIndex($=>$.txId===N);if(_>-1){if(f[_].status==="error"||f[_].status==="success")return;f[_].status=q.err?"error":"success"}x==null||x([...f]),q.err||L()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var q;if(E){clearInterval(R);return}try{let _=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(E=!0,clearInterval(R),F({err:((q=_.meta)==null?void 0:q.err)||null}),console.log("tx status from getTransaction:",N))}catch(_){E=!0,clearInterval(R),console.error("getTransaction timeout:",_,N)}},Ee)),M=this.connection.onSignature(N,q=>{if(E){this.connection.removeSignatureListener(M);return}E=!0,F(q)},"confirmed"),this.connection.getSignatureStatus(N)};return await L(),{txIds:f.map(N=>N.txId),signedTxs:m}}else{let S=[];for(let f=0;f<m.length;f+=1){let L=await this.connection.sendRawTransaction(m[f].serialize(),{skipPreflight:h});S.push(L)}return{txIds:S,signedTxs:m}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var C;let h=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:i={},lookupTableAddress:s=[]}=h,c=Be(h,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=v(v({},this.cluster==="devnet"?await Xe(this.connection):Oe),i),A=Array.from(new Set([...this.lookupTableAddress,...s])),T=[];for(let d of A)o[d]===void 0&&T.push(new I.PublicKey(d));let u=await Je({connection:this.connection,address:T});for(let[d,a]of Object.entries(u))o[d]=a;let b=t?De(t):{instructions:[],instructionTypes:[]},P=await se(this.connection,this.blockhashCommitment),w=this.signers.reduce((d,a)=>Z(v({},d),{[a.publicKey.toBase58()]:a}),{}),y=[],x=[],l=[],B=0;if(this.allInstructions.forEach(d=>{let a=[...l,d],m=t?[...b.instructions,...a]:a;if(d!==r[B]&&l.length<12&&(xe({instructions:m,payer:this.feePayer,lookupTableAddressAccount:o})||xe({instructions:a,payer:this.feePayer,lookupTableAddressAccount:o})))l.push(d);else{if(l.length===0)throw Error("item ins too big");B+=d===r[B]?1:0;let S={};for(let f of[...new Set(A)])o[f]!==void 0&&(S[f]=o[f]);if(t&&xe({instructions:[...b.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:P})){let f=new I.TransactionMessage({payerKey:this.feePayer,recentBlockhash:P,instructions:[...b.instructions,...l]}).compileToV0Message(Object.values(o));y.push(new I.VersionedTransaction(f))}else{let f=new I.TransactionMessage({payerKey:this.feePayer,recentBlockhash:P,instructions:[...l]}).compileToV0Message(Object.values(o));y.push(new I.VersionedTransaction(f))}x.push(Array.from(new Set(l.map(f=>f.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(f=>w[f]).filter(f=>f!==void 0)),l=[d]}}),l.length>0){let a=[...new Set(l.map(m=>m.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(m=>w[m]).filter(m=>m!==void 0);if(t&&xe({instructions:[...b.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:P})){let m=new I.TransactionMessage({payerKey:this.feePayer,recentBlockhash:P,instructions:[...b.instructions,...l]}).compileToV0Message(Object.values(o));y.push(new I.VersionedTransaction(m))}else{let m=new I.TransactionMessage({payerKey:this.feePayer,recentBlockhash:P,instructions:[...l]}).compileToV0Message(Object.values(o));y.push(new I.VersionedTransaction(m))}x.push(a)}return(C=this.owner)!=null&&C.signer&&x.forEach(d=>{d.some(a=>a.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),y.forEach((d,a)=>{d.sign(x[a])}),{builder:this,transactions:y,buildProps:e,signers:x,instructionTypes:this.instructionTypes,execute:async d=>{var N;let{sequentially:a,onTxUpdate:m,skipTxCount:S=0,recentBlockHash:f,skipPreflight:L=!0}=d||{};if(y.map(async(E,R)=>{x[R].length&&E.sign(x[R]),f&&(E.message.recentBlockhash=f)}),ne(y),(N=this.owner)!=null&&N.isKeyPair){if(a){let E=0,R=[];for(let M of y){if(++E,E<=S){console.log("skip tx: ",E),R.push("tx skipped");continue}let F=await this.connection.sendTransaction(M,{skipPreflight:L});await Ne(this.connection,F),R.push(F)}return{txIds:R,signedTxs:y}}return{txIds:await Promise.all(y.map(async E=>await this.connection.sendTransaction(E,{skipPreflight:L}))),signedTxs:y}}if(this.signAllTransactions){let E=await this.signAllTransactions(y.slice(S,y.length)),R=[...y.slice(0,S),...E];if(a){let M=0,F=[],q=async()=>{if(!R[M])return;if(M<S){F.push({txId:"",status:"success",signedTx:R[M]}),m==null||m([...F]),M++,q();return}let _=await this.connection.sendTransaction(R[M],{skipPreflight:L});F.push({txId:_,status:"sent",signedTx:R[M]}),m==null||m([...F]),M++;let $=!1,oe=null,Ae=null,nt=ee=>{oe!==null&&clearInterval(oe),Ae!==null&&this.connection.removeSignatureListener(Ae);let X=F.findIndex(Nt=>Nt.txId===_);if(X>-1){if(F[X].status==="error"||F[X].status==="success")return;F[X].status=ee.err?"error":"success"}m==null||m([...F]),ee.err||q()};this.loopMultiTxStatus&&(oe=setInterval(async()=>{var ee;if($){clearInterval(oe);return}try{let X=await this.connection.getTransaction(_,{commitment:"confirmed",maxSupportedTransactionVersion:0});X&&($=!0,clearInterval(oe),nt({err:((ee=X.meta)==null?void 0:ee.err)||null}),console.log("tx status from getTransaction:",_))}catch(X){$=!0,clearInterval(oe),console.error("getTransaction timeout:",X,_)}},Ee)),Ae=this.connection.onSignature(_,ee=>{if($){this.connection.removeSignatureListener(Ae);return}$=!0,nt(ee)},"confirmed"),this.connection.getSignatureStatus(_)};return q(),{txIds:[],signedTxs:R}}else{let M=[];for(let F=0;F<R.length;F+=1){let q=await this.connection.sendTransaction(R[F],{skipPreflight:L});M.push(q)}return{txIds:M,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:c||{}}}};var Lt=K(require("bn.js")),ci=new Lt.default(1e6);var Rt=require("@solana/web3.js"),ce=K(require("bn.js"));var g=require("@solana/buffer-layout"),Ye=g.Layout,Ct=g.Structure;var kt=g.UInt;var It=g.seq;var ue=g.blob;var Ze=class extends Ye{constructor(t,r,i){super(t,i);this.blob=ue(t),this.signed=r}decode(t,r=0){let i=new ce.default(this.blob.decode(t,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,r,i=0){return typeof t=="number"&&(t=new ce.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,i)}};function le(n){return new kt(1,n)}function z(n){return new Ze(8,!1,n)}var Qe=class extends Ye{constructor(t,r,i,s){super(t.span,s);this.layout=t,this.decoder=r,this.encoder=i}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,i){return this.layout.encode(this.encoder(t),r,i)}getSpan(t,r){return this.layout.getSpan(t,r)}};function re(n){return new Qe(ue(32),e=>new Rt.PublicKey(e),e=>e.toBuffer(),n)}var $e=class extends Ct{decode(e,t){return super.decode(e,t)}};function me(n,e,t){return new $e(n,e,t)}function Pe(n,e,t){let r,i=typeof e=="number"?e:(0,ce.isBN)(e)?e.toNumber():new Proxy(e,{get(s,c){if(!r){let o=Reflect.get(s,"count");r=(0,ce.isBN)(o)?o.toNumber():o,Reflect.set(s,"count",r)}return Reflect.get(s,c)},set(s,c,o){return c==="count"&&(r=o),Reflect.set(s,c,o)}});return It(n,i,t)}var et=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),we=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=U(t)}createTxBuilder(e){return this.scope.checkOwner(),new Fe({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(et(e))}logInfo(...e){this.logger.info(et(e))}logAndCreateError(...e){let t=et(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var W=class extends we{static getPdaPoolId(e,t){return Me([W.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,r,i){return Me([W.SEED_CONFIG.owner.id,t.toBuffer(),r.toBuffer(),Buffer.from(new tt.default(i).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:r,wallet:i,chainTime:s}){if(r.length===0)return[];let c=r.map(u=>W.getPdaPoolId(t,u).publicKey),o=[];for(let u=0;u<W.VERSION_PROJECT.length;u++)o.push(...c.map(b=>W.getPdaOwnerId(t,b,i,u).publicKey));let A=await Ce(e,[...c,...o]),T=[];for(let u=0;u<A.length;u++){let b=Math.floor(u/r.length),P=u%r.length,w=c[P],y=o[u],x=A[P],l=A[r.length+u];if(!(x&&l)||x.data.length!==W.POOL_LAYOUT.span||l.data.length!==W.OWNER_LAYOUT.span)continue;let B=W.POOL_LAYOUT.decode(x.data),h=W.OWNER_LAYOUT.decode(l.data),C=B.openTime.toNumber(),d=B.endTime.toNumber(),a=h.tokenInfo.map(f=>f.debtAmount.gt(new tt.default(0))).filter(f=>!f).length!==3,m=s>C&&s<d&&B.status===1,S=a&&m;T.push({programId:t,poolId:w,ammId:B.ammId,ownerAccountId:y,snapshotLpAmount:h.lpAmount,project:W.VERSION_PROJECT[b],openTime:C,endTime:d,canClaim:S,canClaimErrorType:a?m?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:B.tokenInfo.map((f,L)=>({mintAddress:f.mintAddress,mintVault:f.mintVault,mintDecimals:f.mintDecimals,perLpLoss:f.perLpLoss,debtAmount:h.tokenInfo[L].debtAmount.add(h.tokenInfo[L].claimedAmount)}))})}return T}async makeClaimTransaction({poolInfo:e,ownerInfo:t,feePayer:r}){t.wallet||this.scope.checkOwner();let i=this.createTxBuilder(r),s=t.wallet||this.scope.ownerPubKey,c=[];for(let T of e.tokenInfo){let{account:u,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({mint:T.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:T.mintAddress.equals(G.WSOL.mint),createInfo:{payer:s,amount:0},skipCloseAccount:!T.mintAddress.equals(G.WSOL.mint),associatedOnly:T.mintAddress.equals(G.WSOL.mint)?!1:t.associatedOnly});b&&i.addInstruction(b),c.push(u)}i.addInstruction({instructions:[W.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:s,ownerPda:e.ownerAccountId,claimAddress:c}})]});let{transaction:o,signers:A}=i.build();return[{transaction:o,signer:A}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t,feePayer:r}){let i=this.createTxBuilder(r),s=t.wallet||this.scope.ownerPubKey,c={};for(let u of e){let b=[];for(let P of u.tokenInfo){let{account:w,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({mint:P.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:P.mintAddress.equals(G.WSOL.mint),createInfo:{payer:s,amount:0},skipCloseAccount:!P.mintAddress.equals(G.WSOL.mint),associatedOnly:P.mintAddress.equals(G.WSOL.mint)?!1:t.associatedOnly});y&&i.addInstruction(y),w&&(c[P.mintAddress.toString()]=w,b.push(w))}i.addInstruction({instructions:[W.makeClaimInstruction({programId:u.programId,poolInfo:u,ownerInfo:{wallet:s,ownerPda:u.ownerAccountId,claimAddress:b}})]})}let{transaction:o,signers:A}=i.build(),T=i.allInstructions;return ze(T,[s,...A.map(u=>u.publicKey)])?[{transaction:o,signer:A}]:[{transaction:new Q.Transaction().add(...T.slice(0,i.AllTxData.instructions.length-1)),signer:A},{transaction:new Q.Transaction().add(...T.slice(i.AllTxData.instructions.length-1)),signer:[]},{transaction:new Q.Transaction().add(...i.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:r}){let i=me([]),s=[{pubkey:r.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:r.ownerPda,isSigner:!1,isWritable:!0},...r.claimAddress.map(A=>({pubkey:A,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:A})=>({pubkey:A,isSigner:!1,isWritable:!0})),{pubkey:Dt.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],c=Buffer.alloc(i.span);i.encode({},c);let o=Buffer.from([10,66,208,184,161,6,191,98,...c]);return new Q.TransactionInstruction({keys:s,programId:e,data:o})}},J=W;J.CLAIMED_NUM=3,J.POOL_LAYOUT=me([ue(8),le("bump"),le("status"),z("openTime"),z("endTime"),re("ammId"),Pe(me([le("mintDecimals"),re("mintAddress"),re("mintVault"),z("perLpLoss"),z("totalClaimedAmount")]),W.CLAIMED_NUM,"tokenInfo"),Pe(z(),10,"padding")]),J.OWNER_LAYOUT=me([ue(8),le("bump"),le("version"),re("poolId"),re("owner"),z("lpAmount"),Pe(me([re("mintAddress"),z("debtAmount"),z("claimedAmount")]),W.CLAIMED_NUM,"tokenInfo"),Pe(z(),4,"padding")]),J.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new Q.PublicKey(e)),J.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},J.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];0&&(module.exports={});
//# sourceMappingURL=utils1216.js.map