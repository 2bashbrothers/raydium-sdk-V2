var Ot=Object.create;var ye=Object.defineProperty,Et=Object.defineProperties,Ft=Object.getOwnPropertyDescriptor,Kt=Object.getOwnPropertyDescriptors,Vt=Object.getOwnPropertyNames,De=Object.getOwnPropertySymbols,vt=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var st=(n,e,t)=>e in n?ye(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,v=(n,e)=>{for(var t in e||(e={}))Ue.call(e,t)&&st(n,t,e[t]);if(De)for(var t of De(e))at.call(e,t)&&st(n,t,e[t]);return n},te=(n,e)=>Et(n,Kt(e));var be=(n,e)=>{var t={};for(var r in n)Ue.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&De)for(var r of De(n))e.indexOf(r)<0&&at.call(n,r)&&(t[r]=n[r]);return t};var Wt=(n,e)=>{for(var t in e)ye(n,t,{get:e[t],enumerable:!0})},ut=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Vt(e))!Ue.call(n,a)&&a!==t&&ye(n,a,{get:()=>e[a],enumerable:!(r=Ft(e,a))||r.enumerable});return n};var W=(n,e,t)=>(t=n!=null?Ot(vt(n)):{},ut(e||!n||!n.__esModule?ye(t,"default",{value:n,enumerable:!0}):t,n)),Ut=n=>ut(ye({},"__esModule",{value:!0}),n);var sn={};Wt(sn,{default:()=>X});module.exports=Ut(sn);var se=require("@solana/web3.js"),_t=require("@solana/spl-token"),it=W(require("bn.js"));var lt=require("@solana/web3.js");var Te=require("lodash");var qe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ct={},qt={};function H(n){let e=(0,Te.get)(ct,n);if(!e){let t=(0,Te.get)(qt,n);e=new qe({name:n,logLevel:t}),(0,Te.set)(ct,n,e)}return e}var Me=require("@solana/spl-token"),Ge=H("Raydium_accountInfo_util");async function _e(n,e,t){let{batchRequest:r,commitment:a="confirmed",chunkCount:p=100}=v({batchRequest:!1},t),f=He(e,p),o=new Array(f.length).fill([]);if(r){let B=f.map(b=>{let T=n._buildArgs([b.map(A=>A.toBase58())],a,"base64");return{methodName:"getMultipleAccounts",args:T}}),w=He(B,10);o=(await(await Promise.all(w.map(async b=>await n._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&Ge.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(T=>{if(T){let{data:A,executable:m,lamports:h,owner:u,rentEpoch:k}=T;return A.length!==2&&A[1]!=="base64"&&Ge.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(A[0],"base64"),executable:m,lamports:h,owner:new lt.PublicKey(u),rentEpoch:k}}return null})))}else try{o=await Promise.all(f.map(B=>n.getMultipleAccountsInfo(B,a)))}catch(B){B instanceof Error&&Ge.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${B.message}`)}return o.flat()}var Z=W(require("bn.js")),Zt=W(require("decimal.js"));var gt=W(require("big.js")),Yt=W(require("bn.js"));var mt=W(require("toformat")),Gt=mt.default,xe=Gt;var Pe=W(require("big.js")),dt=W(require("bn.js")),ft=W(require("decimal.js-light"));var le=W(require("bn.js"));var pt=9007199254740991;function ne(n){let e=H("Raydium_parseBigNumberish");if(n instanceof le.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new le.default(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=pt||n<=-pt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new le.default(String(n))):typeof n=="bigint"?new le.default(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new le.default(0))}var Oe=H("module/fraction"),ze=xe(Pe.default),we=xe(ft.default),jt={[0]:we.ROUND_DOWN,[1]:we.ROUND_HALF_UP,[2]:we.ROUND_UP},zt={[0]:Pe.default.roundDown,[1]:Pe.default.roundHalfUp,[2]:Pe.default.roundUp},F=class{constructor(e,t=new dt.default(1)){this.numerator=ne(e),this.denominator=ne(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new F(this.denominator,this.numerator)}add(e){let t=e instanceof F?e:new F(ne(e));return this.denominator.eq(t.denominator)?new F(this.numerator.add(t.numerator),this.denominator):new F(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof F?e:new F(ne(e));return this.denominator.eq(t.denominator)?new F(this.numerator.sub(t.numerator),this.denominator):new F(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof F?e:new F(ne(e));return new F(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof F?e:new F(ne(e));return new F(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||Oe.logWithError(`${e} is not an integer.`),e<=0&&Oe.logWithError(`${e} is not positive.`),we.set({precision:e+1,rounding:jt[r]});let a=new we(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return a.toFormat(a.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||Oe.logWithError(`${e} is not an integer.`),e<0&&Oe.logWithError(`${e} is negative.`),ze.DP=e,ze.RM=zt[r]||1,new ze(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Dn=H("Raydium_amount"),Mn=xe(gt.default);var ht=require("@solana/web3.js"),Ye=require("@solana/spl-token"),yt={chainId:101,address:ht.PublicKey.default.toBase58(),programId:Ye.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ae={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ye.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Ee=require("@solana/web3.js");var O=require("@solana/web3.js"),bt=require("@solana/spl-token");function Je({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Fn=[Je({pubkey:bt.TOKEN_PROGRAM_ID,isWritable:!1}),Je({pubkey:O.SystemProgram.programId,isWritable:!1}),Je({pubkey:O.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Tt({publicKey:n,transformSol:e}){let t=xt(n.toString());if(t instanceof O.PublicKey)return e&&t.equals(Ae)?je:t;if(e&&t.toString()===Ae.toBase58())return je;if(typeof t=="string"){if(t===O.PublicKey.default.toBase58())return O.PublicKey.default;try{return new O.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function xt(n){try{return new O.PublicKey(n)}catch{return n}}var Kn=new O.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Vn=new O.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),vn=new O.PublicKey("SysvarRent111111111111111111111111111111111"),Wn=new O.PublicKey("SysvarC1ock11111111111111111111111111111111"),Un=new O.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),qn=new O.PublicKey("Sysvar1nstructions1111111111111111111111111"),Gn=O.SystemProgram.programId,Hn=new O.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),jn=new O.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),zn=new O.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Yn=new O.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Jn=new O.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Xn=new O.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Zn=new O.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Qn=new O.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),$n=new O.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),er=new O.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),tr=new O.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),je=new O.PublicKey("So11111111111111111111111111111111111111112"),Ae=O.PublicKey.default;var Xe=class{constructor({mint:e,decimals:t,symbol:r,name:a,skipMint:p=!1,isToken2022:f=!1}){if(e===Ae.toBase58()||e instanceof Ee.PublicKey&&Ae.equals(e)){this.decimals=ae.decimals,this.symbol=ae.symbol,this.name=ae.name,this.mint=new Ee.PublicKey(ae.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=a||e.toString().substring(0,6),this.mint=p?Ee.PublicKey.default:Tt({publicKey:e}),this.isToken2022=f}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Y=Xe;Y.WSOL=new Xe(te(v({},ae),{mint:ae.address}));var Ze=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Fe=Ze;Fe.SOL=new Ze(yt);var Pt=W(require("bn.js"));var mr=new F(new Pt.default(100));var yr=H("Raydium_price");var Xt=new Z.default(0),qr=new Z.default(1),Gr=new Z.default(2),Hr=new Z.default(3),jr=new Z.default(5),Jt=new Z.default(10),zr=new Z.default(100),Yr=new Z.default(1e3),Jr=new Z.default(1e4);function He(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var Q=class{constructor(e){this._owner=e}get publicKey(){return Q.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return Q.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return Q.isKeyPair(this._owner)}get isPublicKey(){return Q.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!Q.isKeyPair(e)}};var en=require("@solana/web3.js"),tn=require("@solana/spl-token");var U=require("@solana/web3.js");var Se={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Lt=require("@solana/spl-token"),Bt=H("Raydium_txUtil"),kt=1644;function Be(n){let e=[],t=[];return n.microLamports&&(e.push(U.ComputeBudgetProgram.setComputeUnitPrice({microLamports:n.microLamports})),t.push(Se.SetComputeUnitPrice)),n.units&&(e.push(U.ComputeBudgetProgram.setComputeUnitLimit({units:n.units})),t.push(Se.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ue(n,e){var r,a;let t=e!=null?e:"confirmed";return(a=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:a.blockhash}async function Le(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let a=setTimeout(r,6e4);n.onSignature(e,p=>{if(clearTimeout(a),!p.err){t("");return}r(Object.assign(p.err,{txId:e}))},"confirmed")})}function Qe(n,e){n.length<1&&Bt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Bt.logWithError(`no signers provided:, ${e.toString()}`);let t=new U.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<kt}catch{return!1}}function Ke(n,e){let[t,r]=U.PublicKey.findProgramAddressSync(n,e);return{publicKey:t,nonce:r}}function ke({instructions:n,payer:e,signers:t}){return Qe(n,[e,...t])}function re({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=U.Keypair.generate().publicKey.toString()}){let p=new U.TransactionMessage({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new U.VersionedTransaction(p).serialize()).toString("base64").length<kt}catch{return!1}}var Qt=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),$t=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof U.VersionedTransaction&&(e=Qt(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function oe(n){let e=[];return n.forEach(t=>{t instanceof U.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Lt.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=U.Keypair.generate().publicKey)),e.push($t(t))}),console.log("simulate tx string:",e),e}var g=require("@solana/web3.js"),mo=new g.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),po=new g.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),fo=new g.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),go=new g.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ho=new g.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),yo=new g.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),bo=new g.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),To=new g.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),xo=new g.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Po=new g.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),wo=new g.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ao=new g.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),So=new g.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Bo=new g.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Lo=new g.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ko=new g.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Io=new g.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Co=new g.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ro=new g.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),No=new g.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Do=new g.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Mo=new g.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),_o=new g.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Oo=new g.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Eo=new g.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Fo=new g.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ko=new g.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Vo=new g.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),vo=new g.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Wo=new g.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Uo=new g.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var qo={OPEN_BOOK_PROGRAM:new g.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new g.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new g.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new g.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new g.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new g.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new g.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new g.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new g.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new g.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new g.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new g.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:g.PublicKey.default,Router:new g.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new g.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new g.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new g.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new g.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new g.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new g.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new g.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new g.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new g.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new g.PublicKey("Ray1111111111111111111111111111111111111111")};var nn=W(require("bn.js"));var J=require("@solana/web3.js");async function Ve({connection:n,address:e,cluster:t="mainnet"}){let r=await _e(n,[...new Set(e.map(p=>p.toString()))].map(p=>new J.PublicKey(p))),a={};for(let p=0;p<e.length;p++){let f=r[p],o=e[p];if(!f)continue;let B=new J.AddressLookupTableAccount({key:o,state:J.AddressLookupTableAccount.deserialize(f.data)});a[o.toString()]=B,t==="devnet"?me[o.toString()]=B:ie[o.toString()]=B}return a}var ie={},$e=async n=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(ie[e])return ie;let t=new J.PublicKey(e),r=await n.getAccountInfo(t);return r&&(ie[e]=new J.AddressLookupTableAccount({key:t,state:J.AddressLookupTableAccount.deserialize(r.data)})),ie},me={},ve=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(me[e])return me;let t=new J.PublicKey(e),r=await n.getAccountInfo(t);return r&&(me[e]=new J.AddressLookupTableAccount({key:t,state:J.AddressLookupTableAccount.deserialize(r.data)})),me};var C=require("@solana/web3.js"),It=W(require("axios"));var Ie=2e3,Ce=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await It.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Be(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(C.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new C.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Se.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:a=[],endInstructionTypes:p=[],lookupTableAddress:f=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...a),this.endInstructionTypes.push(...p),this.lookupTableAddress.push(...f.filter(o=>o!==C.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(v({},t||{})):this.build(t)}build(e){var r;let t=new C.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var d;let{recentBlockHash:p,skipPreflight:f=!0,sendAndConfirm:o,notSendToRpc:B}=a||{},w=p!=null?p:await ue(this.connection,this.blockhashCommitment);if(t.recentBlockhash=w,this.signers.length&&t.sign(...this.signers),oe([t]),(d=this.owner)!=null&&d.isKeyPair)return{txId:o?await(0,C.sendAndConfirmTransaction)(this.connection,t,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:f}),signedTx:t};if(this.signAllTransactions){let b=await this.signAllTransactions([t]);if(this.signers.length)for(let T of b)try{T.sign(...this.signers)}catch{}return{txId:B?"":await this.connection.sendRawTransaction(b[0].serialize(),{skipPreflight:f}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var w;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:a}=this.build(r),p=t.filter(d=>d.transaction.instructions.length>0),f=[a,...p.map(d=>d.transaction)],o=[this.signers,...p.map(d=>d.signers)],B=[...this.instructionTypes,...p.map(d=>d.instructionTypes).flat()];return(w=this.owner)!=null&&w.signer&&o.forEach(d=>{d.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:f,signers:o,instructionTypes:B,execute:async d=>{var k;let{sequentially:b,onTxUpdate:T,skipTxCount:A=0,recentBlockHash:m,skipPreflight:h=!0}=d||{},u=m!=null?m:await ue(this.connection,this.blockhashCommitment);if((k=this.owner)!=null&&k.isKeyPair){if(b){let x=[],N=0;for(let c of f){if(++N,N<=A)continue;let i=await(0,C.sendAndConfirmTransaction)(this.connection,c,this.signers.find(s=>s.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:h});x.push(i)}return{txIds:x,signedTxs:f}}return{txIds:await await Promise.all(f.map(async x=>(x.recentBlockhash=u,await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:h})))),signedTxs:f}}if(this.signAllTransactions){let x=f.map((c,i)=>(c.recentBlockhash=u,o[i].length&&c.sign(...o[i]),c));oe(x);let N=await this.signAllTransactions(x);if(b){let c=0,i=[],s=async()=>{if(!N[c])return;let y=await this.connection.sendRawTransaction(N[c].serialize(),{skipPreflight:h});i.push({txId:y,status:"sent",signedTx:N[c]}),T==null||T([...i]),c++;let l=!1,L=null,_=null,D=S=>{L!==null&&clearInterval(L),_!==null&&this.connection.removeSignatureListener(_);let I=i.findIndex(R=>R.txId===y);if(I>-1){if(i[I].status==="error"||i[I].status==="success")return;i[I].status=S.err?"error":"success"}T==null||T([...i]),S.err||s()};this.loopMultiTxStatus&&(L=setInterval(async()=>{var S;if(l){clearInterval(L);return}try{let I=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});I&&(l=!0,clearInterval(L),D({err:((S=I.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",y))}catch(I){l=!0,clearInterval(L),console.error("getTransaction timeout:",I,y)}},Ie)),_=this.connection.onSignature(y,S=>{if(l){this.connection.removeSignatureListener(_);return}l=!0,D(S)},"confirmed"),this.connection.getSignatureStatus(y)};return await s(),{txIds:i.map(y=>y.txId),signedTxs:N}}else{let c=[];for(let i=0;i<N.length;i+=1){let s=await this.connection.sendRawTransaction(N[i].serialize(),{skipPreflight:h});c.push(s)}return{txIds:c,signedTxs:N}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var h;let m=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:a,recentBlockhash:p}=m,f=be(m,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=v(v({},this.cluster==="devnet"?await ve(this.connection):await $e(this.connection)),t),B=Array.from(new Set([...r,...this.lookupTableAddress])),w=[];for(let u of B)o[u]===void 0&&w.push(new C.PublicKey(u));let d=await Ve({connection:this.connection,address:w});for(let[u,k]of Object.entries(d))o[u]=k;let b=a?C.PublicKey.default.toBase58():p!=null?p:await ue(this.connection,this.blockhashCommitment),T=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:b,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((h=this.owner)==null?void 0:h.signer)&&!this.signers.some(u=>u.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let A=new C.VersionedTransaction(T);return A.sign(this.signers),{builder:this,transaction:A,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async u=>{var c;let{skipPreflight:k=!0,sendAndConfirm:x,notSendToRpc:N}=u||{};if(oe([A]),(c=this.owner)!=null&&c.isKeyPair){let i=await this.connection.sendTransaction(A,{skipPreflight:k});return x&&await Le(this.connection,i),{txId:i,signedTx:A}}if(this.signAllTransactions){let i=await this.signAllTransactions([A]);if(this.signers.length)for(let s of i)try{s.sign(this.signers)}catch{}return{txId:N?"":await this.connection.sendTransaction(i[0],{skipPreflight:k}),signedTx:i[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}async buildV0MultiTx(e){var w;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:a}=await this.buildV0(r),p=t.filter(d=>d.builder.instructions.length>0),f=[a,...p.map(d=>d.transaction)],o=[this.signers,...p.map(d=>d.signers)],B=[...this.instructionTypes,...p.map(d=>d.instructionTypes).flat()];return(w=this.owner)!=null&&w.signer&&o.forEach(d=>{d.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),f.forEach(async(d,b)=>{d.sign(o[b])}),{builder:this,transactions:f,signers:o,instructionTypes:B,buildProps:r,execute:async d=>{var h;let{sequentially:b,onTxUpdate:T,recentBlockHash:A,skipPreflight:m=!0}=d||{};if(A&&f.forEach(u=>u.message.recentBlockhash=A),oe(f),(h=this.owner)!=null&&h.isKeyPair){if(b){let u=[];for(let k of f){let x=await this.connection.sendTransaction(k,{skipPreflight:m});await Le(this.connection,x),u.push(x)}return{txIds:u,signedTxs:f}}return{txIds:await Promise.all(f.map(async u=>await this.connection.sendTransaction(u,{skipPreflight:m}))),signedTxs:f}}if(this.signAllTransactions){let u=await this.signAllTransactions(f);if(b){let k=0,x=[],N=async()=>{if(!u[k])return;let c=await this.connection.sendTransaction(u[k],{skipPreflight:m});x.push({txId:c,status:"sent",signedTx:u[k]}),T==null||T([...x]),k++;let i=!1,s=null,y=null,l=L=>{s!==null&&clearInterval(s),y!==null&&this.connection.removeSignatureListener(y);let _=x.findIndex(D=>D.txId===c);if(_>-1){if(x[_].status==="error"||x[_].status==="success")return;x[_].status=L.err?"error":"success"}T==null||T([...x]),L.err||N()};this.loopMultiTxStatus&&(s=setInterval(async()=>{var L;if(i){clearInterval(s);return}try{let _=await this.connection.getTransaction(c,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(i=!0,clearInterval(s),l({err:((L=_.meta)==null?void 0:L.err)||null}),console.log("tx status from getTransaction:",c))}catch(_){i=!0,clearInterval(s),console.error("getTransaction timeout:",_,c)}},Ie)),y=this.connection.onSignature(c,L=>{if(i){this.connection.removeSignatureListener(y);return}i=!0,l(L)},"confirmed"),this.connection.getSignatureStatus(c)};return N(),{txIds:[],signedTxs:u}}else{let k=[];for(let x=0;x<u.length;x+=1){let N=await this.connection.sendTransaction(u[x],{skipPreflight:m});k.push(N)}return{txIds:k,signedTxs:u}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var T;let b=e||{},{splitIns:t=[],computeBudgetConfig:r}=b,a=be(b,["splitIns","computeBudgetConfig"]),p=r?Be(r):{instructions:[],instructionTypes:[]},f=this.signers.reduce((A,m)=>te(v({},A),{[m.publicKey.toBase58()]:m}),{}),o=[],B=[],w=[],d=0;if(this.allInstructions.forEach(A=>{let m=[...w,A],h=r?[...p.instructions,...m]:m,k=[...new Set(m.map(x=>x.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat()).values()].map(x=>new C.PublicKey(x));if(A!==t[d]&&w.length<12&&(ke({instructions:h,payer:this.feePayer,signers:k})||ke({instructions:m,payer:this.feePayer,signers:k})))w.push(A);else{if(w.length===0)throw Error("item ins too big");d+=A===t[d]?1:0,ke({instructions:r?[...p.instructions,...w]:[...w],payer:this.feePayer,signers:k})?o.push(new C.Transaction().add(...p.instructions,...w)):o.push(new C.Transaction().add(...w)),B.push(Array.from(new Set(w.map(x=>x.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat())).map(x=>f[x]).filter(x=>x!==void 0)),w=[A]}}),w.length>0){let m=[...new Set(w.map(h=>h.keys.filter(u=>u.isSigner).map(u=>u.pubkey.toString())).flat()).values()].map(h=>f[h]).filter(h=>h!==void 0);ke({instructions:r?[...p.instructions,...w]:[...w],payer:this.feePayer,signers:m.map(h=>h.publicKey)})?o.push(new C.Transaction().add(...p.instructions,...w)):o.push(new C.Transaction().add(...w)),B.push(m)}return o.forEach(A=>A.feePayer=this.feePayer),(T=this.owner)!=null&&T.signer&&B.forEach(A=>{A.some(m=>m.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:o,signers:B,instructionTypes:this.instructionTypes,execute:async A=>{var c;let{sequentially:m,onTxUpdate:h,skipTxCount:u=0,recentBlockHash:k,skipPreflight:x=!0}=A||{},N=k!=null?k:await ue(this.connection,this.blockhashCommitment);if(o.forEach(async(i,s)=>{i.recentBlockhash=N,B[s].length&&i.sign(...B[s])}),oe(o),(c=this.owner)!=null&&c.isKeyPair){if(m){let i=0,s=[];for(let y of o){if(++i,i<=u){s.push("tx skipped");continue}let l=await(0,C.sendAndConfirmTransaction)(this.connection,y,this.signers.find(L=>L.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});s.push(l)}return{txIds:s,signedTxs:o}}return{txIds:await Promise.all(o.map(async i=>await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:x}))),signedTxs:o}}if(this.signAllTransactions){let i=await this.signAllTransactions(o.slice(u,o.length)),s=[...o.slice(0,u),...i];if(m){let y=0,l=[],L=async()=>{if(!s[y])return;y<u&&(l.push({txId:"",status:"success",signedTx:s[y]}),h==null||h([...l]),y++,L());let _=await this.connection.sendRawTransaction(s[y].serialize(),{skipPreflight:x});l.push({txId:_,status:"sent",signedTx:s[y]}),h==null||h([...l]),y++;let D=!1,S=null,I=null,R=K=>{S!==null&&clearInterval(S),I!==null&&this.connection.removeSignatureListener(I);let E=l.findIndex(j=>j.txId===_);if(E>-1){if(l[E].status==="error"||l[E].status==="success")return;l[E].status=K.err?"error":"success"}h==null||h([...l]),K.err||L()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var K;if(D){clearInterval(S);return}try{let E=await this.connection.getTransaction(_,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(D=!0,clearInterval(S),R({err:((K=E.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",_))}catch(E){D=!0,clearInterval(S),console.error("getTransaction timeout:",E,_)}},Ie)),I=this.connection.onSignature(_,K=>{if(D){this.connection.removeSignatureListener(I);return}D=!0,R(K)},"confirmed"),this.connection.getSignatureStatus(_)};return await L(),{txIds:l.map(_=>_.txId),signedTxs:s}}else{let y=[];for(let l=0;l<s.length;l+=1){let L=await this.connection.sendRawTransaction(s[l].serialize(),{skipPreflight:x});y.push(L)}return{txIds:y,signedTxs:s}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async sizeCheckBuildV0(e){var N;let x=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:a={},lookupTableAddress:p=[]}=x,f=be(x,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=v(v({},this.cluster==="devnet"?await ve(this.connection):ie),a),B=Array.from(new Set([...this.lookupTableAddress,...p])),w=[];for(let c of B)o[c]===void 0&&w.push(new C.PublicKey(c));let d=await Ve({connection:this.connection,address:w});for(let[c,i]of Object.entries(d))o[c]=i;let b=t?Be(t):{instructions:[],instructionTypes:[]},T=await ue(this.connection,this.blockhashCommitment),A=this.signers.reduce((c,i)=>te(v({},c),{[i.publicKey.toBase58()]:i}),{}),m=[],h=[],u=[],k=0;if(this.allInstructions.forEach(c=>{let i=[...u,c],s=t?[...b.instructions,...i]:i;if(c!==r[k]&&u.length<12&&(re({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||re({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))u.push(c);else{if(u.length===0)throw Error("item ins too big");k+=c===r[k]?1:0;let y={};for(let l of[...new Set(B)])o[l]!==void 0&&(y[l]=o[l]);if(t&&re({instructions:[...b.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:T})){let l=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b.instructions,...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(l))}else{let l=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(l))}h.push(Array.from(new Set(u.map(l=>l.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(l=>A[l]).filter(l=>l!==void 0)),u=[c]}}),u.length>0){let i=[...new Set(u.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>A[s]).filter(s=>s!==void 0);if(t&&re({instructions:[...b.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:T})){let s=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b.instructions,...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(s))}else{let s=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(s))}h.push(i)}return(N=this.owner)!=null&&N.signer&&h.forEach(c=>{c.some(i=>i.publicKey.equals(this.owner.publicKey))||c.push(this.owner.signer)}),m.forEach((c,i)=>{c.sign(h[i])}),{builder:this,transactions:m,buildProps:e,signers:h,blockHash:T,instructionTypes:this.instructionTypes,execute:async c=>{var _;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:l,skipPreflight:L=!0}=c||{};if(m.map(async(D,S)=>{h[S].length&&D.sign(h[S]),l&&(D.message.recentBlockhash=l)}),oe(m),(_=this.owner)!=null&&_.isKeyPair){if(i){let D=0,S=[];for(let I of m){if(++D,D<=y){console.log("skip tx: ",D),S.push("tx skipped");continue}let R=await this.connection.sendTransaction(I,{skipPreflight:L});await Le(this.connection,R),S.push(R)}return{txIds:S,signedTxs:m}}return{txIds:await Promise.all(m.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:L}))),signedTxs:m}}if(this.signAllTransactions){let D=await this.signAllTransactions(m.slice(y,m.length)),S=[...m.slice(0,y),...D];if(i){let I=0,R=[],K=async()=>{if(!S[I])return;if(I<y){R.push({txId:"",status:"success",signedTx:S[I]}),s==null||s([...R]),I++,K();return}let E=await this.connection.sendTransaction(S[I],{skipPreflight:L});R.push({txId:E,status:"sent",signedTx:S[I]}),s==null||s([...R]),I++;let j=!1,z=null,ee=null,he=G=>{z!==null&&clearInterval(z),ee!==null&&this.connection.removeSignatureListener(ee);let V=R.findIndex(We=>We.txId===E);if(V>-1){if(R[V].status==="error"||R[V].status==="success")return;R[V].status=G.err?"error":"success"}s==null||s([...R]),G.err||K()};this.loopMultiTxStatus&&(z=setInterval(async()=>{var G;if(j){clearInterval(z);return}try{let V=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(j=!0,clearInterval(z),he({err:((G=V.meta)==null?void 0:G.err)||null}),console.log("tx status from getTransaction:",E))}catch(V){j=!0,clearInterval(z),console.error("getTransaction timeout:",V,E)}},Ie)),ee=this.connection.onSignature(E,G=>{if(j){this.connection.removeSignatureListener(ee);return}j=!0,he(G)},"confirmed"),this.connection.getSignatureStatus(E)};return K(),{txIds:[],signedTxs:S}}else{let I=[];for(let R=0;R<S.length;R+=1){let K=await this.connection.sendTransaction(S[R],{skipPreflight:L});I.push(K)}return{txIds:I,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}async buildSniperTransaction(e){var N;let x=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:a={},lookupTableAddress:p=[]}=x,f=be(x,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=v(v({},this.cluster==="devnet"?await ve(this.connection):await $e(this.connection)),a),B=Array.from(new Set([...this.lookupTableAddress,...p])),w=[];for(let c of B)o[c]===void 0&&w.push(new C.PublicKey(c));let d=await Ve({connection:this.connection,address:w});for(let[c,i]of Object.entries(d))o[c]=i;let b=t?Be(t):{instructions:[],instructionTypes:[]},T=await ue(this.connection,this.blockhashCommitment),A=this.signers.reduce((c,i)=>te(v({},c),{[i.publicKey.toBase58()]:i}),{}),m=[],h=[],u=[],k=0;if(this.allInstructions.forEach(c=>{let i=[...u,c],s=t?[...b.instructions,...i]:i;if(c!==r[k]&&u.length<12&&(re({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||re({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))u.push(c);else{if(u.length===0)throw Error("item ins too big");k+=c===r[k]?1:0;let y={};for(let l of[...new Set(B)])o[l]!==void 0&&(y[l]=o[l]);if(t&&re({instructions:[...b.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:T})){let l=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b.instructions,...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(l))}else{let l=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(l))}h.push(Array.from(new Set(u.map(l=>l.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(l=>A[l]).filter(l=>l!==void 0)),u=[c]}}),u.length>0){let i=[...new Set(u.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>A[s]).filter(s=>s!==void 0);if(t&&re({instructions:[...b.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:T})){let s=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b.instructions,...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(s))}else{let s=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...u]}).compileToV0Message(Object.values(o));m.push(new C.VersionedTransaction(s))}h.push(i)}return(N=this.owner)!=null&&N.signer&&h.forEach(c=>{c.some(i=>i.publicKey.equals(this.owner.publicKey))||c.push(this.owner.signer)}),m.forEach((c,i)=>{c.sign(h[i])}),{builder:this,transactions:m,buildProps:e,signers:h,instructionTypes:this.instructionTypes,execute:async c=>{var _;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:l,skipPreflight:L=!0}=c||{};if(m.map(async(D,S)=>{h[S].length&&D.sign(h[S]),l&&(D.message.recentBlockhash=l)}),oe(m),(_=this.owner)!=null&&_.isKeyPair){if(i){let D=0,S=[];for(let I of m){if(++D,D<=y){console.log("skip tx: ",D),S.push("tx skipped");continue}let R=await this.connection.sendTransaction(I,{skipPreflight:L});await Le(this.connection,R),S.push(R)}return{txIds:S,signedTxs:m}}return{txIds:await Promise.all(m.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:L}))),signedTxs:m}}if(this.signAllTransactions){let D=await this.signAllTransactions(m.slice(y,m.length)),S=[...m.slice(0,y),...D];if(i){let I=0,R=[],K=async()=>{if(!S[I])return;if(I<y){R.push({txId:"",status:"success",signedTx:S[I]}),s==null||s([...R]),I++,K();return}let E=await this.connection.sendTransaction(S[I],{skipPreflight:L});R.push({txId:E,status:"sent",signedTx:S[I]}),s==null||s([...R]),I++;let j=!1,z=null,ee=null,he=G=>{z!==null&&clearInterval(z),ee!==null&&this.connection.removeSignatureListener(ee);let V=R.findIndex(We=>We.txId===E);if(V>-1){if(R[V].status==="error"||R[V].status==="success")return;R[V].status=G.err?"error":"success"}s==null||s([...R]),G.err||K()};this.loopMultiTxStatus&&(z=setInterval(async()=>{var G;if(j){clearInterval(z);return}try{let V=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(j=!0,clearInterval(z),he({err:((G=V.meta)==null?void 0:G.err)||null}),console.log("tx status from getTransaction:",E))}catch(V){j=!0,clearInterval(z),console.error("getTransaction timeout:",V,E)}},Ie)),ee=this.connection.onSignature(E,G=>{if(j){this.connection.removeSignatureListener(ee);return}j=!0,he(G)},"confirmed"),this.connection.getSignatureStatus(E)};return K(),{txIds:[],signedTxs:S}}else{let I=[];for(let R=0;R<S.length;R+=1){let K=await this.connection.sendTransaction(S[R],{skipPreflight:L});I.push(K)}return{txIds:I,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}};var rn=require("@solana/web3.js"),on=W(require("bn.js"));var Ct=W(require("bn.js")),li=new Ct.default(1e6);var Mt=require("@solana/web3.js"),de=W(require("bn.js"));var P=require("@solana/buffer-layout"),et=P.Layout,Rt=P.Structure;var Nt=P.UInt;var Dt=P.seq;var pe=P.blob;var tt=class extends et{constructor(t,r,a){super(t,a);this.blob=pe(t),this.signed=r}decode(t,r=0){let a=new de.default(this.blob.decode(t,r),10,"le");return this.signed?a.fromTwos(this.span*8).clone():a}encode(t,r,a=0){return typeof t=="number"&&(t=new de.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,a)}};function fe(n){return new Nt(1,n)}function $(n){return new tt(8,!1,n)}var nt=class extends et{constructor(t,r,a,p){super(t.span,p);this.layout=t,this.decoder=r,this.encoder=a}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,a){return this.layout.encode(this.encoder(t),r,a)}getSpan(t,r){return this.layout.getSpan(t,r)}};function ce(n){return new nt(pe(32),e=>new Mt.PublicKey(e),e=>e.toBuffer(),n)}var rt=class extends Rt{decode(e,t){return super.decode(e,t)}};function ge(n,e,t){return new rt(n,e,t)}function Re(n,e,t){let r,a=typeof e=="number"?e:(0,de.isBN)(e)?e.toNumber():new Proxy(e,{get(p,f){if(!r){let o=Reflect.get(p,"count");r=(0,de.isBN)(o)?o.toNumber():o,Reflect.set(p,"count",r)}return Reflect.get(p,f)},set(p,f,o){return f==="count"&&(r=o),Reflect.set(p,f,o)}});return Dt(n,a,t)}var ot=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ne=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=H(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ce({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let r=new Q(e);return new Ce({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:r,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(ot(e))}logInfo(...e){this.logger.info(ot(e))}logAndCreateError(...e){let t=ot(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var q=class extends Ne{static getPdaPoolId(e,t){return Ke([q.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,r,a){return Ke([q.SEED_CONFIG.owner.id,t.toBuffer(),r.toBuffer(),Buffer.from(new it.default(a).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:r,wallet:a,chainTime:p}){if(r.length===0)return[];let f=r.map(d=>q.getPdaPoolId(t,d).publicKey),o=[];for(let d=0;d<q.VERSION_PROJECT.length;d++)o.push(...f.map(b=>q.getPdaOwnerId(t,b,a,d).publicKey));let B=await _e(e,[...f,...o]),w=[];for(let d=0;d<B.length;d++){let b=Math.floor(d/r.length),T=d%r.length,A=f[T],m=o[d],h=B[T],u=B[r.length+d];if(!(h&&u)||h.data.length!==q.POOL_LAYOUT.span||u.data.length!==q.OWNER_LAYOUT.span)continue;let k=q.POOL_LAYOUT.decode(h.data),x=q.OWNER_LAYOUT.decode(u.data),N=k.openTime.toNumber(),c=k.endTime.toNumber(),i=x.tokenInfo.map(l=>l.debtAmount.gt(new it.default(0))).filter(l=>!l).length!==3,s=p>N&&p<c&&k.status===1,y=i&&s;w.push({programId:t,poolId:A,ammId:k.ammId,ownerAccountId:m,snapshotLpAmount:x.lpAmount,project:q.VERSION_PROJECT[b],openTime:N,endTime:c,canClaim:y,canClaimErrorType:i?s?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:k.tokenInfo.map((l,L)=>({mintAddress:l.mintAddress,mintVault:l.mintVault,mintDecimals:l.mintDecimals,perLpLoss:l.perLpLoss,debtAmount:x.tokenInfo[L].debtAmount.add(x.tokenInfo[L].claimedAmount)}))})}return w}async makeClaimTransaction({poolInfo:e,ownerInfo:t,feePayer:r}){t.wallet||this.scope.checkOwner();let a=this.createTxBuilder(r),p=t.wallet||this.scope.ownerPubKey,f=[];for(let w of e.tokenInfo){let{account:d,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({mint:w.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:w.mintAddress.equals(Y.WSOL.mint),createInfo:{payer:p,amount:0},skipCloseAccount:!w.mintAddress.equals(Y.WSOL.mint),associatedOnly:w.mintAddress.equals(Y.WSOL.mint)?!1:t.associatedOnly});b&&a.addInstruction(b),f.push(d)}a.addInstruction({instructions:[q.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:p,ownerPda:e.ownerAccountId,claimAddress:f}})]});let{transaction:o,signers:B}=a.build();return[{transaction:o,signer:B}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t,feePayer:r}){let a=this.createTxBuilder(r),p=t.wallet||this.scope.ownerPubKey,f={};for(let d of e){let b=[];for(let T of d.tokenInfo){let{account:A,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({mint:T.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:T.mintAddress.equals(Y.WSOL.mint),createInfo:{payer:p,amount:0},skipCloseAccount:!T.mintAddress.equals(Y.WSOL.mint),associatedOnly:T.mintAddress.equals(Y.WSOL.mint)?!1:t.associatedOnly});m&&a.addInstruction(m),A&&(f[T.mintAddress.toString()]=A,b.push(A))}a.addInstruction({instructions:[q.makeClaimInstruction({programId:d.programId,poolInfo:d,ownerInfo:{wallet:p,ownerPda:d.ownerAccountId,claimAddress:b}})]})}let{transaction:o,signers:B}=a.build(),w=a.allInstructions;return Qe(w,[p,...B.map(d=>d.publicKey)])?[{transaction:o,signer:B}]:[{transaction:new se.Transaction().add(...w.slice(0,a.AllTxData.instructions.length-1)),signer:B},{transaction:new se.Transaction().add(...w.slice(a.AllTxData.instructions.length-1)),signer:[]},{transaction:new se.Transaction().add(...a.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:r}){let a=ge([]),p=[{pubkey:r.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:r.ownerPda,isSigner:!1,isWritable:!0},...r.claimAddress.map(B=>({pubkey:B,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:B})=>({pubkey:B,isSigner:!1,isWritable:!0})),{pubkey:_t.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],f=Buffer.alloc(a.span);a.encode({},f);let o=Buffer.from([10,66,208,184,161,6,191,98,...f]);return new se.TransactionInstruction({keys:p,programId:e,data:o})}},X=q;X.CLAIMED_NUM=3,X.POOL_LAYOUT=ge([pe(8),fe("bump"),fe("status"),$("openTime"),$("endTime"),ce("ammId"),Re(ge([fe("mintDecimals"),ce("mintAddress"),ce("mintVault"),$("perLpLoss"),$("totalClaimedAmount")]),q.CLAIMED_NUM,"tokenInfo"),Re($(),10,"padding")]),X.OWNER_LAYOUT=ge([pe(8),fe("bump"),fe("version"),ce("poolId"),ce("owner"),$("lpAmount"),Re(ge([ce("mintAddress"),$("debtAmount"),$("claimedAmount")]),q.CLAIMED_NUM,"tokenInfo"),Re($(),4,"padding")]),X.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new se.PublicKey(e)),X.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},X.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];0&&(module.exports={});
//# sourceMappingURL=index.js.map