var Lt=Object.defineProperty,Ct=Object.defineProperties;var kt=Object.getOwnPropertyDescriptors;var xe=Object.getOwnPropertySymbols;var et=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var $e=(r,e,t)=>e in r?Lt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,K=(r,e)=>{for(var t in e||(e={}))et.call(e,t)&&$e(r,t,e[t]);if(xe)for(var t of xe(e))tt.call(e,t)&&$e(r,t,e[t]);return r},z=(r,e)=>Ct(r,kt(e));var Pe=(r,e)=>{var t={};for(var n in r)et.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&xe)for(var n of xe(r))e.indexOf(n)<0&&tt.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as an,Transaction as Ze,TransactionInstruction as un}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as cn}from"@solana/spl-token";import St from"bn.js";import{PublicKey as Dt}from"@solana/web3.js";import{get as nt,set as It}from"lodash";var Ne=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},rt={},Rt={};function V(r){let e=nt(rt,r);if(!e){let t=nt(Rt,r);e=new Ne({name:r,logLevel:t}),It(rt,r,e)}return e}import{MINT_SIZE as xn,TOKEN_PROGRAM_ID as Pn,getTransferFeeConfig as wn,unpackMint as An}from"@solana/spl-token";var Me=V("Raydium_accountInfo_util");async function we(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:s=100}=K({batchRequest:!1},t),c=Oe(e,s),o=new Array(c.length).fill([]);if(n){let w=c.map(h=>{let x=r._buildArgs([h.map(P=>P.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:x}}),b=Oe(w,10);o=(await(await Promise.all(b.map(async h=>await r._rpcBatchRequest(h)))).flat()).map(h=>(h.error&&Me.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${h.error.message}`),h.result.value.map(x=>{if(x){let{data:P,executable:g,lamports:T,owner:l,rentEpoch:S}=x;return P.length!==2&&P[1]!=="base64"&&Me.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:g,lamports:T,owner:new Dt(l),rentEpoch:S}}return null})))}else try{o=await Promise.all(c.map(w=>r.getMultipleAccountsInfo(w,i)))}catch(w){w instanceof Error&&Me.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${w.message}`)}return o.flat()}import j from"bn.js";import yo from"decimal.js";import Vt from"big.js";import vn from"bn.js";import Nt from"toformat";var Mt=Nt,ae=Mt;import Se from"big.js";import Et from"bn.js";import Ft from"decimal.js-light";import ue from"bn.js";var ot=9007199254740991;function H(r){let e=V("Raydium_parseBigNumberish");if(r instanceof ue)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new ue(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=ot||r<=-ot)&&e.logWithError(`BigNumberish number overflow: ${r}`),new ue(String(r))):typeof r=="bigint"?new ue(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new ue(0))}var Ae=V("module/fraction"),Fe=ae(Se),ce=ae(Ft),_t={[0]:ce.ROUND_DOWN,[1]:ce.ROUND_HALF_UP,[2]:ce.ROUND_UP},Kt={[0]:Se.roundDown,[1]:Se.roundHalfUp,[2]:Se.roundUp},N=class{constructor(e,t=new Et(1)){this.numerator=H(e),this.denominator=H(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(e){let t=e instanceof N?e:new N(H(e));return this.denominator.eq(t.denominator)?new N(this.numerator.add(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof N?e:new N(H(e));return this.denominator.eq(t.denominator)?new N(this.numerator.sub(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof N?e:new N(H(e));return new N(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof N?e:new N(H(e));return new N(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ae.logWithError(`${e} is not an integer.`),e<=0&&Ae.logWithError(`${e} is not positive.`),ce.set({precision:e+1,rounding:_t[n]});let i=new ce(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ae.logWithError(`${e} is not an integer.`),e<0&&Ae.logWithError(`${e} is negative.`),Fe.DP=e,Fe.RM=Kt[n]||1,new Fe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Yn=V("Raydium_amount"),Zn=ae(Vt);import{PublicKey as vt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as it}from"@solana/spl-token";var st={chainId:101,address:vt.default.toBase58(),programId:it.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Y={chainId:101,address:"So11111111111111111111111111111111111111112",programId:it.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ke}from"@solana/web3.js";import{PublicKey as M,SystemProgram as at,SYSVAR_RENT_PUBKEY as Ut}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as qt}from"@solana/spl-token";function _e({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var ir=[_e({pubkey:qt,isWritable:!1}),_e({pubkey:at.programId,isWritable:!1}),_e({pubkey:Ut,isWritable:!1})];function ut({publicKey:r,transformSol:e}){let t=ct(r.toString());if(t instanceof M)return e&&t.equals(le)?Ee:t;if(e&&t.toString()===le.toBase58())return Ee;if(typeof t=="string"){if(t===M.default.toBase58())return M.default;try{return new M(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ct(r){try{return new M(r)}catch{return r}}var sr=new M("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ar=new M("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ur=new M("SysvarRent111111111111111111111111111111111"),cr=new M("SysvarC1ock11111111111111111111111111111111"),lr=new M("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),mr=new M("Sysvar1nstructions1111111111111111111111111"),pr=at.programId,dr=new M("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),fr=new M("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),gr=new M("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),yr=new M("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),hr=new M("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),br=new M("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Tr=new M("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),xr=new M("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Pr=new M("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),wr=new M("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ar=new M("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ee=new M("So11111111111111111111111111111111111111112"),le=M.default;var Ve=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:s=!1,isToken2022:c=!1}){if(e===le.toBase58()||e instanceof Ke&&le.equals(e)){this.decimals=Y.decimals,this.symbol=Y.symbol,this.name=Y.name,this.mint=new Ke(Y.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=s?Ke.default:ut({publicKey:e}),this.isToken2022=c}equals(e){return this===e?!0:this.mint.equals(e.mint)}},v=Ve;v.WSOL=new Ve(z(K({},Y),{mint:Y.address}));var We=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Be=We;Be.SOL=new We(st);import Gt from"bn.js";var Er=new N(new Gt(100));var vr=V("Raydium_price");import{PublicKey as oo}from"@solana/web3.js";import so from"bn.js";var Ht=new j(0),Lo=new j(1),Co=new j(2),ko=new j(3),Io=new j(5),Wt=new j(10),Ro=new j(100),Do=new j(1e3),No=new j(1e4);function Oe(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Xo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zo}from"@solana/spl-token";import{ComputeBudgetProgram as dt,Keypair as gt,PublicKey as jt,Transaction as yt,TransactionMessage as zt,VersionedTransaction as ht}from"@solana/web3.js";var me={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Jt}from"@solana/spl-token";var ft=V("Raydium_txUtil"),bt=1644;function Le(r){let e=[],t=[];return r.microLamports&&(e.push(dt.setComputeUnitPrice({microLamports:r.microLamports})),t.push(me.SetComputeUnitPrice)),r.units&&(e.push(dt.setComputeUnitLimit({units:r.units})),t.push(me.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ee(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function Ce(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,s=>{if(clearTimeout(i),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function ve(r,e){r.length<1&&ft.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&ft.logWithError(`no signers provided:, ${e.toString()}`);let t=new yt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<bt}catch{return!1}}function ke(r,e){let[t,n]=jt.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function pe({instructions:r,payer:e,signers:t}){return ve(r,[e,...t])}function de({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=gt.generate().publicKey.toString()}){let s=new zt({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new ht(s).serialize()).toString("base64").length<bt}catch{return!1}}var Xt=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Yt=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof ht&&(e=Xt(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Z(r){let e=[];return r.forEach(t=>{t instanceof yt&&(t.recentBlockhash||(t.recentBlockhash=Jt.toBase58()),t.feePayer||(t.feePayer=gt.generate().publicKey)),e.push(Yt(t))}),console.log("simulate tx string:",e),e}import{PublicKey as p}from"@solana/web3.js";var ti=new p("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ni=new p("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ri=new p("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),oi=new p("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ii=new p("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),si=new p("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ai=new p("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ui=new p("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ci=new p("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),li=new p("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),mi=new p("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),pi=new p("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),di=new p("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),fi=new p("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),gi=new p("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),yi=new p("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),hi=new p("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),bi=new p("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ti=new p("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),xi=new p("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Pi=new p("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),wi=new p("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ai=new p("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Si=new p("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Bi=new p("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Li=new p("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ci=new p("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ki=new p("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ii=new p("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ri=new p("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Di=new p("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ni={OPEN_BOOK_PROGRAM:new p("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new p("Ray1111111111111111111111111111111111111111"),AMM_V4:new p("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new p("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new p("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new p("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new p("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new p("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new p("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new p("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new p("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new p("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:p.default,Router:new p("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new p("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new p("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new p("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new p("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new p("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new p("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new p("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new p("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new p("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new p("Ray1111111111111111111111111111111111111111")};import Ei from"bn.js";import{PublicKey as Ue,AddressLookupTableAccount as ne}from"@solana/web3.js";async function qe({connection:r,address:e,cluster:t="mainnet"}){let n=await we(r,[...new Set(e.map(s=>s.toString()))].map(s=>new Ue(s))),i={};for(let s=0;s<e.length;s++){let c=n[s],o=e[s];if(!c)continue;let w=new ne({key:o,state:ne.deserialize(c.data)});i[o.toString()]=w,t==="devnet"?te[o.toString()]=w:Ie[o.toString()]=w}return i}var Ie={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ne({key:new Ue("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ne.deserialize(Buffer.from("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","base64"))})},te={},Ge=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(te[e])return te;let t=new Ue(e),n=await r.getAccountInfo(t);return n&&(te[e]=new ne({key:t,state:ne.deserialize(n.data)})),te};import{PublicKey as re,sendAndConfirmTransaction as He,SystemProgram as Zt,Transaction as fe,TransactionMessage as ge,VersionedTransaction as ye}from"@solana/web3.js";import Qt from"axios";var Re=2e3,De=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Qt.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Le(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Zt.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new re(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(me.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:s=[],lookupTableAddress:c=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...c.filter(o=>o!==re.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(K({},t||{})):this.build(t)}build(e){var n;let t=new fe;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var u;let{recentBlockHash:s,skipPreflight:c=!0,sendAndConfirm:o,notSendToRpc:w}=i||{},b=s!=null?s:await ee(this.connection,this.blockhashCommitment);if(t.recentBlockhash=b,this.signers.length&&t.sign(...this.signers),Z([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:o?await He(this.connection,t,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:c}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:c}),signedTx:t};if(this.signAllTransactions){let h=await this.signAllTransactions([t]);if(this.signers.length)for(let x of h)try{x.sign(...this.signers)}catch{}return{txId:w?"":await this.connection.sendRawTransaction(h[0].serialize(),{skipPreflight:c}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var b;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),s=t.filter(u=>u.transaction.instructions.length>0),c=[i,...s.map(u=>u.transaction)],o=[this.signers,...s.map(u=>u.signers)],w=[...this.instructionTypes,...s.map(u=>u.instructionTypes).flat()];return(b=this.owner)!=null&&b.signer&&o.forEach(u=>{u.some(h=>h.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:c,signers:o,instructionTypes:w,execute:async u=>{var S;let{sequentially:h,onTxUpdate:x,skipTxCount:P=0,recentBlockHash:g,skipPreflight:T=!0}=u||{},l=g!=null?g:await ee(this.connection,this.blockhashCommitment);if((S=this.owner)!=null&&S.isKeyPair){if(h){let y=[],L=0;for(let d of c){if(++L,L<=P)continue;let a=await He(this.connection,d,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});y.push(a)}return{txIds:y,signedTxs:c}}return{txIds:await await Promise.all(c.map(async y=>(y.recentBlockhash=l,await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:T})))),signedTxs:c}}if(this.signAllTransactions){let y=c.map((d,a)=>(d.recentBlockhash=l,o[a].length&&d.sign(...o[a]),d));Z(y);let L=await this.signAllTransactions(y);if(h){let d=0,a=[],m=async()=>{if(!L[d])return;let A=await this.connection.sendRawTransaction(L[d].serialize(),{skipPreflight:T});a.push({txId:A,status:"sent",signedTx:L[d]}),x==null||x([...a]),d++;let f=!1,B=null,R=null,O=I=>{B!==null&&clearInterval(B),R!==null&&this.connection.removeSignatureListener(R);let D=a.findIndex(E=>E.txId===A);if(D>-1){if(a[D].status==="error"||a[D].status==="success")return;a[D].status=I.err?"error":"success"}x==null||x([...a]),I.err||m()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var I;if(f){clearInterval(B);return}try{let D=await this.connection.getTransaction(A,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(f=!0,clearInterval(B),O({err:((I=D.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",A))}catch(D){f=!0,clearInterval(B),console.error("getTransaction timeout:",D,A)}},Re)),R=this.connection.onSignature(A,I=>{if(f){this.connection.removeSignatureListener(R);return}f=!0,O(I)},"confirmed"),this.connection.getSignatureStatus(A)};return await m(),{txIds:a.map(A=>A.txId),signedTxs:L}}else{let d=[];for(let a=0;a<L.length;a+=1){let m=await this.connection.sendRawTransaction(L[a].serialize(),{skipPreflight:T});d.push(m)}return{txIds:d,signedTxs:L}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var T;let g=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:s}=g,c=Pe(g,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=K(K({},this.cluster==="devnet"?await Ge(this.connection):Ie),t),w=Array.from(new Set([...n,...this.lookupTableAddress])),b=[];for(let l of w)o[l]===void 0&&b.push(new re(l));let u=await qe({connection:this.connection,address:b});for(let[l,S]of Object.entries(u))o[l]=S;let h=i?re.default.toBase58():s!=null?s:await ee(this.connection,this.blockhashCommitment),x=new ge({payerKey:this.feePayer,recentBlockhash:h,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((T=this.owner)==null?void 0:T.signer)&&!this.signers.some(l=>l.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new ye(x);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async l=>{var d;let{skipPreflight:S=!0,sendAndConfirm:y,notSendToRpc:L}=l||{};if(Z([P]),(d=this.owner)!=null&&d.isKeyPair){let a=await this.connection.sendTransaction(P,{skipPreflight:S});return y&&await Ce(this.connection,a),{txId:a,signedTx:P}}if(this.signAllTransactions){let a=await this.signAllTransactions([P]);if(this.signers.length)for(let m of a)try{m.sign(this.signers)}catch{}return{txId:L?"":await this.connection.sendTransaction(a[0],{skipPreflight:S}),signedTx:a[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:c||{}}}async buildV0MultiTx(e){var b;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),s=t.filter(u=>u.builder.instructions.length>0),c=[i,...s.map(u=>u.transaction)],o=[this.signers,...s.map(u=>u.signers)],w=[...this.instructionTypes,...s.map(u=>u.instructionTypes).flat()];return(b=this.owner)!=null&&b.signer&&o.forEach(u=>{u.some(h=>h.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),c.forEach(async(u,h)=>{u.sign(o[h])}),{builder:this,transactions:c,signers:o,instructionTypes:w,buildProps:n,execute:async u=>{var T;let{sequentially:h,onTxUpdate:x,recentBlockHash:P,skipPreflight:g=!0}=u||{};if(P&&c.forEach(l=>l.message.recentBlockhash=P),Z(c),(T=this.owner)!=null&&T.isKeyPair){if(h){let l=[];for(let S of c){let y=await this.connection.sendTransaction(S,{skipPreflight:g});await Ce(this.connection,y),l.push(y)}return{txIds:l,signedTxs:c}}return{txIds:await Promise.all(c.map(async l=>await this.connection.sendTransaction(l,{skipPreflight:g}))),signedTxs:c}}if(this.signAllTransactions){let l=await this.signAllTransactions(c);if(h){let S=0,y=[],L=async()=>{if(!l[S])return;let d=await this.connection.sendTransaction(l[S],{skipPreflight:g});y.push({txId:d,status:"sent",signedTx:l[S]}),x==null||x([...y]),S++;let a=!1,m=null,A=null,f=B=>{m!==null&&clearInterval(m),A!==null&&this.connection.removeSignatureListener(A);let R=y.findIndex(O=>O.txId===d);if(R>-1){if(y[R].status==="error"||y[R].status==="success")return;y[R].status=B.err?"error":"success"}x==null||x([...y]),B.err||L()};this.loopMultiTxStatus&&(m=setInterval(async()=>{var B;if(a){clearInterval(m);return}try{let R=await this.connection.getTransaction(d,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(a=!0,clearInterval(m),f({err:((B=R.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",d))}catch(R){a=!0,clearInterval(m),console.error("getTransaction timeout:",R,d)}},Re)),A=this.connection.onSignature(d,B=>{if(a){this.connection.removeSignatureListener(A);return}a=!0,f(B)},"confirmed"),this.connection.getSignatureStatus(d)};return L(),{txIds:[],signedTxs:l}}else{let S=[];for(let y=0;y<l.length;y+=1){let L=await this.connection.sendTransaction(l[y],{skipPreflight:g});S.push(L)}return{txIds:S,signedTxs:l}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var x;let h=e||{},{splitIns:t=[],computeBudgetConfig:n}=h,i=Pe(h,["splitIns","computeBudgetConfig"]),s=n?Le(n):{instructions:[],instructionTypes:[]},c=this.signers.reduce((P,g)=>z(K({},P),{[g.publicKey.toBase58()]:g}),{}),o=[],w=[],b=[],u=0;if(this.allInstructions.forEach(P=>{let g=[...b,P],T=n?[...s.instructions,...g]:g,S=[...new Set(g.map(y=>y.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat()).values()].map(y=>new re(y));if(P!==t[u]&&b.length<12&&(pe({instructions:T,payer:this.feePayer,signers:S})||pe({instructions:g,payer:this.feePayer,signers:S})))b.push(P);else{if(b.length===0)throw Error("item ins too big");u+=P===t[u]?1:0,pe({instructions:n?[...s.instructions,...b]:[...b],payer:this.feePayer,signers:S})?o.push(new fe().add(...s.instructions,...b)):o.push(new fe().add(...b)),w.push(Array.from(new Set(b.map(y=>y.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(y=>c[y]).filter(y=>y!==void 0)),b=[P]}}),b.length>0){let g=[...new Set(b.map(T=>T.keys.filter(l=>l.isSigner).map(l=>l.pubkey.toString())).flat()).values()].map(T=>c[T]).filter(T=>T!==void 0);pe({instructions:n?[...s.instructions,...b]:[...b],payer:this.feePayer,signers:g.map(T=>T.publicKey)})?o.push(new fe().add(...s.instructions,...b)):o.push(new fe().add(...b)),w.push(g)}return o.forEach(P=>P.feePayer=this.feePayer),(x=this.owner)!=null&&x.signer&&w.forEach(P=>{P.some(g=>g.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:o,signers:w,instructionTypes:this.instructionTypes,execute:async P=>{var d;let{sequentially:g,onTxUpdate:T,skipTxCount:l=0,recentBlockHash:S,skipPreflight:y=!0}=P||{},L=S!=null?S:await ee(this.connection,this.blockhashCommitment);if(o.forEach(async(a,m)=>{a.recentBlockhash=L,w[m].length&&a.sign(...w[m])}),Z(o),(d=this.owner)!=null&&d.isKeyPair){if(g){let a=0,m=[];for(let A of o){if(++a,a<=l){m.push("tx skipped");continue}let f=await He(this.connection,A,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});m.push(f)}return{txIds:m,signedTxs:o}}return{txIds:await Promise.all(o.map(async a=>await this.connection.sendRawTransaction(a.serialize(),{skipPreflight:y}))),signedTxs:o}}if(this.signAllTransactions){let a=await this.signAllTransactions(o.slice(l,o.length)),m=[...o.slice(0,l),...a];if(g){let A=0,f=[],B=async()=>{if(!m[A])return;A<l&&(f.push({txId:"",status:"success",signedTx:m[A]}),T==null||T([...f]),A++,B());let R=await this.connection.sendRawTransaction(m[A].serialize(),{skipPreflight:y});f.push({txId:R,status:"sent",signedTx:m[A]}),T==null||T([...f]),A++;let O=!1,I=null,D=null,E=W=>{I!==null&&clearInterval(I),D!==null&&this.connection.removeSignatureListener(D);let F=f.findIndex(J=>J.txId===R);if(F>-1){if(f[F].status==="error"||f[F].status==="success")return;f[F].status=W.err?"error":"success"}T==null||T([...f]),W.err||B()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var W;if(O){clearInterval(I);return}try{let F=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(O=!0,clearInterval(I),E({err:((W=F.meta)==null?void 0:W.err)||null}),console.log("tx status from getTransaction:",R))}catch(F){O=!0,clearInterval(I),console.error("getTransaction timeout:",F,R)}},Re)),D=this.connection.onSignature(R,W=>{if(O){this.connection.removeSignatureListener(D);return}O=!0,E(W)},"confirmed"),this.connection.getSignatureStatus(R)};return await B(),{txIds:f.map(R=>R.txId),signedTxs:m}}else{let A=[];for(let f=0;f<m.length;f+=1){let B=await this.connection.sendRawTransaction(m[f].serialize(),{skipPreflight:y});A.push(B)}return{txIds:A,signedTxs:m}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var L;let y=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:s=[]}=y,c=Pe(y,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=K(K({},this.cluster==="devnet"?await Ge(this.connection):Ie),i),w=Array.from(new Set([...this.lookupTableAddress,...s])),b=[];for(let d of w)o[d]===void 0&&b.push(new re(d));let u=await qe({connection:this.connection,address:b});for(let[d,a]of Object.entries(u))o[d]=a;let h=t?Le(t):{instructions:[],instructionTypes:[]},x=await ee(this.connection,this.blockhashCommitment),P=this.signers.reduce((d,a)=>z(K({},d),{[a.publicKey.toBase58()]:a}),{}),g=[],T=[],l=[],S=0;if(this.allInstructions.forEach(d=>{let a=[...l,d],m=t?[...h.instructions,...a]:a;if(d!==n[S]&&l.length<12&&(de({instructions:m,payer:this.feePayer,lookupTableAddressAccount:o})||de({instructions:a,payer:this.feePayer,lookupTableAddressAccount:o})))l.push(d);else{if(l.length===0)throw Error("item ins too big");S+=d===n[S]?1:0;let A={};for(let f of[...new Set(w)])o[f]!==void 0&&(A[f]=o[f]);if(t&&de({instructions:[...h.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:x})){let f=new ge({payerKey:this.feePayer,recentBlockhash:x,instructions:[...h.instructions,...l]}).compileToV0Message(Object.values(o));g.push(new ye(f))}else{let f=new ge({payerKey:this.feePayer,recentBlockhash:x,instructions:[...l]}).compileToV0Message(Object.values(o));g.push(new ye(f))}T.push(Array.from(new Set(l.map(f=>f.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(f=>P[f]).filter(f=>f!==void 0)),l=[d]}}),l.length>0){let a=[...new Set(l.map(m=>m.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(m=>P[m]).filter(m=>m!==void 0);if(t&&de({instructions:[...h.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:x})){let m=new ge({payerKey:this.feePayer,recentBlockhash:x,instructions:[...h.instructions,...l]}).compileToV0Message(Object.values(o));g.push(new ye(m))}else{let m=new ge({payerKey:this.feePayer,recentBlockhash:x,instructions:[...l]}).compileToV0Message(Object.values(o));g.push(new ye(m))}T.push(a)}return(L=this.owner)!=null&&L.signer&&T.forEach(d=>{d.some(a=>a.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),g.forEach((d,a)=>{d.sign(T[a])}),{builder:this,transactions:g,buildProps:e,signers:T,instructionTypes:this.instructionTypes,execute:async d=>{var R;let{sequentially:a,onTxUpdate:m,skipTxCount:A=0,recentBlockHash:f,skipPreflight:B=!0}=d||{};if(g.map(async(O,I)=>{T[I].length&&O.sign(T[I]),f&&(O.message.recentBlockhash=f)}),Z(g),(R=this.owner)!=null&&R.isKeyPair){if(a){let O=0,I=[];for(let D of g){if(++O,O<=A){console.log("skip tx: ",O),I.push("tx skipped");continue}let E=await this.connection.sendTransaction(D,{skipPreflight:B});await Ce(this.connection,E),I.push(E)}return{txIds:I,signedTxs:g}}return{txIds:await Promise.all(g.map(async O=>await this.connection.sendTransaction(O,{skipPreflight:B}))),signedTxs:g}}if(this.signAllTransactions){let O=await this.signAllTransactions(g.slice(A,g.length)),I=[...g.slice(0,A),...O];if(a){let D=0,E=[],W=async()=>{if(!I[D])return;if(D<A){E.push({txId:"",status:"success",signedTx:I[D]}),m==null||m([...E]),D++,W();return}let F=await this.connection.sendTransaction(I[D],{skipPreflight:B});E.push({txId:F,status:"sent",signedTx:I[D]}),m==null||m([...E]),D++;let J=!1,$=null,Te=null,Qe=X=>{$!==null&&clearInterval($),Te!==null&&this.connection.removeSignatureListener(Te);let G=E.findIndex(Bt=>Bt.txId===F);if(G>-1){if(E[G].status==="error"||E[G].status==="success")return;E[G].status=X.err?"error":"success"}m==null||m([...E]),X.err||W()};this.loopMultiTxStatus&&($=setInterval(async()=>{var X;if(J){clearInterval($);return}try{let G=await this.connection.getTransaction(F,{commitment:"confirmed",maxSupportedTransactionVersion:0});G&&(J=!0,clearInterval($),Qe({err:((X=G.meta)==null?void 0:X.err)||null}),console.log("tx status from getTransaction:",F))}catch(G){J=!0,clearInterval($),console.error("getTransaction timeout:",G,F)}},Re)),Te=this.connection.onSignature(F,X=>{if(J){this.connection.removeSignatureListener(Te);return}J=!0,Qe(X)},"confirmed"),this.connection.getSignatureStatus(F)};return W(),{txIds:[],signedTxs:I}}else{let D=[];for(let E=0;E<I.length;E+=1){let W=await this.connection.sendTransaction(I[E],{skipPreflight:B});D.push(W)}return{txIds:D,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:c||{}}}};import $t from"bn.js";var ts=new $t(1e6);import{PublicKey as sn}from"@solana/web3.js";import wt,{isBN as At}from"bn.js";import{bits as As,BitStructure as Ss,blob as en,Blob as Bs,cstr as Ls,f32 as Cs,f32be as ks,f64 as Is,f64be as Rs,greedy as Ds,Layout as tn,ns64 as Ns,ns64be as Ms,nu64 as Os,nu64be as Es,offset as Fs,s16 as _s,s16be as Ks,s24 as Vs,s24be as Ws,s32 as vs,s32be as Us,s40 as qs,s40be as Gs,s48 as Hs,s48be as js,s8 as zs,seq as nn,struct as Js,Structure as rn,u16 as Xs,u16be as Ys,u24 as Zs,u24be as Qs,u32 as $s,u32be as ea,u40 as ta,u40be as na,u48 as ra,u48be as oa,u8 as ia,UInt as on,union as sa,Union as aa,unionLayoutDiscriminator as ua,utf8 as ca}from"@solana/buffer-layout";var je=tn,Tt=rn;var xt=on;var Pt=nn;var oe=en;var ze=class extends je{constructor(t,n,i){super(t,i);this.blob=oe(t),this.signed=n}decode(t,n=0){let i=new wt(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new wt(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function ie(r){return new xt(1,r)}function U(r){return new ze(8,!1,r)}var Je=class extends je{constructor(t,n,i,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function Q(r){return new Je(oe(32),e=>new sn(e),e=>e.toBuffer(),r)}var Xe=class extends Tt{decode(e,t){return super.decode(e,t)}};function se(r,e,t){return new Xe(r,e,t)}function he(r,e,t){let n,i=typeof e=="number"?e:At(e)?e.toNumber():new Proxy(e,{get(s,c){if(!n){let o=Reflect.get(s,"count");n=At(o)?o.toNumber():o,Reflect.set(s,"count",n)}return Reflect.get(s,c)},set(s,c,o){return c==="count"&&(n=o),Reflect.set(s,c,o)}});return Pt(r,i,t)}var Ye=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),be=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=V(t)}createTxBuilder(e){return this.scope.checkOwner(),new De({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Ye(e))}logInfo(...e){this.logger.info(Ye(e))}logAndCreateError(...e){let t=Ye(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var _=class extends be{static getPdaPoolId(e,t){return ke([_.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,i){return ke([_.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),Buffer.from(new St(i).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:i,chainTime:s}){if(n.length===0)return[];let c=n.map(u=>_.getPdaPoolId(t,u).publicKey),o=[];for(let u=0;u<_.VERSION_PROJECT.length;u++)o.push(...c.map(h=>_.getPdaOwnerId(t,h,i,u).publicKey));let w=await we(e,[...c,...o]),b=[];for(let u=0;u<w.length;u++){let h=Math.floor(u/n.length),x=u%n.length,P=c[x],g=o[u],T=w[x],l=w[n.length+u];if(!(T&&l)||T.data.length!==_.POOL_LAYOUT.span||l.data.length!==_.OWNER_LAYOUT.span)continue;let S=_.POOL_LAYOUT.decode(T.data),y=_.OWNER_LAYOUT.decode(l.data),L=S.openTime.toNumber(),d=S.endTime.toNumber(),a=y.tokenInfo.map(f=>f.debtAmount.gt(new St(0))).filter(f=>!f).length!==3,m=s>L&&s<d&&S.status===1,A=a&&m;b.push({programId:t,poolId:P,ammId:S.ammId,ownerAccountId:g,snapshotLpAmount:y.lpAmount,project:_.VERSION_PROJECT[h],openTime:L,endTime:d,canClaim:A,canClaimErrorType:a?m?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:S.tokenInfo.map((f,B)=>({mintAddress:f.mintAddress,mintVault:f.mintVault,mintDecimals:f.mintDecimals,perLpLoss:f.perLpLoss,debtAmount:y.tokenInfo[B].debtAmount.add(y.tokenInfo[B].claimedAmount)}))})}return b}async makeClaimTransaction({poolInfo:e,ownerInfo:t,feePayer:n}){t.wallet||this.scope.checkOwner();let i=this.createTxBuilder(n),s=t.wallet||this.scope.ownerPubKey,c=[];for(let b of e.tokenInfo){let{account:u,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:b.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:b.mintAddress.equals(v.WSOL.mint),createInfo:{payer:s,amount:0},skipCloseAccount:!b.mintAddress.equals(v.WSOL.mint),associatedOnly:b.mintAddress.equals(v.WSOL.mint)?!1:t.associatedOnly});h&&i.addInstruction(h),c.push(u)}i.addInstruction({instructions:[_.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:s,ownerPda:e.ownerAccountId,claimAddress:c}})]});let{transaction:o,signers:w}=i.build();return[{transaction:o,signer:w}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t,feePayer:n}){let i=this.createTxBuilder(n),s=t.wallet||this.scope.ownerPubKey,c={};for(let u of e){let h=[];for(let x of u.tokenInfo){let{account:P,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({mint:x.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:x.mintAddress.equals(v.WSOL.mint),createInfo:{payer:s,amount:0},skipCloseAccount:!x.mintAddress.equals(v.WSOL.mint),associatedOnly:x.mintAddress.equals(v.WSOL.mint)?!1:t.associatedOnly});g&&i.addInstruction(g),P&&(c[x.mintAddress.toString()]=P,h.push(P))}i.addInstruction({instructions:[_.makeClaimInstruction({programId:u.programId,poolInfo:u,ownerInfo:{wallet:s,ownerPda:u.ownerAccountId,claimAddress:h}})]})}let{transaction:o,signers:w}=i.build(),b=i.allInstructions;return ve(b,[s,...w.map(u=>u.publicKey)])?[{transaction:o,signer:w}]:[{transaction:new Ze().add(...b.slice(0,i.AllTxData.instructions.length-1)),signer:w},{transaction:new Ze().add(...b.slice(i.AllTxData.instructions.length-1)),signer:[]},{transaction:new Ze().add(...i.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){let i=se([]),s=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map(w=>({pubkey:w,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:w})=>({pubkey:w,isSigner:!1,isWritable:!0})),{pubkey:cn,isSigner:!1,isWritable:!1}],c=Buffer.alloc(i.span);i.encode({},c);let o=Buffer.from([10,66,208,184,161,6,191,98,...c]);return new un({keys:s,programId:e,data:o})}},q=_;q.CLAIMED_NUM=3,q.POOL_LAYOUT=se([oe(8),ie("bump"),ie("status"),U("openTime"),U("endTime"),Q("ammId"),he(se([ie("mintDecimals"),Q("mintAddress"),Q("mintVault"),U("perLpLoss"),U("totalClaimedAmount")]),_.CLAIMED_NUM,"tokenInfo"),he(U(),10,"padding")]),q.OWNER_LAYOUT=se([oe(8),ie("bump"),ie("version"),Q("poolId"),Q("owner"),U("lpAmount"),he(se([Q("mintAddress"),U("debtAmount"),U("claimedAmount")]),_.CLAIMED_NUM,"tokenInfo"),he(U(),4,"padding")]),q.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new an(e)),q.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},q.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];export{q as default};
//# sourceMappingURL=index.mjs.map