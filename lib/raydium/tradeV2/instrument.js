var Li=Object.create;var lt=Object.defineProperty,Ri=Object.defineProperties,Ni=Object.getOwnPropertyDescriptor,Mi=Object.getOwnPropertyDescriptors,Oi=Object.getOwnPropertyNames,xn=Object.getOwnPropertySymbols,Wi=Object.getPrototypeOf,Kn=Object.prototype.hasOwnProperty,Fi=Object.prototype.propertyIsEnumerable;var Sn=(y,e,t)=>e in y?lt(y,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[e]=t,Y=(y,e)=>{for(var t in e||(e={}))Kn.call(e,t)&&Sn(y,t,e[t]);if(xn)for(var t of xn(e))Fi.call(e,t)&&Sn(y,t,e[t]);return y},$=(y,e)=>Ri(y,Mi(e));var Ei=(y,e)=>{for(var t in e)lt(y,t,{get:e[t],enumerable:!0})},Cn=(y,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Oi(e))!Kn.call(y,i)&&i!==t&&lt(y,i,{get:()=>e[i],enumerable:!(n=Ni(e,i))||n.enumerable});return y};var H=(y,e,t)=>(t=y!=null?Li(Wi(y)):{},Cn(e||!y||!y.__esModule?lt(t,"default",{value:y,enumerable:!0}):t,y)),Vi=y=>Cn(lt({},"__esModule",{value:!0}),y);var to={};Ei(to,{makeSwapInstruction:()=>Jr,route1Instruction:()=>Zr,route2Instruction:()=>Yr,routeInstruction:()=>Ci,swapBaseInAutoAccount:()=>$r,swapBaseOutAutoAccount:()=>eo});module.exports=Vi(to);var A=require("@solana/web3.js"),We=H(require("bn.js")),ye=require("@solana/spl-token");var Rn=require("@solana/web3.js");var mt=require("lodash");var Qt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ln={},vi={};function ce(y){let e=(0,mt.get)(Ln,y);if(!e){let t=(0,mt.get)(vi,y);e=new Qt({name:y,logLevel:t}),(0,mt.set)(Ln,y,e)}return e}var xt=require("@solana/spl-token"),Ht=ce("Raydium_accountInfo_util");async function Ue(y,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:a=100}=Y({batchRequest:!1},t),o=jt(e,a),r=new Array(o.length).fill([]);if(n){let s=o.map(b=>{let g=y._buildArgs([b.map(u=>u.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:g}}),l=jt(s,10);r=(await(await Promise.all(l.map(async b=>await y._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&Ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(g=>{if(g){let{data:u,executable:k,lamports:m,owner:c,rentEpoch:d}=g;return u.length!==2&&u[1]!=="base64"&&Ht.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(u[0],"base64"),executable:k,lamports:m,owner:new Rn.PublicKey(c),rentEpoch:d}}return null})))}else try{r=await Promise.all(o.map(s=>y.getMultipleAccountsInfo(s,i)))}catch(s){s instanceof Error&&Ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${s.message}`)}return r.flat()}async function St(y,e,t){let n=await Ue(y,e.map(i=>i.pubkey),t);return e.map((i,a)=>$(Y({},i),{accountInfo:n[a]}))}var Ee=H(require("bn.js")),Hi=H(require("decimal.js"));var En=H(require("big.js")),yt=H(require("bn.js"));var Nn=H(require("toformat")),_i=Nn.default,dt=_i;var ft=H(require("big.js")),On=H(require("bn.js")),Wn=H(require("decimal.js-light"));var it=H(require("bn.js"));var Mn=9007199254740991;function oe(y){let e=ce("Raydium_parseBigNumberish");if(y instanceof it.default)return y;if(typeof y=="string"){if(y.match(/^-?[0-9]+$/))return new it.default(y);e.logWithError(`invalid BigNumberish string: ${y}`)}return typeof y=="number"?(y%1&&e.logWithError(`BigNumberish number underflow: ${y}`),(y>=Mn||y<=-Mn)&&e.logWithError(`BigNumberish number overflow: ${y}`),new it.default(String(y))):typeof y=="bigint"?new it.default(y.toString()):(e.error(`invalid BigNumberish value: ${y}`),new it.default(0))}var Ct=ce("module/fraction"),Zt=dt(ft.default),bt=dt(Wn.default),qi={[0]:bt.ROUND_DOWN,[1]:bt.ROUND_HALF_UP,[2]:bt.ROUND_UP},Gi={[0]:ft.default.roundDown,[1]:ft.default.roundHalfUp,[2]:ft.default.roundUp},j=class{constructor(e,t=new On.default(1)){this.numerator=oe(e),this.denominator=oe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(oe(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(oe(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(oe(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(oe(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ct.logWithError(`${e} is not an integer.`),e<=0&&Ct.logWithError(`${e} is not positive.`),bt.set({precision:e+1,rounding:qi[n]});let i=new bt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ct.logWithError(`${e} is not an integer.`),e<0&&Ct.logWithError(`${e} is negative.`),Zt.DP=e,Zt.RM=Gi[n]||1,new Zt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ui=ce("Raydium_amount"),Fn=dt(En.default);function Xi(y,e){let t="0",n="0";if(y.includes(".")){let i=y.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Ui.logWithError(`invalid number string, num: ${y}`)}else t=y;return[t,n.slice(0,e)||n]}var pe=class extends j{constructor(t,n,i=!0,a){let o=new yt.default(0),r=Yt.pow(new yt.default(t.decimals));if(i)o=oe(n);else{let s=new yt.default(0),l=new yt.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[p,b]=Xi(n.toString(),t.decimals);s=oe(p),l=oe(b)}s=s.mul(r),o=s.add(l)}super(o,r);this.logger=ce(a||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Fn.DP=this.token.decimals,new Fn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var Vn=require("@solana/web3.js"),Jt=require("@solana/spl-token"),$t={chainId:101,address:Vn.PublicKey.default.toBase58(),programId:Jt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Xe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Jt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Rt=require("@solana/web3.js");var J=require("@solana/web3.js"),vn=require("@solana/spl-token");function f({pubkey:y,isSigner:e=!1,isWritable:t=!0}){return{pubkey:y,isWritable:t,isSigner:e}}var Lo=[f({pubkey:vn.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:J.SystemProgram.programId,isWritable:!1}),f({pubkey:J.SYSVAR_RENT_PUBKEY,isWritable:!1})];function en({publicKey:y,transformSol:e}){let t=tn(y.toString());if(t instanceof J.PublicKey)return e&&t.equals(gt)?Kt:t;if(e&&t.toString()===gt.toBase58())return Kt;if(typeof t=="string"){if(t===J.PublicKey.default.toBase58())return J.PublicKey.default;try{return new J.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function tn(y){try{return new J.PublicKey(y)}catch{return y}}var Lt=new J.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ze=new J.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Fe=new J.PublicKey("SysvarRent111111111111111111111111111111111"),Ro=new J.PublicKey("SysvarC1ock11111111111111111111111111111111"),Qe=new J.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),No=new J.PublicKey("Sysvar1nstructions1111111111111111111111111"),zi=J.SystemProgram.programId,Mo=new J.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Oo=new J.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Wo=new J.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Fo=new J.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Eo=new J.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Vo=new J.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),vo=new J.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),_o=new J.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Do=new J.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),qo=new J.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Go=new J.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Kt=new J.PublicKey("So11111111111111111111111111111111111111112"),gt=J.PublicKey.default;function pt(y){return en({publicKey:y,transformSol:!0})}var nn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:a=!1,isToken2022:o=!1}){if(e===gt.toBase58()||e instanceof Rt.PublicKey&&gt.equals(e)){this.decimals=Xe.decimals,this.symbol=Xe.symbol,this.name=Xe.name,this.mint=new Rt.PublicKey(Xe.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=a?Rt.PublicKey.default:en({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ne=nn;Ne.WSOL=new nn($(Y({},Xe),{mint:Xe.address}));var rn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Nt=rn;Nt.SOL=new rn($t);var Dn=H(require("bn.js"));var _n=new j(new Dn.default(100)),_e=class extends j{toSignificant(e=5,t,n){return this.mul(_n).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(_n).toFixed(e,t,n)}};var Qi=ce("Raydium_price"),Le=class extends j{constructor(t){let{baseToken:n,quoteToken:i,numerator:a,denominator:o}=t;super(a,o);this.baseToken=n,this.quoteToken=i,this.scalar=new j(on(n.decimals),on(i.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Le({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Qi.logWithError("mul token not equals");let n=super.mul(t);return new Le({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var Gn=require("@solana/web3.js"),Un=H(require("bn.js"));function Xn(y){return typeof y=="object"&&y!==null&&![Ne,pe,Gn.PublicKey,j,Un.default,Le,_e].some(e=>typeof e=="object"&&y instanceof e)}function Ie(y){return typeof y=="string"?tn(y):Array.isArray(y)?y.map(e=>Ie(e)):Xn(y)?Object.fromEntries(Object.entries(y).map(([e,t])=>[e,Ie(t)])):y}var qn=new Ee.default(0),ji=new Ee.default(1),Ns=new Ee.default(2),Ms=new Ee.default(3),Os=new Ee.default(5),Yt=new Ee.default(10),Ws=new Ee.default(100),Fs=new Ee.default(1e3),Es=new Ee.default(1e4);function on(y){return Yt.pow(oe(y))}function jt(y,e=1,t=[]){let n=[...y];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var zn=require("@solana/web3.js"),Qn=require("@solana/spl-token");var je=require("@solana/web3.js");var ee={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Zi=require("@solana/spl-token"),Zs=ce("Raydium_txUtil");function ge(y,e){let[t,n]=je.PublicKey.findProgramAddressSync(y,e);return{publicKey:t,nonce:n}}function te(y,e,t){return ge([y.toBuffer(),(t!=null?t:Qn.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new zn.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var M=require("@solana/web3.js"),Yi=new M.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ji=new M.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),$i=new M.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),er=new M.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),tr=new M.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),nr=new M.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ir=new M.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),rr=new M.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),or=new M.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Mt=new M.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Hn=new M.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),jn=new M.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Zn=new M.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ot=new M.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),sr=new M.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ar=new M.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ea=new M.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ta=new M.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),na=new M.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ia=new M.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Yn=new M.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Jn=new M.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ur=new M.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),cr=new M.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),lr=new M.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),mr=new M.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),pr=new M.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ra=new M.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),oa=new M.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),dr=new M.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),fr=new M.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ae={AMM_V4:rr,AMM_STABLE:or,CLMM_PROGRAM_ID:Hn,CLMM_LOCK_PROGRAM_ID:jn,CLMM_LOCK_AUTH_ID:Zn,FARM_PROGRAM_ID_V3:Yi,FARM_PROGRAM_ID_V4:Ji,FARM_PROGRAM_ID_V5:$i,FARM_PROGRAM_ID_V6:er,OPEN_BOOK_PROGRAM:nr,SERUM_PROGRAM_ID_V3:ir,UTIL1216:tr,Router:sr,CREATE_CPMM_POOL_PROGRAM:Yn,CREATE_CPMM_POOL_AUTH:Jn,CREATE_CPMM_POOL_FEE_ACC:ur,LOCK_CPMM_PROGRAM:cr,LOCK_CPMM_AUTH:lr,LAUNCHPAD_PROGRAM:mr,LAUNCHPAD_AUTH:pr,LAUNCHPAD_PLATFORM:dr,LAUNCHPAD_CONFIG:fr,FEE_DESTINATION_ID:ar,MODEL_DATA_PUBKEY:Ot},sa={OPEN_BOOK_PROGRAM:new M.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new M.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new M.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new M.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new M.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new M.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new M.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new M.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new M.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new M.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new M.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new M.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:M.PublicKey.default,Router:new M.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new M.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new M.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new M.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new M.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new M.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new M.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new M.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new M.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new M.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new M.PublicKey("Ray1111111111111111111111111111111111111111")};var Re=H(require("bn.js")),kt=1e4;function se(y,e,t,n){if(e===void 0)return{amount:y,fee:void 0,expirationTime:void 0};let i=$(Y({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),a=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,o=new Re.default(a.maximumFee.toString()),r=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(a.transferFeeBasisPoints===kt){let s=new Re.default(a.maximumFee.toString());return{amount:y.add(s),fee:s,expirationTime:r}}else{let s=Wt(y.mul(new Re.default(kt)),new Re.default(kt-a.transferFeeBasisPoints)),l=new Re.default(a.maximumFee.toString()),p=s.sub(y).gt(l)?y.add(l):s,b=Wt(p.mul(new Re.default(a.transferFeeBasisPoints)),new Re.default(kt)),g=b.gt(o)?o:b;return{amount:p,fee:g,expirationTime:r}}else{let s=Wt(y.mul(new Re.default(a.transferFeeBasisPoints)),new Re.default(kt)),l=s.gt(o)?o:s;return{amount:y,fee:l,expirationTime:r}}}function He(y,e){return y===void 0?e:e===void 0?y:Math.min(y,e)}function Wt(y,e){let{div:t,mod:n}=y.divmod(e);return n.gt(new Re.default(0))?t.add(new Re.default(1)):t}var Pt=require("@solana/web3.js");var br={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Pt.AddressLookupTableAccount({key:new Pt.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Pt.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};var rt=require("@solana/web3.js"),kr=H(require("axios"));var $n=H(require("bn.js")),Pr=new $n.default(1e6);var ii=require("@solana/web3.js"),ot=H(require("bn.js"));var O=require("@solana/buffer-layout"),sn=O.Layout,ei=O.Structure;var an=O.UInt;var ti=O.u8,Ze=O.u16;var ie=O.s32;var ni=O.seq;var ke=O.blob;var st=class extends sn{constructor(t,n,i){super(t,i);this.blob=ke(t),this.signed=n}decode(t,n=0){let i=new ot.default(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new ot.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function V(y){return new an(1,y)}function at(y){return new an(4,y)}function P(y){return new st(8,!1,y)}function E(y){return new st(16,!1,y)}function ri(y){return new st(8,!0,y)}function oi(y){return new st(16,!0,y)}var Ft=class extends sn{constructor(t,n,i,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function x(y){return new Ft(ke(32),e=>new ii.PublicKey(e),e=>e.toBuffer(),y)}function de(y){return new Ft(ti(),Ar,wr,y)}function Ar(y){if(y===0)return!1;if(y===1)return!0;throw new Error("Invalid bool: "+y)}function wr(y){return y?1:0}var un=class extends ei{decode(e,t){return super.decode(e,t)}};function F(y,e,t){return new un(y,e,t)}function X(y,e,t){let n,i=typeof e=="number"?e:(0,ot.isBN)(e)?e.toNumber():new Proxy(e,{get(a,o){if(!n){let r=Reflect.get(a,"count");n=(0,ot.isBN)(r)?r.toNumber():r,Reflect.set(a,"count",n)}return Reflect.get(a,o)},set(a,o,r){return o==="count"&&(n=r),Reflect.set(a,o,r)}});return ni(y,i,t)}var vr=require("@solana/web3.js"),_r=H(require("bn.js")),Dr=H(require("decimal.js"));var Xt=require("@solana/spl-token");var Tr=require("@solana/web3.js"),si=require("@solana/spl-token");var w=require("@solana/web3.js"),Ut=H(require("bn.js"));var C=require("@solana/spl-token");var Ai=H(require("bn.js")),et=H(require("decimal.js"));var xe=H(require("bn.js")),re=new xe.default(0),Se=new xe.default(1),De=new xe.default(-1),Ke=new xe.default(1).shln(64),Et=new xe.default(1).shln(128),cn=Ke.sub(Se),At=64,ai=Et.subn(1),Pe=-443636,we=-Pe,Ve=new xe.default("4295048016"),ve=new xe.default("79226673521066979257578248091"),Vt=new xe.default("4295048017"),vt=new xe.default("79226673521066979257578248090"),ui=16,ci="59543866431248",li="184467440737095516",mi="15793534762490258745",_t=new xe.default(10).pow(new xe.default(6));var Au=new xe.default("18446744073700000000");var G=H(require("bn.js")),Oe=H(require("decimal.js"));function Dt(y){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,y,!1),new Uint8Array(e)}function ln(y,e){let t=0;for(let n=y-1;n>=0&&!e.testn(n);n--)t++;return t}function mn(y,e){let t=0;for(let n=0;n<y&&!e.testn(n);n++)t++;return t}function wt(y,e){for(let t=0;t<y;t++)if(e.testn(t))return!1;return!0}function pi(y,e){return wt(y,e)?null:ln(y,e)}function di(y,e){return wt(y,e)?null:mn(y,e)}var xu=Buffer.from("amm_config","utf8"),hr=Buffer.from("pool","utf8"),Br=Buffer.from("pool_vault","utf8"),Ir=Buffer.from("pool_reward_vault","utf8"),fi=Buffer.from("position","utf8"),xr=Buffer.from("tick_array","utf8"),Sr=Buffer.from("operation","utf8"),Kr=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Cr=Buffer.from("observation","utf8");function bi(y,e,t,n){return ge([hr,e.toBuffer(),t.toBuffer(),n.toBuffer()],y)}function pn(y,e,t){return ge([Br,e.toBuffer(),t.toBuffer()],y)}function yi(y,e,t){return ge([Ir,e.toBuffer(),t.toBuffer()],y)}function Z(y,e,t){return ge([xr,e.toBuffer(),Dt(t)],y)}function qe(y,e,t,n){return ge([fi,e.toBuffer(),Dt(t),Dt(n)],y)}function he(y,e){return ge([fi,e.toBuffer()],y)}function ut(y){return ge([Buffer.from("metadata","utf8"),Qe.toBuffer(),y.toBuffer()],Qe)}function qt(y){return ge([Sr],y)}function le(y,e){return ge([Kr,e.toBuffer()],y)}function gi(y,e){return ge([Cr,e.toBuffer()],y)}var ki=Buffer.from("locked_position","utf8");function dn(y,e){return ge([ki,e.toBuffer()],y)}function fn(y,e){return ge([ki,e.toBuffer()],y)}var Su=Buffer.from("support_mint","utf8");var Be=require("@solana/web3.js"),yn=require("@solana/spl-token"),ne=H(require("bn.js")),U=H(require("decimal.js"));var Me=H(require("bn.js")),Gt=H(require("decimal.js"));var Tt=class{static getfeeGrowthInside(e,t,n){let i=new Me.default(0),a=new Me.default(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,a=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new Me.default(0),r=new Me.default(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,r=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),r=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let s=q.wrappingSubU128(q.wrappingSubU128(e.feeGrowthGlobalX64A,i),o),l=q.wrappingSubU128(q.wrappingSubU128(e.feeGrowthGlobalX64B,a),r);return{feeGrowthInsideX64A:s,feeGrowthInsideBX64:l}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=q.mulDivFloor(q.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Ke),s=t.tokenFeesOwedA.add(r),l=q.mulDivFloor(q.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Ke),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=q.mulDivFloor(q.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Ke),s=t.tokenFeesOwedA.add(r),l=q.mulDivFloor(q.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Ke),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionRewardsV2(e,t,n,i){let a=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=q.wrappingSubU128(s,l.growthInsideLastX64),b=q.mulDivFloor(p,t.liquidity,Ke),g=l.rewardAmountOwed.add(b);a.push(g)}return a}static GetPositionRewards(e,t,n,i){let a=[],o=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=q.wrappingSubU128(s,l.growthInsideLastX64),b=q.mulDivFloor(p,t.liquidity,Ke),g=l.rewardAmountOwed.add(b);a.push(g)}return a}static getRewardGrowthInside(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Me.default(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Me.default(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(q.wrappingSubU128(q.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getRewardGrowthInsideV2(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Me.default(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Me.default(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(q.wrappingSubU128(q.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:a,epochInfo:o}){var c,d,h,I;let r=v.priceToSqrtPriceX64(new Gt.default(e.price),e.mintA.decimals,e.mintB.decimals),s=v.getSqrtPriceX64FromTick(t.tickLower),l=v.getSqrtPriceX64FromTick(t.tickUpper),p=a?1+i:1-i,b=Q.getAmountsFromLiquidity(r,s,l,n,a),[g,u]=[se(b.amountA,(c=e.mintA.extensions)==null?void 0:c.feeConfig,o,!0),se(b.amountB,(d=e.mintB.extensions)==null?void 0:d.feeConfig,o,!0)],[k,m]=[se(new Me.default(new Gt.default(b.amountA.toString()).mul(p).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,o,!0),se(new Me.default(new Gt.default(b.amountB.toString()).mul(p).toFixed(0)),(I=e.mintB.extensions)==null?void 0:I.feeConfig,o,!0)];return{liquidity:n,amountA:g,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:He(g.expirationTime,u.expirationTime)}}};var Lr=15,z=class{static async getTickArrays(e,t,n,i,a,o,r){let s=[],l=K.getTickArrayStartIndexByTick(i,a),p=K.getInitializedTickArrayInRange(o,r,a,l,Math.floor(Lr/2));for(let u=0;u<p.length;u++){let{publicKey:k}=Z(t,n,p[u]);s.push(k)}let b=(await Ue(e,s)).map(u=>u!==null?ht.decode(u.data):null),g={};for(let u=0;u<s.length;u++){let k=b[u];k!==null&&(g[k.startTickIndex]=$(Y({},k),{address:s[u]}))}return g}static nextInitializedTick(e,t,n,i,a,o){let{initializedTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}=this.nextInitializedTickInOneArray(e,t,n,i,a,o);for(;r==null||r.liquidityGross.lten(0);){if(l=K.getNextTickArrayStartIndex(l,a,o),this.checkIsValidStartIndex(l,a))throw new Error("No enough initialized tickArray");let p=n[l];if(p===void 0)continue;let{nextTick:b,tickArrayAddress:g,tickArrayStartTickIndex:u}=this.firstInitializedTickInOneArray(e,t,p,o);[r,s,l]=[b,g,u]}if(r==null)throw new Error("No invaild tickArray cache");return{nextTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}}static nextInitializedTickArray(e,t,n,i,a){let o=Math.floor(e/z.tickCount(t)),r=n?K.searchLowBitFromStart(i,a,o-1,1,t):K.searchHightBitFromStart(i,a,o+1,1,t);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let a;if(i){let r=me-1;for(;r>=0;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r-1}}else{let r=0;for(;r<me;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r+1}}let{publicKey:o}=Z(e,t,n.startTickIndex);return{nextTick:a,tickArrayAddress:o,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,a,o){let r=K.getTickArrayStartIndexByTick(i,a),s=Math.floor((i-r)/a),l=n[r];if(l==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:r};let p;if(o)for(;s>=0;){let g=l.ticks[s];if(g.liquidityGross.gtn(0)){p=g;break}s=s-1}else for(s=s+1;s<me;){let g=l.ticks[s];if(g.liquidityGross.gtn(0)){p=g;break}s=s+1}let{publicKey:b}=Z(e,t,r);return{initializedTick:p,tickArrayAddress:b,tickArrayStartTickIndex:l.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(K.checkIsOutOfBoundary(e)){if(e>we)return!1;let n=K.getTickArrayStartIndexByTick(Pe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return me*e}};var bn=14,Ge=class{static maxTickInTickarrayBitmap(e){return e*me*Ye}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let a=n*i;return e<0?{minValue:-a,maxValue:-a+n}:{minValue:a,maxValue:a+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let a=this.maxTickInTickarrayBitmap(n),o=i?t-z.tickCount(n):t+z.tickCount(n);if(o<-a||o>=a)return{isInit:!1,tickIndex:t};let r=n*me,s=o/r+512;o<0&&o%r!=0&&s--;let l=Math.abs(s);if(i){let p=e.shln(1024-l-1),b=pi(1024,p);if(b!==null){let g=(l-b-512)*r;return{isInit:!0,tickIndex:g}}else return{isInit:!1,tickIndex:-a}}else{let p=e.shrn(l),b=di(1024,p);if(b!==null){let g=(l+b-512)*r;return{isInit:!0,tickIndex:g}}else return{isInit:!1,tickIndex:a-z.tickCount(n)}}}},Bt=class{static getBitmapOffset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Ge.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Ge.maxTickInTickarrayBitmap(e),n=-t;if(we<=t)throw Error(`extensionTickBoundary check error: ${we}, ${t}`);if(n<=Pe)throw Error(`extensionTickBoundary check error: ${n}, ${Pe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),a=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:K.mergeTickArrayBitmap(i).testn(a),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let a=z.tickCount(t),o=n?e-a:e+a,{tickarrayBitmap:r}=this.getBitmap(o,t,i);return this.nextInitializedTickArrayInBitmap(r,o,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:a,maxValue:o}=Ge.getBitmapTickBoundary(t,n),r=this.tickArrayOffsetInBitmap(t,n);if(i){let s=K.mergeTickArrayBitmap(e).shln(Ye-1-r),l=wt(512,s)?null:ln(512,s);if(l!==null){let p=t-l*z.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:a}}else{let s=K.mergeTickArrayBitmap(e).shrn(r),l=wt(512,s)?null:mn(512,s);if(l!==null){let p=t+l*z.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Ge.maxTickInTickarrayBitmap(t),i=Math.floor(n/z.tickCount(t));return e<0&&n!=0&&(i=Ye-i),i}};var ae=class{static getOutputAmountAndRemainAccounts(e,t,n,i,a,o=!1){let r=n.toBase58()===e.mintA.address,s=[],{isExist:l,startIndex:p,nextAccountMeta:b}=this.getFirstInitializedTickArray(e,r);if(!l||p===void 0||!b)throw new Error("Invalid tick array");s.push(b);let{allTrade:g,amountCalculated:u,accounts:k,sqrtPriceX64:m,feeAmount:c}=Je.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,r,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,p,a,o);return s.push(...k),{allTrade:g,expectedAmountOut:u.mul(De),remainingAccounts:s,executionPrice:m,feeAmount:c}}static getInputAmountAndRemainAccounts(e,t,n,i,a){let o=n.toBase58()===e.mintB.address,r=[],{isExist:s,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,o);if(!s||l===void 0||!p)throw new Error("Invalid tick array");try{let m=this.preInitializedTickArrayStartIndex(e,o);if(m.isExist){let{publicKey:c}=Z(e.programId,e.id,m.nextStartIndex);r.push(c)}}catch{}r.push(p);let{amountCalculated:b,accounts:g,sqrtPriceX64:u,feeAmount:k}=Je.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(De),l,a);return r.push(...g),{expectedAmountIn:b,remainingAccounts:r,executionPrice:u,feeAmount:k}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=ae.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Bt.checkTickArrayIsInit(z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):K.checkTickArrayIsInitialized(K.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:r}=Z(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:r}}let{isExist:a,nextStartIndex:o}=this.nextInitializedTickArrayStartIndex(e,z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(a){let{publicKey:r}=Z(e.programId,e.id,o);return{isExist:!0,startIndex:o,nextAccountMeta:r}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/z.tickCount(e.tickSpacing)),i=t?K.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):K.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:a}=Ge.nextInitializedTickArrayStartIndex(K.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:a};t=a;let{isInit:o,tickIndex:r}=Bt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(o)return{isExist:!0,nextStartIndex:r};if(t=r,t<Pe||t>we)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:a}){var r,s,l;let o=[];for(let p=0;p<a.length;p++){let b=a[p],g=(l=(r=t.rewardDefaultInfos[p])==null?void 0:r.mint.programId)!=null?l:(s=await e.getAccountInfo(b.tokenMint))==null?void 0:s.owner;if(g===void 0)throw Error("get new reward mint info error");let u=$(Y({},b),{perSecond:q.x64ToDecimal(b.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Be.PublicKey(g)});if(u.tokenMint.equals(Be.PublicKey.default))continue;if(n<=u.openTime.toNumber()||i.eq(re)){o.push(u);continue}let k=new ne.default(Math.min(u.endTime.toNumber(),n)),m=k.sub(u.lastUpdateTime),c=q.mulDivFloor(m,u.emissionsPerSecondX64,i),d=u.rewardGrowthGlobalX64.add(c),h=q.mulDivFloor(m,u.emissionsPerSecondX64,Ke),I=u.rewardTotalEmissioned.add(h);o.push($(Y({},u),{rewardGrowthGlobalX64:d,rewardTotalEmissioned:I,lastUpdateTime:k}))}return o}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let a of t){let o=K.getTickArrayStartIndexByTick(a,e);if(o>=n||o<i)return!0}return!1}static tickRange(e){let t=Ge.maxTickInTickarrayBitmap(e),n=-t;return t>we&&(t=z.getArrayStartIndex(we,e)+z.tickCount(e)),n<Pe&&(n=z.getArrayStartIndex(Pe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/z.tickCount(t)*Ye}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await St(e,t.map(o=>({pubkey:o})),{batchRequest:n}),a={};for(let o of i)o.accountInfo!==null&&(a[o.pubkey.toString()]=Pi.decode(o.accountInfo.data));return a}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},a=[];for(let s of t){let l=K.getTickArrayStartIndexByTick(s.tickCurrent,s.tickSpacing),p=K.getInitializedTickArrayInRange(s.tickArrayBitmap,s.exBitmapInfo,s.tickSpacing,l,7);for(let b of p){let{publicKey:g}=Z(s.programId,s.id,b);a.push({pubkey:g}),i[g.toString()]=s.id}}let o=await St(e,a,{batchRequest:n}),r={};for(let s of o){if(!s.accountInfo)continue;let l=i[s.pubkey.toString()];if(!l)continue;r[l.toString()]===void 0&&(r[l.toString()]={});let p=ht.decode(s.accountInfo.data);r[l.toString()][p.startTickIndex]=$(Y({},p),{address:s.pubkey})}return r}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:a=!0}){var r;let o=[];for(let s=0;s<e.length;s++){let l=e[s];l!==null&&(o.find(p=>p.equals(l.state.programId))||o.push(l.state.programId))}if(n){let s=n.tokenAccounts.map(g=>g.accountInfo.mint),l=[];for(let g of s)for(let u of o)l.push(he(u,g).publicKey);let p=await Ue(t,l,{batchRequest:i}),b={};for(let g of p){if(g===null)continue;let u=kn.decode(g.data),k=u.poolId.toString(),m=e.find(L=>L.state.id.toBase58()===k);if(m===void 0)continue;let c=m.state,d=K._getTickPriceLegacy({poolInfo:c,tick:u.tickLower,baseIn:!0}),h=K._getTickPriceLegacy({poolInfo:c,tick:u.tickUpper,baseIn:!0}),{amountA:I,amountB:R}=Q.getAmountsFromLiquidity(c.sqrtPriceX64,d.tickSqrtPriceX64,h.tickSqrtPriceX64,u.liquidity,!1),W=1/(1-Math.sqrt(Math.sqrt(d.price.div(h.price).toNumber())));m.positionAccount=[...(r=m.positionAccount)!=null?r:[],{poolId:u.poolId,nftMint:u.nftMint,priceLower:d.price,priceUpper:h.price,amountA:I,amountB:R,tickLower:u.tickLower,tickUpper:u.tickUpper,liquidity:u.liquidity,feeGrowthInsideLastX64A:u.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:u.feeGrowthInsideLastX64B,tokenFeesOwedA:u.tokenFeesOwedA,tokenFeesOwedB:u.tokenFeesOwedB,rewardInfos:u.rewardInfos.map(L=>$(Y({},L),{pendingReward:new ne.default(0)})),leverage:W,tokenFeeAmountA:new ne.default(0),tokenFeeAmountB:new ne.default(0)}];let T=await K.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickLower,m.state.tickSpacing),S=await K.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickUpper,m.state.tickSpacing);b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickLower}`]=T,b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickUpper}`]=S}if(a){let g=Object.values(b),u=await Ue(t,g,{batchRequest:i}),k={};for(let m=0;m<g.length;m++){let c=u[m];if(c===null)continue;let d=g[m].toString();k[d]=ht.decode(c.data)}for(let{state:m,positionAccount:c}of e)if(!!c)for(let d of c){let h=`${m.programId.toString()}-${m.id.toString()}-${d.tickLower}`,I=`${m.programId.toString()}-${m.id.toString()}-${d.tickUpper}`,R=k[b[h].toString()],W=k[b[I].toString()],T=R.ticks[K.getTickOffsetInArray(d.tickLower,m.tickSpacing)],S=W.ticks[K.getTickOffsetInArray(d.tickUpper,m.tickSpacing)],{tokenFeeAmountA:L,tokenFeeAmountB:D}=await Tt.GetPositionFees(m,d,T,S),B=await Tt.GetPositionRewards(m,d,T,S);d.tokenFeeAmountA=L.gte(new ne.default(0))?L:new ne.default(0),d.tokenFeeAmountB=D.gte(new ne.default(0))?D:new ne.default(0);for(let _=0;_<B.length;_++)d.rewardInfos[_].pendingReward=B[_].gte(new ne.default(0))?B[_]:new ne.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:a,slippage:o,priceLimit:r=new U.default(0),catchLiquidityInsufficient:s=!1}){var be;let l,p=n.toBase58()===e.mintA.address,[b,g]=p?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];r.equals(new U.default(0))?l=p?Ve.add(new ne.default(1)):ve.sub(new ne.default(1)):l=v.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let u=se(a,b,i,!1),{allTrade:k,expectedAmountOut:m,remainingAccounts:c,executionPrice:d,feeAmount:h}=ae.getOutputAmountAndRemainAccounts(e,t,n,u.amount.sub((be=u.fee)!=null?be:re),l,s),I=se(m,g,i,!1),R=v.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),W=p?R:new U.default(1).div(R),T=m.mul(new ne.default(Math.floor((1-o)*1e10))).div(new ne.default(1e10)),S=se(T,g,i,!1),L=p?e.currentPrice:new U.default(1).div(e.currentPrice),D=new U.default(W).sub(L).abs(),B=L,_=new _e(new U.default(D).mul(10**15).toFixed(0),new U.default(B).mul(10**15).toFixed(0));return{allTrade:k,realAmountIn:u,amountOut:I,minAmountOut:S,expirationTime:He(u.expirationTime,I.expirationTime),currentPrice:e.currentPrice,executionPrice:W,priceImpact:_,fee:h,remainingAccounts:c,executionPriceX64:d}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:a,epochInfo:o,catchLiquidityInsufficient:r=!1}){let s=i.address===e.mintB.address,[l,p]=s?[e.mintA,e.mintB]:[e.mintB,e.mintA],[b,g]=[new Ne($(Y({},l),{mint:l.address,isToken2022:l.programId===yn.TOKEN_2022_PROGRAM_ID.toBase58()})),new Ne($(Y({},p),{mint:p.address,isToken2022:p.programId===yn.TOKEN_2022_PROGRAM_ID.toBase58()}))],{allTrade:u,realAmountIn:k,amountOut:m,minAmountOut:c,expirationTime:d,currentPrice:h,executionPrice:I,priceImpact:R,fee:W,remainingAccounts:T,executionPriceX64:S}=ae.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Be.PublicKey(l.address),amountIn:n,slippage:a,epochInfo:o,catchLiquidityInsufficient:r}),L=$(Y({},k),{amount:new pe(b,k.amount),fee:k.fee===void 0?void 0:new pe(b,k.fee)}),D=$(Y({},m),{amount:new pe(g,m.amount),fee:m.fee===void 0?void 0:new pe(g,m.fee)}),B=$(Y({},c),{amount:new pe(g,c.amount),fee:c.fee===void 0?void 0:new pe(g,c.fee)}),_=new Le({baseToken:b,denominator:new ne.default(10).pow(new ne.default(20+b.decimals)),quoteToken:g,numerator:h.mul(new U.default(10**(20+g.decimals))).toFixed(0)}),be=new Le({baseToken:b,denominator:new ne.default(10).pow(new ne.default(20+b.decimals)),quoteToken:g,numerator:I.mul(new U.default(10**(20+g.decimals))).toFixed(0)}),ue=new pe(b,W);return{allTrade:u,realAmountIn:L,amountOut:D,minAmountOut:B,expirationTime:d,currentPrice:_,executionPrice:be,priceImpact:R,fee:ue,remainingAccounts:T,executionPriceX64:S}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:a,slippage:o,priceLimit:r=new U.default(0)}){var B;let s=n.toBase58()===e.mintA.address,l={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},p;r.equals(new U.default(0))?p=s?ve.sub(new ne.default(1)):Ve.add(new ne.default(1)):p=v.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let b=se(a,l[n.toString()],i,!0),{expectedAmountIn:g,remainingAccounts:u,executionPrice:k,feeAmount:m}=ae.getInputAmountAndRemainAccounts(e,t,n,b.amount.sub((B=b.fee)!=null?B:re),p),c=s?e.mintB.address:e.mintA.address,d=se(g,l[c],i,!1),h=v.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),I=s?h:new U.default(1).div(h),R=g.mul(new ne.default(Math.floor((1+o)*1e10))).div(new ne.default(1e10)),W=se(R,l[c],i,!0),T=s?e.currentPrice:new U.default(1).div(e.currentPrice),S=new U.default(I).sub(T).abs(),L=T,D=new _e(new U.default(S).mul(10**15).toFixed(0),new U.default(L).mul(10**15).toFixed(0));return{amountIn:d,maxAmountIn:W,realAmountOut:b,expirationTime:He(d.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:I,priceImpact:D,fee:m,remainingAccounts:u}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var k,m,c;let a=e[t],o=K.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),r=K.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),s=Math.max(o,a.priceMin),p=Math.min(r,a.priceMax)-s,b=r-o,g=a.priceMax-a.priceMin,u;return p<=0?u=0:b===p?u=g/p:g===p?u=p/b:u=p/g*(p/b),{feeApr:a.feeApr*u,rewardsApr:[((k=a.rewardApr[0])!=null?k:0)*u,((m=a.rewardApr[1])!=null?m:0)*u,((c=a.rewardApr[2])!=null?c:0)*u],apr:a.apr*u}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:a,positionTickLowerIndex:o,positionTickUpperIndex:r,chainTime:s}){let l=n==="day"?1:n==="week"?7:n==="month"?30:0,p=e[n],b=i[pt(e.mintA.address).toString()],g=i[pt(e.mintB.address).toString()],u=e.mintA.decimals,k=e.mintB.decimals;if(!p||!b||!g)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let m=v.priceToSqrtPriceX64(new U.default(e.price),e.mintA.decimals,e.mintB.decimals),c=v.getSqrtPriceX64FromTick(o),d=v.getSqrtPriceX64FromTick(r),{amountSlippageA:h,amountSlippageB:I}=Q.getAmountsFromLiquidityWithSlippage(m,c,d,t,!1,!1,0),{amountSlippageA:R,amountSlippageB:W}=Q.getAmountsFromLiquidityWithSlippage(m,c,d,a,!1,!1,0),T=new U.default(h.toString()).div(new U.default(10).pow(u)).mul(b.value).add(new U.default(I.toString()).div(new U.default(10).pow(k)).mul(g.value)),S=new U.default(R.toString()).div(new U.default(10).pow(u)).mul(b.value).add(new U.default(W.toString()).div(new U.default(10).pow(k)).mul(g.value)),L=new U.default(1).div(T.add(S)),B=new U.default(p.volumeFee).mul(365).div(l).mul(L).mul(100).toNumber(),_=3600*24*365,be=e.rewardDefaultInfos.map(ue=>{var Bn,In;let Te=ue.mint.decimals,nt=i[ue.mint.address];return s<((Bn=ue.startTime)!=null?Bn:0)||s>((In=ue.endTime)!=null?In:0)||!ue.perSecond||!nt||Te===void 0?0:new U.default(nt.value).mul(new U.default(ue.perSecond).mul(_)).div(new U.default(10).pow(Te)).mul(L).mul(100).toNumber()});return{feeApr:B,rewardsApr:be,apr:B+be.reduce((ue,Te)=>ue+Te,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:a,slippage:o,add:r,epochInfo:s,amountHasFee:l}){var d,h;let p=v.priceToSqrtPriceX64(new U.default(e.price),e.mintA.decimals,e.mintB.decimals),b=v.getSqrtPriceX64FromTick(n),g=v.getSqrtPriceX64FromTick(i),u=se(a,(d=e[t?"mintA":"mintB"].extensions)==null?void 0:d.feeConfig,s,!l),k=new ne.default(new U.default(u.amount.sub((h=u.fee)!=null?h:re).toString()).toFixed(0)),m;if(p.lte(b))m=t?Q.getLiquidityFromTokenAmountA(b,g,k,!r):new ne.default(0);else if(p.lte(g)){let I=Q.getLiquidityFromTokenAmountA(p,g,k,!r),R=Q.getLiquidityFromTokenAmountB(b,p,k);m=t?I:R}else m=t?new ne.default(0):Q.getLiquidityFromTokenAmountB(b,g,k);let c=await ae.getAmountsFromLiquidity({epochInfo:s,poolInfo:e,tickLower:n,tickUpper:i,liquidity:m,slippage:o,add:r});return{liquidity:m,amountA:t?u:c.amountA,amountB:t?c.amountB:u,amountSlippageA:t?u:c.amountSlippageA,amountSlippageB:t?c.amountSlippageB:u,expirationTime:c.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:a,slippage:o,add:r}){var c,d,h,I;let s=v.getSqrtPriceX64FromTick(n),l=v.getSqrtPriceX64FromTick(i),p=r?1+o:1-o,b=Q.getAmountsFromLiquidity(v.priceToSqrtPriceX64(new U.default(t.price),t.mintA.decimals,t.mintB.decimals),s,l,a,r),[g,u]=[se(b.amountA,(c=t.mintA.extensions)==null?void 0:c.feeConfig,e,!0),se(b.amountB,(d=t.mintB.extensions)==null?void 0:d.feeConfig,e,!0)],[k,m]=[se(b.amountA.muln(p),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),se(b.amountB.muln(p),(I=t.mintB.extensions)==null?void 0:I.feeConfig,e,!0)];return{liquidity:a,amountA:g,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:He(g.expirationTime,u.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(s=>!n[s.id]).map(s=>new Be.PublicKey(s.id));(await Ue(e,i)).forEach((s,l)=>{!s||(n[i[l].toBase58()]=gn.decode(s.data))});let o=t.map(s=>le(new Be.PublicKey(s.programId),new Be.PublicKey(s.id)).publicKey),r=await ae.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((s,l)=>$(Y({},s),{[l.id]:$(Y({},n[l.id]),{id:new Be.PublicKey(l.id),version:6,programId:new Be.PublicKey(l.programId),mintA:l.mintA,mintB:l.mintB,ammConfig:$(Y({},l.config),{id:new Be.PublicKey(l.config.id),fundOwner:""}),currentPrice:new U.default(l.price),exBitmapAccount:le(new Be.PublicKey(l.programId),new Be.PublicKey(l.id)).publicKey,exBitmapInfo:r[le(new Be.PublicKey(l.programId),new Be.PublicKey(l.id)).publicKey.toBase58()],startTime:n[l.id].startTime.toNumber(),rewardInfos:n[l.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var q=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),a=i.div(n);return i.mod(n).eq(re)||(a=a.add(Se)),a}static mulDivFloor(e,t,n){if(n.eq(re))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(re))throw new Error("division by 0");return e.mul(t).add(n.sub(Se)).div(n)}static x64ToDecimal(e,t){return new Oe.default(e.toString()).div(Oe.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new G.default(e.mul(Oe.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Et).sub(t).mod(Et)}};function fe(y,e){return Pn(y.mul(e),64,256)}function Rr(y,e,t){let n=y.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Pn(y,e,t){let n=y.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var v=class{static sqrtPriceX64ToPrice(e,t,n){return q.x64ToDecimal(e).pow(2).mul(Oe.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return q.decimalToX64(e.mul(Oe.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(re))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(re))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(re))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(re))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(re))return e;let a=t.shln(At);if(i){let o=a,r=a.add(n.mul(e));return r.gte(o)?q.mulDivCeil(o,e,r):q.mulDivRoundingUp(o,Se,o.div(e).add(n))}else{let o=n.mul(e);if(!a.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let r=a.sub(o);return q.mulDivCeil(a,e,r)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let a=n.shln(At);if(i)return e.add(a.div(t));{let o=q.mulDivRoundingUp(a,Se,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Pe||e>we)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new G.default("18445821805675395072"):new G.default("18446744073709551616");return(t&2)!=0&&(n=fe(n,new G.default("18444899583751176192"))),(t&4)!=0&&(n=fe(n,new G.default("18443055278223355904"))),(t&8)!=0&&(n=fe(n,new G.default("18439367220385607680"))),(t&16)!=0&&(n=fe(n,new G.default("18431993317065453568"))),(t&32)!=0&&(n=fe(n,new G.default("18417254355718170624"))),(t&64)!=0&&(n=fe(n,new G.default("18387811781193609216"))),(t&128)!=0&&(n=fe(n,new G.default("18329067761203558400"))),(t&256)!=0&&(n=fe(n,new G.default("18212142134806163456"))),(t&512)!=0&&(n=fe(n,new G.default("17980523815641700352"))),(t&1024)!=0&&(n=fe(n,new G.default("17526086738831433728"))),(t&2048)!=0&&(n=fe(n,new G.default("16651378430235570176"))),(t&4096)!=0&&(n=fe(n,new G.default("15030750278694412288"))),(t&8192)!=0&&(n=fe(n,new G.default("12247334978884435968"))),(t&16384)!=0&&(n=fe(n,new G.default("8131365268886854656"))),(t&32768)!=0&&(n=fe(n,new G.default("3584323654725218816"))),(t&65536)!=0&&(n=fe(n,new G.default("696457651848324352"))),(t&131072)!=0&&(n=fe(n,new G.default("26294789957507116"))),(t&262144)!=0&&(n=fe(n,new G.default("37481735321082"))),e>0&&(n=ai.div(n)),n}static getTickFromPrice(e,t,n){return v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ve)||e.lt(Ve))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new G.default(t-64),i=Rr(n,32,128),a=new G.default("8000000000000000","hex"),o=0,r=new G.default(0),s=t>=64?e.shrn(t-63):e.shln(63-t);for(;a.gt(new G.default(0))&&o<ui;){s=s.mul(s);let k=s.shrn(127);s=s.shrn(63+k.toNumber()),r=r.add(a.mul(k)),a=a.shrn(1),o+=1}let l=r.shrn(32),b=i.add(l).mul(new G.default(ci)),g=Pn(b.sub(new G.default(li)),64,128).toNumber(),u=Pn(b.add(new G.default(mi)),64,128).toNumber();return g==u?g:v.getSqrtPriceX64FromTick(u).lte(e)?u:g}},$e=class{static getTickWithPriceAndTickspacing(e,t,n,i){let o=v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,n,i))/t;return o<0?o=Math.floor(o):o=Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,i){let a=$e.getTickWithPriceAndTickspacing(e,t,n,i),o=v.getSqrtPriceX64FromTick(a);return v.sqrtPriceX64ToPrice(o,n,i)}},Q=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(re))throw new Error("sqrtPriceX64A must greater than 0");let a=n.ushln(At),o=t.sub(e);return i?q.mulDivRoundingUp(q.mulDivCeil(a,o,t),Se,e):q.mulDivFloor(a,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(re))throw new Error("sqrtPriceX64A must greater than 0");return i?q.mulDivCeil(n,t.sub(e),Ke):q.mulDivFloor(n,t.sub(e),Ke)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let a=n.mul(e).mul(t),o=t.sub(e),r=a.div(o);return i?q.mulDivRoundingUp(r,Se,cn):r.shrn(At)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),q.mulDivFloor(n,cn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Q.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let o=Q.getLiquidityFromTokenAmountA(e,n,i,!1),r=Q.getLiquidityFromTokenAmountB(t,e,a);return o.lt(r)?o:r}else return Q.getLiquidityFromTokenAmountB(t,n,a)}static getAmountsFromLiquidity(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Q.getTokenAmountAFromLiquidity(t,n,i,a),amountB:new G.default(0)};if(e.lt(n)){let o=Q.getTokenAmountAFromLiquidity(e,n,i,a),r=Q.getTokenAmountBFromLiquidity(t,e,i,a);return{amountA:o,amountB:r}}else return{amountA:new G.default(0),amountB:Q.getTokenAmountBFromLiquidity(t,n,i,a)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,a,o,r){let{amountA:s,amountB:l}=Q.getAmountsFromLiquidity(e,t,n,i,o),p=a?1+r:1-r,b=new G.default(new Oe.default(s.toString()).mul(p).toFixed(0)),g=new G.default(new Oe.default(l.toString()).mul(p).toFixed(0));return{amountSlippageA:b,amountSlippageB:g}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:a,add:o,epochInfo:r,amountAddFee:s}){var h,I,R,W;let l=v.priceToSqrtPriceX64(new Oe.default(e.price),e.mintA.decimals,e.mintB.decimals),p=v.getSqrtPriceX64FromTick(t),b=v.getSqrtPriceX64FromTick(n),g=o?1+a:1-a,u=Q.getAmountsFromLiquidity(l,p,b,i,o),[k,m]=[se(u.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,r,s),se(u.amountB,(I=e.mintB.extensions)==null?void 0:I.feeConfig,r,s)],[c,d]=[se(new G.default(new Oe.default(u.amountA.toString()).mul(g).toFixed(0)),(R=e.mintA.extensions)==null?void 0:R.feeConfig,r,s),se(new G.default(new Oe.default(u.amountB.toString()).mul(g).toFixed(0)),(W=e.mintB.extensions)==null?void 0:W.feeConfig,r,s)];return{liquidity:i,amountA:k,amountB:m,amountSlippageA:c,amountSlippageB:d,expirationTime:He(k.expirationTime,m.expirationTime)}}},Je=class{static swapCompute(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m=!1){if(g.eq(re))throw new Error("amountSpecified must not be 0");if(k||(k=o?Ve.add(Se):ve.sub(Se)),o){if(k.lt(Ve))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(k.gte(b))throw new Error("sqrtPriceX64 must smaller than current")}else{if(k.gt(ve))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(k.lte(b))throw new Error("sqrtPriceX64 must greater than current")}let c=g.gt(re),d={amountSpecifiedRemaining:g,amountCalculated:re,sqrtPriceX64:b,tick:l>u?Math.min(u+z.tickCount(p)-1,l):u,accounts:[],liquidity:s,feeAmount:new G.default(0)},h=u,I=n[u],R=0,W=!o&&I.startTickIndex===d.tick;for(;!d.amountSpecifiedRemaining.eq(re)&&!d.sqrtPriceX64.eq(k);){R>10;let T={};T.sqrtPriceStartX64=d.sqrtPriceX64;let S=K.nextInitTick(I,d.tick,p,o,W),L=S||null,D=null;if(!(L!=null&&L.liquidityGross.gtn(0))){let _=ae.nextInitializedTickArrayStartIndex({tickCurrent:d.tick,tickSpacing:p,tickArrayBitmap:i,exBitmapInfo:a},h,o);if(!_.isExist){if(m)return{allTrade:!1,amountSpecifiedRemaining:d.amountSpecifiedRemaining,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts};throw Error("swapCompute LiquidityInsufficient")}h=_.nextStartIndex;let{publicKey:be}=Z(e,t,h);D=be,I=n[h];try{L=K.firstInitializedTick(I,o)}catch{throw Error("not found next tick info")}}T.tickNext=L.tick,T.initialized=L.liquidityGross.gtn(0),u!==h&&D&&(d.accounts.push(D),u=h),T.tickNext<Pe?T.tickNext=Pe:T.tickNext>we&&(T.tickNext=we),T.sqrtPriceNextX64=v.getSqrtPriceX64FromTick(T.tickNext);let B;if(o&&T.sqrtPriceNextX64.lt(k)||!o&&T.sqrtPriceNextX64.gt(k)?B=k:B=T.sqrtPriceNextX64,[d.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=Je.swapStepCompute(d.sqrtPriceX64,B,d.liquidity,d.amountSpecifiedRemaining,r,o),d.feeAmount=d.feeAmount.add(T.feeAmount),c?(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),d.amountCalculated=d.amountCalculated.sub(T.amountOut)):(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.add(T.amountOut),d.amountCalculated=d.amountCalculated.add(T.amountIn.add(T.feeAmount))),d.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let _=L.liquidityNet;o&&(_=_.mul(De)),d.liquidity=Q.addDelta(d.liquidity,_)}W=T.tickNext!=d.tick&&!o&&I.startTickIndex===T.tickNext,d.tick=o?T.tickNext-1:T.tickNext}else if(d.sqrtPriceX64!=T.sqrtPriceStartX64){let _=v.getTickFromSqrtPriceX64(d.sqrtPriceX64);W=_!=d.tick&&!o&&I.startTickIndex===_,d.tick=_}++R}try{let{nextStartIndex:T,isExist:S}=z.nextInitializedTickArray(d.tick,p,o,i,a);S&&u!==T&&(d.accounts.push(Z(e,t,T).publicKey),u=T)}catch{}return{allTrade:!0,amountSpecifiedRemaining:re,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts}}static swapStepCompute(e,t,n,i,a,o){let r={sqrtPriceX64Next:new G.default(0),amountIn:new G.default(0),amountOut:new G.default(0),feeAmount:new G.default(0)},s=i.gte(re);if(s){let p=q.mulDivFloor(i,_t.sub(new G.default(a.toString())),_t);r.amountIn=o?Q.getTokenAmountAFromLiquidity(t,e,n,!0):Q.getTokenAmountBFromLiquidity(e,t,n,!0),p.gte(r.amountIn)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=v.getNextSqrtPriceX64FromInput(e,n,p,o)}else r.amountOut=o?Q.getTokenAmountBFromLiquidity(t,e,n,!1):Q.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(De).gte(r.amountOut)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=v.getNextSqrtPriceX64FromOutput(e,n,i.mul(De),o);let l=t.eq(r.sqrtPriceX64Next);return o?(l&&s||(r.amountIn=Q.getTokenAmountAFromLiquidity(r.sqrtPriceX64Next,e,n,!0)),l&&!s||(r.amountOut=Q.getTokenAmountBFromLiquidity(r.sqrtPriceX64Next,e,n,!1))):(r.amountIn=l&&s?r.amountIn:Q.getTokenAmountBFromLiquidity(e,r.sqrtPriceX64Next,n,!0),r.amountOut=l&&!s?r.amountOut:Q.getTokenAmountAFromLiquidity(e,r.sqrtPriceX64Next,n,!1)),!s&&r.amountOut.gt(i.mul(De))&&(r.amountOut=i.mul(De)),s&&!r.sqrtPriceX64Next.eq(t)?r.feeAmount=i.sub(r.amountIn):r.feeAmount=q.mulDivCeil(r.amountIn,new G.default(a),_t.sub(new G.default(a))),[r.sqrtPriceX64Next,r.amountIn,r.amountOut,r.feeAmount]}};var me=60,Ye=512,K=class{static getTickArrayAddressByTick(e,t,n,i){let a=K.getTickArrayStartIndexByTick(n,i),{publicKey:o}=Z(e,t,a);return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=K.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=me)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=z.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*me,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*me,a=Math.floor(t/i)+512,o=Math.abs(a);return{isInitialized:e.testn(o),startIndex:(o-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*me:e+t*me}static mergeTickArrayBitmap(e){let t=new Ai.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,a){let o=Math.floor(i/(n*me));return[...K.searchLowBitFromStart(e,t,o-1,a,n),...K.searchHightBitFromStart(e,t,o,a,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return K.searchHightBitFromStart(e,t,-7680,Ye,n)}static getAllInitializedTickArrayInfo(e,t,n,i,a){let o=[],r=K.getAllInitializedTickArrayStartIndex(n,i,a);for(let s of r){let{publicKey:l}=Z(e,t,s);o.push({tickArrayStartIndex:s,tickArrayAddress:l})}return o}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>K.mergeTickArrayBitmap(l)),r=[];for(;n>=-7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n--,r.length===i)break}let s=z.tickCount(a);return r.map(l=>l*s)}static searchHightBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>K.mergeTickArrayBitmap(l)),r=[];for(;n<7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n++,r.length===i)break}let s=z.tickCount(a);return r.map(l=>l*s)}static checkIsOutOfBoundary(e){return e<Pe||e>we}static nextInitTick(e,t,n,i,a){if(z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let r=Math.floor((t-e.startTickIndex)/n);if(i)for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r-1}else for(a||(r=r+1);r<me;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r+1}return null}static firstInitializedTick(e,t){if(t){let n=me-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<me;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),a=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new et.default(1).div(a),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new et.default(1).div(t),a=$e.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=v.getSqrtPriceX64FromTick(a),r=v.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new et.default(1).div(r)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),a=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new et.default(1).div(a),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new et.default(1).div(t),a=$e.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=v.getSqrtPriceX64FromTick(a),r=v.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new et.default(1).div(r)}}};var Nr=F([ke(8),V("bump"),Ze("index"),x(""),at("protocolFeeRate"),at("tradeFeeRate"),Ze("tickSpacing"),X(P(),8,"")]),Mr=F([at("blockTimestamp"),ri("tickCumulative"),X(P(),4)]),wi=F([ke(8),de("initialized"),P("recentEpoch"),Ze("observationIndex"),x("poolId"),X(Mr,100,"observations"),X(P(),4)]),Or=F([V("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),E("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),x("tokenMint"),x("tokenVault"),x("creator"),E("rewardGrowthGlobalX64")]),gn=F([ke(8),V("bump"),x("ammConfig"),x("creator"),x("mintA"),x("mintB"),x("vaultA"),x("vaultB"),x("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),Ze("tickSpacing"),E("liquidity"),E("sqrtPriceX64"),ie("tickCurrent"),at(),E("feeGrowthGlobalX64A"),E("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),E("swapInAmountTokenA"),E("swapOutAmountTokenB"),E("swapInAmountTokenB"),E("swapOutAmountTokenA"),V("status"),X(V(),7,""),X(Or,3,"rewardInfos"),X(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),X(P(),15*4-3,"padding")]),Wr=F([E("growthInsideLastX64"),P("rewardAmountOwed")]),kn=F([ke(8),V("bump"),x("nftMint"),x("poolId"),ie("tickLower"),ie("tickUpper"),E("liquidity"),E("feeGrowthInsideLastX64A"),E("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),X(Wr,3,"rewardInfos"),X(P(),8,"")]),Ic=F([ke(8),V("bump"),x("poolId"),ie("tickLowerIndex"),ie("tickUpperIndex"),E("liquidity"),E("feeGrowthInsideLastX64A"),E("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),X(E(),3,"rewardGrowthInside"),X(P(),8,"")]),Fr=F([ie("tick"),oi("liquidityNet"),E("liquidityGross"),E("feeGrowthOutsideX64A"),E("feeGrowthOutsideX64B"),X(E(),3,"rewardGrowthsOutsideX64"),X(at(),13,"")]),ht=F([ke(8),x("poolId"),ie("startTickIndex"),X(Fr,me,"ticks"),V("initializedTickCount"),X(V(),115,"")]),Er=F([ke(329),X(x(),100,"whitelistMints")]),Pi=F([ke(8),x("poolId"),X(X(P(),8),bn,"positiveTickArrayBitmap"),X(X(P(),8),bn,"negativeTickArrayBitmap")]),xc=F([P(),V("bump"),x("owner"),x("poolId"),x("positionId"),x("nftAccount"),X(P(),8)]),Vr=F([ke(8),V("bump"),x("lockOwner"),x("poolId"),x("positionId"),x("nftAccount"),x("lockNftMint"),P("recentEpoch"),X(P(),8)]);wi.span;var Ti=ce("Raydium_Clmm"),Ce={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},hi=[188,37,179,131,82,150,84,73],Bi=[16,72,250,198,14,162,212,19],tt=class{static createPoolInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k){let m=F([E("sqrtPriceX64"),P("zero")]),c=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Fe,isSigner:!1,isWritable:!1},...(k==null?void 0:k.map(I=>({pubkey:I,isSigner:!1,isWritable:!1})))||[]],d=Buffer.alloc(m.span);m.encode({sqrtPriceX64:u,zero:re},d);let h=Buffer.from([...Ce.createPool,...d]);return new w.TransactionInstruction({keys:c,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:a,ammConfigId:o,initialPriceX64:r,extendMintAccount:s}=e,[l,p]=[new w.PublicKey(i.address),new w.PublicKey(a.address)],{publicKey:b}=bi(t,o,l,p),{publicKey:g}=gi(t,b),{publicKey:u}=pn(t,b,l),{publicKey:k}=pn(t,b,p),m=le(t,b).publicKey,c=[this.createPoolInstruction(t,b,n,o,g,l,u,new w.PublicKey(i.programId||C.TOKEN_PROGRAM_ID),p,k,new w.PublicKey(a.programId||C.TOKEN_PROGRAM_ID),m,r,s)];return{signers:[],instructions:c,instructionTypes:[ee.CreateAccount,ee.ClmmCreatePool],address:{poolId:b,observationId:g,exBitmapAccount:m,mintAVault:u,mintBVault:k},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,I,R,W,T,S,L,D,B){let _=F([ie("tickLowerIndex"),ie("tickUpperIndex"),ie("tickArrayLowerStartIndex"),ie("tickArrayUpperStartIndex"),E("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),V("optionBaseFlag"),de("baseFlag")]),be=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],ue=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...be],Te=Buffer.alloc(_.span);_.encode({tickLowerIndex:h,tickUpperIndex:I,tickArrayLowerStartIndex:R,tickArrayUpperStartIndex:W,liquidity:T,amountMaxA:S,amountMaxB:L,withMetadata:D==="create",baseFlag:!1,optionBaseFlag:0},Te);let nt=Buffer.from([...Ce.openPosition,...Te]);return new w.TransactionInstruction({keys:ue,programId:e,data:nt})}static openPositionFromLiquidityInstruction22(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,I,R,W,T,S,L,D){let B=F([ie("tickLowerIndex"),ie("tickUpperIndex"),ie("tickArrayLowerStartIndex"),ie("tickArrayUpperStartIndex"),E("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),V("optionBaseFlag"),de("baseFlag")]),_=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],be=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},..._],ue=Buffer.alloc(B.span);B.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:R,liquidity:W,amountMaxA:T,amountMaxB:S,withMetadata:L==="create",baseFlag:!1,optionBaseFlag:0},ue);let Te=Buffer.from([...Ce.openPositionWithTokenEx,...ue]);return new w.TransactionInstruction({keys:be,programId:e,data:Te})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g=[],[u,k]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],m;if(p)m=new w.PublicKey((await p(1))[0]);else{let D=w.Keypair.generate();g.push(D),m=D.publicKey}let c=K.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Z(u,k,c),{publicKey:I}=Z(u,k,d),{publicKey:R}=b?te(n.wallet,m,C.TOKEN_2022_PROGRAM_ID):te(n.wallet,m,C.TOKEN_PROGRAM_ID),{publicKey:W}=ut(m),{publicKey:T}=he(u,m),{publicKey:S}=qe(u,k,i,a),L=b?this.openPositionFromLiquidityInstruction22(u,n.feePayer,k,n.wallet,m,R,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0):this.openPositionFromLiquidityInstruction(u,n.feePayer,k,n.wallet,m,R,W,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0);return{signers:g,instructions:[L],instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:m,tickArrayLower:h,tickArrayUpper:I,positionNftAccount:R,metadataAccount:W,personalPosition:T,protocolPosition:S}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,base:o,baseAmount:r,otherAmountMax:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g=[],[u,k]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],m;if(p)m=new w.PublicKey((await p(1))[0]);else{let D=w.Keypair.generate();g.push(D),m=D.publicKey}let c=K.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Z(u,k,c),{publicKey:I}=Z(u,k,d),{publicKey:R}=b?te(n.wallet,m,C.TOKEN_2022_PROGRAM_ID):te(n.wallet,m,C.TOKEN_PROGRAM_ID),{publicKey:W}=ut(m),{publicKey:T}=he(u,m),{publicKey:S}=qe(u,k,i,a),L=b?this.openPositionFromBaseInstruction22(u,n.feePayer,k,n.wallet,m,R,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,l,o,r,s,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0):this.openPositionFromBaseInstruction(u,n.feePayer,k,n.wallet,m,R,W,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,l,o,r,s,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:h,tickArrayUpper:I,positionNftAccount:R,metadataAccount:W,personalPosition:T,protocolPosition:S},instructions:[L],signers:g,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,I,R,W,T,S,L,D,B){let _=F([ie("tickLowerIndex"),ie("tickUpperIndex"),ie("tickArrayLowerStartIndex"),ie("tickArrayUpperStartIndex"),E("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),V("optionBaseFlag"),de("baseFlag")]),be=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],ue=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...be],Te=Buffer.alloc(_.span);_.encode({tickLowerIndex:h,tickUpperIndex:I,tickArrayLowerStartIndex:R,tickArrayUpperStartIndex:W,liquidity:new Ut.default(0),amountMaxA:S==="MintA"?L:D,amountMaxB:S==="MintA"?D:L,withMetadata:T==="create",baseFlag:S==="MintA",optionBaseFlag:1},Te);let nt=Buffer.from([...Ce.openPosition,...Te]);return new w.TransactionInstruction({keys:ue,programId:e,data:nt})}static openPositionFromBaseInstruction22(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,I,R,W,T,S,L,D){let B=F([ie("tickLowerIndex"),ie("tickUpperIndex"),ie("tickArrayLowerStartIndex"),ie("tickArrayUpperStartIndex"),E("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),V("optionBaseFlag"),de("baseFlag")]),_=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],be=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},..._],ue=Buffer.alloc(B.span);B.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:R,liquidity:new Ut.default(0),amountMaxA:T==="MintA"?S:L,amountMaxB:T==="MintA"?L:S,withMetadata:W==="create",baseFlag:T==="MintA",optionBaseFlag:1},ue);let Te=Buffer.from([...Ce.openPositionWithTokenEx,...ue]);return new w.TransactionInstruction({keys:be,programId:e,data:Te})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g,u=[];if(p)g=new w.PublicKey((await p(1))[0]);else{let D=w.Keypair.generate();u.push(D),g=D.publicKey}let[k,m]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],c=K.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Z(k,m,c),{publicKey:I}=Z(k,m,d),{publicKey:R}=b?te(n.wallet,g,C.TOKEN_2022_PROGRAM_ID):te(n.wallet,g,C.TOKEN_PROGRAM_ID),{publicKey:W}=ut(g),{publicKey:T}=he(k,g),{publicKey:S}=qe(k,m,i,a),L=b?this.openPositionFromLiquidityInstruction22(k,n.wallet,m,n.wallet,g,R,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(t.mintA.address),new w.PublicKey(t.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(k,m).publicKey:void 0):this.openPositionFromLiquidityInstruction(k,n.wallet,m,n.wallet,g,R,W,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(t.mintA.address),new w.PublicKey(t.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(k,m).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:h,tickArrayUpper:I,positionNftAccount:R,metadataAccount:W,personalPosition:T,protocolPosition:S},instructions:[L],signers:u,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,a,o){let r=F([]),s=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:o?C.TOKEN_2022_PROGRAM_ID:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],l=Buffer.alloc(r.span);r.encode({},l);let p=Buffer.from([...Ce.closePosition,...l]);return new w.TransactionInstruction({keys:s,programId:e,data:p})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:a}){let o=new w.PublicKey(e.programId),r=a?te(n.wallet,i.nftMint,C.TOKEN_2022_PROGRAM_ID).publicKey:te(n.wallet,i.nftMint,C.TOKEN_PROGRAM_ID).publicKey,{publicKey:s}=he(o,i.nftMint),l=[];return l.push(this.closePositionInstruction(o,n.wallet,i.nftMint,r,s,a)),{address:{positionNftAccount:r,personalPosition:s},signers:[],instructions:l,instructionTypes:[ee.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h){let I=F([E("liquidity"),P("amountMaxA"),P("amountMaxB"),V("optionBaseFlag"),de("baseFlag")]),R=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...R],T=Buffer.alloc(I.span);I.encode({liquidity:m,amountMaxA:c,amountMaxB:d,optionBaseFlag:0,baseFlag:!1},T);let S=Buffer.from([...Ce.increaseLiquidity,...T]);return new w.TransactionInstruction({keys:W,programId:e,data:S})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMaxA:o,amountMaxB:r,nft2022:s}){let[l,p]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],b=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),g=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Z(l,p,b),{publicKey:k}=Z(l,p,g),{publicKey:m}=s?te(i.wallet,n.nftMint,C.TOKEN_2022_PROGRAM_ID):te(i.wallet,n.nftMint,C.TOKEN_PROGRAM_ID),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=qe(l,p,n.tickLower,n.tickUpper),h=this.increasePositionFromLiquidityInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?le(l,p).publicKey:void 0);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},signers:[],instructions:[h],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:a,baseAmount:o,otherAmountMax:r,nft2022:s}){let[l,p]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],b=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),g=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Z(l,p,b),{publicKey:k}=Z(l,p,g),{publicKey:m}=s?te(i.wallet,n.nftMint,C.TOKEN_2022_PROGRAM_ID):te(i.wallet,n.nftMint,C.TOKEN_PROGRAM_ID),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=qe(l,p,n.tickLower,n.tickUpper);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},instructions:[this.increasePositionFromBaseInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?le(l,p).publicKey:void 0)],signers:[],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h){let I=F([E("liquidity"),P("amountMaxA"),P("amountMaxB"),V("optionBaseFlag"),de("baseFlag")]),R=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...R],T=Buffer.alloc(I.span);I.encode({liquidity:new Ut.default(0),amountMaxA:m==="MintA"?c:d,amountMaxB:m==="MintA"?d:c,baseFlag:m==="MintA",optionBaseFlag:1},T);let S=Buffer.from([...Ce.increaseLiquidity,...T]);return new w.TransactionInstruction({keys:W,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,I){let R=F([E("liquidity"),P("amountMinA"),P("amountMinB")]),W=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[],...m.map(D=>[{pubkey:D.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Lt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...W],S=Buffer.alloc(R.span);R.encode({liquidity:c,amountMinA:d,amountMinB:h},S);let L=Buffer.from([...Ce.decreaseLiquidity,...S]);return new w.TransactionInstruction({keys:T,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMinA:o,amountMinB:r,programId:s,nft2022:l}){let[p,b]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],g=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),u=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:k}=Z(p,b,g),{publicKey:m}=Z(p,b,u),{publicKey:c}=l?te(i.wallet,n.nftMint,C.TOKEN_2022_PROGRAM_ID):te(i.wallet,n.nftMint,s),{publicKey:d}=he(p,n.nftMint),{publicKey:h}=qe(p,b,n.tickLower,n.tickUpper),I=[];for(let T=0;T<e.rewardDefaultInfos.length;T++)I.push({poolRewardVault:new w.PublicKey(t.rewardInfos[T].vault),ownerRewardVault:i.rewardAccounts[T],rewardMint:new w.PublicKey(e.rewardDefaultInfos[T].mint.address)});let R=[],W=this.decreaseLiquidityInstruction(p,i.wallet,c,d,b,h,k,m,i.tokenAccountA,i.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),I,a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,u])?le(p,b).publicKey:void 0);return R.push(W),{address:{tickArrayLower:k,tickArrayUpper:m,positionNftAccount:c,personalPosition:d,protocolPosition:h},signers:[],instructions:R,instructionTypes:[ee.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d){let h=F([P("amount"),P("otherAmountThreshold"),E("sqrtPriceLimitX64"),de("isBaseInput")]),I=[...d?[{pubkey:d,isSigner:!1,isWritable:!0}]:[],...b.map(S=>({pubkey:S,isSigner:!1,isWritable:!0}))],R=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Lt,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...I],W=Buffer.alloc(h.span);h.encode({amount:u,otherAmountThreshold:k,sqrtPriceLimitX64:m,isBaseInput:c},W);let T=Buffer.from([...Ce.swap,...W]);return new w.TransactionInstruction({keys:R,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:a,amountIn:o,amountOutMin:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],[g,u]=[new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B)],[k,m]=[new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address)],c=e.mintA.address===a.toString(),d=[this.swapInstruction(p,i.wallet,b,new w.PublicKey(e.config.id),c?i.tokenAccountA:i.tokenAccountB,c?i.tokenAccountB:i.tokenAccountA,c?g:u,c?u:g,c?k:m,c?m:k,l,n,o,r,s,!0,le(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[ee.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:a,amountOut:o,amountInMax:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],[g,u]=[new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B)],[k,m]=[new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address)],c=e.mintA.address===a.toBase58(),d=[this.swapInstruction(p,i.wallet,b,new w.PublicKey(e.config.id),c?i.tokenAccountB:i.tokenAccountA,c?i.tokenAccountA:i.tokenAccountB,c?u:g,c?g:u,c?m:k,c?k:m,l,n,o,r,s,!1,le(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[ee.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,g){let u=F([P("openTime"),P("endTime"),E("emissionsPerSecondX64")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Fe,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({openTime:oe(p),endTime:oe(b),emissionsPerSecondX64:g},m);let c=Buffer.from([...Ce.initReward,...m]);return new w.TransactionInstruction({keys:k,programId:e,data:c})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],r=yi(a,o,i.mint).publicKey,s=qt(a).publicKey,l=[this.initRewardInstruction(a,n.wallet,o,s,new w.PublicKey(e.config.id),n.tokenAccount,i.programId,i.mint,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:r,operationId:s},signers:[],instructions:l,instructionTypes:[ee.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,g){let u=F([V("rewardIndex"),E("emissionsPerSecondX64"),P("openTime"),P("endTime")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0}],m=Buffer.alloc(u.span);u.encode({rewardIndex:l,emissionsPerSecondX64:g,openTime:oe(p),endTime:oe(b)},m);let c=Buffer.from([...Ce.setRewardEmissions,...m]);return new w.TransactionInstruction({keys:k,programId:e,data:c})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],r,s,l;for(let g=0;g<e.rewardDefaultInfos.length;g++)e.rewardDefaultInfos[g].mint.address===i.mint.toString()&&(r=g,s=new w.PublicKey(t.rewardInfos[g].vault),l=new w.PublicKey(t.rewardInfos[g].mint.address));(r===void 0||s===void 0)&&Ti.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let p=qt(a).publicKey,b=[this.setRewardInstruction(a,n.wallet,o,p,new w.PublicKey(e.config.id),n.tokenAccount,s,l,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:s,operationId:p},signers:[],instructions:b,instructionTypes:[ee.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,a,o,r){let s=F([V("rewardIndex")]),l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Lt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(s.span);s.encode({rewardIndex:r},p);let b=Buffer.from([...Ce.collectReward,...p]);return new w.TransactionInstruction({keys:l,programId:e,data:b})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[a,o]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],r,s;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===i.toString()&&(r=p,s=new w.PublicKey(t.rewardInfos[p].vault));(r===void 0||s===void 0)&&Ti.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=[this.collectRewardInstruction(a,n.wallet,o,n.tokenAccount,s,i,r)];return{address:{rewardVault:s},signers:[],instructions:l,instructionTypes:[ee.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:a,nftMint:o,nft2022:r,getEphemeralSigners:s}){let l=[],p;if(s)p=new w.PublicKey((await s(1))[0]);else{let d=w.Keypair.generate();l.push(d),p=d.publicKey}let b=r?te(a,o,C.TOKEN_2022_PROGRAM_ID).publicKey:te(a,o,C.TOKEN_PROGRAM_ID).publicKey,{publicKey:g}=he(n,o),u=fn(e,p).publicKey,k=te(a,p,C.TOKEN_PROGRAM_ID).publicKey,m=ut(p).publicKey,c=tt.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:a,lockOwner:a,positionNftAccount:b,positionId:g,lockPositionId:u,lockNftMint:p,lockNftAccount:k,metadataAccount:m,withMetadata:!0,nft2022:r,positionNftMint:o,authPositionNftAccount:te(t,o,r?C.TOKEN_2022_PROGRAM_ID:C.TOKEN_PROGRAM_ID).publicKey,positionNftProgram:r?C.TOKEN_2022_PROGRAM_ID:C.TOKEN_PROGRAM_ID});return{address:{positionId:g,lockPositionId:u,lockNftAccount:k,lockNftMint:p,positionNftAccount:b,metadataAccount:m},instructions:[c],signers:l,instructionTypes:[ee.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:a,positionNftAccount:o,positionId:r,positionNftMint:s,authPositionNftAccount:l,positionNftProgram:p,lockPositionId:b,lockNftMint:g,lockNftAccount:u,metadataAccount:k,withMetadata:m}){let c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!0,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:C.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1}],d=F([de("withMetadata")]),h=Buffer.alloc(d.span);d.encode({withMetadata:m},h);let I=Buffer.from([...hi,...h]);return new w.TransactionInstruction({keys:c,programId:e,data:I})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:a}){let{publicKey:o}=te(i,a,C.TOKEN_PROGRAM_ID),{publicKey:r}=he(n,a),s=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:dn(e,r).publicKey,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1}];return new w.TransactionInstruction({keys:s,programId:e,data:Buffer.from(hi)})}static harvestLockPositionInstruction(e){let[t,n]=[new w.PublicKey(e.poolKeys.programId),new w.PublicKey(e.poolKeys.id)],i=K.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),a=K.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:o}=Z(t,n,i),{publicKey:r}=Z(t,n,a),{publicKey:s}=te(e.owner,e.ownerPosition.nftMint,C.TOKEN_PROGRAM_ID),{publicKey:l}=he(t,e.ownerPosition.nftMint),{publicKey:p}=qe(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),b=[];for(let k=0;k<e.poolKeys.rewardInfos.length;k++)b.push({poolRewardVault:new w.PublicKey(e.poolKeys.rewardInfos[k].vault),ownerRewardVault:e.ownerRewardAccounts[k],rewardMint:new w.PublicKey(e.poolKeys.rewardInfos[k].mint.address)});let g=[...b.map(k=>[{pubkey:k.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.rewardMint,isSigner:!1,isWritable:!1}]).flat()],u=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:dn(e.programId,l).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:new w.PublicKey(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new w.PublicKey(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:new w.PublicKey(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new w.PublicKey(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...g];return new w.TransactionInstruction({keys:u,programId:e.programId,data:Buffer.from(Bi)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:a,lockNftMint:o,lockNftAccount:r,positionNftAccount:s,positionId:l,poolId:p,protocolPosition:b,vaultA:g,vaultB:u,tickArrayLower:k,tickArrayUpper:m,userVaultA:c,userVaultB:d,mintA:h,mintB:I,rewardAccounts:R,exTickArrayBitmap:W}){let T=[...W?[{pubkey:W,isSigner:!1,isWritable:!0}]:[],...R.map(L=>[{pubkey:L.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.rewardMint,isSigner:!1,isWritable:!1}]).flat()],S=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:I,isSigner:!1,isWritable:!1},...T];return new w.TransactionInstruction({keys:S,programId:e,data:Buffer.from(Bi)})}};var ct=require("@solana/web3.js"),zt=require("@solana/spl-token");var An=F([V("instruction"),P("amountIn"),P("minAmountOut")]),wn=F([V("instruction"),P("maxAmountIn"),P("amountOut")]),Rl=F([V("instruction"),V("nonce")]),qr=F([V("instruction"),V("nonce"),P("startTime")]),Nl=F([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),E("swapBaseInAmount"),E("swapQuoteOutAmount"),P("swapBase2QuoteFee"),E("swapQuoteInAmount"),E("swapBaseOutAmount"),P("swapQuote2BaseFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("withdrawQueue"),x("lpVault"),x("owner"),P("lpReserve"),X(P(),3,"padding")]),Ml=F([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),E("swapBaseInAmount"),E("swapQuoteOutAmount"),E("swapQuoteInAmount"),E("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("modelDataAccount"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("owner"),X(P(),64,"padding")]),Gr=F([V("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),Ur=F([V("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]);var Ol=F([P("fee")]);var Ii=ce("Raydium_liquidity_instruction");function Xr({poolKeys:y,userKeys:e,amountIn:t,minAmountOut:n,modelDataPubKey:i=Ot},a){let o=Ie(y),r=Buffer.alloc(An.span);An.encode({instruction:9,amountIn:oe(t),minAmountOut:oe(n)},r);let s=[f({pubkey:zt.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders})];return a===4&&s.push(f({pubkey:o.targetOrders})),s.push(f({pubkey:o.vault.A}),f({pubkey:o.vault.B})),a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ct.TransactionInstruction({programId:o.programId,keys:s,data:r})}function zr({poolKeys:y,userKeys:e,maxAmountIn:t,amountOut:n,modelDataPubKey:i=Ot},a){let o=Ie(y),r=Buffer.alloc(wn.span);wn.encode({instruction:11,maxAmountIn:oe(t),amountOut:oe(n)},r);let s=[f({pubkey:zt.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders}),f({pubkey:o.targetOrders}),f({pubkey:o.vault.A}),f({pubkey:o.vault.B})];return a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ct.TransactionInstruction({programId:o.programId,keys:s,data:r})}function xi(y){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:a,fixedSide:o}=y;if(t===4||t===5){let r={poolKeys:e,userKeys:n};if(o==="in")return Xr($(Y({},r),{amountIn:i,minAmountOut:a}),t);if(o==="out")return zr($(Y({},r),{maxAmountIn:i,amountOut:a}),t);Ii.logWithError("invalid params","params",y)}throw Ii.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var zl=F([ke(8),V("bump"),de("disableCreatePool"),Ze("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),x("protocolOwner"),x("fundOwner"),X(P(),16)]),Ql=F([ke(8),x("configId"),x("poolCreator"),x("vaultA"),x("vaultB"),x("mintLp"),x("mintA"),x("mintB"),x("mintProgramA"),x("mintProgramB"),x("observationId"),V("bump"),V("status"),V("lpDecimals"),V("mintDecimalA"),V("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),X(P(),32)]);var It=require("@solana/web3.js"),Tn=require("@solana/spl-token");var Zl=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Yl=Buffer.from("amm_config","utf8"),Jl=Buffer.from("pool","utf8"),$l=Buffer.from("pool_lp_mint","utf8"),em=Buffer.from("pool_vault","utf8"),tm=Buffer.from("observation","utf8");var nm=Buffer.from("locked_liquidity","utf8");var dm=ce("Raydium_cpmm"),Qr={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function Si(y,e,t,n,i,a,o,r,s,l,p,b,g,u,k,m){let c=F([P("amountIn"),P("amounOutMin")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],h=Buffer.alloc(c.span);return c.encode({amountIn:k,amounOutMin:m},h),new It.TransactionInstruction({keys:d,programId:y,data:Buffer.from([...Qr.swapBaseInput,...h])})}var Hr=H(require("bn.js")),jr=H(require("decimal.js-light"));var Ki=H(require("bn.js"));var km=new Ki.default(0);function Zr(y,e,t,n,i,a,o,r,s,l,p,b){let g=F([V("instruction"),P("amountIn"),P("amountOut")]),u=[{pubkey:A.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:ye.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(t.id),isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey(n.id),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let m=Ie(t);u.push({pubkey:m.config.id,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.A:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.B:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},...b.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let m=Ie(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0})}else{let m=Ie(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},...m.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:m.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:m.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0}])}let k=Buffer.alloc(g.span);return g.encode({instruction:4,amountIn:l,amountOut:p},k),new A.TransactionInstruction({keys:u,programId:y,data:k})}function Yr(y,e,t,n,i,a,o,r,s,l){let p=F([V("instruction")]),b=[{pubkey:A.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:ye.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let u=Ie(n);b.push({pubkey:u.config.id,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.A:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.B:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},...l.map(k=>({pubkey:k,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let u=Ie(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0})}else{let u=Ie(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},...u.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:u.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:u.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(p.span);return p.encode({instruction:5},g),new A.TransactionInstruction({keys:b,programId:y,data:g})}function Ci(y,e,t,n,i,a,o,r,s,l,p,b,g,u,k){var T;let m=[],c=[f({pubkey:ye.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:ye.TOKEN_2022_PROGRAM_ID,isWritable:!1}),f({pubkey:ye.ASSOCIATED_TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:A.SystemProgram.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})];c.push(f({pubkey:t})),c.push(f({pubkey:i}));let d=[s,l],h=[p,b],I=[a,o,r];for(let S=0;S<d.length;S++){let L=d[S],D=I[S]===L.mintA.address;if(c.push(f({pubkey:new A.PublicKey(L.programId),isWritable:!1})),S===d.length-1?c.push(f({pubkey:i})):c.push(f({pubkey:n})),c.push(f({pubkey:new A.PublicKey(I[S])})),c.push(f({pubkey:new A.PublicKey(I[S+1])})),L.version===6){let B=h[S];c.push(f({pubkey:new A.PublicKey(B.config.id)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(D?B.vault.A:B.vault.B)})),c.push(f({pubkey:new A.PublicKey(D?B.vault.B:B.vault.A)})),c.push(f({pubkey:new A.PublicKey(L.observationId)})),c.push(f({pubkey:ze})),c.push(f({pubkey:le(new A.PublicKey(L.programId),new A.PublicKey(L.id)).publicKey})),m.push(hn(L.sqrtPriceX64.toString(),D));for(let _ of(T=k[S])!=null?T:[])c.push(f({pubkey:new A.PublicKey(_)}))}else if(L.version===5){let B=h[S];c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.authority),isWritable:!1})),c.push(f({pubkey:new A.PublicKey(B.marketProgramId)})),c.push(f({pubkey:new A.PublicKey(B.marketAuthority)})),c.push(f({pubkey:Mt,isWritable:!1})),c.push(f({pubkey:new A.PublicKey(B.openOrders)})),c.push(f({pubkey:new A.PublicKey(B.vault.A)})),c.push(f({pubkey:new A.PublicKey(B.vault.B)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.marketId)})),c.push(f({pubkey:new A.PublicKey(B.marketBids)})),c.push(f({pubkey:new A.PublicKey(B.marketAsks)})),c.push(f({pubkey:new A.PublicKey(B.marketEventQueue)})),c.push(f({pubkey:new A.PublicKey(B.marketBaseVault)})),c.push(f({pubkey:new A.PublicKey(B.marketQuoteVault)}))}else if(L.version===4){let B=h[S],_=L.status!==1;c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(B.authority),isWritable:!1})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketProgramId)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketAuthority)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.openOrders)})),c.push(f({pubkey:new A.PublicKey(B.vault.A)})),c.push(f({pubkey:new A.PublicKey(B.vault.B)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketId)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketBids)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketAsks)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketEventQueue)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketBaseVault)})),c.push(f({pubkey:new A.PublicKey(_?B.id:B.marketQuoteVault)}))}else if(L.version===7){let B=h[S];c.push(f({pubkey:new A.PublicKey(B.authority)})),c.push(f({pubkey:new A.PublicKey(B.config.id)})),c.push(f({pubkey:new A.PublicKey(B.id)})),c.push(f({pubkey:new A.PublicKey(D?B.vault.A:B.vault.B)})),c.push(f({pubkey:new A.PublicKey(D?B.vault.B:B.vault.A)})),c.push(f({pubkey:new A.PublicKey(L.observationId)}))}else throw Error("pool type error")}let R=F([V("insId"),P("amountIn"),P("amountOut"),X(E(),m.length,"clmmPriceLimit")]),W=Buffer.alloc(R.span);return R.encode({insId:0,amountIn:g,amountOut:u,clmmPriceLimit:m},W),new A.TransactionInstruction({keys:c,programId:y,data:W})}function hn(y,e){if(y)if(e){let t=new We.default(y).div(new We.default(25));return t.gt(Vt)?t:Vt}else{let t=new We.default(y).mul(new We.default(25));return t.lt(vt)?t:vt}else return e?Vt:vt}function Jr({routeProgram:y,ownerInfo:e,inputMint:t,swapInfo:n}){var i,a,o,r,s,l,p;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let b=n.poolKey[0],g=Ie(b),u=t.equals(g.mintA.address)?Ve.add(Se):ve.sub(Se);return tt.makeSwapBaseInInstructions({poolInfo:b,poolKeys:b,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:g.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:g.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((a=(i=n.minAmountOut.fee)==null?void 0:i.raw)!=null?a:new We.default(0)),sqrtPriceLimitX64:u,remainingAccounts:(o=n.remainingAccounts[0])!=null?o:[]})}else if(n.poolInfo[0].version===7){let b=n.poolInfo[0],g=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[Si(b.programId,e.wallet,b.authority,b.configId,b.id,e.sourceToken,e.destinationToken,g?b.vaultA:b.vaultB,g?b.vaultB:b.vaultA,g?b.mintProgramA:b.mintProgramB,g?b.mintProgramB:b.mintProgramA,new A.PublicKey(b[g?"mintA":"mintB"].address),new A.PublicKey(b[g?"mintB":"mintA"].address),b.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[g?ee.CpmmSwapBaseIn:ee.CpmmSwapBaseOut],address:{}}}else{let b=n.poolKey[0];return{signers:[],instructions:[xi({poolKeys:b,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((s=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?s:new We.default(0)),fixedSide:"in"})],lookupTableAddress:b.lookupTableAccount?[b.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ee.AmmV5SwapBaseIn:ee.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let b=n.poolInfo[0],g=n.poolInfo[1],u=n.poolKey[0],k=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Ci(y,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),b,g,u,k,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((p=(l=n.minAmountOut.fee)==null?void 0:l.raw)!=null?p:new We.default(0)),n.remainingAccounts)],instructionTypes:[ee.RouteSwap],lookupTableAddress:[u.lookupTableAccount,k.lookupTableAccount].filter(m=>m!==void 0),address:{}}}else throw Error("route type error")}function $r({programId:y,wallet:e,amount:t,inputAccount:n,outputAccount:i,routeInfo:a,poolKeys:o}){var g;if(a.success===!1)throw Error("route info error");let r=[],s=[f({pubkey:ye.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:ye.TOKEN_2022_PROGRAM_ID,isWritable:!1}),f({pubkey:ye.ASSOCIATED_TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:A.SystemProgram.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],l={[a.data.inputMint]:n,[a.data.outputMint]:i};s.push(f({pubkey:l[a.data.inputMint]})),s.push(f({pubkey:l[a.data.outputMint]}));for(let u=0;u<o.length;u++){let k=a.data.routePlan[u],m=o[u],c=k.inputMint===m.mintA.address;if(s.push(f({pubkey:new A.PublicKey(m.programId),isWritable:!1})),u===o.length-1)s.push(f({pubkey:l[k.outputMint]}));else{let d=k.outputMint;if(l[d]===void 0){let h=te(e,new A.PublicKey(d),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()||m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A.PublicKey(c?m.mintB.programId:m.mintA.programId):ye.TOKEN_PROGRAM_ID).publicKey;l[d]=h}s.push(f({pubkey:l[d]}))}if(s.push(f({pubkey:new A.PublicKey(k.inputMint)})),s.push(f({pubkey:new A.PublicKey(k.outputMint)})),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.config.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.observationId)})),s.push(f({pubkey:ze,isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.exBitmapAccount)})),r.push(hn(k.lastPoolPriceX64,c));for(let h of(g=k.remainingAccounts)!=null?g:[])s.push(f({pubkey:new A.PublicKey(h)}))}else if(m.programId===Ae.AMM_STABLE.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.authority),isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.marketProgramId),isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.marketAuthority),isWritable:!1})),s.push(f({pubkey:Mt,isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.openOrders)})),s.push(f({pubkey:new A.PublicKey(d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.vault.B)})),s.push(f({pubkey:new A.PublicKey(d.marketId)})),s.push(f({pubkey:new A.PublicKey(d.marketBids)})),s.push(f({pubkey:new A.PublicKey(d.marketAsks)})),s.push(f({pubkey:new A.PublicKey(d.marketEventQueue)})),s.push(f({pubkey:new A.PublicKey(d.marketBaseVault)})),s.push(f({pubkey:new A.PublicKey(d.marketQuoteVault)}))}else if(m.programId===Ae.AMM_V4.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.authority),isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.vault.B)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)}))}else if(m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.authority)})),s.push(f({pubkey:new A.PublicKey(d.config.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.observationId)}))}else throw Error("pool type error")}let p=F([V("insId"),P("amountIn"),P("amountOut"),X(E(),r.length,"clmmPriceLimit")]),b=Buffer.alloc(p.span);return p.encode({insId:0,amountIn:t,amountOut:new We.default(a.data.otherAmountThreshold),clmmPriceLimit:r},b),new A.TransactionInstruction({keys:s,programId:y,data:b})}function eo({programId:y,wallet:e,inputAccount:t,outputAccount:n,routeInfo:i,poolKeys:a}){var b;if(i.success===!1)throw Error("route info error");let o=[],r=[f({pubkey:ye.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:ye.TOKEN_2022_PROGRAM_ID,isWritable:!1}),f({pubkey:ye.ASSOCIATED_TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:A.SystemProgram.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],s={[i.data.inputMint]:t,[i.data.outputMint]:n};for(let g=a.length-1;g>=0;g--){let u=i.data.routePlan[g],k=a[g],m=u.inputMint===k.mintA.address;if(r.push(f({pubkey:new A.PublicKey(k.programId)})),g===0)r.push(f({pubkey:s[u.inputMint]}));else{let c=u.inputMint;if(s[c]===void 0){let d=te(e,new A.PublicKey(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A.PublicKey(m?k.mintA.programId:k.mintB.programId):ye.TOKEN_PROGRAM_ID).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(g===a.length-1)r.push(f({pubkey:s[u.outputMint]}));else{let c=u.outputMint;if(s[c]===void 0){let d=te(e,new A.PublicKey(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A.PublicKey(m?k.mintB.programId:k.mintA.programId):ye.TOKEN_PROGRAM_ID).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(r.push(f({pubkey:new A.PublicKey(u.inputMint)})),r.push(f({pubkey:new A.PublicKey(u.outputMint)})),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.config.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.observationId)})),r.push(f({pubkey:ze,isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.exBitmapAccount)})),o.push(hn(u.lastPoolPriceX64,m));for(let d of(b=u.remainingAccounts)!=null?b:[])r.push(f({pubkey:new A.PublicKey(d)}))}else if(k.programId===Ae.AMM_STABLE.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.authority),isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.marketProgramId),isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.marketAuthority),isWritable:!1})),r.push(f({pubkey:Mt,isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.openOrders)})),r.push(f({pubkey:new A.PublicKey(c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.vault.B)})),r.push(f({pubkey:new A.PublicKey(c.marketId)})),r.push(f({pubkey:new A.PublicKey(c.marketBids)})),r.push(f({pubkey:new A.PublicKey(c.marketAsks)})),r.push(f({pubkey:new A.PublicKey(c.marketEventQueue)})),r.push(f({pubkey:new A.PublicKey(c.marketBaseVault)})),r.push(f({pubkey:new A.PublicKey(c.marketQuoteVault)}))}else if(k.programId===Ae.AMM_V4.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.authority),isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.vault.B)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)}))}else if(k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.authority)})),r.push(f({pubkey:new A.PublicKey(c.config.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.observationId)}))}else throw Error("pool type error")}let l=F([V("insId"),P("amountIn"),P("amountOut"),X(E(),o.length,"clmmPriceLimit")]),p=Buffer.alloc(l.span);return l.encode({insId:1,amountIn:new We.default(i.data.otherAmountThreshold),amountOut:new We.default(i.data.outputAmount),clmmPriceLimit:o},p),new A.TransactionInstruction({keys:r,programId:y,data:p})}0&&(module.exports={makeSwapInstruction,route1Instruction,route2Instruction,routeInstruction,swapBaseInAutoAccount,swapBaseOutAutoAccount});
//# sourceMappingURL=instrument.js.map