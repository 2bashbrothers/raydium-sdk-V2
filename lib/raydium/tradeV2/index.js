var Gi=Object.create;var mt=Object.defineProperty,Ui=Object.defineProperties,Xi=Object.getOwnPropertyDescriptor,zi=Object.getOwnPropertyDescriptors,Qi=Object.getOwnPropertyNames,Mn=Object.getOwnPropertySymbols,Yi=Object.getPrototypeOf,En=Object.prototype.hasOwnProperty,Hi=Object.prototype.propertyIsEnumerable;var On=(y,e,t)=>e in y?mt(y,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[e]=t,H=(y,e)=>{for(var t in e||(e={}))En.call(e,t)&&On(y,t,e[t]);if(Mn)for(var t of Mn(e))Hi.call(e,t)&&On(y,t,e[t]);return y},$=(y,e)=>Ui(y,zi(e));var ji=(y,e)=>{for(var t in e)mt(y,t,{get:e[t],enumerable:!0})},Fn=(y,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Qi(e))!En.call(y,i)&&i!==t&&mt(y,i,{get:()=>e[i],enumerable:!(n=Xi(e,i))||n.enumerable});return y};var U=(y,e,t)=>(t=y!=null?Gi(Yi(y)):{},Fn(e||!y||!y.__esModule?mt(t,"default",{value:y,enumerable:!0}):t,y)),Zi=y=>Fn(mt({},"__esModule",{value:!0}),y);var Ro={};ji(Ro,{makeSwapInstruction:()=>_i,route1Instruction:()=>ho,route2Instruction:()=>Bo,routeInstruction:()=>Di,swapBaseInAutoAccount:()=>xo,swapBaseOutAutoAccount:()=>So});module.exports=Zi(Ro);var Ko=require("@solana/web3.js"),Rn=require("@solana/spl-token"),qi=U(require("bn.js")),Co=U(require("decimal.js"));var Vn=require("@solana/web3.js");var pt=require("lodash");var Ht=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Wn={},Ji={};function ne(y){let e=(0,pt.get)(Wn,y);if(!e){let t=(0,pt.get)(Ji,y);e=new Ht({name:y,logLevel:t}),(0,pt.set)(Wn,y,e)}return e}var Ct=require("@solana/spl-token"),jt=ne("Raydium_accountInfo_util");async function Qe(y,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:a=100}=H({batchRequest:!1},t),o=Zt(e,a),r=new Array(o.length).fill([]);if(n){let s=o.map(b=>{let g=y._buildArgs([b.map(u=>u.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:g}}),l=Zt(s,10);r=(await(await Promise.all(l.map(async b=>await y._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&jt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(g=>{if(g){let{data:u,executable:k,lamports:m,owner:c,rentEpoch:d}=g;return u.length!==2&&u[1]!=="base64"&&jt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(u[0],"base64"),executable:k,lamports:m,owner:new Vn.PublicKey(c),rentEpoch:d}}return null})))}else try{r=await Promise.all(o.map(s=>y.getMultipleAccountsInfo(s,i)))}catch(s){s instanceof Error&&jt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${s.message}`)}return r.flat()}async function dt(y,e,t){let n=await Qe(y,e.map(i=>i.pubkey),t);return e.map((i,a)=>$(H({},i),{accountInfo:n[a]}))}var Ve=U(require("bn.js")),ar=U(require("decimal.js"));var Un=U(require("big.js")),Pt=U(require("bn.js"));var vn=U(require("toformat")),$i=vn.default,bt=$i;var yt=U(require("big.js")),_n=U(require("bn.js")),qn=U(require("decimal.js-light"));var ot=U(require("bn.js"));var Dn=9007199254740991;function re(y){let e=ne("Raydium_parseBigNumberish");if(y instanceof ot.default)return y;if(typeof y=="string"){if(y.match(/^-?[0-9]+$/))return new ot.default(y);e.logWithError(`invalid BigNumberish string: ${y}`)}return typeof y=="number"?(y%1&&e.logWithError(`BigNumberish number underflow: ${y}`),(y>=Dn||y<=-Dn)&&e.logWithError(`BigNumberish number overflow: ${y}`),new ot.default(String(y))):typeof y=="bigint"?new ot.default(y.toString()):(e.error(`invalid BigNumberish value: ${y}`),new ot.default(0))}var Rt=ne("module/fraction"),Jt=bt(yt.default),gt=bt(qn.default),tr={[0]:gt.ROUND_DOWN,[1]:gt.ROUND_HALF_UP,[2]:gt.ROUND_UP},nr={[0]:yt.default.roundDown,[1]:yt.default.roundHalfUp,[2]:yt.default.roundUp},j=class{constructor(e,t=new _n.default(1)){this.numerator=re(e),this.denominator=re(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(re(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(re(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(re(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(re(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Rt.logWithError(`${e} is not an integer.`),e<=0&&Rt.logWithError(`${e} is not positive.`),gt.set({precision:e+1,rounding:tr[n]});let i=new gt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Rt.logWithError(`${e} is not an integer.`),e<0&&Rt.logWithError(`${e} is negative.`),Jt.DP=e,Jt.RM=nr[n]||1,new Jt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ir=ne("Raydium_amount"),Gn=bt(Un.default);function rr(y,e){let t="0",n="0";if(y.includes(".")){let i=y.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):ir.logWithError(`invalid number string, num: ${y}`)}else t=y;return[t,n.slice(0,e)||n]}var pe=class extends j{constructor(t,n,i=!0,a){let o=new Pt.default(0),r=$t.pow(new Pt.default(t.decimals));if(i)o=re(n);else{let s=new Pt.default(0),l=new Pt.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[p,b]=rr(n.toString(),t.decimals);s=re(p),l=re(b)}s=s.mul(r),o=s.add(l)}super(o,r);this.logger=ne(a||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Gn.DP=this.token.decimals,new Gn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var Xn=require("@solana/web3.js"),en=require("@solana/spl-token"),tn={chainId:101,address:Xn.PublicKey.default.toBase58(),programId:en.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},_e={chainId:101,address:"So11111111111111111111111111111111111111112",programId:en.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Nt=require("@solana/web3.js");var J=require("@solana/web3.js"),zn=require("@solana/spl-token");function f({pubkey:y,isSigner:e=!1,isWritable:t=!0}){return{pubkey:y,isWritable:t,isSigner:e}}var rs=[f({pubkey:zn.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:J.SystemProgram.programId,isWritable:!1}),f({pubkey:J.SYSVAR_RENT_PUBKEY,isWritable:!1})];function nn({publicKey:y,transformSol:e}){let t=rn(y.toString());if(t instanceof J.PublicKey)return e&&t.equals(kt)?ft:t;if(e&&t.toString()===kt.toBase58())return ft;if(typeof t=="string"){if(t===J.PublicKey.default.toBase58())return J.PublicKey.default;try{return new J.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function rn(y){try{return new J.PublicKey(y)}catch{return y}}var Lt=new J.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ye=new J.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),We=new J.PublicKey("SysvarRent111111111111111111111111111111111"),os=new J.PublicKey("SysvarC1ock11111111111111111111111111111111"),He=new J.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ss=new J.PublicKey("Sysvar1nstructions1111111111111111111111111"),or=J.SystemProgram.programId,as=new J.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),us=new J.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),cs=new J.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ls=new J.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ms=new J.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ps=new J.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ds=new J.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),fs=new J.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),bs=new J.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ys=new J.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),gs=new J.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ft=new J.PublicKey("So11111111111111111111111111111111111111112"),kt=J.PublicKey.default;function rt(y){return nn({publicKey:y,transformSol:!0})}var on=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:a=!1,isToken2022:o=!1}){if(e===kt.toBase58()||e instanceof Nt.PublicKey&&kt.equals(e)){this.decimals=_e.decimals,this.symbol=_e.symbol,this.name=_e.name,this.mint=new Nt.PublicKey(_e.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=a?Nt.PublicKey.default:nn({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Me=on;Me.WSOL=new on($(H({},_e),{mint:_e.address}));var sn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Mt=sn;Mt.SOL=new sn(tn);var Yn=U(require("bn.js"));var Qn=new j(new Yn.default(100)),qe=class extends j{toSignificant(e=5,t,n){return this.mul(Qn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Qn).toFixed(e,t,n)}};var sr=ne("Raydium_price"),Be=class extends j{constructor(t){let{baseToken:n,quoteToken:i,numerator:a,denominator:o}=t;super(a,o);this.baseToken=n,this.quoteToken=i,this.scalar=new j(an(n.decimals),an(i.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Be({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&sr.logWithError("mul token not equals");let n=super.mul(t);return new Be({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var jn=require("@solana/web3.js"),Zn=U(require("bn.js"));function Jn(y){return typeof y=="object"&&y!==null&&![Me,pe,jn.PublicKey,j,Zn.default,Be,qe].some(e=>typeof e=="object"&&y instanceof e)}function xe(y){return typeof y=="string"?rn(y):Array.isArray(y)?y.map(e=>xe(e)):Jn(y)?Object.fromEntries(Object.entries(y).map(([e,t])=>[e,xe(t)])):y}var Hn=new Ve.default(0),ur=new Ve.default(1),sa=new Ve.default(2),aa=new Ve.default(3),ua=new Ve.default(5),$t=new Ve.default(10),ca=new Ve.default(100),la=new Ve.default(1e3),ma=new Ve.default(1e4);function an(y){return $t.pow(re(y))}function Zt(y,e=1,t=[]){let n=[...y];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var $n=require("@solana/web3.js"),ei=require("@solana/spl-token");var je=require("@solana/web3.js");var ee={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var cr=require("@solana/spl-token"),ha=ne("Raydium_txUtil");function ge(y,e){let[t,n]=je.PublicKey.findProgramAddressSync(y,e);return{publicKey:t,nonce:n}}function te(y,e,t){return ge([y.toBuffer(),(t!=null?t:ei.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new $n.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var O=require("@solana/web3.js"),lr=new O.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),mr=new O.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),pr=new O.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),dr=new O.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),fr=new O.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),br=new O.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),un=new O.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ti=new O.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),yr=new O.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ot=new O.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),cn=new O.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ni=new O.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ii=new O.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),At=new O.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),gr=new O.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Pr=new O.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ka=new O.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ca=new O.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ra=new O.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),La=new O.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ln=new O.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ri=new O.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),kr=new O.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ar=new O.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),wr=new O.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Tr=new O.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ir=new O.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Na=new O.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ma=new O.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),hr=new O.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Br=new O.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ae={AMM_V4:ti,AMM_STABLE:yr,CLMM_PROGRAM_ID:cn,CLMM_LOCK_PROGRAM_ID:ni,CLMM_LOCK_AUTH_ID:ii,FARM_PROGRAM_ID_V3:lr,FARM_PROGRAM_ID_V4:mr,FARM_PROGRAM_ID_V5:pr,FARM_PROGRAM_ID_V6:dr,OPEN_BOOK_PROGRAM:br,SERUM_PROGRAM_ID_V3:un,UTIL1216:fr,Router:gr,CREATE_CPMM_POOL_PROGRAM:ln,CREATE_CPMM_POOL_AUTH:ri,CREATE_CPMM_POOL_FEE_ACC:kr,LOCK_CPMM_PROGRAM:Ar,LOCK_CPMM_AUTH:wr,LAUNCHPAD_PROGRAM:Tr,LAUNCHPAD_AUTH:Ir,LAUNCHPAD_PLATFORM:hr,LAUNCHPAD_CONFIG:Br,FEE_DESTINATION_ID:Pr,MODEL_DATA_PUBKEY:At},Oa={OPEN_BOOK_PROGRAM:new O.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new O.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.PublicKey.default,Router:new O.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O.PublicKey("Ray1111111111111111111111111111111111111111")};var Ne=U(require("bn.js")),wt=1e4;function ue(y,e,t,n){if(e===void 0)return{amount:y,fee:void 0,expirationTime:void 0};let i=$(H({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),a=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,o=new Ne.default(a.maximumFee.toString()),r=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(a.transferFeeBasisPoints===wt){let s=new Ne.default(a.maximumFee.toString());return{amount:y.add(s),fee:s,expirationTime:r}}else{let s=Et(y.mul(new Ne.default(wt)),new Ne.default(wt-a.transferFeeBasisPoints)),l=new Ne.default(a.maximumFee.toString()),p=s.sub(y).gt(l)?y.add(l):s,b=Et(p.mul(new Ne.default(a.transferFeeBasisPoints)),new Ne.default(wt)),g=b.gt(o)?o:b;return{amount:p,fee:g,expirationTime:r}}else{let s=Et(y.mul(new Ne.default(a.transferFeeBasisPoints)),new Ne.default(wt)),l=s.gt(o)?o:s;return{amount:y,fee:l,expirationTime:r}}}function Ge(y,e){return y===void 0?e:e===void 0?y:Math.min(y,e)}function Et(y,e){let{div:t,mod:n}=y.divmod(e);return n.gt(new Ne.default(0))?t.add(new Ne.default(1)):t}var Tt=require("@solana/web3.js");var xr={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Tt.AddressLookupTableAccount({key:new Tt.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Tt.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};var st=require("@solana/web3.js"),Kr=U(require("axios"));var si=U(require("bn.js")),Cr=new si.default(1e6);var li=require("@solana/web3.js"),at=U(require("bn.js"));var E=require("@solana/buffer-layout"),mn=E.Layout,ai=E.Structure;var pn=E.UInt;var ui=E.u8,Ze=E.u16;var oe=E.s32;var ci=E.seq;var le=E.blob;var ut=class extends mn{constructor(t,n,i){super(t,i);this.blob=le(t),this.signed=n}decode(t,n=0){let i=new at.default(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new at.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function W(y){return new pn(1,y)}function Se(y){return new pn(4,y)}function P(y){return new ut(8,!1,y)}function V(y){return new ut(16,!1,y)}function mi(y){return new ut(8,!0,y)}function pi(y){return new ut(16,!0,y)}var Ft=class extends mn{constructor(t,n,i,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function B(y){return new Ft(le(32),e=>new li.PublicKey(e),e=>e.toBuffer(),y)}function fe(y){return new Ft(ui(),Rr,Lr,y)}function Rr(y){if(y===0)return!1;if(y===1)return!0;throw new Error("Invalid bool: "+y)}function Lr(y){return y?1:0}var dn=class extends ai{decode(e,t){return super.decode(e,t)}};function C(y,e,t){return new dn(y,e,t)}function X(y,e,t){let n,i=typeof e=="number"?e:(0,at.isBN)(e)?e.toNumber():new Proxy(e,{get(a,o){if(!n){let r=Reflect.get(a,"count");n=(0,at.isBN)(r)?r.toNumber():r,Reflect.set(a,"count",n)}return Reflect.get(a,o)},set(a,o,r){return o==="count"&&(n=r),Reflect.set(a,o,r)}});return ci(y,i,t)}var Zr=require("@solana/web3.js"),Jr=U(require("bn.js")),$r=U(require("decimal.js"));var zt=require("@solana/spl-token");var Nr=require("@solana/web3.js"),di=require("@solana/spl-token");var w=require("@solana/web3.js"),Xt=U(require("bn.js"));var L=require("@solana/spl-token");var Si=U(require("bn.js")),tt=U(require("decimal.js"));var Ke=U(require("bn.js")),se=new Ke.default(0),Ce=new Ke.default(1),Ue=new Ke.default(-1),Re=new Ke.default(1).shln(64),Wt=new Ke.default(1).shln(128),fn=Re.sub(Ce),It=64,fi=Wt.subn(1),ke=-443636,we=-ke,ve=new Ke.default("4295048016"),De=new Ke.default("79226673521066979257578248091"),Vt=new Ke.default("4295048017"),vt=new Ke.default("79226673521066979257578248090"),bi=16,yi="59543866431248",gi="184467440737095516",Pi="15793534762490258745",Dt=new Ke.default(10).pow(new Ke.default(6));var zu=new Ke.default("18446744073700000000");var G=U(require("bn.js")),Ee=U(require("decimal.js"));function _t(y){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,y,!1),new Uint8Array(e)}function bn(y,e){let t=0;for(let n=y-1;n>=0&&!e.testn(n);n--)t++;return t}function yn(y,e){let t=0;for(let n=0;n<y&&!e.testn(n);n++)t++;return t}function ht(y,e){for(let t=0;t<y;t++)if(e.testn(t))return!1;return!0}function ki(y,e){return ht(y,e)?null:bn(y,e)}function Ai(y,e){return ht(y,e)?null:yn(y,e)}var Ju=Buffer.from("amm_config","utf8"),Mr=Buffer.from("pool","utf8"),Or=Buffer.from("pool_vault","utf8"),Er=Buffer.from("pool_reward_vault","utf8"),wi=Buffer.from("position","utf8"),Fr=Buffer.from("tick_array","utf8"),Wr=Buffer.from("operation","utf8"),Vr=Buffer.from("pool_tick_array_bitmap_extension","utf8"),vr=Buffer.from("observation","utf8");function Ti(y,e,t,n){return ge([Mr,e.toBuffer(),t.toBuffer(),n.toBuffer()],y)}function gn(y,e,t){return ge([Or,e.toBuffer(),t.toBuffer()],y)}function Ii(y,e,t){return ge([Er,e.toBuffer(),t.toBuffer()],y)}function Z(y,e,t){return ge([Fr,e.toBuffer(),_t(t)],y)}function Xe(y,e,t,n){return ge([wi,e.toBuffer(),_t(t),_t(n)],y)}function Ie(y,e){return ge([wi,e.toBuffer()],y)}function ct(y){return ge([Buffer.from("metadata","utf8"),He.toBuffer(),y.toBuffer()],He)}function qt(y){return ge([Wr],y)}function me(y,e){return ge([Vr,e.toBuffer()],y)}function hi(y,e){return ge([vr,e.toBuffer()],y)}var Bi=Buffer.from("locked_position","utf8");function Pn(y,e){return ge([Bi,e.toBuffer()],y)}function kn(y,e){return ge([Bi,e.toBuffer()],y)}var $u=Buffer.from("support_mint","utf8");var he=require("@solana/web3.js"),wn=require("@solana/spl-token"),ie=U(require("bn.js")),z=U(require("decimal.js"));var Oe=U(require("bn.js")),Gt=U(require("decimal.js"));var Bt=class{static getfeeGrowthInside(e,t,n){let i=new Oe.default(0),a=new Oe.default(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,a=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new Oe.default(0),r=new Oe.default(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,r=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),r=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let s=q.wrappingSubU128(q.wrappingSubU128(e.feeGrowthGlobalX64A,i),o),l=q.wrappingSubU128(q.wrappingSubU128(e.feeGrowthGlobalX64B,a),r);return{feeGrowthInsideX64A:s,feeGrowthInsideBX64:l}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=q.mulDivFloor(q.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Re),s=t.tokenFeesOwedA.add(r),l=q.mulDivFloor(q.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Re),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=q.mulDivFloor(q.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Re),s=t.tokenFeesOwedA.add(r),l=q.mulDivFloor(q.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Re),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionRewardsV2(e,t,n,i){let a=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=q.wrappingSubU128(s,l.growthInsideLastX64),b=q.mulDivFloor(p,t.liquidity,Re),g=l.rewardAmountOwed.add(b);a.push(g)}return a}static GetPositionRewards(e,t,n,i){let a=[],o=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=q.wrappingSubU128(s,l.growthInsideLastX64),b=q.mulDivFloor(p,t.liquidity,Re),g=l.rewardAmountOwed.add(b);a.push(g)}return a}static getRewardGrowthInside(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Oe.default(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Oe.default(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(q.wrappingSubU128(q.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getRewardGrowthInsideV2(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Oe.default(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Oe.default(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(q.wrappingSubU128(q.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:a,epochInfo:o}){var c,d,I,S;let r=v.priceToSqrtPriceX64(new Gt.default(e.price),e.mintA.decimals,e.mintB.decimals),s=v.getSqrtPriceX64FromTick(t.tickLower),l=v.getSqrtPriceX64FromTick(t.tickUpper),p=a?1+i:1-i,b=Y.getAmountsFromLiquidity(r,s,l,n,a),[g,u]=[ue(b.amountA,(c=e.mintA.extensions)==null?void 0:c.feeConfig,o,!0),ue(b.amountB,(d=e.mintB.extensions)==null?void 0:d.feeConfig,o,!0)],[k,m]=[ue(new Oe.default(new Gt.default(b.amountA.toString()).mul(p).toFixed(0)),(I=e.mintA.extensions)==null?void 0:I.feeConfig,o,!0),ue(new Oe.default(new Gt.default(b.amountB.toString()).mul(p).toFixed(0)),(S=e.mintB.extensions)==null?void 0:S.feeConfig,o,!0)];return{liquidity:n,amountA:g,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:Ge(g.expirationTime,u.expirationTime)}}};var Dr=15,Q=class{static async getTickArrays(e,t,n,i,a,o,r){let s=[],l=R.getTickArrayStartIndexByTick(i,a),p=R.getInitializedTickArrayInRange(o,r,a,l,Math.floor(Dr/2));for(let u=0;u<p.length;u++){let{publicKey:k}=Z(t,n,p[u]);s.push(k)}let b=(await Qe(e,s)).map(u=>u!==null?xt.decode(u.data):null),g={};for(let u=0;u<s.length;u++){let k=b[u];k!==null&&(g[k.startTickIndex]=$(H({},k),{address:s[u]}))}return g}static nextInitializedTick(e,t,n,i,a,o){let{initializedTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}=this.nextInitializedTickInOneArray(e,t,n,i,a,o);for(;r==null||r.liquidityGross.lten(0);){if(l=R.getNextTickArrayStartIndex(l,a,o),this.checkIsValidStartIndex(l,a))throw new Error("No enough initialized tickArray");let p=n[l];if(p===void 0)continue;let{nextTick:b,tickArrayAddress:g,tickArrayStartTickIndex:u}=this.firstInitializedTickInOneArray(e,t,p,o);[r,s,l]=[b,g,u]}if(r==null)throw new Error("No invaild tickArray cache");return{nextTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}}static nextInitializedTickArray(e,t,n,i,a){let o=Math.floor(e/Q.tickCount(t)),r=n?R.searchLowBitFromStart(i,a,o-1,1,t):R.searchHightBitFromStart(i,a,o+1,1,t);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let a;if(i){let r=de-1;for(;r>=0;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r-1}}else{let r=0;for(;r<de;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r+1}}let{publicKey:o}=Z(e,t,n.startTickIndex);return{nextTick:a,tickArrayAddress:o,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,a,o){let r=R.getTickArrayStartIndexByTick(i,a),s=Math.floor((i-r)/a),l=n[r];if(l==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:r};let p;if(o)for(;s>=0;){let g=l.ticks[s];if(g.liquidityGross.gtn(0)){p=g;break}s=s-1}else for(s=s+1;s<de;){let g=l.ticks[s];if(g.liquidityGross.gtn(0)){p=g;break}s=s+1}let{publicKey:b}=Z(e,t,r);return{initializedTick:p,tickArrayAddress:b,tickArrayStartTickIndex:l.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(R.checkIsOutOfBoundary(e)){if(e>we)return!1;let n=R.getTickArrayStartIndexByTick(ke,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return de*e}};var An=14,ze=class{static maxTickInTickarrayBitmap(e){return e*de*Je}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let a=n*i;return e<0?{minValue:-a,maxValue:-a+n}:{minValue:a,maxValue:a+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!Q.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let a=this.maxTickInTickarrayBitmap(n),o=i?t-Q.tickCount(n):t+Q.tickCount(n);if(o<-a||o>=a)return{isInit:!1,tickIndex:t};let r=n*de,s=o/r+512;o<0&&o%r!=0&&s--;let l=Math.abs(s);if(i){let p=e.shln(1024-l-1),b=ki(1024,p);if(b!==null){let g=(l-b-512)*r;return{isInit:!0,tickIndex:g}}else return{isInit:!1,tickIndex:-a}}else{let p=e.shrn(l),b=Ai(1024,p);if(b!==null){let g=(l+b-512)*r;return{isInit:!0,tickIndex:g}}else return{isInit:!1,tickIndex:a-Q.tickCount(n)}}}},St=class{static getBitmapOffset(e,t){if(!Q.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=ze.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;if(we<=t)throw Error(`extensionTickBoundary check error: ${we}, ${t}`);if(n<=ke)throw Error(`extensionTickBoundary check error: ${n}, ${ke}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),a=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:R.mergeTickArrayBitmap(i).testn(a),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let a=Q.tickCount(t),o=n?e-a:e+a,{tickarrayBitmap:r}=this.getBitmap(o,t,i);return this.nextInitializedTickArrayInBitmap(r,o,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:a,maxValue:o}=ze.getBitmapTickBoundary(t,n),r=this.tickArrayOffsetInBitmap(t,n);if(i){let s=R.mergeTickArrayBitmap(e).shln(Je-1-r),l=ht(512,s)?null:bn(512,s);if(l!==null){let p=t-l*Q.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:a}}else{let s=R.mergeTickArrayBitmap(e).shrn(r),l=ht(512,s)?null:yn(512,s);if(l!==null){let p=t+l*Q.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-Q.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%ze.maxTickInTickarrayBitmap(t),i=Math.floor(n/Q.tickCount(t));return e<0&&n!=0&&(i=Je-i),i}};var ae=class{static getOutputAmountAndRemainAccounts(e,t,n,i,a,o=!1){let r=n.toBase58()===e.mintA.address,s=[],{isExist:l,startIndex:p,nextAccountMeta:b}=this.getFirstInitializedTickArray(e,r);if(!l||p===void 0||!b)throw new Error("Invalid tick array");s.push(b);let{allTrade:g,amountCalculated:u,accounts:k,sqrtPriceX64:m,feeAmount:c}=$e.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,r,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,p,a,o);return s.push(...k),{allTrade:g,expectedAmountOut:u.mul(Ue),remainingAccounts:s,executionPrice:m,feeAmount:c}}static getInputAmountAndRemainAccounts(e,t,n,i,a){let o=n.toBase58()===e.mintB.address,r=[],{isExist:s,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,o);if(!s||l===void 0||!p)throw new Error("Invalid tick array");try{let m=this.preInitializedTickArrayStartIndex(e,o);if(m.isExist){let{publicKey:c}=Z(e.programId,e.id,m.nextStartIndex);r.push(c)}}catch{}r.push(p);let{amountCalculated:b,accounts:g,sqrtPriceX64:u,feeAmount:k}=$e.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Ue),l,a);return r.push(...g),{expectedAmountIn:b,remainingAccounts:r,executionPrice:u,feeAmount:k}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=ae.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?St.checkTickArrayIsInit(Q.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):R.checkTickArrayIsInitialized(R.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:r}=Z(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:r}}let{isExist:a,nextStartIndex:o}=this.nextInitializedTickArrayStartIndex(e,Q.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(a){let{publicKey:r}=Z(e.programId,e.id,o);return{isExist:!0,startIndex:o,nextAccountMeta:r}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Q.tickCount(e.tickSpacing)),i=t?R.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):R.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Q.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:a}=ze.nextInitializedTickArrayStartIndex(R.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:a};t=a;let{isInit:o,tickIndex:r}=St.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(o)return{isExist:!0,nextStartIndex:r};if(t=r,t<ke||t>we)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:a}){var r,s,l;let o=[];for(let p=0;p<a.length;p++){let b=a[p],g=(l=(r=t.rewardDefaultInfos[p])==null?void 0:r.mint.programId)!=null?l:(s=await e.getAccountInfo(b.tokenMint))==null?void 0:s.owner;if(g===void 0)throw Error("get new reward mint info error");let u=$(H({},b),{perSecond:q.x64ToDecimal(b.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new he.PublicKey(g)});if(u.tokenMint.equals(he.PublicKey.default))continue;if(n<=u.openTime.toNumber()||i.eq(se)){o.push(u);continue}let k=new ie.default(Math.min(u.endTime.toNumber(),n)),m=k.sub(u.lastUpdateTime),c=q.mulDivFloor(m,u.emissionsPerSecondX64,i),d=u.rewardGrowthGlobalX64.add(c),I=q.mulDivFloor(m,u.emissionsPerSecondX64,Re),S=u.rewardTotalEmissioned.add(I);o.push($(H({},u),{rewardGrowthGlobalX64:d,rewardTotalEmissioned:S,lastUpdateTime:k}))}return o}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let a of t){let o=R.getTickArrayStartIndexByTick(a,e);if(o>=n||o<i)return!0}return!1}static tickRange(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;return t>we&&(t=Q.getArrayStartIndex(we,e)+Q.tickCount(e)),n<ke&&(n=Q.getArrayStartIndex(ke,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Q.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Q.tickCount(t)*Je}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await dt(e,t.map(o=>({pubkey:o})),{batchRequest:n}),a={};for(let o of i)o.accountInfo!==null&&(a[o.pubkey.toString()]=xi.decode(o.accountInfo.data));return a}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},a=[];for(let s of t){let l=R.getTickArrayStartIndexByTick(s.tickCurrent,s.tickSpacing),p=R.getInitializedTickArrayInRange(s.tickArrayBitmap,s.exBitmapInfo,s.tickSpacing,l,7);for(let b of p){let{publicKey:g}=Z(s.programId,s.id,b);a.push({pubkey:g}),i[g.toString()]=s.id}}let o=await dt(e,a,{batchRequest:n}),r={};for(let s of o){if(!s.accountInfo)continue;let l=i[s.pubkey.toString()];if(!l)continue;r[l.toString()]===void 0&&(r[l.toString()]={});let p=xt.decode(s.accountInfo.data);r[l.toString()][p.startTickIndex]=$(H({},p),{address:s.pubkey})}return r}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:a=!0}){var r;let o=[];for(let s=0;s<e.length;s++){let l=e[s];l!==null&&(o.find(p=>p.equals(l.state.programId))||o.push(l.state.programId))}if(n){let s=n.tokenAccounts.map(g=>g.accountInfo.mint),l=[];for(let g of s)for(let u of o)l.push(Ie(u,g).publicKey);let p=await Qe(t,l,{batchRequest:i}),b={};for(let g of p){if(g===null)continue;let u=Tn.decode(g.data),k=u.poolId.toString(),m=e.find(N=>N.state.id.toBase58()===k);if(m===void 0)continue;let c=m.state,d=R._getTickPriceLegacy({poolInfo:c,tick:u.tickLower,baseIn:!0}),I=R._getTickPriceLegacy({poolInfo:c,tick:u.tickUpper,baseIn:!0}),{amountA:S,amountB:M}=Y.getAmountsFromLiquidity(c.sqrtPriceX64,d.tickSqrtPriceX64,I.tickSqrtPriceX64,u.liquidity,!1),F=1/(1-Math.sqrt(Math.sqrt(d.price.div(I.price).toNumber())));m.positionAccount=[...(r=m.positionAccount)!=null?r:[],{poolId:u.poolId,nftMint:u.nftMint,priceLower:d.price,priceUpper:I.price,amountA:S,amountB:M,tickLower:u.tickLower,tickUpper:u.tickUpper,liquidity:u.liquidity,feeGrowthInsideLastX64A:u.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:u.feeGrowthInsideLastX64B,tokenFeesOwedA:u.tokenFeesOwedA,tokenFeesOwedB:u.tokenFeesOwedB,rewardInfos:u.rewardInfos.map(N=>$(H({},N),{pendingReward:new ie.default(0)})),leverage:F,tokenFeeAmountA:new ie.default(0),tokenFeeAmountB:new ie.default(0)}];let T=await R.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickLower,m.state.tickSpacing),K=await R.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickUpper,m.state.tickSpacing);b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickLower}`]=T,b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickUpper}`]=K}if(a){let g=Object.values(b),u=await Qe(t,g,{batchRequest:i}),k={};for(let m=0;m<g.length;m++){let c=u[m];if(c===null)continue;let d=g[m].toString();k[d]=xt.decode(c.data)}for(let{state:m,positionAccount:c}of e)if(!!c)for(let d of c){let I=`${m.programId.toString()}-${m.id.toString()}-${d.tickLower}`,S=`${m.programId.toString()}-${m.id.toString()}-${d.tickUpper}`,M=k[b[I].toString()],F=k[b[S].toString()],T=M.ticks[R.getTickOffsetInArray(d.tickLower,m.tickSpacing)],K=F.ticks[R.getTickOffsetInArray(d.tickUpper,m.tickSpacing)],{tokenFeeAmountA:N,tokenFeeAmountB:_}=await Bt.GetPositionFees(m,d,T,K),h=await Bt.GetPositionRewards(m,d,T,K);d.tokenFeeAmountA=N.gte(new ie.default(0))?N:new ie.default(0),d.tokenFeeAmountB=_.gte(new ie.default(0))?_:new ie.default(0);for(let D=0;D<h.length;D++)d.rewardInfos[D].pendingReward=h[D].gte(new ie.default(0))?h[D]:new ie.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:a,slippage:o,priceLimit:r=new z.default(0),catchLiquidityInsufficient:s=!1}){var ye;let l,p=n.toBase58()===e.mintA.address,[b,g]=p?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];r.equals(new z.default(0))?l=p?ve.add(new ie.default(1)):De.sub(new ie.default(1)):l=v.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let u=ue(a,b,i,!1),{allTrade:k,expectedAmountOut:m,remainingAccounts:c,executionPrice:d,feeAmount:I}=ae.getOutputAmountAndRemainAccounts(e,t,n,u.amount.sub((ye=u.fee)!=null?ye:se),l,s),S=ue(m,g,i,!1),M=v.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),F=p?M:new z.default(1).div(M),T=m.mul(new ie.default(Math.floor((1-o)*1e10))).div(new ie.default(1e10)),K=ue(T,g,i,!1),N=p?e.currentPrice:new z.default(1).div(e.currentPrice),_=new z.default(F).sub(N).abs(),h=N,D=new qe(new z.default(_).mul(10**15).toFixed(0),new z.default(h).mul(10**15).toFixed(0));return{allTrade:k,realAmountIn:u,amountOut:S,minAmountOut:K,expirationTime:Ge(u.expirationTime,S.expirationTime),currentPrice:e.currentPrice,executionPrice:F,priceImpact:D,fee:I,remainingAccounts:c,executionPriceX64:d}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:a,epochInfo:o,catchLiquidityInsufficient:r=!1}){let s=i.address===e.mintB.address,[l,p]=s?[e.mintA,e.mintB]:[e.mintB,e.mintA],[b,g]=[new Me($(H({},l),{mint:l.address,isToken2022:l.programId===wn.TOKEN_2022_PROGRAM_ID.toBase58()})),new Me($(H({},p),{mint:p.address,isToken2022:p.programId===wn.TOKEN_2022_PROGRAM_ID.toBase58()}))],{allTrade:u,realAmountIn:k,amountOut:m,minAmountOut:c,expirationTime:d,currentPrice:I,executionPrice:S,priceImpact:M,fee:F,remainingAccounts:T,executionPriceX64:K}=ae.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new he.PublicKey(l.address),amountIn:n,slippage:a,epochInfo:o,catchLiquidityInsufficient:r}),N=$(H({},k),{amount:new pe(b,k.amount),fee:k.fee===void 0?void 0:new pe(b,k.fee)}),_=$(H({},m),{amount:new pe(g,m.amount),fee:m.fee===void 0?void 0:new pe(g,m.fee)}),h=$(H({},c),{amount:new pe(g,c.amount),fee:c.fee===void 0?void 0:new pe(g,c.fee)}),D=new Be({baseToken:b,denominator:new ie.default(10).pow(new ie.default(20+b.decimals)),quoteToken:g,numerator:I.mul(new z.default(10**(20+g.decimals))).toFixed(0)}),ye=new Be({baseToken:b,denominator:new ie.default(10).pow(new ie.default(20+b.decimals)),quoteToken:g,numerator:S.mul(new z.default(10**(20+g.decimals))).toFixed(0)}),ce=new pe(b,F);return{allTrade:u,realAmountIn:N,amountOut:_,minAmountOut:h,expirationTime:d,currentPrice:D,executionPrice:ye,priceImpact:M,fee:ce,remainingAccounts:T,executionPriceX64:K}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:a,slippage:o,priceLimit:r=new z.default(0)}){var h;let s=n.toBase58()===e.mintA.address,l={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},p;r.equals(new z.default(0))?p=s?De.sub(new ie.default(1)):ve.add(new ie.default(1)):p=v.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let b=ue(a,l[n.toString()],i,!0),{expectedAmountIn:g,remainingAccounts:u,executionPrice:k,feeAmount:m}=ae.getInputAmountAndRemainAccounts(e,t,n,b.amount.sub((h=b.fee)!=null?h:se),p),c=s?e.mintB.address:e.mintA.address,d=ue(g,l[c],i,!1),I=v.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),S=s?I:new z.default(1).div(I),M=g.mul(new ie.default(Math.floor((1+o)*1e10))).div(new ie.default(1e10)),F=ue(M,l[c],i,!0),T=s?e.currentPrice:new z.default(1).div(e.currentPrice),K=new z.default(S).sub(T).abs(),N=T,_=new qe(new z.default(K).mul(10**15).toFixed(0),new z.default(N).mul(10**15).toFixed(0));return{amountIn:d,maxAmountIn:F,realAmountOut:b,expirationTime:Ge(d.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:S,priceImpact:_,fee:m,remainingAccounts:u}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var k,m,c;let a=e[t],o=R.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),r=R.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),s=Math.max(o,a.priceMin),p=Math.min(r,a.priceMax)-s,b=r-o,g=a.priceMax-a.priceMin,u;return p<=0?u=0:b===p?u=g/p:g===p?u=p/b:u=p/g*(p/b),{feeApr:a.feeApr*u,rewardsApr:[((k=a.rewardApr[0])!=null?k:0)*u,((m=a.rewardApr[1])!=null?m:0)*u,((c=a.rewardApr[2])!=null?c:0)*u],apr:a.apr*u}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:a,positionTickLowerIndex:o,positionTickUpperIndex:r,chainTime:s}){let l=n==="day"?1:n==="week"?7:n==="month"?30:0,p=e[n],b=i[rt(e.mintA.address).toString()],g=i[rt(e.mintB.address).toString()],u=e.mintA.decimals,k=e.mintB.decimals;if(!p||!b||!g)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let m=v.priceToSqrtPriceX64(new z.default(e.price),e.mintA.decimals,e.mintB.decimals),c=v.getSqrtPriceX64FromTick(o),d=v.getSqrtPriceX64FromTick(r),{amountSlippageA:I,amountSlippageB:S}=Y.getAmountsFromLiquidityWithSlippage(m,c,d,t,!1,!1,0),{amountSlippageA:M,amountSlippageB:F}=Y.getAmountsFromLiquidityWithSlippage(m,c,d,a,!1,!1,0),T=new z.default(I.toString()).div(new z.default(10).pow(u)).mul(b.value).add(new z.default(S.toString()).div(new z.default(10).pow(k)).mul(g.value)),K=new z.default(M.toString()).div(new z.default(10).pow(u)).mul(b.value).add(new z.default(F.toString()).div(new z.default(10).pow(k)).mul(g.value)),N=new z.default(1).div(T.add(K)),h=new z.default(p.volumeFee).mul(365).div(l).mul(N).mul(100).toNumber(),D=3600*24*365,ye=e.rewardDefaultInfos.map(ce=>{var Ln,Nn;let Te=ce.mint.decimals,it=i[ce.mint.address];return s<((Ln=ce.startTime)!=null?Ln:0)||s>((Nn=ce.endTime)!=null?Nn:0)||!ce.perSecond||!it||Te===void 0?0:new z.default(it.value).mul(new z.default(ce.perSecond).mul(D)).div(new z.default(10).pow(Te)).mul(N).mul(100).toNumber()});return{feeApr:h,rewardsApr:ye,apr:h+ye.reduce((ce,Te)=>ce+Te,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:a,slippage:o,add:r,epochInfo:s,amountHasFee:l}){var d,I;let p=v.priceToSqrtPriceX64(new z.default(e.price),e.mintA.decimals,e.mintB.decimals),b=v.getSqrtPriceX64FromTick(n),g=v.getSqrtPriceX64FromTick(i),u=ue(a,(d=e[t?"mintA":"mintB"].extensions)==null?void 0:d.feeConfig,s,!l),k=new ie.default(new z.default(u.amount.sub((I=u.fee)!=null?I:se).toString()).toFixed(0)),m;if(p.lte(b))m=t?Y.getLiquidityFromTokenAmountA(b,g,k,!r):new ie.default(0);else if(p.lte(g)){let S=Y.getLiquidityFromTokenAmountA(p,g,k,!r),M=Y.getLiquidityFromTokenAmountB(b,p,k);m=t?S:M}else m=t?new ie.default(0):Y.getLiquidityFromTokenAmountB(b,g,k);let c=await ae.getAmountsFromLiquidity({epochInfo:s,poolInfo:e,tickLower:n,tickUpper:i,liquidity:m,slippage:o,add:r});return{liquidity:m,amountA:t?u:c.amountA,amountB:t?c.amountB:u,amountSlippageA:t?u:c.amountSlippageA,amountSlippageB:t?c.amountSlippageB:u,expirationTime:c.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:a,slippage:o,add:r}){var c,d,I,S;let s=v.getSqrtPriceX64FromTick(n),l=v.getSqrtPriceX64FromTick(i),p=r?1+o:1-o,b=Y.getAmountsFromLiquidity(v.priceToSqrtPriceX64(new z.default(t.price),t.mintA.decimals,t.mintB.decimals),s,l,a,r),[g,u]=[ue(b.amountA,(c=t.mintA.extensions)==null?void 0:c.feeConfig,e,!0),ue(b.amountB,(d=t.mintB.extensions)==null?void 0:d.feeConfig,e,!0)],[k,m]=[ue(b.amountA.muln(p),(I=t.mintA.extensions)==null?void 0:I.feeConfig,e,!0),ue(b.amountB.muln(p),(S=t.mintB.extensions)==null?void 0:S.feeConfig,e,!0)];return{liquidity:a,amountA:g,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:Ge(g.expirationTime,u.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(s=>!n[s.id]).map(s=>new he.PublicKey(s.id));(await Qe(e,i)).forEach((s,l)=>{!s||(n[i[l].toBase58()]=Ut.decode(s.data))});let o=t.map(s=>me(new he.PublicKey(s.programId),new he.PublicKey(s.id)).publicKey),r=await ae.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((s,l)=>$(H({},s),{[l.id]:$(H({},n[l.id]),{id:new he.PublicKey(l.id),version:6,programId:new he.PublicKey(l.programId),mintA:l.mintA,mintB:l.mintB,ammConfig:$(H({},l.config),{id:new he.PublicKey(l.config.id),fundOwner:""}),currentPrice:new z.default(l.price),exBitmapAccount:me(new he.PublicKey(l.programId),new he.PublicKey(l.id)).publicKey,exBitmapInfo:r[me(new he.PublicKey(l.programId),new he.PublicKey(l.id)).publicKey.toBase58()],startTime:n[l.id].startTime.toNumber(),rewardInfos:n[l.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var q=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),a=i.div(n);return i.mod(n).eq(se)||(a=a.add(Ce)),a}static mulDivFloor(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).add(n.sub(Ce)).div(n)}static x64ToDecimal(e,t){return new Ee.default(e.toString()).div(Ee.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new G.default(e.mul(Ee.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Wt).sub(t).mod(Wt)}};function be(y,e){return In(y.mul(e),64,256)}function _r(y,e,t){let n=y.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function In(y,e,t){let n=y.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var v=class{static sqrtPriceX64ToPrice(e,t,n){return q.x64ToDecimal(e).pow(2).mul(Ee.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return q.decimalToX64(e.mul(Ee.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(se))return e;let a=t.shln(It);if(i){let o=a,r=a.add(n.mul(e));return r.gte(o)?q.mulDivCeil(o,e,r):q.mulDivRoundingUp(o,Ce,o.div(e).add(n))}else{let o=n.mul(e);if(!a.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let r=a.sub(o);return q.mulDivCeil(a,e,r)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let a=n.shln(It);if(i)return e.add(a.div(t));{let o=q.mulDivRoundingUp(a,Ce,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<ke||e>we)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new G.default("18445821805675395072"):new G.default("18446744073709551616");return(t&2)!=0&&(n=be(n,new G.default("18444899583751176192"))),(t&4)!=0&&(n=be(n,new G.default("18443055278223355904"))),(t&8)!=0&&(n=be(n,new G.default("18439367220385607680"))),(t&16)!=0&&(n=be(n,new G.default("18431993317065453568"))),(t&32)!=0&&(n=be(n,new G.default("18417254355718170624"))),(t&64)!=0&&(n=be(n,new G.default("18387811781193609216"))),(t&128)!=0&&(n=be(n,new G.default("18329067761203558400"))),(t&256)!=0&&(n=be(n,new G.default("18212142134806163456"))),(t&512)!=0&&(n=be(n,new G.default("17980523815641700352"))),(t&1024)!=0&&(n=be(n,new G.default("17526086738831433728"))),(t&2048)!=0&&(n=be(n,new G.default("16651378430235570176"))),(t&4096)!=0&&(n=be(n,new G.default("15030750278694412288"))),(t&8192)!=0&&(n=be(n,new G.default("12247334978884435968"))),(t&16384)!=0&&(n=be(n,new G.default("8131365268886854656"))),(t&32768)!=0&&(n=be(n,new G.default("3584323654725218816"))),(t&65536)!=0&&(n=be(n,new G.default("696457651848324352"))),(t&131072)!=0&&(n=be(n,new G.default("26294789957507116"))),(t&262144)!=0&&(n=be(n,new G.default("37481735321082"))),e>0&&(n=fi.div(n)),n}static getTickFromPrice(e,t,n){return v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(De)||e.lt(ve))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new G.default(t-64),i=_r(n,32,128),a=new G.default("8000000000000000","hex"),o=0,r=new G.default(0),s=t>=64?e.shrn(t-63):e.shln(63-t);for(;a.gt(new G.default(0))&&o<bi;){s=s.mul(s);let k=s.shrn(127);s=s.shrn(63+k.toNumber()),r=r.add(a.mul(k)),a=a.shrn(1),o+=1}let l=r.shrn(32),b=i.add(l).mul(new G.default(yi)),g=In(b.sub(new G.default(gi)),64,128).toNumber(),u=In(b.add(new G.default(Pi)),64,128).toNumber();return g==u?g:v.getSqrtPriceX64FromTick(u).lte(e)?u:g}},et=class{static getTickWithPriceAndTickspacing(e,t,n,i){let o=v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,n,i))/t;return o<0?o=Math.floor(o):o=Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,i){let a=et.getTickWithPriceAndTickspacing(e,t,n,i),o=v.getSqrtPriceX64FromTick(a);return v.sqrtPriceX64ToPrice(o,n,i)}},Y=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");let a=n.ushln(It),o=t.sub(e);return i?q.mulDivRoundingUp(q.mulDivCeil(a,o,t),Ce,e):q.mulDivFloor(a,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");return i?q.mulDivCeil(n,t.sub(e),Re):q.mulDivFloor(n,t.sub(e),Re)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let a=n.mul(e).mul(t),o=t.sub(e),r=a.div(o);return i?q.mulDivRoundingUp(r,Ce,fn):r.shrn(It)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),q.mulDivFloor(n,fn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Y.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let o=Y.getLiquidityFromTokenAmountA(e,n,i,!1),r=Y.getLiquidityFromTokenAmountB(t,e,a);return o.lt(r)?o:r}else return Y.getLiquidityFromTokenAmountB(t,n,a)}static getAmountsFromLiquidity(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Y.getTokenAmountAFromLiquidity(t,n,i,a),amountB:new G.default(0)};if(e.lt(n)){let o=Y.getTokenAmountAFromLiquidity(e,n,i,a),r=Y.getTokenAmountBFromLiquidity(t,e,i,a);return{amountA:o,amountB:r}}else return{amountA:new G.default(0),amountB:Y.getTokenAmountBFromLiquidity(t,n,i,a)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,a,o,r){let{amountA:s,amountB:l}=Y.getAmountsFromLiquidity(e,t,n,i,o),p=a?1+r:1-r,b=new G.default(new Ee.default(s.toString()).mul(p).toFixed(0)),g=new G.default(new Ee.default(l.toString()).mul(p).toFixed(0));return{amountSlippageA:b,amountSlippageB:g}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:a,add:o,epochInfo:r,amountAddFee:s}){var I,S,M,F;let l=v.priceToSqrtPriceX64(new Ee.default(e.price),e.mintA.decimals,e.mintB.decimals),p=v.getSqrtPriceX64FromTick(t),b=v.getSqrtPriceX64FromTick(n),g=o?1+a:1-a,u=Y.getAmountsFromLiquidity(l,p,b,i,o),[k,m]=[ue(u.amountA,(I=e.mintA.extensions)==null?void 0:I.feeConfig,r,s),ue(u.amountB,(S=e.mintB.extensions)==null?void 0:S.feeConfig,r,s)],[c,d]=[ue(new G.default(new Ee.default(u.amountA.toString()).mul(g).toFixed(0)),(M=e.mintA.extensions)==null?void 0:M.feeConfig,r,s),ue(new G.default(new Ee.default(u.amountB.toString()).mul(g).toFixed(0)),(F=e.mintB.extensions)==null?void 0:F.feeConfig,r,s)];return{liquidity:i,amountA:k,amountB:m,amountSlippageA:c,amountSlippageB:d,expirationTime:Ge(k.expirationTime,m.expirationTime)}}},$e=class{static swapCompute(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m=!1){if(g.eq(se))throw new Error("amountSpecified must not be 0");if(k||(k=o?ve.add(Ce):De.sub(Ce)),o){if(k.lt(ve))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(k.gte(b))throw new Error("sqrtPriceX64 must smaller than current")}else{if(k.gt(De))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(k.lte(b))throw new Error("sqrtPriceX64 must greater than current")}let c=g.gt(se),d={amountSpecifiedRemaining:g,amountCalculated:se,sqrtPriceX64:b,tick:l>u?Math.min(u+Q.tickCount(p)-1,l):u,accounts:[],liquidity:s,feeAmount:new G.default(0)},I=u,S=n[u],M=0,F=!o&&S.startTickIndex===d.tick;for(;!d.amountSpecifiedRemaining.eq(se)&&!d.sqrtPriceX64.eq(k);){M>10;let T={};T.sqrtPriceStartX64=d.sqrtPriceX64;let K=R.nextInitTick(S,d.tick,p,o,F),N=K||null,_=null;if(!(N!=null&&N.liquidityGross.gtn(0))){let D=ae.nextInitializedTickArrayStartIndex({tickCurrent:d.tick,tickSpacing:p,tickArrayBitmap:i,exBitmapInfo:a},I,o);if(!D.isExist){if(m)return{allTrade:!1,amountSpecifiedRemaining:d.amountSpecifiedRemaining,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts};throw Error("swapCompute LiquidityInsufficient")}I=D.nextStartIndex;let{publicKey:ye}=Z(e,t,I);_=ye,S=n[I];try{N=R.firstInitializedTick(S,o)}catch{throw Error("not found next tick info")}}T.tickNext=N.tick,T.initialized=N.liquidityGross.gtn(0),u!==I&&_&&(d.accounts.push(_),u=I),T.tickNext<ke?T.tickNext=ke:T.tickNext>we&&(T.tickNext=we),T.sqrtPriceNextX64=v.getSqrtPriceX64FromTick(T.tickNext);let h;if(o&&T.sqrtPriceNextX64.lt(k)||!o&&T.sqrtPriceNextX64.gt(k)?h=k:h=T.sqrtPriceNextX64,[d.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=$e.swapStepCompute(d.sqrtPriceX64,h,d.liquidity,d.amountSpecifiedRemaining,r,o),d.feeAmount=d.feeAmount.add(T.feeAmount),c?(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),d.amountCalculated=d.amountCalculated.sub(T.amountOut)):(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.add(T.amountOut),d.amountCalculated=d.amountCalculated.add(T.amountIn.add(T.feeAmount))),d.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let D=N.liquidityNet;o&&(D=D.mul(Ue)),d.liquidity=Y.addDelta(d.liquidity,D)}F=T.tickNext!=d.tick&&!o&&S.startTickIndex===T.tickNext,d.tick=o?T.tickNext-1:T.tickNext}else if(d.sqrtPriceX64!=T.sqrtPriceStartX64){let D=v.getTickFromSqrtPriceX64(d.sqrtPriceX64);F=D!=d.tick&&!o&&S.startTickIndex===D,d.tick=D}++M}try{let{nextStartIndex:T,isExist:K}=Q.nextInitializedTickArray(d.tick,p,o,i,a);K&&u!==T&&(d.accounts.push(Z(e,t,T).publicKey),u=T)}catch{}return{allTrade:!0,amountSpecifiedRemaining:se,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts}}static swapStepCompute(e,t,n,i,a,o){let r={sqrtPriceX64Next:new G.default(0),amountIn:new G.default(0),amountOut:new G.default(0),feeAmount:new G.default(0)},s=i.gte(se);if(s){let p=q.mulDivFloor(i,Dt.sub(new G.default(a.toString())),Dt);r.amountIn=o?Y.getTokenAmountAFromLiquidity(t,e,n,!0):Y.getTokenAmountBFromLiquidity(e,t,n,!0),p.gte(r.amountIn)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=v.getNextSqrtPriceX64FromInput(e,n,p,o)}else r.amountOut=o?Y.getTokenAmountBFromLiquidity(t,e,n,!1):Y.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Ue).gte(r.amountOut)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=v.getNextSqrtPriceX64FromOutput(e,n,i.mul(Ue),o);let l=t.eq(r.sqrtPriceX64Next);return o?(l&&s||(r.amountIn=Y.getTokenAmountAFromLiquidity(r.sqrtPriceX64Next,e,n,!0)),l&&!s||(r.amountOut=Y.getTokenAmountBFromLiquidity(r.sqrtPriceX64Next,e,n,!1))):(r.amountIn=l&&s?r.amountIn:Y.getTokenAmountBFromLiquidity(e,r.sqrtPriceX64Next,n,!0),r.amountOut=l&&!s?r.amountOut:Y.getTokenAmountAFromLiquidity(e,r.sqrtPriceX64Next,n,!1)),!s&&r.amountOut.gt(i.mul(Ue))&&(r.amountOut=i.mul(Ue)),s&&!r.sqrtPriceX64Next.eq(t)?r.feeAmount=i.sub(r.amountIn):r.feeAmount=q.mulDivCeil(r.amountIn,new G.default(a),Dt.sub(new G.default(a))),[r.sqrtPriceX64Next,r.amountIn,r.amountOut,r.feeAmount]}};var de=60,Je=512,R=class{static getTickArrayAddressByTick(e,t,n,i){let a=R.getTickArrayStartIndexByTick(n,i),{publicKey:o}=Z(e,t,a);return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=R.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=de)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=Q.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Q.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*de,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*de,a=Math.floor(t/i)+512,o=Math.abs(a);return{isInitialized:e.testn(o),startIndex:(o-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*de:e+t*de}static mergeTickArrayBitmap(e){let t=new Si.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,a){let o=Math.floor(i/(n*de));return[...R.searchLowBitFromStart(e,t,o-1,a,n),...R.searchHightBitFromStart(e,t,o,a,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return R.searchHightBitFromStart(e,t,-7680,Je,n)}static getAllInitializedTickArrayInfo(e,t,n,i,a){let o=[],r=R.getAllInitializedTickArrayStartIndex(n,i,a);for(let s of r){let{publicKey:l}=Z(e,t,s);o.push({tickArrayStartIndex:s,tickArrayAddress:l})}return o}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>R.mergeTickArrayBitmap(l)),r=[];for(;n>=-7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n--,r.length===i)break}let s=Q.tickCount(a);return r.map(l=>l*s)}static searchHightBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>R.mergeTickArrayBitmap(l)),r=[];for(;n<7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n++,r.length===i)break}let s=Q.tickCount(a);return r.map(l=>l*s)}static checkIsOutOfBoundary(e){return e<ke||e>we}static nextInitTick(e,t,n,i,a){if(Q.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let r=Math.floor((t-e.startTickIndex)/n);if(i)for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r-1}else for(a||(r=r+1);r<de;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r+1}return null}static firstInitializedTick(e,t){if(t){let n=de-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<de;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),a=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new tt.default(1).div(a),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new tt.default(1).div(t),a=et.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=v.getSqrtPriceX64FromTick(a),r=v.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new tt.default(1).div(r)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),a=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new tt.default(1).div(a),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new tt.default(1).div(t),a=et.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=v.getSqrtPriceX64FromTick(a),r=v.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new tt.default(1).div(r)}}};var qr=C([le(8),W("bump"),Ze("index"),B(""),Se("protocolFeeRate"),Se("tradeFeeRate"),Ze("tickSpacing"),X(P(),8,"")]),Gr=C([Se("blockTimestamp"),mi("tickCumulative"),X(P(),4)]),Ki=C([le(8),fe("initialized"),P("recentEpoch"),Ze("observationIndex"),B("poolId"),X(Gr,100,"observations"),X(P(),4)]),Ur=C([W("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),V("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),B("tokenMint"),B("tokenVault"),B("creator"),V("rewardGrowthGlobalX64")]),Ut=C([le(8),W("bump"),B("ammConfig"),B("creator"),B("mintA"),B("mintB"),B("vaultA"),B("vaultB"),B("observationId"),W("mintDecimalsA"),W("mintDecimalsB"),Ze("tickSpacing"),V("liquidity"),V("sqrtPriceX64"),oe("tickCurrent"),Se(),V("feeGrowthGlobalX64A"),V("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),V("swapInAmountTokenA"),V("swapOutAmountTokenB"),V("swapInAmountTokenB"),V("swapOutAmountTokenA"),W("status"),X(W(),7,""),X(Ur,3,"rewardInfos"),X(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),X(P(),15*4-3,"padding")]),Xr=C([V("growthInsideLastX64"),P("rewardAmountOwed")]),Tn=C([le(8),W("bump"),B("nftMint"),B("poolId"),oe("tickLower"),oe("tickUpper"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),X(Xr,3,"rewardInfos"),X(P(),8,"")]),Zc=C([le(8),W("bump"),B("poolId"),oe("tickLowerIndex"),oe("tickUpperIndex"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),X(V(),3,"rewardGrowthInside"),X(P(),8,"")]),zr=C([oe("tick"),pi("liquidityNet"),V("liquidityGross"),V("feeGrowthOutsideX64A"),V("feeGrowthOutsideX64B"),X(V(),3,"rewardGrowthsOutsideX64"),X(Se(),13,"")]),xt=C([le(8),B("poolId"),oe("startTickIndex"),X(zr,de,"ticks"),W("initializedTickCount"),X(W(),115,"")]),Qr=C([le(329),X(B(),100,"whitelistMints")]),xi=C([le(8),B("poolId"),X(X(P(),8),An,"positiveTickArrayBitmap"),X(X(P(),8),An,"negativeTickArrayBitmap")]),Jc=C([P(),W("bump"),B("owner"),B("poolId"),B("positionId"),B("nftAccount"),X(P(),8)]),Yr=C([le(8),W("bump"),B("lockOwner"),B("poolId"),B("positionId"),B("nftAccount"),B("lockNftMint"),P("recentEpoch"),X(P(),8)]);Ki.span;var Ci=ne("Raydium_Clmm"),Le={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Ri=[188,37,179,131,82,150,84,73],Li=[16,72,250,198,14,162,212,19],nt=class{static createPoolInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k){let m=C([V("sqrtPriceX64"),P("zero")]),c=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1},...(k==null?void 0:k.map(S=>({pubkey:S,isSigner:!1,isWritable:!1})))||[]],d=Buffer.alloc(m.span);m.encode({sqrtPriceX64:u,zero:se},d);let I=Buffer.from([...Le.createPool,...d]);return new w.TransactionInstruction({keys:c,programId:e,data:I})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:a,ammConfigId:o,initialPriceX64:r,extendMintAccount:s}=e,[l,p]=[new w.PublicKey(i.address),new w.PublicKey(a.address)],{publicKey:b}=Ti(t,o,l,p),{publicKey:g}=hi(t,b),{publicKey:u}=gn(t,b,l),{publicKey:k}=gn(t,b,p),m=me(t,b).publicKey,c=[this.createPoolInstruction(t,b,n,o,g,l,u,new w.PublicKey(i.programId||L.TOKEN_PROGRAM_ID),p,k,new w.PublicKey(a.programId||L.TOKEN_PROGRAM_ID),m,r,s)];return{signers:[],instructions:c,instructionTypes:[ee.CreateAccount,ee.ClmmCreatePool],address:{poolId:b,observationId:g,exBitmapAccount:m,mintAVault:u,mintBVault:k},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,I,S,M,F,T,K,N,_,h){let D=C([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),P("amountMaxA"),P("amountMaxB"),fe("withMetadata"),W("optionBaseFlag"),fe("baseFlag")]),ye=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...ye],Te=Buffer.alloc(D.span);D.encode({tickLowerIndex:I,tickUpperIndex:S,tickArrayLowerStartIndex:M,tickArrayUpperStartIndex:F,liquidity:T,amountMaxA:K,amountMaxB:N,withMetadata:_==="create",baseFlag:!1,optionBaseFlag:0},Te);let it=Buffer.from([...Le.openPosition,...Te]);return new w.TransactionInstruction({keys:ce,programId:e,data:it})}static openPositionFromLiquidityInstruction22(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,I,S,M,F,T,K,N,_){let h=C([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),P("amountMaxA"),P("amountMaxB"),fe("withMetadata"),W("optionBaseFlag"),fe("baseFlag")]),D=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...D],ce=Buffer.alloc(h.span);h.encode({tickLowerIndex:d,tickUpperIndex:I,tickArrayLowerStartIndex:S,tickArrayUpperStartIndex:M,liquidity:F,amountMaxA:T,amountMaxB:K,withMetadata:N==="create",baseFlag:!1,optionBaseFlag:0},ce);let Te=Buffer.from([...Le.openPositionWithTokenEx,...ce]);return new w.TransactionInstruction({keys:ye,programId:e,data:Te})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g=[],[u,k]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],m;if(p)m=new w.PublicKey((await p(1))[0]);else{let _=w.Keypair.generate();g.push(_),m=_.publicKey}let c=R.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:I}=Z(u,k,c),{publicKey:S}=Z(u,k,d),{publicKey:M}=b?te(n.wallet,m,L.TOKEN_2022_PROGRAM_ID):te(n.wallet,m,L.TOKEN_PROGRAM_ID),{publicKey:F}=ct(m),{publicKey:T}=Ie(u,m),{publicKey:K}=Xe(u,k,i,a),N=b?this.openPositionFromLiquidityInstruction22(u,n.feePayer,k,n.wallet,m,M,K,I,S,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0):this.openPositionFromLiquidityInstruction(u,n.feePayer,k,n.wallet,m,M,F,K,I,S,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0);return{signers:g,instructions:[N],instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:m,tickArrayLower:I,tickArrayUpper:S,positionNftAccount:M,metadataAccount:F,personalPosition:T,protocolPosition:K}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,base:o,baseAmount:r,otherAmountMax:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g=[],[u,k]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],m;if(p)m=new w.PublicKey((await p(1))[0]);else{let _=w.Keypair.generate();g.push(_),m=_.publicKey}let c=R.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:I}=Z(u,k,c),{publicKey:S}=Z(u,k,d),{publicKey:M}=b?te(n.wallet,m,L.TOKEN_2022_PROGRAM_ID):te(n.wallet,m,L.TOKEN_PROGRAM_ID),{publicKey:F}=ct(m),{publicKey:T}=Ie(u,m),{publicKey:K}=Xe(u,k,i,a),N=b?this.openPositionFromBaseInstruction22(u,n.feePayer,k,n.wallet,m,M,K,I,S,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,l,o,r,s,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0):this.openPositionFromBaseInstruction(u,n.feePayer,k,n.wallet,m,M,F,K,I,S,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),i,a,c,d,l,o,r,s,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:I,tickArrayUpper:S,positionNftAccount:M,metadataAccount:F,personalPosition:T,protocolPosition:K},instructions:[N],signers:g,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,I,S,M,F,T,K,N,_,h){let D=C([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),P("amountMaxA"),P("amountMaxB"),fe("withMetadata"),W("optionBaseFlag"),fe("baseFlag")]),ye=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...ye],Te=Buffer.alloc(D.span);D.encode({tickLowerIndex:I,tickUpperIndex:S,tickArrayLowerStartIndex:M,tickArrayUpperStartIndex:F,liquidity:new Xt.default(0),amountMaxA:K==="MintA"?N:_,amountMaxB:K==="MintA"?_:N,withMetadata:T==="create",baseFlag:K==="MintA",optionBaseFlag:1},Te);let it=Buffer.from([...Le.openPosition,...Te]);return new w.TransactionInstruction({keys:ce,programId:e,data:it})}static openPositionFromBaseInstruction22(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,I,S,M,F,T,K,N,_){let h=C([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),P("amountMaxA"),P("amountMaxB"),fe("withMetadata"),W("optionBaseFlag"),fe("baseFlag")]),D=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...D],ce=Buffer.alloc(h.span);h.encode({tickLowerIndex:d,tickUpperIndex:I,tickArrayLowerStartIndex:S,tickArrayUpperStartIndex:M,liquidity:new Xt.default(0),amountMaxA:T==="MintA"?K:N,amountMaxB:T==="MintA"?N:K,withMetadata:F==="create",baseFlag:T==="MintA",optionBaseFlag:1},ce);let Te=Buffer.from([...Le.openPositionWithTokenEx,...ce]);return new w.TransactionInstruction({keys:ye,programId:e,data:Te})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g,u=[];if(p)g=new w.PublicKey((await p(1))[0]);else{let _=w.Keypair.generate();u.push(_),g=_.publicKey}let[k,m]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],c=R.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:I}=Z(k,m,c),{publicKey:S}=Z(k,m,d),{publicKey:M}=b?te(n.wallet,g,L.TOKEN_2022_PROGRAM_ID):te(n.wallet,g,L.TOKEN_PROGRAM_ID),{publicKey:F}=ct(g),{publicKey:T}=Ie(k,g),{publicKey:K}=Xe(k,m,i,a),N=b?this.openPositionFromLiquidityInstruction22(k,n.wallet,m,n.wallet,g,M,K,I,S,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(t.mintA.address),new w.PublicKey(t.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(k,m).publicKey:void 0):this.openPositionFromLiquidityInstruction(k,n.wallet,m,n.wallet,g,M,F,K,I,S,T,n.tokenAccountA,n.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(t.mintA.address),new w.PublicKey(t.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(k,m).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:I,tickArrayUpper:S,positionNftAccount:M,metadataAccount:F,personalPosition:T,protocolPosition:K},instructions:[N],signers:u,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,a,o){let r=C([]),s=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:o?L.TOKEN_2022_PROGRAM_ID:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],l=Buffer.alloc(r.span);r.encode({},l);let p=Buffer.from([...Le.closePosition,...l]);return new w.TransactionInstruction({keys:s,programId:e,data:p})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:a}){let o=new w.PublicKey(e.programId),r=a?te(n.wallet,i.nftMint,L.TOKEN_2022_PROGRAM_ID).publicKey:te(n.wallet,i.nftMint,L.TOKEN_PROGRAM_ID).publicKey,{publicKey:s}=Ie(o,i.nftMint),l=[];return l.push(this.closePositionInstruction(o,n.wallet,i.nftMint,r,s,a)),{address:{positionNftAccount:r,personalPosition:s},signers:[],instructions:l,instructionTypes:[ee.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,I){let S=C([V("liquidity"),P("amountMaxA"),P("amountMaxB"),W("optionBaseFlag"),fe("baseFlag")]),M=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],F=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...M],T=Buffer.alloc(S.span);S.encode({liquidity:m,amountMaxA:c,amountMaxB:d,optionBaseFlag:0,baseFlag:!1},T);let K=Buffer.from([...Le.increaseLiquidity,...T]);return new w.TransactionInstruction({keys:F,programId:e,data:K})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMaxA:o,amountMaxB:r,nft2022:s}){let[l,p]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],b=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),g=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Z(l,p,b),{publicKey:k}=Z(l,p,g),{publicKey:m}=s?te(i.wallet,n.nftMint,L.TOKEN_2022_PROGRAM_ID):te(i.wallet,n.nftMint,L.TOKEN_PROGRAM_ID),{publicKey:c}=Ie(l,n.nftMint),{publicKey:d}=Xe(l,p,n.tickLower,n.tickUpper),I=this.increasePositionFromLiquidityInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?me(l,p).publicKey:void 0);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},signers:[],instructions:[I],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:a,baseAmount:o,otherAmountMax:r,nft2022:s}){let[l,p]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],b=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),g=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Z(l,p,b),{publicKey:k}=Z(l,p,g),{publicKey:m}=s?te(i.wallet,n.nftMint,L.TOKEN_2022_PROGRAM_ID):te(i.wallet,n.nftMint,L.TOKEN_PROGRAM_ID),{publicKey:c}=Ie(l,n.nftMint),{publicKey:d}=Xe(l,p,n.tickLower,n.tickUpper);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},instructions:[this.increasePositionFromBaseInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?me(l,p).publicKey:void 0)],signers:[],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,I){let S=C([V("liquidity"),P("amountMaxA"),P("amountMaxB"),W("optionBaseFlag"),fe("baseFlag")]),M=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],F=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...M],T=Buffer.alloc(S.span);S.encode({liquidity:new Xt.default(0),amountMaxA:m==="MintA"?c:d,amountMaxB:m==="MintA"?d:c,baseFlag:m==="MintA",optionBaseFlag:1},T);let K=Buffer.from([...Le.increaseLiquidity,...T]);return new w.TransactionInstruction({keys:F,programId:e,data:K})}static decreaseLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,I,S){let M=C([V("liquidity"),P("amountMinA"),P("amountMinB")]),F=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[],...m.map(_=>[{pubkey:_.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Lt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...F],K=Buffer.alloc(M.span);M.encode({liquidity:c,amountMinA:d,amountMinB:I},K);let N=Buffer.from([...Le.decreaseLiquidity,...K]);return new w.TransactionInstruction({keys:T,programId:e,data:N})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMinA:o,amountMinB:r,programId:s,nft2022:l}){let[p,b]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],g=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),u=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:k}=Z(p,b,g),{publicKey:m}=Z(p,b,u),{publicKey:c}=l?te(i.wallet,n.nftMint,L.TOKEN_2022_PROGRAM_ID):te(i.wallet,n.nftMint,s),{publicKey:d}=Ie(p,n.nftMint),{publicKey:I}=Xe(p,b,n.tickLower,n.tickUpper),S=[];for(let T=0;T<e.rewardDefaultInfos.length;T++)S.push({poolRewardVault:new w.PublicKey(t.rewardInfos[T].vault),ownerRewardVault:i.rewardAccounts[T],rewardMint:new w.PublicKey(e.rewardDefaultInfos[T].mint.address)});let M=[],F=this.decreaseLiquidityInstruction(p,i.wallet,c,d,b,I,k,m,i.tokenAccountA,i.tokenAccountB,new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B),new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address),S,a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,u])?me(p,b).publicKey:void 0);return M.push(F),{address:{tickArrayLower:k,tickArrayUpper:m,positionNftAccount:c,personalPosition:d,protocolPosition:I},signers:[],instructions:M,instructionTypes:[ee.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d){let I=C([P("amount"),P("otherAmountThreshold"),V("sqrtPriceLimitX64"),fe("isBaseInput")]),S=[...d?[{pubkey:d,isSigner:!1,isWritable:!0}]:[],...b.map(K=>({pubkey:K,isSigner:!1,isWritable:!0}))],M=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Lt,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...S],F=Buffer.alloc(I.span);I.encode({amount:u,otherAmountThreshold:k,sqrtPriceLimitX64:m,isBaseInput:c},F);let T=Buffer.from([...Le.swap,...F]);return new w.TransactionInstruction({keys:M,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:a,amountIn:o,amountOutMin:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],[g,u]=[new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B)],[k,m]=[new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address)],c=e.mintA.address===a.toString(),d=[this.swapInstruction(p,i.wallet,b,new w.PublicKey(e.config.id),c?i.tokenAccountA:i.tokenAccountB,c?i.tokenAccountB:i.tokenAccountA,c?g:u,c?u:g,c?k:m,c?m:k,l,n,o,r,s,!0,me(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[ee.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:a,amountOut:o,amountInMax:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],[g,u]=[new w.PublicKey(t.vault.A),new w.PublicKey(t.vault.B)],[k,m]=[new w.PublicKey(e.mintA.address),new w.PublicKey(e.mintB.address)],c=e.mintA.address===a.toBase58(),d=[this.swapInstruction(p,i.wallet,b,new w.PublicKey(e.config.id),c?i.tokenAccountB:i.tokenAccountA,c?i.tokenAccountA:i.tokenAccountB,c?u:g,c?g:u,c?m:k,c?k:m,l,n,o,r,s,!1,me(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[ee.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,g){let u=C([P("openTime"),P("endTime"),V("emissionsPerSecondX64")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({openTime:re(p),endTime:re(b),emissionsPerSecondX64:g},m);let c=Buffer.from([...Le.initReward,...m]);return new w.TransactionInstruction({keys:k,programId:e,data:c})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],r=Ii(a,o,i.mint).publicKey,s=qt(a).publicKey,l=[this.initRewardInstruction(a,n.wallet,o,s,new w.PublicKey(e.config.id),n.tokenAccount,i.programId,i.mint,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:r,operationId:s},signers:[],instructions:l,instructionTypes:[ee.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,g){let u=C([W("rewardIndex"),V("emissionsPerSecondX64"),P("openTime"),P("endTime")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0}],m=Buffer.alloc(u.span);u.encode({rewardIndex:l,emissionsPerSecondX64:g,openTime:re(p),endTime:re(b)},m);let c=Buffer.from([...Le.setRewardEmissions,...m]);return new w.TransactionInstruction({keys:k,programId:e,data:c})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],r,s,l;for(let g=0;g<e.rewardDefaultInfos.length;g++)e.rewardDefaultInfos[g].mint.address===i.mint.toString()&&(r=g,s=new w.PublicKey(t.rewardInfos[g].vault),l=new w.PublicKey(t.rewardInfos[g].mint.address));(r===void 0||s===void 0)&&Ci.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let p=qt(a).publicKey,b=[this.setRewardInstruction(a,n.wallet,o,p,new w.PublicKey(e.config.id),n.tokenAccount,s,l,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:s,operationId:p},signers:[],instructions:b,instructionTypes:[ee.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,a,o,r){let s=C([W("rewardIndex")]),l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Lt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(s.span);s.encode({rewardIndex:r},p);let b=Buffer.from([...Le.collectReward,...p]);return new w.TransactionInstruction({keys:l,programId:e,data:b})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[a,o]=[new w.PublicKey(e.programId),new w.PublicKey(e.id)],r,s;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===i.toString()&&(r=p,s=new w.PublicKey(t.rewardInfos[p].vault));(r===void 0||s===void 0)&&Ci.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=[this.collectRewardInstruction(a,n.wallet,o,n.tokenAccount,s,i,r)];return{address:{rewardVault:s},signers:[],instructions:l,instructionTypes:[ee.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:a,nftMint:o,nft2022:r,getEphemeralSigners:s}){let l=[],p;if(s)p=new w.PublicKey((await s(1))[0]);else{let d=w.Keypair.generate();l.push(d),p=d.publicKey}let b=r?te(a,o,L.TOKEN_2022_PROGRAM_ID).publicKey:te(a,o,L.TOKEN_PROGRAM_ID).publicKey,{publicKey:g}=Ie(n,o),u=kn(e,p).publicKey,k=te(a,p,L.TOKEN_PROGRAM_ID).publicKey,m=ct(p).publicKey,c=nt.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:a,lockOwner:a,positionNftAccount:b,positionId:g,lockPositionId:u,lockNftMint:p,lockNftAccount:k,metadataAccount:m,withMetadata:!0,nft2022:r,positionNftMint:o,authPositionNftAccount:te(t,o,r?L.TOKEN_2022_PROGRAM_ID:L.TOKEN_PROGRAM_ID).publicKey,positionNftProgram:r?L.TOKEN_2022_PROGRAM_ID:L.TOKEN_PROGRAM_ID});return{address:{positionId:g,lockPositionId:u,lockNftAccount:k,lockNftMint:p,positionNftAccount:b,metadataAccount:m},instructions:[c],signers:l,instructionTypes:[ee.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:a,positionNftAccount:o,positionId:r,positionNftMint:s,authPositionNftAccount:l,positionNftProgram:p,lockPositionId:b,lockNftMint:g,lockNftAccount:u,metadataAccount:k,withMetadata:m}){let c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!0,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:L.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1}],d=C([fe("withMetadata")]),I=Buffer.alloc(d.span);d.encode({withMetadata:m},I);let S=Buffer.from([...Ri,...I]);return new w.TransactionInstruction({keys:c,programId:e,data:S})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:a}){let{publicKey:o}=te(i,a,L.TOKEN_PROGRAM_ID),{publicKey:r}=Ie(n,a),s=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:Pn(e,r).publicKey,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:w.SystemProgram.programId,isSigner:!1,isWritable:!1}];return new w.TransactionInstruction({keys:s,programId:e,data:Buffer.from(Ri)})}static harvestLockPositionInstruction(e){let[t,n]=[new w.PublicKey(e.poolKeys.programId),new w.PublicKey(e.poolKeys.id)],i=R.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),a=R.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:o}=Z(t,n,i),{publicKey:r}=Z(t,n,a),{publicKey:s}=te(e.owner,e.ownerPosition.nftMint,L.TOKEN_PROGRAM_ID),{publicKey:l}=Ie(t,e.ownerPosition.nftMint),{publicKey:p}=Xe(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),b=[];for(let k=0;k<e.poolKeys.rewardInfos.length;k++)b.push({poolRewardVault:new w.PublicKey(e.poolKeys.rewardInfos[k].vault),ownerRewardVault:e.ownerRewardAccounts[k],rewardMint:new w.PublicKey(e.poolKeys.rewardInfos[k].mint.address)});let g=[...b.map(k=>[{pubkey:k.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.rewardMint,isSigner:!1,isWritable:!1}]).flat()],u=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Pn(e.programId,l).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:new w.PublicKey(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new w.PublicKey(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:new w.PublicKey(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new w.PublicKey(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...g];return new w.TransactionInstruction({keys:u,programId:e.programId,data:Buffer.from(Li)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:a,lockNftMint:o,lockNftAccount:r,positionNftAccount:s,positionId:l,poolId:p,protocolPosition:b,vaultA:g,vaultB:u,tickArrayLower:k,tickArrayUpper:m,userVaultA:c,userVaultB:d,mintA:I,mintB:S,rewardAccounts:M,exTickArrayBitmap:F}){let T=[...F?[{pubkey:F,isSigner:!1,isWritable:!0}]:[],...M.map(N=>[{pubkey:N.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.rewardMint,isSigner:!1,isWritable:!1}]).flat()],K=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:L.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:L.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:I,isSigner:!1,isWritable:!1},{pubkey:S,isSigner:!1,isWritable:!1},...T];return new w.TransactionInstruction({keys:K,programId:e,data:Buffer.from(Li)})}};var em=C([le(8),W("bump"),fe("disableCreatePool"),Ze("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),B("protocolOwner"),B("fundOwner"),X(P(),16)]),eo=C([le(8),B("configId"),B("poolCreator"),B("vaultA"),B("vaultB"),B("mintLp"),B("mintA"),B("mintB"),B("mintProgramA"),B("mintProgramB"),B("observationId"),W("bump"),W("status"),W("lpDecimals"),W("mintDecimalA"),W("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),X(P(),32)]);var Kt=require("@solana/web3.js"),hn=require("@solana/spl-token");var im=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),rm=Buffer.from("amm_config","utf8"),om=Buffer.from("pool","utf8"),sm=Buffer.from("pool_lp_mint","utf8"),am=Buffer.from("pool_vault","utf8"),um=Buffer.from("observation","utf8");var cm=Buffer.from("locked_liquidity","utf8");var Am=ne("Raydium_cpmm"),to={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function Mi(y,e,t,n,i,a,o,r,s,l,p,b,g,u,k,m){let c=C([P("amountIn"),P("amounOutMin")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],I=Buffer.alloc(c.span);return c.encode({amountIn:k,amounOutMin:m},I),new Kt.TransactionInstruction({keys:d,programId:y,data:Buffer.from([...to.swapBaseInput,...I])})}var no=U(require("bn.js")),io=U(require("decimal.js-light"));var Oi=U(require("bn.js"));var Bm=new Oi.default(0);var Bn=U(require("bn.js")),Ym=new Bn.default(25),Hm=new Bn.default(1e4);var xn=C([W("instruction"),P("amountIn"),P("minAmountOut")]),Sn=C([W("instruction"),P("maxAmountIn"),P("amountOut")]),$m=C([W("instruction"),W("nonce")]),ro=C([W("instruction"),W("nonce"),P("startTime")]),Ei=C([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),V("swapBaseInAmount"),V("swapQuoteOutAmount"),P("swapBase2QuoteFee"),V("swapQuoteInAmount"),V("swapBaseOutAmount"),P("swapQuote2BaseFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("withdrawQueue"),B("lpVault"),B("owner"),P("lpReserve"),X(P(),3,"padding")]),ep=C([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),V("swapBaseInAmount"),V("swapQuoteOutAmount"),V("swapQuoteInAmount"),V("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("modelDataAccount"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("owner"),X(P(),64,"padding")]),oo=C([W("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),so=C([W("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]);var tp=C([P("fee")]);var go=require("@solana/web3.js"),Po=U(require("bn.js")),ko=U(require("decimal.js")),Ao=require("@solana/spl-token");var lt=require("@solana/web3.js"),Qt=require("@solana/spl-token");var Fi=ne("Raydium_liquidity_instruction");function ao({poolKeys:y,userKeys:e,amountIn:t,minAmountOut:n,modelDataPubKey:i=At},a){let o=xe(y),r=Buffer.alloc(xn.span);xn.encode({instruction:9,amountIn:re(t),minAmountOut:re(n)},r);let s=[f({pubkey:Qt.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders})];return a===4&&s.push(f({pubkey:o.targetOrders})),s.push(f({pubkey:o.vault.A}),f({pubkey:o.vault.B})),a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new lt.TransactionInstruction({programId:o.programId,keys:s,data:r})}function uo({poolKeys:y,userKeys:e,maxAmountIn:t,amountOut:n,modelDataPubKey:i=At},a){let o=xe(y),r=Buffer.alloc(Sn.span);Sn.encode({instruction:11,maxAmountIn:re(t),amountOut:re(n)},r);let s=[f({pubkey:Qt.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders}),f({pubkey:o.targetOrders}),f({pubkey:o.vault.A}),f({pubkey:o.vault.B})];return a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new lt.TransactionInstruction({programId:o.programId,keys:s,data:r})}function Wi(y){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:a,fixedSide:o}=y;if(t===4||t===5){let r={poolKeys:e,userKeys:n};if(o==="in")return ao($(H({},r),{amountIn:i,minAmountOut:a}),t);if(o==="out")return uo($(H({},r),{maxAmountIn:i,amountOut:a}),t);Fi.logWithError("invalid params","params",y)}throw Fi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var co=require("@solana/web3.js");var fp=ne("Raydium_liquidity_serum");var lo=5e4,mo=C([P("x"),P("y"),P("price")]),Pp=C([P("accountType"),P("status"),P("multiplier"),P("validDataCount"),X(mo,lo,"DataElement")]);var Kn=C([B("mint"),B("owner"),P("amount"),Se("delegateOption"),B("delegate"),W("state"),Se("isNativeOption"),P("isNative"),P("delegatedAmount"),Se("closeAuthorityOption"),B("closeAuthority")]);var Vi=require("@solana/web3.js"),po=U(require("bn.js"));var fo=require("@solana/spl-token");var Sp=ne("Raydium_Util");var vi=require("@solana/web3.js"),bo=U(require("bn.js"));var Yt=require("@solana/spl-token");var yo=C([Se("mintAuthorityOption"),B("mintAuthority"),P("supply"),W("decimals"),W("isInitialized"),Se("freezeAuthorityOption"),B("freezeAuthority")]);var wo={[un.toBase58()]:3};var To=C([le(5),le(8),B("ownAddress"),P("vaultSignerNonce"),B("baseMint"),B("quoteMint"),B("baseVault"),P("baseDepositsTotal"),P("baseFeesAccrued"),B("quoteVault"),P("quoteDepositsTotal"),P("quoteFeesAccrued"),P("quoteDustThreshold"),B("requestQueue"),B("eventQueue"),B("bids"),B("asks"),P("baseLotSize"),P("quoteLotSize"),P("feeRateBps"),P("referrerRebatesAccrued"),le(7)]);var Io=require("@solana/web3.js");var Md=ne("Serum");var A=require("@solana/web3.js"),Fe=U(require("bn.js")),Pe=require("@solana/spl-token");function ho(y,e,t,n,i,a,o,r,s,l,p,b){let g=C([W("instruction"),P("amountIn"),P("amountOut")]),u=[{pubkey:A.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Pe.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(t.id),isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey(n.id),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let m=xe(t);u.push({pubkey:m.config.id,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.A:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.B:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},...b.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let m=xe(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0})}else{let m=xe(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},...m.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:m.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:m.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0}])}let k=Buffer.alloc(g.span);return g.encode({instruction:4,amountIn:l,amountOut:p},k),new A.TransactionInstruction({keys:u,programId:y,data:k})}function Bo(y,e,t,n,i,a,o,r,s,l){let p=C([W("instruction")]),b=[{pubkey:A.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Pe.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A.PublicKey(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let u=xe(n);b.push({pubkey:u.config.id,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.A:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.B:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},...l.map(k=>({pubkey:k,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let u=xe(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:new A.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0})}else{let u=xe(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},...u.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:u.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:u.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(p.span);return p.encode({instruction:5},g),new A.TransactionInstruction({keys:b,programId:y,data:g})}function Di(y,e,t,n,i,a,o,r,s,l,p,b,g,u,k){var T;let m=[],c=[f({pubkey:Pe.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:Pe.TOKEN_2022_PROGRAM_ID,isWritable:!1}),f({pubkey:Pe.ASSOCIATED_TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:A.SystemProgram.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})];c.push(f({pubkey:t})),c.push(f({pubkey:i}));let d=[s,l],I=[p,b],S=[a,o,r];for(let K=0;K<d.length;K++){let N=d[K],_=S[K]===N.mintA.address;if(c.push(f({pubkey:new A.PublicKey(N.programId),isWritable:!1})),K===d.length-1?c.push(f({pubkey:i})):c.push(f({pubkey:n})),c.push(f({pubkey:new A.PublicKey(S[K])})),c.push(f({pubkey:new A.PublicKey(S[K+1])})),N.version===6){let h=I[K];c.push(f({pubkey:new A.PublicKey(h.config.id)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(_?h.vault.A:h.vault.B)})),c.push(f({pubkey:new A.PublicKey(_?h.vault.B:h.vault.A)})),c.push(f({pubkey:new A.PublicKey(N.observationId)})),c.push(f({pubkey:Ye})),c.push(f({pubkey:me(new A.PublicKey(N.programId),new A.PublicKey(N.id)).publicKey})),m.push(Cn(N.sqrtPriceX64.toString(),_));for(let D of(T=k[K])!=null?T:[])c.push(f({pubkey:new A.PublicKey(D)}))}else if(N.version===5){let h=I[K];c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.authority),isWritable:!1})),c.push(f({pubkey:new A.PublicKey(h.marketProgramId)})),c.push(f({pubkey:new A.PublicKey(h.marketAuthority)})),c.push(f({pubkey:Ot,isWritable:!1})),c.push(f({pubkey:new A.PublicKey(h.openOrders)})),c.push(f({pubkey:new A.PublicKey(h.vault.A)})),c.push(f({pubkey:new A.PublicKey(h.vault.B)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.marketId)})),c.push(f({pubkey:new A.PublicKey(h.marketBids)})),c.push(f({pubkey:new A.PublicKey(h.marketAsks)})),c.push(f({pubkey:new A.PublicKey(h.marketEventQueue)})),c.push(f({pubkey:new A.PublicKey(h.marketBaseVault)})),c.push(f({pubkey:new A.PublicKey(h.marketQuoteVault)}))}else if(N.version===4){let h=I[K],D=N.status!==1;c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(h.authority),isWritable:!1})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketProgramId)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketAuthority)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.openOrders)})),c.push(f({pubkey:new A.PublicKey(h.vault.A)})),c.push(f({pubkey:new A.PublicKey(h.vault.B)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketId)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketBids)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketAsks)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketEventQueue)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketBaseVault)})),c.push(f({pubkey:new A.PublicKey(D?h.id:h.marketQuoteVault)}))}else if(N.version===7){let h=I[K];c.push(f({pubkey:new A.PublicKey(h.authority)})),c.push(f({pubkey:new A.PublicKey(h.config.id)})),c.push(f({pubkey:new A.PublicKey(h.id)})),c.push(f({pubkey:new A.PublicKey(_?h.vault.A:h.vault.B)})),c.push(f({pubkey:new A.PublicKey(_?h.vault.B:h.vault.A)})),c.push(f({pubkey:new A.PublicKey(N.observationId)}))}else throw Error("pool type error")}let M=C([W("insId"),P("amountIn"),P("amountOut"),X(V(),m.length,"clmmPriceLimit")]),F=Buffer.alloc(M.span);return M.encode({insId:0,amountIn:g,amountOut:u,clmmPriceLimit:m},F),new A.TransactionInstruction({keys:c,programId:y,data:F})}function Cn(y,e){if(y)if(e){let t=new Fe.default(y).div(new Fe.default(25));return t.gt(Vt)?t:Vt}else{let t=new Fe.default(y).mul(new Fe.default(25));return t.lt(vt)?t:vt}else return e?Vt:vt}function _i({routeProgram:y,ownerInfo:e,inputMint:t,swapInfo:n}){var i,a,o,r,s,l,p;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let b=n.poolKey[0],g=xe(b),u=t.equals(g.mintA.address)?ve.add(Ce):De.sub(Ce);return nt.makeSwapBaseInInstructions({poolInfo:b,poolKeys:b,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:g.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:g.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((a=(i=n.minAmountOut.fee)==null?void 0:i.raw)!=null?a:new Fe.default(0)),sqrtPriceLimitX64:u,remainingAccounts:(o=n.remainingAccounts[0])!=null?o:[]})}else if(n.poolInfo[0].version===7){let b=n.poolInfo[0],g=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[Mi(b.programId,e.wallet,b.authority,b.configId,b.id,e.sourceToken,e.destinationToken,g?b.vaultA:b.vaultB,g?b.vaultB:b.vaultA,g?b.mintProgramA:b.mintProgramB,g?b.mintProgramB:b.mintProgramA,new A.PublicKey(b[g?"mintA":"mintB"].address),new A.PublicKey(b[g?"mintB":"mintA"].address),b.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[g?ee.CpmmSwapBaseIn:ee.CpmmSwapBaseOut],address:{}}}else{let b=n.poolKey[0];return{signers:[],instructions:[Wi({poolKeys:b,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((s=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?s:new Fe.default(0)),fixedSide:"in"})],lookupTableAddress:b.lookupTableAccount?[b.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ee.AmmV5SwapBaseIn:ee.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let b=n.poolInfo[0],g=n.poolInfo[1],u=n.poolKey[0],k=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Di(y,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),b,g,u,k,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((p=(l=n.minAmountOut.fee)==null?void 0:l.raw)!=null?p:new Fe.default(0)),n.remainingAccounts)],instructionTypes:[ee.RouteSwap],lookupTableAddress:[u.lookupTableAccount,k.lookupTableAccount].filter(m=>m!==void 0),address:{}}}else throw Error("route type error")}function xo({programId:y,wallet:e,amount:t,inputAccount:n,outputAccount:i,routeInfo:a,poolKeys:o}){var g;if(a.success===!1)throw Error("route info error");let r=[],s=[f({pubkey:Pe.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:Pe.TOKEN_2022_PROGRAM_ID,isWritable:!1}),f({pubkey:Pe.ASSOCIATED_TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:A.SystemProgram.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],l={[a.data.inputMint]:n,[a.data.outputMint]:i};s.push(f({pubkey:l[a.data.inputMint]})),s.push(f({pubkey:l[a.data.outputMint]}));for(let u=0;u<o.length;u++){let k=a.data.routePlan[u],m=o[u],c=k.inputMint===m.mintA.address;if(s.push(f({pubkey:new A.PublicKey(m.programId),isWritable:!1})),u===o.length-1)s.push(f({pubkey:l[k.outputMint]}));else{let d=k.outputMint;if(l[d]===void 0){let I=te(e,new A.PublicKey(d),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()||m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A.PublicKey(c?m.mintB.programId:m.mintA.programId):Pe.TOKEN_PROGRAM_ID).publicKey;l[d]=I}s.push(f({pubkey:l[d]}))}if(s.push(f({pubkey:new A.PublicKey(k.inputMint)})),s.push(f({pubkey:new A.PublicKey(k.outputMint)})),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.config.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.observationId)})),s.push(f({pubkey:Ye,isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.exBitmapAccount)})),r.push(Cn(k.lastPoolPriceX64,c));for(let I of(g=k.remainingAccounts)!=null?g:[])s.push(f({pubkey:new A.PublicKey(I)}))}else if(m.programId===Ae.AMM_STABLE.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.authority),isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.marketProgramId),isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.marketAuthority),isWritable:!1})),s.push(f({pubkey:Ot,isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.openOrders)})),s.push(f({pubkey:new A.PublicKey(d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.vault.B)})),s.push(f({pubkey:new A.PublicKey(d.marketId)})),s.push(f({pubkey:new A.PublicKey(d.marketBids)})),s.push(f({pubkey:new A.PublicKey(d.marketAsks)})),s.push(f({pubkey:new A.PublicKey(d.marketEventQueue)})),s.push(f({pubkey:new A.PublicKey(d.marketBaseVault)})),s.push(f({pubkey:new A.PublicKey(d.marketQuoteVault)}))}else if(m.programId===Ae.AMM_V4.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.authority),isWritable:!1})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.vault.B)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(d.id)}))}else if(m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let d=m;s.push(f({pubkey:new A.PublicKey(d.authority)})),s.push(f({pubkey:new A.PublicKey(d.config.id)})),s.push(f({pubkey:new A.PublicKey(d.id)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A.PublicKey(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A.PublicKey(d.observationId)}))}else throw Error("pool type error")}let p=C([W("insId"),P("amountIn"),P("amountOut"),X(V(),r.length,"clmmPriceLimit")]),b=Buffer.alloc(p.span);return p.encode({insId:0,amountIn:t,amountOut:new Fe.default(a.data.otherAmountThreshold),clmmPriceLimit:r},b),new A.TransactionInstruction({keys:s,programId:y,data:b})}function So({programId:y,wallet:e,inputAccount:t,outputAccount:n,routeInfo:i,poolKeys:a}){var b;if(i.success===!1)throw Error("route info error");let o=[],r=[f({pubkey:Pe.TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:Pe.TOKEN_2022_PROGRAM_ID,isWritable:!1}),f({pubkey:Pe.ASSOCIATED_TOKEN_PROGRAM_ID,isWritable:!1}),f({pubkey:A.SystemProgram.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],s={[i.data.inputMint]:t,[i.data.outputMint]:n};for(let g=a.length-1;g>=0;g--){let u=i.data.routePlan[g],k=a[g],m=u.inputMint===k.mintA.address;if(r.push(f({pubkey:new A.PublicKey(k.programId)})),g===0)r.push(f({pubkey:s[u.inputMint]}));else{let c=u.inputMint;if(s[c]===void 0){let d=te(e,new A.PublicKey(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A.PublicKey(m?k.mintA.programId:k.mintB.programId):Pe.TOKEN_PROGRAM_ID).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(g===a.length-1)r.push(f({pubkey:s[u.outputMint]}));else{let c=u.outputMint;if(s[c]===void 0){let d=te(e,new A.PublicKey(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A.PublicKey(m?k.mintB.programId:k.mintA.programId):Pe.TOKEN_PROGRAM_ID).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(r.push(f({pubkey:new A.PublicKey(u.inputMint)})),r.push(f({pubkey:new A.PublicKey(u.outputMint)})),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.config.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.observationId)})),r.push(f({pubkey:Ye,isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.exBitmapAccount)})),o.push(Cn(u.lastPoolPriceX64,m));for(let d of(b=u.remainingAccounts)!=null?b:[])r.push(f({pubkey:new A.PublicKey(d)}))}else if(k.programId===Ae.AMM_STABLE.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.authority),isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.marketProgramId),isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.marketAuthority),isWritable:!1})),r.push(f({pubkey:Ot,isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.openOrders)})),r.push(f({pubkey:new A.PublicKey(c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.vault.B)})),r.push(f({pubkey:new A.PublicKey(c.marketId)})),r.push(f({pubkey:new A.PublicKey(c.marketBids)})),r.push(f({pubkey:new A.PublicKey(c.marketAsks)})),r.push(f({pubkey:new A.PublicKey(c.marketEventQueue)})),r.push(f({pubkey:new A.PublicKey(c.marketBaseVault)})),r.push(f({pubkey:new A.PublicKey(c.marketQuoteVault)}))}else if(k.programId===Ae.AMM_V4.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.authority),isWritable:!1})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.vault.B)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(c.id)}))}else if(k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let c=k;r.push(f({pubkey:new A.PublicKey(c.authority)})),r.push(f({pubkey:new A.PublicKey(c.config.id)})),r.push(f({pubkey:new A.PublicKey(c.id)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A.PublicKey(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A.PublicKey(c.observationId)}))}else throw Error("pool type error")}let l=C([W("insId"),P("amountIn"),P("amountOut"),X(V(),o.length,"clmmPriceLimit")]),p=Buffer.alloc(l.span);return l.encode({insId:1,amountIn:new Fe.default(i.data.otherAmountThreshold),amountOut:new Fe.default(i.data.outputAmount),clmmPriceLimit:o},p),new A.TransactionInstruction({keys:r,programId:y,data:p})}var wf=new qi.default(0);0&&(module.exports={makeSwapInstruction,route1Instruction,route2Instruction,routeInstruction,swapBaseInAutoAccount,swapBaseOutAutoAccount});
//# sourceMappingURL=index.js.map