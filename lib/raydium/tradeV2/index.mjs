var Ai=Object.defineProperty,Ti=Object.defineProperties;var wi=Object.getOwnPropertyDescriptors;var In=Object.getOwnPropertySymbols;var hi=Object.prototype.hasOwnProperty,Ii=Object.prototype.propertyIsEnumerable;var Bn=(P,e,t)=>e in P?Ai(P,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):P[e]=t,Q=(P,e)=>{for(var t in e||(e={}))hi.call(e,t)&&Bn(P,t,e[t]);if(In)for(var t of In(e))Ii.call(e,t)&&Bn(P,t,e[t]);return P},j=(P,e)=>Ti(P,wi(e));import{PublicKey as Jy}from"@solana/web3.js";import{createTransferInstruction as eg,TOKEN_PROGRAM_ID as tg,TOKEN_2022_PROGRAM_ID as ng}from"@solana/spl-token";import co from"bn.js";import og from"decimal.js";import{PublicKey as Si}from"@solana/web3.js";import{get as xn,set as Bi}from"lodash";var _t=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Sn={},xi={};function ee(P){let e=xn(Sn,P);if(!e){let t=xn(xi,P);e=new _t({name:P,logLevel:t}),Bi(Sn,P,e)}return e}import{MINT_SIZE as To,TOKEN_PROGRAM_ID as wo,getTransferFeeConfig as ho,unpackMint as Io}from"@solana/spl-token";var Dt=ee("Raydium_accountInfo_util");async function He(P,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:a=100}=Q({batchRequest:!1},t),o=qt(e,a),r=new Array(o.length).fill([]);if(n){let s=o.map(b=>{let y=P._buildArgs([b.map(u=>u.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:y}}),l=qt(s,10);r=(await(await Promise.all(l.map(async b=>await P._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&Dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(y=>{if(y){let{data:u,executable:k,lamports:m,owner:c,rentEpoch:d}=y;return u.length!==2&&u[1]!=="base64"&&Dt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(u[0],"base64"),executable:k,lamports:m,owner:new Si(c),rentEpoch:d}}return null})))}else try{r=await Promise.all(o.map(s=>P.getMultipleAccountsInfo(s,i)))}catch(s){s instanceof Error&&Dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${s.message}`)}return r.flat()}async function ut(P,e,t){let n=await He(P,e.map(i=>i.pubkey),t);return e.map((i,a)=>j(Q({},i),{accountInfo:n[a]}))}import qe from"bn.js";import ta from"decimal.js";import Ei from"big.js";import xt from"bn.js";import Ki from"toformat";var Ci=Ki,lt=Ci;import Bt from"big.js";import Li from"bn.js";import Ni from"decimal.js-light";import mt from"bn.js";var Kn=9007199254740991;function te(P){let e=ee("Raydium_parseBigNumberish");if(P instanceof mt)return P;if(typeof P=="string"){if(P.match(/^-?[0-9]+$/))return new mt(P);e.logWithError(`invalid BigNumberish string: ${P}`)}return typeof P=="number"?(P%1&&e.logWithError(`BigNumberish number underflow: ${P}`),(P>=Kn||P<=-Kn)&&e.logWithError(`BigNumberish number overflow: ${P}`),new mt(String(P))):typeof P=="bigint"?new mt(P.toString()):(e.error(`invalid BigNumberish value: ${P}`),new mt(0))}var It=ee("module/fraction"),Gt=lt(Bt),pt=lt(Ni),Mi={[0]:pt.ROUND_DOWN,[1]:pt.ROUND_HALF_UP,[2]:pt.ROUND_UP},Oi={[0]:Bt.roundDown,[1]:Bt.roundHalfUp,[2]:Bt.roundUp},H=class{constructor(e,t=new Li(1)){this.numerator=te(e),this.denominator=te(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(te(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(te(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(te(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(te(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||It.logWithError(`${e} is not an integer.`),e<=0&&It.logWithError(`${e} is not positive.`),pt.set({precision:e+1,rounding:Mi[n]});let i=new pt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||It.logWithError(`${e} is not an integer.`),e<0&&It.logWithError(`${e} is negative.`),Gt.DP=e,Gt.RM=Oi[n]||1,new Gt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Fi=ee("Raydium_amount"),Cn=lt(Ei);function Wi(P,e){let t="0",n="0";if(P.includes(".")){let i=P.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Fi.logWithError(`invalid number string, num: ${P}`)}else t=P;return[t,n.slice(0,e)||n]}var pe=class extends H{constructor(t,n,i=!0,a){let o=new xt(0),r=Ut.pow(new xt(t.decimals));if(i)o=te(n);else{let s=new xt(0),l=new xt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[p,b]=Wi(n.toString(),t.decimals);s=te(p),l=te(b)}s=s.mul(r),o=s.add(l)}super(o,r);this.logger=ee(a||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Cn.DP=this.token.decimals,new Cn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as vi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Rn}from"@solana/spl-token";var Xt={chainId:101,address:vi.default.toBase58(),programId:Rn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},_e={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Rn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ht}from"@solana/web3.js";import{PublicKey as re,SystemProgram as Ln,SYSVAR_RENT_PUBKEY as Vi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _i}from"@solana/spl-token";function f({pubkey:P,isSigner:e=!1,isWritable:t=!0}){return{pubkey:P,isWritable:t,isSigner:e}}var ns=[f({pubkey:_i,isWritable:!1}),f({pubkey:Ln.programId,isWritable:!1}),f({pubkey:Vi,isWritable:!1})];function zt({publicKey:P,transformSol:e}){let t=Qt(P.toString());if(t instanceof re)return e&&t.equals(dt)?ct:t;if(e&&t.toString()===dt.toBase58())return ct;if(typeof t=="string"){if(t===re.default.toBase58())return re.default;try{return new re(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Qt(P){try{return new re(P)}catch{return P}}var St=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ye=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Oe=new re("SysvarRent111111111111111111111111111111111"),is=new re("SysvarC1ock11111111111111111111111111111111"),je=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),rs=new re("Sysvar1nstructions1111111111111111111111111"),Di=Ln.programId,os=new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ss=new re("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),as=new re("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),us=new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),cs=new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ls=new re("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ms=new re("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ps=new re("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ds=new re("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),fs=new re("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),bs=new re("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ct=new re("So11111111111111111111111111111111111111112"),dt=re.default;function rt(P){return zt({publicKey:P,transformSol:!0})}var Yt=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:a=!1,isToken2022:o=!1}){if(e===dt.toBase58()||e instanceof Ht&&dt.equals(e)){this.decimals=_e.decimals,this.symbol=_e.symbol,this.name=_e.name,this.mint=new Ht(_e.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=a?Ht.default:zt({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ne=Yt;Ne.WSOL=new Yt(j(Q({},_e),{mint:_e.address}));var jt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Kt=jt;Kt.SOL=new jt(Xt);import qi from"bn.js";var Nn=new H(new qi(100)),De=class extends H{toSignificant(e=5,t,n){return this.mul(Nn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Nn).toFixed(e,t,n)}};var Gi=ee("Raydium_price"),Ie=class extends H{constructor(t){let{baseToken:n,quoteToken:i,numerator:a,denominator:o}=t;super(a,o);this.baseToken=n,this.quoteToken=i,this.scalar=new H(Zt(n.decimals),Zt(i.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ie({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Gi.logWithError("mul token not equals");let n=super.mul(t);return new Ie({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};import{PublicKey as Ui}from"@solana/web3.js";import Xi from"bn.js";function On(P){return typeof P=="object"&&P!==null&&![Ne,pe,Ui,H,Xi,Ie,De].some(e=>typeof e=="object"&&P instanceof e)}function Be(P){return typeof P=="string"?Qt(P):Array.isArray(P)?P.map(e=>Be(e)):On(P)?Object.fromEntries(Object.entries(P).map(([e,t])=>[e,Be(t)])):P}var Mn=new qe(0),zi=new qe(1),ma=new qe(2),pa=new qe(3),da=new qe(5),Ut=new qe(10),fa=new qe(100),ba=new qe(1e3),ya=new qe(1e4);function Zt(P){return Ut.pow(te(P))}function qt(P,e=1,t=[]){let n=[...P];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Hi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yi}from"@solana/spl-token";import{ComputeBudgetProgram as Ia,Keypair as Sa,PublicKey as Qi,Transaction as Ca,TransactionMessage as La,VersionedTransaction as Na}from"@solana/web3.js";var Z={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Fa}from"@solana/spl-token";var Wa=ee("Raydium_txUtil");function ge(P,e){let[t,n]=Qi.findProgramAddressSync(P,e);return{publicKey:t,nonce:n}}function $(P,e,t){return ge([P.toBuffer(),(t!=null?t:Yi).toBuffer(),e.toBuffer()],new Hi("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var ji=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Zi=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ji=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),$i=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),er=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),tr=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Jt=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),En=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),nr=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ct=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),$t=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Fn=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Wn=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ft=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ir=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),rr=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ua=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Xa=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),za=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Qa=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),en=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),vn=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),or=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),sr=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ar=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ur=new O("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),cr=new O("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ha=new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ya=new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),lr=new O("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),mr=new O("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ae={AMM_V4:En,AMM_STABLE:nr,CLMM_PROGRAM_ID:$t,CLMM_LOCK_PROGRAM_ID:Fn,CLMM_LOCK_AUTH_ID:Wn,FARM_PROGRAM_ID_V3:ji,FARM_PROGRAM_ID_V4:Zi,FARM_PROGRAM_ID_V5:Ji,FARM_PROGRAM_ID_V6:$i,OPEN_BOOK_PROGRAM:tr,SERUM_PROGRAM_ID_V3:Jt,UTIL1216:er,Router:ir,CREATE_CPMM_POOL_PROGRAM:en,CREATE_CPMM_POOL_AUTH:vn,CREATE_CPMM_POOL_FEE_ACC:or,LOCK_CPMM_PROGRAM:sr,LOCK_CPMM_AUTH:ar,LAUNCHPAD_PROGRAM:ur,LAUNCHPAD_AUTH:cr,LAUNCHPAD_PLATFORM:lr,LAUNCHPAD_CONFIG:mr,FEE_DESTINATION_ID:rr,MODEL_DATA_PUBKEY:ft},ja={OPEN_BOOK_PROGRAM:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O("Ray1111111111111111111111111111111111111111"),AMM_V4:new O("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.default,Router:new O("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O("Ray1111111111111111111111111111111111111111")};import Me from"bn.js";var bt=1e4;function ue(P,e,t,n){if(e===void 0)return{amount:P,fee:void 0,expirationTime:void 0};let i=j(Q({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),a=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,o=new Me(a.maximumFee.toString()),r=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(a.transferFeeBasisPoints===bt){let s=new Me(a.maximumFee.toString());return{amount:P.add(s),fee:s,expirationTime:r}}else{let s=Rt(P.mul(new Me(bt)),new Me(bt-a.transferFeeBasisPoints)),l=new Me(a.maximumFee.toString()),p=s.sub(P).gt(l)?P.add(l):s,b=Rt(p.mul(new Me(a.transferFeeBasisPoints)),new Me(bt)),y=b.gt(o)?o:b;return{amount:p,fee:y,expirationTime:r}}else{let s=Rt(P.mul(new Me(a.transferFeeBasisPoints)),new Me(bt)),l=s.gt(o)?o:s;return{amount:P,fee:l,expirationTime:r}}}function Ge(P,e){return P===void 0?e:e===void 0?P:Math.min(P,e)}function Rt(P,e){let{div:t,mod:n}=P.divmod(e);return n.gt(new Me(0))?t.add(new Me(1)):t}import{PublicKey as pr,AddressLookupTableAccount as Vn}from"@solana/web3.js";var dr={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Vn({key:new pr("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Vn.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as bu,sendAndConfirmTransaction as yu,SystemProgram as ku,Transaction as Au,TransactionMessage as wu,VersionedTransaction as hu}from"@solana/web3.js";import Bu from"axios";import br from"bn.js";var yr=new br(1e6);import{PublicKey as Br}from"@solana/web3.js";import Un,{isBN as Xn}from"bn.js";import{bits as $u,BitStructure as ec,blob as gr,Blob as tc,cstr as nc,f32 as ic,f32be as rc,f64 as oc,f64be as sc,greedy as ac,Layout as Pr,ns64 as uc,ns64be as cc,nu64 as lc,nu64be as mc,offset as pc,s16 as dc,s16be as fc,s24 as bc,s24be as yc,s32 as kr,s32be as gc,s40 as Pc,s40be as kc,s48 as Ac,s48be as Tc,s8 as wc,seq as Ar,struct as hc,Structure as Tr,u16 as wr,u16be as Ic,u24 as Bc,u24be as xc,u32 as Sc,u32be as Kc,u40 as Cc,u40be as Rc,u48 as Lc,u48be as Nc,u8 as hr,UInt as Ir,union as Mc,Union as Oc,unionLayoutDiscriminator as Ec,utf8 as Fc}from"@solana/buffer-layout";var tn=Pr,Dn=Tr;var nn=Ir;var qn=hr,Je=wr;var ne=kr;var Gn=Ar;var le=gr;var ot=class extends tn{constructor(t,n,i){super(t,i);this.blob=le(t),this.signed=n}decode(t,n=0){let i=new Un(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Un(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function F(P){return new nn(1,P)}function xe(P){return new nn(4,P)}function g(P){return new ot(8,!1,P)}function W(P){return new ot(16,!1,P)}function zn(P){return new ot(8,!0,P)}function Qn(P){return new ot(16,!0,P)}var Lt=class extends tn{constructor(t,n,i,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function B(P){return new Lt(le(32),e=>new Br(e),e=>e.toBuffer(),P)}function fe(P){return new Lt(qn(),xr,Sr,P)}function xr(P){if(P===0)return!1;if(P===1)return!0;throw new Error("Invalid bool: "+P)}function Sr(P){return P?1:0}var rn=class extends Dn{decode(e,t){return super.decode(e,t)}};function R(P,e,t){return new rn(P,e,t)}function G(P,e,t){let n,i=typeof e=="number"?e:Xn(e)?e.toNumber():new Proxy(e,{get(a,o){if(!n){let r=Reflect.get(a,"count");n=Xn(r)?r.toNumber():r,Reflect.set(a,"count",n)}return Reflect.get(a,o)},set(a,o,r){return o==="count"&&(n=r),Reflect.set(a,o,r)}});return Gn(P,i,t)}import{PublicKey as $m}from"@solana/web3.js";import tp from"bn.js";import ip from"decimal.js";import{AccountLayout as sp,createAssociatedTokenAccountIdempotentInstruction as ap,TOKEN_2022_PROGRAM_ID as up,TOKEN_PROGRAM_ID as cp}from"@solana/spl-token";import{PublicKey as Zc}from"@solana/web3.js";import{MintLayout as $c,TOKEN_PROGRAM_ID as tl}from"@solana/spl-token";import{Keypair as Vt,PublicKey as T,SystemProgram as Qe,TransactionInstruction as Pe}from"@solana/web3.js";import bn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Tt,TOKEN_2022_PROGRAM_ID as ae,TOKEN_PROGRAM_ID as J}from"@solana/spl-token";import Wr from"bn.js";import at from"decimal.js";import Le from"bn.js";var oe=new Le(0),Se=new Le(1),Ue=new Le(-1),Ke=new Le(1).shln(64),Nt=new Le(1).shln(128),on=Ke.sub(Se),yt=64,Hn=Nt.subn(1),ke=-443636,Te=-ke,Ee=new Le("4295048016"),Fe=new Le("79226673521066979257578248091"),Mt=new Le("4295048017"),Ot=new Le("79226673521066979257578248090"),Yn=16,jn="59543866431248",Zn="184467440737095516",Jn="15793534762490258745",Et=new Le(10).pow(new Le(6));var bl=new Le("18446744073700000000");import q from"bn.js";import ve from"decimal.js";function Ft(P){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,P,!1),new Uint8Array(e)}function sn(P,e){let t=0;for(let n=P-1;n>=0&&!e.testn(n);n--)t++;return t}function an(P,e){let t=0;for(let n=0;n<P&&!e.testn(n);n++)t++;return t}function gt(P,e){for(let t=0;t<P;t++)if(e.testn(t))return!1;return!0}function $n(P,e){return gt(P,e)?null:sn(P,e)}function ei(P,e){return gt(P,e)?null:an(P,e)}var Tl=Buffer.from("amm_config","utf8"),Kr=Buffer.from("pool","utf8"),Cr=Buffer.from("pool_vault","utf8"),Rr=Buffer.from("pool_reward_vault","utf8"),ti=Buffer.from("position","utf8"),Lr=Buffer.from("tick_array","utf8"),Nr=Buffer.from("operation","utf8"),Mr=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Or=Buffer.from("observation","utf8");function ni(P,e,t,n){return ge([Kr,e.toBuffer(),t.toBuffer(),n.toBuffer()],P)}function un(P,e,t){return ge([Cr,e.toBuffer(),t.toBuffer()],P)}function ii(P,e,t){return ge([Rr,e.toBuffer(),t.toBuffer()],P)}function Y(P,e,t){return ge([Lr,e.toBuffer(),Ft(t)],P)}function Xe(P,e,t,n){return ge([ti,e.toBuffer(),Ft(t),Ft(n)],P)}function he(P,e){return ge([ti,e.toBuffer()],P)}function st(P){return ge([Buffer.from("metadata","utf8"),je.toBuffer(),P.toBuffer()],je)}function Wt(P){return ge([Nr],P)}function me(P,e){return ge([Mr,e.toBuffer()],P)}function ri(P,e){return ge([Or,e.toBuffer()],P)}var oi=Buffer.from("locked_position","utf8");function cn(P,e){return ge([oi,e.toBuffer()],P)}function ln(P,e){return ge([oi,e.toBuffer()],P)}var wl=Buffer.from("support_mint","utf8");import{PublicKey as Ce}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as si}from"@solana/spl-token";import ie from"bn.js";import X from"decimal.js";import We from"bn.js";import mn from"decimal.js";var Pt=class{static getfeeGrowthInside(e,t,n){let i=new We(0),a=new We(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,a=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new We(0),r=new We(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,r=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),r=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let s=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64A,i),o),l=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64B,a),r);return{feeGrowthInsideX64A:s,feeGrowthInsideBX64:l}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=D.mulDivFloor(D.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Ke),s=t.tokenFeesOwedA.add(r),l=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Ke),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=D.mulDivFloor(D.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Ke),s=t.tokenFeesOwedA.add(r),l=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Ke),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionRewardsV2(e,t,n,i){let a=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=D.wrappingSubU128(s,l.growthInsideLastX64),b=D.mulDivFloor(p,t.liquidity,Ke),y=l.rewardAmountOwed.add(b);a.push(y)}return a}static GetPositionRewards(e,t,n,i){let a=[],o=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=D.wrappingSubU128(s,l.growthInsideLastX64),b=D.mulDivFloor(p,t.liquidity,Ke),y=l.rewardAmountOwed.add(b);a.push(y)}return a}static getRewardGrowthInside(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new We(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new We(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(D.wrappingSubU128(D.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getRewardGrowthInsideV2(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new We(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new We(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(D.wrappingSubU128(D.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:a,epochInfo:o}){var c,d,h,K;let r=v.priceToSqrtPriceX64(new mn(e.price),e.mintA.decimals,e.mintB.decimals),s=v.getSqrtPriceX64FromTick(t.tickLower),l=v.getSqrtPriceX64FromTick(t.tickUpper),p=a?1+i:1-i,b=z.getAmountsFromLiquidity(r,s,l,n,a),[y,u]=[ue(b.amountA,(c=e.mintA.extensions)==null?void 0:c.feeConfig,o,!0),ue(b.amountB,(d=e.mintB.extensions)==null?void 0:d.feeConfig,o,!0)],[k,m]=[ue(new We(new mn(b.amountA.toString()).mul(p).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,o,!0),ue(new We(new mn(b.amountB.toString()).mul(p).toFixed(0)),(K=e.mintB.extensions)==null?void 0:K.feeConfig,o,!0)];return{liquidity:n,amountA:y,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:Ge(y.expirationTime,u.expirationTime)}}};var Er=15,U=class{static async getTickArrays(e,t,n,i,a,o,r){let s=[],l=L.getTickArrayStartIndexByTick(i,a),p=L.getInitializedTickArrayInRange(o,r,a,l,Math.floor(Er/2));for(let u=0;u<p.length;u++){let{publicKey:k}=Y(t,n,p[u]);s.push(k)}let b=(await He(e,s)).map(u=>u!==null?kt.decode(u.data):null),y={};for(let u=0;u<s.length;u++){let k=b[u];k!==null&&(y[k.startTickIndex]=j(Q({},k),{address:s[u]}))}return y}static nextInitializedTick(e,t,n,i,a,o){let{initializedTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}=this.nextInitializedTickInOneArray(e,t,n,i,a,o);for(;r==null||r.liquidityGross.lten(0);){if(l=L.getNextTickArrayStartIndex(l,a,o),this.checkIsValidStartIndex(l,a))throw new Error("No enough initialized tickArray");let p=n[l];if(p===void 0)continue;let{nextTick:b,tickArrayAddress:y,tickArrayStartTickIndex:u}=this.firstInitializedTickInOneArray(e,t,p,o);[r,s,l]=[b,y,u]}if(r==null)throw new Error("No invaild tickArray cache");return{nextTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}}static nextInitializedTickArray(e,t,n,i,a){let o=Math.floor(e/U.tickCount(t)),r=n?L.searchLowBitFromStart(i,a,o-1,1,t):L.searchHightBitFromStart(i,a,o+1,1,t);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let a;if(i){let r=de-1;for(;r>=0;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r-1}}else{let r=0;for(;r<de;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r+1}}let{publicKey:o}=Y(e,t,n.startTickIndex);return{nextTick:a,tickArrayAddress:o,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,a,o){let r=L.getTickArrayStartIndexByTick(i,a),s=Math.floor((i-r)/a),l=n[r];if(l==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:r};let p;if(o)for(;s>=0;){let y=l.ticks[s];if(y.liquidityGross.gtn(0)){p=y;break}s=s-1}else for(s=s+1;s<de;){let y=l.ticks[s];if(y.liquidityGross.gtn(0)){p=y;break}s=s+1}let{publicKey:b}=Y(e,t,r);return{initializedTick:p,tickArrayAddress:b,tickArrayStartTickIndex:l.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(L.checkIsOutOfBoundary(e)){if(e>Te)return!1;let n=L.getTickArrayStartIndexByTick(ke,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return de*e}};var pn=14,ze=class{static maxTickInTickarrayBitmap(e){return e*de*$e}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let a=n*i;return e<0?{minValue:-a,maxValue:-a+n}:{minValue:a,maxValue:a+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let a=this.maxTickInTickarrayBitmap(n),o=i?t-U.tickCount(n):t+U.tickCount(n);if(o<-a||o>=a)return{isInit:!1,tickIndex:t};let r=n*de,s=o/r+512;o<0&&o%r!=0&&s--;let l=Math.abs(s);if(i){let p=e.shln(1024-l-1),b=$n(1024,p);if(b!==null){let y=(l-b-512)*r;return{isInit:!0,tickIndex:y}}else return{isInit:!1,tickIndex:-a}}else{let p=e.shrn(l),b=ei(1024,p);if(b!==null){let y=(l+b-512)*r;return{isInit:!0,tickIndex:y}}else return{isInit:!1,tickIndex:a-U.tickCount(n)}}}},At=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=ze.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;if(Te<=t)throw Error(`extensionTickBoundary check error: ${Te}, ${t}`);if(n<=ke)throw Error(`extensionTickBoundary check error: ${n}, ${ke}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),a=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:L.mergeTickArrayBitmap(i).testn(a),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let a=U.tickCount(t),o=n?e-a:e+a,{tickarrayBitmap:r}=this.getBitmap(o,t,i);return this.nextInitializedTickArrayInBitmap(r,o,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:a,maxValue:o}=ze.getBitmapTickBoundary(t,n),r=this.tickArrayOffsetInBitmap(t,n);if(i){let s=L.mergeTickArrayBitmap(e).shln($e-1-r),l=gt(512,s)?null:sn(512,s);if(l!==null){let p=t-l*U.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:a}}else{let s=L.mergeTickArrayBitmap(e).shrn(r),l=gt(512,s)?null:an(512,s);if(l!==null){let p=t+l*U.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%ze.maxTickInTickarrayBitmap(t),i=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(i=$e-i),i}};var se=class{static getOutputAmountAndRemainAccounts(e,t,n,i,a,o=!1){let r=n.toBase58()===e.mintA.address,s=[],{isExist:l,startIndex:p,nextAccountMeta:b}=this.getFirstInitializedTickArray(e,r);if(!l||p===void 0||!b)throw new Error("Invalid tick array");s.push(b);let{allTrade:y,amountCalculated:u,accounts:k,sqrtPriceX64:m,feeAmount:c}=et.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,r,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,p,a,o);return s.push(...k),{allTrade:y,expectedAmountOut:u.mul(Ue),remainingAccounts:s,executionPrice:m,feeAmount:c}}static getInputAmountAndRemainAccounts(e,t,n,i,a){let o=n.toBase58()===e.mintB.address,r=[],{isExist:s,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,o);if(!s||l===void 0||!p)throw new Error("Invalid tick array");try{let m=this.preInitializedTickArrayStartIndex(e,o);if(m.isExist){let{publicKey:c}=Y(e.programId,e.id,m.nextStartIndex);r.push(c)}}catch{}r.push(p);let{amountCalculated:b,accounts:y,sqrtPriceX64:u,feeAmount:k}=et.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Ue),l,a);return r.push(...y),{expectedAmountIn:b,remainingAccounts:r,executionPrice:u,feeAmount:k}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=se.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?At.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):L.checkTickArrayIsInitialized(L.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:r}=Y(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:r}}let{isExist:a,nextStartIndex:o}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(a){let{publicKey:r}=Y(e.programId,e.id,o);return{isExist:!0,startIndex:o,nextAccountMeta:r}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),i=t?L.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):L.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:a}=ze.nextInitializedTickArrayStartIndex(L.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:a};t=a;let{isInit:o,tickIndex:r}=At.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(o)return{isExist:!0,nextStartIndex:r};if(t=r,t<ke||t>Te)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:a}){var r,s,l;let o=[];for(let p=0;p<a.length;p++){let b=a[p],y=(l=(r=t.rewardDefaultInfos[p])==null?void 0:r.mint.programId)!=null?l:(s=await e.getAccountInfo(b.tokenMint))==null?void 0:s.owner;if(y===void 0)throw Error("get new reward mint info error");let u=j(Q({},b),{perSecond:D.x64ToDecimal(b.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ce(y)});if(u.tokenMint.equals(Ce.default))continue;if(n<=u.openTime.toNumber()||i.eq(oe)){o.push(u);continue}let k=new ie(Math.min(u.endTime.toNumber(),n)),m=k.sub(u.lastUpdateTime),c=D.mulDivFloor(m,u.emissionsPerSecondX64,i),d=u.rewardGrowthGlobalX64.add(c),h=D.mulDivFloor(m,u.emissionsPerSecondX64,Ke),K=u.rewardTotalEmissioned.add(h);o.push(j(Q({},u),{rewardGrowthGlobalX64:d,rewardTotalEmissioned:K,lastUpdateTime:k}))}return o}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let a of t){let o=L.getTickArrayStartIndexByTick(a,e);if(o>=n||o<i)return!0}return!1}static tickRange(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;return t>Te&&(t=U.getArrayStartIndex(Te,e)+U.tickCount(e)),n<ke&&(n=U.getArrayStartIndex(ke,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*$e}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await ut(e,t.map(o=>({pubkey:o})),{batchRequest:n}),a={};for(let o of i)o.accountInfo!==null&&(a[o.pubkey.toString()]=ai.decode(o.accountInfo.data));return a}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},a=[];for(let s of t){let l=L.getTickArrayStartIndexByTick(s.tickCurrent,s.tickSpacing),p=L.getInitializedTickArrayInRange(s.tickArrayBitmap,s.exBitmapInfo,s.tickSpacing,l,7);for(let b of p){let{publicKey:y}=Y(s.programId,s.id,b);a.push({pubkey:y}),i[y.toString()]=s.id}}let o=await ut(e,a,{batchRequest:n}),r={};for(let s of o){if(!s.accountInfo)continue;let l=i[s.pubkey.toString()];if(!l)continue;r[l.toString()]===void 0&&(r[l.toString()]={});let p=kt.decode(s.accountInfo.data);r[l.toString()][p.startTickIndex]=j(Q({},p),{address:s.pubkey})}return r}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:a=!0}){var r;let o=[];for(let s=0;s<e.length;s++){let l=e[s];l!==null&&(o.find(p=>p.equals(l.state.programId))||o.push(l.state.programId))}if(n){let s=n.tokenAccounts.map(y=>y.accountInfo.mint),l=[];for(let y of s)for(let u of o)l.push(he(u,y).publicKey);let p=await He(t,l,{batchRequest:i}),b={};for(let y of p){if(y===null)continue;let u=dn.decode(y.data),k=u.poolId.toString(),m=e.find(N=>N.state.id.toBase58()===k);if(m===void 0)continue;let c=m.state,d=L._getTickPriceLegacy({poolInfo:c,tick:u.tickLower,baseIn:!0}),h=L._getTickPriceLegacy({poolInfo:c,tick:u.tickUpper,baseIn:!0}),{amountA:K,amountB:M}=z.getAmountsFromLiquidity(c.sqrtPriceX64,d.tickSqrtPriceX64,h.tickSqrtPriceX64,u.liquidity,!1),E=1/(1-Math.sqrt(Math.sqrt(d.price.div(h.price).toNumber())));m.positionAccount=[...(r=m.positionAccount)!=null?r:[],{poolId:u.poolId,nftMint:u.nftMint,priceLower:d.price,priceUpper:h.price,amountA:K,amountB:M,tickLower:u.tickLower,tickUpper:u.tickUpper,liquidity:u.liquidity,feeGrowthInsideLastX64A:u.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:u.feeGrowthInsideLastX64B,tokenFeesOwedA:u.tokenFeesOwedA,tokenFeesOwedB:u.tokenFeesOwedB,rewardInfos:u.rewardInfos.map(N=>j(Q({},N),{pendingReward:new ie(0)})),leverage:E,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let w=await L.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickLower,m.state.tickSpacing),C=await L.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickUpper,m.state.tickSpacing);b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickLower}`]=w,b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickUpper}`]=C}if(a){let y=Object.values(b),u=await He(t,y,{batchRequest:i}),k={};for(let m=0;m<y.length;m++){let c=u[m];if(c===null)continue;let d=y[m].toString();k[d]=kt.decode(c.data)}for(let{state:m,positionAccount:c}of e)if(!!c)for(let d of c){let h=`${m.programId.toString()}-${m.id.toString()}-${d.tickLower}`,K=`${m.programId.toString()}-${m.id.toString()}-${d.tickUpper}`,M=k[b[h].toString()],E=k[b[K].toString()],w=M.ticks[L.getTickOffsetInArray(d.tickLower,m.tickSpacing)],C=E.ticks[L.getTickOffsetInArray(d.tickUpper,m.tickSpacing)],{tokenFeeAmountA:N,tokenFeeAmountB:_}=await Pt.GetPositionFees(m,d,w,C),I=await Pt.GetPositionRewards(m,d,w,C);d.tokenFeeAmountA=N.gte(new ie(0))?N:new ie(0),d.tokenFeeAmountB=_.gte(new ie(0))?_:new ie(0);for(let V=0;V<I.length;V++)d.rewardInfos[V].pendingReward=I[V].gte(new ie(0))?I[V]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:a,slippage:o,priceLimit:r=new X(0),catchLiquidityInsufficient:s=!1}){var ye;let l,p=n.toBase58()===e.mintA.address,[b,y]=p?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];r.equals(new X(0))?l=p?Ee.add(new ie(1)):Fe.sub(new ie(1)):l=v.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let u=ue(a,b,i,!1),{allTrade:k,expectedAmountOut:m,remainingAccounts:c,executionPrice:d,feeAmount:h}=se.getOutputAmountAndRemainAccounts(e,t,n,u.amount.sub((ye=u.fee)!=null?ye:oe),l,s),K=ue(m,y,i,!1),M=v.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),E=p?M:new X(1).div(M),w=m.mul(new ie(Math.floor((1-o)*1e10))).div(new ie(1e10)),C=ue(w,y,i,!1),N=p?e.currentPrice:new X(1).div(e.currentPrice),_=new X(E).sub(N).abs(),I=N,V=new De(new X(_).mul(10**15).toFixed(0),new X(I).mul(10**15).toFixed(0));return{allTrade:k,realAmountIn:u,amountOut:K,minAmountOut:C,expirationTime:Ge(u.expirationTime,K.expirationTime),currentPrice:e.currentPrice,executionPrice:E,priceImpact:V,fee:h,remainingAccounts:c,executionPriceX64:d}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:a,epochInfo:o,catchLiquidityInsufficient:r=!1}){let s=i.address===e.mintB.address,[l,p]=s?[e.mintA,e.mintB]:[e.mintB,e.mintA],[b,y]=[new Ne(j(Q({},l),{mint:l.address,isToken2022:l.programId===si.toBase58()})),new Ne(j(Q({},p),{mint:p.address,isToken2022:p.programId===si.toBase58()}))],{allTrade:u,realAmountIn:k,amountOut:m,minAmountOut:c,expirationTime:d,currentPrice:h,executionPrice:K,priceImpact:M,fee:E,remainingAccounts:w,executionPriceX64:C}=se.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ce(l.address),amountIn:n,slippage:a,epochInfo:o,catchLiquidityInsufficient:r}),N=j(Q({},k),{amount:new pe(b,k.amount),fee:k.fee===void 0?void 0:new pe(b,k.fee)}),_=j(Q({},m),{amount:new pe(y,m.amount),fee:m.fee===void 0?void 0:new pe(y,m.fee)}),I=j(Q({},c),{amount:new pe(y,c.amount),fee:c.fee===void 0?void 0:new pe(y,c.fee)}),V=new Ie({baseToken:b,denominator:new ie(10).pow(new ie(20+b.decimals)),quoteToken:y,numerator:h.mul(new X(10**(20+y.decimals))).toFixed(0)}),ye=new Ie({baseToken:b,denominator:new ie(10).pow(new ie(20+b.decimals)),quoteToken:y,numerator:K.mul(new X(10**(20+y.decimals))).toFixed(0)}),ce=new pe(b,E);return{allTrade:u,realAmountIn:N,amountOut:_,minAmountOut:I,expirationTime:d,currentPrice:V,executionPrice:ye,priceImpact:M,fee:ce,remainingAccounts:w,executionPriceX64:C}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:a,slippage:o,priceLimit:r=new X(0)}){var I;let s=n.toBase58()===e.mintA.address,l={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},p;r.equals(new X(0))?p=s?Fe.sub(new ie(1)):Ee.add(new ie(1)):p=v.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let b=ue(a,l[n.toString()],i,!0),{expectedAmountIn:y,remainingAccounts:u,executionPrice:k,feeAmount:m}=se.getInputAmountAndRemainAccounts(e,t,n,b.amount.sub((I=b.fee)!=null?I:oe),p),c=s?e.mintB.address:e.mintA.address,d=ue(y,l[c],i,!1),h=v.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),K=s?h:new X(1).div(h),M=y.mul(new ie(Math.floor((1+o)*1e10))).div(new ie(1e10)),E=ue(M,l[c],i,!0),w=s?e.currentPrice:new X(1).div(e.currentPrice),C=new X(K).sub(w).abs(),N=w,_=new De(new X(C).mul(10**15).toFixed(0),new X(N).mul(10**15).toFixed(0));return{amountIn:d,maxAmountIn:E,realAmountOut:b,expirationTime:Ge(d.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:K,priceImpact:_,fee:m,remainingAccounts:u}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var k,m,c;let a=e[t],o=L.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),r=L.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),s=Math.max(o,a.priceMin),p=Math.min(r,a.priceMax)-s,b=r-o,y=a.priceMax-a.priceMin,u;return p<=0?u=0:b===p?u=y/p:y===p?u=p/b:u=p/y*(p/b),{feeApr:a.feeApr*u,rewardsApr:[((k=a.rewardApr[0])!=null?k:0)*u,((m=a.rewardApr[1])!=null?m:0)*u,((c=a.rewardApr[2])!=null?c:0)*u],apr:a.apr*u}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:a,positionTickLowerIndex:o,positionTickUpperIndex:r,chainTime:s}){let l=n==="day"?1:n==="week"?7:n==="month"?30:0,p=e[n],b=i[rt(e.mintA.address).toString()],y=i[rt(e.mintB.address).toString()],u=e.mintA.decimals,k=e.mintB.decimals;if(!p||!b||!y)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let m=v.priceToSqrtPriceX64(new X(e.price),e.mintA.decimals,e.mintB.decimals),c=v.getSqrtPriceX64FromTick(o),d=v.getSqrtPriceX64FromTick(r),{amountSlippageA:h,amountSlippageB:K}=z.getAmountsFromLiquidityWithSlippage(m,c,d,t,!1,!1,0),{amountSlippageA:M,amountSlippageB:E}=z.getAmountsFromLiquidityWithSlippage(m,c,d,a,!1,!1,0),w=new X(h.toString()).div(new X(10).pow(u)).mul(b.value).add(new X(K.toString()).div(new X(10).pow(k)).mul(y.value)),C=new X(M.toString()).div(new X(10).pow(u)).mul(b.value).add(new X(E.toString()).div(new X(10).pow(k)).mul(y.value)),N=new X(1).div(w.add(C)),I=new X(p.volumeFee).mul(365).div(l).mul(N).mul(100).toNumber(),V=3600*24*365,ye=e.rewardDefaultInfos.map(ce=>{var wn,hn;let we=ce.mint.decimals,it=i[ce.mint.address];return s<((wn=ce.startTime)!=null?wn:0)||s>((hn=ce.endTime)!=null?hn:0)||!ce.perSecond||!it||we===void 0?0:new X(it.value).mul(new X(ce.perSecond).mul(V)).div(new X(10).pow(we)).mul(N).mul(100).toNumber()});return{feeApr:I,rewardsApr:ye,apr:I+ye.reduce((ce,we)=>ce+we,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:a,slippage:o,add:r,epochInfo:s,amountHasFee:l}){var d,h;let p=v.priceToSqrtPriceX64(new X(e.price),e.mintA.decimals,e.mintB.decimals),b=v.getSqrtPriceX64FromTick(n),y=v.getSqrtPriceX64FromTick(i),u=ue(a,(d=e[t?"mintA":"mintB"].extensions)==null?void 0:d.feeConfig,s,!l),k=new ie(new X(u.amount.sub((h=u.fee)!=null?h:oe).toString()).toFixed(0)),m;if(p.lte(b))m=t?z.getLiquidityFromTokenAmountA(b,y,k,!r):new ie(0);else if(p.lte(y)){let K=z.getLiquidityFromTokenAmountA(p,y,k,!r),M=z.getLiquidityFromTokenAmountB(b,p,k);m=t?K:M}else m=t?new ie(0):z.getLiquidityFromTokenAmountB(b,y,k);let c=await se.getAmountsFromLiquidity({epochInfo:s,poolInfo:e,tickLower:n,tickUpper:i,liquidity:m,slippage:o,add:r});return{liquidity:m,amountA:t?u:c.amountA,amountB:t?c.amountB:u,amountSlippageA:t?u:c.amountSlippageA,amountSlippageB:t?c.amountSlippageB:u,expirationTime:c.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:a,slippage:o,add:r}){var c,d,h,K;let s=v.getSqrtPriceX64FromTick(n),l=v.getSqrtPriceX64FromTick(i),p=r?1+o:1-o,b=z.getAmountsFromLiquidity(v.priceToSqrtPriceX64(new X(t.price),t.mintA.decimals,t.mintB.decimals),s,l,a,r),[y,u]=[ue(b.amountA,(c=t.mintA.extensions)==null?void 0:c.feeConfig,e,!0),ue(b.amountB,(d=t.mintB.extensions)==null?void 0:d.feeConfig,e,!0)],[k,m]=[ue(b.amountA.muln(p),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ue(b.amountB.muln(p),(K=t.mintB.extensions)==null?void 0:K.feeConfig,e,!0)];return{liquidity:a,amountA:y,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:Ge(y.expirationTime,u.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(s=>!n[s.id]).map(s=>new Ce(s.id));(await He(e,i)).forEach((s,l)=>{!s||(n[i[l].toBase58()]=vt.decode(s.data))});let o=t.map(s=>me(new Ce(s.programId),new Ce(s.id)).publicKey),r=await se.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((s,l)=>j(Q({},s),{[l.id]:j(Q({},n[l.id]),{id:new Ce(l.id),version:6,programId:new Ce(l.programId),mintA:l.mintA,mintB:l.mintB,ammConfig:j(Q({},l.config),{id:new Ce(l.config.id),fundOwner:""}),currentPrice:new X(l.price),exBitmapAccount:me(new Ce(l.programId),new Ce(l.id)).publicKey,exBitmapInfo:r[me(new Ce(l.programId),new Ce(l.id)).publicKey.toBase58()],startTime:n[l.id].startTime.toNumber(),rewardInfos:n[l.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var D=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),a=i.div(n);return i.mod(n).eq(oe)||(a=a.add(Se)),a}static mulDivFloor(e,t,n){if(n.eq(oe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(oe))throw new Error("division by 0");return e.mul(t).add(n.sub(Se)).div(n)}static x64ToDecimal(e,t){return new ve(e.toString()).div(ve.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new q(e.mul(ve.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Nt).sub(t).mod(Nt)}};function be(P,e){return fn(P.mul(e),64,256)}function Fr(P,e,t){let n=P.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function fn(P,e,t){let n=P.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var v=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(ve.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(ve.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(oe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(oe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(oe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(oe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(oe))return e;let a=t.shln(yt);if(i){let o=a,r=a.add(n.mul(e));return r.gte(o)?D.mulDivCeil(o,e,r):D.mulDivRoundingUp(o,Se,o.div(e).add(n))}else{let o=n.mul(e);if(!a.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let r=a.sub(o);return D.mulDivCeil(a,e,r)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let a=n.shln(yt);if(i)return e.add(a.div(t));{let o=D.mulDivRoundingUp(a,Se,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<ke||e>Te)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new q("18445821805675395072"):new q("18446744073709551616");return(t&2)!=0&&(n=be(n,new q("18444899583751176192"))),(t&4)!=0&&(n=be(n,new q("18443055278223355904"))),(t&8)!=0&&(n=be(n,new q("18439367220385607680"))),(t&16)!=0&&(n=be(n,new q("18431993317065453568"))),(t&32)!=0&&(n=be(n,new q("18417254355718170624"))),(t&64)!=0&&(n=be(n,new q("18387811781193609216"))),(t&128)!=0&&(n=be(n,new q("18329067761203558400"))),(t&256)!=0&&(n=be(n,new q("18212142134806163456"))),(t&512)!=0&&(n=be(n,new q("17980523815641700352"))),(t&1024)!=0&&(n=be(n,new q("17526086738831433728"))),(t&2048)!=0&&(n=be(n,new q("16651378430235570176"))),(t&4096)!=0&&(n=be(n,new q("15030750278694412288"))),(t&8192)!=0&&(n=be(n,new q("12247334978884435968"))),(t&16384)!=0&&(n=be(n,new q("8131365268886854656"))),(t&32768)!=0&&(n=be(n,new q("3584323654725218816"))),(t&65536)!=0&&(n=be(n,new q("696457651848324352"))),(t&131072)!=0&&(n=be(n,new q("26294789957507116"))),(t&262144)!=0&&(n=be(n,new q("37481735321082"))),e>0&&(n=Hn.div(n)),n}static getTickFromPrice(e,t,n){return v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Fe)||e.lt(Ee))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new q(t-64),i=Fr(n,32,128),a=new q("8000000000000000","hex"),o=0,r=new q(0),s=t>=64?e.shrn(t-63):e.shln(63-t);for(;a.gt(new q(0))&&o<Yn;){s=s.mul(s);let k=s.shrn(127);s=s.shrn(63+k.toNumber()),r=r.add(a.mul(k)),a=a.shrn(1),o+=1}let l=r.shrn(32),b=i.add(l).mul(new q(jn)),y=fn(b.sub(new q(Zn)),64,128).toNumber(),u=fn(b.add(new q(Jn)),64,128).toNumber();return y==u?y:v.getSqrtPriceX64FromTick(u).lte(e)?u:y}},tt=class{static getTickWithPriceAndTickspacing(e,t,n,i){let o=v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,n,i))/t;return o<0?o=Math.floor(o):o=Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,i){let a=tt.getTickWithPriceAndTickspacing(e,t,n,i),o=v.getSqrtPriceX64FromTick(a);return v.sqrtPriceX64ToPrice(o,n,i)}},z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oe))throw new Error("sqrtPriceX64A must greater than 0");let a=n.ushln(yt),o=t.sub(e);return i?D.mulDivRoundingUp(D.mulDivCeil(a,o,t),Se,e):D.mulDivFloor(a,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oe))throw new Error("sqrtPriceX64A must greater than 0");return i?D.mulDivCeil(n,t.sub(e),Ke):D.mulDivFloor(n,t.sub(e),Ke)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let a=n.mul(e).mul(t),o=t.sub(e),r=a.div(o);return i?D.mulDivRoundingUp(r,Se,on):r.shrn(yt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),D.mulDivFloor(n,on,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return z.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let o=z.getLiquidityFromTokenAmountA(e,n,i,!1),r=z.getLiquidityFromTokenAmountB(t,e,a);return o.lt(r)?o:r}else return z.getLiquidityFromTokenAmountB(t,n,a)}static getAmountsFromLiquidity(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:z.getTokenAmountAFromLiquidity(t,n,i,a),amountB:new q(0)};if(e.lt(n)){let o=z.getTokenAmountAFromLiquidity(e,n,i,a),r=z.getTokenAmountBFromLiquidity(t,e,i,a);return{amountA:o,amountB:r}}else return{amountA:new q(0),amountB:z.getTokenAmountBFromLiquidity(t,n,i,a)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,a,o,r){let{amountA:s,amountB:l}=z.getAmountsFromLiquidity(e,t,n,i,o),p=a?1+r:1-r,b=new q(new ve(s.toString()).mul(p).toFixed(0)),y=new q(new ve(l.toString()).mul(p).toFixed(0));return{amountSlippageA:b,amountSlippageB:y}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:a,add:o,epochInfo:r,amountAddFee:s}){var h,K,M,E;let l=v.priceToSqrtPriceX64(new ve(e.price),e.mintA.decimals,e.mintB.decimals),p=v.getSqrtPriceX64FromTick(t),b=v.getSqrtPriceX64FromTick(n),y=o?1+a:1-a,u=z.getAmountsFromLiquidity(l,p,b,i,o),[k,m]=[ue(u.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,r,s),ue(u.amountB,(K=e.mintB.extensions)==null?void 0:K.feeConfig,r,s)],[c,d]=[ue(new q(new ve(u.amountA.toString()).mul(y).toFixed(0)),(M=e.mintA.extensions)==null?void 0:M.feeConfig,r,s),ue(new q(new ve(u.amountB.toString()).mul(y).toFixed(0)),(E=e.mintB.extensions)==null?void 0:E.feeConfig,r,s)];return{liquidity:i,amountA:k,amountB:m,amountSlippageA:c,amountSlippageB:d,expirationTime:Ge(k.expirationTime,m.expirationTime)}}},et=class{static swapCompute(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m=!1){if(y.eq(oe))throw new Error("amountSpecified must not be 0");if(k||(k=o?Ee.add(Se):Fe.sub(Se)),o){if(k.lt(Ee))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(k.gte(b))throw new Error("sqrtPriceX64 must smaller than current")}else{if(k.gt(Fe))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(k.lte(b))throw new Error("sqrtPriceX64 must greater than current")}let c=y.gt(oe),d={amountSpecifiedRemaining:y,amountCalculated:oe,sqrtPriceX64:b,tick:l>u?Math.min(u+U.tickCount(p)-1,l):u,accounts:[],liquidity:s,feeAmount:new q(0)},h=u,K=n[u],M=0,E=!o&&K.startTickIndex===d.tick;for(;!d.amountSpecifiedRemaining.eq(oe)&&!d.sqrtPriceX64.eq(k);){M>10;let w={};w.sqrtPriceStartX64=d.sqrtPriceX64;let C=L.nextInitTick(K,d.tick,p,o,E),N=C||null,_=null;if(!(N!=null&&N.liquidityGross.gtn(0))){let V=se.nextInitializedTickArrayStartIndex({tickCurrent:d.tick,tickSpacing:p,tickArrayBitmap:i,exBitmapInfo:a},h,o);if(!V.isExist){if(m)return{allTrade:!1,amountSpecifiedRemaining:d.amountSpecifiedRemaining,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts};throw Error("swapCompute LiquidityInsufficient")}h=V.nextStartIndex;let{publicKey:ye}=Y(e,t,h);_=ye,K=n[h];try{N=L.firstInitializedTick(K,o)}catch{throw Error("not found next tick info")}}w.tickNext=N.tick,w.initialized=N.liquidityGross.gtn(0),u!==h&&_&&(d.accounts.push(_),u=h),w.tickNext<ke?w.tickNext=ke:w.tickNext>Te&&(w.tickNext=Te),w.sqrtPriceNextX64=v.getSqrtPriceX64FromTick(w.tickNext);let I;if(o&&w.sqrtPriceNextX64.lt(k)||!o&&w.sqrtPriceNextX64.gt(k)?I=k:I=w.sqrtPriceNextX64,[d.sqrtPriceX64,w.amountIn,w.amountOut,w.feeAmount]=et.swapStepCompute(d.sqrtPriceX64,I,d.liquidity,d.amountSpecifiedRemaining,r,o),d.feeAmount=d.feeAmount.add(w.feeAmount),c?(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.sub(w.amountIn.add(w.feeAmount)),d.amountCalculated=d.amountCalculated.sub(w.amountOut)):(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.add(w.amountOut),d.amountCalculated=d.amountCalculated.add(w.amountIn.add(w.feeAmount))),d.sqrtPriceX64.eq(w.sqrtPriceNextX64)){if(w.initialized){let V=N.liquidityNet;o&&(V=V.mul(Ue)),d.liquidity=z.addDelta(d.liquidity,V)}E=w.tickNext!=d.tick&&!o&&K.startTickIndex===w.tickNext,d.tick=o?w.tickNext-1:w.tickNext}else if(d.sqrtPriceX64!=w.sqrtPriceStartX64){let V=v.getTickFromSqrtPriceX64(d.sqrtPriceX64);E=V!=d.tick&&!o&&K.startTickIndex===V,d.tick=V}++M}try{let{nextStartIndex:w,isExist:C}=U.nextInitializedTickArray(d.tick,p,o,i,a);C&&u!==w&&(d.accounts.push(Y(e,t,w).publicKey),u=w)}catch{}return{allTrade:!0,amountSpecifiedRemaining:oe,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts}}static swapStepCompute(e,t,n,i,a,o){let r={sqrtPriceX64Next:new q(0),amountIn:new q(0),amountOut:new q(0),feeAmount:new q(0)},s=i.gte(oe);if(s){let p=D.mulDivFloor(i,Et.sub(new q(a.toString())),Et);r.amountIn=o?z.getTokenAmountAFromLiquidity(t,e,n,!0):z.getTokenAmountBFromLiquidity(e,t,n,!0),p.gte(r.amountIn)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=v.getNextSqrtPriceX64FromInput(e,n,p,o)}else r.amountOut=o?z.getTokenAmountBFromLiquidity(t,e,n,!1):z.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Ue).gte(r.amountOut)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=v.getNextSqrtPriceX64FromOutput(e,n,i.mul(Ue),o);let l=t.eq(r.sqrtPriceX64Next);return o?(l&&s||(r.amountIn=z.getTokenAmountAFromLiquidity(r.sqrtPriceX64Next,e,n,!0)),l&&!s||(r.amountOut=z.getTokenAmountBFromLiquidity(r.sqrtPriceX64Next,e,n,!1))):(r.amountIn=l&&s?r.amountIn:z.getTokenAmountBFromLiquidity(e,r.sqrtPriceX64Next,n,!0),r.amountOut=l&&!s?r.amountOut:z.getTokenAmountAFromLiquidity(e,r.sqrtPriceX64Next,n,!1)),!s&&r.amountOut.gt(i.mul(Ue))&&(r.amountOut=i.mul(Ue)),s&&!r.sqrtPriceX64Next.eq(t)?r.feeAmount=i.sub(r.amountIn):r.feeAmount=D.mulDivCeil(r.amountIn,new q(a),Et.sub(new q(a))),[r.sqrtPriceX64Next,r.amountIn,r.amountOut,r.feeAmount]}};var de=60,$e=512,L=class{static getTickArrayAddressByTick(e,t,n,i){let a=L.getTickArrayStartIndexByTick(n,i),{publicKey:o}=Y(e,t,a);return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=L.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=de)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*de,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*de,a=Math.floor(t/i)+512,o=Math.abs(a);return{isInitialized:e.testn(o),startIndex:(o-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*de:e+t*de}static mergeTickArrayBitmap(e){let t=new Wr(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,a){let o=Math.floor(i/(n*de));return[...L.searchLowBitFromStart(e,t,o-1,a,n),...L.searchHightBitFromStart(e,t,o,a,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return L.searchHightBitFromStart(e,t,-7680,$e,n)}static getAllInitializedTickArrayInfo(e,t,n,i,a){let o=[],r=L.getAllInitializedTickArrayStartIndex(n,i,a);for(let s of r){let{publicKey:l}=Y(e,t,s);o.push({tickArrayStartIndex:s,tickArrayAddress:l})}return o}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>L.mergeTickArrayBitmap(l)),r=[];for(;n>=-7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n--,r.length===i)break}let s=U.tickCount(a);return r.map(l=>l*s)}static searchHightBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>L.mergeTickArrayBitmap(l)),r=[];for(;n<7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n++,r.length===i)break}let s=U.tickCount(a);return r.map(l=>l*s)}static checkIsOutOfBoundary(e){return e<ke||e>Te}static nextInitTick(e,t,n,i,a){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let r=Math.floor((t-e.startTickIndex)/n);if(i)for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r-1}else for(a||(r=r+1);r<de;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r+1}return null}static firstInitializedTick(e,t){if(t){let n=de-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<de;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),a=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new at(1).div(a),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new at(1).div(t),a=tt.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=v.getSqrtPriceX64FromTick(a),r=v.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new at(1).div(r)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),a=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new at(1).div(a),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new at(1).div(t),a=tt.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=v.getSqrtPriceX64FromTick(a),r=v.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new at(1).div(r)}}};var vr=R([le(8),F("bump"),Je("index"),B(""),xe("protocolFeeRate"),xe("tradeFeeRate"),Je("tickSpacing"),G(g(),8,"")]),Vr=R([xe("blockTimestamp"),zn("tickCumulative"),G(g(),4)]),ui=R([le(8),fe("initialized"),g("recentEpoch"),Je("observationIndex"),B("poolId"),G(Vr,100,"observations"),G(g(),4)]),_r=R([F("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),W("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),B("tokenMint"),B("tokenVault"),B("creator"),W("rewardGrowthGlobalX64")]),vt=R([le(8),F("bump"),B("ammConfig"),B("creator"),B("mintA"),B("mintB"),B("vaultA"),B("vaultB"),B("observationId"),F("mintDecimalsA"),F("mintDecimalsB"),Je("tickSpacing"),W("liquidity"),W("sqrtPriceX64"),ne("tickCurrent"),xe(),W("feeGrowthGlobalX64A"),W("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),W("swapInAmountTokenA"),W("swapOutAmountTokenB"),W("swapInAmountTokenB"),W("swapOutAmountTokenA"),F("status"),G(F(),7,""),G(_r,3,"rewardInfos"),G(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),G(g(),15*4-3,"padding")]),Dr=R([W("growthInsideLastX64"),g("rewardAmountOwed")]),dn=R([le(8),F("bump"),B("nftMint"),B("poolId"),ne("tickLower"),ne("tickUpper"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),G(Dr,3,"rewardInfos"),G(g(),8,"")]),Rm=R([le(8),F("bump"),B("poolId"),ne("tickLowerIndex"),ne("tickUpperIndex"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),G(W(),3,"rewardGrowthInside"),G(g(),8,"")]),qr=R([ne("tick"),Qn("liquidityNet"),W("liquidityGross"),W("feeGrowthOutsideX64A"),W("feeGrowthOutsideX64B"),G(W(),3,"rewardGrowthsOutsideX64"),G(xe(),13,"")]),kt=R([le(8),B("poolId"),ne("startTickIndex"),G(qr,de,"ticks"),F("initializedTickCount"),G(F(),115,"")]),Gr=R([le(329),G(B(),100,"whitelistMints")]),ai=R([le(8),B("poolId"),G(G(g(),8),pn,"positiveTickArrayBitmap"),G(G(g(),8),pn,"negativeTickArrayBitmap")]),Lm=R([g(),F("bump"),B("owner"),B("poolId"),B("positionId"),B("nftAccount"),G(g(),8)]),Ur=R([le(8),F("bump"),B("lockOwner"),B("poolId"),B("positionId"),B("nftAccount"),B("lockNftMint"),g("recentEpoch"),G(g(),8)]);ui.span;var ci=ee("Raydium_Clmm"),Re={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},li=[188,37,179,131,82,150,84,73],mi=[16,72,250,198,14,162,212,19],nt=class{static createPoolInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k){let m=R([W("sqrtPriceX64"),g("zero")]),c=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1},...(k==null?void 0:k.map(K=>({pubkey:K,isSigner:!1,isWritable:!1})))||[]],d=Buffer.alloc(m.span);m.encode({sqrtPriceX64:u,zero:oe},d);let h=Buffer.from([...Re.createPool,...d]);return new Pe({keys:c,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:a,ammConfigId:o,initialPriceX64:r,extendMintAccount:s}=e,[l,p]=[new T(i.address),new T(a.address)],{publicKey:b}=ni(t,o,l,p),{publicKey:y}=ri(t,b),{publicKey:u}=un(t,b,l),{publicKey:k}=un(t,b,p),m=me(t,b).publicKey,c=[this.createPoolInstruction(t,b,n,o,y,l,u,new T(i.programId||J),p,k,new T(a.programId||J),m,r,s)];return{signers:[],instructions:c,instructionTypes:[Z.CreateAccount,Z.ClmmCreatePool],address:{poolId:b,observationId:y,exBitmapAccount:m,mintAVault:u,mintBVault:k},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,K,M,E,w,C,N,_,I){let V=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),W("liquidity"),g("amountMaxA"),g("amountMaxB"),fe("withMetadata"),F("optionBaseFlag"),fe("baseFlag")]),ye=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:je,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...ye],we=Buffer.alloc(V.span);V.encode({tickLowerIndex:h,tickUpperIndex:K,tickArrayLowerStartIndex:M,tickArrayUpperStartIndex:E,liquidity:w,amountMaxA:C,amountMaxB:N,withMetadata:_==="create",baseFlag:!1,optionBaseFlag:0},we);let it=Buffer.from([...Re.openPosition,...we]);return new Pe({keys:ce,programId:e,data:it})}static openPositionFromLiquidityInstruction22(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,K,M,E,w,C,N,_){let I=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),W("liquidity"),g("amountMaxA"),g("amountMaxB"),fe("withMetadata"),F("optionBaseFlag"),fe("baseFlag")]),V=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...V],ce=Buffer.alloc(I.span);I.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:K,tickArrayUpperStartIndex:M,liquidity:E,amountMaxA:w,amountMaxB:C,withMetadata:N==="create",baseFlag:!1,optionBaseFlag:0},ce);let we=Buffer.from([...Re.openPositionWithTokenEx,...ce]);return new Pe({keys:ye,programId:e,data:we})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let y=[],[u,k]=[new T(e.programId),new T(e.id)],m;if(p)m=new T((await p(1))[0]);else{let _=Vt.generate();y.push(_),m=_.publicKey}let c=L.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Y(u,k,c),{publicKey:K}=Y(u,k,d),{publicKey:M}=b?$(n.wallet,m,ae):$(n.wallet,m,J),{publicKey:E}=st(m),{publicKey:w}=he(u,m),{publicKey:C}=Xe(u,k,i,a),N=b?this.openPositionFromLiquidityInstruction22(u,n.feePayer,k,n.wallet,m,M,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0):this.openPositionFromLiquidityInstruction(u,n.feePayer,k,n.wallet,m,M,E,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0);return{signers:y,instructions:[N],instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:m,tickArrayLower:h,tickArrayUpper:K,positionNftAccount:M,metadataAccount:E,personalPosition:w,protocolPosition:C}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,base:o,baseAmount:r,otherAmountMax:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let y=[],[u,k]=[new T(e.programId),new T(e.id)],m;if(p)m=new T((await p(1))[0]);else{let _=Vt.generate();y.push(_),m=_.publicKey}let c=L.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Y(u,k,c),{publicKey:K}=Y(u,k,d),{publicKey:M}=b?$(n.wallet,m,ae):$(n.wallet,m,J),{publicKey:E}=st(m),{publicKey:w}=he(u,m),{publicKey:C}=Xe(u,k,i,a),N=b?this.openPositionFromBaseInstruction22(u,n.feePayer,k,n.wallet,m,M,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,l,o,r,s,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0):this.openPositionFromBaseInstruction(u,n.feePayer,k,n.wallet,m,M,E,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,l,o,r,s,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:h,tickArrayUpper:K,positionNftAccount:M,metadataAccount:E,personalPosition:w,protocolPosition:C},instructions:[N],signers:y,instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,K,M,E,w,C,N,_,I){let V=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),W("liquidity"),g("amountMaxA"),g("amountMaxB"),fe("withMetadata"),F("optionBaseFlag"),fe("baseFlag")]),ye=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:je,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...ye],we=Buffer.alloc(V.span);V.encode({tickLowerIndex:h,tickUpperIndex:K,tickArrayLowerStartIndex:M,tickArrayUpperStartIndex:E,liquidity:new bn(0),amountMaxA:C==="MintA"?N:_,amountMaxB:C==="MintA"?_:N,withMetadata:w==="create",baseFlag:C==="MintA",optionBaseFlag:1},we);let it=Buffer.from([...Re.openPosition,...we]);return new Pe({keys:ce,programId:e,data:it})}static openPositionFromBaseInstruction22(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,K,M,E,w,C,N,_){let I=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),W("liquidity"),g("amountMaxA"),g("amountMaxB"),fe("withMetadata"),F("optionBaseFlag"),fe("baseFlag")]),V=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...V],ce=Buffer.alloc(I.span);I.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:K,tickArrayUpperStartIndex:M,liquidity:new bn(0),amountMaxA:w==="MintA"?C:N,amountMaxB:w==="MintA"?N:C,withMetadata:E==="create",baseFlag:w==="MintA",optionBaseFlag:1},ce);let we=Buffer.from([...Re.openPositionWithTokenEx,...ce]);return new Pe({keys:ye,programId:e,data:we})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let y,u=[];if(p)y=new T((await p(1))[0]);else{let _=Vt.generate();u.push(_),y=_.publicKey}let[k,m]=[new T(e.programId),new T(e.id)],c=L.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Y(k,m,c),{publicKey:K}=Y(k,m,d),{publicKey:M}=b?$(n.wallet,y,ae):$(n.wallet,y,J),{publicKey:E}=st(y),{publicKey:w}=he(k,y),{publicKey:C}=Xe(k,m,i,a),N=b?this.openPositionFromLiquidityInstruction22(k,n.wallet,m,n.wallet,y,M,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(k,m).publicKey:void 0):this.openPositionFromLiquidityInstruction(k,n.wallet,m,n.wallet,y,M,E,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(k,m).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:h,tickArrayUpper:K,positionNftAccount:M,metadataAccount:E,personalPosition:w,protocolPosition:C},instructions:[N],signers:u,instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,a,o){let r=R([]),s=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:Qe.programId,isSigner:!1,isWritable:!1},{pubkey:o?ae:J,isSigner:!1,isWritable:!1}],l=Buffer.alloc(r.span);r.encode({},l);let p=Buffer.from([...Re.closePosition,...l]);return new Pe({keys:s,programId:e,data:p})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:a}){let o=new T(e.programId),r=a?$(n.wallet,i.nftMint,ae).publicKey:$(n.wallet,i.nftMint,J).publicKey,{publicKey:s}=he(o,i.nftMint),l=[];return l.push(this.closePositionInstruction(o,n.wallet,i.nftMint,r,s,a)),{address:{positionNftAccount:r,personalPosition:s},signers:[],instructions:l,instructionTypes:[Z.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h){let K=R([W("liquidity"),g("amountMaxA"),g("amountMaxB"),F("optionBaseFlag"),fe("baseFlag")]),M=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],E=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...M],w=Buffer.alloc(K.span);K.encode({liquidity:m,amountMaxA:c,amountMaxB:d,optionBaseFlag:0,baseFlag:!1},w);let C=Buffer.from([...Re.increaseLiquidity,...w]);return new Pe({keys:E,programId:e,data:C})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMaxA:o,amountMaxB:r,nft2022:s}){let[l,p]=[new T(e.programId),new T(e.id)],b=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Y(l,p,b),{publicKey:k}=Y(l,p,y),{publicKey:m}=s?$(i.wallet,n.nftMint,ae):$(i.wallet,n.nftMint,J),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=Xe(l,p,n.tickLower,n.tickUpper),h=this.increasePositionFromLiquidityInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),a,o,r,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?me(l,p).publicKey:void 0);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},signers:[],instructions:[h],instructionTypes:[Z.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:a,baseAmount:o,otherAmountMax:r,nft2022:s}){let[l,p]=[new T(e.programId),new T(e.id)],b=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Y(l,p,b),{publicKey:k}=Y(l,p,y),{publicKey:m}=s?$(i.wallet,n.nftMint,ae):$(i.wallet,n.nftMint,J),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=Xe(l,p,n.tickLower,n.tickUpper);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},instructions:[this.increasePositionFromBaseInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),a,o,r,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?me(l,p).publicKey:void 0)],signers:[],instructionTypes:[Z.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h){let K=R([W("liquidity"),g("amountMaxA"),g("amountMaxB"),F("optionBaseFlag"),fe("baseFlag")]),M=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],E=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...M],w=Buffer.alloc(K.span);K.encode({liquidity:new bn(0),amountMaxA:m==="MintA"?c:d,amountMaxB:m==="MintA"?d:c,baseFlag:m==="MintA",optionBaseFlag:1},w);let C=Buffer.from([...Re.increaseLiquidity,...w]);return new Pe({keys:E,programId:e,data:C})}static decreaseLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,K){let M=R([W("liquidity"),g("amountMinA"),g("amountMinB")]),E=[...K?[{pubkey:K,isSigner:!1,isWritable:!0}]:[],...m.map(_=>[{pubkey:_.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.rewardMint,isSigner:!1,isWritable:!1}]).flat()],w=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:St,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...E],C=Buffer.alloc(M.span);M.encode({liquidity:c,amountMinA:d,amountMinB:h},C);let N=Buffer.from([...Re.decreaseLiquidity,...C]);return new Pe({keys:w,programId:e,data:N})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMinA:o,amountMinB:r,programId:s,nft2022:l}){let[p,b]=[new T(e.programId),new T(e.id)],y=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),u=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:k}=Y(p,b,y),{publicKey:m}=Y(p,b,u),{publicKey:c}=l?$(i.wallet,n.nftMint,ae):$(i.wallet,n.nftMint,s),{publicKey:d}=he(p,n.nftMint),{publicKey:h}=Xe(p,b,n.tickLower,n.tickUpper),K=[];for(let w=0;w<e.rewardDefaultInfos.length;w++)K.push({poolRewardVault:new T(t.rewardInfos[w].vault),ownerRewardVault:i.rewardAccounts[w],rewardMint:new T(e.rewardDefaultInfos[w].mint.address)});let M=[],E=this.decreaseLiquidityInstruction(p,i.wallet,c,d,b,h,k,m,i.tokenAccountA,i.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),K,a,o,r,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,u])?me(p,b).publicKey:void 0);return M.push(E),{address:{tickArrayLower:k,tickArrayUpper:m,positionNftAccount:c,personalPosition:d,protocolPosition:h},signers:[],instructions:M,instructionTypes:[Z.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d){let h=R([g("amount"),g("otherAmountThreshold"),W("sqrtPriceLimitX64"),fe("isBaseInput")]),K=[...d?[{pubkey:d,isSigner:!1,isWritable:!0}]:[],...b.map(C=>({pubkey:C,isSigner:!1,isWritable:!0}))],M=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:St,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...K],E=Buffer.alloc(h.span);h.encode({amount:u,otherAmountThreshold:k,sqrtPriceLimitX64:m,isBaseInput:c},E);let w=Buffer.from([...Re.swap,...E]);return new Pe({keys:M,programId:e,data:w})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:a,amountIn:o,amountOutMin:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new T(e.programId),new T(e.id)],[y,u]=[new T(t.vault.A),new T(t.vault.B)],[k,m]=[new T(e.mintA.address),new T(e.mintB.address)],c=e.mintA.address===a.toString(),d=[this.swapInstruction(p,i.wallet,b,new T(e.config.id),c?i.tokenAccountA:i.tokenAccountB,c?i.tokenAccountB:i.tokenAccountA,c?y:u,c?u:y,c?k:m,c?m:k,l,n,o,r,s,!0,me(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[Z.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:a,amountOut:o,amountInMax:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new T(e.programId),new T(e.id)],[y,u]=[new T(t.vault.A),new T(t.vault.B)],[k,m]=[new T(e.mintA.address),new T(e.mintB.address)],c=e.mintA.address===a.toBase58(),d=[this.swapInstruction(p,i.wallet,b,new T(e.config.id),c?i.tokenAccountB:i.tokenAccountA,c?i.tokenAccountA:i.tokenAccountB,c?u:y,c?y:u,c?m:k,c?k:m,l,n,o,r,s,!1,me(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[Z.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,y){let u=R([g("openTime"),g("endTime"),W("emissionsPerSecondX64")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({openTime:te(p),endTime:te(b),emissionsPerSecondX64:y},m);let c=Buffer.from([...Re.initReward,...m]);return new Pe({keys:k,programId:e,data:c})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new T(e.programId),new T(e.id)],r=ii(a,o,i.mint).publicKey,s=Wt(a).publicKey,l=[this.initRewardInstruction(a,n.wallet,o,s,new T(e.config.id),n.tokenAccount,i.programId,i.mint,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:r,operationId:s},signers:[],instructions:l,instructionTypes:[Z.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,y){let u=R([F("rewardIndex"),W("emissionsPerSecondX64"),g("openTime"),g("endTime")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0}],m=Buffer.alloc(u.span);u.encode({rewardIndex:l,emissionsPerSecondX64:y,openTime:te(p),endTime:te(b)},m);let c=Buffer.from([...Re.setRewardEmissions,...m]);return new Pe({keys:k,programId:e,data:c})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new T(e.programId),new T(e.id)],r,s,l;for(let y=0;y<e.rewardDefaultInfos.length;y++)e.rewardDefaultInfos[y].mint.address===i.mint.toString()&&(r=y,s=new T(t.rewardInfos[y].vault),l=new T(t.rewardInfos[y].mint.address));(r===void 0||s===void 0)&&ci.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let p=Wt(a).publicKey,b=[this.setRewardInstruction(a,n.wallet,o,p,new T(e.config.id),n.tokenAccount,s,l,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:s,operationId:p},signers:[],instructions:b,instructionTypes:[Z.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,a,o,r){let s=R([F("rewardIndex")]),l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:St,isSigner:!1,isWritable:!1}],p=Buffer.alloc(s.span);s.encode({rewardIndex:r},p);let b=Buffer.from([...Re.collectReward,...p]);return new Pe({keys:l,programId:e,data:b})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[a,o]=[new T(e.programId),new T(e.id)],r,s;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===i.toString()&&(r=p,s=new T(t.rewardInfos[p].vault));(r===void 0||s===void 0)&&ci.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=[this.collectRewardInstruction(a,n.wallet,o,n.tokenAccount,s,i,r)];return{address:{rewardVault:s},signers:[],instructions:l,instructionTypes:[Z.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:a,nftMint:o,nft2022:r,getEphemeralSigners:s}){let l=[],p;if(s)p=new T((await s(1))[0]);else{let d=Vt.generate();l.push(d),p=d.publicKey}let b=r?$(a,o,ae).publicKey:$(a,o,J).publicKey,{publicKey:y}=he(n,o),u=ln(e,p).publicKey,k=$(a,p,J).publicKey,m=st(p).publicKey,c=nt.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:a,lockOwner:a,positionNftAccount:b,positionId:y,lockPositionId:u,lockNftMint:p,lockNftAccount:k,metadataAccount:m,withMetadata:!0,nft2022:r,positionNftMint:o,authPositionNftAccount:$(t,o,r?ae:J).publicKey,positionNftProgram:r?ae:J});return{address:{positionId:y,lockPositionId:u,lockNftAccount:k,lockNftMint:p,positionNftAccount:b,metadataAccount:m},instructions:[c],signers:l,instructionTypes:[Z.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:a,positionNftAccount:o,positionId:r,positionNftMint:s,authPositionNftAccount:l,positionNftProgram:p,lockPositionId:b,lockNftMint:y,lockNftAccount:u,metadataAccount:k,withMetadata:m}){let c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:je,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1}],d=R([fe("withMetadata")]),h=Buffer.alloc(d.span);d.encode({withMetadata:m},h);let K=Buffer.from([...li,...h]);return new Pe({keys:c,programId:e,data:K})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:a}){let{publicKey:o}=$(i,a,J),{publicKey:r}=he(n,a),s=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:cn(e,r).publicKey,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Qe.programId,isSigner:!1,isWritable:!1}];return new Pe({keys:s,programId:e,data:Buffer.from(li)})}static harvestLockPositionInstruction(e){let[t,n]=[new T(e.poolKeys.programId),new T(e.poolKeys.id)],i=L.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),a=L.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:o}=Y(t,n,i),{publicKey:r}=Y(t,n,a),{publicKey:s}=$(e.owner,e.ownerPosition.nftMint,J),{publicKey:l}=he(t,e.ownerPosition.nftMint),{publicKey:p}=Xe(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),b=[];for(let k=0;k<e.poolKeys.rewardInfos.length;k++)b.push({poolRewardVault:new T(e.poolKeys.rewardInfos[k].vault),ownerRewardVault:e.ownerRewardAccounts[k],rewardMint:new T(e.poolKeys.rewardInfos[k].mint.address)});let y=[...b.map(k=>[{pubkey:k.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.rewardMint,isSigner:!1,isWritable:!1}]).flat()],u=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:cn(e.programId,l).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:new T(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new T(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:new T(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new T(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...y];return new Pe({keys:u,programId:e.programId,data:Buffer.from(mi)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:a,lockNftMint:o,lockNftAccount:r,positionNftAccount:s,positionId:l,poolId:p,protocolPosition:b,vaultA:y,vaultB:u,tickArrayLower:k,tickArrayUpper:m,userVaultA:c,userVaultB:d,mintA:h,mintB:K,rewardAccounts:M,exTickArrayBitmap:E}){let w=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[],...M.map(N=>[{pubkey:N.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.rewardMint,isSigner:!1,isWritable:!1}]).flat()],C=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:K,isSigner:!1,isWritable:!1},...w];return new Pe({keys:C,programId:e,data:Buffer.from(mi)})}};var Qp=R([le(8),F("bump"),fe("disableCreatePool"),Je("index"),g("tradeFeeRate"),g("protocolFeeRate"),g("fundFeeRate"),g("createPoolFee"),B("protocolOwner"),B("fundOwner"),G(g(),16)]),Qr=R([le(8),B("configId"),B("poolCreator"),B("vaultA"),B("vaultB"),B("mintLp"),B("mintA"),B("mintB"),B("mintProgramA"),B("mintProgramB"),B("observationId"),F("bump"),F("status"),F("lpDecimals"),F("mintDecimalA"),F("mintDecimalB"),g("lpAmount"),g("protocolFeesMintA"),g("protocolFeesMintB"),g("fundFeesMintA"),g("fundFeesMintB"),g("openTime"),G(g(),32)]);import{PublicKey as ud,TransactionInstruction as Hr,Keypair as ld,SystemProgram as md}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as dd,TOKEN_2022_PROGRAM_ID as fd,TOKEN_PROGRAM_ID as bd}from"@solana/spl-token";var jp=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Zp=Buffer.from("amm_config","utf8"),Jp=Buffer.from("pool","utf8"),$p=Buffer.from("pool_lp_mint","utf8"),ed=Buffer.from("pool_vault","utf8"),td=Buffer.from("observation","utf8");var nd=Buffer.from("locked_liquidity","utf8");var Td=ee("Raydium_cpmm"),Yr={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function di(P,e,t,n,i,a,o,r,s,l,p,b,y,u,k,m){let c=R([g("amountIn"),g("amounOutMin")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],h=Buffer.alloc(c.span);return c.encode({amountIn:k,amounOutMin:m},h),new Hr({keys:d,programId:P,data:Buffer.from([...Yr.swapBaseInput,...h])})}import vd from"bn.js";import _d from"decimal.js-light";import jr from"bn.js";var Sd=new jr(0);import fi from"bn.js";var tf=new fi(25),nf=new fi(1e4);var yn=R([F("instruction"),g("amountIn"),g("minAmountOut")]),gn=R([F("instruction"),g("maxAmountIn"),g("amountOut")]),af=R([F("instruction"),F("nonce")]),Zr=R([F("instruction"),F("nonce"),g("startTime")]),bi=R([g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalValue"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),W("swapBaseInAmount"),W("swapQuoteOutAmount"),g("swapBase2QuoteFee"),W("swapQuoteInAmount"),W("swapBaseOutAmount"),g("swapQuote2BaseFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("withdrawQueue"),B("lpVault"),B("owner"),g("lpReserve"),G(g(),3,"padding")]),uf=R([g("accountType"),g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalsValue"),g("abortTradeFactor"),g("priceTickMultiplier"),g("priceTick"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),W("swapBaseInAmount"),W("swapQuoteOutAmount"),W("swapQuoteInAmount"),W("swapBaseOutAmount"),g("swapQuote2BaseFee"),g("swapBase2QuoteFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("modelDataAccount"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("owner"),G(g(),64,"padding")]),Jr=R([F("instruction"),g("baseAmountIn"),g("quoteAmountIn"),g("fixedSide"),g("otherAmountMin")]),$r=R([F("instruction"),g("lpAmount"),g("baseAmountMin"),g("quoteAmountMin")]);var cf=R([g("fee")]);import{PublicKey as _b}from"@solana/web3.js";import qb from"bn.js";import Ub from"decimal.js";import{TOKEN_PROGRAM_ID as zb}from"@solana/spl-token";import{PublicKey as pf,SystemProgram as df,SYSVAR_RENT_PUBKEY as ff,TransactionInstruction as gi}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as yf,TOKEN_PROGRAM_ID as Pi}from"@solana/spl-token";var yi=ee("Raydium_liquidity_instruction");function eo({poolKeys:P,userKeys:e,amountIn:t,minAmountOut:n,modelDataPubKey:i=ft},a){let o=Be(P),r=Buffer.alloc(yn.span);yn.encode({instruction:9,amountIn:te(t),minAmountOut:te(n)},r);let s=[f({pubkey:Pi,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders})];return a===4&&s.push(f({pubkey:o.targetOrders})),s.push(f({pubkey:o.vault.A}),f({pubkey:o.vault.B})),a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new gi({programId:o.programId,keys:s,data:r})}function to({poolKeys:P,userKeys:e,maxAmountIn:t,amountOut:n,modelDataPubKey:i=ft},a){let o=Be(P),r=Buffer.alloc(gn.span);gn.encode({instruction:11,maxAmountIn:te(t),amountOut:te(n)},r);let s=[f({pubkey:Pi,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders}),f({pubkey:o.targetOrders}),f({pubkey:o.vault.A}),f({pubkey:o.vault.B})];return a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new gi({programId:o.programId,keys:s,data:r})}function ki(P){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:a,fixedSide:o}=P;if(t===4||t===5){let r={poolKeys:e,userKeys:n};if(o==="in")return eo(j(Q({},r),{amountIn:i,minAmountOut:a}),t);if(o==="out")return to(j(Q({},r),{maxAmountIn:i,amountOut:a}),t);yi.logWithError("invalid params","params",P)}throw yi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as Sf}from"@solana/web3.js";var Rf=ee("Raydium_liquidity_serum");var no=5e4,io=R([g("x"),g("y"),g("price")]),Of=R([g("accountType"),g("status"),g("multiplier"),g("validDataCount"),G(io,no,"DataElement")]);var Pn=R([B("mint"),B("owner"),g("amount"),xe("delegateOption"),B("delegate"),F("state"),xe("isNativeOption"),g("isNative"),g("delegatedAmount"),xe("closeAuthorityOption"),B("closeAuthority")]);import{Keypair as Df,PublicKey as qf}from"@solana/web3.js";import Xf from"bn.js";import{TOKEN_PROGRAM_ID as Hf}from"@solana/spl-token";var jf=ee("Raydium_Util");import{PublicKey as nb,SystemProgram as rb}from"@solana/web3.js";import ab from"bn.js";import{createCloseAccountInstruction as mb,createInitializeAccountInstruction as pb,createTransferInstruction as db,TOKEN_PROGRAM_ID as fb}from"@solana/spl-token";var ro=R([xe("mintAuthorityOption"),B("mintAuthority"),g("supply"),F("decimals"),F("isInitialized"),xe("freezeAuthorityOption"),B("freezeAuthority")]);var oo={[Jt.toBase58()]:3};var so=R([le(5),le(8),B("ownAddress"),g("vaultSignerNonce"),B("baseMint"),B("quoteMint"),B("baseVault"),g("baseDepositsTotal"),g("baseFeesAccrued"),B("quoteVault"),g("quoteDepositsTotal"),g("quoteFeesAccrued"),g("quoteDustThreshold"),B("requestQueue"),B("eventQueue"),B("bids"),B("asks"),g("baseLotSize"),g("quoteLotSize"),g("feeRateBps"),g("referrerRebatesAccrued"),le(7)]);import{PublicKey as gy}from"@solana/web3.js";var wy=ee("Serum");import{PublicKey as A,SystemProgram as wt,TransactionInstruction as ht}from"@solana/web3.js";import Ve from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as kn,TOKEN_2022_PROGRAM_ID as An,TOKEN_PROGRAM_ID as Ze}from"@solana/spl-token";function Wy(P,e,t,n,i,a,o,r,s,l,p,b){let y=R([F("instruction"),g("amountIn"),g("amountOut")]),u=[{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1},{pubkey:new A(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A(t.id),isSigner:!1,isWritable:!0},{pubkey:new A(n.id),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let m=Be(t);u.push({pubkey:m.config.id,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.A:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.B:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},...b.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let m=Be(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0})}else{let m=Be(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},...m.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:m.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:m.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0}])}let k=Buffer.alloc(y.span);return y.encode({instruction:4,amountIn:l,amountOut:p},k),new ht({keys:u,programId:P,data:k})}function vy(P,e,t,n,i,a,o,r,s,l){let p=R([F("instruction")]),b=[{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1},{pubkey:new A(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let u=Be(n);b.push({pubkey:u.config.id,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.A:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.B:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},...l.map(k=>({pubkey:k,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let u=Be(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0})}else{let u=Be(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},...u.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:u.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:u.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(p.span);return p.encode({instruction:5},y),new ht({keys:b,programId:P,data:y})}function ao(P,e,t,n,i,a,o,r,s,l,p,b,y,u,k){var w;let m=[],c=[f({pubkey:Ze,isWritable:!1}),f({pubkey:An,isWritable:!1}),f({pubkey:kn,isWritable:!1}),f({pubkey:wt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})];c.push(f({pubkey:t})),c.push(f({pubkey:i}));let d=[s,l],h=[p,b],K=[a,o,r];for(let C=0;C<d.length;C++){let N=d[C],_=K[C]===N.mintA.address;if(c.push(f({pubkey:new A(N.programId),isWritable:!1})),C===d.length-1?c.push(f({pubkey:i})):c.push(f({pubkey:n})),c.push(f({pubkey:new A(K[C])})),c.push(f({pubkey:new A(K[C+1])})),N.version===6){let I=h[C];c.push(f({pubkey:new A(I.config.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(_?I.vault.A:I.vault.B)})),c.push(f({pubkey:new A(_?I.vault.B:I.vault.A)})),c.push(f({pubkey:new A(N.observationId)})),c.push(f({pubkey:Ye})),c.push(f({pubkey:me(new A(N.programId),new A(N.id)).publicKey})),m.push(Tn(N.sqrtPriceX64.toString(),_));for(let V of(w=k[C])!=null?w:[])c.push(f({pubkey:new A(V)}))}else if(N.version===5){let I=h[C];c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.authority),isWritable:!1})),c.push(f({pubkey:new A(I.marketProgramId)})),c.push(f({pubkey:new A(I.marketAuthority)})),c.push(f({pubkey:Ct,isWritable:!1})),c.push(f({pubkey:new A(I.openOrders)})),c.push(f({pubkey:new A(I.vault.A)})),c.push(f({pubkey:new A(I.vault.B)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.marketId)})),c.push(f({pubkey:new A(I.marketBids)})),c.push(f({pubkey:new A(I.marketAsks)})),c.push(f({pubkey:new A(I.marketEventQueue)})),c.push(f({pubkey:new A(I.marketBaseVault)})),c.push(f({pubkey:new A(I.marketQuoteVault)}))}else if(N.version===4){let I=h[C],V=N.status!==1;c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.authority),isWritable:!1})),c.push(f({pubkey:new A(V?I.id:I.marketProgramId)})),c.push(f({pubkey:new A(V?I.id:I.marketAuthority)})),c.push(f({pubkey:new A(V?I.id:I.openOrders)})),c.push(f({pubkey:new A(I.vault.A)})),c.push(f({pubkey:new A(I.vault.B)})),c.push(f({pubkey:new A(V?I.id:I.marketId)})),c.push(f({pubkey:new A(V?I.id:I.marketBids)})),c.push(f({pubkey:new A(V?I.id:I.marketAsks)})),c.push(f({pubkey:new A(V?I.id:I.marketEventQueue)})),c.push(f({pubkey:new A(V?I.id:I.marketBaseVault)})),c.push(f({pubkey:new A(V?I.id:I.marketQuoteVault)}))}else if(N.version===7){let I=h[C];c.push(f({pubkey:new A(I.authority)})),c.push(f({pubkey:new A(I.config.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(_?I.vault.A:I.vault.B)})),c.push(f({pubkey:new A(_?I.vault.B:I.vault.A)})),c.push(f({pubkey:new A(N.observationId)}))}else throw Error("pool type error")}let M=R([F("insId"),g("amountIn"),g("amountOut"),G(W(),m.length,"clmmPriceLimit")]),E=Buffer.alloc(M.span);return M.encode({insId:0,amountIn:y,amountOut:u,clmmPriceLimit:m},E),new ht({keys:c,programId:P,data:E})}function Tn(P,e){if(P)if(e){let t=new Ve(P).div(new Ve(25));return t.gt(Mt)?t:Mt}else{let t=new Ve(P).mul(new Ve(25));return t.lt(Ot)?t:Ot}else return e?Mt:Ot}function uo({routeProgram:P,ownerInfo:e,inputMint:t,swapInfo:n}){var i,a,o,r,s,l,p;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let b=n.poolKey[0],y=Be(b),u=t.equals(y.mintA.address)?Ee.add(Se):Fe.sub(Se);return nt.makeSwapBaseInInstructions({poolInfo:b,poolKeys:b,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:y.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:y.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((a=(i=n.minAmountOut.fee)==null?void 0:i.raw)!=null?a:new Ve(0)),sqrtPriceLimitX64:u,remainingAccounts:(o=n.remainingAccounts[0])!=null?o:[]})}else if(n.poolInfo[0].version===7){let b=n.poolInfo[0],y=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[di(b.programId,e.wallet,b.authority,b.configId,b.id,e.sourceToken,e.destinationToken,y?b.vaultA:b.vaultB,y?b.vaultB:b.vaultA,y?b.mintProgramA:b.mintProgramB,y?b.mintProgramB:b.mintProgramA,new A(b[y?"mintA":"mintB"].address),new A(b[y?"mintB":"mintA"].address),b.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[y?Z.CpmmSwapBaseIn:Z.CpmmSwapBaseOut],address:{}}}else{let b=n.poolKey[0];return{signers:[],instructions:[ki({poolKeys:b,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((s=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?s:new Ve(0)),fixedSide:"in"})],lookupTableAddress:b.lookupTableAccount?[b.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?Z.AmmV5SwapBaseIn:Z.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let b=n.poolInfo[0],y=n.poolInfo[1],u=n.poolKey[0],k=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[ao(P,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),b,y,u,k,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((p=(l=n.minAmountOut.fee)==null?void 0:l.raw)!=null?p:new Ve(0)),n.remainingAccounts)],instructionTypes:[Z.RouteSwap],lookupTableAddress:[u.lookupTableAccount,k.lookupTableAccount].filter(m=>m!==void 0),address:{}}}else throw Error("route type error")}function Vy({programId:P,wallet:e,amount:t,inputAccount:n,outputAccount:i,routeInfo:a,poolKeys:o}){var y;if(a.success===!1)throw Error("route info error");let r=[],s=[f({pubkey:Ze,isWritable:!1}),f({pubkey:An,isWritable:!1}),f({pubkey:kn,isWritable:!1}),f({pubkey:wt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],l={[a.data.inputMint]:n,[a.data.outputMint]:i};s.push(f({pubkey:l[a.data.inputMint]})),s.push(f({pubkey:l[a.data.outputMint]}));for(let u=0;u<o.length;u++){let k=a.data.routePlan[u],m=o[u],c=k.inputMint===m.mintA.address;if(s.push(f({pubkey:new A(m.programId),isWritable:!1})),u===o.length-1)s.push(f({pubkey:l[k.outputMint]}));else{let d=k.outputMint;if(l[d]===void 0){let h=$(e,new A(d),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()||m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(c?m.mintB.programId:m.mintA.programId):Ze).publicKey;l[d]=h}s.push(f({pubkey:l[d]}))}if(s.push(f({pubkey:new A(k.inputMint)})),s.push(f({pubkey:new A(k.outputMint)})),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let d=m;s.push(f({pubkey:new A(d.config.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A(d.observationId)})),s.push(f({pubkey:Ye,isWritable:!1})),s.push(f({pubkey:new A(d.exBitmapAccount)})),r.push(Tn(k.lastPoolPriceX64,c));for(let h of(y=k.remainingAccounts)!=null?y:[])s.push(f({pubkey:new A(h)}))}else if(m.programId===Ae.AMM_STABLE.toBase58()){let d=m;s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.authority),isWritable:!1})),s.push(f({pubkey:new A(d.marketProgramId),isWritable:!1})),s.push(f({pubkey:new A(d.marketAuthority),isWritable:!1})),s.push(f({pubkey:Ct,isWritable:!1})),s.push(f({pubkey:new A(d.openOrders)})),s.push(f({pubkey:new A(d.vault.A)})),s.push(f({pubkey:new A(d.vault.B)})),s.push(f({pubkey:new A(d.marketId)})),s.push(f({pubkey:new A(d.marketBids)})),s.push(f({pubkey:new A(d.marketAsks)})),s.push(f({pubkey:new A(d.marketEventQueue)})),s.push(f({pubkey:new A(d.marketBaseVault)})),s.push(f({pubkey:new A(d.marketQuoteVault)}))}else if(m.programId===Ae.AMM_V4.toBase58()){let d=m;s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.authority),isWritable:!1})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.vault.A)})),s.push(f({pubkey:new A(d.vault.B)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)}))}else if(m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let d=m;s.push(f({pubkey:new A(d.authority)})),s.push(f({pubkey:new A(d.config.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A(d.observationId)}))}else throw Error("pool type error")}let p=R([F("insId"),g("amountIn"),g("amountOut"),G(W(),r.length,"clmmPriceLimit")]),b=Buffer.alloc(p.span);return p.encode({insId:0,amountIn:t,amountOut:new Ve(a.data.otherAmountThreshold),clmmPriceLimit:r},b),new ht({keys:s,programId:P,data:b})}function _y({programId:P,wallet:e,inputAccount:t,outputAccount:n,routeInfo:i,poolKeys:a}){var b;if(i.success===!1)throw Error("route info error");let o=[],r=[f({pubkey:Ze,isWritable:!1}),f({pubkey:An,isWritable:!1}),f({pubkey:kn,isWritable:!1}),f({pubkey:wt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],s={[i.data.inputMint]:t,[i.data.outputMint]:n};for(let y=a.length-1;y>=0;y--){let u=i.data.routePlan[y],k=a[y],m=u.inputMint===k.mintA.address;if(r.push(f({pubkey:new A(k.programId)})),y===0)r.push(f({pubkey:s[u.inputMint]}));else{let c=u.inputMint;if(s[c]===void 0){let d=$(e,new A(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(m?k.mintA.programId:k.mintB.programId):Ze).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(y===a.length-1)r.push(f({pubkey:s[u.outputMint]}));else{let c=u.outputMint;if(s[c]===void 0){let d=$(e,new A(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(m?k.mintB.programId:k.mintA.programId):Ze).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(r.push(f({pubkey:new A(u.inputMint)})),r.push(f({pubkey:new A(u.outputMint)})),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let c=k;r.push(f({pubkey:new A(c.config.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A(c.observationId)})),r.push(f({pubkey:Ye,isWritable:!1})),r.push(f({pubkey:new A(c.exBitmapAccount)})),o.push(Tn(u.lastPoolPriceX64,m));for(let d of(b=u.remainingAccounts)!=null?b:[])r.push(f({pubkey:new A(d)}))}else if(k.programId===Ae.AMM_STABLE.toBase58()){let c=k;r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.authority),isWritable:!1})),r.push(f({pubkey:new A(c.marketProgramId),isWritable:!1})),r.push(f({pubkey:new A(c.marketAuthority),isWritable:!1})),r.push(f({pubkey:Ct,isWritable:!1})),r.push(f({pubkey:new A(c.openOrders)})),r.push(f({pubkey:new A(c.vault.A)})),r.push(f({pubkey:new A(c.vault.B)})),r.push(f({pubkey:new A(c.marketId)})),r.push(f({pubkey:new A(c.marketBids)})),r.push(f({pubkey:new A(c.marketAsks)})),r.push(f({pubkey:new A(c.marketEventQueue)})),r.push(f({pubkey:new A(c.marketBaseVault)})),r.push(f({pubkey:new A(c.marketQuoteVault)}))}else if(k.programId===Ae.AMM_V4.toBase58()){let c=k;r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.authority),isWritable:!1})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.vault.A)})),r.push(f({pubkey:new A(c.vault.B)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)}))}else if(k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let c=k;r.push(f({pubkey:new A(c.authority)})),r.push(f({pubkey:new A(c.config.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A(c.observationId)}))}else throw Error("pool type error")}let l=R([F("insId"),g("amountIn"),g("amountOut"),G(W(),o.length,"clmmPriceLimit")]),p=Buffer.alloc(l.span);return l.encode({insId:1,amountIn:new Ve(i.data.otherAmountThreshold),amountOut:new Ve(i.data.outputAmount),clmmPriceLimit:o},p),new ht({keys:r,programId:P,data:p})}var Bg=new co(0);export{uo as makeSwapInstruction,Wy as route1Instruction,vy as route2Instruction,ao as routeInstruction,Vy as swapBaseInAutoAccount,_y as swapBaseOutAutoAccount};
//# sourceMappingURL=index.mjs.map