var Pi=Object.defineProperty,ki=Object.defineProperties;var Ai=Object.getOwnPropertyDescriptors;var In=Object.getOwnPropertySymbols;var Ti=Object.prototype.hasOwnProperty,wi=Object.prototype.propertyIsEnumerable;var Bn=(P,e,t)=>e in P?Pi(P,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):P[e]=t,Y=(P,e)=>{for(var t in e||(e={}))Ti.call(e,t)&&Bn(P,t,e[t]);if(In)for(var t of In(e))wi.call(e,t)&&Bn(P,t,e[t]);return P},j=(P,e)=>ki(P,Ai(e));import{PublicKey as eg}from"@solana/web3.js";import{createTransferInstruction as ng,TOKEN_PROGRAM_ID as ig,TOKEN_2022_PROGRAM_ID as rg}from"@solana/spl-token";import so from"bn.js";import ag from"decimal.js";import{PublicKey as Bi}from"@solana/web3.js";import{get as xn,set as hi}from"lodash";var Vt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Sn={},Ii={};function ee(P){let e=xn(Sn,P);if(!e){let t=xn(Ii,P);e=new Vt({name:P,logLevel:t}),hi(Sn,P,e)}return e}import{MINT_SIZE as Po,TOKEN_PROGRAM_ID as ko,getTransferFeeConfig as Ao,unpackMint as To}from"@solana/spl-token";var vt=ee("Raydium_accountInfo_util");async function He(P,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:a=100}=Y({batchRequest:!1},t),o=Dt(e,a),r=new Array(o.length).fill([]);if(n){let s=o.map(b=>{let g=P._buildArgs([b.map(u=>u.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:g}}),l=Dt(s,10);r=(await(await Promise.all(l.map(async b=>await P._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&vt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(g=>{if(g){let{data:u,executable:k,lamports:m,owner:c,rentEpoch:d}=g;return u.length!==2&&u[1]!=="base64"&&vt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(u[0],"base64"),executable:k,lamports:m,owner:new Bi(c),rentEpoch:d}}return null})))}else try{r=await Promise.all(o.map(s=>P.getMultipleAccountsInfo(s,i)))}catch(s){s instanceof Error&&vt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${s.message}`)}return r.flat()}async function ut(P,e,t){let n=await He(P,e.map(i=>i.pubkey),t);return e.map((i,a)=>j(Y({},i),{accountInfo:n[a]}))}import qe from"bn.js";import Ys from"decimal.js";import Mi from"big.js";import xt from"bn.js";import xi from"toformat";var Si=xi,lt=Si;import Bt from"big.js";import Ci from"bn.js";import Ri from"decimal.js-light";import mt from"bn.js";var Kn=9007199254740991;function te(P){let e=ee("Raydium_parseBigNumberish");if(P instanceof mt)return P;if(typeof P=="string"){if(P.match(/^-?[0-9]+$/))return new mt(P);e.logWithError(`invalid BigNumberish string: ${P}`)}return typeof P=="number"?(P%1&&e.logWithError(`BigNumberish number underflow: ${P}`),(P>=Kn||P<=-Kn)&&e.logWithError(`BigNumberish number overflow: ${P}`),new mt(String(P))):typeof P=="bigint"?new mt(P.toString()):(e.error(`invalid BigNumberish value: ${P}`),new mt(0))}var It=ee("module/fraction"),qt=lt(Bt),pt=lt(Ri),Li={[0]:pt.ROUND_DOWN,[1]:pt.ROUND_HALF_UP,[2]:pt.ROUND_UP},Ni={[0]:Bt.roundDown,[1]:Bt.roundHalfUp,[2]:Bt.roundUp},H=class{constructor(e,t=new Ci(1)){this.numerator=te(e),this.denominator=te(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(te(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(te(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(te(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(te(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||It.logWithError(`${e} is not an integer.`),e<=0&&It.logWithError(`${e} is not positive.`),pt.set({precision:e+1,rounding:Li[n]});let i=new pt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||It.logWithError(`${e} is not an integer.`),e<0&&It.logWithError(`${e} is negative.`),qt.DP=e,qt.RM=Ni[n]||1,new qt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Oi=ee("Raydium_amount"),Cn=lt(Mi);function Wi(P,e){let t="0",n="0";if(P.includes(".")){let i=P.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Oi.logWithError(`invalid number string, num: ${P}`)}else t=P;return[t,n.slice(0,e)||n]}var pe=class extends H{constructor(t,n,i=!0,a){let o=new xt(0),r=Gt.pow(new xt(t.decimals));if(i)o=te(n);else{let s=new xt(0),l=new xt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[p,b]=Wi(n.toString(),t.decimals);s=te(p),l=te(b)}s=s.mul(r),o=s.add(l)}super(o,r);this.logger=ee(a||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Cn.DP=this.token.decimals,new Cn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ei}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Rn}from"@solana/spl-token";var Ut={chainId:101,address:Ei.default.toBase58(),programId:Rn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ve={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Rn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Yt}from"@solana/web3.js";import{PublicKey as re,SystemProgram as Ln,SYSVAR_RENT_PUBKEY as Fi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _i}from"@solana/spl-token";function f({pubkey:P,isSigner:e=!1,isWritable:t=!0}){return{pubkey:P,isWritable:t,isSigner:e}}var $o=[f({pubkey:_i,isWritable:!1}),f({pubkey:Ln.programId,isWritable:!1}),f({pubkey:Fi,isWritable:!1})];function Xt({publicKey:P,transformSol:e}){let t=zt(P.toString());if(t instanceof re)return e&&t.equals(dt)?ct:t;if(e&&t.toString()===dt.toBase58())return ct;if(typeof t=="string"){if(t===re.default.toBase58())return re.default;try{return new re(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function zt(P){try{return new re(P)}catch{return P}}var St=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Qe=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Oe=new re("SysvarRent111111111111111111111111111111111"),es=new re("SysvarC1ock11111111111111111111111111111111"),je=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ts=new re("Sysvar1nstructions1111111111111111111111111"),Vi=Ln.programId,ns=new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),is=new re("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),rs=new re("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),os=new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ss=new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),as=new re("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),us=new re("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),cs=new re("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ls=new re("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ms=new re("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ps=new re("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ct=new re("So11111111111111111111111111111111111111112"),dt=re.default;function rt(P){return Xt({publicKey:P,transformSol:!0})}var Ht=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:a=!1,isToken2022:o=!1}){if(e===dt.toBase58()||e instanceof Yt&&dt.equals(e)){this.decimals=ve.decimals,this.symbol=ve.symbol,this.name=ve.name,this.mint=new Yt(ve.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=a?Yt.default:Xt({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ne=Ht;Ne.WSOL=new Ht(j(Y({},ve),{mint:ve.address}));var Qt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Kt=Qt;Kt.SOL=new Qt(Ut);import vi from"bn.js";var Nn=new H(new vi(100)),De=class extends H{toSignificant(e=5,t,n){return this.mul(Nn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Nn).toFixed(e,t,n)}};var Di=ee("Raydium_price"),Ie=class extends H{constructor(t){let{baseToken:n,quoteToken:i,numerator:a,denominator:o}=t;super(a,o);this.baseToken=n,this.quoteToken=i,this.scalar=new H(jt(n.decimals),jt(i.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ie({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Di.logWithError("mul token not equals");let n=super.mul(t);return new Ie({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var Mn=new qe(0),qi=new qe(1),na=new qe(2),ia=new qe(3),ra=new qe(5),Gt=new qe(10),oa=new qe(100),sa=new qe(1e3),aa=new qe(1e4);function jt(P){return Gt.pow(te(P))}function Dt(P,e=1,t=[]){let n=[...P];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ui}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Xi}from"@solana/spl-token";import{ComputeBudgetProgram as ba,Keypair as Pa,PublicKey as Gi,Transaction as Aa,TransactionMessage as wa,VersionedTransaction as ha}from"@solana/web3.js";var Z={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Sa}from"@solana/spl-token";var Ka=ee("Raydium_txUtil");function ge(P,e){let[t,n]=Gi.findProgramAddressSync(P,e);return{publicKey:t,nonce:n}}function $(P,e,t){return ge([P.toBuffer(),(t!=null?t:Xi).toBuffer(),e.toBuffer()],new Ui("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var zi=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Yi=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Hi=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Qi=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ji=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Zi=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Zt=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),On=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ji=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ct=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Jt=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Wn=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),En=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ft=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),$i=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),er=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Wa=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ea=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Fa=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),_a=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),$t=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Fn=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),tr=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),nr=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ir=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),rr=new O("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),or=new O("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Va=new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),va=new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),sr=new O("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),ar=new O("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ae={AMM_V4:On,AMM_STABLE:Ji,CLMM_PROGRAM_ID:Jt,CLMM_LOCK_PROGRAM_ID:Wn,CLMM_LOCK_AUTH_ID:En,FARM_PROGRAM_ID_V3:zi,FARM_PROGRAM_ID_V4:Yi,FARM_PROGRAM_ID_V5:Hi,FARM_PROGRAM_ID_V6:Qi,OPEN_BOOK_PROGRAM:Zi,SERUM_PROGRAM_ID_V3:Zt,UTIL1216:ji,Router:$i,CREATE_CPMM_POOL_PROGRAM:$t,CREATE_CPMM_POOL_AUTH:Fn,CREATE_CPMM_POOL_FEE_ACC:tr,LOCK_CPMM_PROGRAM:nr,LOCK_CPMM_AUTH:ir,LAUNCHPAD_PROGRAM:rr,LAUNCHPAD_AUTH:or,LAUNCHPAD_PLATFORM:sr,LAUNCHPAD_CONFIG:ar,FEE_DESTINATION_ID:er,MODEL_DATA_PUBKEY:ft},Da={OPEN_BOOK_PROGRAM:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O("Ray1111111111111111111111111111111111111111"),AMM_V4:new O("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.default,Router:new O("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O("Ray1111111111111111111111111111111111111111")};import Me from"bn.js";var bt=1e4;function ue(P,e,t,n){if(e===void 0)return{amount:P,fee:void 0,expirationTime:void 0};let i=j(Y({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),a=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,o=new Me(a.maximumFee.toString()),r=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(a.transferFeeBasisPoints===bt){let s=new Me(a.maximumFee.toString());return{amount:P.add(s),fee:s,expirationTime:r}}else{let s=en(P.mul(new Me(bt)),new Me(bt-a.transferFeeBasisPoints)),l=new Me(a.maximumFee.toString()),p=s.sub(P).gt(l)?P.add(l):s,b=en(p.mul(new Me(a.transferFeeBasisPoints)),new Me(bt)),g=b.gt(o)?o:b;return{amount:p,fee:g,expirationTime:r}}else{let s=en(P.mul(new Me(a.transferFeeBasisPoints)),new Me(bt)),l=s.gt(o)?o:s;return{amount:P,fee:l,expirationTime:r}}}function Ge(P,e){return P===void 0?e:e===void 0?P:Math.min(P,e)}function en(P,e){let{div:t,mod:n}=P.divmod(e);return n.gt(new Me(0))?t.add(new Me(1)):t}import{PublicKey as Ya,AddressLookupTableAccount as Ha}from"@solana/web3.js";import{PublicKey as lu,sendAndConfirmTransaction as mu,SystemProgram as fu,Transaction as bu,TransactionMessage as gu,VersionedTransaction as Pu}from"@solana/web3.js";import Au from"axios";import{PublicKey as cr}from"@solana/web3.js";import lr from"bn.js";function mr(P){return typeof P=="object"&&P!==null&&![Ne,pe,cr,H,lr,Ie,De].some(e=>typeof e=="object"&&P instanceof e)}function Be(P){return typeof P=="string"?zt(P):Array.isArray(P)?P.map(e=>Be(e)):mr(P)?Object.fromEntries(Object.entries(P).map(([e,t])=>[e,Be(t)])):P}import pr from"bn.js";var dr=new pr(1e6);import{PublicKey as wr}from"@solana/web3.js";import qn,{isBN as Gn}from"bn.js";import{bits as ec,BitStructure as tc,blob as fr,Blob as nc,cstr as ic,f32 as rc,f32be as oc,f64 as sc,f64be as ac,greedy as uc,Layout as br,ns64 as cc,ns64be as lc,nu64 as mc,nu64be as pc,offset as dc,s16 as fc,s16be as bc,s24 as yc,s24be as gc,s32 as yr,s32be as Pc,s40 as kc,s40be as Ac,s48 as Tc,s48be as wc,s8 as hc,seq as gr,struct as Ic,Structure as Pr,u16 as kr,u16be as Bc,u24 as xc,u24be as Sc,u32 as Kc,u32be as Cc,u40 as Rc,u40be as Lc,u48 as Nc,u48be as Mc,u8 as Ar,UInt as Tr,union as Oc,Union as Wc,unionLayoutDiscriminator as Ec,utf8 as Fc}from"@solana/buffer-layout";var tn=br,Vn=Pr;var nn=Tr;var vn=Ar,Je=kr;var ne=yr;var Dn=gr;var le=fr;var ot=class extends tn{constructor(t,n,i){super(t,i);this.blob=le(t),this.signed=n}decode(t,n=0){let i=new qn(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new qn(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function W(P){return new nn(1,P)}function xe(P){return new nn(4,P)}function y(P){return new ot(8,!1,P)}function F(P){return new ot(16,!1,P)}function Un(P){return new ot(8,!0,P)}function Xn(P){return new ot(16,!0,P)}var Rt=class extends tn{constructor(t,n,i,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function B(P){return new Rt(le(32),e=>new wr(e),e=>e.toBuffer(),P)}function de(P){return new Rt(vn(),hr,Ir,P)}function hr(P){if(P===0)return!1;if(P===1)return!0;throw new Error("Invalid bool: "+P)}function Ir(P){return P?1:0}var rn=class extends Vn{decode(e,t){return super.decode(e,t)}};function R(P,e,t){return new rn(P,e,t)}function G(P,e,t){let n,i=typeof e=="number"?e:Gn(e)?e.toNumber():new Proxy(e,{get(a,o){if(!n){let r=Reflect.get(a,"count");n=Gn(r)?r.toNumber():r,Reflect.set(a,"count",n)}return Reflect.get(a,o)},set(a,o,r){return o==="count"&&(n=r),Reflect.set(a,o,r)}});return Dn(P,i,t)}import{PublicKey as tp}from"@solana/web3.js";import ip from"bn.js";import op from"decimal.js";import{AccountLayout as up,createAssociatedTokenAccountIdempotentInstruction as cp,TOKEN_2022_PROGRAM_ID as lp,TOKEN_PROGRAM_ID as mp}from"@solana/spl-token";import{PublicKey as Jc}from"@solana/web3.js";import{MintLayout as el,TOKEN_PROGRAM_ID as nl}from"@solana/spl-token";import{Keypair as _t,PublicKey as T,SystemProgram as Ye,TransactionInstruction as Pe}from"@solana/web3.js";import bn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Tt,TOKEN_2022_PROGRAM_ID as ae,TOKEN_PROGRAM_ID as J}from"@solana/spl-token";import Or from"bn.js";import at from"decimal.js";import Le from"bn.js";var oe=new Le(0),Se=new Le(1),Ue=new Le(-1),Ke=new Le(1).shln(64),Lt=new Le(1).shln(128),on=Ke.sub(Se),yt=64,zn=Lt.subn(1),ke=-443636,Te=-ke,We=new Le("4295048016"),Ee=new Le("79226673521066979257578248091"),Nt=new Le("4295048017"),Mt=new Le("79226673521066979257578248090"),Yn=16,Hn="59543866431248",Qn="184467440737095516",jn="15793534762490258745",Ot=new Le(10).pow(new Le(6));var yl=new Le("18446744073700000000");import q from"bn.js";import _e from"decimal.js";function Wt(P){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,P,!1),new Uint8Array(e)}function sn(P,e){let t=0;for(let n=P-1;n>=0&&!e.testn(n);n--)t++;return t}function an(P,e){let t=0;for(let n=0;n<P&&!e.testn(n);n++)t++;return t}function gt(P,e){for(let t=0;t<P;t++)if(e.testn(t))return!1;return!0}function Zn(P,e){return gt(P,e)?null:sn(P,e)}function Jn(P,e){return gt(P,e)?null:an(P,e)}var wl=Buffer.from("amm_config","utf8"),Br=Buffer.from("pool","utf8"),xr=Buffer.from("pool_vault","utf8"),Sr=Buffer.from("pool_reward_vault","utf8"),$n=Buffer.from("position","utf8"),Kr=Buffer.from("tick_array","utf8"),Cr=Buffer.from("operation","utf8"),Rr=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Lr=Buffer.from("observation","utf8");function ei(P,e,t,n){return ge([Br,e.toBuffer(),t.toBuffer(),n.toBuffer()],P)}function un(P,e,t){return ge([xr,e.toBuffer(),t.toBuffer()],P)}function ti(P,e,t){return ge([Sr,e.toBuffer(),t.toBuffer()],P)}function Q(P,e,t){return ge([Kr,e.toBuffer(),Wt(t)],P)}function Xe(P,e,t,n){return ge([$n,e.toBuffer(),Wt(t),Wt(n)],P)}function he(P,e){return ge([$n,e.toBuffer()],P)}function st(P){return ge([Buffer.from("metadata","utf8"),je.toBuffer(),P.toBuffer()],je)}function Et(P){return ge([Cr],P)}function me(P,e){return ge([Rr,e.toBuffer()],P)}function ni(P,e){return ge([Lr,e.toBuffer()],P)}var ii=Buffer.from("locked_position","utf8");function cn(P,e){return ge([ii,e.toBuffer()],P)}function ln(P,e){return ge([ii,e.toBuffer()],P)}var hl=Buffer.from("support_mint","utf8");import{PublicKey as Ce}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as ri}from"@solana/spl-token";import ie from"bn.js";import X from"decimal.js";import Fe from"bn.js";import mn from"decimal.js";var Pt=class{static getfeeGrowthInside(e,t,n){let i=new Fe(0),a=new Fe(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,a=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new Fe(0),r=new Fe(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,r=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),r=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let s=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64A,i),o),l=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64B,a),r);return{feeGrowthInsideX64A:s,feeGrowthInsideBX64:l}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=D.mulDivFloor(D.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Ke),s=t.tokenFeesOwedA.add(r),l=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Ke),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=D.mulDivFloor(D.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,Ke),s=t.tokenFeesOwedA.add(r),l=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,Ke),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionRewardsV2(e,t,n,i){let a=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=D.wrappingSubU128(s,l.growthInsideLastX64),b=D.mulDivFloor(p,t.liquidity,Ke),g=l.rewardAmountOwed.add(b);a.push(g)}return a}static GetPositionRewards(e,t,n,i){let a=[],o=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=D.wrappingSubU128(s,l.growthInsideLastX64),b=D.mulDivFloor(p,t.liquidity,Ke),g=l.rewardAmountOwed.add(b);a.push(g)}return a}static getRewardGrowthInside(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Fe(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Fe(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(D.wrappingSubU128(D.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getRewardGrowthInsideV2(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Fe(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Fe(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(D.wrappingSubU128(D.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:a,epochInfo:o}){var c,d,h,K;let r=_.priceToSqrtPriceX64(new mn(e.price),e.mintA.decimals,e.mintB.decimals),s=_.getSqrtPriceX64FromTick(t.tickLower),l=_.getSqrtPriceX64FromTick(t.tickUpper),p=a?1+i:1-i,b=z.getAmountsFromLiquidity(r,s,l,n,a),[g,u]=[ue(b.amountA,(c=e.mintA.extensions)==null?void 0:c.feeConfig,o,!0),ue(b.amountB,(d=e.mintB.extensions)==null?void 0:d.feeConfig,o,!0)],[k,m]=[ue(new Fe(new mn(b.amountA.toString()).mul(p).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,o,!0),ue(new Fe(new mn(b.amountB.toString()).mul(p).toFixed(0)),(K=e.mintB.extensions)==null?void 0:K.feeConfig,o,!0)];return{liquidity:n,amountA:g,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:Ge(g.expirationTime,u.expirationTime)}}};var Nr=15,U=class{static async getTickArrays(e,t,n,i,a,o,r){let s=[],l=L.getTickArrayStartIndexByTick(i,a),p=L.getInitializedTickArrayInRange(o,r,a,l,Math.floor(Nr/2));for(let u=0;u<p.length;u++){let{publicKey:k}=Q(t,n,p[u]);s.push(k)}let b=(await He(e,s)).map(u=>u!==null?kt.decode(u.data):null),g={};for(let u=0;u<s.length;u++){let k=b[u];k!==null&&(g[k.startTickIndex]=j(Y({},k),{address:s[u]}))}return g}static nextInitializedTick(e,t,n,i,a,o){let{initializedTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}=this.nextInitializedTickInOneArray(e,t,n,i,a,o);for(;r==null||r.liquidityGross.lten(0);){if(l=L.getNextTickArrayStartIndex(l,a,o),this.checkIsValidStartIndex(l,a))throw new Error("No enough initialized tickArray");let p=n[l];if(p===void 0)continue;let{nextTick:b,tickArrayAddress:g,tickArrayStartTickIndex:u}=this.firstInitializedTickInOneArray(e,t,p,o);[r,s,l]=[b,g,u]}if(r==null)throw new Error("No invaild tickArray cache");return{nextTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}}static nextInitializedTickArray(e,t,n,i,a){let o=Math.floor(e/U.tickCount(t)),r=n?L.searchLowBitFromStart(i,a,o-1,1,t):L.searchHightBitFromStart(i,a,o+1,1,t);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let a;if(i){let r=fe-1;for(;r>=0;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r-1}}else{let r=0;for(;r<fe;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r+1}}let{publicKey:o}=Q(e,t,n.startTickIndex);return{nextTick:a,tickArrayAddress:o,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,a,o){let r=L.getTickArrayStartIndexByTick(i,a),s=Math.floor((i-r)/a),l=n[r];if(l==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:r};let p;if(o)for(;s>=0;){let g=l.ticks[s];if(g.liquidityGross.gtn(0)){p=g;break}s=s-1}else for(s=s+1;s<fe;){let g=l.ticks[s];if(g.liquidityGross.gtn(0)){p=g;break}s=s+1}let{publicKey:b}=Q(e,t,r);return{initializedTick:p,tickArrayAddress:b,tickArrayStartTickIndex:l.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(L.checkIsOutOfBoundary(e)){if(e>Te)return!1;let n=L.getTickArrayStartIndexByTick(ke,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return fe*e}};var pn=14,ze=class{static maxTickInTickarrayBitmap(e){return e*fe*$e}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let a=n*i;return e<0?{minValue:-a,maxValue:-a+n}:{minValue:a,maxValue:a+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let a=this.maxTickInTickarrayBitmap(n),o=i?t-U.tickCount(n):t+U.tickCount(n);if(o<-a||o>=a)return{isInit:!1,tickIndex:t};let r=n*fe,s=o/r+512;o<0&&o%r!=0&&s--;let l=Math.abs(s);if(i){let p=e.shln(1024-l-1),b=Zn(1024,p);if(b!==null){let g=(l-b-512)*r;return{isInit:!0,tickIndex:g}}else return{isInit:!1,tickIndex:-a}}else{let p=e.shrn(l),b=Jn(1024,p);if(b!==null){let g=(l+b-512)*r;return{isInit:!0,tickIndex:g}}else return{isInit:!1,tickIndex:a-U.tickCount(n)}}}},At=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=ze.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;if(Te<=t)throw Error(`extensionTickBoundary check error: ${Te}, ${t}`);if(n<=ke)throw Error(`extensionTickBoundary check error: ${n}, ${ke}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),a=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:L.mergeTickArrayBitmap(i).testn(a),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let a=U.tickCount(t),o=n?e-a:e+a,{tickarrayBitmap:r}=this.getBitmap(o,t,i);return this.nextInitializedTickArrayInBitmap(r,o,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:a,maxValue:o}=ze.getBitmapTickBoundary(t,n),r=this.tickArrayOffsetInBitmap(t,n);if(i){let s=L.mergeTickArrayBitmap(e).shln($e-1-r),l=gt(512,s)?null:sn(512,s);if(l!==null){let p=t-l*U.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:a}}else{let s=L.mergeTickArrayBitmap(e).shrn(r),l=gt(512,s)?null:an(512,s);if(l!==null){let p=t+l*U.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%ze.maxTickInTickarrayBitmap(t),i=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(i=$e-i),i}};var se=class{static getOutputAmountAndRemainAccounts(e,t,n,i,a,o=!1){let r=n.toBase58()===e.mintA.address,s=[],{isExist:l,startIndex:p,nextAccountMeta:b}=this.getFirstInitializedTickArray(e,r);if(!l||p===void 0||!b)throw new Error("Invalid tick array");s.push(b);let{allTrade:g,amountCalculated:u,accounts:k,sqrtPriceX64:m,feeAmount:c}=et.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,r,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,p,a,o);return s.push(...k),{allTrade:g,expectedAmountOut:u.mul(Ue),remainingAccounts:s,executionPrice:m,feeAmount:c}}static getInputAmountAndRemainAccounts(e,t,n,i,a){let o=n.toBase58()===e.mintB.address,r=[],{isExist:s,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,o);if(!s||l===void 0||!p)throw new Error("Invalid tick array");try{let m=this.preInitializedTickArrayStartIndex(e,o);if(m.isExist){let{publicKey:c}=Q(e.programId,e.id,m.nextStartIndex);r.push(c)}}catch{}r.push(p);let{amountCalculated:b,accounts:g,sqrtPriceX64:u,feeAmount:k}=et.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Ue),l,a);return r.push(...g),{expectedAmountIn:b,remainingAccounts:r,executionPrice:u,feeAmount:k}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=se.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?At.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):L.checkTickArrayIsInitialized(L.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:r}=Q(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:r}}let{isExist:a,nextStartIndex:o}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(a){let{publicKey:r}=Q(e.programId,e.id,o);return{isExist:!0,startIndex:o,nextAccountMeta:r}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),i=t?L.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):L.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:a}=ze.nextInitializedTickArrayStartIndex(L.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:a};t=a;let{isInit:o,tickIndex:r}=At.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(o)return{isExist:!0,nextStartIndex:r};if(t=r,t<ke||t>Te)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:a}){var r,s,l;let o=[];for(let p=0;p<a.length;p++){let b=a[p],g=(l=(r=t.rewardDefaultInfos[p])==null?void 0:r.mint.programId)!=null?l:(s=await e.getAccountInfo(b.tokenMint))==null?void 0:s.owner;if(g===void 0)throw Error("get new reward mint info error");let u=j(Y({},b),{perSecond:D.x64ToDecimal(b.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ce(g)});if(u.tokenMint.equals(Ce.default))continue;if(n<=u.openTime.toNumber()||i.eq(oe)){o.push(u);continue}let k=new ie(Math.min(u.endTime.toNumber(),n)),m=k.sub(u.lastUpdateTime),c=D.mulDivFloor(m,u.emissionsPerSecondX64,i),d=u.rewardGrowthGlobalX64.add(c),h=D.mulDivFloor(m,u.emissionsPerSecondX64,Ke),K=u.rewardTotalEmissioned.add(h);o.push(j(Y({},u),{rewardGrowthGlobalX64:d,rewardTotalEmissioned:K,lastUpdateTime:k}))}return o}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let a of t){let o=L.getTickArrayStartIndexByTick(a,e);if(o>=n||o<i)return!0}return!1}static tickRange(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;return t>Te&&(t=U.getArrayStartIndex(Te,e)+U.tickCount(e)),n<ke&&(n=U.getArrayStartIndex(ke,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*$e}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await ut(e,t.map(o=>({pubkey:o})),{batchRequest:n}),a={};for(let o of i)o.accountInfo!==null&&(a[o.pubkey.toString()]=oi.decode(o.accountInfo.data));return a}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},a=[];for(let s of t){let l=L.getTickArrayStartIndexByTick(s.tickCurrent,s.tickSpacing),p=L.getInitializedTickArrayInRange(s.tickArrayBitmap,s.exBitmapInfo,s.tickSpacing,l,7);for(let b of p){let{publicKey:g}=Q(s.programId,s.id,b);a.push({pubkey:g}),i[g.toString()]=s.id}}let o=await ut(e,a,{batchRequest:n}),r={};for(let s of o){if(!s.accountInfo)continue;let l=i[s.pubkey.toString()];if(!l)continue;r[l.toString()]===void 0&&(r[l.toString()]={});let p=kt.decode(s.accountInfo.data);r[l.toString()][p.startTickIndex]=j(Y({},p),{address:s.pubkey})}return r}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:a=!0}){var r;let o=[];for(let s=0;s<e.length;s++){let l=e[s];l!==null&&(o.find(p=>p.equals(l.state.programId))||o.push(l.state.programId))}if(n){let s=n.tokenAccounts.map(g=>g.accountInfo.mint),l=[];for(let g of s)for(let u of o)l.push(he(u,g).publicKey);let p=await He(t,l,{batchRequest:i}),b={};for(let g of p){if(g===null)continue;let u=dn.decode(g.data),k=u.poolId.toString(),m=e.find(N=>N.state.id.toBase58()===k);if(m===void 0)continue;let c=m.state,d=L._getTickPriceLegacy({poolInfo:c,tick:u.tickLower,baseIn:!0}),h=L._getTickPriceLegacy({poolInfo:c,tick:u.tickUpper,baseIn:!0}),{amountA:K,amountB:M}=z.getAmountsFromLiquidity(c.sqrtPriceX64,d.tickSqrtPriceX64,h.tickSqrtPriceX64,u.liquidity,!1),E=1/(1-Math.sqrt(Math.sqrt(d.price.div(h.price).toNumber())));m.positionAccount=[...(r=m.positionAccount)!=null?r:[],{poolId:u.poolId,nftMint:u.nftMint,priceLower:d.price,priceUpper:h.price,amountA:K,amountB:M,tickLower:u.tickLower,tickUpper:u.tickUpper,liquidity:u.liquidity,feeGrowthInsideLastX64A:u.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:u.feeGrowthInsideLastX64B,tokenFeesOwedA:u.tokenFeesOwedA,tokenFeesOwedB:u.tokenFeesOwedB,rewardInfos:u.rewardInfos.map(N=>j(Y({},N),{pendingReward:new ie(0)})),leverage:E,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let w=await L.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickLower,m.state.tickSpacing),C=await L.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickUpper,m.state.tickSpacing);b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickLower}`]=w,b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickUpper}`]=C}if(a){let g=Object.values(b),u=await He(t,g,{batchRequest:i}),k={};for(let m=0;m<g.length;m++){let c=u[m];if(c===null)continue;let d=g[m].toString();k[d]=kt.decode(c.data)}for(let{state:m,positionAccount:c}of e)if(!!c)for(let d of c){let h=`${m.programId.toString()}-${m.id.toString()}-${d.tickLower}`,K=`${m.programId.toString()}-${m.id.toString()}-${d.tickUpper}`,M=k[b[h].toString()],E=k[b[K].toString()],w=M.ticks[L.getTickOffsetInArray(d.tickLower,m.tickSpacing)],C=E.ticks[L.getTickOffsetInArray(d.tickUpper,m.tickSpacing)],{tokenFeeAmountA:N,tokenFeeAmountB:v}=await Pt.GetPositionFees(m,d,w,C),I=await Pt.GetPositionRewards(m,d,w,C);d.tokenFeeAmountA=N.gte(new ie(0))?N:new ie(0),d.tokenFeeAmountB=v.gte(new ie(0))?v:new ie(0);for(let V=0;V<I.length;V++)d.rewardInfos[V].pendingReward=I[V].gte(new ie(0))?I[V]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:a,slippage:o,priceLimit:r=new X(0),catchLiquidityInsufficient:s=!1}){var ye;let l,p=n.toBase58()===e.mintA.address,[b,g]=p?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];r.equals(new X(0))?l=p?We.add(new ie(1)):Ee.sub(new ie(1)):l=_.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let u=ue(a,b,i,!1),{allTrade:k,expectedAmountOut:m,remainingAccounts:c,executionPrice:d,feeAmount:h}=se.getOutputAmountAndRemainAccounts(e,t,n,u.amount.sub((ye=u.fee)!=null?ye:oe),l,s),K=ue(m,g,i,!1),M=_.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),E=p?M:new X(1).div(M),w=m.mul(new ie(Math.floor((1-o)*1e10))).div(new ie(1e10)),C=ue(w,g,i,!1),N=p?e.currentPrice:new X(1).div(e.currentPrice),v=new X(E).sub(N).abs(),I=N,V=new De(new X(v).mul(10**15).toFixed(0),new X(I).mul(10**15).toFixed(0));return{allTrade:k,realAmountIn:u,amountOut:K,minAmountOut:C,expirationTime:Ge(u.expirationTime,K.expirationTime),currentPrice:e.currentPrice,executionPrice:E,priceImpact:V,fee:h,remainingAccounts:c,executionPriceX64:d}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:a,epochInfo:o,catchLiquidityInsufficient:r=!1}){let s=i.address===e.mintB.address,[l,p]=s?[e.mintA,e.mintB]:[e.mintB,e.mintA],[b,g]=[new Ne(j(Y({},l),{mint:l.address,isToken2022:l.programId===ri.toBase58()})),new Ne(j(Y({},p),{mint:p.address,isToken2022:p.programId===ri.toBase58()}))],{allTrade:u,realAmountIn:k,amountOut:m,minAmountOut:c,expirationTime:d,currentPrice:h,executionPrice:K,priceImpact:M,fee:E,remainingAccounts:w,executionPriceX64:C}=se.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ce(l.address),amountIn:n,slippage:a,epochInfo:o,catchLiquidityInsufficient:r}),N=j(Y({},k),{amount:new pe(b,k.amount),fee:k.fee===void 0?void 0:new pe(b,k.fee)}),v=j(Y({},m),{amount:new pe(g,m.amount),fee:m.fee===void 0?void 0:new pe(g,m.fee)}),I=j(Y({},c),{amount:new pe(g,c.amount),fee:c.fee===void 0?void 0:new pe(g,c.fee)}),V=new Ie({baseToken:b,denominator:new ie(10).pow(new ie(20+b.decimals)),quoteToken:g,numerator:h.mul(new X(10**(20+g.decimals))).toFixed(0)}),ye=new Ie({baseToken:b,denominator:new ie(10).pow(new ie(20+b.decimals)),quoteToken:g,numerator:K.mul(new X(10**(20+g.decimals))).toFixed(0)}),ce=new pe(b,E);return{allTrade:u,realAmountIn:N,amountOut:v,minAmountOut:I,expirationTime:d,currentPrice:V,executionPrice:ye,priceImpact:M,fee:ce,remainingAccounts:w,executionPriceX64:C}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:a,slippage:o,priceLimit:r=new X(0)}){var I;let s=n.toBase58()===e.mintA.address,l={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},p;r.equals(new X(0))?p=s?Ee.sub(new ie(1)):We.add(new ie(1)):p=_.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let b=ue(a,l[n.toString()],i,!0),{expectedAmountIn:g,remainingAccounts:u,executionPrice:k,feeAmount:m}=se.getInputAmountAndRemainAccounts(e,t,n,b.amount.sub((I=b.fee)!=null?I:oe),p),c=s?e.mintB.address:e.mintA.address,d=ue(g,l[c],i,!1),h=_.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),K=s?h:new X(1).div(h),M=g.mul(new ie(Math.floor((1+o)*1e10))).div(new ie(1e10)),E=ue(M,l[c],i,!0),w=s?e.currentPrice:new X(1).div(e.currentPrice),C=new X(K).sub(w).abs(),N=w,v=new De(new X(C).mul(10**15).toFixed(0),new X(N).mul(10**15).toFixed(0));return{amountIn:d,maxAmountIn:E,realAmountOut:b,expirationTime:Ge(d.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:K,priceImpact:v,fee:m,remainingAccounts:u}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var k,m,c;let a=e[t],o=L.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),r=L.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),s=Math.max(o,a.priceMin),p=Math.min(r,a.priceMax)-s,b=r-o,g=a.priceMax-a.priceMin,u;return p<=0?u=0:b===p?u=g/p:g===p?u=p/b:u=p/g*(p/b),{feeApr:a.feeApr*u,rewardsApr:[((k=a.rewardApr[0])!=null?k:0)*u,((m=a.rewardApr[1])!=null?m:0)*u,((c=a.rewardApr[2])!=null?c:0)*u],apr:a.apr*u}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:a,positionTickLowerIndex:o,positionTickUpperIndex:r,chainTime:s}){let l=n==="day"?1:n==="week"?7:n==="month"?30:0,p=e[n],b=i[rt(e.mintA.address).toString()],g=i[rt(e.mintB.address).toString()],u=e.mintA.decimals,k=e.mintB.decimals;if(!p||!b||!g)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let m=_.priceToSqrtPriceX64(new X(e.price),e.mintA.decimals,e.mintB.decimals),c=_.getSqrtPriceX64FromTick(o),d=_.getSqrtPriceX64FromTick(r),{amountSlippageA:h,amountSlippageB:K}=z.getAmountsFromLiquidityWithSlippage(m,c,d,t,!1,!1,0),{amountSlippageA:M,amountSlippageB:E}=z.getAmountsFromLiquidityWithSlippage(m,c,d,a,!1,!1,0),w=new X(h.toString()).div(new X(10).pow(u)).mul(b.value).add(new X(K.toString()).div(new X(10).pow(k)).mul(g.value)),C=new X(M.toString()).div(new X(10).pow(u)).mul(b.value).add(new X(E.toString()).div(new X(10).pow(k)).mul(g.value)),N=new X(1).div(w.add(C)),I=new X(p.volumeFee).mul(365).div(l).mul(N).mul(100).toNumber(),V=3600*24*365,ye=e.rewardDefaultInfos.map(ce=>{var wn,hn;let we=ce.mint.decimals,it=i[ce.mint.address];return s<((wn=ce.startTime)!=null?wn:0)||s>((hn=ce.endTime)!=null?hn:0)||!ce.perSecond||!it||we===void 0?0:new X(it.value).mul(new X(ce.perSecond).mul(V)).div(new X(10).pow(we)).mul(N).mul(100).toNumber()});return{feeApr:I,rewardsApr:ye,apr:I+ye.reduce((ce,we)=>ce+we,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:a,slippage:o,add:r,epochInfo:s,amountHasFee:l}){var d,h;let p=_.priceToSqrtPriceX64(new X(e.price),e.mintA.decimals,e.mintB.decimals),b=_.getSqrtPriceX64FromTick(n),g=_.getSqrtPriceX64FromTick(i),u=ue(a,(d=e[t?"mintA":"mintB"].extensions)==null?void 0:d.feeConfig,s,!l),k=new ie(new X(u.amount.sub((h=u.fee)!=null?h:oe).toString()).toFixed(0)),m;if(p.lte(b))m=t?z.getLiquidityFromTokenAmountA(b,g,k,!r):new ie(0);else if(p.lte(g)){let K=z.getLiquidityFromTokenAmountA(p,g,k,!r),M=z.getLiquidityFromTokenAmountB(b,p,k);m=t?K:M}else m=t?new ie(0):z.getLiquidityFromTokenAmountB(b,g,k);let c=await se.getAmountsFromLiquidity({epochInfo:s,poolInfo:e,tickLower:n,tickUpper:i,liquidity:m,slippage:o,add:r});return{liquidity:m,amountA:t?u:c.amountA,amountB:t?c.amountB:u,amountSlippageA:t?u:c.amountSlippageA,amountSlippageB:t?c.amountSlippageB:u,expirationTime:c.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:a,slippage:o,add:r}){var c,d,h,K;let s=_.getSqrtPriceX64FromTick(n),l=_.getSqrtPriceX64FromTick(i),p=r?1+o:1-o,b=z.getAmountsFromLiquidity(_.priceToSqrtPriceX64(new X(t.price),t.mintA.decimals,t.mintB.decimals),s,l,a,r),[g,u]=[ue(b.amountA,(c=t.mintA.extensions)==null?void 0:c.feeConfig,e,!0),ue(b.amountB,(d=t.mintB.extensions)==null?void 0:d.feeConfig,e,!0)],[k,m]=[ue(b.amountA.muln(p),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ue(b.amountB.muln(p),(K=t.mintB.extensions)==null?void 0:K.feeConfig,e,!0)];return{liquidity:a,amountA:g,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:Ge(g.expirationTime,u.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(s=>!n[s.id]).map(s=>new Ce(s.id));(await He(e,i)).forEach((s,l)=>{!s||(n[i[l].toBase58()]=Ft.decode(s.data))});let o=t.map(s=>me(new Ce(s.programId),new Ce(s.id)).publicKey),r=await se.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((s,l)=>j(Y({},s),{[l.id]:j(Y({},n[l.id]),{id:new Ce(l.id),version:6,programId:new Ce(l.programId),mintA:l.mintA,mintB:l.mintB,ammConfig:j(Y({},l.config),{id:new Ce(l.config.id),fundOwner:""}),currentPrice:new X(l.price),exBitmapAccount:me(new Ce(l.programId),new Ce(l.id)).publicKey,exBitmapInfo:r[me(new Ce(l.programId),new Ce(l.id)).publicKey.toBase58()],startTime:n[l.id].startTime.toNumber(),rewardInfos:n[l.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var D=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),a=i.div(n);return i.mod(n).eq(oe)||(a=a.add(Se)),a}static mulDivFloor(e,t,n){if(n.eq(oe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(oe))throw new Error("division by 0");return e.mul(t).add(n.sub(Se)).div(n)}static x64ToDecimal(e,t){return new _e(e.toString()).div(_e.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new q(e.mul(_e.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Lt).sub(t).mod(Lt)}};function be(P,e){return fn(P.mul(e),64,256)}function Mr(P,e,t){let n=P.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function fn(P,e,t){let n=P.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var _=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(_e.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(_e.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(oe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(oe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(oe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(oe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(oe))return e;let a=t.shln(yt);if(i){let o=a,r=a.add(n.mul(e));return r.gte(o)?D.mulDivCeil(o,e,r):D.mulDivRoundingUp(o,Se,o.div(e).add(n))}else{let o=n.mul(e);if(!a.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let r=a.sub(o);return D.mulDivCeil(a,e,r)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let a=n.shln(yt);if(i)return e.add(a.div(t));{let o=D.mulDivRoundingUp(a,Se,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<ke||e>Te)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new q("18445821805675395072"):new q("18446744073709551616");return(t&2)!=0&&(n=be(n,new q("18444899583751176192"))),(t&4)!=0&&(n=be(n,new q("18443055278223355904"))),(t&8)!=0&&(n=be(n,new q("18439367220385607680"))),(t&16)!=0&&(n=be(n,new q("18431993317065453568"))),(t&32)!=0&&(n=be(n,new q("18417254355718170624"))),(t&64)!=0&&(n=be(n,new q("18387811781193609216"))),(t&128)!=0&&(n=be(n,new q("18329067761203558400"))),(t&256)!=0&&(n=be(n,new q("18212142134806163456"))),(t&512)!=0&&(n=be(n,new q("17980523815641700352"))),(t&1024)!=0&&(n=be(n,new q("17526086738831433728"))),(t&2048)!=0&&(n=be(n,new q("16651378430235570176"))),(t&4096)!=0&&(n=be(n,new q("15030750278694412288"))),(t&8192)!=0&&(n=be(n,new q("12247334978884435968"))),(t&16384)!=0&&(n=be(n,new q("8131365268886854656"))),(t&32768)!=0&&(n=be(n,new q("3584323654725218816"))),(t&65536)!=0&&(n=be(n,new q("696457651848324352"))),(t&131072)!=0&&(n=be(n,new q("26294789957507116"))),(t&262144)!=0&&(n=be(n,new q("37481735321082"))),e>0&&(n=zn.div(n)),n}static getTickFromPrice(e,t,n){return _.getTickFromSqrtPriceX64(_.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ee)||e.lt(We))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new q(t-64),i=Mr(n,32,128),a=new q("8000000000000000","hex"),o=0,r=new q(0),s=t>=64?e.shrn(t-63):e.shln(63-t);for(;a.gt(new q(0))&&o<Yn;){s=s.mul(s);let k=s.shrn(127);s=s.shrn(63+k.toNumber()),r=r.add(a.mul(k)),a=a.shrn(1),o+=1}let l=r.shrn(32),b=i.add(l).mul(new q(Hn)),g=fn(b.sub(new q(Qn)),64,128).toNumber(),u=fn(b.add(new q(jn)),64,128).toNumber();return g==u?g:_.getSqrtPriceX64FromTick(u).lte(e)?u:g}},tt=class{static getTickWithPriceAndTickspacing(e,t,n,i){let o=_.getTickFromSqrtPriceX64(_.priceToSqrtPriceX64(e,n,i))/t;return o<0?o=Math.floor(o):o=Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,i){let a=tt.getTickWithPriceAndTickspacing(e,t,n,i),o=_.getSqrtPriceX64FromTick(a);return _.sqrtPriceX64ToPrice(o,n,i)}},z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oe))throw new Error("sqrtPriceX64A must greater than 0");let a=n.ushln(yt),o=t.sub(e);return i?D.mulDivRoundingUp(D.mulDivCeil(a,o,t),Se,e):D.mulDivFloor(a,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oe))throw new Error("sqrtPriceX64A must greater than 0");return i?D.mulDivCeil(n,t.sub(e),Ke):D.mulDivFloor(n,t.sub(e),Ke)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let a=n.mul(e).mul(t),o=t.sub(e),r=a.div(o);return i?D.mulDivRoundingUp(r,Se,on):r.shrn(yt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),D.mulDivFloor(n,on,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return z.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let o=z.getLiquidityFromTokenAmountA(e,n,i,!1),r=z.getLiquidityFromTokenAmountB(t,e,a);return o.lt(r)?o:r}else return z.getLiquidityFromTokenAmountB(t,n,a)}static getAmountsFromLiquidity(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:z.getTokenAmountAFromLiquidity(t,n,i,a),amountB:new q(0)};if(e.lt(n)){let o=z.getTokenAmountAFromLiquidity(e,n,i,a),r=z.getTokenAmountBFromLiquidity(t,e,i,a);return{amountA:o,amountB:r}}else return{amountA:new q(0),amountB:z.getTokenAmountBFromLiquidity(t,n,i,a)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,a,o,r){let{amountA:s,amountB:l}=z.getAmountsFromLiquidity(e,t,n,i,o),p=a?1+r:1-r,b=new q(new _e(s.toString()).mul(p).toFixed(0)),g=new q(new _e(l.toString()).mul(p).toFixed(0));return{amountSlippageA:b,amountSlippageB:g}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:a,add:o,epochInfo:r,amountAddFee:s}){var h,K,M,E;let l=_.priceToSqrtPriceX64(new _e(e.price),e.mintA.decimals,e.mintB.decimals),p=_.getSqrtPriceX64FromTick(t),b=_.getSqrtPriceX64FromTick(n),g=o?1+a:1-a,u=z.getAmountsFromLiquidity(l,p,b,i,o),[k,m]=[ue(u.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,r,s),ue(u.amountB,(K=e.mintB.extensions)==null?void 0:K.feeConfig,r,s)],[c,d]=[ue(new q(new _e(u.amountA.toString()).mul(g).toFixed(0)),(M=e.mintA.extensions)==null?void 0:M.feeConfig,r,s),ue(new q(new _e(u.amountB.toString()).mul(g).toFixed(0)),(E=e.mintB.extensions)==null?void 0:E.feeConfig,r,s)];return{liquidity:i,amountA:k,amountB:m,amountSlippageA:c,amountSlippageB:d,expirationTime:Ge(k.expirationTime,m.expirationTime)}}},et=class{static swapCompute(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m=!1){if(g.eq(oe))throw new Error("amountSpecified must not be 0");if(k||(k=o?We.add(Se):Ee.sub(Se)),o){if(k.lt(We))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(k.gte(b))throw new Error("sqrtPriceX64 must smaller than current")}else{if(k.gt(Ee))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(k.lte(b))throw new Error("sqrtPriceX64 must greater than current")}let c=g.gt(oe),d={amountSpecifiedRemaining:g,amountCalculated:oe,sqrtPriceX64:b,tick:l>u?Math.min(u+U.tickCount(p)-1,l):u,accounts:[],liquidity:s,feeAmount:new q(0)},h=u,K=n[u],M=0,E=!o&&K.startTickIndex===d.tick;for(;!d.amountSpecifiedRemaining.eq(oe)&&!d.sqrtPriceX64.eq(k);){M>10;let w={};w.sqrtPriceStartX64=d.sqrtPriceX64;let C=L.nextInitTick(K,d.tick,p,o,E),N=C||null,v=null;if(!(N!=null&&N.liquidityGross.gtn(0))){let V=se.nextInitializedTickArrayStartIndex({tickCurrent:d.tick,tickSpacing:p,tickArrayBitmap:i,exBitmapInfo:a},h,o);if(!V.isExist){if(m)return{allTrade:!1,amountSpecifiedRemaining:d.amountSpecifiedRemaining,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts};throw Error("swapCompute LiquidityInsufficient")}h=V.nextStartIndex;let{publicKey:ye}=Q(e,t,h);v=ye,K=n[h];try{N=L.firstInitializedTick(K,o)}catch{throw Error("not found next tick info")}}w.tickNext=N.tick,w.initialized=N.liquidityGross.gtn(0),u!==h&&v&&(d.accounts.push(v),u=h),w.tickNext<ke?w.tickNext=ke:w.tickNext>Te&&(w.tickNext=Te),w.sqrtPriceNextX64=_.getSqrtPriceX64FromTick(w.tickNext);let I;if(o&&w.sqrtPriceNextX64.lt(k)||!o&&w.sqrtPriceNextX64.gt(k)?I=k:I=w.sqrtPriceNextX64,[d.sqrtPriceX64,w.amountIn,w.amountOut,w.feeAmount]=et.swapStepCompute(d.sqrtPriceX64,I,d.liquidity,d.amountSpecifiedRemaining,r,o),d.feeAmount=d.feeAmount.add(w.feeAmount),c?(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.sub(w.amountIn.add(w.feeAmount)),d.amountCalculated=d.amountCalculated.sub(w.amountOut)):(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.add(w.amountOut),d.amountCalculated=d.amountCalculated.add(w.amountIn.add(w.feeAmount))),d.sqrtPriceX64.eq(w.sqrtPriceNextX64)){if(w.initialized){let V=N.liquidityNet;o&&(V=V.mul(Ue)),d.liquidity=z.addDelta(d.liquidity,V)}E=w.tickNext!=d.tick&&!o&&K.startTickIndex===w.tickNext,d.tick=o?w.tickNext-1:w.tickNext}else if(d.sqrtPriceX64!=w.sqrtPriceStartX64){let V=_.getTickFromSqrtPriceX64(d.sqrtPriceX64);E=V!=d.tick&&!o&&K.startTickIndex===V,d.tick=V}++M}try{let{nextStartIndex:w,isExist:C}=U.nextInitializedTickArray(d.tick,p,o,i,a);C&&u!==w&&(d.accounts.push(Q(e,t,w).publicKey),u=w)}catch{}return{allTrade:!0,amountSpecifiedRemaining:oe,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts}}static swapStepCompute(e,t,n,i,a,o){let r={sqrtPriceX64Next:new q(0),amountIn:new q(0),amountOut:new q(0),feeAmount:new q(0)},s=i.gte(oe);if(s){let p=D.mulDivFloor(i,Ot.sub(new q(a.toString())),Ot);r.amountIn=o?z.getTokenAmountAFromLiquidity(t,e,n,!0):z.getTokenAmountBFromLiquidity(e,t,n,!0),p.gte(r.amountIn)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=_.getNextSqrtPriceX64FromInput(e,n,p,o)}else r.amountOut=o?z.getTokenAmountBFromLiquidity(t,e,n,!1):z.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Ue).gte(r.amountOut)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=_.getNextSqrtPriceX64FromOutput(e,n,i.mul(Ue),o);let l=t.eq(r.sqrtPriceX64Next);return o?(l&&s||(r.amountIn=z.getTokenAmountAFromLiquidity(r.sqrtPriceX64Next,e,n,!0)),l&&!s||(r.amountOut=z.getTokenAmountBFromLiquidity(r.sqrtPriceX64Next,e,n,!1))):(r.amountIn=l&&s?r.amountIn:z.getTokenAmountBFromLiquidity(e,r.sqrtPriceX64Next,n,!0),r.amountOut=l&&!s?r.amountOut:z.getTokenAmountAFromLiquidity(e,r.sqrtPriceX64Next,n,!1)),!s&&r.amountOut.gt(i.mul(Ue))&&(r.amountOut=i.mul(Ue)),s&&!r.sqrtPriceX64Next.eq(t)?r.feeAmount=i.sub(r.amountIn):r.feeAmount=D.mulDivCeil(r.amountIn,new q(a),Ot.sub(new q(a))),[r.sqrtPriceX64Next,r.amountIn,r.amountOut,r.feeAmount]}};var fe=60,$e=512,L=class{static getTickArrayAddressByTick(e,t,n,i){let a=L.getTickArrayStartIndexByTick(n,i),{publicKey:o}=Q(e,t,a);return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=L.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=fe)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*fe,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*fe,a=Math.floor(t/i)+512,o=Math.abs(a);return{isInitialized:e.testn(o),startIndex:(o-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*fe:e+t*fe}static mergeTickArrayBitmap(e){let t=new Or(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,a){let o=Math.floor(i/(n*fe));return[...L.searchLowBitFromStart(e,t,o-1,a,n),...L.searchHightBitFromStart(e,t,o,a,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return L.searchHightBitFromStart(e,t,-7680,$e,n)}static getAllInitializedTickArrayInfo(e,t,n,i,a){let o=[],r=L.getAllInitializedTickArrayStartIndex(n,i,a);for(let s of r){let{publicKey:l}=Q(e,t,s);o.push({tickArrayStartIndex:s,tickArrayAddress:l})}return o}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>L.mergeTickArrayBitmap(l)),r=[];for(;n>=-7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n--,r.length===i)break}let s=U.tickCount(a);return r.map(l=>l*s)}static searchHightBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>L.mergeTickArrayBitmap(l)),r=[];for(;n<7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n++,r.length===i)break}let s=U.tickCount(a);return r.map(l=>l*s)}static checkIsOutOfBoundary(e){return e<ke||e>Te}static nextInitTick(e,t,n,i,a){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let r=Math.floor((t-e.startTickIndex)/n);if(i)for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r-1}else for(a||(r=r+1);r<fe;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r+1}return null}static firstInitializedTick(e,t){if(t){let n=fe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<fe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=_.getSqrtPriceX64FromTick(t),a=_.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new at(1).div(a),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new at(1).div(t),a=tt.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=_.getSqrtPriceX64FromTick(a),r=_.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new at(1).div(r)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=_.getSqrtPriceX64FromTick(t),a=_.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new at(1).div(a),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new at(1).div(t),a=tt.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=_.getSqrtPriceX64FromTick(a),r=_.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new at(1).div(r)}}};var Wr=R([le(8),W("bump"),Je("index"),B(""),xe("protocolFeeRate"),xe("tradeFeeRate"),Je("tickSpacing"),G(y(),8,"")]),Er=R([xe("blockTimestamp"),Un("tickCumulative"),G(y(),4)]),si=R([le(8),de("initialized"),y("recentEpoch"),Je("observationIndex"),B("poolId"),G(Er,100,"observations"),G(y(),4)]),Fr=R([W("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),F("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),B("tokenMint"),B("tokenVault"),B("creator"),F("rewardGrowthGlobalX64")]),Ft=R([le(8),W("bump"),B("ammConfig"),B("creator"),B("mintA"),B("mintB"),B("vaultA"),B("vaultB"),B("observationId"),W("mintDecimalsA"),W("mintDecimalsB"),Je("tickSpacing"),F("liquidity"),F("sqrtPriceX64"),ne("tickCurrent"),xe(),F("feeGrowthGlobalX64A"),F("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),F("swapInAmountTokenA"),F("swapOutAmountTokenB"),F("swapInAmountTokenB"),F("swapOutAmountTokenA"),W("status"),G(W(),7,""),G(Fr,3,"rewardInfos"),G(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),G(y(),15*4-3,"padding")]),_r=R([F("growthInsideLastX64"),y("rewardAmountOwed")]),dn=R([le(8),W("bump"),B("nftMint"),B("poolId"),ne("tickLower"),ne("tickUpper"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),G(_r,3,"rewardInfos"),G(y(),8,"")]),Nm=R([le(8),W("bump"),B("poolId"),ne("tickLowerIndex"),ne("tickUpperIndex"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),G(F(),3,"rewardGrowthInside"),G(y(),8,"")]),Vr=R([ne("tick"),Xn("liquidityNet"),F("liquidityGross"),F("feeGrowthOutsideX64A"),F("feeGrowthOutsideX64B"),G(F(),3,"rewardGrowthsOutsideX64"),G(xe(),13,"")]),kt=R([le(8),B("poolId"),ne("startTickIndex"),G(Vr,fe,"ticks"),W("initializedTickCount"),G(W(),115,"")]),vr=R([le(329),G(B(),100,"whitelistMints")]),oi=R([le(8),B("poolId"),G(G(y(),8),pn,"positiveTickArrayBitmap"),G(G(y(),8),pn,"negativeTickArrayBitmap")]),Mm=R([y(),W("bump"),B("owner"),B("poolId"),B("positionId"),B("nftAccount"),G(y(),8)]),Dr=R([le(8),W("bump"),B("lockOwner"),B("poolId"),B("positionId"),B("nftAccount"),B("lockNftMint"),y("recentEpoch"),G(y(),8)]);si.span;var ai=ee("Raydium_Clmm"),Re={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},ui=[188,37,179,131,82,150,84,73],ci=[16,72,250,198,14,162,212,19],nt=class{static createPoolInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k){let m=R([F("sqrtPriceX64"),y("zero")]),c=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1},...(k==null?void 0:k.map(K=>({pubkey:K,isSigner:!1,isWritable:!1})))||[]],d=Buffer.alloc(m.span);m.encode({sqrtPriceX64:u,zero:oe},d);let h=Buffer.from([...Re.createPool,...d]);return new Pe({keys:c,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:a,ammConfigId:o,initialPriceX64:r,extendMintAccount:s}=e,[l,p]=[new T(i.address),new T(a.address)],{publicKey:b}=ei(t,o,l,p),{publicKey:g}=ni(t,b),{publicKey:u}=un(t,b,l),{publicKey:k}=un(t,b,p),m=me(t,b).publicKey,c=[this.createPoolInstruction(t,b,n,o,g,l,u,new T(i.programId||J),p,k,new T(a.programId||J),m,r,s)];return{signers:[],instructions:c,instructionTypes:[Z.CreateAccount,Z.ClmmCreatePool],address:{poolId:b,observationId:g,exBitmapAccount:m,mintAVault:u,mintBVault:k},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,K,M,E,w,C,N,v,I){let V=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),F("liquidity"),y("amountMaxA"),y("amountMaxB"),de("withMetadata"),W("optionBaseFlag"),de("baseFlag")]),ye=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:je,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...ye],we=Buffer.alloc(V.span);V.encode({tickLowerIndex:h,tickUpperIndex:K,tickArrayLowerStartIndex:M,tickArrayUpperStartIndex:E,liquidity:w,amountMaxA:C,amountMaxB:N,withMetadata:v==="create",baseFlag:!1,optionBaseFlag:0},we);let it=Buffer.from([...Re.openPosition,...we]);return new Pe({keys:ce,programId:e,data:it})}static openPositionFromLiquidityInstruction22(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,K,M,E,w,C,N,v){let I=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),F("liquidity"),y("amountMaxA"),y("amountMaxB"),de("withMetadata"),W("optionBaseFlag"),de("baseFlag")]),V=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...V],ce=Buffer.alloc(I.span);I.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:K,tickArrayUpperStartIndex:M,liquidity:E,amountMaxA:w,amountMaxB:C,withMetadata:N==="create",baseFlag:!1,optionBaseFlag:0},ce);let we=Buffer.from([...Re.openPositionWithTokenEx,...ce]);return new Pe({keys:ye,programId:e,data:we})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g=[],[u,k]=[new T(e.programId),new T(e.id)],m;if(p)m=new T((await p(1))[0]);else{let v=_t.generate();g.push(v),m=v.publicKey}let c=L.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Q(u,k,c),{publicKey:K}=Q(u,k,d),{publicKey:M}=b?$(n.wallet,m,ae):$(n.wallet,m,J),{publicKey:E}=st(m),{publicKey:w}=he(u,m),{publicKey:C}=Xe(u,k,i,a),N=b?this.openPositionFromLiquidityInstruction22(u,n.feePayer,k,n.wallet,m,M,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0):this.openPositionFromLiquidityInstruction(u,n.feePayer,k,n.wallet,m,M,E,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0);return{signers:g,instructions:[N],instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:m,tickArrayLower:h,tickArrayUpper:K,positionNftAccount:M,metadataAccount:E,personalPosition:w,protocolPosition:C}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,base:o,baseAmount:r,otherAmountMax:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g=[],[u,k]=[new T(e.programId),new T(e.id)],m;if(p)m=new T((await p(1))[0]);else{let v=_t.generate();g.push(v),m=v.publicKey}let c=L.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Q(u,k,c),{publicKey:K}=Q(u,k,d),{publicKey:M}=b?$(n.wallet,m,ae):$(n.wallet,m,J),{publicKey:E}=st(m),{publicKey:w}=he(u,m),{publicKey:C}=Xe(u,k,i,a),N=b?this.openPositionFromBaseInstruction22(u,n.feePayer,k,n.wallet,m,M,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,l,o,r,s,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0):this.openPositionFromBaseInstruction(u,n.feePayer,k,n.wallet,m,M,E,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),i,a,c,d,l,o,r,s,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(u,k).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:h,tickArrayUpper:K,positionNftAccount:M,metadataAccount:E,personalPosition:w,protocolPosition:C},instructions:[N],signers:g,instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,K,M,E,w,C,N,v,I){let V=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),F("liquidity"),y("amountMaxA"),y("amountMaxB"),de("withMetadata"),W("optionBaseFlag"),de("baseFlag")]),ye=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:je,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...ye],we=Buffer.alloc(V.span);V.encode({tickLowerIndex:h,tickUpperIndex:K,tickArrayLowerStartIndex:M,tickArrayUpperStartIndex:E,liquidity:new bn(0),amountMaxA:C==="MintA"?N:v,amountMaxB:C==="MintA"?v:N,withMetadata:w==="create",baseFlag:C==="MintA",optionBaseFlag:1},we);let it=Buffer.from([...Re.openPosition,...we]);return new Pe({keys:ce,programId:e,data:it})}static openPositionFromBaseInstruction22(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,K,M,E,w,C,N,v){let I=R([ne("tickLowerIndex"),ne("tickUpperIndex"),ne("tickArrayLowerStartIndex"),ne("tickArrayUpperStartIndex"),F("liquidity"),y("amountMaxA"),y("amountMaxB"),de("withMetadata"),W("optionBaseFlag"),de("baseFlag")]),V=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...V],ce=Buffer.alloc(I.span);I.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:K,tickArrayUpperStartIndex:M,liquidity:new bn(0),amountMaxA:w==="MintA"?C:N,amountMaxB:w==="MintA"?N:C,withMetadata:E==="create",baseFlag:w==="MintA",optionBaseFlag:1},ce);let we=Buffer.from([...Re.openPositionWithTokenEx,...ce]);return new Pe({keys:ye,programId:e,data:we})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let g,u=[];if(p)g=new T((await p(1))[0]);else{let v=_t.generate();u.push(v),g=v.publicKey}let[k,m]=[new T(e.programId),new T(e.id)],c=L.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=Q(k,m,c),{publicKey:K}=Q(k,m,d),{publicKey:M}=b?$(n.wallet,g,ae):$(n.wallet,g,J),{publicKey:E}=st(g),{publicKey:w}=he(k,g),{publicKey:C}=Xe(k,m,i,a),N=b?this.openPositionFromLiquidityInstruction22(k,n.wallet,m,n.wallet,g,M,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(k,m).publicKey:void 0):this.openPositionFromLiquidityInstruction(k,n.wallet,m,n.wallet,g,M,E,C,h,K,w,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),i,a,c,d,o,r,s,l,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?me(k,m).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:h,tickArrayUpper:K,positionNftAccount:M,metadataAccount:E,personalPosition:w,protocolPosition:C},instructions:[N],signers:u,instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,a,o){let r=R([]),s=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:Ye.programId,isSigner:!1,isWritable:!1},{pubkey:o?ae:J,isSigner:!1,isWritable:!1}],l=Buffer.alloc(r.span);r.encode({},l);let p=Buffer.from([...Re.closePosition,...l]);return new Pe({keys:s,programId:e,data:p})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:a}){let o=new T(e.programId),r=a?$(n.wallet,i.nftMint,ae).publicKey:$(n.wallet,i.nftMint,J).publicKey,{publicKey:s}=he(o,i.nftMint),l=[];return l.push(this.closePositionInstruction(o,n.wallet,i.nftMint,r,s,a)),{address:{positionNftAccount:r,personalPosition:s},signers:[],instructions:l,instructionTypes:[Z.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h){let K=R([F("liquidity"),y("amountMaxA"),y("amountMaxB"),W("optionBaseFlag"),de("baseFlag")]),M=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],E=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...M],w=Buffer.alloc(K.span);K.encode({liquidity:m,amountMaxA:c,amountMaxB:d,optionBaseFlag:0,baseFlag:!1},w);let C=Buffer.from([...Re.increaseLiquidity,...w]);return new Pe({keys:E,programId:e,data:C})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMaxA:o,amountMaxB:r,nft2022:s}){let[l,p]=[new T(e.programId),new T(e.id)],b=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),g=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Q(l,p,b),{publicKey:k}=Q(l,p,g),{publicKey:m}=s?$(i.wallet,n.nftMint,ae):$(i.wallet,n.nftMint,J),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=Xe(l,p,n.tickLower,n.tickUpper),h=this.increasePositionFromLiquidityInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),a,o,r,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?me(l,p).publicKey:void 0);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},signers:[],instructions:[h],instructionTypes:[Z.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:a,baseAmount:o,otherAmountMax:r,nft2022:s}){let[l,p]=[new T(e.programId),new T(e.id)],b=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),g=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=Q(l,p,b),{publicKey:k}=Q(l,p,g),{publicKey:m}=s?$(i.wallet,n.nftMint,ae):$(i.wallet,n.nftMint,J),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=Xe(l,p,n.tickLower,n.tickUpper);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},instructions:[this.increasePositionFromBaseInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),a,o,r,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?me(l,p).publicKey:void 0)],signers:[],instructionTypes:[Z.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h){let K=R([F("liquidity"),y("amountMaxA"),y("amountMaxB"),W("optionBaseFlag"),de("baseFlag")]),M=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],E=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...M],w=Buffer.alloc(K.span);K.encode({liquidity:new bn(0),amountMaxA:m==="MintA"?c:d,amountMaxB:m==="MintA"?d:c,baseFlag:m==="MintA",optionBaseFlag:1},w);let C=Buffer.from([...Re.increaseLiquidity,...w]);return new Pe({keys:E,programId:e,data:C})}static decreaseLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d,h,K){let M=R([F("liquidity"),y("amountMinA"),y("amountMinB")]),E=[...K?[{pubkey:K,isSigner:!1,isWritable:!0}]:[],...m.map(v=>[{pubkey:v.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:v.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:v.rewardMint,isSigner:!1,isWritable:!1}]).flat()],w=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:St,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...E],C=Buffer.alloc(M.span);M.encode({liquidity:c,amountMinA:d,amountMinB:h},C);let N=Buffer.from([...Re.decreaseLiquidity,...C]);return new Pe({keys:w,programId:e,data:N})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMinA:o,amountMinB:r,programId:s,nft2022:l}){let[p,b]=[new T(e.programId),new T(e.id)],g=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),u=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:k}=Q(p,b,g),{publicKey:m}=Q(p,b,u),{publicKey:c}=l?$(i.wallet,n.nftMint,ae):$(i.wallet,n.nftMint,s),{publicKey:d}=he(p,n.nftMint),{publicKey:h}=Xe(p,b,n.tickLower,n.tickUpper),K=[];for(let w=0;w<e.rewardDefaultInfos.length;w++)K.push({poolRewardVault:new T(t.rewardInfos[w].vault),ownerRewardVault:i.rewardAccounts[w],rewardMint:new T(e.rewardDefaultInfos[w].mint.address)});let M=[],E=this.decreaseLiquidityInstruction(p,i.wallet,c,d,b,h,k,m,i.tokenAccountA,i.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),K,a,o,r,se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,u])?me(p,b).publicKey:void 0);return M.push(E),{address:{tickArrayLower:k,tickArrayUpper:m,positionNftAccount:c,personalPosition:d,protocolPosition:h},signers:[],instructions:M,instructionTypes:[Z.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,a,o,r,s,l,p,b,g,u,k,m,c,d){let h=R([y("amount"),y("otherAmountThreshold"),F("sqrtPriceLimitX64"),de("isBaseInput")]),K=[...d?[{pubkey:d,isSigner:!1,isWritable:!0}]:[],...b.map(C=>({pubkey:C,isSigner:!1,isWritable:!0}))],M=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:St,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...K],E=Buffer.alloc(h.span);h.encode({amount:u,otherAmountThreshold:k,sqrtPriceLimitX64:m,isBaseInput:c},E);let w=Buffer.from([...Re.swap,...E]);return new Pe({keys:M,programId:e,data:w})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:a,amountIn:o,amountOutMin:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new T(e.programId),new T(e.id)],[g,u]=[new T(t.vault.A),new T(t.vault.B)],[k,m]=[new T(e.mintA.address),new T(e.mintB.address)],c=e.mintA.address===a.toString(),d=[this.swapInstruction(p,i.wallet,b,new T(e.config.id),c?i.tokenAccountA:i.tokenAccountB,c?i.tokenAccountB:i.tokenAccountA,c?g:u,c?u:g,c?k:m,c?m:k,l,n,o,r,s,!0,me(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[Z.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:a,amountOut:o,amountInMax:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new T(e.programId),new T(e.id)],[g,u]=[new T(t.vault.A),new T(t.vault.B)],[k,m]=[new T(e.mintA.address),new T(e.mintB.address)],c=e.mintA.address===a.toBase58(),d=[this.swapInstruction(p,i.wallet,b,new T(e.config.id),c?i.tokenAccountB:i.tokenAccountA,c?i.tokenAccountA:i.tokenAccountB,c?u:g,c?g:u,c?m:k,c?k:m,l,n,o,r,s,!1,me(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[Z.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,g){let u=R([y("openTime"),y("endTime"),F("emissionsPerSecondX64")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({openTime:te(p),endTime:te(b),emissionsPerSecondX64:g},m);let c=Buffer.from([...Re.initReward,...m]);return new Pe({keys:k,programId:e,data:c})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new T(e.programId),new T(e.id)],r=ti(a,o,i.mint).publicKey,s=Et(a).publicKey,l=[this.initRewardInstruction(a,n.wallet,o,s,new T(e.config.id),n.tokenAccount,i.programId,i.mint,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:r,operationId:s},signers:[],instructions:l,instructionTypes:[Z.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,g){let u=R([W("rewardIndex"),F("emissionsPerSecondX64"),y("openTime"),y("endTime")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0}],m=Buffer.alloc(u.span);u.encode({rewardIndex:l,emissionsPerSecondX64:g,openTime:te(p),endTime:te(b)},m);let c=Buffer.from([...Re.setRewardEmissions,...m]);return new Pe({keys:k,programId:e,data:c})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new T(e.programId),new T(e.id)],r,s,l;for(let g=0;g<e.rewardDefaultInfos.length;g++)e.rewardDefaultInfos[g].mint.address===i.mint.toString()&&(r=g,s=new T(t.rewardInfos[g].vault),l=new T(t.rewardInfos[g].mint.address));(r===void 0||s===void 0)&&ai.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let p=Et(a).publicKey,b=[this.setRewardInstruction(a,n.wallet,o,p,new T(e.config.id),n.tokenAccount,s,l,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:s,operationId:p},signers:[],instructions:b,instructionTypes:[Z.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,a,o,r){let s=R([W("rewardIndex")]),l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:St,isSigner:!1,isWritable:!1}],p=Buffer.alloc(s.span);s.encode({rewardIndex:r},p);let b=Buffer.from([...Re.collectReward,...p]);return new Pe({keys:l,programId:e,data:b})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[a,o]=[new T(e.programId),new T(e.id)],r,s;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===i.toString()&&(r=p,s=new T(t.rewardInfos[p].vault));(r===void 0||s===void 0)&&ai.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=[this.collectRewardInstruction(a,n.wallet,o,n.tokenAccount,s,i,r)];return{address:{rewardVault:s},signers:[],instructions:l,instructionTypes:[Z.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:a,nftMint:o,nft2022:r,getEphemeralSigners:s}){let l=[],p;if(s)p=new T((await s(1))[0]);else{let d=_t.generate();l.push(d),p=d.publicKey}let b=r?$(a,o,ae).publicKey:$(a,o,J).publicKey,{publicKey:g}=he(n,o),u=ln(e,p).publicKey,k=$(a,p,J).publicKey,m=st(p).publicKey,c=nt.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:a,lockOwner:a,positionNftAccount:b,positionId:g,lockPositionId:u,lockNftMint:p,lockNftAccount:k,metadataAccount:m,withMetadata:!0,nft2022:r,positionNftMint:o,authPositionNftAccount:$(t,o,r?ae:J).publicKey,positionNftProgram:r?ae:J});return{address:{positionId:g,lockPositionId:u,lockNftAccount:k,lockNftMint:p,positionNftAccount:b,metadataAccount:m},instructions:[c],signers:l,instructionTypes:[Z.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:a,positionNftAccount:o,positionId:r,positionNftMint:s,authPositionNftAccount:l,positionNftProgram:p,lockPositionId:b,lockNftMint:g,lockNftAccount:u,metadataAccount:k,withMetadata:m}){let c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!0,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:je,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1}],d=R([de("withMetadata")]),h=Buffer.alloc(d.span);d.encode({withMetadata:m},h);let K=Buffer.from([...ui,...h]);return new Pe({keys:c,programId:e,data:K})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:a}){let{publicKey:o}=$(i,a,J),{publicKey:r}=he(n,a),s=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:cn(e,r).publicKey,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:Ye.programId,isSigner:!1,isWritable:!1}];return new Pe({keys:s,programId:e,data:Buffer.from(ui)})}static harvestLockPositionInstruction(e){let[t,n]=[new T(e.poolKeys.programId),new T(e.poolKeys.id)],i=L.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),a=L.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:o}=Q(t,n,i),{publicKey:r}=Q(t,n,a),{publicKey:s}=$(e.owner,e.ownerPosition.nftMint,J),{publicKey:l}=he(t,e.ownerPosition.nftMint),{publicKey:p}=Xe(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),b=[];for(let k=0;k<e.poolKeys.rewardInfos.length;k++)b.push({poolRewardVault:new T(e.poolKeys.rewardInfos[k].vault),ownerRewardVault:e.ownerRewardAccounts[k],rewardMint:new T(e.poolKeys.rewardInfos[k].mint.address)});let g=[...b.map(k=>[{pubkey:k.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.rewardMint,isSigner:!1,isWritable:!1}]).flat()],u=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:cn(e.programId,l).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:new T(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new T(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:new T(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new T(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...g];return new Pe({keys:u,programId:e.programId,data:Buffer.from(ci)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:a,lockNftMint:o,lockNftAccount:r,positionNftAccount:s,positionId:l,poolId:p,protocolPosition:b,vaultA:g,vaultB:u,tickArrayLower:k,tickArrayUpper:m,userVaultA:c,userVaultB:d,mintA:h,mintB:K,rewardAccounts:M,exTickArrayBitmap:E}){let w=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[],...M.map(N=>[{pubkey:N.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.rewardMint,isSigner:!1,isWritable:!1}]).flat()],C=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:J,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:K,isSigner:!1,isWritable:!1},...w];return new Pe({keys:C,programId:e,data:Buffer.from(ci)})}};var Hp=R([le(8),W("bump"),de("disableCreatePool"),Je("index"),y("tradeFeeRate"),y("protocolFeeRate"),y("fundFeeRate"),y("createPoolFee"),B("protocolOwner"),B("fundOwner"),y("creatorFeeRate"),G(y(),15)]),Ur=R([le(8),B("configId"),B("poolCreator"),B("vaultA"),B("vaultB"),B("mintLp"),B("mintA"),B("mintB"),B("mintProgramA"),B("mintProgramB"),B("observationId"),W("bump"),W("status"),W("lpDecimals"),W("mintDecimalA"),W("mintDecimalB"),y("lpAmount"),y("protocolFeesMintA"),y("protocolFeesMintB"),y("fundFeesMintA"),y("fundFeesMintB"),y("openTime"),y("epoch"),W("feeOn"),de("enableCreatorFee"),G(W(),6),y("creatorFeesMintA"),y("creatorFeesMintB"),G(y(),28)]),Qp=R([le(8),B("configId"),G(y(),30)]);import{PublicKey as pd,TransactionInstruction as Xr,Keypair as fd,SystemProgram as bd}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as gd,TOKEN_2022_PROGRAM_ID as Pd,TOKEN_PROGRAM_ID as kd}from"@solana/spl-token";var $p=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),ed=Buffer.from("amm_config","utf8"),td=Buffer.from("pool","utf8"),nd=Buffer.from("pool_lp_mint","utf8"),id=Buffer.from("pool_vault","utf8"),rd=Buffer.from("observation","utf8"),od=Buffer.from("permission","utf8");var sd=Buffer.from("locked_liquidity","utf8");var Bd=ee("Raydium_cpmm"),zr={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133],createPermissionPda:Buffer.from([135,136,2,216,137,169,181,202]),closePermissionPda:Buffer.from([156,84,32,118,69,135,70,123]),initializeWithPermission:Buffer.from([63,55,254,65,49,178,89,121]),collectCreatorFee:Buffer.from([20,22,86,123,198,28,219,132])};function mi(P,e,t,n,i,a,o,r,s,l,p,b,g,u,k,m){let c=R([y("amountIn"),y("amounOutMin")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],h=Buffer.alloc(c.span);return c.encode({amountIn:k,amounOutMin:m},h),new Xr({keys:d,programId:P,data:Buffer.from([...zr.swapBaseInput,...h])})}import Gd from"bn.js";import Yr from"bn.js";var Rd=new Yr(0);import Ed from"bn.js";import pi from"bn.js";var rf=new pi(25),of=new pi(1e4);var yn=R([W("instruction"),y("amountIn"),y("minAmountOut")]),gn=R([W("instruction"),y("maxAmountIn"),y("amountOut")]),cf=R([W("instruction"),W("nonce")]),Hr=R([W("instruction"),W("nonce"),y("startTime")]),di=R([y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalValue"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),y("swapBase2QuoteFee"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),y("swapQuote2BaseFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("withdrawQueue"),B("lpVault"),B("owner"),y("lpReserve"),G(y(),3,"padding")]),lf=R([y("accountType"),y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalsValue"),y("abortTradeFactor"),y("priceTickMultiplier"),y("priceTick"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),y("swapQuote2BaseFee"),y("swapBase2QuoteFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("modelDataAccount"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("owner"),G(y(),64,"padding")]),Qr=R([W("instruction"),y("baseAmountIn"),y("quoteAmountIn"),y("fixedSide"),y("otherAmountMin")]),jr=R([W("instruction"),y("lpAmount"),y("baseAmountMin"),y("quoteAmountMin")]);var mf=R([y("fee")]);import{PublicKey as qb}from"@solana/web3.js";import Ub from"bn.js";import zb from"decimal.js";import{TOKEN_PROGRAM_ID as Hb}from"@solana/spl-token";import{PublicKey as ff,SystemProgram as bf,SYSVAR_RENT_PUBKEY as yf,TransactionInstruction as bi}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Pf,TOKEN_PROGRAM_ID as yi}from"@solana/spl-token";var fi=ee("Raydium_liquidity_instruction");function Zr({poolKeys:P,userKeys:e,amountIn:t,minAmountOut:n,modelDataPubKey:i=ft},a){let o=Be(P),r=Buffer.alloc(yn.span);yn.encode({instruction:9,amountIn:te(t),minAmountOut:te(n)},r);let s=[f({pubkey:yi,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders})];return a===4&&s.push(f({pubkey:o.targetOrders})),s.push(f({pubkey:o.vault.A}),f({pubkey:o.vault.B})),a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new bi({programId:o.programId,keys:s,data:r})}function Jr({poolKeys:P,userKeys:e,maxAmountIn:t,amountOut:n,modelDataPubKey:i=ft},a){let o=Be(P),r=Buffer.alloc(gn.span);gn.encode({instruction:11,maxAmountIn:te(t),amountOut:te(n)},r);let s=[f({pubkey:yi,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders}),f({pubkey:o.targetOrders}),f({pubkey:o.vault.A}),f({pubkey:o.vault.B})];return a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new bi({programId:o.programId,keys:s,data:r})}function gi(P){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:a,fixedSide:o}=P;if(t===4||t===5){let r={poolKeys:e,userKeys:n};if(o==="in")return Zr(j(Y({},r),{amountIn:i,minAmountOut:a}),t);if(o==="out")return Jr(j(Y({},r),{maxAmountIn:i,amountOut:a}),t);fi.logWithError("invalid params","params",P)}throw fi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as Cf}from"@solana/web3.js";var Nf=ee("Raydium_liquidity_serum");var $r=5e4,eo=R([y("x"),y("y"),y("price")]),Ef=R([y("accountType"),y("status"),y("multiplier"),y("validDataCount"),G(eo,$r,"DataElement")]);var Pn=R([B("mint"),B("owner"),y("amount"),xe("delegateOption"),B("delegate"),W("state"),xe("isNativeOption"),y("isNative"),y("delegatedAmount"),xe("closeAuthorityOption"),B("closeAuthority")]);import{Keypair as Gf,PublicKey as Uf}from"@solana/web3.js";import Yf from"bn.js";import{TOKEN_PROGRAM_ID as jf}from"@solana/spl-token";var Jf=ee("Raydium_Util");import{PublicKey as rb,SystemProgram as sb}from"@solana/web3.js";import cb from"bn.js";import{createCloseAccountInstruction as db,createInitializeAccountInstruction as fb,createTransferInstruction as bb,TOKEN_PROGRAM_ID as yb}from"@solana/spl-token";var to=R([xe("mintAuthorityOption"),B("mintAuthority"),y("supply"),W("decimals"),W("isInitialized"),xe("freezeAuthorityOption"),B("freezeAuthority")]);var no={[Zt.toBase58()]:3};var io=R([le(5),le(8),B("ownAddress"),y("vaultSignerNonce"),B("baseMint"),B("quoteMint"),B("baseVault"),y("baseDepositsTotal"),y("baseFeesAccrued"),B("quoteVault"),y("quoteDepositsTotal"),y("quoteFeesAccrued"),y("quoteDustThreshold"),B("requestQueue"),B("eventQueue"),B("bids"),B("asks"),y("baseLotSize"),y("quoteLotSize"),y("feeRateBps"),y("referrerRebatesAccrued"),le(7)]);import{PublicKey as ky}from"@solana/web3.js";var Iy=ee("Serum");import{PublicKey as A,SystemProgram as wt,TransactionInstruction as ht}from"@solana/web3.js";import Ve from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as kn,TOKEN_2022_PROGRAM_ID as An,TOKEN_PROGRAM_ID as Ze}from"@solana/spl-token";function Vy(P,e,t,n,i,a,o,r,s,l,p,b){let g=R([W("instruction"),y("amountIn"),y("amountOut")]),u=[{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1},{pubkey:new A(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A(t.id),isSigner:!1,isWritable:!0},{pubkey:new A(n.id),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let m=Be(t);u.push({pubkey:m.config.id,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.A:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.B:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},...b.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let m=Be(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0})}else{let m=Be(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},...m.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:m.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:m.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0}])}let k=Buffer.alloc(g.span);return g.encode({instruction:4,amountIn:l,amountOut:p},k),new ht({keys:u,programId:P,data:k})}function vy(P,e,t,n,i,a,o,r,s,l){let p=R([W("instruction")]),b=[{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1},{pubkey:new A(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let u=Be(n);b.push({pubkey:u.config.id,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.A:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.B:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},...l.map(k=>({pubkey:k,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let u=Be(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0})}else{let u=Be(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},...u.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:u.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:u.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(p.span);return p.encode({instruction:5},g),new ht({keys:b,programId:P,data:g})}function ro(P,e,t,n,i,a,o,r,s,l,p,b,g,u,k){var w;let m=[],c=[f({pubkey:Ze,isWritable:!1}),f({pubkey:An,isWritable:!1}),f({pubkey:kn,isWritable:!1}),f({pubkey:wt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})];c.push(f({pubkey:t})),c.push(f({pubkey:i}));let d=[s,l],h=[p,b],K=[a,o,r];for(let C=0;C<d.length;C++){let N=d[C],v=K[C]===N.mintA.address;if(c.push(f({pubkey:new A(N.programId),isWritable:!1})),C===d.length-1?c.push(f({pubkey:i})):c.push(f({pubkey:n})),c.push(f({pubkey:new A(K[C])})),c.push(f({pubkey:new A(K[C+1])})),N.version===6){let I=h[C];c.push(f({pubkey:new A(I.config.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(v?I.vault.A:I.vault.B)})),c.push(f({pubkey:new A(v?I.vault.B:I.vault.A)})),c.push(f({pubkey:new A(N.observationId)})),c.push(f({pubkey:Qe})),c.push(f({pubkey:me(new A(N.programId),new A(N.id)).publicKey})),m.push(Tn(N.sqrtPriceX64.toString(),v));for(let V of(w=k[C])!=null?w:[])c.push(f({pubkey:new A(V)}))}else if(N.version===5){let I=h[C];c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.authority),isWritable:!1})),c.push(f({pubkey:new A(I.marketProgramId)})),c.push(f({pubkey:new A(I.marketAuthority)})),c.push(f({pubkey:Ct,isWritable:!1})),c.push(f({pubkey:new A(I.openOrders)})),c.push(f({pubkey:new A(I.vault.A)})),c.push(f({pubkey:new A(I.vault.B)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.marketId)})),c.push(f({pubkey:new A(I.marketBids)})),c.push(f({pubkey:new A(I.marketAsks)})),c.push(f({pubkey:new A(I.marketEventQueue)})),c.push(f({pubkey:new A(I.marketBaseVault)})),c.push(f({pubkey:new A(I.marketQuoteVault)}))}else if(N.version===4){let I=h[C],V=N.status!==1;c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(I.authority),isWritable:!1})),c.push(f({pubkey:new A(V?I.id:I.marketProgramId)})),c.push(f({pubkey:new A(V?I.id:I.marketAuthority)})),c.push(f({pubkey:new A(V?I.id:I.openOrders)})),c.push(f({pubkey:new A(I.vault.A)})),c.push(f({pubkey:new A(I.vault.B)})),c.push(f({pubkey:new A(V?I.id:I.marketId)})),c.push(f({pubkey:new A(V?I.id:I.marketBids)})),c.push(f({pubkey:new A(V?I.id:I.marketAsks)})),c.push(f({pubkey:new A(V?I.id:I.marketEventQueue)})),c.push(f({pubkey:new A(V?I.id:I.marketBaseVault)})),c.push(f({pubkey:new A(V?I.id:I.marketQuoteVault)}))}else if(N.version===7){let I=h[C];c.push(f({pubkey:new A(I.authority)})),c.push(f({pubkey:new A(I.config.id)})),c.push(f({pubkey:new A(I.id)})),c.push(f({pubkey:new A(v?I.vault.A:I.vault.B)})),c.push(f({pubkey:new A(v?I.vault.B:I.vault.A)})),c.push(f({pubkey:new A(N.observationId)}))}else throw Error("pool type error")}let M=R([W("insId"),y("amountIn"),y("amountOut"),G(F(),m.length,"clmmPriceLimit")]),E=Buffer.alloc(M.span);return M.encode({insId:0,amountIn:g,amountOut:u,clmmPriceLimit:m},E),new ht({keys:c,programId:P,data:E})}function Tn(P,e){if(P)if(e){let t=new Ve(P).div(new Ve(25));return t.gt(Nt)?t:Nt}else{let t=new Ve(P).mul(new Ve(25));return t.lt(Mt)?t:Mt}else return e?Nt:Mt}function oo({routeProgram:P,ownerInfo:e,inputMint:t,swapInfo:n}){var i,a,o,r,s,l,p;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let b=n.poolKey[0],g=Be(b),u=t.equals(g.mintA.address)?We.add(Se):Ee.sub(Se);return nt.makeSwapBaseInInstructions({poolInfo:b,poolKeys:b,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:g.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:g.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((a=(i=n.minAmountOut.fee)==null?void 0:i.raw)!=null?a:new Ve(0)),sqrtPriceLimitX64:u,remainingAccounts:(o=n.remainingAccounts[0])!=null?o:[]})}else if(n.poolInfo[0].version===7){let b=n.poolInfo[0],g=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[mi(b.programId,e.wallet,b.authority,b.configId,b.id,e.sourceToken,e.destinationToken,g?b.vaultA:b.vaultB,g?b.vaultB:b.vaultA,g?b.mintProgramA:b.mintProgramB,g?b.mintProgramB:b.mintProgramA,new A(b[g?"mintA":"mintB"].address),new A(b[g?"mintB":"mintA"].address),b.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[g?Z.CpmmSwapBaseIn:Z.CpmmSwapBaseOut],address:{}}}else{let b=n.poolKey[0];return{signers:[],instructions:[gi({poolKeys:b,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((s=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?s:new Ve(0)),fixedSide:"in"})],lookupTableAddress:b.lookupTableAccount?[b.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?Z.AmmV5SwapBaseIn:Z.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let b=n.poolInfo[0],g=n.poolInfo[1],u=n.poolKey[0],k=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[ro(P,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),b,g,u,k,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((p=(l=n.minAmountOut.fee)==null?void 0:l.raw)!=null?p:new Ve(0)),n.remainingAccounts)],instructionTypes:[Z.RouteSwap],lookupTableAddress:[u.lookupTableAccount,k.lookupTableAccount].filter(m=>m!==void 0),address:{}}}else throw Error("route type error")}function Dy({programId:P,wallet:e,amount:t,inputAccount:n,outputAccount:i,routeInfo:a,poolKeys:o}){var g;if(a.success===!1)throw Error("route info error");let r=[],s=[f({pubkey:Ze,isWritable:!1}),f({pubkey:An,isWritable:!1}),f({pubkey:kn,isWritable:!1}),f({pubkey:wt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],l={[a.data.inputMint]:n,[a.data.outputMint]:i};s.push(f({pubkey:l[a.data.inputMint]})),s.push(f({pubkey:l[a.data.outputMint]}));for(let u=0;u<o.length;u++){let k=a.data.routePlan[u],m=o[u],c=k.inputMint===m.mintA.address;if(s.push(f({pubkey:new A(m.programId),isWritable:!1})),u===o.length-1)s.push(f({pubkey:l[k.outputMint]}));else{let d=k.outputMint;if(l[d]===void 0){let h=$(e,new A(d),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()||m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(c?m.mintB.programId:m.mintA.programId):Ze).publicKey;l[d]=h}s.push(f({pubkey:l[d]}))}if(s.push(f({pubkey:new A(k.inputMint)})),s.push(f({pubkey:new A(k.outputMint)})),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let d=m;s.push(f({pubkey:new A(d.config.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A(d.observationId)})),s.push(f({pubkey:Qe,isWritable:!1})),s.push(f({pubkey:new A(d.exBitmapAccount)})),r.push(Tn(k.lastPoolPriceX64,c));for(let h of(g=k.remainingAccounts)!=null?g:[])s.push(f({pubkey:new A(h)}))}else if(m.programId===Ae.AMM_STABLE.toBase58()){let d=m;s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.authority),isWritable:!1})),s.push(f({pubkey:new A(d.marketProgramId),isWritable:!1})),s.push(f({pubkey:new A(d.marketAuthority),isWritable:!1})),s.push(f({pubkey:Ct,isWritable:!1})),s.push(f({pubkey:new A(d.openOrders)})),s.push(f({pubkey:new A(d.vault.A)})),s.push(f({pubkey:new A(d.vault.B)})),s.push(f({pubkey:new A(d.marketId)})),s.push(f({pubkey:new A(d.marketBids)})),s.push(f({pubkey:new A(d.marketAsks)})),s.push(f({pubkey:new A(d.marketEventQueue)})),s.push(f({pubkey:new A(d.marketBaseVault)})),s.push(f({pubkey:new A(d.marketQuoteVault)}))}else if(m.programId===Ae.AMM_V4.toBase58()){let d=m;s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.authority),isWritable:!1})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.vault.A)})),s.push(f({pubkey:new A(d.vault.B)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)}))}else if(m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let d=m;s.push(f({pubkey:new A(d.authority)})),s.push(f({pubkey:new A(d.config.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A(d.observationId)}))}else throw Error("pool type error")}let p=R([W("insId"),y("amountIn"),y("amountOut"),G(F(),r.length,"clmmPriceLimit")]),b=Buffer.alloc(p.span);return p.encode({insId:0,amountIn:t,amountOut:new Ve(a.data.otherAmountThreshold),clmmPriceLimit:r},b),new ht({keys:s,programId:P,data:b})}function qy({programId:P,wallet:e,inputAccount:t,outputAccount:n,routeInfo:i,poolKeys:a}){var b;if(i.success===!1)throw Error("route info error");let o=[],r=[f({pubkey:Ze,isWritable:!1}),f({pubkey:An,isWritable:!1}),f({pubkey:kn,isWritable:!1}),f({pubkey:wt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],s={[i.data.inputMint]:t,[i.data.outputMint]:n};for(let g=a.length-1;g>=0;g--){let u=i.data.routePlan[g],k=a[g],m=u.inputMint===k.mintA.address;if(r.push(f({pubkey:new A(k.programId)})),g===0)r.push(f({pubkey:s[u.inputMint]}));else{let c=u.inputMint;if(s[c]===void 0){let d=$(e,new A(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(m?k.mintA.programId:k.mintB.programId):Ze).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(g===a.length-1)r.push(f({pubkey:s[u.outputMint]}));else{let c=u.outputMint;if(s[c]===void 0){let d=$(e,new A(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(m?k.mintB.programId:k.mintA.programId):Ze).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(r.push(f({pubkey:new A(u.inputMint)})),r.push(f({pubkey:new A(u.outputMint)})),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let c=k;r.push(f({pubkey:new A(c.config.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A(c.observationId)})),r.push(f({pubkey:Qe,isWritable:!1})),r.push(f({pubkey:new A(c.exBitmapAccount)})),o.push(Tn(u.lastPoolPriceX64,m));for(let d of(b=u.remainingAccounts)!=null?b:[])r.push(f({pubkey:new A(d)}))}else if(k.programId===Ae.AMM_STABLE.toBase58()){let c=k;r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.authority),isWritable:!1})),r.push(f({pubkey:new A(c.marketProgramId),isWritable:!1})),r.push(f({pubkey:new A(c.marketAuthority),isWritable:!1})),r.push(f({pubkey:Ct,isWritable:!1})),r.push(f({pubkey:new A(c.openOrders)})),r.push(f({pubkey:new A(c.vault.A)})),r.push(f({pubkey:new A(c.vault.B)})),r.push(f({pubkey:new A(c.marketId)})),r.push(f({pubkey:new A(c.marketBids)})),r.push(f({pubkey:new A(c.marketAsks)})),r.push(f({pubkey:new A(c.marketEventQueue)})),r.push(f({pubkey:new A(c.marketBaseVault)})),r.push(f({pubkey:new A(c.marketQuoteVault)}))}else if(k.programId===Ae.AMM_V4.toBase58()){let c=k;r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.authority),isWritable:!1})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.vault.A)})),r.push(f({pubkey:new A(c.vault.B)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)}))}else if(k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let c=k;r.push(f({pubkey:new A(c.authority)})),r.push(f({pubkey:new A(c.config.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A(c.observationId)}))}else throw Error("pool type error")}let l=R([W("insId"),y("amountIn"),y("amountOut"),G(F(),o.length,"clmmPriceLimit")]),p=Buffer.alloc(l.span);return l.encode({insId:1,amountIn:new Ve(i.data.otherAmountThreshold),amountOut:new Ve(i.data.outputAmount),clmmPriceLimit:o},p),new ht({keys:r,programId:P,data:p})}var Sg=new so(0);export{oo as makeSwapInstruction,Vy as route1Instruction,vy as route2Instruction,ro as routeInstruction,Dy as swapBaseInAutoAccount,qy as swapBaseOutAutoAccount};
//# sourceMappingURL=index.mjs.map