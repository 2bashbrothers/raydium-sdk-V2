var di=Object.defineProperty,fi=Object.defineProperties;var bi=Object.getOwnPropertyDescriptors;var An=Object.getOwnPropertySymbols;var yi=Object.prototype.hasOwnProperty,gi=Object.prototype.propertyIsEnumerable;var wn=(g,e,t)=>e in g?di(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t,j=(g,e)=>{for(var t in e||(e={}))yi.call(e,t)&&wn(g,t,e[t]);if(An)for(var t of An(e))gi.call(e,t)&&wn(g,t,e[t]);return g},Y=(g,e)=>fi(g,bi(e));import{PublicKey as A,SystemProgram as Pt,TransactionInstruction as At}from"@solana/web3.js";import Ve from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as bn,TOKEN_2022_PROGRAM_ID as yn,TOKEN_PROGRAM_ID as Ze}from"@solana/spl-token";import{PublicKey as Ai}from"@solana/web3.js";import{get as Tn,set as ki}from"lodash";var vt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},hn={},Pi={};function ce(g){let e=Tn(hn,g);if(!e){let t=Tn(Pi,g);e=new vt({name:g,logLevel:t}),ki(hn,g,e)}return e}import{MINT_SIZE as so,TOKEN_PROGRAM_ID as ao,getTransferFeeConfig as uo,unpackMint as co}from"@solana/spl-token";var _t=ce("Raydium_accountInfo_util");async function Xe(g,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:a=100}=j({batchRequest:!1},t),o=Dt(e,a),r=new Array(o.length).fill([]);if(n){let s=o.map(b=>{let y=g._buildArgs([b.map(u=>u.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:y}}),l=Dt(s,10);r=(await(await Promise.all(l.map(async b=>await g._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&_t.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(y=>{if(y){let{data:u,executable:k,lamports:m,owner:c,rentEpoch:d}=y;return u.length!==2&&u[1]!=="base64"&&_t.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(u[0],"base64"),executable:k,lamports:m,owner:new Ai(c),rentEpoch:d}}return null})))}else try{r=await Promise.all(o.map(s=>g.getMultipleAccountsInfo(s,i)))}catch(s){s instanceof Error&&_t.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${s.message}`)}return r.flat()}async function wt(g,e,t){let n=await Xe(g,e.map(i=>i.pubkey),t);return e.map((i,a)=>Y(j({},i),{accountInfo:n[a]}))}import _e from"bn.js";import Ds from"decimal.js";import Ki from"big.js";import It from"bn.js";import wi from"toformat";var Ti=wi,ut=Ti;import Bt from"big.js";import Bi from"bn.js";import Ii from"decimal.js-light";import ct from"bn.js";var Bn=9007199254740991;function re(g){let e=ce("Raydium_parseBigNumberish");if(g instanceof ct)return g;if(typeof g=="string"){if(g.match(/^-?[0-9]+$/))return new ct(g);e.logWithError(`invalid BigNumberish string: ${g}`)}return typeof g=="number"?(g%1&&e.logWithError(`BigNumberish number underflow: ${g}`),(g>=Bn||g<=-Bn)&&e.logWithError(`BigNumberish number overflow: ${g}`),new ct(String(g))):typeof g=="bigint"?new ct(g.toString()):(e.error(`invalid BigNumberish value: ${g}`),new ct(0))}var ht=ce("module/fraction"),qt=ut(Bt),lt=ut(Ii),xi={[0]:lt.ROUND_DOWN,[1]:lt.ROUND_HALF_UP,[2]:lt.ROUND_UP},Si={[0]:Bt.roundDown,[1]:Bt.roundHalfUp,[2]:Bt.roundUp},Q=class{constructor(e,t=new Bi(1)){this.numerator=re(e),this.denominator=re(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Q(this.denominator,this.numerator)}add(e){let t=e instanceof Q?e:new Q(re(e));return this.denominator.eq(t.denominator)?new Q(this.numerator.add(t.numerator),this.denominator):new Q(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Q?e:new Q(re(e));return this.denominator.eq(t.denominator)?new Q(this.numerator.sub(t.numerator),this.denominator):new Q(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Q?e:new Q(re(e));return new Q(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Q?e:new Q(re(e));return new Q(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||ht.logWithError(`${e} is not an integer.`),e<=0&&ht.logWithError(`${e} is not positive.`),lt.set({precision:e+1,rounding:xi[n]});let i=new lt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||ht.logWithError(`${e} is not an integer.`),e<0&&ht.logWithError(`${e} is negative.`),qt.DP=e,qt.RM=Si[n]||1,new qt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ci=ce("Raydium_amount"),In=ut(Ki);function Li(g,e){let t="0",n="0";if(g.includes(".")){let i=g.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Ci.logWithError(`invalid number string, num: ${g}`)}else t=g;return[t,n.slice(0,e)||n]}var pe=class extends Q{constructor(t,n,i=!0,a){let o=new It(0),r=Gt.pow(new It(t.decimals));if(i)o=re(n);else{let s=new It(0),l=new It(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[p,b]=Li(n.toString(),t.decimals);s=re(p),l=re(b)}s=s.mul(r),o=s.add(l)}super(o,r);this.logger=ce(a||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return In.DP=this.token.decimals,new In(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ri}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as xn}from"@solana/spl-token";var Ut={chainId:101,address:Ri.default.toBase58(),programId:xn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ze={chainId:101,address:"So11111111111111111111111111111111111111112",programId:xn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Qt}from"@solana/web3.js";import{PublicKey as ne,SystemProgram as Sn,SYSVAR_RENT_PUBKEY as Ni}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Mi}from"@solana/spl-token";function f({pubkey:g,isSigner:e=!1,isWritable:t=!0}){return{pubkey:g,isWritable:t,isSigner:e}}var qo=[f({pubkey:Mi,isWritable:!1}),f({pubkey:Sn.programId,isWritable:!1}),f({pubkey:Ni,isWritable:!1})];function Xt({publicKey:g,transformSol:e}){let t=zt(g.toString());if(t instanceof ne)return e&&t.equals(mt)?Tt:t;if(e&&t.toString()===mt.toBase58())return Tt;if(typeof t=="string"){if(t===ne.default.toBase58())return ne.default;try{return new ne(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function zt(g){try{return new ne(g)}catch{return g}}var xt=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Qe=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Me=new ne("SysvarRent111111111111111111111111111111111"),Go=new ne("SysvarC1ock11111111111111111111111111111111"),He=new ne("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Uo=new ne("Sysvar1nstructions1111111111111111111111111"),Oi=Sn.programId,Xo=new ne("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),zo=new ne("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Qo=new ne("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ho=new ne("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),jo=new ne("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Zo=new ne("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Yo=new ne("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Jo=new ne("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),$o=new ne("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),es=new ne("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ts=new ne("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Tt=new ne("So11111111111111111111111111111111111111112"),mt=ne.default;function at(g){return Xt({publicKey:g,transformSol:!0})}var Ht=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:a=!1,isToken2022:o=!1}){if(e===mt.toBase58()||e instanceof Qt&&mt.equals(e)){this.decimals=ze.decimals,this.symbol=ze.symbol,this.name=ze.name,this.mint=new Qt(ze.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=a?Qt.default:Xt({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Re=Ht;Re.WSOL=new Ht(Y(j({},ze),{mint:ze.address}));var jt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},St=jt;St.SOL=new jt(Ut);import Wi from"bn.js";var Kn=new Q(new Wi(100)),ve=class extends Q{toSignificant(e=5,t,n){return this.mul(Kn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Kn).toFixed(e,t,n)}};var Fi=ce("Raydium_price"),Ce=class extends Q{constructor(t){let{baseToken:n,quoteToken:i,numerator:a,denominator:o}=t;super(a,o);this.baseToken=n,this.quoteToken=i,this.scalar=new Q(Zt(n.decimals),Zt(i.decimals))}get raw(){return new Q(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ce({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Fi.logWithError("mul token not equals");let n=super.mul(t);return new Ce({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};import{PublicKey as Ei}from"@solana/web3.js";import Vi from"bn.js";function Ln(g){return typeof g=="object"&&g!==null&&![Re,pe,Ei,Q,Vi,Ce,ve].some(e=>typeof e=="object"&&g instanceof e)}function Be(g){return typeof g=="string"?zt(g):Array.isArray(g)?g.map(e=>Be(e)):Ln(g)?Object.fromEntries(Object.entries(g).map(([e,t])=>[e,Be(t)])):g}var Cn=new _e(0),vi=new _e(1),Ys=new _e(2),Js=new _e(3),$s=new _e(5),Gt=new _e(10),ea=new _e(100),ta=new _e(1e3),na=new _e(1e4);function Zt(g){return Gt.pow(re(g))}function Dt(g,e=1,t=[]){let n=[...g];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Di}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as qi}from"@solana/spl-token";import{ComputeBudgetProgram as la,Keypair as da,PublicKey as _i,Transaction as ba,TransactionMessage as ga,VersionedTransaction as ka}from"@solana/web3.js";var J={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Ta}from"@solana/spl-token";var ha=ce("Raydium_txUtil");function ge(g,e){let[t,n]=_i.findProgramAddressSync(g,e);return{publicKey:t,nonce:n}}function $(g,e,t){return ge([g.toBuffer(),(t!=null?t:qi).toBuffer(),e.toBuffer()],new Di("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as M}from"@solana/web3.js";var Gi=new M("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ui=new M("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Xi=new M("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),zi=new M("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Qi=new M("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Hi=new M("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ji=new M("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Zi=new M("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Yi=new M("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Kt=new M("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Rn=new M("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Nn=new M("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Mn=new M("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ct=new M("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ji=new M("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$i=new M("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),La=new M("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ra=new M("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Na=new M("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ma=new M("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),On=new M("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Wn=new M("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),er=new M("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),tr=new M("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),nr=new M("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ir=new M("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),rr=new M("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Oa=new M("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Wa=new M("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),or=new M("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),sr=new M("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ae={AMM_V4:Zi,AMM_STABLE:Yi,CLMM_PROGRAM_ID:Rn,CLMM_LOCK_PROGRAM_ID:Nn,CLMM_LOCK_AUTH_ID:Mn,FARM_PROGRAM_ID_V3:Gi,FARM_PROGRAM_ID_V4:Ui,FARM_PROGRAM_ID_V5:Xi,FARM_PROGRAM_ID_V6:zi,OPEN_BOOK_PROGRAM:Hi,SERUM_PROGRAM_ID_V3:ji,UTIL1216:Qi,Router:Ji,CREATE_CPMM_POOL_PROGRAM:On,CREATE_CPMM_POOL_AUTH:Wn,CREATE_CPMM_POOL_FEE_ACC:er,LOCK_CPMM_PROGRAM:tr,LOCK_CPMM_AUTH:nr,LAUNCHPAD_PROGRAM:ir,LAUNCHPAD_AUTH:rr,LAUNCHPAD_PLATFORM:or,LAUNCHPAD_CONFIG:sr,FEE_DESTINATION_ID:$i,MODEL_DATA_PUBKEY:Ct},Fa={OPEN_BOOK_PROGRAM:new M("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new M("Ray1111111111111111111111111111111111111111"),AMM_V4:new M("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new M("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new M("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new M("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new M("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new M("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new M("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new M("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new M("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new M("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:M.default,Router:new M("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new M("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new M("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new M("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new M("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new M("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new M("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new M("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new M("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new M("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new M("Ray1111111111111111111111111111111111111111")};import Ne from"bn.js";var pt=1e4;function se(g,e,t,n){if(e===void 0)return{amount:g,fee:void 0,expirationTime:void 0};let i=Y(j({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),a=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,o=new Ne(a.maximumFee.toString()),r=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(a.transferFeeBasisPoints===pt){let s=new Ne(a.maximumFee.toString());return{amount:g.add(s),fee:s,expirationTime:r}}else{let s=Lt(g.mul(new Ne(pt)),new Ne(pt-a.transferFeeBasisPoints)),l=new Ne(a.maximumFee.toString()),p=s.sub(g).gt(l)?g.add(l):s,b=Lt(p.mul(new Ne(a.transferFeeBasisPoints)),new Ne(pt)),y=b.gt(o)?o:b;return{amount:p,fee:y,expirationTime:r}}else{let s=Lt(g.mul(new Ne(a.transferFeeBasisPoints)),new Ne(pt)),l=s.gt(o)?o:s;return{amount:g,fee:l,expirationTime:r}}}function je(g,e){return g===void 0?e:e===void 0?g:Math.min(g,e)}function Lt(g,e){let{div:t,mod:n}=g.divmod(e);return n.gt(new Ne(0))?t.add(new Ne(1)):t}import{PublicKey as ar,AddressLookupTableAccount as Fn}from"@solana/web3.js";var ur={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Fn({key:new ar("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Fn.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as tu,sendAndConfirmTransaction as nu,SystemProgram as ou,Transaction as su,TransactionMessage as uu,VersionedTransaction as cu}from"@solana/web3.js";import mu from"axios";import mr from"bn.js";var pr=new mr(1e6);import{PublicKey as wr}from"@solana/web3.js";import _n,{isBN as Dn}from"bn.js";import{bits as vu,BitStructure as _u,blob as dr,Blob as Du,cstr as qu,f32 as Gu,f32be as Uu,f64 as Xu,f64be as zu,greedy as Qu,Layout as fr,ns64 as Hu,ns64be as ju,nu64 as Zu,nu64be as Yu,offset as Ju,s16 as $u,s16be as ec,s24 as tc,s24be as nc,s32 as br,s32be as ic,s40 as rc,s40be as oc,s48 as sc,s48be as ac,s8 as uc,seq as yr,struct as cc,Structure as gr,u16 as kr,u16be as lc,u24 as mc,u24be as pc,u32 as dc,u32be as fc,u40 as bc,u40be as yc,u48 as gc,u48be as kc,u8 as Pr,UInt as Ar,union as Pc,Union as Ac,unionLayoutDiscriminator as wc,utf8 as Tc}from"@solana/buffer-layout";var Yt=fr,En=gr;var Jt=Ar;var Vn=Pr,Ye=kr;var ee=br;var vn=yr;var ke=dr;var it=class extends Yt{constructor(t,n,i){super(t,i);this.blob=ke(t),this.signed=n}decode(t,n=0){let i=new _n(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new _n(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function E(g){return new Jt(1,g)}function rt(g){return new Jt(4,g)}function P(g){return new it(8,!1,g)}function F(g){return new it(16,!1,g)}function qn(g){return new it(8,!0,g)}function Gn(g){return new it(16,!0,g)}var Rt=class extends Yt{constructor(t,n,i,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function x(g){return new Rt(ke(32),e=>new wr(e),e=>e.toBuffer(),g)}function de(g){return new Rt(Vn(),Tr,hr,g)}function Tr(g){if(g===0)return!1;if(g===1)return!0;throw new Error("Invalid bool: "+g)}function hr(g){return g?1:0}var $t=class extends En{decode(e,t){return super.decode(e,t)}};function W(g,e,t){return new $t(g,e,t)}function G(g,e,t){let n,i=typeof e=="number"?e:Dn(e)?e.toNumber():new Proxy(e,{get(a,o){if(!n){let r=Reflect.get(a,"count");n=Dn(r)?r.toNumber():r,Reflect.set(a,"count",n)}return Reflect.get(a,o)},set(a,o,r){return o==="count"&&(n=r),Reflect.set(a,o,r)}});return vn(g,i,t)}import{PublicKey as qm}from"@solana/web3.js";import Um from"bn.js";import zm from"decimal.js";import{AccountLayout as jm,createAssociatedTokenAccountIdempotentInstruction as Zm,TOKEN_2022_PROGRAM_ID as Ym,TOKEN_PROGRAM_ID as Jm}from"@solana/spl-token";import{PublicKey as Ec}from"@solana/web3.js";import{MintLayout as vc,TOKEN_PROGRAM_ID as Dc}from"@solana/spl-token";import{Keypair as Vt,PublicKey as w,SystemProgram as Ue,TransactionInstruction as ye}from"@solana/web3.js";import pn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as kt,TOKEN_2022_PROGRAM_ID as oe,TOKEN_PROGRAM_ID as Z}from"@solana/spl-token";import Mr from"bn.js";import st from"decimal.js";import Le from"bn.js";var ie=new Le(0),Ie=new Le(1),De=new Le(-1),xe=new Le(1).shln(64),Nt=new Le(1).shln(128),en=xe.sub(Ie),dt=64,Un=Nt.subn(1),Pe=-443636,we=-Pe,Oe=new Le("4295048016"),We=new Le("79226673521066979257578248091"),Mt=new Le("4295048017"),Ot=new Le("79226673521066979257578248090"),Xn=16,zn="59543866431248",Qn="184467440737095516",Hn="15793534762490258745",Wt=new Le(10).pow(new Le(6));var tl=new Le("18446744073700000000");import q from"bn.js";import Ee from"decimal.js";function Ft(g){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,g,!1),new Uint8Array(e)}function tn(g,e){let t=0;for(let n=g-1;n>=0&&!e.testn(n);n--)t++;return t}function nn(g,e){let t=0;for(let n=0;n<g&&!e.testn(n);n++)t++;return t}function ft(g,e){for(let t=0;t<g;t++)if(e.testn(t))return!1;return!0}function jn(g,e){return ft(g,e)?null:tn(g,e)}function Zn(g,e){return ft(g,e)?null:nn(g,e)}var al=Buffer.from("amm_config","utf8"),Br=Buffer.from("pool","utf8"),Ir=Buffer.from("pool_vault","utf8"),xr=Buffer.from("pool_reward_vault","utf8"),Yn=Buffer.from("position","utf8"),Sr=Buffer.from("tick_array","utf8"),Kr=Buffer.from("operation","utf8"),Cr=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Lr=Buffer.from("observation","utf8");function Jn(g,e,t,n){return ge([Br,e.toBuffer(),t.toBuffer(),n.toBuffer()],g)}function rn(g,e,t){return ge([Ir,e.toBuffer(),t.toBuffer()],g)}function $n(g,e,t){return ge([xr,e.toBuffer(),t.toBuffer()],g)}function H(g,e,t){return ge([Sr,e.toBuffer(),Ft(t)],g)}function qe(g,e,t,n){return ge([Yn,e.toBuffer(),Ft(t),Ft(n)],g)}function he(g,e){return ge([Yn,e.toBuffer()],g)}function ot(g){return ge([Buffer.from("metadata","utf8"),He.toBuffer(),g.toBuffer()],He)}function Et(g){return ge([Kr],g)}function le(g,e){return ge([Cr,e.toBuffer()],g)}function ei(g,e){return ge([Lr,e.toBuffer()],g)}var ti=Buffer.from("locked_position","utf8");function on(g,e){return ge([ti,e.toBuffer()],g)}function sn(g,e){return ge([ti,e.toBuffer()],g)}var ul=Buffer.from("support_mint","utf8");import{PublicKey as Se}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as ni}from"@solana/spl-token";import te from"bn.js";import X from"decimal.js";import Fe from"bn.js";import an from"decimal.js";var bt=class{static getfeeGrowthInside(e,t,n){let i=new Fe(0),a=new Fe(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,a=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new Fe(0),r=new Fe(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,r=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),r=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let s=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64A,i),o),l=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64B,a),r);return{feeGrowthInsideX64A:s,feeGrowthInsideBX64:l}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=D.mulDivFloor(D.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,xe),s=t.tokenFeesOwedA.add(r),l=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,xe),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:a,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),r=D.mulDivFloor(D.wrappingSubU128(a,t.feeGrowthInsideLastX64A),t.liquidity,xe),s=t.tokenFeesOwedA.add(r),l=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,xe),p=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:s,tokenFeeAmountB:p}}static GetPositionRewardsV2(e,t,n,i){let a=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=D.wrappingSubU128(s,l.growthInsideLastX64),b=D.mulDivFloor(p,t.liquidity,xe),y=l.rewardAmountOwed.add(b);a.push(y)}return a}static GetPositionRewards(e,t,n,i){let a=[],o=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<o.length;r++){let s=o[r],l=t.rewardInfos[r],p=D.wrappingSubU128(s,l.growthInsideLastX64),b=D.mulDivFloor(p,t.liquidity,xe),y=l.rewardAmountOwed.add(b);a.push(y)}return a}static getRewardGrowthInside(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Fe(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Fe(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(D.wrappingSubU128(D.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getRewardGrowthInsideV2(e,t,n,i){let a=[];for(let o=0;o<i.length;o++){let r=new Fe(0);t.liquidityGross.eqn(0)?r=i[o].rewardGrowthGlobalX64:e<t.tick?r=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):r=t.rewardGrowthsOutsideX64[o];let s=new Fe(0);n.liquidityGross.eqn(0)||(e<n.tick?s=n.rewardGrowthsOutsideX64[o]:s=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),a.push(D.wrappingSubU128(D.wrappingSubU128(i[o].rewardGrowthGlobalX64,r),s))}return a}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:a,epochInfo:o}){var c,d,h,I;let r=V.priceToSqrtPriceX64(new an(e.price),e.mintA.decimals,e.mintB.decimals),s=V.getSqrtPriceX64FromTick(t.tickLower),l=V.getSqrtPriceX64FromTick(t.tickUpper),p=a?1+i:1-i,b=z.getAmountsFromLiquidity(r,s,l,n,a),[y,u]=[se(b.amountA,(c=e.mintA.extensions)==null?void 0:c.feeConfig,o,!0),se(b.amountB,(d=e.mintB.extensions)==null?void 0:d.feeConfig,o,!0)],[k,m]=[se(new Fe(new an(b.amountA.toString()).mul(p).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,o,!0),se(new Fe(new an(b.amountB.toString()).mul(p).toFixed(0)),(I=e.mintB.extensions)==null?void 0:I.feeConfig,o,!0)];return{liquidity:n,amountA:y,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:je(y.expirationTime,u.expirationTime)}}};var Rr=15,U=class{static async getTickArrays(e,t,n,i,a,o,r){let s=[],l=K.getTickArrayStartIndexByTick(i,a),p=K.getInitializedTickArrayInRange(o,r,a,l,Math.floor(Rr/2));for(let u=0;u<p.length;u++){let{publicKey:k}=H(t,n,p[u]);s.push(k)}let b=(await Xe(e,s)).map(u=>u!==null?yt.decode(u.data):null),y={};for(let u=0;u<s.length;u++){let k=b[u];k!==null&&(y[k.startTickIndex]=Y(j({},k),{address:s[u]}))}return y}static nextInitializedTick(e,t,n,i,a,o){let{initializedTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}=this.nextInitializedTickInOneArray(e,t,n,i,a,o);for(;r==null||r.liquidityGross.lten(0);){if(l=K.getNextTickArrayStartIndex(l,a,o),this.checkIsValidStartIndex(l,a))throw new Error("No enough initialized tickArray");let p=n[l];if(p===void 0)continue;let{nextTick:b,tickArrayAddress:y,tickArrayStartTickIndex:u}=this.firstInitializedTickInOneArray(e,t,p,o);[r,s,l]=[b,y,u]}if(r==null)throw new Error("No invaild tickArray cache");return{nextTick:r,tickArrayAddress:s,tickArrayStartTickIndex:l}}static nextInitializedTickArray(e,t,n,i,a){let o=Math.floor(e/U.tickCount(t)),r=n?K.searchLowBitFromStart(i,a,o-1,1,t):K.searchHightBitFromStart(i,a,o+1,1,t);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let a;if(i){let r=me-1;for(;r>=0;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r-1}}else{let r=0;for(;r<me;){let s=n.ticks[r];if(s.liquidityGross.gtn(0)){a=s;break}r=r+1}}let{publicKey:o}=H(e,t,n.startTickIndex);return{nextTick:a,tickArrayAddress:o,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,a,o){let r=K.getTickArrayStartIndexByTick(i,a),s=Math.floor((i-r)/a),l=n[r];if(l==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:r};let p;if(o)for(;s>=0;){let y=l.ticks[s];if(y.liquidityGross.gtn(0)){p=y;break}s=s-1}else for(s=s+1;s<me;){let y=l.ticks[s];if(y.liquidityGross.gtn(0)){p=y;break}s=s+1}let{publicKey:b}=H(e,t,r);return{initializedTick:p,tickArrayAddress:b,tickArrayStartTickIndex:l.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(K.checkIsOutOfBoundary(e)){if(e>we)return!1;let n=K.getTickArrayStartIndexByTick(Pe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return me*e}};var un=14,Ge=class{static maxTickInTickarrayBitmap(e){return e*me*Je}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let a=n*i;return e<0?{minValue:-a,maxValue:-a+n}:{minValue:a,maxValue:a+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let a=this.maxTickInTickarrayBitmap(n),o=i?t-U.tickCount(n):t+U.tickCount(n);if(o<-a||o>=a)return{isInit:!1,tickIndex:t};let r=n*me,s=o/r+512;o<0&&o%r!=0&&s--;let l=Math.abs(s);if(i){let p=e.shln(1024-l-1),b=jn(1024,p);if(b!==null){let y=(l-b-512)*r;return{isInit:!0,tickIndex:y}}else return{isInit:!1,tickIndex:-a}}else{let p=e.shrn(l),b=Zn(1024,p);if(b!==null){let y=(l+b-512)*r;return{isInit:!0,tickIndex:y}}else return{isInit:!1,tickIndex:a-U.tickCount(n)}}}},gt=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Ge.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Ge.maxTickInTickarrayBitmap(e),n=-t;if(we<=t)throw Error(`extensionTickBoundary check error: ${we}, ${t}`);if(n<=Pe)throw Error(`extensionTickBoundary check error: ${n}, ${Pe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),a=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:K.mergeTickArrayBitmap(i).testn(a),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let a=U.tickCount(t),o=n?e-a:e+a,{tickarrayBitmap:r}=this.getBitmap(o,t,i);return this.nextInitializedTickArrayInBitmap(r,o,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:a,maxValue:o}=Ge.getBitmapTickBoundary(t,n),r=this.tickArrayOffsetInBitmap(t,n);if(i){let s=K.mergeTickArrayBitmap(e).shln(Je-1-r),l=ft(512,s)?null:tn(512,s);if(l!==null){let p=t-l*U.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:a}}else{let s=K.mergeTickArrayBitmap(e).shrn(r),l=ft(512,s)?null:nn(512,s);if(l!==null){let p=t+l*U.tickCount(n);return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Ge.maxTickInTickarrayBitmap(t),i=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(i=Je-i),i}};var ae=class{static getOutputAmountAndRemainAccounts(e,t,n,i,a,o=!1){let r=n.toBase58()===e.mintA.address,s=[],{isExist:l,startIndex:p,nextAccountMeta:b}=this.getFirstInitializedTickArray(e,r);if(!l||p===void 0||!b)throw new Error("Invalid tick array");s.push(b);let{allTrade:y,amountCalculated:u,accounts:k,sqrtPriceX64:m,feeAmount:c}=$e.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,r,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,p,a,o);return s.push(...k),{allTrade:y,expectedAmountOut:u.mul(De),remainingAccounts:s,executionPrice:m,feeAmount:c}}static getInputAmountAndRemainAccounts(e,t,n,i,a){let o=n.toBase58()===e.mintB.address,r=[],{isExist:s,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,o);if(!s||l===void 0||!p)throw new Error("Invalid tick array");try{let m=this.preInitializedTickArrayStartIndex(e,o);if(m.isExist){let{publicKey:c}=H(e.programId,e.id,m.nextStartIndex);r.push(c)}}catch{}r.push(p);let{amountCalculated:b,accounts:y,sqrtPriceX64:u,feeAmount:k}=$e.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(De),l,a);return r.push(...y),{expectedAmountIn:b,remainingAccounts:r,executionPrice:u,feeAmount:k}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=ae.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?gt.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):K.checkTickArrayIsInitialized(K.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:r}=H(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:r}}let{isExist:a,nextStartIndex:o}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(a){let{publicKey:r}=H(e.programId,e.id,o);return{isExist:!0,startIndex:o,nextAccountMeta:r}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),i=t?K.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):K.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:a}=Ge.nextInitializedTickArrayStartIndex(K.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:a};t=a;let{isInit:o,tickIndex:r}=gt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(o)return{isExist:!0,nextStartIndex:r};if(t=r,t<Pe||t>we)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:a}){var r,s,l;let o=[];for(let p=0;p<a.length;p++){let b=a[p],y=(l=(r=t.rewardDefaultInfos[p])==null?void 0:r.mint.programId)!=null?l:(s=await e.getAccountInfo(b.tokenMint))==null?void 0:s.owner;if(y===void 0)throw Error("get new reward mint info error");let u=Y(j({},b),{perSecond:D.x64ToDecimal(b.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Se(y)});if(u.tokenMint.equals(Se.default))continue;if(n<=u.openTime.toNumber()||i.eq(ie)){o.push(u);continue}let k=new te(Math.min(u.endTime.toNumber(),n)),m=k.sub(u.lastUpdateTime),c=D.mulDivFloor(m,u.emissionsPerSecondX64,i),d=u.rewardGrowthGlobalX64.add(c),h=D.mulDivFloor(m,u.emissionsPerSecondX64,xe),I=u.rewardTotalEmissioned.add(h);o.push(Y(j({},u),{rewardGrowthGlobalX64:d,rewardTotalEmissioned:I,lastUpdateTime:k}))}return o}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let a of t){let o=K.getTickArrayStartIndexByTick(a,e);if(o>=n||o<i)return!0}return!1}static tickRange(e){let t=Ge.maxTickInTickarrayBitmap(e),n=-t;return t>we&&(t=U.getArrayStartIndex(we,e)+U.tickCount(e)),n<Pe&&(n=U.getArrayStartIndex(Pe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*Je}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await wt(e,t.map(o=>({pubkey:o})),{batchRequest:n}),a={};for(let o of i)o.accountInfo!==null&&(a[o.pubkey.toString()]=ii.decode(o.accountInfo.data));return a}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},a=[];for(let s of t){let l=K.getTickArrayStartIndexByTick(s.tickCurrent,s.tickSpacing),p=K.getInitializedTickArrayInRange(s.tickArrayBitmap,s.exBitmapInfo,s.tickSpacing,l,7);for(let b of p){let{publicKey:y}=H(s.programId,s.id,b);a.push({pubkey:y}),i[y.toString()]=s.id}}let o=await wt(e,a,{batchRequest:n}),r={};for(let s of o){if(!s.accountInfo)continue;let l=i[s.pubkey.toString()];if(!l)continue;r[l.toString()]===void 0&&(r[l.toString()]={});let p=yt.decode(s.accountInfo.data);r[l.toString()][p.startTickIndex]=Y(j({},p),{address:s.pubkey})}return r}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:a=!0}){var r;let o=[];for(let s=0;s<e.length;s++){let l=e[s];l!==null&&(o.find(p=>p.equals(l.state.programId))||o.push(l.state.programId))}if(n){let s=n.tokenAccounts.map(y=>y.accountInfo.mint),l=[];for(let y of s)for(let u of o)l.push(he(u,y).publicKey);let p=await Xe(t,l,{batchRequest:i}),b={};for(let y of p){if(y===null)continue;let u=ln.decode(y.data),k=u.poolId.toString(),m=e.find(C=>C.state.id.toBase58()===k);if(m===void 0)continue;let c=m.state,d=K._getTickPriceLegacy({poolInfo:c,tick:u.tickLower,baseIn:!0}),h=K._getTickPriceLegacy({poolInfo:c,tick:u.tickUpper,baseIn:!0}),{amountA:I,amountB:L}=z.getAmountsFromLiquidity(c.sqrtPriceX64,d.tickSqrtPriceX64,h.tickSqrtPriceX64,u.liquidity,!1),O=1/(1-Math.sqrt(Math.sqrt(d.price.div(h.price).toNumber())));m.positionAccount=[...(r=m.positionAccount)!=null?r:[],{poolId:u.poolId,nftMint:u.nftMint,priceLower:d.price,priceUpper:h.price,amountA:I,amountB:L,tickLower:u.tickLower,tickUpper:u.tickUpper,liquidity:u.liquidity,feeGrowthInsideLastX64A:u.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:u.feeGrowthInsideLastX64B,tokenFeesOwedA:u.tokenFeesOwedA,tokenFeesOwedB:u.tokenFeesOwedB,rewardInfos:u.rewardInfos.map(C=>Y(j({},C),{pendingReward:new te(0)})),leverage:O,tokenFeeAmountA:new te(0),tokenFeeAmountB:new te(0)}];let T=await K.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickLower,m.state.tickSpacing),S=await K.getTickArrayAddressByTick(m.state.programId,u.poolId,u.tickUpper,m.state.tickSpacing);b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickLower}`]=T,b[`${m.state.programId.toString()}-${u.poolId.toString()}-${u.tickUpper}`]=S}if(a){let y=Object.values(b),u=await Xe(t,y,{batchRequest:i}),k={};for(let m=0;m<y.length;m++){let c=u[m];if(c===null)continue;let d=y[m].toString();k[d]=yt.decode(c.data)}for(let{state:m,positionAccount:c}of e)if(!!c)for(let d of c){let h=`${m.programId.toString()}-${m.id.toString()}-${d.tickLower}`,I=`${m.programId.toString()}-${m.id.toString()}-${d.tickUpper}`,L=k[b[h].toString()],O=k[b[I].toString()],T=L.ticks[K.getTickOffsetInArray(d.tickLower,m.tickSpacing)],S=O.ticks[K.getTickOffsetInArray(d.tickUpper,m.tickSpacing)],{tokenFeeAmountA:C,tokenFeeAmountB:_}=await bt.GetPositionFees(m,d,T,S),B=await bt.GetPositionRewards(m,d,T,S);d.tokenFeeAmountA=C.gte(new te(0))?C:new te(0),d.tokenFeeAmountB=_.gte(new te(0))?_:new te(0);for(let v=0;v<B.length;v++)d.rewardInfos[v].pendingReward=B[v].gte(new te(0))?B[v]:new te(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:a,slippage:o,priceLimit:r=new X(0),catchLiquidityInsufficient:s=!1}){var be;let l,p=n.toBase58()===e.mintA.address,[b,y]=p?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];r.equals(new X(0))?l=p?Oe.add(new te(1)):We.sub(new te(1)):l=V.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let u=se(a,b,i,!1),{allTrade:k,expectedAmountOut:m,remainingAccounts:c,executionPrice:d,feeAmount:h}=ae.getOutputAmountAndRemainAccounts(e,t,n,u.amount.sub((be=u.fee)!=null?be:ie),l,s),I=se(m,y,i,!1),L=V.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),O=p?L:new X(1).div(L),T=m.mul(new te(Math.floor((1-o)*1e10))).div(new te(1e10)),S=se(T,y,i,!1),C=p?e.currentPrice:new X(1).div(e.currentPrice),_=new X(O).sub(C).abs(),B=C,v=new ve(new X(_).mul(10**15).toFixed(0),new X(B).mul(10**15).toFixed(0));return{allTrade:k,realAmountIn:u,amountOut:I,minAmountOut:S,expirationTime:je(u.expirationTime,I.expirationTime),currentPrice:e.currentPrice,executionPrice:O,priceImpact:v,fee:h,remainingAccounts:c,executionPriceX64:d}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:a,epochInfo:o,catchLiquidityInsufficient:r=!1}){let s=i.address===e.mintB.address,[l,p]=s?[e.mintA,e.mintB]:[e.mintB,e.mintA],[b,y]=[new Re(Y(j({},l),{mint:l.address,isToken2022:l.programId===ni.toBase58()})),new Re(Y(j({},p),{mint:p.address,isToken2022:p.programId===ni.toBase58()}))],{allTrade:u,realAmountIn:k,amountOut:m,minAmountOut:c,expirationTime:d,currentPrice:h,executionPrice:I,priceImpact:L,fee:O,remainingAccounts:T,executionPriceX64:S}=ae.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Se(l.address),amountIn:n,slippage:a,epochInfo:o,catchLiquidityInsufficient:r}),C=Y(j({},k),{amount:new pe(b,k.amount),fee:k.fee===void 0?void 0:new pe(b,k.fee)}),_=Y(j({},m),{amount:new pe(y,m.amount),fee:m.fee===void 0?void 0:new pe(y,m.fee)}),B=Y(j({},c),{amount:new pe(y,c.amount),fee:c.fee===void 0?void 0:new pe(y,c.fee)}),v=new Ce({baseToken:b,denominator:new te(10).pow(new te(20+b.decimals)),quoteToken:y,numerator:h.mul(new X(10**(20+y.decimals))).toFixed(0)}),be=new Ce({baseToken:b,denominator:new te(10).pow(new te(20+b.decimals)),quoteToken:y,numerator:I.mul(new X(10**(20+y.decimals))).toFixed(0)}),ue=new pe(b,O);return{allTrade:u,realAmountIn:C,amountOut:_,minAmountOut:B,expirationTime:d,currentPrice:v,executionPrice:be,priceImpact:L,fee:ue,remainingAccounts:T,executionPriceX64:S}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:a,slippage:o,priceLimit:r=new X(0)}){var B;let s=n.toBase58()===e.mintA.address,l={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},p;r.equals(new X(0))?p=s?We.sub(new te(1)):Oe.add(new te(1)):p=V.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let b=se(a,l[n.toString()],i,!0),{expectedAmountIn:y,remainingAccounts:u,executionPrice:k,feeAmount:m}=ae.getInputAmountAndRemainAccounts(e,t,n,b.amount.sub((B=b.fee)!=null?B:ie),p),c=s?e.mintB.address:e.mintA.address,d=se(y,l[c],i,!1),h=V.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),I=s?h:new X(1).div(h),L=y.mul(new te(Math.floor((1+o)*1e10))).div(new te(1e10)),O=se(L,l[c],i,!0),T=s?e.currentPrice:new X(1).div(e.currentPrice),S=new X(I).sub(T).abs(),C=T,_=new ve(new X(S).mul(10**15).toFixed(0),new X(C).mul(10**15).toFixed(0));return{amountIn:d,maxAmountIn:O,realAmountOut:b,expirationTime:je(d.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:I,priceImpact:_,fee:m,remainingAccounts:u}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var k,m,c;let a=e[t],o=K.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),r=K.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),s=Math.max(o,a.priceMin),p=Math.min(r,a.priceMax)-s,b=r-o,y=a.priceMax-a.priceMin,u;return p<=0?u=0:b===p?u=y/p:y===p?u=p/b:u=p/y*(p/b),{feeApr:a.feeApr*u,rewardsApr:[((k=a.rewardApr[0])!=null?k:0)*u,((m=a.rewardApr[1])!=null?m:0)*u,((c=a.rewardApr[2])!=null?c:0)*u],apr:a.apr*u}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:a,positionTickLowerIndex:o,positionTickUpperIndex:r,chainTime:s}){let l=n==="day"?1:n==="week"?7:n==="month"?30:0,p=e[n],b=i[at(e.mintA.address).toString()],y=i[at(e.mintB.address).toString()],u=e.mintA.decimals,k=e.mintB.decimals;if(!p||!b||!y)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let m=V.priceToSqrtPriceX64(new X(e.price),e.mintA.decimals,e.mintB.decimals),c=V.getSqrtPriceX64FromTick(o),d=V.getSqrtPriceX64FromTick(r),{amountSlippageA:h,amountSlippageB:I}=z.getAmountsFromLiquidityWithSlippage(m,c,d,t,!1,!1,0),{amountSlippageA:L,amountSlippageB:O}=z.getAmountsFromLiquidityWithSlippage(m,c,d,a,!1,!1,0),T=new X(h.toString()).div(new X(10).pow(u)).mul(b.value).add(new X(I.toString()).div(new X(10).pow(k)).mul(y.value)),S=new X(L.toString()).div(new X(10).pow(u)).mul(b.value).add(new X(O.toString()).div(new X(10).pow(k)).mul(y.value)),C=new X(1).div(T.add(S)),B=new X(p.volumeFee).mul(365).div(l).mul(C).mul(100).toNumber(),v=3600*24*365,be=e.rewardDefaultInfos.map(ue=>{var kn,Pn;let Te=ue.mint.decimals,nt=i[ue.mint.address];return s<((kn=ue.startTime)!=null?kn:0)||s>((Pn=ue.endTime)!=null?Pn:0)||!ue.perSecond||!nt||Te===void 0?0:new X(nt.value).mul(new X(ue.perSecond).mul(v)).div(new X(10).pow(Te)).mul(C).mul(100).toNumber()});return{feeApr:B,rewardsApr:be,apr:B+be.reduce((ue,Te)=>ue+Te,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:a,slippage:o,add:r,epochInfo:s,amountHasFee:l}){var d,h;let p=V.priceToSqrtPriceX64(new X(e.price),e.mintA.decimals,e.mintB.decimals),b=V.getSqrtPriceX64FromTick(n),y=V.getSqrtPriceX64FromTick(i),u=se(a,(d=e[t?"mintA":"mintB"].extensions)==null?void 0:d.feeConfig,s,!l),k=new te(new X(u.amount.sub((h=u.fee)!=null?h:ie).toString()).toFixed(0)),m;if(p.lte(b))m=t?z.getLiquidityFromTokenAmountA(b,y,k,!r):new te(0);else if(p.lte(y)){let I=z.getLiquidityFromTokenAmountA(p,y,k,!r),L=z.getLiquidityFromTokenAmountB(b,p,k);m=t?I:L}else m=t?new te(0):z.getLiquidityFromTokenAmountB(b,y,k);let c=await ae.getAmountsFromLiquidity({epochInfo:s,poolInfo:e,tickLower:n,tickUpper:i,liquidity:m,slippage:o,add:r});return{liquidity:m,amountA:t?u:c.amountA,amountB:t?c.amountB:u,amountSlippageA:t?u:c.amountSlippageA,amountSlippageB:t?c.amountSlippageB:u,expirationTime:c.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:a,slippage:o,add:r}){var c,d,h,I;let s=V.getSqrtPriceX64FromTick(n),l=V.getSqrtPriceX64FromTick(i),p=r?1+o:1-o,b=z.getAmountsFromLiquidity(V.priceToSqrtPriceX64(new X(t.price),t.mintA.decimals,t.mintB.decimals),s,l,a,r),[y,u]=[se(b.amountA,(c=t.mintA.extensions)==null?void 0:c.feeConfig,e,!0),se(b.amountB,(d=t.mintB.extensions)==null?void 0:d.feeConfig,e,!0)],[k,m]=[se(b.amountA.muln(p),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),se(b.amountB.muln(p),(I=t.mintB.extensions)==null?void 0:I.feeConfig,e,!0)];return{liquidity:a,amountA:y,amountB:u,amountSlippageA:k,amountSlippageB:m,expirationTime:je(y.expirationTime,u.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(s=>!n[s.id]).map(s=>new Se(s.id));(await Xe(e,i)).forEach((s,l)=>{!s||(n[i[l].toBase58()]=cn.decode(s.data))});let o=t.map(s=>le(new Se(s.programId),new Se(s.id)).publicKey),r=await ae.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((s,l)=>Y(j({},s),{[l.id]:Y(j({},n[l.id]),{id:new Se(l.id),version:6,programId:new Se(l.programId),mintA:l.mintA,mintB:l.mintB,ammConfig:Y(j({},l.config),{id:new Se(l.config.id),fundOwner:""}),currentPrice:new X(l.price),exBitmapAccount:le(new Se(l.programId),new Se(l.id)).publicKey,exBitmapInfo:r[le(new Se(l.programId),new Se(l.id)).publicKey.toBase58()],startTime:n[l.id].startTime.toNumber(),rewardInfos:n[l.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var D=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),a=i.div(n);return i.mod(n).eq(ie)||(a=a.add(Ie)),a}static mulDivFloor(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).add(n.sub(Ie)).div(n)}static x64ToDecimal(e,t){return new Ee(e.toString()).div(Ee.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new q(e.mul(Ee.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Nt).sub(t).mod(Nt)}};function fe(g,e){return mn(g.mul(e),64,256)}function Nr(g,e,t){let n=g.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function mn(g,e,t){let n=g.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var V=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(Ee.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(Ee.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(ie))return e;let a=t.shln(dt);if(i){let o=a,r=a.add(n.mul(e));return r.gte(o)?D.mulDivCeil(o,e,r):D.mulDivRoundingUp(o,Ie,o.div(e).add(n))}else{let o=n.mul(e);if(!a.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let r=a.sub(o);return D.mulDivCeil(a,e,r)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let a=n.shln(dt);if(i)return e.add(a.div(t));{let o=D.mulDivRoundingUp(a,Ie,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Pe||e>we)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new q("18445821805675395072"):new q("18446744073709551616");return(t&2)!=0&&(n=fe(n,new q("18444899583751176192"))),(t&4)!=0&&(n=fe(n,new q("18443055278223355904"))),(t&8)!=0&&(n=fe(n,new q("18439367220385607680"))),(t&16)!=0&&(n=fe(n,new q("18431993317065453568"))),(t&32)!=0&&(n=fe(n,new q("18417254355718170624"))),(t&64)!=0&&(n=fe(n,new q("18387811781193609216"))),(t&128)!=0&&(n=fe(n,new q("18329067761203558400"))),(t&256)!=0&&(n=fe(n,new q("18212142134806163456"))),(t&512)!=0&&(n=fe(n,new q("17980523815641700352"))),(t&1024)!=0&&(n=fe(n,new q("17526086738831433728"))),(t&2048)!=0&&(n=fe(n,new q("16651378430235570176"))),(t&4096)!=0&&(n=fe(n,new q("15030750278694412288"))),(t&8192)!=0&&(n=fe(n,new q("12247334978884435968"))),(t&16384)!=0&&(n=fe(n,new q("8131365268886854656"))),(t&32768)!=0&&(n=fe(n,new q("3584323654725218816"))),(t&65536)!=0&&(n=fe(n,new q("696457651848324352"))),(t&131072)!=0&&(n=fe(n,new q("26294789957507116"))),(t&262144)!=0&&(n=fe(n,new q("37481735321082"))),e>0&&(n=Un.div(n)),n}static getTickFromPrice(e,t,n){return V.getTickFromSqrtPriceX64(V.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(We)||e.lt(Oe))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new q(t-64),i=Nr(n,32,128),a=new q("8000000000000000","hex"),o=0,r=new q(0),s=t>=64?e.shrn(t-63):e.shln(63-t);for(;a.gt(new q(0))&&o<Xn;){s=s.mul(s);let k=s.shrn(127);s=s.shrn(63+k.toNumber()),r=r.add(a.mul(k)),a=a.shrn(1),o+=1}let l=r.shrn(32),b=i.add(l).mul(new q(zn)),y=mn(b.sub(new q(Qn)),64,128).toNumber(),u=mn(b.add(new q(Hn)),64,128).toNumber();return y==u?y:V.getSqrtPriceX64FromTick(u).lte(e)?u:y}},et=class{static getTickWithPriceAndTickspacing(e,t,n,i){let o=V.getTickFromSqrtPriceX64(V.priceToSqrtPriceX64(e,n,i))/t;return o<0?o=Math.floor(o):o=Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,i){let a=et.getTickWithPriceAndTickspacing(e,t,n,i),o=V.getSqrtPriceX64FromTick(a);return V.sqrtPriceX64ToPrice(o,n,i)}},z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");let a=n.ushln(dt),o=t.sub(e);return i?D.mulDivRoundingUp(D.mulDivCeil(a,o,t),Ie,e):D.mulDivFloor(a,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");return i?D.mulDivCeil(n,t.sub(e),xe):D.mulDivFloor(n,t.sub(e),xe)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let a=n.mul(e).mul(t),o=t.sub(e),r=a.div(o);return i?D.mulDivRoundingUp(r,Ie,en):r.shrn(dt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),D.mulDivFloor(n,en,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return z.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let o=z.getLiquidityFromTokenAmountA(e,n,i,!1),r=z.getLiquidityFromTokenAmountB(t,e,a);return o.lt(r)?o:r}else return z.getLiquidityFromTokenAmountB(t,n,a)}static getAmountsFromLiquidity(e,t,n,i,a){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:z.getTokenAmountAFromLiquidity(t,n,i,a),amountB:new q(0)};if(e.lt(n)){let o=z.getTokenAmountAFromLiquidity(e,n,i,a),r=z.getTokenAmountBFromLiquidity(t,e,i,a);return{amountA:o,amountB:r}}else return{amountA:new q(0),amountB:z.getTokenAmountBFromLiquidity(t,n,i,a)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,a,o,r){let{amountA:s,amountB:l}=z.getAmountsFromLiquidity(e,t,n,i,o),p=a?1+r:1-r,b=new q(new Ee(s.toString()).mul(p).toFixed(0)),y=new q(new Ee(l.toString()).mul(p).toFixed(0));return{amountSlippageA:b,amountSlippageB:y}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:a,add:o,epochInfo:r,amountAddFee:s}){var h,I,L,O;let l=V.priceToSqrtPriceX64(new Ee(e.price),e.mintA.decimals,e.mintB.decimals),p=V.getSqrtPriceX64FromTick(t),b=V.getSqrtPriceX64FromTick(n),y=o?1+a:1-a,u=z.getAmountsFromLiquidity(l,p,b,i,o),[k,m]=[se(u.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,r,s),se(u.amountB,(I=e.mintB.extensions)==null?void 0:I.feeConfig,r,s)],[c,d]=[se(new q(new Ee(u.amountA.toString()).mul(y).toFixed(0)),(L=e.mintA.extensions)==null?void 0:L.feeConfig,r,s),se(new q(new Ee(u.amountB.toString()).mul(y).toFixed(0)),(O=e.mintB.extensions)==null?void 0:O.feeConfig,r,s)];return{liquidity:i,amountA:k,amountB:m,amountSlippageA:c,amountSlippageB:d,expirationTime:je(k.expirationTime,m.expirationTime)}}},$e=class{static swapCompute(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m=!1){if(y.eq(ie))throw new Error("amountSpecified must not be 0");if(k||(k=o?Oe.add(Ie):We.sub(Ie)),o){if(k.lt(Oe))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(k.gte(b))throw new Error("sqrtPriceX64 must smaller than current")}else{if(k.gt(We))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(k.lte(b))throw new Error("sqrtPriceX64 must greater than current")}let c=y.gt(ie),d={amountSpecifiedRemaining:y,amountCalculated:ie,sqrtPriceX64:b,tick:l>u?Math.min(u+U.tickCount(p)-1,l):u,accounts:[],liquidity:s,feeAmount:new q(0)},h=u,I=n[u],L=0,O=!o&&I.startTickIndex===d.tick;for(;!d.amountSpecifiedRemaining.eq(ie)&&!d.sqrtPriceX64.eq(k);){L>10;let T={};T.sqrtPriceStartX64=d.sqrtPriceX64;let S=K.nextInitTick(I,d.tick,p,o,O),C=S||null,_=null;if(!(C!=null&&C.liquidityGross.gtn(0))){let v=ae.nextInitializedTickArrayStartIndex({tickCurrent:d.tick,tickSpacing:p,tickArrayBitmap:i,exBitmapInfo:a},h,o);if(!v.isExist){if(m)return{allTrade:!1,amountSpecifiedRemaining:d.amountSpecifiedRemaining,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts};throw Error("swapCompute LiquidityInsufficient")}h=v.nextStartIndex;let{publicKey:be}=H(e,t,h);_=be,I=n[h];try{C=K.firstInitializedTick(I,o)}catch{throw Error("not found next tick info")}}T.tickNext=C.tick,T.initialized=C.liquidityGross.gtn(0),u!==h&&_&&(d.accounts.push(_),u=h),T.tickNext<Pe?T.tickNext=Pe:T.tickNext>we&&(T.tickNext=we),T.sqrtPriceNextX64=V.getSqrtPriceX64FromTick(T.tickNext);let B;if(o&&T.sqrtPriceNextX64.lt(k)||!o&&T.sqrtPriceNextX64.gt(k)?B=k:B=T.sqrtPriceNextX64,[d.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=$e.swapStepCompute(d.sqrtPriceX64,B,d.liquidity,d.amountSpecifiedRemaining,r,o),d.feeAmount=d.feeAmount.add(T.feeAmount),c?(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),d.amountCalculated=d.amountCalculated.sub(T.amountOut)):(d.amountSpecifiedRemaining=d.amountSpecifiedRemaining.add(T.amountOut),d.amountCalculated=d.amountCalculated.add(T.amountIn.add(T.feeAmount))),d.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let v=C.liquidityNet;o&&(v=v.mul(De)),d.liquidity=z.addDelta(d.liquidity,v)}O=T.tickNext!=d.tick&&!o&&I.startTickIndex===T.tickNext,d.tick=o?T.tickNext-1:T.tickNext}else if(d.sqrtPriceX64!=T.sqrtPriceStartX64){let v=V.getTickFromSqrtPriceX64(d.sqrtPriceX64);O=v!=d.tick&&!o&&I.startTickIndex===v,d.tick=v}++L}try{let{nextStartIndex:T,isExist:S}=U.nextInitializedTickArray(d.tick,p,o,i,a);S&&u!==T&&(d.accounts.push(H(e,t,T).publicKey),u=T)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ie,amountCalculated:d.amountCalculated,feeAmount:d.feeAmount,sqrtPriceX64:d.sqrtPriceX64,liquidity:d.liquidity,tickCurrent:d.tick,accounts:d.accounts}}static swapStepCompute(e,t,n,i,a,o){let r={sqrtPriceX64Next:new q(0),amountIn:new q(0),amountOut:new q(0),feeAmount:new q(0)},s=i.gte(ie);if(s){let p=D.mulDivFloor(i,Wt.sub(new q(a.toString())),Wt);r.amountIn=o?z.getTokenAmountAFromLiquidity(t,e,n,!0):z.getTokenAmountBFromLiquidity(e,t,n,!0),p.gte(r.amountIn)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=V.getNextSqrtPriceX64FromInput(e,n,p,o)}else r.amountOut=o?z.getTokenAmountBFromLiquidity(t,e,n,!1):z.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(De).gte(r.amountOut)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=V.getNextSqrtPriceX64FromOutput(e,n,i.mul(De),o);let l=t.eq(r.sqrtPriceX64Next);return o?(l&&s||(r.amountIn=z.getTokenAmountAFromLiquidity(r.sqrtPriceX64Next,e,n,!0)),l&&!s||(r.amountOut=z.getTokenAmountBFromLiquidity(r.sqrtPriceX64Next,e,n,!1))):(r.amountIn=l&&s?r.amountIn:z.getTokenAmountBFromLiquidity(e,r.sqrtPriceX64Next,n,!0),r.amountOut=l&&!s?r.amountOut:z.getTokenAmountAFromLiquidity(e,r.sqrtPriceX64Next,n,!1)),!s&&r.amountOut.gt(i.mul(De))&&(r.amountOut=i.mul(De)),s&&!r.sqrtPriceX64Next.eq(t)?r.feeAmount=i.sub(r.amountIn):r.feeAmount=D.mulDivCeil(r.amountIn,new q(a),Wt.sub(new q(a))),[r.sqrtPriceX64Next,r.amountIn,r.amountOut,r.feeAmount]}};var me=60,Je=512,K=class{static getTickArrayAddressByTick(e,t,n,i){let a=K.getTickArrayStartIndexByTick(n,i),{publicKey:o}=H(e,t,a);return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=K.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=me)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*me,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*me,a=Math.floor(t/i)+512,o=Math.abs(a);return{isInitialized:e.testn(o),startIndex:(o-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*me:e+t*me}static mergeTickArrayBitmap(e){let t=new Mr(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,a){let o=Math.floor(i/(n*me));return[...K.searchLowBitFromStart(e,t,o-1,a,n),...K.searchHightBitFromStart(e,t,o,a,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return K.searchHightBitFromStart(e,t,-7680,Je,n)}static getAllInitializedTickArrayInfo(e,t,n,i,a){let o=[],r=K.getAllInitializedTickArrayStartIndex(n,i,a);for(let s of r){let{publicKey:l}=H(e,t,s);o.push({tickArrayStartIndex:s,tickArrayAddress:l})}return o}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>K.mergeTickArrayBitmap(l)),r=[];for(;n>=-7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n--,r.length===i)break}let s=U.tickCount(a);return r.map(l=>l*s)}static searchHightBitFromStart(e,t,n,i,a){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>K.mergeTickArrayBitmap(l)),r=[];for(;n<7680;){let l=Math.floor((n+7680)/512),p=(n+7680)%512;if(o[l].testn(p)&&r.push(n),n++,r.length===i)break}let s=U.tickCount(a);return r.map(l=>l*s)}static checkIsOutOfBoundary(e){return e<Pe||e>we}static nextInitTick(e,t,n,i,a){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let r=Math.floor((t-e.startTickIndex)/n);if(i)for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r-1}else for(a||(r=r+1);r<me;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r+1}return null}static firstInitializedTick(e,t){if(t){let n=me-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<me;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=V.getSqrtPriceX64FromTick(t),a=V.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new st(1).div(a),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new st(1).div(t),a=et.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=V.getSqrtPriceX64FromTick(a),r=V.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new st(1).div(r)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=V.getSqrtPriceX64FromTick(t),a=V.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:a,tickSqrtPriceX64:i}:{tick:t,price:new st(1).div(a),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new st(1).div(t),a=et.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=V.getSqrtPriceX64FromTick(a),r=V.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:a,price:r}:{tick:a,price:new st(1).div(r)}}};var Or=W([ke(8),E("bump"),Ye("index"),x(""),rt("protocolFeeRate"),rt("tradeFeeRate"),Ye("tickSpacing"),G(P(),8,"")]),Wr=W([rt("blockTimestamp"),qn("tickCumulative"),G(P(),4)]),ri=W([ke(8),de("initialized"),P("recentEpoch"),Ye("observationIndex"),x("poolId"),G(Wr,100,"observations"),G(P(),4)]),Fr=W([E("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),F("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),x("tokenMint"),x("tokenVault"),x("creator"),F("rewardGrowthGlobalX64")]),cn=W([ke(8),E("bump"),x("ammConfig"),x("creator"),x("mintA"),x("mintB"),x("vaultA"),x("vaultB"),x("observationId"),E("mintDecimalsA"),E("mintDecimalsB"),Ye("tickSpacing"),F("liquidity"),F("sqrtPriceX64"),ee("tickCurrent"),rt(),F("feeGrowthGlobalX64A"),F("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),F("swapInAmountTokenA"),F("swapOutAmountTokenB"),F("swapInAmountTokenB"),F("swapOutAmountTokenA"),E("status"),G(E(),7,""),G(Fr,3,"rewardInfos"),G(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),G(P(),15*4-3,"padding")]),Er=W([F("growthInsideLastX64"),P("rewardAmountOwed")]),ln=W([ke(8),E("bump"),x("nftMint"),x("poolId"),ee("tickLower"),ee("tickUpper"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),G(Er,3,"rewardInfos"),G(P(),8,"")]),ym=W([ke(8),E("bump"),x("poolId"),ee("tickLowerIndex"),ee("tickUpperIndex"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),G(F(),3,"rewardGrowthInside"),G(P(),8,"")]),Vr=W([ee("tick"),Gn("liquidityNet"),F("liquidityGross"),F("feeGrowthOutsideX64A"),F("feeGrowthOutsideX64B"),G(F(),3,"rewardGrowthsOutsideX64"),G(rt(),13,"")]),yt=W([ke(8),x("poolId"),ee("startTickIndex"),G(Vr,me,"ticks"),E("initializedTickCount"),G(E(),115,"")]),vr=W([ke(329),G(x(),100,"whitelistMints")]),ii=W([ke(8),x("poolId"),G(G(P(),8),un,"positiveTickArrayBitmap"),G(G(P(),8),un,"negativeTickArrayBitmap")]),gm=W([P(),E("bump"),x("owner"),x("poolId"),x("positionId"),x("nftAccount"),G(P(),8)]),_r=W([ke(8),E("bump"),x("lockOwner"),x("poolId"),x("positionId"),x("nftAccount"),x("lockNftMint"),P("recentEpoch"),G(P(),8)]);ri.span;var oi=ce("Raydium_Clmm"),Ke={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},si=[188,37,179,131,82,150,84,73],ai=[16,72,250,198,14,162,212,19],tt=class{static createPoolInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k){let m=W([F("sqrtPriceX64"),P("zero")]),c=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1},{pubkey:Me,isSigner:!1,isWritable:!1},...(k==null?void 0:k.map(I=>({pubkey:I,isSigner:!1,isWritable:!1})))||[]],d=Buffer.alloc(m.span);m.encode({sqrtPriceX64:u,zero:ie},d);let h=Buffer.from([...Ke.createPool,...d]);return new ye({keys:c,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:a,ammConfigId:o,initialPriceX64:r,extendMintAccount:s}=e,[l,p]=[new w(i.address),new w(a.address)],{publicKey:b}=Jn(t,o,l,p),{publicKey:y}=ei(t,b),{publicKey:u}=rn(t,b,l),{publicKey:k}=rn(t,b,p),m=le(t,b).publicKey,c=[this.createPoolInstruction(t,b,n,o,y,l,u,new w(i.programId||Z),p,k,new w(a.programId||Z),m,r,s)];return{signers:[],instructions:c,instructionTypes:[J.CreateAccount,J.ClmmCreatePool],address:{poolId:b,observationId:y,exBitmapAccount:m,mintAVault:u,mintBVault:k},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,I,L,O,T,S,C,_,B){let v=W([ee("tickLowerIndex"),ee("tickUpperIndex"),ee("tickArrayLowerStartIndex"),ee("tickArrayUpperStartIndex"),F("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),E("optionBaseFlag"),de("baseFlag")]),be=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],ue=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...be],Te=Buffer.alloc(v.span);v.encode({tickLowerIndex:h,tickUpperIndex:I,tickArrayLowerStartIndex:L,tickArrayUpperStartIndex:O,liquidity:T,amountMaxA:S,amountMaxB:C,withMetadata:_==="create",baseFlag:!1,optionBaseFlag:0},Te);let nt=Buffer.from([...Ke.openPosition,...Te]);return new ye({keys:ue,programId:e,data:nt})}static openPositionFromLiquidityInstruction22(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,I,L,O,T,S,C,_){let B=W([ee("tickLowerIndex"),ee("tickUpperIndex"),ee("tickArrayLowerStartIndex"),ee("tickArrayUpperStartIndex"),F("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),E("optionBaseFlag"),de("baseFlag")]),v=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],be=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...v],ue=Buffer.alloc(B.span);B.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:L,liquidity:O,amountMaxA:T,amountMaxB:S,withMetadata:C==="create",baseFlag:!1,optionBaseFlag:0},ue);let Te=Buffer.from([...Ke.openPositionWithTokenEx,...ue]);return new ye({keys:be,programId:e,data:Te})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let y=[],[u,k]=[new w(e.programId),new w(e.id)],m;if(p)m=new w((await p(1))[0]);else{let _=Vt.generate();y.push(_),m=_.publicKey}let c=K.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=H(u,k,c),{publicKey:I}=H(u,k,d),{publicKey:L}=b?$(n.wallet,m,oe):$(n.wallet,m,Z),{publicKey:O}=ot(m),{publicKey:T}=he(u,m),{publicKey:S}=qe(u,k,i,a),C=b?this.openPositionFromLiquidityInstruction22(u,n.feePayer,k,n.wallet,m,L,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(e.mintA.address),new w(e.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0):this.openPositionFromLiquidityInstruction(u,n.feePayer,k,n.wallet,m,L,O,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(e.mintA.address),new w(e.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0);return{signers:y,instructions:[C],instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:m,tickArrayLower:h,tickArrayUpper:I,positionNftAccount:L,metadataAccount:O,personalPosition:T,protocolPosition:S}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,base:o,baseAmount:r,otherAmountMax:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let y=[],[u,k]=[new w(e.programId),new w(e.id)],m;if(p)m=new w((await p(1))[0]);else{let _=Vt.generate();y.push(_),m=_.publicKey}let c=K.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=H(u,k,c),{publicKey:I}=H(u,k,d),{publicKey:L}=b?$(n.wallet,m,oe):$(n.wallet,m,Z),{publicKey:O}=ot(m),{publicKey:T}=he(u,m),{publicKey:S}=qe(u,k,i,a),C=b?this.openPositionFromBaseInstruction22(u,n.feePayer,k,n.wallet,m,L,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(e.mintA.address),new w(e.mintB.address),i,a,c,d,l,o,r,s,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0):this.openPositionFromBaseInstruction(u,n.feePayer,k,n.wallet,m,L,O,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(e.mintA.address),new w(e.mintB.address),i,a,c,d,l,o,r,s,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(u,k).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:h,tickArrayUpper:I,positionNftAccount:L,metadataAccount:O,personalPosition:T,protocolPosition:S},instructions:[C],signers:y,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,I,L,O,T,S,C,_,B){let v=W([ee("tickLowerIndex"),ee("tickUpperIndex"),ee("tickArrayLowerStartIndex"),ee("tickArrayUpperStartIndex"),F("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),E("optionBaseFlag"),de("baseFlag")]),be=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],ue=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},...be],Te=Buffer.alloc(v.span);v.encode({tickLowerIndex:h,tickUpperIndex:I,tickArrayLowerStartIndex:L,tickArrayUpperStartIndex:O,liquidity:new pn(0),amountMaxA:S==="MintA"?C:_,amountMaxB:S==="MintA"?_:C,withMetadata:T==="create",baseFlag:S==="MintA",optionBaseFlag:1},Te);let nt=Buffer.from([...Ke.openPosition,...Te]);return new ye({keys:ue,programId:e,data:nt})}static openPositionFromBaseInstruction22(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,I,L,O,T,S,C,_){let B=W([ee("tickLowerIndex"),ee("tickUpperIndex"),ee("tickArrayLowerStartIndex"),ee("tickArrayUpperStartIndex"),F("liquidity"),P("amountMaxA"),P("amountMaxB"),de("withMetadata"),E("optionBaseFlag"),de("baseFlag")]),v=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],be=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...v],ue=Buffer.alloc(B.span);B.encode({tickLowerIndex:d,tickUpperIndex:h,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:L,liquidity:new pn(0),amountMaxA:T==="MintA"?S:C,amountMaxB:T==="MintA"?C:S,withMetadata:O==="create",baseFlag:T==="MintA",optionBaseFlag:1},ue);let Te=Buffer.from([...Ke.openPositionWithTokenEx,...ue]);return new ye({keys:be,programId:e,data:Te})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:a,liquidity:o,amountMaxA:r,amountMaxB:s,withMetadata:l,getEphemeralSigners:p,nft2022:b}){let y,u=[];if(p)y=new w((await p(1))[0]);else{let _=Vt.generate();u.push(_),y=_.publicKey}let[k,m]=[new w(e.programId),new w(e.id)],c=K.getTickArrayStartIndexByTick(i,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(a,e.config.tickSpacing),{publicKey:h}=H(k,m,c),{publicKey:I}=H(k,m,d),{publicKey:L}=b?$(n.wallet,y,oe):$(n.wallet,y,Z),{publicKey:O}=ot(y),{publicKey:T}=he(k,y),{publicKey:S}=qe(k,m,i,a),C=b?this.openPositionFromLiquidityInstruction22(k,n.wallet,m,n.wallet,y,L,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(t.mintA.address),new w(t.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(k,m).publicKey:void 0):this.openPositionFromLiquidityInstruction(k,n.wallet,m,n.wallet,y,L,O,S,h,I,T,n.tokenAccountA,n.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(t.mintA.address),new w(t.mintB.address),i,a,c,d,o,r,s,l,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,d])?le(k,m).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:h,tickArrayUpper:I,positionNftAccount:L,metadataAccount:O,personalPosition:T,protocolPosition:S},instructions:[C],signers:u,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,a,o){let r=W([]),s=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:Ue.programId,isSigner:!1,isWritable:!1},{pubkey:o?oe:Z,isSigner:!1,isWritable:!1}],l=Buffer.alloc(r.span);r.encode({},l);let p=Buffer.from([...Ke.closePosition,...l]);return new ye({keys:s,programId:e,data:p})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:a}){let o=new w(e.programId),r=a?$(n.wallet,i.nftMint,oe).publicKey:$(n.wallet,i.nftMint,Z).publicKey,{publicKey:s}=he(o,i.nftMint),l=[];return l.push(this.closePositionInstruction(o,n.wallet,i.nftMint,r,s,a)),{address:{positionNftAccount:r,personalPosition:s},signers:[],instructions:l,instructionTypes:[J.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h){let I=W([F("liquidity"),P("amountMaxA"),P("amountMaxB"),E("optionBaseFlag"),de("baseFlag")]),L=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],O=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...L],T=Buffer.alloc(I.span);I.encode({liquidity:m,amountMaxA:c,amountMaxB:d,optionBaseFlag:0,baseFlag:!1},T);let S=Buffer.from([...Ke.increaseLiquidity,...T]);return new ye({keys:O,programId:e,data:S})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMaxA:o,amountMaxB:r,nft2022:s}){let[l,p]=[new w(e.programId),new w(e.id)],b=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=H(l,p,b),{publicKey:k}=H(l,p,y),{publicKey:m}=s?$(i.wallet,n.nftMint,oe):$(i.wallet,n.nftMint,Z),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=qe(l,p,n.tickLower,n.tickUpper),h=this.increasePositionFromLiquidityInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(e.mintA.address),new w(e.mintB.address),a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?le(l,p).publicKey:void 0);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},signers:[],instructions:[h],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:a,baseAmount:o,otherAmountMax:r,nft2022:s}){let[l,p]=[new w(e.programId),new w(e.id)],b=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:u}=H(l,p,b),{publicKey:k}=H(l,p,y),{publicKey:m}=s?$(i.wallet,n.nftMint,oe):$(i.wallet,n.nftMint,Z),{publicKey:c}=he(l,n.nftMint),{publicKey:d}=qe(l,p,n.tickLower,n.tickUpper);return{address:{tickArrayLower:u,tickArrayUpper:k,positionNftAccount:m,personalPosition:c,protocolPosition:d},instructions:[this.increasePositionFromBaseInstruction(l,i.wallet,m,c,p,d,u,k,i.tokenAccountA,i.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(e.mintA.address),new w(e.mintB.address),a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?le(l,p).publicKey:void 0)],signers:[],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h){let I=W([F("liquidity"),P("amountMaxA"),P("amountMaxB"),E("optionBaseFlag"),de("baseFlag")]),L=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],O=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...L],T=Buffer.alloc(I.span);I.encode({liquidity:new pn(0),amountMaxA:m==="MintA"?c:d,amountMaxB:m==="MintA"?d:c,baseFlag:m==="MintA",optionBaseFlag:1},T);let S=Buffer.from([...Ke.increaseLiquidity,...T]);return new ye({keys:O,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d,h,I){let L=W([F("liquidity"),P("amountMinA"),P("amountMinB")]),O=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[],...m.map(_=>[{pubkey:_.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...O],S=Buffer.alloc(L.span);L.encode({liquidity:c,amountMinA:d,amountMinB:h},S);let C=Buffer.from([...Ke.decreaseLiquidity,...S]);return new ye({keys:T,programId:e,data:C})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:a,amountMinA:o,amountMinB:r,programId:s,nft2022:l}){let[p,b]=[new w(e.programId),new w(e.id)],y=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),u=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:k}=H(p,b,y),{publicKey:m}=H(p,b,u),{publicKey:c}=l?$(i.wallet,n.nftMint,oe):$(i.wallet,n.nftMint,s),{publicKey:d}=he(p,n.nftMint),{publicKey:h}=qe(p,b,n.tickLower,n.tickUpper),I=[];for(let T=0;T<e.rewardDefaultInfos.length;T++)I.push({poolRewardVault:new w(t.rewardInfos[T].vault),ownerRewardVault:i.rewardAccounts[T],rewardMint:new w(e.rewardDefaultInfos[T].mint.address)});let L=[],O=this.decreaseLiquidityInstruction(p,i.wallet,c,d,b,h,k,m,i.tokenAccountA,i.tokenAccountB,new w(t.vault.A),new w(t.vault.B),new w(e.mintA.address),new w(e.mintB.address),I,a,o,r,ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,u])?le(p,b).publicKey:void 0);return L.push(O),{address:{tickArrayLower:k,tickArrayUpper:m,positionNftAccount:c,personalPosition:d,protocolPosition:h},signers:[],instructions:L,instructionTypes:[J.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,a,o,r,s,l,p,b,y,u,k,m,c,d){let h=W([P("amount"),P("otherAmountThreshold"),F("sqrtPriceLimitX64"),de("isBaseInput")]),I=[...d?[{pubkey:d,isSigner:!1,isWritable:!0}]:[],...b.map(S=>({pubkey:S,isSigner:!1,isWritable:!0}))],L=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...I],O=Buffer.alloc(h.span);h.encode({amount:u,otherAmountThreshold:k,sqrtPriceLimitX64:m,isBaseInput:c},O);let T=Buffer.from([...Ke.swap,...O]);return new ye({keys:L,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:a,amountIn:o,amountOutMin:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new w(e.programId),new w(e.id)],[y,u]=[new w(t.vault.A),new w(t.vault.B)],[k,m]=[new w(e.mintA.address),new w(e.mintB.address)],c=e.mintA.address===a.toString(),d=[this.swapInstruction(p,i.wallet,b,new w(e.config.id),c?i.tokenAccountA:i.tokenAccountB,c?i.tokenAccountB:i.tokenAccountA,c?y:u,c?u:y,c?k:m,c?m:k,l,n,o,r,s,!0,le(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[J.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:a,amountOut:o,amountInMax:r,sqrtPriceLimitX64:s,remainingAccounts:l}){let[p,b]=[new w(e.programId),new w(e.id)],[y,u]=[new w(t.vault.A),new w(t.vault.B)],[k,m]=[new w(e.mintA.address),new w(e.mintB.address)],c=e.mintA.address===a.toBase58(),d=[this.swapInstruction(p,i.wallet,b,new w(e.config.id),c?i.tokenAccountB:i.tokenAccountA,c?i.tokenAccountA:i.tokenAccountB,c?u:y,c?y:u,c?m:k,c?k:m,l,n,o,r,s,!1,le(p,b).publicKey)];return{signers:[],instructions:d,instructionTypes:[J.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,y){let u=W([P("openTime"),P("endTime"),F("emissionsPerSecondX64")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1},{pubkey:Me,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({openTime:re(p),endTime:re(b),emissionsPerSecondX64:y},m);let c=Buffer.from([...Ke.initReward,...m]);return new ye({keys:k,programId:e,data:c})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new w(e.programId),new w(e.id)],r=$n(a,o,i.mint).publicKey,s=Et(a).publicKey,l=[this.initRewardInstruction(a,n.wallet,o,s,new w(e.config.id),n.tokenAccount,i.programId,i.mint,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:r,operationId:s},signers:[],instructions:l,instructionTypes:[J.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,a,o,r,s,l,p,b,y){let u=W([E("rewardIndex"),F("emissionsPerSecondX64"),P("openTime"),P("endTime")]),k=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0}],m=Buffer.alloc(u.span);u.encode({rewardIndex:l,emissionsPerSecondX64:y,openTime:re(p),endTime:re(b)},m);let c=Buffer.from([...Ke.setRewardEmissions,...m]);return new ye({keys:k,programId:e,data:c})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[a,o]=[new w(e.programId),new w(e.id)],r,s,l;for(let y=0;y<e.rewardDefaultInfos.length;y++)e.rewardDefaultInfos[y].mint.address===i.mint.toString()&&(r=y,s=new w(t.rewardInfos[y].vault),l=new w(t.rewardInfos[y].mint.address));(r===void 0||s===void 0)&&oi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let p=Et(a).publicKey,b=[this.setRewardInstruction(a,n.wallet,o,p,new w(e.config.id),n.tokenAccount,s,l,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:s,operationId:p},signers:[],instructions:b,instructionTypes:[J.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,a,o,r){let s=W([E("rewardIndex")]),l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(s.span);s.encode({rewardIndex:r},p);let b=Buffer.from([...Ke.collectReward,...p]);return new ye({keys:l,programId:e,data:b})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[a,o]=[new w(e.programId),new w(e.id)],r,s;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===i.toString()&&(r=p,s=new w(t.rewardInfos[p].vault));(r===void 0||s===void 0)&&oi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=[this.collectRewardInstruction(a,n.wallet,o,n.tokenAccount,s,i,r)];return{address:{rewardVault:s},signers:[],instructions:l,instructionTypes:[J.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:a,nftMint:o,nft2022:r,getEphemeralSigners:s}){let l=[],p;if(s)p=new w((await s(1))[0]);else{let d=Vt.generate();l.push(d),p=d.publicKey}let b=r?$(a,o,oe).publicKey:$(a,o,Z).publicKey,{publicKey:y}=he(n,o),u=sn(e,p).publicKey,k=$(a,p,Z).publicKey,m=ot(p).publicKey,c=tt.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:a,lockOwner:a,positionNftAccount:b,positionId:y,lockPositionId:u,lockNftMint:p,lockNftAccount:k,metadataAccount:m,withMetadata:!0,nft2022:r,positionNftMint:o,authPositionNftAccount:$(t,o,r?oe:Z).publicKey,positionNftProgram:r?oe:Z});return{address:{positionId:y,lockPositionId:u,lockNftAccount:k,lockNftMint:p,positionNftAccount:b,metadataAccount:m},instructions:[c],signers:l,instructionTypes:[J.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:a,positionNftAccount:o,positionId:r,positionNftMint:s,authPositionNftAccount:l,positionNftProgram:p,lockPositionId:b,lockNftMint:y,lockNftAccount:u,metadataAccount:k,withMetadata:m}){let c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1}],d=W([de("withMetadata")]),h=Buffer.alloc(d.span);d.encode({withMetadata:m},h);let I=Buffer.from([...si,...h]);return new ye({keys:c,programId:e,data:I})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:a}){let{publicKey:o}=$(i,a,Z),{publicKey:r}=he(n,a),s=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:on(e,r).publicKey,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:Ue.programId,isSigner:!1,isWritable:!1}];return new ye({keys:s,programId:e,data:Buffer.from(si)})}static harvestLockPositionInstruction(e){let[t,n]=[new w(e.poolKeys.programId),new w(e.poolKeys.id)],i=K.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),a=K.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:o}=H(t,n,i),{publicKey:r}=H(t,n,a),{publicKey:s}=$(e.owner,e.ownerPosition.nftMint,Z),{publicKey:l}=he(t,e.ownerPosition.nftMint),{publicKey:p}=qe(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),b=[];for(let k=0;k<e.poolKeys.rewardInfos.length;k++)b.push({poolRewardVault:new w(e.poolKeys.rewardInfos[k].vault),ownerRewardVault:e.ownerRewardAccounts[k],rewardMint:new w(e.poolKeys.rewardInfos[k].mint.address)});let y=[...b.map(k=>[{pubkey:k.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:k.rewardMint,isSigner:!1,isWritable:!1}]).flat()],u=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:on(e.programId,l).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:new w(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new w(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:new w(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new w(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...y];return new ye({keys:u,programId:e.programId,data:Buffer.from(ai)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:a,lockNftMint:o,lockNftAccount:r,positionNftAccount:s,positionId:l,poolId:p,protocolPosition:b,vaultA:y,vaultB:u,tickArrayLower:k,tickArrayUpper:m,userVaultA:c,userVaultB:d,mintA:h,mintB:I,rewardAccounts:L,exTickArrayBitmap:O}){let T=[...O?[{pubkey:O,isSigner:!1,isWritable:!0}]:[],...L.map(C=>[{pubkey:C.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.rewardMint,isSigner:!1,isWritable:!1}]).flat()],S=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Z,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:I,isSigner:!1,isWritable:!1},...T];return new ye({keys:S,programId:e,data:Buffer.from(ai)})}};import{PublicKey as qp,SystemProgram as Gp,SYSVAR_RENT_PUBKEY as Up,TransactionInstruction as ci}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as zp,TOKEN_PROGRAM_ID as li}from"@solana/spl-token";var dn=W([E("instruction"),P("amountIn"),P("minAmountOut")]),fn=W([E("instruction"),P("maxAmountIn"),P("amountOut")]),Fp=W([E("instruction"),E("nonce")]),Dr=W([E("instruction"),E("nonce"),P("startTime")]),Ep=W([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),P("swapBase2QuoteFee"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),P("swapQuote2BaseFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("withdrawQueue"),x("lpVault"),x("owner"),P("lpReserve"),G(P(),3,"padding")]),Vp=W([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("modelDataAccount"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("owner"),G(P(),64,"padding")]),qr=W([E("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),Gr=W([E("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]);var vp=W([P("fee")]);var ui=ce("Raydium_liquidity_instruction");function Ur({poolKeys:g,userKeys:e,amountIn:t,minAmountOut:n,modelDataPubKey:i=Ct},a){let o=Be(g),r=Buffer.alloc(dn.span);dn.encode({instruction:9,amountIn:re(t),minAmountOut:re(n)},r);let s=[f({pubkey:li,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders})];return a===4&&s.push(f({pubkey:o.targetOrders})),s.push(f({pubkey:o.vault.A}),f({pubkey:o.vault.B})),a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ci({programId:o.programId,keys:s,data:r})}function Xr({poolKeys:g,userKeys:e,maxAmountIn:t,amountOut:n,modelDataPubKey:i=Ct},a){let o=Be(g),r=Buffer.alloc(fn.span);fn.encode({instruction:11,maxAmountIn:re(t),amountOut:re(n)},r);let s=[f({pubkey:li,isWritable:!1}),f({pubkey:o.id}),f({pubkey:o.authority,isWritable:!1}),f({pubkey:o.openOrders}),f({pubkey:o.targetOrders}),f({pubkey:o.vault.A}),f({pubkey:o.vault.B})];return a===5&&s.push(f({pubkey:i})),s.push(f({pubkey:o.marketProgramId,isWritable:!1}),f({pubkey:o.marketId}),f({pubkey:o.marketBids}),f({pubkey:o.marketAsks}),f({pubkey:o.marketEventQueue}),f({pubkey:o.marketBaseVault}),f({pubkey:o.marketQuoteVault}),f({pubkey:o.marketAuthority,isWritable:!1}),f({pubkey:e.tokenAccountIn}),f({pubkey:e.tokenAccountOut}),f({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ci({programId:o.programId,keys:s,data:r})}function mi(g){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:a,fixedSide:o}=g;if(t===4||t===5){let r={poolKeys:e,userKeys:n};if(o==="in")return Ur(Y(j({},r),{amountIn:i,minAmountOut:a}),t);if(o==="out")return Xr(Y(j({},r),{maxAmountIn:i,amountOut:a}),t);ui.logWithError("invalid params","params",g)}throw ui.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var id=W([ke(8),E("bump"),de("disableCreatePool"),Ye("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),x("protocolOwner"),x("fundOwner"),G(P(),16)]),rd=W([ke(8),x("configId"),x("poolCreator"),x("vaultA"),x("vaultB"),x("mintLp"),x("mintA"),x("mintB"),x("mintProgramA"),x("mintProgramB"),x("observationId"),E("bump"),E("status"),E("lpDecimals"),E("mintDecimalA"),E("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),G(P(),32)]);import{PublicKey as Pd,TransactionInstruction as zr,Keypair as wd,SystemProgram as Td}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Bd,TOKEN_2022_PROGRAM_ID as Id,TOKEN_PROGRAM_ID as xd}from"@solana/spl-token";var ad=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),ud=Buffer.from("amm_config","utf8"),cd=Buffer.from("pool","utf8"),ld=Buffer.from("pool_lp_mint","utf8"),md=Buffer.from("pool_vault","utf8"),pd=Buffer.from("observation","utf8");var dd=Buffer.from("locked_liquidity","utf8");var Nd=ce("Raydium_cpmm"),Qr={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function pi(g,e,t,n,i,a,o,r,s,l,p,b,y,u,k,m){let c=W([P("amountIn"),P("amounOutMin")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],h=Buffer.alloc(c.span);return c.encode({amountIn:k,amounOutMin:m},h),new zr({keys:d,programId:g,data:Buffer.from([...Qr.swapBaseInput,...h])})}import jd from"bn.js";import Yd from"decimal.js-light";import Hr from"bn.js";var Vd=new Hr(0);function Af(g,e,t,n,i,a,o,r,s,l,p,b){let y=W([E("instruction"),P("amountIn"),P("amountOut")]),u=[{pubkey:Pt.programId,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1},{pubkey:new A(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A(t.id),isSigner:!1,isWritable:!0},{pubkey:new A(n.id),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let m=Be(t);u.push({pubkey:m.config.id,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.A:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.mintA.address.equals(s)?m.vault.B:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},...b.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let m=Be(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0})}else{let m=Be(t);u.push({pubkey:m.authority,isSigner:!1,isWritable:!1},{pubkey:m.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:m.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:m.openOrders,isSigner:!1,isWritable:!0},{pubkey:m.vault.A,isSigner:!1,isWritable:!0},{pubkey:m.vault.B,isSigner:!1,isWritable:!0},{pubkey:m.marketId,isSigner:!1,isWritable:!0},{pubkey:m.marketBids,isSigner:!1,isWritable:!0},{pubkey:m.marketAsks,isSigner:!1,isWritable:!0},{pubkey:m.marketEventQueue,isSigner:!1,isWritable:!0},...m.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:m.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:m.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:m.id,isSigner:!1,isWritable:!0},{pubkey:m.id,isSigner:!1,isWritable:!0}])}let k=Buffer.alloc(y.span);return y.encode({instruction:4,amountIn:l,amountOut:p},k),new At({keys:u,programId:g,data:k})}function wf(g,e,t,n,i,a,o,r,s,l){let p=W([E("instruction")]),b=[{pubkey:Pt.programId,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1},{pubkey:new A(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let u=Be(n);b.push({pubkey:u.config.id,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.A:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.mintA.address.equals(s)?u.vault.B:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},...l.map(k=>({pubkey:k,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let u=Be(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0})}else{let u=Be(n);b.push({pubkey:u.authority,isSigner:!1,isWritable:!1},{pubkey:u.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:u.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:u.openOrders,isSigner:!1,isWritable:!0},{pubkey:u.vault.A,isSigner:!1,isWritable:!0},{pubkey:u.vault.B,isSigner:!1,isWritable:!0},{pubkey:u.marketId,isSigner:!1,isWritable:!0},{pubkey:u.marketBids,isSigner:!1,isWritable:!0},{pubkey:u.marketAsks,isSigner:!1,isWritable:!0},{pubkey:u.marketEventQueue,isSigner:!1,isWritable:!0},...u.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:u.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:u.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:u.id,isSigner:!1,isWritable:!0},{pubkey:u.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(p.span);return p.encode({instruction:5},y),new At({keys:b,programId:g,data:y})}function jr(g,e,t,n,i,a,o,r,s,l,p,b,y,u,k){var T;let m=[],c=[f({pubkey:Ze,isWritable:!1}),f({pubkey:yn,isWritable:!1}),f({pubkey:bn,isWritable:!1}),f({pubkey:Pt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})];c.push(f({pubkey:t})),c.push(f({pubkey:i}));let d=[s,l],h=[p,b],I=[a,o,r];for(let S=0;S<d.length;S++){let C=d[S],_=I[S]===C.mintA.address;if(c.push(f({pubkey:new A(C.programId),isWritable:!1})),S===d.length-1?c.push(f({pubkey:i})):c.push(f({pubkey:n})),c.push(f({pubkey:new A(I[S])})),c.push(f({pubkey:new A(I[S+1])})),C.version===6){let B=h[S];c.push(f({pubkey:new A(B.config.id)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(_?B.vault.A:B.vault.B)})),c.push(f({pubkey:new A(_?B.vault.B:B.vault.A)})),c.push(f({pubkey:new A(C.observationId)})),c.push(f({pubkey:Qe})),c.push(f({pubkey:le(new A(C.programId),new A(C.id)).publicKey})),m.push(gn(C.sqrtPriceX64.toString(),_));for(let v of(T=k[S])!=null?T:[])c.push(f({pubkey:new A(v)}))}else if(C.version===5){let B=h[S];c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.authority),isWritable:!1})),c.push(f({pubkey:new A(B.marketProgramId)})),c.push(f({pubkey:new A(B.marketAuthority)})),c.push(f({pubkey:Kt,isWritable:!1})),c.push(f({pubkey:new A(B.openOrders)})),c.push(f({pubkey:new A(B.vault.A)})),c.push(f({pubkey:new A(B.vault.B)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.marketId)})),c.push(f({pubkey:new A(B.marketBids)})),c.push(f({pubkey:new A(B.marketAsks)})),c.push(f({pubkey:new A(B.marketEventQueue)})),c.push(f({pubkey:new A(B.marketBaseVault)})),c.push(f({pubkey:new A(B.marketQuoteVault)}))}else if(C.version===4){let B=h[S],v=C.status!==1;c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(B.authority),isWritable:!1})),c.push(f({pubkey:new A(v?B.id:B.marketProgramId)})),c.push(f({pubkey:new A(v?B.id:B.marketAuthority)})),c.push(f({pubkey:new A(v?B.id:B.openOrders)})),c.push(f({pubkey:new A(B.vault.A)})),c.push(f({pubkey:new A(B.vault.B)})),c.push(f({pubkey:new A(v?B.id:B.marketId)})),c.push(f({pubkey:new A(v?B.id:B.marketBids)})),c.push(f({pubkey:new A(v?B.id:B.marketAsks)})),c.push(f({pubkey:new A(v?B.id:B.marketEventQueue)})),c.push(f({pubkey:new A(v?B.id:B.marketBaseVault)})),c.push(f({pubkey:new A(v?B.id:B.marketQuoteVault)}))}else if(C.version===7){let B=h[S];c.push(f({pubkey:new A(B.authority)})),c.push(f({pubkey:new A(B.config.id)})),c.push(f({pubkey:new A(B.id)})),c.push(f({pubkey:new A(_?B.vault.A:B.vault.B)})),c.push(f({pubkey:new A(_?B.vault.B:B.vault.A)})),c.push(f({pubkey:new A(C.observationId)}))}else throw Error("pool type error")}let L=W([E("insId"),P("amountIn"),P("amountOut"),G(F(),m.length,"clmmPriceLimit")]),O=Buffer.alloc(L.span);return L.encode({insId:0,amountIn:y,amountOut:u,clmmPriceLimit:m},O),new At({keys:c,programId:g,data:O})}function gn(g,e){if(g)if(e){let t=new Ve(g).div(new Ve(25));return t.gt(Mt)?t:Mt}else{let t=new Ve(g).mul(new Ve(25));return t.lt(Ot)?t:Ot}else return e?Mt:Ot}function Tf({routeProgram:g,ownerInfo:e,inputMint:t,swapInfo:n}){var i,a,o,r,s,l,p;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let b=n.poolKey[0],y=Be(b),u=t.equals(y.mintA.address)?Oe.add(Ie):We.sub(Ie);return tt.makeSwapBaseInInstructions({poolInfo:b,poolKeys:b,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:y.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:y.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((a=(i=n.minAmountOut.fee)==null?void 0:i.raw)!=null?a:new Ve(0)),sqrtPriceLimitX64:u,remainingAccounts:(o=n.remainingAccounts[0])!=null?o:[]})}else if(n.poolInfo[0].version===7){let b=n.poolInfo[0],y=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[pi(b.programId,e.wallet,b.authority,b.configId,b.id,e.sourceToken,e.destinationToken,y?b.vaultA:b.vaultB,y?b.vaultB:b.vaultA,y?b.mintProgramA:b.mintProgramB,y?b.mintProgramB:b.mintProgramA,new A(b[y?"mintA":"mintB"].address),new A(b[y?"mintB":"mintA"].address),b.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[y?J.CpmmSwapBaseIn:J.CpmmSwapBaseOut],address:{}}}else{let b=n.poolKey[0];return{signers:[],instructions:[mi({poolKeys:b,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((s=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?s:new Ve(0)),fixedSide:"in"})],lookupTableAddress:b.lookupTableAccount?[b.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?J.AmmV5SwapBaseIn:J.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let b=n.poolInfo[0],y=n.poolInfo[1],u=n.poolKey[0],k=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[jr(g,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),b,y,u,k,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((p=(l=n.minAmountOut.fee)==null?void 0:l.raw)!=null?p:new Ve(0)),n.remainingAccounts)],instructionTypes:[J.RouteSwap],lookupTableAddress:[u.lookupTableAccount,k.lookupTableAccount].filter(m=>m!==void 0),address:{}}}else throw Error("route type error")}function hf({programId:g,wallet:e,amount:t,inputAccount:n,outputAccount:i,routeInfo:a,poolKeys:o}){var y;if(a.success===!1)throw Error("route info error");let r=[],s=[f({pubkey:Ze,isWritable:!1}),f({pubkey:yn,isWritable:!1}),f({pubkey:bn,isWritable:!1}),f({pubkey:Pt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],l={[a.data.inputMint]:n,[a.data.outputMint]:i};s.push(f({pubkey:l[a.data.inputMint]})),s.push(f({pubkey:l[a.data.outputMint]}));for(let u=0;u<o.length;u++){let k=a.data.routePlan[u],m=o[u],c=k.inputMint===m.mintA.address;if(s.push(f({pubkey:new A(m.programId),isWritable:!1})),u===o.length-1)s.push(f({pubkey:l[k.outputMint]}));else{let d=k.outputMint;if(l[d]===void 0){let h=$(e,new A(d),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()||m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(c?m.mintB.programId:m.mintA.programId):Ze).publicKey;l[d]=h}s.push(f({pubkey:l[d]}))}if(s.push(f({pubkey:new A(k.inputMint)})),s.push(f({pubkey:new A(k.outputMint)})),m.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let d=m;s.push(f({pubkey:new A(d.config.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A(d.observationId)})),s.push(f({pubkey:Qe,isWritable:!1})),s.push(f({pubkey:new A(d.exBitmapAccount)})),r.push(gn(k.lastPoolPriceX64,c));for(let h of(y=k.remainingAccounts)!=null?y:[])s.push(f({pubkey:new A(h)}))}else if(m.programId===Ae.AMM_STABLE.toBase58()){let d=m;s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.authority),isWritable:!1})),s.push(f({pubkey:new A(d.marketProgramId),isWritable:!1})),s.push(f({pubkey:new A(d.marketAuthority),isWritable:!1})),s.push(f({pubkey:Kt,isWritable:!1})),s.push(f({pubkey:new A(d.openOrders)})),s.push(f({pubkey:new A(d.vault.A)})),s.push(f({pubkey:new A(d.vault.B)})),s.push(f({pubkey:new A(d.marketId)})),s.push(f({pubkey:new A(d.marketBids)})),s.push(f({pubkey:new A(d.marketAsks)})),s.push(f({pubkey:new A(d.marketEventQueue)})),s.push(f({pubkey:new A(d.marketBaseVault)})),s.push(f({pubkey:new A(d.marketQuoteVault)}))}else if(m.programId===Ae.AMM_V4.toBase58()){let d=m;s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.authority),isWritable:!1})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.vault.A)})),s.push(f({pubkey:new A(d.vault.B)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(d.id)}))}else if(m.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let d=m;s.push(f({pubkey:new A(d.authority)})),s.push(f({pubkey:new A(d.config.id)})),s.push(f({pubkey:new A(d.id)})),s.push(f({pubkey:new A(c?d.vault.A:d.vault.B)})),s.push(f({pubkey:new A(c?d.vault.B:d.vault.A)})),s.push(f({pubkey:new A(d.observationId)}))}else throw Error("pool type error")}let p=W([E("insId"),P("amountIn"),P("amountOut"),G(F(),r.length,"clmmPriceLimit")]),b=Buffer.alloc(p.span);return p.encode({insId:0,amountIn:t,amountOut:new Ve(a.data.otherAmountThreshold),clmmPriceLimit:r},b),new At({keys:s,programId:g,data:b})}function Bf({programId:g,wallet:e,inputAccount:t,outputAccount:n,routeInfo:i,poolKeys:a}){var b;if(i.success===!1)throw Error("route info error");let o=[],r=[f({pubkey:Ze,isWritable:!1}),f({pubkey:yn,isWritable:!1}),f({pubkey:bn,isWritable:!1}),f({pubkey:Pt.programId,isWritable:!1}),f({pubkey:e,isSigner:!0})],s={[i.data.inputMint]:t,[i.data.outputMint]:n};for(let y=a.length-1;y>=0;y--){let u=i.data.routePlan[y],k=a[y],m=u.inputMint===k.mintA.address;if(r.push(f({pubkey:new A(k.programId)})),y===0)r.push(f({pubkey:s[u.inputMint]}));else{let c=u.inputMint;if(s[c]===void 0){let d=$(e,new A(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(m?k.mintA.programId:k.mintB.programId):Ze).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(y===a.length-1)r.push(f({pubkey:s[u.outputMint]}));else{let c=u.outputMint;if(s[c]===void 0){let d=$(e,new A(c),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()||k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(m?k.mintB.programId:k.mintA.programId):Ze).publicKey;s[c]=d}r.push(f({pubkey:s[c]}))}if(r.push(f({pubkey:new A(u.inputMint)})),r.push(f({pubkey:new A(u.outputMint)})),k.programId===Ae.CLMM_PROGRAM_ID.toBase58()){let c=k;r.push(f({pubkey:new A(c.config.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A(c.observationId)})),r.push(f({pubkey:Qe,isWritable:!1})),r.push(f({pubkey:new A(c.exBitmapAccount)})),o.push(gn(u.lastPoolPriceX64,m));for(let d of(b=u.remainingAccounts)!=null?b:[])r.push(f({pubkey:new A(d)}))}else if(k.programId===Ae.AMM_STABLE.toBase58()){let c=k;r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.authority),isWritable:!1})),r.push(f({pubkey:new A(c.marketProgramId),isWritable:!1})),r.push(f({pubkey:new A(c.marketAuthority),isWritable:!1})),r.push(f({pubkey:Kt,isWritable:!1})),r.push(f({pubkey:new A(c.openOrders)})),r.push(f({pubkey:new A(c.vault.A)})),r.push(f({pubkey:new A(c.vault.B)})),r.push(f({pubkey:new A(c.marketId)})),r.push(f({pubkey:new A(c.marketBids)})),r.push(f({pubkey:new A(c.marketAsks)})),r.push(f({pubkey:new A(c.marketEventQueue)})),r.push(f({pubkey:new A(c.marketBaseVault)})),r.push(f({pubkey:new A(c.marketQuoteVault)}))}else if(k.programId===Ae.AMM_V4.toBase58()){let c=k;r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.authority),isWritable:!1})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.vault.A)})),r.push(f({pubkey:new A(c.vault.B)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(c.id)}))}else if(k.programId===Ae.CREATE_CPMM_POOL_PROGRAM.toBase58()){let c=k;r.push(f({pubkey:new A(c.authority)})),r.push(f({pubkey:new A(c.config.id)})),r.push(f({pubkey:new A(c.id)})),r.push(f({pubkey:new A(m?c.vault.A:c.vault.B)})),r.push(f({pubkey:new A(m?c.vault.B:c.vault.A)})),r.push(f({pubkey:new A(c.observationId)}))}else throw Error("pool type error")}let l=W([E("insId"),P("amountIn"),P("amountOut"),G(F(),o.length,"clmmPriceLimit")]),p=Buffer.alloc(l.span);return l.encode({insId:1,amountIn:new Ve(i.data.otherAmountThreshold),amountOut:new Ve(i.data.outputAmount),clmmPriceLimit:o},p),new At({keys:r,programId:g,data:p})}export{Tf as makeSwapInstruction,Af as route1Instruction,wf as route2Instruction,jr as routeInstruction,hf as swapBaseInAutoAccount,Bf as swapBaseOutAutoAccount};
//# sourceMappingURL=instrument.mjs.map