var at=Object.defineProperty,ct=Object.defineProperties;var ut=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var Ke=(n,e,t)=>e in n?at(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,v=(n,e)=>{for(var t in e||(e={}))We.call(e,t)&&Ke(n,t,e[t]);if(ye)for(var t of ye(e))qe.call(e,t)&&Ke(n,t,e[t]);return n},j=(n,e)=>ct(n,ut(e));var ae=(n,e)=>{var t={};for(var r in n)We.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&ye)for(var r of ye(n))e.indexOf(r)<0&&qe.call(n,r)&&(t[r]=n[r]);return t};import{get as Ue,set as lt}from"lodash";var Be=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ge={},mt={};function W(n){let e=Ue(Ge,n);if(!e){let t=Ue(mt,n);e=new Be({name:n,logLevel:t}),lt(Ge,n,e)}return e}import{PublicKey as ne,sendAndConfirmTransaction as Oe,SystemProgram as Nt,Transaction as he,TransactionMessage as Z,VersionedTransaction as X}from"@solana/web3.js";import Ft from"axios";import{PublicKey as Ee,AddressLookupTableAccount as oe}from"@solana/web3.js";import{PublicKey as Lt}from"@solana/web3.js";import Y from"bn.js";import wr from"decimal.js";import yt from"big.js";import $t from"bn.js";import pt from"toformat";var dt=pt,ce=dt;import xe from"big.js";import gt from"bn.js";import ht from"decimal.js-light";import ue from"bn.js";var He=9007199254740991;function z(n){let e=W("Raydium_parseBigNumberish");if(n instanceof ue)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new ue(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=He||n<=-He)&&e.logWithError(`BigNumberish number overflow: ${n}`),new ue(String(n))):typeof n=="bigint"?new ue(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new ue(0))}var we=W("module/fraction"),Ce=ce(xe),le=ce(ht),Tt={[0]:le.ROUND_DOWN,[1]:le.ROUND_HALF_UP,[2]:le.ROUND_UP},bt={[0]:xe.roundDown,[1]:xe.roundHalfUp,[2]:xe.roundUp},E=class{constructor(e,t=new gt(1)){this.numerator=z(e),this.denominator=z(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new E(this.denominator,this.numerator)}add(e){let t=e instanceof E?e:new E(z(e));return this.denominator.eq(t.denominator)?new E(this.numerator.add(t.numerator),this.denominator):new E(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof E?e:new E(z(e));return this.denominator.eq(t.denominator)?new E(this.numerator.sub(t.numerator),this.denominator):new E(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof E?e:new E(z(e));return new E(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof E?e:new E(z(e));return new E(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||we.logWithError(`${e} is not an integer.`),e<=0&&we.logWithError(`${e} is not positive.`),le.set({precision:e+1,rounding:Tt[r]});let C=new le(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return C.toFormat(C.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||we.logWithError(`${e} is not an integer.`),e<0&&we.logWithError(`${e} is negative.`),Ce.DP=e,Ce.RM=bt[r]||1,new Ce(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var un=W("Raydium_amount"),ln=ce(yt);import{PublicKey as xt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as je}from"@solana/spl-token";var ze={chainId:101,address:xt.default.toBase58(),programId:je.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ee={chainId:101,address:"So11111111111111111111111111111111111111112",programId:je.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Me}from"@solana/web3.js";import{PublicKey as _,SystemProgram as Ye,SYSVAR_RENT_PUBKEY as Pt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as At}from"@solana/spl-token";function Ie({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var bn=[Ie({pubkey:At,isWritable:!1}),Ie({pubkey:Ye.programId,isWritable:!1}),Ie({pubkey:Pt,isWritable:!1})];function Je({publicKey:n,transformSol:e}){let t=Ze(n.toString());if(t instanceof _)return e&&t.equals(me)?Re:t;if(e&&t.toString()===me.toBase58())return Re;if(typeof t=="string"){if(t===_.default.toBase58())return _.default;try{return new _(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ze(n){try{return new _(n)}catch{return n}}var yn=new _("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),wn=new _("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xn=new _("SysvarRent111111111111111111111111111111111"),Pn=new _("SysvarC1ock11111111111111111111111111111111"),An=new _("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Sn=new _("Sysvar1nstructions1111111111111111111111111"),kn=Ye.programId,Bn=new _("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Cn=new _("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),In=new _("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Rn=new _("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Mn=new _("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Dn=new _("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ln=new _("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Nn=new _("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Fn=new _("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),En=new _("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),_n=new _("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Re=new _("So11111111111111111111111111111111111111112"),me=_.default;var De=class{constructor({mint:e,decimals:t,symbol:r,name:C,skipMint:h=!1,isToken2022:T=!1}){if(e===me.toBase58()||e instanceof Me&&me.equals(e)){this.decimals=ee.decimals,this.symbol=ee.symbol,this.name=ee.name,this.mint=new Me(ee.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=C||e.toString().substring(0,6),this.mint=h?Me.default:Je({publicKey:e}),this.isToken2022=T}equals(e){return this===e?!0:this.mint.equals(e.mint)}},re=De;re.WSOL=new De(j(v({},ee),{mint:ee.address}));var Le=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Pe=Le;Pe.SOL=new Le(ze);import St from"bn.js";var Yn=new E(new St(100));var er=W("Raydium_price");var kt=new Y(0),Rr=new Y(1),Mr=new Y(2),Dr=new Y(3),Lr=new Y(5),wt=new Y(10),Nr=new Y(100),Fr=new Y(1e3),Er=new Y(1e4);function Ne(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var G=class{constructor(e){this._owner=e}get publicKey(){return G.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return G.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return G.isKeyPair(this._owner)}get isPublicKey(){return G.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!G.isKeyPair(e)}};import{PublicKey as ei}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ni}from"@solana/spl-token";import{ComputeBudgetProgram as et,Keypair as nt,PublicKey as Hr,Transaction as rt,TransactionMessage as Bt,VersionedTransaction as it}from"@solana/web3.js";var pe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Ct}from"@solana/spl-token";var tt=W("Raydium_txUtil"),ot=1644;function de(n){let e=[],t=[];return n.microLamports&&(e.push(et.setComputeUnitPrice({microLamports:n.microLamports})),t.push(pe.SetComputeUnitPrice)),n.units&&(e.push(et.setComputeUnitLimit({units:n.units})),t.push(pe.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function te(n,e){var r,C;let t=e!=null?e:"confirmed";return(C=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:C.blockhash}async function fe(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let C=setTimeout(r,6e4);n.onSignature(e,h=>{if(clearTimeout(C),!h.err){t("");return}r(Object.assign(h.err,{txId:e}))},"confirmed")})}function It(n,e){n.length<1&&tt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&tt.logWithError(`no signers provided:, ${e.toString()}`);let t=new rt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ot}catch{return!1}}function ge({instructions:n,payer:e,signers:t}){return It(n,[e,...t])}function J({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=nt.generate().publicKey.toString()}){let h=new Bt({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new it(h).serialize()).toString("base64").length<ot}catch{return!1}}var Rt=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Mt=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof it&&(e=Rt(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Q(n){let e=[];return n.forEach(t=>{t instanceof rt&&(t.recentBlockhash||(t.recentBlockhash=Ct.toBase58()),t.feePayer||(t.feePayer=nt.generate().publicKey)),e.push(Mt(t))}),console.log("simulate tx string:",e),e}import{PublicKey as m}from"@solana/web3.js";var si=new m("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ai=new m("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ci=new m("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),ui=new m("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),li=new m("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),mi=new m("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),pi=new m("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),di=new m("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),fi=new m("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),gi=new m("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),hi=new m("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ti=new m("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),bi=new m("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),yi=new m("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),wi=new m("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),xi=new m("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Pi=new m("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ai=new m("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Si=new m("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ki=new m("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Bi=new m("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ci=new m("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ii=new m("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ri=new m("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Mi=new m("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Di=new m("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Li=new m("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ni=new m("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Fi=new m("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ei=new m("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),_i=new m("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Oi={OPEN_BOOK_PROGRAM:new m("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new m("Ray1111111111111111111111111111111111111111"),AMM_V4:new m("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new m("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new m("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new m("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new m("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new m("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new m("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new m("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new m("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new m("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:m.default,Router:new m("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new m("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new m("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new m("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new m("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new m("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new m("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new m("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new m("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new m("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new m("Ray1111111111111111111111111111111111111111")};import Ki from"bn.js";import{PublicKey as Ui}from"@solana/web3.js";import Hi from"bn.js";import Dt from"bn.js";var Zi=new Dt(1e6);import{MINT_SIZE as Bo,TOKEN_PROGRAM_ID as Co,getTransferFeeConfig as Io,unpackMint as Ro}from"@solana/spl-token";var Fe=W("Raydium_accountInfo_util");async function st(n,e,t){let{batchRequest:r,commitment:C="confirmed",chunkCount:h=100}=v({batchRequest:!1},t),T=Ne(e,h),c=new Array(T.length).fill([]);if(r){let M=T.map(y=>{let b=n._buildArgs([y.map(w=>w.toBase58())],C,"base64");return{methodName:"getMultipleAccounts",args:b}}),k=Ne(M,10);c=(await(await Promise.all(k.map(async y=>await n._rpcBatchRequest(y)))).flat()).map(y=>(y.error&&Fe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${y.error.message}`),y.result.value.map(b=>{if(b){let{data:w,executable:u,lamports:d,owner:a,rentEpoch:B}=b;return w.length!==2&&w[1]!=="base64"&&Fe.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(w[0],"base64"),executable:u,lamports:d,owner:new Lt(a),rentEpoch:B}}return null})))}else try{c=await Promise.all(T.map(M=>n.getMultipleAccountsInfo(M,C)))}catch(M){M instanceof Error&&Fe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${M.message}`)}return c.flat()}async function Ae({connection:n,address:e,cluster:t="mainnet"}){let r=await st(n,[...new Set(e.map(h=>h.toString()))].map(h=>new Ee(h))),C={};for(let h=0;h<e.length;h++){let T=r[h],c=e[h];if(!T)continue;let M=new oe({key:c,state:oe.deserialize(T.data)});C[c.toString()]=M,t==="devnet"?ie[c.toString()]=M:$[c.toString()]=M}return C}var $={},_e=async n=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if($[e])return $;let t=new Ee(e),r=await n.getAccountInfo(t);return r&&($[e]=new oe({key:t,state:oe.deserialize(r.data)})),$},ie={},Se=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ie[e])return ie;let t=new Ee(e),r=await n.getAccountInfo(t);return r&&(ie[e]=new oe({key:t,state:oe.deserialize(r.data)})),ie};var Te=2e3,be=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await Ft.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=de(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Nt.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ne(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(pe.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:C=[],endInstructionTypes:h=[],lookupTableAddress:T=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...C),this.endInstructionTypes.push(...h),this.lookupTableAddress.push(...T.filter(c=>c!==ne.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(v({},t||{})):this.build(t)}build(e){var r;let t=new he;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(C=>C.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async C=>{var A;let{recentBlockHash:h,skipPreflight:T=!0,sendAndConfirm:c,notSendToRpc:M}=C||{},k=h!=null?h:await te(this.connection,this.blockhashCommitment);if(t.recentBlockhash=k,this.signers.length&&t.sign(...this.signers),Q([t]),(A=this.owner)!=null&&A.isKeyPair)return{txId:c?await Oe(this.connection,t,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:T}),signedTx:t};if(this.signAllTransactions){let y=await this.signAllTransactions([t]);if(this.signers.length)for(let b of y)try{b.sign(...this.signers)}catch{}return{txId:M?"":await this.connection.sendRawTransaction(y[0].serialize(),{skipPreflight:T}),signedTx:y[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var k;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:C}=this.build(r),h=t.filter(A=>A.transaction.instructions.length>0),T=[C,...h.map(A=>A.transaction)],c=[this.signers,...h.map(A=>A.signers)],M=[...this.instructionTypes,...h.map(A=>A.instructionTypes).flat()];return(k=this.owner)!=null&&k.signer&&c.forEach(A=>{A.some(y=>y.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:T,signers:c,instructionTypes:M,execute:async A=>{var B;let{sequentially:y,onTxUpdate:b,skipTxCount:w=0,recentBlockHash:u,skipPreflight:d=!0}=A||{},a=u!=null?u:await te(this.connection,this.blockhashCommitment);if((B=this.owner)!=null&&B.isKeyPair){if(y){let f=[],I=0;for(let s of T){if(++I,I<=w)continue;let i=await Oe(this.connection,s,this.signers.find(o=>o.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:d});f.push(i)}return{txIds:f,signedTxs:T}}return{txIds:await await Promise.all(T.map(async f=>(f.recentBlockhash=a,await this.connection.sendRawTransaction(f.serialize(),{skipPreflight:d})))),signedTxs:T}}if(this.signAllTransactions){let f=T.map((s,i)=>(s.recentBlockhash=a,c[i].length&&s.sign(...c[i]),s));Q(f);let I=await this.signAllTransactions(f);if(y){let s=0,i=[],o=async()=>{if(!I[s])return;let p=await this.connection.sendRawTransaction(I[s].serialize(),{skipPreflight:d});i.push({txId:p,status:"sent",signedTx:I[s]}),b==null||b([...i]),s++;let l=!1,x=null,D=null,R=g=>{x!==null&&clearInterval(x),D!==null&&this.connection.removeSignatureListener(D);let P=i.findIndex(S=>S.txId===p);if(P>-1){if(i[P].status==="error"||i[P].status==="success")return;i[P].status=g.err?"error":"success"}b==null||b([...i]),g.err||o()};this.loopMultiTxStatus&&(x=setInterval(async()=>{var g;if(l){clearInterval(x);return}try{let P=await this.connection.getTransaction(p,{commitment:"confirmed",maxSupportedTransactionVersion:0});P&&(l=!0,clearInterval(x),R({err:((g=P.meta)==null?void 0:g.err)||null}),console.log("tx status from getTransaction:",p))}catch(P){l=!0,clearInterval(x),console.error("getTransaction timeout:",P,p)}},Te)),D=this.connection.onSignature(p,g=>{if(l){this.connection.removeSignatureListener(D);return}l=!0,R(g)},"confirmed"),this.connection.getSignatureStatus(p)};return await o(),{txIds:i.map(p=>p.txId),signedTxs:I}}else{let s=[];for(let i=0;i<I.length;i+=1){let o=await this.connection.sendRawTransaction(I[i].serialize(),{skipPreflight:d});s.push(o)}return{txIds:s,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var d;let u=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:C,recentBlockhash:h}=u,T=ae(u,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),c=v(v({},this.cluster==="devnet"?await Se(this.connection):await _e(this.connection)),t),M=Array.from(new Set([...r,...this.lookupTableAddress])),k=[];for(let a of M)c[a]===void 0&&k.push(new ne(a));let A=await Ae({connection:this.connection,address:k});for(let[a,B]of Object.entries(A))c[a]=B;let y=C?ne.default.toBase58():h!=null?h:await te(this.connection,this.blockhashCommitment),b=new Z({payerKey:this.feePayer,recentBlockhash:y,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));((d=this.owner)==null?void 0:d.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let w=new X(b);return w.sign(this.signers),{builder:this,transaction:w,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var s;let{skipPreflight:B=!0,sendAndConfirm:f,notSendToRpc:I}=a||{};if(Q([w]),(s=this.owner)!=null&&s.isKeyPair){let i=await this.connection.sendTransaction(w,{skipPreflight:B});return f&&await fe(this.connection,i),{txId:i,signedTx:w}}if(this.signAllTransactions){let i=await this.signAllTransactions([w]);if(this.signers.length)for(let o of i)try{o.sign(this.signers)}catch{}return{txId:I?"":await this.connection.sendTransaction(i[0],{skipPreflight:B}),signedTx:i[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:T||{}}}async buildV0MultiTx(e){var k;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:C}=await this.buildV0(r),h=t.filter(A=>A.builder.instructions.length>0),T=[C,...h.map(A=>A.transaction)],c=[this.signers,...h.map(A=>A.signers)],M=[...this.instructionTypes,...h.map(A=>A.instructionTypes).flat()];return(k=this.owner)!=null&&k.signer&&c.forEach(A=>{A.some(y=>y.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),T.forEach(async(A,y)=>{A.sign(c[y])}),{builder:this,transactions:T,signers:c,instructionTypes:M,buildProps:r,execute:async A=>{var d;let{sequentially:y,onTxUpdate:b,recentBlockHash:w,skipPreflight:u=!0}=A||{};if(w&&T.forEach(a=>a.message.recentBlockhash=w),Q(T),(d=this.owner)!=null&&d.isKeyPair){if(y){let a=[];for(let B of T){let f=await this.connection.sendTransaction(B,{skipPreflight:u});await fe(this.connection,f),a.push(f)}return{txIds:a,signedTxs:T}}return{txIds:await Promise.all(T.map(async a=>await this.connection.sendTransaction(a,{skipPreflight:u}))),signedTxs:T}}if(this.signAllTransactions){let a=await this.signAllTransactions(T);if(y){let B=0,f=[],I=async()=>{if(!a[B])return;let s=await this.connection.sendTransaction(a[B],{skipPreflight:u});f.push({txId:s,status:"sent",signedTx:a[B]}),b==null||b([...f]),B++;let i=!1,o=null,p=null,l=x=>{o!==null&&clearInterval(o),p!==null&&this.connection.removeSignatureListener(p);let D=f.findIndex(R=>R.txId===s);if(D>-1){if(f[D].status==="error"||f[D].status==="success")return;f[D].status=x.err?"error":"success"}b==null||b([...f]),x.err||I()};this.loopMultiTxStatus&&(o=setInterval(async()=>{var x;if(i){clearInterval(o);return}try{let D=await this.connection.getTransaction(s,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(i=!0,clearInterval(o),l({err:((x=D.meta)==null?void 0:x.err)||null}),console.log("tx status from getTransaction:",s))}catch(D){i=!0,clearInterval(o),console.error("getTransaction timeout:",D,s)}},Te)),p=this.connection.onSignature(s,x=>{if(i){this.connection.removeSignatureListener(p);return}i=!0,l(x)},"confirmed"),this.connection.getSignatureStatus(s)};return I(),{txIds:[],signedTxs:a}}else{let B=[];for(let f=0;f<a.length;f+=1){let I=await this.connection.sendTransaction(a[f],{skipPreflight:u});B.push(I)}return{txIds:B,signedTxs:a}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var b;let y=e||{},{splitIns:t=[],computeBudgetConfig:r}=y,C=ae(y,["splitIns","computeBudgetConfig"]),h=r?de(r):{instructions:[],instructionTypes:[]},T=this.signers.reduce((w,u)=>j(v({},w),{[u.publicKey.toBase58()]:u}),{}),c=[],M=[],k=[],A=0;if(this.allInstructions.forEach(w=>{let u=[...k,w],d=r?[...h.instructions,...u]:u,B=[...new Set(u.map(f=>f.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(f=>new ne(f));if(w!==t[A]&&k.length<12&&(ge({instructions:d,payer:this.feePayer,signers:B})||ge({instructions:u,payer:this.feePayer,signers:B})))k.push(w);else{if(k.length===0)throw Error("item ins too big");A+=w===t[A]?1:0,ge({instructions:r?[...h.instructions,...k]:[...k],payer:this.feePayer,signers:B})?c.push(new he().add(...h.instructions,...k)):c.push(new he().add(...k)),M.push(Array.from(new Set(k.map(f=>f.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(f=>T[f]).filter(f=>f!==void 0)),k=[w]}}),k.length>0){let u=[...new Set(k.map(d=>d.keys.filter(a=>a.isSigner).map(a=>a.pubkey.toString())).flat()).values()].map(d=>T[d]).filter(d=>d!==void 0);ge({instructions:r?[...h.instructions,...k]:[...k],payer:this.feePayer,signers:u.map(d=>d.publicKey)})?c.push(new he().add(...h.instructions,...k)):c.push(new he().add(...k)),M.push(u)}return c.forEach(w=>w.feePayer=this.feePayer),(b=this.owner)!=null&&b.signer&&M.forEach(w=>{w.some(u=>u.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:c,signers:M,instructionTypes:this.instructionTypes,execute:async w=>{var s;let{sequentially:u,onTxUpdate:d,skipTxCount:a=0,recentBlockHash:B,skipPreflight:f=!0}=w||{},I=B!=null?B:await te(this.connection,this.blockhashCommitment);if(c.forEach(async(i,o)=>{i.recentBlockhash=I,M[o].length&&i.sign(...M[o])}),Q(c),(s=this.owner)!=null&&s.isKeyPair){if(u){let i=0,o=[];for(let p of c){if(++i,i<=a){o.push("tx skipped");continue}let l=await Oe(this.connection,p,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});o.push(l)}return{txIds:o,signedTxs:c}}return{txIds:await Promise.all(c.map(async i=>await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:f}))),signedTxs:c}}if(this.signAllTransactions){let i=await this.signAllTransactions(c.slice(a,c.length)),o=[...c.slice(0,a),...i];if(u){let p=0,l=[],x=async()=>{if(!o[p])return;p<a&&(l.push({txId:"",status:"success",signedTx:o[p]}),d==null||d([...l]),p++,x());let D=await this.connection.sendRawTransaction(o[p].serialize(),{skipPreflight:f});l.push({txId:D,status:"sent",signedTx:o[p]}),d==null||d([...l]),p++;let R=!1,g=null,P=null,S=O=>{g!==null&&clearInterval(g),P!==null&&this.connection.removeSignatureListener(P);let F=l.findIndex(q=>q.txId===D);if(F>-1){if(l[F].status==="error"||l[F].status==="success")return;l[F].status=O.err?"error":"success"}d==null||d([...l]),O.err||x()};this.loopMultiTxStatus&&(g=setInterval(async()=>{var O;if(R){clearInterval(g);return}try{let F=await this.connection.getTransaction(D,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(R=!0,clearInterval(g),S({err:((O=F.meta)==null?void 0:O.err)||null}),console.log("tx status from getTransaction:",D))}catch(F){R=!0,clearInterval(g),console.error("getTransaction timeout:",F,D)}},Te)),P=this.connection.onSignature(D,O=>{if(R){this.connection.removeSignatureListener(P);return}R=!0,S(O)},"confirmed"),this.connection.getSignatureStatus(D)};return await x(),{txIds:l.map(D=>D.txId),signedTxs:o}}else{let p=[];for(let l=0;l<o.length;l+=1){let x=await this.connection.sendRawTransaction(o[l].serialize(),{skipPreflight:f});p.push(x)}return{txIds:p,signedTxs:o}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:C||{}}}async sizeCheckBuildV0(e){var I;let f=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:C={},lookupTableAddress:h=[]}=f,T=ae(f,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),c=v(v({},this.cluster==="devnet"?await Se(this.connection):$),C),M=Array.from(new Set([...this.lookupTableAddress,...h])),k=[];for(let s of M)c[s]===void 0&&k.push(new ne(s));let A=await Ae({connection:this.connection,address:k});for(let[s,i]of Object.entries(A))c[s]=i;let y=t?de(t):{instructions:[],instructionTypes:[]},b=await te(this.connection,this.blockhashCommitment),w=this.signers.reduce((s,i)=>j(v({},s),{[i.publicKey.toBase58()]:i}),{}),u=[],d=[],a=[],B=0;if(this.allInstructions.forEach(s=>{let i=[...a,s],o=t?[...y.instructions,...i]:i;if(s!==r[B]&&a.length<12&&(J({instructions:o,payer:this.feePayer,lookupTableAddressAccount:c})||J({instructions:i,payer:this.feePayer,lookupTableAddressAccount:c})))a.push(s);else{if(a.length===0)throw Error("item ins too big");B+=s===r[B]?1:0;let p={};for(let l of[...new Set(M)])c[l]!==void 0&&(p[l]=c[l]);if(t&&J({instructions:[...y.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:c,recentBlockhash:b})){let l=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...y.instructions,...a]}).compileToV0Message(Object.values(c));u.push(new X(l))}else{let l=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...a]}).compileToV0Message(Object.values(c));u.push(new X(l))}d.push(Array.from(new Set(a.map(l=>l.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(l=>w[l]).filter(l=>l!==void 0)),a=[s]}}),a.length>0){let i=[...new Set(a.map(o=>o.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(o=>w[o]).filter(o=>o!==void 0);if(t&&J({instructions:[...y.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:c,recentBlockhash:b})){let o=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...y.instructions,...a]}).compileToV0Message(Object.values(c));u.push(new X(o))}else{let o=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...a]}).compileToV0Message(Object.values(c));u.push(new X(o))}d.push(i)}return(I=this.owner)!=null&&I.signer&&d.forEach(s=>{s.some(i=>i.publicKey.equals(this.owner.publicKey))||s.push(this.owner.signer)}),u.forEach((s,i)=>{s.sign(d[i])}),{builder:this,transactions:u,buildProps:e,signers:d,blockHash:b,instructionTypes:this.instructionTypes,execute:async s=>{var D;let{sequentially:i,onTxUpdate:o,skipTxCount:p=0,recentBlockHash:l,skipPreflight:x=!0}=s||{};if(u.map(async(R,g)=>{d[g].length&&R.sign(d[g]),l&&(R.message.recentBlockhash=l)}),Q(u),(D=this.owner)!=null&&D.isKeyPair){if(i){let R=0,g=[];for(let P of u){if(++R,R<=p){console.log("skip tx: ",R),g.push("tx skipped");continue}let S=await this.connection.sendTransaction(P,{skipPreflight:x});await fe(this.connection,S),g.push(S)}return{txIds:g,signedTxs:u}}return{txIds:await Promise.all(u.map(async R=>await this.connection.sendTransaction(R,{skipPreflight:x}))),signedTxs:u}}if(this.signAllTransactions){let R=await this.signAllTransactions(u.slice(p,u.length)),g=[...u.slice(0,p),...R];if(i){let P=0,S=[],O=async()=>{if(!g[P])return;if(P<p){S.push({txId:"",status:"success",signedTx:g[P]}),o==null||o([...S]),P++,O();return}let F=await this.connection.sendTransaction(g[P],{skipPreflight:x});S.push({txId:F,status:"sent",signedTx:g[P]}),o==null||o([...S]),P++;let q=!1,U=null,H=null,se=K=>{U!==null&&clearInterval(U),H!==null&&this.connection.removeSignatureListener(H);let V=S.findIndex(ke=>ke.txId===F);if(V>-1){if(S[V].status==="error"||S[V].status==="success")return;S[V].status=K.err?"error":"success"}o==null||o([...S]),K.err||O()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var K;if(q){clearInterval(U);return}try{let V=await this.connection.getTransaction(F,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(q=!0,clearInterval(U),se({err:((K=V.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",F))}catch(V){q=!0,clearInterval(U),console.error("getTransaction timeout:",V,F)}},Te)),H=this.connection.onSignature(F,K=>{if(q){this.connection.removeSignatureListener(H);return}q=!0,se(K)},"confirmed"),this.connection.getSignatureStatus(F)};return O(),{txIds:[],signedTxs:g}}else{let P=[];for(let S=0;S<g.length;S+=1){let O=await this.connection.sendTransaction(g[S],{skipPreflight:x});P.push(O)}return{txIds:P,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:T||{}}}async buildSniperTransaction(e){var I;let f=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:C={},lookupTableAddress:h=[]}=f,T=ae(f,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),c=v(v({},this.cluster==="devnet"?await Se(this.connection):await _e(this.connection)),C),M=Array.from(new Set([...this.lookupTableAddress,...h])),k=[];for(let s of M)c[s]===void 0&&k.push(new ne(s));let A=await Ae({connection:this.connection,address:k});for(let[s,i]of Object.entries(A))c[s]=i;let y=t?de(t):{instructions:[],instructionTypes:[]},b=await te(this.connection,this.blockhashCommitment),w=this.signers.reduce((s,i)=>j(v({},s),{[i.publicKey.toBase58()]:i}),{}),u=[],d=[],a=[],B=0;if(this.allInstructions.forEach(s=>{let i=[...a,s],o=t?[...y.instructions,...i]:i;if(s!==r[B]&&a.length<12&&(J({instructions:o,payer:this.feePayer,lookupTableAddressAccount:c})||J({instructions:i,payer:this.feePayer,lookupTableAddressAccount:c})))a.push(s);else{if(a.length===0)throw Error("item ins too big");B+=s===r[B]?1:0;let p={};for(let l of[...new Set(M)])c[l]!==void 0&&(p[l]=c[l]);if(t&&J({instructions:[...y.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:c,recentBlockhash:b})){let l=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...y.instructions,...a]}).compileToV0Message(Object.values(c));u.push(new X(l))}else{let l=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...a]}).compileToV0Message(Object.values(c));u.push(new X(l))}d.push(Array.from(new Set(a.map(l=>l.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(l=>w[l]).filter(l=>l!==void 0)),a=[s]}}),a.length>0){let i=[...new Set(a.map(o=>o.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(o=>w[o]).filter(o=>o!==void 0);if(t&&J({instructions:[...y.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:c,recentBlockhash:b})){let o=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...y.instructions,...a]}).compileToV0Message(Object.values(c));u.push(new X(o))}else{let o=new Z({payerKey:this.feePayer,recentBlockhash:b,instructions:[...a]}).compileToV0Message(Object.values(c));u.push(new X(o))}d.push(i)}return(I=this.owner)!=null&&I.signer&&d.forEach(s=>{s.some(i=>i.publicKey.equals(this.owner.publicKey))||s.push(this.owner.signer)}),u.forEach((s,i)=>{s.sign(d[i])}),{builder:this,transactions:u,buildProps:e,signers:d,instructionTypes:this.instructionTypes,execute:async s=>{var D;let{sequentially:i,onTxUpdate:o,skipTxCount:p=0,recentBlockHash:l,skipPreflight:x=!0}=s||{};if(u.map(async(R,g)=>{d[g].length&&R.sign(d[g]),l&&(R.message.recentBlockhash=l)}),Q(u),(D=this.owner)!=null&&D.isKeyPair){if(i){let R=0,g=[];for(let P of u){if(++R,R<=p){console.log("skip tx: ",R),g.push("tx skipped");continue}let S=await this.connection.sendTransaction(P,{skipPreflight:x});await fe(this.connection,S),g.push(S)}return{txIds:g,signedTxs:u}}return{txIds:await Promise.all(u.map(async R=>await this.connection.sendTransaction(R,{skipPreflight:x}))),signedTxs:u}}if(this.signAllTransactions){let R=await this.signAllTransactions(u.slice(p,u.length)),g=[...u.slice(0,p),...R];if(i){let P=0,S=[],O=async()=>{if(!g[P])return;if(P<p){S.push({txId:"",status:"success",signedTx:g[P]}),o==null||o([...S]),P++,O();return}let F=await this.connection.sendTransaction(g[P],{skipPreflight:x});S.push({txId:F,status:"sent",signedTx:g[P]}),o==null||o([...S]),P++;let q=!1,U=null,H=null,se=K=>{U!==null&&clearInterval(U),H!==null&&this.connection.removeSignatureListener(H);let V=S.findIndex(ke=>ke.txId===F);if(V>-1){if(S[V].status==="error"||S[V].status==="success")return;S[V].status=K.err?"error":"success"}o==null||o([...S]),K.err||O()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var K;if(q){clearInterval(U);return}try{let V=await this.connection.getTransaction(F,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(q=!0,clearInterval(U),se({err:((K=V.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",F))}catch(V){q=!0,clearInterval(U),console.error("getTransaction timeout:",V,F)}},Te)),H=this.connection.onSignature(F,K=>{if(q){this.connection.removeSignatureListener(H);return}q=!0,se(K)},"confirmed"),this.connection.getSignatureStatus(F)};return O(),{txIds:[],signedTxs:g}}else{let P=[];for(let S=0;S<g.length;S+=1){let O=await this.connection.sendTransaction(g[S],{skipPreflight:x});P.push(O)}return{txIds:P,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:T||{}}}};var Ve=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ve=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new be({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let r=new G(e);return new be({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:r,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Ve(e))}logInfo(...e){this.logger.info(Ve(e))}logAndCreateError(...e){let t=Ve(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};export{ve as default};
//# sourceMappingURL=moduleBase.mjs.map