var ct=Object.defineProperty,ut=Object.defineProperties;var mt=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var We=(n,e,t)=>e in n?ct(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,O=(n,e)=>{for(var t in e||(e={}))Ue.call(e,t)&&We(n,t,e[t]);if(de)for(var t of de(e))qe.call(e,t)&&We(n,t,e[t]);return n},K=(n,e)=>ut(n,mt(e));var fe=(n,e)=>{var t={};for(var r in n)Ue.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&de)for(var r of de(n))e.indexOf(r)<0&&qe.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as Ot}from"@solana/web3.js";import{MintLayout as Et,TOKEN_2022_PROGRAM_ID as Ee,TOKEN_PROGRAM_ID as _e}from"@solana/spl-token";import{get as Ge,set as lt}from"lodash";var Pe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},je={},pt={};function _(n){let e=Ge(je,n);if(!e){let t=Ge(pt,n);e=new Pe({name:n,logLevel:t}),lt(je,n,e)}return e}import{PublicKey as ee,sendAndConfirmTransaction as Ne,SystemProgram as Vt,Transaction as ce,TransactionMessage as ue,VersionedTransaction as me}from"@solana/web3.js";import Nt from"axios";import{PublicKey as Le,AddressLookupTableAccount as $}from"@solana/web3.js";import{PublicKey as Dt}from"@solana/web3.js";import q from"bn.js";import Lr from"decimal.js";import wt from"big.js";import rn from"bn.js";import dt from"toformat";var ft=dt,te=ft;import he from"big.js";import ht from"bn.js";import bt from"decimal.js-light";import ne from"bn.js";var He=9007199254740991;function U(n){let e=_("Raydium_parseBigNumberish");if(n instanceof ne)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new ne(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=He||n<=-He)&&e.logWithError(`BigNumberish number overflow: ${n}`),new ne(String(n))):typeof n=="bigint"?new ne(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new ne(0))}var ge=_("module/fraction"),Ie=te(he),re=te(bt),Tt={[0]:re.ROUND_DOWN,[1]:re.ROUND_HALF_UP,[2]:re.ROUND_UP},yt={[0]:he.roundDown,[1]:he.roundHalfUp,[2]:he.roundUp},L=class{constructor(e,t=new ht(1)){this.numerator=U(e),this.denominator=U(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new L(this.denominator,this.numerator)}add(e){let t=e instanceof L?e:new L(U(e));return this.denominator.eq(t.denominator)?new L(this.numerator.add(t.numerator),this.denominator):new L(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof L?e:new L(U(e));return this.denominator.eq(t.denominator)?new L(this.numerator.sub(t.numerator),this.denominator):new L(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof L?e:new L(U(e));return new L(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof L?e:new L(U(e));return new L(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||ge.logWithError(`${e} is not an integer.`),e<=0&&ge.logWithError(`${e} is not positive.`),re.set({precision:e+1,rounding:Tt[r]});let w=new re(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return w.toFormat(w.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||ge.logWithError(`${e} is not an integer.`),e<0&&ge.logWithError(`${e} is negative.`),Ie.DP=e,Ie.RM=yt[r]||1,new Ie(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var dn=_("Raydium_amount"),fn=te(wt);import{PublicKey as At}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ze}from"@solana/spl-token";var H={chainId:101,address:At.default.toBase58(),programId:ze.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},z={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ze.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ce}from"@solana/web3.js";import{PublicKey as D,SystemProgram as Je,SYSVAR_RENT_PUBKEY as Pt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as It}from"@solana/spl-token";function ke({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var An=[ke({pubkey:It,isWritable:!1}),ke({pubkey:Je.programId,isWritable:!1}),ke({pubkey:Pt,isWritable:!1})];function Ze({publicKey:n,transformSol:e}){let t=Qe(n.toString());if(t instanceof D)return e&&t.equals(ie)?Se:t;if(e&&t.toString()===ie.toBase58())return Se;if(typeof t=="string"){if(t===D.default.toBase58())return D.default;try{return new D(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Qe(n){try{return new D(n)}catch{return n}}var Pn=new D("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),In=new D("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),kn=new D("SysvarRent111111111111111111111111111111111"),Sn=new D("SysvarC1ock11111111111111111111111111111111"),Cn=new D("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Bn=new D("Sysvar1nstructions1111111111111111111111111"),Rn=Je.programId,Mn=new D("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Fn=new D("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ln=new D("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Dn=new D("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Vn=new D("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Nn=new D("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),On=new D("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),En=new D("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),_n=new D("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),vn=new D("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Kn=new D("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Se=new D("So11111111111111111111111111111111111111112"),ie=D.default;var Be=class{constructor({mint:e,decimals:t,symbol:r,name:w,skipMint:m=!1,isToken2022:p=!1}){if(e===ie.toBase58()||e instanceof Ce&&ie.equals(e)){this.decimals=z.decimals,this.symbol=z.symbol,this.name=z.name,this.mint=new Ce(z.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=w||e.toString().substring(0,6),this.mint=m?Ce.default:Ze({publicKey:e}),this.isToken2022=p}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Q=Be;Q.WSOL=new Be(K(O({},z),{mint:z.address}));var Re=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},be=Re;be.SOL=new Re(H);import kt from"bn.js";var Yn=new L(new kt(100));var ir=_("Raydium_price");import{PublicKey as xr}from"@solana/web3.js";import Pr from"bn.js";var St=new q(0),Ur=new q(1),qr=new q(2),Gr=new q(3),jr=new q(5),xt=new q(10),Hr=new q(100),zr=new q(1e3),Jr=new q(1e4);function Me(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}import{PublicKey as di}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as gi}from"@solana/spl-token";import{ComputeBudgetProgram as et,Keypair as nt,PublicKey as ii,Transaction as rt,TransactionMessage as Ct,VersionedTransaction as it}from"@solana/web3.js";var oe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Bt}from"@solana/spl-token";var tt=_("Raydium_txUtil"),ot=1644;function Te(n){let e=[],t=[];return n.microLamports&&(e.push(et.setComputeUnitPrice({microLamports:n.microLamports})),t.push(oe.SetComputeUnitPrice)),n.units&&(e.push(et.setComputeUnitLimit({units:n.units})),t.push(oe.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function X(n,e){var r,w;let t=e!=null?e:"confirmed";return(w=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:w.blockhash}async function ye(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let w=setTimeout(r,6e4);n.onSignature(e,m=>{if(clearTimeout(w),!m.err){t("");return}r(Object.assign(m.err,{txId:e}))},"confirmed")})}function Rt(n,e){n.length<1&&tt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&tt.logWithError(`no signers provided:, ${e.toString()}`);let t=new rt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ot}catch{return!1}}function se({instructions:n,payer:e,signers:t}){return Rt(n,[e,...t])}function ae({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=nt.generate().publicKey.toString()}){let m=new Ct({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new it(m).serialize()).toString("base64").length<ot}catch{return!1}}var Mt=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Ft=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof it&&(e=Mt(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function J(n){let e=[];return n.forEach(t=>{t instanceof rt&&(t.recentBlockhash||(t.recentBlockhash=Bt.toBase58()),t.feePayer||(t.feePayer=nt.generate().publicKey)),e.push(Ft(t))}),console.log("simulate tx string:",e),e}import{PublicKey as a}from"@solana/web3.js";var yi=new a("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),wi=new a("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),xi=new a("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ai=new a("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Pi=new a("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ii=new a("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ki=new a("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Si=new a("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ci=new a("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Bi=new a("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ri=new a("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Mi=new a("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Fi=new a("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Li=new a("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Di=new a("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Vi=new a("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ni=new a("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Oi=new a("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ei=new a("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),_i=new a("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),vi=new a("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ki=new a("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Wi=new a("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ui=new a("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),qi=new a("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Gi=new a("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),ji=new a("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Hi=new a("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),zi=new a("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ji=new a("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Zi=new a("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Qi={OPEN_BOOK_PROGRAM:new a("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new a("Ray1111111111111111111111111111111111111111"),AMM_V4:new a("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new a("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new a("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new a("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new a("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new a("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new a("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new a("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new a("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new a("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:a.default,Router:new a("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new a("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new a("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new a("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new a("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new a("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new a("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new a("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new a("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new a("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new a("Ray1111111111111111111111111111111111111111")};import $i from"bn.js";import Lt from"bn.js";var no=new Lt(1e6);import{MINT_SIZE as Lo,TOKEN_PROGRAM_ID as Do,getTransferFeeConfig as Vo,unpackMint as No}from"@solana/spl-token";var Fe=_("Raydium_accountInfo_util");async function st(n,e,t){let{batchRequest:r,commitment:w="confirmed",chunkCount:m=100}=O({batchRequest:!1},t),p=Me(e,m),o=new Array(p.length).fill([]);if(r){let P=p.map(x=>{let A=n._buildArgs([x.map(y=>y.toBase58())],w,"base64");return{methodName:"getMultipleAccounts",args:A}}),i=Me(P,10);o=(await(await Promise.all(i.map(async x=>await n._rpcBatchRequest(x)))).flat()).map(x=>(x.error&&Fe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${x.error.message}`),x.result.value.map(A=>{if(A){let{data:y,executable:d,lamports:b,owner:c,rentEpoch:I}=A;return y.length!==2&&y[1]!=="base64"&&Fe.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(y[0],"base64"),executable:d,lamports:b,owner:new Dt(c),rentEpoch:I}}return null})))}else try{o=await Promise.all(p.map(P=>n.getMultipleAccountsInfo(P,w)))}catch(P){P instanceof Error&&Fe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${P.message}`)}return o.flat()}async function De({connection:n,address:e,cluster:t="mainnet"}){let r=await st(n,[...new Set(e.map(m=>m.toString()))].map(m=>new Le(m))),w={};for(let m=0;m<e.length;m++){let p=r[m],o=e[m];if(!p)continue;let P=new $({key:o,state:$.deserialize(p.data)});w[o.toString()]=P,t==="devnet"?Y[o.toString()]=P:we[o.toString()]=P}return w}var we={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new $({key:new Le("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:$.deserialize(Buffer.from("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","base64"))})},Y={},Ve=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Y[e])return Y;let t=new Le(e),r=await n.getAccountInfo(t);return r&&(Y[e]=new $({key:t,state:$.deserialize(r.data)})),Y};var xe=2e3,Ae=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await Nt.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Te(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Vt.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ee(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(oe.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:w=[],endInstructionTypes:m=[],lookupTableAddress:p=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...w),this.endInstructionTypes.push(...m),this.lookupTableAddress.push(...p.filter(o=>o!==ee.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(O({},t||{})):this.build(t)}build(e){var r;let t=new ce;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var f;let{recentBlockHash:m,skipPreflight:p=!0,sendAndConfirm:o,notSendToRpc:P}=w||{},i=m!=null?m:await X(this.connection,this.blockhashCommitment);if(t.recentBlockhash=i,this.signers.length&&t.sign(...this.signers),J([t]),(f=this.owner)!=null&&f.isKeyPair)return{txId:o?await Ne(this.connection,t,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:p}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:p}),signedTx:t};if(this.signAllTransactions){let x=await this.signAllTransactions([t]);if(this.signers.length)for(let A of x)try{A.sign(...this.signers)}catch{}return{txId:P?"":await this.connection.sendRawTransaction(x[0].serialize(),{skipPreflight:p}),signedTx:x[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var i;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:w}=this.build(r),m=t.filter(f=>f.transaction.instructions.length>0),p=[w,...m.map(f=>f.transaction)],o=[this.signers,...m.map(f=>f.signers)],P=[...this.instructionTypes,...m.map(f=>f.instructionTypes).flat()];return(i=this.owner)!=null&&i.signer&&o.forEach(f=>{f.some(x=>x.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:p,signers:o,instructionTypes:P,execute:async f=>{var I;let{sequentially:x,onTxUpdate:A,skipTxCount:y=0,recentBlockHash:d,skipPreflight:b=!0}=f||{},c=d!=null?d:await X(this.connection,this.blockhashCommitment);if((I=this.owner)!=null&&I.isKeyPair){if(x){let g=[],S=0;for(let l of p){if(++S,S<=y)continue;let s=await Ne(this.connection,l,this.signers.find(u=>u.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});g.push(s)}return{txIds:g,signedTxs:p}}return{txIds:await await Promise.all(p.map(async g=>(g.recentBlockhash=c,await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:b})))),signedTxs:p}}if(this.signAllTransactions){let g=p.map((l,s)=>(l.recentBlockhash=c,o[s].length&&l.sign(...o[s]),l));J(g);let S=await this.signAllTransactions(g);if(x){let l=0,s=[],u=async()=>{if(!S[l])return;let T=await this.connection.sendRawTransaction(S[l].serialize(),{skipPreflight:b});s.push({txId:T,status:"sent",signedTx:S[l]}),A==null||A([...s]),l++;let h=!1,k=null,M=null,V=C=>{k!==null&&clearInterval(k),M!==null&&this.connection.removeSignatureListener(M);let F=s.findIndex(N=>N.txId===T);if(F>-1){if(s[F].status==="error"||s[F].status==="success")return;s[F].status=C.err?"error":"success"}A==null||A([...s]),C.err||u()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var C;if(h){clearInterval(k);return}try{let F=await this.connection.getTransaction(T,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(h=!0,clearInterval(k),V({err:((C=F.meta)==null?void 0:C.err)||null}),console.log("tx status from getTransaction:",T))}catch(F){h=!0,clearInterval(k),console.error("getTransaction timeout:",F,T)}},xe)),M=this.connection.onSignature(T,C=>{if(h){this.connection.removeSignatureListener(M);return}h=!0,V(C)},"confirmed"),this.connection.getSignatureStatus(T)};return await u(),{txIds:s.map(T=>T.txId),signedTxs:S}}else{let l=[];for(let s=0;s<S.length;s+=1){let u=await this.connection.sendRawTransaction(S[s].serialize(),{skipPreflight:b});l.push(u)}return{txIds:l,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var b;let d=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:w,recentBlockhash:m}=d,p=fe(d,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=O(O({},this.cluster==="devnet"?await Ve(this.connection):we),t),P=Array.from(new Set([...r,...this.lookupTableAddress])),i=[];for(let c of P)o[c]===void 0&&i.push(new ee(c));let f=await De({connection:this.connection,address:i});for(let[c,I]of Object.entries(f))o[c]=I;let x=w?ee.default.toBase58():m!=null?m:await X(this.connection,this.blockhashCommitment),A=new ue({payerKey:this.feePayer,recentBlockhash:x,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(c=>c.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let y=new me(A);return y.sign(this.signers),{builder:this,transaction:y,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async c=>{var l;let{skipPreflight:I=!0,sendAndConfirm:g,notSendToRpc:S}=c||{};if(J([y]),(l=this.owner)!=null&&l.isKeyPair){let s=await this.connection.sendTransaction(y,{skipPreflight:I});return g&&await ye(this.connection,s),{txId:s,signedTx:y}}if(this.signAllTransactions){let s=await this.signAllTransactions([y]);if(this.signers.length)for(let u of s)try{u.sign(this.signers)}catch{}return{txId:S?"":await this.connection.sendTransaction(s[0],{skipPreflight:I}),signedTx:s[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:p||{}}}async buildV0MultiTx(e){var i;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:w}=await this.buildV0(r),m=t.filter(f=>f.builder.instructions.length>0),p=[w,...m.map(f=>f.transaction)],o=[this.signers,...m.map(f=>f.signers)],P=[...this.instructionTypes,...m.map(f=>f.instructionTypes).flat()];return(i=this.owner)!=null&&i.signer&&o.forEach(f=>{f.some(x=>x.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),p.forEach(async(f,x)=>{f.sign(o[x])}),{builder:this,transactions:p,signers:o,instructionTypes:P,buildProps:r,execute:async f=>{var b;let{sequentially:x,onTxUpdate:A,recentBlockHash:y,skipPreflight:d=!0}=f||{};if(y&&p.forEach(c=>c.message.recentBlockhash=y),J(p),(b=this.owner)!=null&&b.isKeyPair){if(x){let c=[];for(let I of p){let g=await this.connection.sendTransaction(I,{skipPreflight:d});await ye(this.connection,g),c.push(g)}return{txIds:c,signedTxs:p}}return{txIds:await Promise.all(p.map(async c=>await this.connection.sendTransaction(c,{skipPreflight:d}))),signedTxs:p}}if(this.signAllTransactions){let c=await this.signAllTransactions(p);if(x){let I=0,g=[],S=async()=>{if(!c[I])return;let l=await this.connection.sendTransaction(c[I],{skipPreflight:d});g.push({txId:l,status:"sent",signedTx:c[I]}),A==null||A([...g]),I++;let s=!1,u=null,T=null,h=k=>{u!==null&&clearInterval(u),T!==null&&this.connection.removeSignatureListener(T);let M=g.findIndex(V=>V.txId===l);if(M>-1){if(g[M].status==="error"||g[M].status==="success")return;g[M].status=k.err?"error":"success"}A==null||A([...g]),k.err||S()};this.loopMultiTxStatus&&(u=setInterval(async()=>{var k;if(s){clearInterval(u);return}try{let M=await this.connection.getTransaction(l,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(s=!0,clearInterval(u),h({err:((k=M.meta)==null?void 0:k.err)||null}),console.log("tx status from getTransaction:",l))}catch(M){s=!0,clearInterval(u),console.error("getTransaction timeout:",M,l)}},xe)),T=this.connection.onSignature(l,k=>{if(s){this.connection.removeSignatureListener(T);return}s=!0,h(k)},"confirmed"),this.connection.getSignatureStatus(l)};return S(),{txIds:[],signedTxs:c}}else{let I=[];for(let g=0;g<c.length;g+=1){let S=await this.connection.sendTransaction(c[g],{skipPreflight:d});I.push(S)}return{txIds:I,signedTxs:c}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var A;let x=e||{},{splitIns:t=[],computeBudgetConfig:r}=x,w=fe(x,["splitIns","computeBudgetConfig"]),m=r?Te(r):{instructions:[],instructionTypes:[]},p=this.signers.reduce((y,d)=>K(O({},y),{[d.publicKey.toBase58()]:d}),{}),o=[],P=[],i=[],f=0;if(this.allInstructions.forEach(y=>{let d=[...i,y],b=r?[...m.instructions,...d]:d,I=[...new Set(d.map(g=>g.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(g=>new ee(g));if(y!==t[f]&&i.length<12&&(se({instructions:b,payer:this.feePayer,signers:I})||se({instructions:d,payer:this.feePayer,signers:I})))i.push(y);else{if(i.length===0)throw Error("item ins too big");f+=y===t[f]?1:0,se({instructions:r?[...m.instructions,...i]:[...i],payer:this.feePayer,signers:I})?o.push(new ce().add(...m.instructions,...i)):o.push(new ce().add(...i)),P.push(Array.from(new Set(i.map(g=>g.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(g=>p[g]).filter(g=>g!==void 0)),i=[y]}}),i.length>0){let d=[...new Set(i.map(b=>b.keys.filter(c=>c.isSigner).map(c=>c.pubkey.toString())).flat()).values()].map(b=>p[b]).filter(b=>b!==void 0);se({instructions:r?[...m.instructions,...i]:[...i],payer:this.feePayer,signers:d.map(b=>b.publicKey)})?o.push(new ce().add(...m.instructions,...i)):o.push(new ce().add(...i)),P.push(d)}return o.forEach(y=>y.feePayer=this.feePayer),(A=this.owner)!=null&&A.signer&&P.forEach(y=>{y.some(d=>d.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:o,signers:P,instructionTypes:this.instructionTypes,execute:async y=>{var l;let{sequentially:d,onTxUpdate:b,skipTxCount:c=0,recentBlockHash:I,skipPreflight:g=!0}=y||{},S=I!=null?I:await X(this.connection,this.blockhashCommitment);if(o.forEach(async(s,u)=>{s.recentBlockhash=S,P[u].length&&s.sign(...P[u])}),J(o),(l=this.owner)!=null&&l.isKeyPair){if(d){let s=0,u=[];for(let T of o){if(++s,s<=c){u.push("tx skipped");continue}let h=await Ne(this.connection,T,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});u.push(h)}return{txIds:u,signedTxs:o}}return{txIds:await Promise.all(o.map(async s=>await this.connection.sendRawTransaction(s.serialize(),{skipPreflight:g}))),signedTxs:o}}if(this.signAllTransactions){let s=await this.signAllTransactions(o.slice(c,o.length)),u=[...o.slice(0,c),...s];if(d){let T=0,h=[],k=async()=>{if(!u[T])return;T<c&&(h.push({txId:"",status:"success",signedTx:u[T]}),b==null||b([...h]),T++,k());let M=await this.connection.sendRawTransaction(u[T].serialize(),{skipPreflight:g});h.push({txId:M,status:"sent",signedTx:u[T]}),b==null||b([...h]),T++;let V=!1,C=null,F=null,N=v=>{C!==null&&clearInterval(C),F!==null&&this.connection.removeSignatureListener(F);let E=h.findIndex(G=>G.txId===M);if(E>-1){if(h[E].status==="error"||h[E].status==="success")return;h[E].status=v.err?"error":"success"}b==null||b([...h]),v.err||k()};this.loopMultiTxStatus&&(C=setInterval(async()=>{var v;if(V){clearInterval(C);return}try{let E=await this.connection.getTransaction(M,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(V=!0,clearInterval(C),N({err:((v=E.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",M))}catch(E){V=!0,clearInterval(C),console.error("getTransaction timeout:",E,M)}},xe)),F=this.connection.onSignature(M,v=>{if(V){this.connection.removeSignatureListener(F);return}V=!0,N(v)},"confirmed"),this.connection.getSignatureStatus(M)};return await k(),{txIds:h.map(M=>M.txId),signedTxs:u}}else{let T=[];for(let h=0;h<u.length;h+=1){let k=await this.connection.sendRawTransaction(u[h].serialize(),{skipPreflight:g});T.push(k)}return{txIds:T,signedTxs:u}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:w||{}}}async sizeCheckBuildV0(e){var S;let g=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:w={},lookupTableAddress:m=[]}=g,p=fe(g,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=O(O({},this.cluster==="devnet"?await Ve(this.connection):we),w),P=Array.from(new Set([...this.lookupTableAddress,...m])),i=[];for(let l of P)o[l]===void 0&&i.push(new ee(l));let f=await De({connection:this.connection,address:i});for(let[l,s]of Object.entries(f))o[l]=s;let x=t?Te(t):{instructions:[],instructionTypes:[]},A=await X(this.connection,this.blockhashCommitment),y=this.signers.reduce((l,s)=>K(O({},l),{[s.publicKey.toBase58()]:s}),{}),d=[],b=[],c=[],I=0;if(this.allInstructions.forEach(l=>{let s=[...c,l],u=t?[...x.instructions,...s]:s;if(l!==r[I]&&c.length<12&&(ae({instructions:u,payer:this.feePayer,lookupTableAddressAccount:o})||ae({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})))c.push(l);else{if(c.length===0)throw Error("item ins too big");I+=l===r[I]?1:0;let T={};for(let h of[...new Set(P)])o[h]!==void 0&&(T[h]=o[h]);if(t&&ae({instructions:[...x.instructions,...c],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let h=new ue({payerKey:this.feePayer,recentBlockhash:A,instructions:[...x.instructions,...c]}).compileToV0Message(Object.values(o));d.push(new me(h))}else{let h=new ue({payerKey:this.feePayer,recentBlockhash:A,instructions:[...c]}).compileToV0Message(Object.values(o));d.push(new me(h))}b.push(Array.from(new Set(c.map(h=>h.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(h=>y[h]).filter(h=>h!==void 0)),c=[l]}}),c.length>0){let s=[...new Set(c.map(u=>u.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(u=>y[u]).filter(u=>u!==void 0);if(t&&ae({instructions:[...x.instructions,...c],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let u=new ue({payerKey:this.feePayer,recentBlockhash:A,instructions:[...x.instructions,...c]}).compileToV0Message(Object.values(o));d.push(new me(u))}else{let u=new ue({payerKey:this.feePayer,recentBlockhash:A,instructions:[...c]}).compileToV0Message(Object.values(o));d.push(new me(u))}b.push(s)}return(S=this.owner)!=null&&S.signer&&b.forEach(l=>{l.some(s=>s.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),d.forEach((l,s)=>{l.sign(b[s])}),{builder:this,transactions:d,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async l=>{var M;let{sequentially:s,onTxUpdate:u,skipTxCount:T=0,recentBlockHash:h,skipPreflight:k=!0}=l||{};if(d.map(async(V,C)=>{b[C].length&&V.sign(b[C]),h&&(V.message.recentBlockhash=h)}),J(d),(M=this.owner)!=null&&M.isKeyPair){if(s){let V=0,C=[];for(let F of d){if(++V,V<=T){console.log("skip tx: ",V),C.push("tx skipped");continue}let N=await this.connection.sendTransaction(F,{skipPreflight:k});await ye(this.connection,N),C.push(N)}return{txIds:C,signedTxs:d}}return{txIds:await Promise.all(d.map(async V=>await this.connection.sendTransaction(V,{skipPreflight:k}))),signedTxs:d}}if(this.signAllTransactions){let V=await this.signAllTransactions(d.slice(T,d.length)),C=[...d.slice(0,T),...V];if(s){let F=0,N=[],v=async()=>{if(!C[F])return;if(F<T){N.push({txId:"",status:"success",signedTx:C[F]}),u==null||u([...N]),F++,v();return}let E=await this.connection.sendTransaction(C[F],{skipPreflight:k});N.push({txId:E,status:"sent",signedTx:C[F]}),u==null||u([...N]),F++;let G=!1,Z=null,pe=null,Ke=j=>{Z!==null&&clearInterval(Z),pe!==null&&this.connection.removeSignatureListener(pe);let W=N.findIndex(at=>at.txId===E);if(W>-1){if(N[W].status==="error"||N[W].status==="success")return;N[W].status=j.err?"error":"success"}u==null||u([...N]),j.err||v()};this.loopMultiTxStatus&&(Z=setInterval(async()=>{var j;if(G){clearInterval(Z);return}try{let W=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});W&&(G=!0,clearInterval(Z),Ke({err:((j=W.meta)==null?void 0:j.err)||null}),console.log("tx status from getTransaction:",E))}catch(W){G=!0,clearInterval(Z),console.error("getTransaction timeout:",W,E)}},xe)),pe=this.connection.onSignature(E,j=>{if(G){this.connection.removeSignatureListener(pe);return}G=!0,Ke(j)},"confirmed"),this.connection.getSignatureStatus(E)};return v(),{txIds:[],signedTxs:C}}else{let F=[];for(let N=0;N<C.length;N+=1){let v=await this.connection.sendTransaction(C[N],{skipPreflight:k});F.push(v)}return{txIds:F,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:p||{}}}};var Oe=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),le=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=_(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ae({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Oe(e))}logInfo(...e){this.logger.info(Oe(e))}logAndCreateError(...e){let t=Oe(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var ve=class extends le{constructor(t){super(t);this._tokenList=[];this._tokenMap=new Map;this._blackTokenMap=new Set;this._mintGroup={official:new Set,jup:new Set,extra:new Set};this._whiteMap=new Set;this._extraTokenList=[]}async load(t){this.checkDisabled();let{forceUpdate:r=!1,type:w="strict"}=t||{},{mintList:m,blacklist:p,whiteList:o}=await this.scope.fetchV3TokenList(r),P=await this.scope.fetchJupTokenList(r);this._tokenList=[],this._tokenMap=new Map,this._blackTokenMap=new Set(p),this._mintGroup={official:new Set,jup:new Set,extra:new Set},this._whiteMap=new Set(o),this._tokenMap.set(H.address,H),this._mintGroup.official.add(H.address),m.forEach(i=>{var f;this._blackTokenMap.has(i.address)||(this._tokenMap.set(i.address,K(O({},i),{type:"raydium",priority:2,programId:(f=i.programId)!=null?f:i.tags.includes("token-2022")?Ee.toBase58():_e.toBase58()})),this._mintGroup.official.add(i.address))}),P.forEach(i=>{var f;this._blackTokenMap.has(i.address)||this._tokenMap.has(i.address)||(this._tokenMap.set(i.address,K(O({},i),{type:"jupiter",priority:1,programId:(f=i.programId)!=null?f:i.tags.includes("token-2022")?Ee.toBase58():_e.toBase58(),tags:i.freezeAuthority?[...i.tags||[],"hasFreeze"]:i.tags})),this._mintGroup.jup.add(i.address))}),this._extraTokenList.forEach(i=>{this._blackTokenMap.has(i.address)||this._tokenMap.has(i.address)||(this._tokenMap.set(i.address,K(O({},i),{type:"extra",priority:1,programId:i.programId||i.tags.includes("token-2022")?Ee.toBase58():_e.toBase58()})),this._mintGroup.extra.add(i.address))}),this._tokenList=Array.from(this._tokenMap).map(i=>i[1])}get tokenList(){return this._tokenList}get tokenMap(){return this._tokenMap}get blackTokenMap(){return this._blackTokenMap}get mintGroup(){return this._mintGroup}get whiteListMap(){return this._whiteMap}async getTokenInfo(t){if(!t)throw new Error("please input mint");let r=t.toString(),w=this._tokenMap.get(r);if(w)return w;if(r.toLocaleUpperCase()==="SOL")return H;let m=(await this.scope.api.getTokenInfo([r]))[0];if(m)return this._mintGroup.extra.add(r),this._tokenMap.set(r,K(O({},m),{priority:2})),m;let p=await this.scope.connection.getAccountInfo(new Ot(r));if(!p)throw new Error(`mint address not found: ${r}`);let o=Et.decode(p.data),P=r.toString().substring(0,6),i={chainId:101,address:r,programId:p.owner.toBase58(),logoURI:"",symbol:P,name:P,decimals:o.decimals,tags:[],extensions:{},priority:0,type:"unknown"};return this._mintGroup.extra.add(r),this._tokenMap.set(r,i),i}};export{ve as default};
//# sourceMappingURL=token.mjs.map