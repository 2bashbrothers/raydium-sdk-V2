var bi=Object.create;var Ge=Object.defineProperty,yi=Object.defineProperties,gi=Object.getOwnPropertyDescriptor,Pi=Object.getOwnPropertyDescriptors,Ai=Object.getOwnPropertyNames,st=Object.getOwnPropertySymbols,wi=Object.getPrototypeOf,Mt=Object.prototype.hasOwnProperty,fn=Object.prototype.propertyIsEnumerable;var pn=(n,t,e)=>t in n?Ge(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,E=(n,t)=>{for(var e in t||(t={}))Mt.call(t,e)&&pn(n,e,t[e]);if(st)for(var e of st(t))fn.call(t,e)&&pn(n,e,t[e]);return n},z=(n,t)=>yi(n,Pi(t));var ge=(n,t)=>{var e={};for(var i in n)Mt.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&st)for(var i of st(n))t.indexOf(i)<0&&fn.call(n,i)&&(e[i]=n[i]);return e};var ki=(n,t)=>{for(var e in t)Ge(n,e,{get:t[e],enumerable:!0})},bn=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Ai(t))!Mt.call(n,r)&&r!==e&&Ge(n,r,{get:()=>t[r],enumerable:!(i=gi(t,r))||i.enumerable});return n};var v=(n,t,e)=>(e=n!=null?bi(wi(n)):{},bn(t||!n||!n.__esModule?Ge(e,"default",{value:n,enumerable:!0}):e,n)),Ti=n=>bn(Ge({},"__esModule",{value:!0}),n);var Lr={};ki(Lr,{default:()=>Nt});module.exports=Ti(Lr);var k=require("@solana/web3.js"),j=require("@solana/spl-token");var pe=v(require("bn.js")),Wi=v(require("decimal.js"));var Dn=v(require("big.js")),Di=v(require("bn.js"));var Ue=require("lodash");var Ot=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},yn={},Bi={};function J(n){let t=(0,Ue.get)(yn,n);if(!t){let e=(0,Ue.get)(Bi,n);t=new Ot({name:n,logLevel:e}),(0,Ue.set)(yn,n,t)}return t}var Dt=require("@solana/web3.js");var we=require("@solana/spl-token"),Ft=J("Raydium_accountInfo_util");async function Xe(n,t,e){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=E({batchRequest:!1},e),a=Et(t,o),s=new Array(a.length).fill([]);if(i){let l=a.map(u=>{let d=n._buildArgs([u.map(c=>c.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),p=Et(l,10);s=(await(await Promise.all(p.map(async u=>await n._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&Ft.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(d=>{if(d){let{data:c,executable:y,lamports:f,owner:m,rentEpoch:T}=d;return c.length!==2&&c[1]!=="base64"&&Ft.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(c[0],"base64"),executable:y,lamports:f,owner:new Dt.PublicKey(m),rentEpoch:T}}return null})))}else try{s=await Promise.all(a.map(l=>n.getMultipleAccountsInfo(l,r)))}catch(l){l instanceof Error&&Ft.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.message}`)}return s.flat()}async function xe(n,t,e){let i=await Xe(n,t.map(r=>r.pubkey),e);return t.map((r,o)=>z(E({},r),{accountInfo:i[o]}))}async function vt({connection:n,mints:t,config:e}){var o,a,s;if(t.length===0)return{};let i=await xe(n,t.map(l=>({pubkey:ze(l)})),e),r={};for(let l of i){if(!l.accountInfo||l.accountInfo.data.length<we.MINT_SIZE){console.log("invalid mint account",l.pubkey.toBase58());continue}let p=(0,we.unpackMint)(l.pubkey,l.accountInfo,(o=l.accountInfo)==null?void 0:o.owner);r[l.pubkey.toString()]=z(E({},p),{programId:((a=l.accountInfo)==null?void 0:a.owner)||we.TOKEN_PROGRAM_ID,feeConfig:(s=(0,we.getTransferFeeConfig)(p))!=null?s:void 0})}return r[Dt.PublicKey.default.toBase58()]=r[re.toBase58()],r}var Re=v(require("bn.js"));var gn=9007199254740991;function fe(n){let t=J("Raydium_parseBigNumberish");if(n instanceof Re.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new Re.default(n);t.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&t.logWithError(`BigNumberish number underflow: ${n}`),(n>=gn||n<=-gn)&&t.logWithError(`BigNumberish number overflow: ${n}`),new Re.default(String(n))):typeof n=="bigint"?new Re.default(n.toString()):(t.error(`invalid BigNumberish value: ${n}`),new Re.default(0))}var Pn=require("@solana/web3.js"),Wt=require("@solana/spl-token"),Vt={chainId:101,address:Pn.PublicKey.default.toBase58(),programId:Wt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ke={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Wt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ut=require("@solana/web3.js");var _=require("@solana/web3.js"),An=require("@solana/spl-token");function _t({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var Ur=[_t({pubkey:An.TOKEN_PROGRAM_ID,isWritable:!1}),_t({pubkey:_.SystemProgram.programId,isWritable:!1}),_t({pubkey:_.SYSVAR_RENT_PUBKEY,isWritable:!1})];function qt({publicKey:n,transformSol:t}){let e=wn(n.toString());if(e instanceof _.PublicKey)return t&&e.equals(He)?re:e;if(t&&e.toString()===He.toBase58())return re;if(typeof e=="string"){if(e===_.PublicKey.default.toBase58())return _.PublicKey.default;try{return new _.PublicKey(e)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function wn(n){try{return new _.PublicKey(n)}catch{return n}}var hi=new _.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),at=new _.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ct=new _.PublicKey("SysvarRent111111111111111111111111111111111"),Xr=new _.PublicKey("SysvarC1ock11111111111111111111111111111111"),Ne=new _.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),zr=new _.PublicKey("Sysvar1nstructions1111111111111111111111111"),kn=_.SystemProgram.programId,Hr=new _.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Zr=new _.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),jr=new _.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Yr=new _.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Qr=new _.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Jr=new _.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),$r=new _.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),eo=new _.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),to=new _.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),no=new _.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),io=new _.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),re=new _.PublicKey("So11111111111111111111111111111111111111112"),He=_.PublicKey.default;function ze(n){return qt({publicKey:n,transformSol:!0})}var Gt=class{constructor({mint:t,decimals:e,symbol:i,name:r,skipMint:o=!1,isToken2022:a=!1}){if(t===He.toBase58()||t instanceof ut.PublicKey&&He.equals(t)){this.decimals=ke.decimals,this.symbol=ke.symbol,this.name=ke.name,this.mint=new ut.PublicKey(ke.address),this.isToken2022=!1;return}this.decimals=e,this.symbol=i||t.toString().substring(0,6),this.name=r||t.toString().substring(0,6),this.mint=o?ut.PublicKey.default:qt({publicKey:t}),this.isToken2022=a}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Te=Gt;Te.WSOL=new Gt(z(E({},ke),{mint:ke.address}));var Ut=class{constructor({decimals:t,symbol:e="UNKNOWN",name:i="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=i}equals(t){return this===t}},lt=Ut;lt.SOL=new Ut(Vt);var Tn=v(require("toformat")),xi=Tn.default,Ze=xi;var je=v(require("big.js")),Bn=v(require("bn.js")),hn=v(require("decimal.js-light"));var mt=J("module/fraction"),Xt=Ze(je.default),Ye=Ze(hn.default),Si={[0]:Ye.ROUND_DOWN,[1]:Ye.ROUND_HALF_UP,[2]:Ye.ROUND_UP},Ci={[0]:je.default.roundDown,[1]:je.default.roundHalfUp,[2]:je.default.roundUp},X=class{constructor(t,e=new Bn.default(1)){this.numerator=fe(t),this.denominator=fe(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new X(this.denominator,this.numerator)}add(t){let e=t instanceof X?t:new X(fe(t));return this.denominator.eq(e.denominator)?new X(this.numerator.add(e.numerator),this.denominator):new X(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof X?t:new X(fe(t));return this.denominator.eq(e.denominator)?new X(this.numerator.sub(e.numerator),this.denominator):new X(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof X?t:new X(fe(t));return new X(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof X?t:new X(fe(t));return new X(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},i=1){Number.isInteger(t)||mt.logWithError(`${t} is not an integer.`),t<=0&&mt.logWithError(`${t} is not positive.`),Ye.set({precision:t+1,rounding:Si[i]});let r=new Ye(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return r.toFormat(r.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},i=1){return Number.isInteger(t)||mt.logWithError(`${t} is not an integer.`),t<0&&mt.logWithError(`${t} is negative.`),Xt.DP=t,Xt.RM=Ci[i]||1,new Xt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var In=v(require("bn.js"));var xn=new X(new In.default(100)),ae=class extends X{toSignificant(t=5,e,i){return this.mul(xn).toSignificant(t,e,i)}toFixed(t=2,e,i){return this.mul(xn).toFixed(t,e,i)}};var xo=J("Raydium_price");function Et(n,t=1,e=[]){let i=[...n];if(t<=0)return e;for(;i.length;)e.push(i.splice(0,t));return e}var Ln=require("@solana/web3.js"),Rn=require("@solana/spl-token");var te=require("@solana/web3.js");var ee={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Cn=require("@solana/spl-token"),Sn=J("Raydium_txUtil"),Kn=1644;function pt(n){let t=[],e=[];return n.microLamports&&(t.push(te.ComputeBudgetProgram.setComputeUnitPrice({microLamports:n.microLamports})),e.push(ee.SetComputeUnitPrice)),n.units&&(t.push(te.ComputeBudgetProgram.setComputeUnitLimit({units:n.units})),e.push(ee.SetComputeUnitLimit)),{instructions:t,instructionTypes:e}}async function Me(n,t){var i,r;let e=t!=null?t:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:e})))==null?void 0:r.blockhash}async function ft(n,t){return n.getSignatureStatuses([t]),new Promise((e,i)=>{let r=setTimeout(i,6e4);n.onSignature(t,o=>{if(clearTimeout(r),!o.err){e("");return}i(Object.assign(o.err,{txId:t}))},"confirmed")})}function Ki(n,t){n.length<1&&Sn.logWithError(`no instructions provided: ${n.toString()}`),t.length<1&&Sn.logWithError(`no signers provided:, ${t.toString()}`);let e=new te.Transaction;e.recentBlockhash="11111111111111111111111111111111",e.feePayer=t[0],e.add(...n);try{return Buffer.from(e.serialize({verifySignatures:!1})).toString("base64").length<Kn}catch{return!1}}function me(n,t){let[e,i]=te.PublicKey.findProgramAddressSync(n,t);return{publicKey:e,nonce:i}}function Qe({instructions:n,payer:t,signers:e}){return Ki(n,[t,...e])}function Je({instructions:n,payer:t,lookupTableAddressAccount:e,recentBlockhash:i=te.Keypair.generate().publicKey.toString()}){let o=new te.TransactionMessage({payerKey:t,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(e!=null?e:{}));try{return Buffer.from(new te.VersionedTransaction(o).serialize()).toString("base64").length<Kn}catch{return!1}}var Li=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Ri=n=>{let t=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof te.VersionedTransaction&&(t=Li(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function Ie(n){let t=[];return n.forEach(e=>{e instanceof te.Transaction&&(e.recentBlockhash||(e.recentBlockhash=Cn.TOKEN_PROGRAM_ID.toBase58()),e.feePayer||(e.feePayer=te.Keypair.generate().publicKey)),t.push(Ri(e))}),console.log("simulate tx string:",t),t}function ce(n,t,e){return me([n.toBuffer(),(e!=null?e:Rn.TOKEN_PROGRAM_ID).toBuffer(),t.toBuffer()],new Ln.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var K=require("@solana/web3.js"),es=new K.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ts=new K.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ns=new K.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),is=new K.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),rs=new K.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),os=new K.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ss=new K.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),as=new K.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),cs=new K.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),us=new K.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ni=new K.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Mi=new K.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Oi=new K.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ls=new K.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ms=new K.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ds=new K.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ps=new K.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),fs=new K.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),bs=new K.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ys=new K.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Nn=new K.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Mn=new K.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),gs=new K.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),bt=new K.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),yt=new K.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ps=new K.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),As=new K.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ws=new K.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),ks=new K.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ts=new K.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Bs=new K.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var hs={OPEN_BOOK_PROGRAM:new K.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new K.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new K.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new K.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new K.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new K.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new K.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new K.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new K.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new K.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new K.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new K.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:K.PublicKey.default,Router:new K.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new K.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new K.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new K.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new K.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new K.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new K.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new K.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new K.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new K.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new K.PublicKey("Ray1111111111111111111111111111111111111111")};var ue=v(require("bn.js")),$e=1e4;function be(n,t,e,i){if(t===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let r=z(E({},t),{olderTransferFee:{epoch:BigInt(t.olderTransferFee.epoch),maximumFee:BigInt(t.olderTransferFee.maximumFee),transferFeeBasisPoints:t.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(t.newerTransferFee.epoch),maximumFee:BigInt(t.newerTransferFee.maximumFee),transferFeeBasisPoints:t.newerTransferFee.transferFeeBasisPoints}}),o=e.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,a=new ue.default(o.maximumFee.toString()),s=e.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*e.slotsInEpoch-e.absoluteSlot)*400/1e3:void 0;if(i)if(o.transferFeeBasisPoints===$e){let l=new ue.default(o.maximumFee.toString());return{amount:n.add(l),fee:l,expirationTime:s}}else{let l=Oe(n.mul(new ue.default($e)),new ue.default($e-o.transferFeeBasisPoints)),p=new ue.default(o.maximumFee.toString()),b=l.sub(n).gt(p)?n.add(p):l,u=Oe(b.mul(new ue.default(o.transferFeeBasisPoints)),new ue.default($e)),d=u.gt(a)?a:u;return{amount:b,fee:d,expirationTime:s}}else{let l=Oe(n.mul(new ue.default(o.transferFeeBasisPoints)),new ue.default($e)),p=l.gt(a)?a:l;return{amount:n,fee:p,expirationTime:s}}}function Oe(n,t){let{div:e,mod:i}=n.divmod(t);return i.gt(new ue.default(0))?e.add(new ue.default(1)):e}var de=require("@solana/web3.js");async function Zt({connection:n,address:t,cluster:e="mainnet"}){let i=await Xe(n,[...new Set(t.map(o=>o.toString()))].map(o=>new de.PublicKey(o))),r={};for(let o=0;o<t.length;o++){let a=i[o],s=t[o];if(!a)continue;let l=new de.AddressLookupTableAccount({key:s,state:de.AddressLookupTableAccount.deserialize(a.data)});r[s.toString()]=l,e==="devnet"?Fe[s.toString()]=l:gt[s.toString()]=l}return r}var gt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new de.AddressLookupTableAccount({key:new de.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:de.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Fe={},jt=async n=>{let t="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Fe[t])return Fe;let e=new de.PublicKey(t),i=await n.getAccountInfo(e);return i&&(Fe[t]=new de.AddressLookupTableAccount({key:e,state:de.AddressLookupTableAccount.deserialize(i.data)})),Fe};var V=require("@solana/web3.js"),Fn=v(require("axios"));var Pt=2e3,At=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.loopMultiTxStatus=!!t.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let t=(await Fn.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:e}=(i=t==null?void 0:t[15])!=null?i:{};if(!!e)return{units:6e5,microLamports:Math.min(Math.ceil(e*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:e,instructionTypes:i}=pt(t);return this.instructions.unshift(...e),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(t){var e;return t?(this.endInstructions.push(V.SystemProgram.transfer({fromPubkey:(e=t.feePayer)!=null?e:this.feePayer,toPubkey:new V.PublicKey(t.address),lamports:BigInt(t.amount.toString())})),this.endInstructionTypes.push(ee.TransferTip),!0):!1}async calComputeBudget({config:t,defaultIns:e}){try{let i=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;e&&this.instructions.unshift(...e)}catch{e&&this.instructions.unshift(...e)}}addInstruction({instructions:t=[],endInstructions:e=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:a=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...a.filter(s=>s!==V.PublicKey.default.toString())),this}async versionBuild({txVersion:t,extInfo:e}){return t===0?await this.buildV0(E({},e||{})):this.build(e)}build(t){var i;let e=new V.Transaction;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:e,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var b;let{recentBlockHash:o,skipPreflight:a=!0,sendAndConfirm:s,notSendToRpc:l}=r||{},p=o!=null?o:await Me(this.connection,this.blockhashCommitment);if(e.recentBlockhash=p,this.signers.length&&e.sign(...this.signers),Ie([e]),(b=this.owner)!=null&&b.isKeyPair)return{txId:s?await(0,V.sendAndConfirmTransaction)(this.connection,e,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(e.serialize(),{skipPreflight:a}),signedTx:e};if(this.signAllTransactions){let u=await this.signAllTransactions([e]);if(this.signers.length)for(let d of u)try{d.sign(...this.signers)}catch{}return{txId:l?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:a}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var p;let{extraPreBuildData:e=[],extInfo:i}=t,{transaction:r}=this.build(i),o=e.filter(b=>b.transaction.instructions.length>0),a=[r,...o.map(b=>b.transaction)],s=[this.signers,...o.map(b=>b.signers)],l=[...this.instructionTypes,...o.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&s.forEach(b=>{b.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:s,instructionTypes:l,execute:async b=>{var T;let{sequentially:u,onTxUpdate:d,skipTxCount:c=0,recentBlockHash:y,skipPreflight:f=!0}=b||{},m=y!=null?y:await Me(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(u){let A=[],B=0;for(let P of a){if(++B,B<=c)continue;let g=await(0,V.sendAndConfirmTransaction)(this.connection,P,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(g)}return{txIds:A,signedTxs:a}}return{txIds:await await Promise.all(a.map(async A=>(A.recentBlockhash=m,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f})))),signedTxs:a}}if(this.signAllTransactions){let A=a.map((P,g)=>(P.recentBlockhash=m,s[g].length&&P.sign(...s[g]),P));Ie(A);let B=await this.signAllTransactions(A);if(u){let P=0,g=[],w=async()=>{if(!B[P])return;let h=await this.connection.sendRawTransaction(B[P].serialize(),{skipPreflight:f});g.push({txId:h,status:"sent",signedTx:B[P]}),d==null||d([...g]),P++;let x=!1,N=null,S=null,M=R=>{N!==null&&clearInterval(N),S!==null&&this.connection.removeSignatureListener(S);let F=g.findIndex(W=>W.txId===h);if(F>-1){if(g[F].status==="error"||g[F].status==="success")return;g[F].status=R.err?"error":"success"}d==null||d([...g]),R.err||w()};this.loopMultiTxStatus&&(N=setInterval(async()=>{var R;if(x){clearInterval(N);return}try{let F=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(x=!0,clearInterval(N),M({err:((R=F.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",h))}catch(F){x=!0,clearInterval(N),console.error("getTransaction timeout:",F,h)}},Pt)),S=this.connection.onSignature(h,R=>{if(x){this.connection.removeSignatureListener(S);return}x=!0,M(R)},"confirmed"),this.connection.getSignatureStatus(h)};return await w(),{txIds:g.map(h=>h.txId),signedTxs:B}}else{let P=[];for(let g=0;g<B.length;g+=1){let w=await this.connection.sendRawTransaction(B[g].serialize(),{skipPreflight:f});P.push(w)}return{txIds:P,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:e,extInfo:i}){return e===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:i})}async buildV0(t){var f;let y=t||{},{lookupTableCache:e={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=y,a=ge(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),s=E(E({},this.cluster==="devnet"?await jt(this.connection):gt),e),l=Array.from(new Set([...i,...this.lookupTableAddress])),p=[];for(let m of l)s[m]===void 0&&p.push(new V.PublicKey(m));let b=await Zt({connection:this.connection,address:p});for(let[m,T]of Object.entries(b))s[m]=T;let u=r?V.PublicKey.default.toBase58():o!=null?o:await Me(this.connection,this.blockhashCommitment),d=new V.TransactionMessage({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(m=>m.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let c=new V.VersionedTransaction(d);return c.sign(this.signers),{builder:this,transaction:c,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async m=>{var P;let{skipPreflight:T=!0,sendAndConfirm:A,notSendToRpc:B}=m||{};if(Ie([c]),(P=this.owner)!=null&&P.isKeyPair){let g=await this.connection.sendTransaction(c,{skipPreflight:T});return A&&await ft(this.connection,g),{txId:g,signedTx:c}}if(this.signAllTransactions){let g=await this.signAllTransactions([c]);if(this.signers.length)for(let w of g)try{w.sign(this.signers)}catch{}return{txId:B?"":await this.connection.sendTransaction(g[0],{skipPreflight:T}),signedTx:g[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(t){var p;let{extraPreBuildData:e=[],buildProps:i}=t,{transaction:r}=await this.buildV0(i),o=e.filter(b=>b.builder.instructions.length>0),a=[r,...o.map(b=>b.transaction)],s=[this.signers,...o.map(b=>b.signers)],l=[...this.instructionTypes,...o.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&s.forEach(b=>{b.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(b,u)=>{b.sign(s[u])}),{builder:this,transactions:a,signers:s,instructionTypes:l,buildProps:i,execute:async b=>{var f;let{sequentially:u,onTxUpdate:d,recentBlockHash:c,skipPreflight:y=!0}=b||{};if(c&&a.forEach(m=>m.message.recentBlockhash=c),Ie(a),(f=this.owner)!=null&&f.isKeyPair){if(u){let m=[];for(let T of a){let A=await this.connection.sendTransaction(T,{skipPreflight:y});await ft(this.connection,A),m.push(A)}return{txIds:m,signedTxs:a}}return{txIds:await Promise.all(a.map(async m=>await this.connection.sendTransaction(m,{skipPreflight:y}))),signedTxs:a}}if(this.signAllTransactions){let m=await this.signAllTransactions(a);if(u){let T=0,A=[],B=async()=>{if(!m[T])return;let P=await this.connection.sendTransaction(m[T],{skipPreflight:y});A.push({txId:P,status:"sent",signedTx:m[T]}),d==null||d([...A]),T++;let g=!1,w=null,h=null,x=N=>{w!==null&&clearInterval(w),h!==null&&this.connection.removeSignatureListener(h);let S=A.findIndex(M=>M.txId===P);if(S>-1){if(A[S].status==="error"||A[S].status==="success")return;A[S].status=N.err?"error":"success"}d==null||d([...A]),N.err||B()};this.loopMultiTxStatus&&(w=setInterval(async()=>{var N;if(g){clearInterval(w);return}try{let S=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});S&&(g=!0,clearInterval(w),x({err:((N=S.meta)==null?void 0:N.err)||null}),console.log("tx status from getTransaction:",P))}catch(S){g=!0,clearInterval(w),console.error("getTransaction timeout:",S,P)}},Pt)),h=this.connection.onSignature(P,N=>{if(g){this.connection.removeSignatureListener(h);return}g=!0,x(N)},"confirmed"),this.connection.getSignatureStatus(P)};return B(),{txIds:[],signedTxs:m}}else{let T=[];for(let A=0;A<m.length;A+=1){let B=await this.connection.sendTransaction(m[A],{skipPreflight:y});T.push(B)}return{txIds:T,signedTxs:m}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(t){var d;let u=t||{},{splitIns:e=[],computeBudgetConfig:i}=u,r=ge(u,["splitIns","computeBudgetConfig"]),o=i?pt(i):{instructions:[],instructionTypes:[]},a=this.signers.reduce((c,y)=>z(E({},c),{[y.publicKey.toBase58()]:y}),{}),s=[],l=[],p=[],b=0;if(this.allInstructions.forEach(c=>{let y=[...p,c],f=i?[...o.instructions,...y]:y,T=[...new Set(y.map(A=>A.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(A=>new V.PublicKey(A));if(c!==e[b]&&p.length<12&&(Qe({instructions:f,payer:this.feePayer,signers:T})||Qe({instructions:y,payer:this.feePayer,signers:T})))p.push(c);else{if(p.length===0)throw Error("item ins too big");b+=c===e[b]?1:0,Qe({instructions:i?[...o.instructions,...p]:[...p],payer:this.feePayer,signers:T})?s.push(new V.Transaction().add(...o.instructions,...p)):s.push(new V.Transaction().add(...p)),l.push(Array.from(new Set(p.map(A=>A.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(A=>a[A]).filter(A=>A!==void 0)),p=[c]}}),p.length>0){let y=[...new Set(p.map(f=>f.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()).values()].map(f=>a[f]).filter(f=>f!==void 0);Qe({instructions:i?[...o.instructions,...p]:[...p],payer:this.feePayer,signers:y.map(f=>f.publicKey)})?s.push(new V.Transaction().add(...o.instructions,...p)):s.push(new V.Transaction().add(...p)),l.push(y)}return s.forEach(c=>c.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&l.forEach(c=>{c.some(y=>y.publicKey.equals(this.owner.publicKey))||c.push(this.owner.signer)}),{builder:this,transactions:s,signers:l,instructionTypes:this.instructionTypes,execute:async c=>{var P;let{sequentially:y,onTxUpdate:f,skipTxCount:m=0,recentBlockHash:T,skipPreflight:A=!0}=c||{},B=T!=null?T:await Me(this.connection,this.blockhashCommitment);if(s.forEach(async(g,w)=>{g.recentBlockhash=B,l[w].length&&g.sign(...l[w])}),Ie(s),(P=this.owner)!=null&&P.isKeyPair){if(y){let g=0,w=[];for(let h of s){if(++g,g<=m){w.push("tx skipped");continue}let x=await(0,V.sendAndConfirmTransaction)(this.connection,h,this.signers.find(N=>N.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});w.push(x)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async g=>await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:A}))),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s.slice(m,s.length)),w=[...s.slice(0,m),...g];if(y){let h=0,x=[],N=async()=>{if(!w[h])return;h<m&&(x.push({txId:"",status:"success",signedTx:w[h]}),f==null||f([...x]),h++,N());let S=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:A});x.push({txId:S,status:"sent",signedTx:w[h]}),f==null||f([...x]),h++;let M=!1,R=null,F=null,W=D=>{R!==null&&clearInterval(R),F!==null&&this.connection.removeSignatureListener(F);let G=x.findIndex(Q=>Q.txId===S);if(G>-1){if(x[G].status==="error"||x[G].status==="success")return;x[G].status=D.err?"error":"success"}f==null||f([...x]),D.err||N()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var D;if(M){clearInterval(R);return}try{let G=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});G&&(M=!0,clearInterval(R),W({err:((D=G.meta)==null?void 0:D.err)||null}),console.log("tx status from getTransaction:",S))}catch(G){M=!0,clearInterval(R),console.error("getTransaction timeout:",G,S)}},Pt)),F=this.connection.onSignature(S,D=>{if(M){this.connection.removeSignatureListener(F);return}M=!0,W(D)},"confirmed"),this.connection.getSignatureStatus(S)};return await N(),{txIds:x.map(S=>S.txId),signedTxs:w}}else{let h=[];for(let x=0;x<w.length;x+=1){let N=await this.connection.sendRawTransaction(w[x].serialize(),{skipPreflight:A});h.push(N)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){var B;let A=t||{},{computeBudgetConfig:e,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=A,a=ge(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),s=E(E({},this.cluster==="devnet"?await jt(this.connection):gt),r),l=Array.from(new Set([...this.lookupTableAddress,...o])),p=[];for(let P of l)s[P]===void 0&&p.push(new V.PublicKey(P));let b=await Zt({connection:this.connection,address:p});for(let[P,g]of Object.entries(b))s[P]=g;let u=e?pt(e):{instructions:[],instructionTypes:[]},d=await Me(this.connection,this.blockhashCommitment),c=this.signers.reduce((P,g)=>z(E({},P),{[g.publicKey.toBase58()]:g}),{}),y=[],f=[],m=[],T=0;if(this.allInstructions.forEach(P=>{let g=[...m,P],w=e?[...u.instructions,...g]:g;if(P!==i[T]&&m.length<12&&(Je({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||Je({instructions:g,payer:this.feePayer,lookupTableAddressAccount:s})))m.push(P);else{if(m.length===0)throw Error("item ins too big");T+=P===i[T]?1:0;let h={};for(let x of[...new Set(l)])s[x]!==void 0&&(h[x]=s[x]);if(e&&Je({instructions:[...u.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let x=new V.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...m]}).compileToV0Message(Object.values(s));y.push(new V.VersionedTransaction(x))}else{let x=new V.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m]}).compileToV0Message(Object.values(s));y.push(new V.VersionedTransaction(x))}f.push(Array.from(new Set(m.map(x=>x.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat())).map(x=>c[x]).filter(x=>x!==void 0)),m=[P]}}),m.length>0){let g=[...new Set(m.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(w=>c[w]).filter(w=>w!==void 0);if(e&&Je({instructions:[...u.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let w=new V.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...m]}).compileToV0Message(Object.values(s));y.push(new V.VersionedTransaction(w))}else{let w=new V.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m]}).compileToV0Message(Object.values(s));y.push(new V.VersionedTransaction(w))}f.push(g)}return(B=this.owner)!=null&&B.signer&&f.forEach(P=>{P.some(g=>g.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),y.forEach((P,g)=>{P.sign(f[g])}),{builder:this,transactions:y,buildProps:t,signers:f,instructionTypes:this.instructionTypes,execute:async P=>{var S;let{sequentially:g,onTxUpdate:w,skipTxCount:h=0,recentBlockHash:x,skipPreflight:N=!0}=P||{};if(y.map(async(M,R)=>{f[R].length&&M.sign(f[R]),x&&(M.message.recentBlockhash=x)}),Ie(y),(S=this.owner)!=null&&S.isKeyPair){if(g){let M=0,R=[];for(let F of y){if(++M,M<=h){console.log("skip tx: ",M),R.push("tx skipped");continue}let W=await this.connection.sendTransaction(F,{skipPreflight:N});await ft(this.connection,W),R.push(W)}return{txIds:R,signedTxs:y}}return{txIds:await Promise.all(y.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:N}))),signedTxs:y}}if(this.signAllTransactions){let M=await this.signAllTransactions(y.slice(h,y.length)),R=[...y.slice(0,h),...M];if(g){let F=0,W=[],D=async()=>{if(!R[F])return;if(F<h){W.push({txId:"",status:"success",signedTx:R[F]}),w==null||w([...W]),F++,D();return}let G=await this.connection.sendTransaction(R[F],{skipPreflight:N});W.push({txId:G,status:"sent",signedTx:R[F]}),w==null||w([...W]),F++;let Q=!1,le=null,Be=null,dn=he=>{le!==null&&clearInterval(le),Be!==null&&this.connection.removeSignatureListener(Be);let ye=W.findIndex(fi=>fi.txId===G);if(ye>-1){if(W[ye].status==="error"||W[ye].status==="success")return;W[ye].status=he.err?"error":"success"}w==null||w([...W]),he.err||D()};this.loopMultiTxStatus&&(le=setInterval(async()=>{var he;if(Q){clearInterval(le);return}try{let ye=await this.connection.getTransaction(G,{commitment:"confirmed",maxSupportedTransactionVersion:0});ye&&(Q=!0,clearInterval(le),dn({err:((he=ye.meta)==null?void 0:he.err)||null}),console.log("tx status from getTransaction:",G))}catch(ye){Q=!0,clearInterval(le),console.error("getTransaction timeout:",ye,G)}},Pt)),Be=this.connection.onSignature(G,he=>{if(Q){this.connection.removeSignatureListener(Be);return}Q=!0,dn(he)},"confirmed"),this.connection.getSignatureStatus(G)};return D(),{txIds:[],signedTxs:R}}else{let F=[];for(let W=0;W<R.length;W+=1){let D=await this.connection.sendTransaction(R[W],{skipPreflight:N});F.push(D)}return{txIds:F,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};var Fi=require("@solana/web3.js"),Ei=v(require("bn.js"));var En=v(require("bn.js")),wt=new En.default(1e6);var ga=J("Raydium_amount"),Pa=Ze(Dn.default);var Ht=new pe.default(0),Na=new pe.default(1),Ma=new pe.default(2),Oa=new pe.default(3),Fa=new pe.default(5),vi=new pe.default(10),Ea=new pe.default(100),Da=new pe.default(1e3),va=new pe.default(1e4);function vn(n,t,e){return n.mul(t).add(e).sub(new pe.default(1)).div(e)}function Yt(n,t,e){return n.mul(t).div(e)}var ht=v(require("bn.js")),et=v(require("decimal.js-light"));var De=v(require("bn.js"));function kt(n,t){if(t.isZero())throw Error("divisor is zero");return n.mod(t)}function Vi(n,t){if(t.isZero())throw Error("rhs is zero");let e=n.div(t);if(e.isZero())throw Error("quotient is zero");let i=kt(n,t);return i.gt(Ee)&&(e=e.add(new De.default(1)),t=n.div(e),i=kt(n,e),i.gt(Ee)&&(t=t.add(new De.default(1)))),[e,t]}var Ee=new De.default(0),Tt=class{static swapWithoutFees(t,e,i){let r=e.mul(i),o=e.add(t),[a]=Vi(r,o),s=i.sub(a);if(s.isZero())throw Error("destinationAmountSwapped is zero");return{destinationAmountSwapped:s}}static lpTokensToTradingTokens(t,e,i,r,o){let a=t.mul(i).div(e),s=t.mul(r).div(e);if(o===0)return{tokenAmount0:a,tokenAmount1:s};if(o===1)return kt(t.mul(i),e).gt(Ee)&&a.gt(Ee)&&(a=a.add(new De.default(1))),kt(t.mul(r),e).gt(Ee)&&s.gt(Ee)&&(s=s.add(new De.default(1))),{tokenAmount0:a,tokenAmount1:s};throw Error("roundDirection value error")}};var Bt=class{static tradingFee(t,e){return vn(t,e,wt)}static protocolFee(t,e){return Yt(t,e,wt)}static fundFee(t,e){return Yt(t,e,wt)}};var xt=class{static validate_supply(t,e){if(t.isZero())throw Error("tokenAmount0 is zero");if(e.isZero())throw Error("tokenAmount1 is zero")}static swap(t,e,i,r){let o=Bt.tradingFee(t,r),a=t.sub(o),{destinationAmountSwapped:s}=Tt.swapWithoutFees(a,e,i);return{newSwapDestinationAmount:i.sub(s),sourceAmountSwapped:t,destinationAmountSwapped:s,tradeFee:o}}static swapBaseOut({poolMintA:t,poolMintB:e,tradeFeeRate:i,baseReserve:r,quoteReserve:o,outputMint:a,outputAmount:s}){let[l,p,b,u,d]=e.address===a.toString()?[r,o,t.decimals,e.decimals,t.address]:[o,r,e.decimals,t.decimals,e.address],c=new et.default(p.toString()).div(10**u).div(new et.default(l.toString()).div(10**b)),y=s.gte(p)?p.sub(new ht.default(1)):s,f=p.sub(y),m=Oe(l.mul(y),f),T=Oe(m.mul(new ht.default(1e6)),new ht.default(1e6).sub(i)),A=T.sub(m),B=new et.default(y.toString()).div(10**u).div(new et.default(T.toString()).div(10**b)),P=c.isZero()?0:B.sub(c).div(c).abs().toNumber();return{amountRealOut:y,amountIn:T,amountInWithoutFee:m,tradeFee:A,priceImpact:P}}};var Y=v(require("bn.js")),se=v(require("decimal.js"));var Qt=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),ve=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=J(e)}createTxBuilder(t){return this.scope.checkOwner(),new At({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Qt(t))}logInfo(...t){this.logger.info(Qt(t))}logAndCreateError(...t){let e=Qt(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var qn=require("@solana/web3.js"),We=v(require("bn.js"));var L=require("@solana/buffer-layout"),Jt=L.Layout,Wn=L.Structure;var $t=L.UInt;var Vn=L.u8,Se=L.u16;var Pe=L.s32;var _n=L.seq;var ne=L.blob;var Ve=class extends Jt{constructor(e,i,r){super(e,r);this.blob=ne(e),this.signed=i}decode(e,i=0){let r=new We.default(this.blob.decode(e,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(e,i,r=0){return typeof e=="number"&&(e=new We.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),i,r)}};function H(n){return new $t(1,n)}function Ae(n){return new $t(4,n)}function I(n){return new Ve(8,!1,n)}function Z(n){return new Ve(16,!1,n)}function Gn(n){return new Ve(8,!0,n)}function Un(n){return new Ve(16,!0,n)}var It=class extends Jt{constructor(e,i,r,o){super(e.span,o);this.layout=e,this.decoder=i,this.encoder=r}decode(e,i){return this.decoder(this.layout.decode(e,i))}encode(e,i,r){return this.layout.encode(this.encoder(e),i,r)}getSpan(e,i){return this.layout.getSpan(e,i)}};function O(n){return new It(ne(32),t=>new qn.PublicKey(t),t=>t.toBuffer(),n)}function Ce(n){return new It(Vn(),_i,qi,n)}function _i(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function qi(n){return n?1:0}var en=class extends Wn{decode(t,e){return super.decode(t,e)}};function q(n,t,e){return new en(n,t,e)}function U(n,t,e){let i,r=typeof t=="number"?t:(0,We.isBN)(t)?t.toNumber():new Proxy(t,{get(o,a){if(!i){let s=Reflect.get(o,"count");i=(0,We.isBN)(s)?s.toNumber():s,Reflect.set(o,"count",i)}return Reflect.get(o,a)},set(o,a,s){return a==="count"&&(i=s),Reflect.set(o,a,s)}});return _n(n,r,e)}var pc=q([Ae("mintAuthorityOption"),O("mintAuthority"),I("supply"),H("decimals"),H("isInitialized"),Ae("freezeAuthorityOption"),O("freezeAuthority")]);var Gi=require("@solana/web3.js"),Xn=require("@solana/spl-token");var Ke=r=>{var o=r,{address:n,programId:t,decimals:e}=o,i=ge(o,["address","programId","decimals"]);return E({chainId:101,address:ze(n).toBase58(),programId:t,logoURI:"",symbol:"",name:"",decimals:e,tags:[],extensions:i.extensions||{}},i)},_e=n=>n?z(E({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:z(E({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:z(E({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;var $=require("@solana/web3.js"),ie=require("@solana/spl-token");var Ui=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Cc=Buffer.from("amm_config","utf8"),Xi=Buffer.from("pool","utf8"),zi=Buffer.from("pool_lp_mint","utf8"),Hi=Buffer.from("pool_vault","utf8"),Zi=Buffer.from("observation","utf8");function St(n){return me([Ui],n)}function tn(n,t,e,i){return me([Xi,t.toBuffer(),e.toBuffer(),i.toBuffer()],n)}function ji(n,t){return me([zi,t.toBuffer()],n)}function zn(n,t,e){return me([Hi,t.toBuffer(),e.toBuffer()],n)}function tt(n,t){return me([Zi,t.toBuffer()],n)}function Hn({poolId:n,programId:t,configId:e,mintA:i,mintB:r}){let o=St(t).publicKey,a=n||tn(t,e,i,r).publicKey,s=ji(t,a).publicKey,l=zn(t,a,i).publicKey,p=zn(t,a,r).publicKey,b=tt(t,a).publicKey;return{poolId:a,configId:e,authority:o,lpMint:s,vaultA:l,vaultB:p,observationId:b}}var Yi=Buffer.from("locked_liquidity","utf8");function nt(n,t){return me([Yi,t.toBuffer()],n)}var hr=require("@solana/web3.js"),xr=v(require("bn.js")),Ir=v(require("decimal.js"));var Rt=require("@solana/spl-token");var Lt=require("@solana/web3.js"),Br=v(require("bn.js"));var ln=require("@solana/spl-token");var mr=v(require("bn.js")),dr=v(require("decimal.js"));var oe=v(require("bn.js")),nn=new oe.default(0),Zn=new oe.default(1),jn=new oe.default(-1),Ct=new oe.default(1).shln(64),Yn=new oe.default(1).shln(128),Qi=Ct.sub(Zn);var Ji=Yn.subn(1),qe=-443636,it=-qe,rn=new oe.default("4295048016"),on=new oe.default("79226673521066979257578248091"),Lc=new oe.default("4295048017"),Rc=new oe.default("79226673521066979257578248090");var $i=new oe.default(10).pow(new oe.default(6));var Nc=new oe.default("18446744073700000000");var ur=v(require("bn.js")),lr=v(require("decimal.js"));var Wc=Buffer.from("amm_config","utf8"),Vc=Buffer.from("pool","utf8"),_c=Buffer.from("pool_vault","utf8"),qc=Buffer.from("pool_reward_vault","utf8"),Gc=Buffer.from("position","utf8"),Uc=Buffer.from("tick_array","utf8"),Xc=Buffer.from("operation","utf8"),zc=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Hc=Buffer.from("observation","utf8");function sn(n){return me([Buffer.from("metadata","utf8"),Ne.toBuffer(),n.toBuffer()],Ne)}var Zc=Buffer.from("locked_position","utf8");var jc=Buffer.from("support_mint","utf8");var rr=require("@solana/web3.js"),or=require("@solana/spl-token"),sr=v(require("bn.js")),ar=v(require("decimal.js"));var er=v(require("bn.js")),tr=v(require("decimal.js"));var un=14;var Kt=60;var pr=q([ne(8),H("bump"),Se("index"),O(""),Ae("protocolFeeRate"),Ae("tradeFeeRate"),Se("tickSpacing"),U(I(),8,"")]),fr=q([Ae("blockTimestamp"),Gn("tickCumulative"),U(I(),4)]),oi=q([ne(8),Ce("initialized"),I("recentEpoch"),Se("observationIndex"),O("poolId"),U(fr,100,"observations"),U(I(),4)]),br=q([H("rewardState"),I("openTime"),I("endTime"),I("lastUpdateTime"),Z("emissionsPerSecondX64"),I("rewardTotalEmissioned"),I("rewardClaimed"),O("tokenMint"),O("tokenVault"),O("creator"),Z("rewardGrowthGlobalX64")]),ni=q([ne(8),H("bump"),O("ammConfig"),O("creator"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("observationId"),H("mintDecimalsA"),H("mintDecimalsB"),Se("tickSpacing"),Z("liquidity"),Z("sqrtPriceX64"),Pe("tickCurrent"),Ae(),Z("feeGrowthGlobalX64A"),Z("feeGrowthGlobalX64B"),I("protocolFeesTokenA"),I("protocolFeesTokenB"),Z("swapInAmountTokenA"),Z("swapOutAmountTokenB"),Z("swapInAmountTokenB"),Z("swapOutAmountTokenA"),H("status"),U(H(),7,""),U(br,3,"rewardInfos"),U(I(),16,"tickArrayBitmap"),I("totalFeesTokenA"),I("totalFeesClaimedTokenA"),I("totalFeesTokenB"),I("totalFeesClaimedTokenB"),I("fundFeesTokenA"),I("fundFeesTokenB"),I("startTime"),U(I(),15*4-3,"padding")]),yr=q([Z("growthInsideLastX64"),I("rewardAmountOwed")]),ii=q([ne(8),H("bump"),O("nftMint"),O("poolId"),Pe("tickLower"),Pe("tickUpper"),Z("liquidity"),Z("feeGrowthInsideLastX64A"),Z("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),U(yr,3,"rewardInfos"),U(I(),8,"")]),cl=q([ne(8),H("bump"),O("poolId"),Pe("tickLowerIndex"),Pe("tickUpperIndex"),Z("liquidity"),Z("feeGrowthInsideLastX64A"),Z("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),U(Z(),3,"rewardGrowthInside"),U(I(),8,"")]),gr=q([Pe("tick"),Un("liquidityNet"),Z("liquidityGross"),Z("feeGrowthOutsideX64A"),Z("feeGrowthOutsideX64B"),U(Z(),3,"rewardGrowthsOutsideX64"),U(Ae(),13,"")]),$n=q([ne(8),O("poolId"),Pe("startTickIndex"),U(gr,Kt,"ticks"),H("initializedTickCount"),U(H(),115,"")]),Pr=q([ne(329),U(O(),100,"whitelistMints")]),cr=q([ne(8),O("poolId"),U(U(I(),8),un,"positiveTickArrayBitmap"),U(U(I(),8),un,"negativeTickArrayBitmap")]),ul=q([I(),H("bump"),O("owner"),O("poolId"),O("positionId"),O("nftAccount"),U(I(),8)]),Ar=q([ne(8),H("bump"),O("lockOwner"),O("poolId"),O("positionId"),O("nftAccount"),O("lockNftMint"),I("recentEpoch"),U(I(),8)]);oi.span;var Sl=J("Raydium_Clmm");var Sr=J("Raydium_cpmm"),Le={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function si(n,t,e,i,r,o,a,s,l,p,b,u,d,c,y,f,m,T,A,B){let P=q([I("amountMaxA"),I("amountMaxB"),I("openTime")]),g=tn(n,e,o,a).publicKey,w=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!r.equals(g),isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ie.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:ie.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:kn,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1}],h=Buffer.alloc(P.span);return P.encode({amountMaxA:T,amountMaxB:A,openTime:B},h),new $.TransactionInstruction({keys:w,programId:n,data:Buffer.from([...Le.initialize,...h])})}function ai(n,t,e,i,r,o,a,s,l,p,b,u,d,c,y){let f=q([I("lpAmount"),I("amountMaxA"),I("amountMaxB")]),m=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ie.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ie.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],T=Buffer.alloc(f.span);return Sr.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:c.toString(),amountMaxB:y.toString()}),f.encode({lpAmount:d,amountMaxA:c,amountMaxB:y},T),new $.TransactionInstruction({keys:m,programId:n,data:Buffer.from([...Le.deposit,...T])})}function ci(n,t,e,i,r,o,a,s,l,p,b,u,d,c,y){let f=q([I("lpAmount"),I("amountMinA"),I("amountMinB")]),m=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ie.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ie.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:at,isSigner:!1,isWritable:!1}],T=Buffer.alloc(f.span);return f.encode({lpAmount:d,amountMinA:c,amountMinB:y},T),new $.TransactionInstruction({keys:m,programId:n,data:Buffer.from([...Le.withdraw,...T])})}function ui(n,t,e,i,r,o,a,s,l,p,b,u,d,c,y,f){let m=q([I("amountIn"),I("amounOutMin")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0}],A=Buffer.alloc(m.span);return m.encode({amountIn:y,amounOutMin:f},A),new $.TransactionInstruction({keys:T,programId:n,data:Buffer.from([...Le.swapBaseInput,...A])})}function li(n,t,e,i,r,o,a,s,l,p,b,u,d,c,y,f){let m=q([I("amountInMax"),I("amountOut")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0}],A=Buffer.alloc(m.span);return m.encode({amountInMax:y,amountOut:f},A),new $.TransactionInstruction({keys:T,programId:n,data:Buffer.from([...Le.swapBaseOutput,...A])})}async function mi(n){var m;let{ownerInfo:t,poolInfo:e,poolKeys:i,feeNftOwner:r,getEphemeralSigners:o}=n,a=[],[s,l]=[new $.PublicKey(e.id),new $.PublicKey(e.lpMint.address)],p;if(o)p=new $.PublicKey((await o(1))[0]);else{let T=$.Keypair.generate();a.push(T),p=T.publicKey}let{publicKey:b}=ce(r,p,ie.TOKEN_PROGRAM_ID),{publicKey:u}=sn(p),{publicKey:d}=nt(n.lockProgram,p),{publicKey:c}=ce(t.wallet,l,ie.TOKEN_PROGRAM_ID),{publicKey:y}=ce(n.lockAuthProgram,l,ie.TOKEN_PROGRAM_ID),f=Cr({programId:n.lockProgram,auth:n.lockAuthProgram,payer:t.feePayer,liquidityOwner:t.wallet,nftOwner:r,nftMint:p,nftAccount:b,poolId:s,lockPda:d,mintLp:l,userLpVault:c,lockLpVault:y,poolVaultA:new $.PublicKey(i.vault.A),poolVaultB:new $.PublicKey(i.vault.B),metadataAccount:u,lpAmount:n.lpAmount,withMetadata:(m=n.withMetadata)!=null?m:!0});return{address:{nftMint:p,nftAccount:b,metadataAccount:u,lockPda:d,userLpVault:c,lockLpVault:y},instructions:[f],signers:a,instructionTypes:[ee.CpmmLockLp],lookupTableAddress:[]}}function Cr({programId:n,auth:t,payer:e,liquidityOwner:i,nftOwner:r,nftMint:o,nftAccount:a,poolId:s,lockPda:l,mintLp:p,userLpVault:b,lockLpVault:u,poolVaultA:d,poolVaultB:c,metadataAccount:y,lpAmount:f,withMetadata:m}){let T=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:$.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:ie.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ie.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1}],A=q([I("lpAmount"),Ce("withMetadata")]),B=Buffer.alloc(A.span);A.encode({lpAmount:f,withMetadata:m},B);let P=Buffer.from([...Le.lockCpLiquidity,...B]);return new $.TransactionInstruction({keys:T,programId:n,data:P})}function mn({programId:n,nftOwner:t,auth:e,nftAccount:i,lockPda:r,poolId:o,mintLp:a,userVaultA:s,userVaultB:l,poolVaultA:p,poolVaultB:b,mintA:u,mintB:d,lockLpVault:c,lpFeeAmount:y,cpmmProgram:f,cpmmAuthProgram:m}){let T=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:f!=null?f:Nn,isSigner:!1,isWritable:!1},{pubkey:m!=null?m:Mn,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:ie.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ie.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1}],A=q([I("lpFeeAmount")]),B=Buffer.alloc(A.span);A.encode({lpFeeAmount:y},B);let P=Buffer.from([...Le.collectCpFee,...B]);return new $.TransactionInstruction({keys:T,programId:n,data:P})}var di=q([ne(8),H("bump"),Ce("disableCreatePool"),Se("index"),I("tradeFeeRate"),I("protocolFeeRate"),I("fundFeeRate"),I("createPoolFee"),O("protocolOwner"),O("fundOwner"),U(I(),16)]),pi=q([ne(8),O("configId"),O("poolCreator"),O("vaultA"),O("vaultB"),O("mintLp"),O("mintA"),O("mintB"),O("mintProgramA"),O("mintProgramB"),O("observationId"),H("bump"),H("status"),H("lpDecimals"),H("mintDecimalA"),H("mintDecimalB"),I("lpAmount"),I("protocolFeesMintA"),I("protocolFeesMintB"),I("fundFeesMintA"),I("fundFeesMintB"),I("openTime"),U(I(),32)]);var Nt=class extends ve{constructor(t){super(t)}async load(){this.checkDisabled()}async getCpmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async getRpcPoolInfo(t,e){return(await this.getRpcPoolInfos([t],e))[t]}async getRpcPoolInfos(t,e){let i=await xe(this.scope.connection,t.map(u=>({pubkey:new k.PublicKey(u)}))),r={},o=new Set,a=[];for(let u=0;u<t.length;u++){let d=i[u];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(t[u]));let c=pi.decode(d.accountInfo.data);r[String(t[u])]=z(E({},c),{programId:d.accountInfo.owner}),o.add(String(c.configId)),a.push(c.vaultA,c.vaultB)}let s={};if(e){let u=[...o],d=await xe(this.scope.connection,u.map(c=>({pubkey:new k.PublicKey(c)})));for(let c=0;c<u.length;c++){let y=d[c].accountInfo;if(y===null)throw Error("fetch pool config error: "+u[c]);s[u[c]]=di.decode(y.data)}}let l={},p=await xe(this.scope.connection,a.map(u=>({pubkey:new k.PublicKey(u)})));for(let u=0;u<a.length;u++){let d=p[u].accountInfo;if(d===null)throw Error("fetch vault info error: "+a[u]);l[String(a[u])]=new Y.default(j.AccountLayout.decode(d.data).amount.toString())}let b={};for(let[u,d]of Object.entries(r)){let c=l[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),y=l[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);b[u]=z(E({},d),{baseReserve:c,quoteReserve:y,vaultAAmount:l[d.vaultA.toString()],vaultBAmount:l[d.vaultB.toString()],configInfo:s[d.configId.toString()],poolPrice:new se.default(y.toString()).div(new se.default(10).pow(d.mintDecimalB)).div(new se.default(c.toString()).div(new se.default(10).pow(d.mintDecimalA)))})}return b}toComputePoolInfos({pools:t,mintInfos:e}){return Object.keys(t).reduce((i,r)=>{var l,p,b,u;let o=t[r],[a,s]=[o.mintA.toBase58(),o.mintB.toBase58()];return z(E({},i),{[r]:z(E({},o),{id:new k.PublicKey(r),configInfo:o.configInfo,version:7,authority:St(o.programId).publicKey,mintA:Ke({address:a,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(l=e[a])!=null&&l.feeConfig?_e((p=e[a])==null?void 0:p.feeConfig):void 0}}),mintB:Ke({address:s,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(b=e[s])!=null&&b.feeConfig?_e((u=e[s])==null?void 0:u.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(t){let e=await this.getRpcPoolInfo(t,!0),i=await vt({connection:this.scope.connection,mints:[e.mintA,e.mintB]}),r=Ke({address:e.mintA.toBase58(),decimals:e.mintDecimalA,programId:e.mintProgramA.toBase58(),extensions:{feeConfig:i[e.mintA.toBase58()].feeConfig?_e(i[e.mintA.toBase58()].feeConfig):void 0}}),o=Ke({address:e.mintB.toBase58(),decimals:e.mintDecimalB,programId:e.mintProgramB.toBase58(),extensions:{feeConfig:i[e.mintB.toBase58()].feeConfig?_e(i[e.mintB.toBase58()].feeConfig):void 0}}),a=Ke({address:e.mintLp.toBase58(),decimals:e.lpDecimals,programId:j.TOKEN_PROGRAM_ID.toBase58()}),s={id:e.configId.toBase58(),index:e.configInfo.index,protocolFeeRate:e.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:e.configInfo.tradeFeeRate.toNumber(),fundFeeRate:e.configInfo.fundFeeRate.toNumber(),createPoolFee:e.configInfo.createPoolFee.toString()},l={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:e.programId.toBase58(),id:t,type:"Standard",lpMint:a,lpPrice:0,lpAmount:e.lpAmount.toNumber(),config:s,mintA:r,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:e.poolPrice.toNumber(),mintAmountA:new se.default(e.vaultAAmount.toString()).div(10**r.decimals).toNumber(),mintAmountB:new se.default(e.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:e.configInfo.tradeFeeRate.toNumber(),openTime:e.openTime.toString(),tvl:0,burnPercent:0,day:l,week:l,month:l,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:e.programId.toBase58(),id:t,mintA:r,mintB:o,openTime:e.openTime.toString(),vault:{A:e.vaultA.toBase58(),B:e.vaultB.toBase58()},authority:St(e.programId).publicKey.toBase58(),mintLp:a,config:s,observationId:tt(e.programId,new k.PublicKey(t)).publicKey.toBase58()},rpcData:e}}async createPool(y){var f=y,{poolId:t,programId:e,poolFeeAccount:i,startTime:r,ownerInfo:o,associatedOnly:a=!1,checkCreateATAOwner:s=!1,txVersion:l,feeConfig:p,computeBudgetConfig:b,txTipConfig:u,feePayer:d}=f,c=ge(f,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig","txTipConfig","feePayer"]);var G,Q,le;let m=o.feePayer||((G=this.scope.owner)==null?void 0:G.publicKey),T=new Y.default(new k.PublicKey(c.mintA.address).toBuffer()).lte(new Y.default(new k.PublicKey(c.mintB.address).toBuffer())),[A,B]=T?[c.mintA,c.mintB]:[c.mintB,c.mintA],[P,g]=T?[c.mintAAmount,c.mintBAmount]:[c.mintBAmount,c.mintAAmount],w=o.useSOLBalance&&A.address===j.NATIVE_MINT.toBase58(),h=o.useSOLBalance&&B.address===j.NATIVE_MINT.toBase58(),[x,N]=[new k.PublicKey(A.address),new k.PublicKey(B.address)],S=this.createTxBuilder(d),{account:M,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:x,tokenProgram:A.programId,owner:this.scope.ownerPubKey,createInfo:w?{payer:m,amount:P}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:a,checkCreateATAOwner:s});S.addInstruction(R||{});let{account:F,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:new k.PublicKey(B.address),tokenProgram:B.programId,owner:this.scope.ownerPubKey,createInfo:h?{payer:m,amount:g}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:a,checkCreateATAOwner:s});if(S.addInstruction(W||{}),M===void 0||F===void 0)throw Error("you don't has some token account");let D=Hn({poolId:t,programId:e,configId:new k.PublicKey(p.id),mintA:x,mintB:N});return S.addInstruction({instructions:[si(e,this.scope.ownerPubKey,new k.PublicKey(p.id),D.authority,D.poolId,x,N,D.lpMint,M,F,ce(this.scope.ownerPubKey,D.lpMint).publicKey,D.vaultA,D.vaultB,i,new k.PublicKey((Q=A.programId)!=null?Q:j.TOKEN_PROGRAM_ID),new k.PublicKey((le=B.programId)!=null?le:j.TOKEN_PROGRAM_ID),D.observationId,P,g,r)],instructionTypes:[ee.CpmmCreatePool]}),S.addCustomComputeBudget(b),S.addTipInstruction(u),S.versionBuild({txVersion:l,extInfo:{address:z(E({},D),{mintA:A,mintB:B,programId:e,poolFeeAccount:i,feeConfig:p})}})}async addLiquidity(t){let{poolInfo:e,poolKeys:i,inputAmount:r,baseIn:o,slippage:a,computeResult:s,computeBudgetConfig:l,txTipConfig:p,config:b,txVersion:u,feePayer:d}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),r.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:r.toString()});let{account:c}=this.scope,{bypassAssociatedCheck:y,checkCreateATAOwner:f}=E({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},b),m=s?void 0:await this.getRpcPoolInfo(e.id),{liquidity:T,inputAmountFee:A,anotherAmount:B}=s||this.computePairAmount({poolInfo:z(E({},e),{lpAmount:new se.default(m.lpAmount.toString()).div(10**e.lpMint.decimals).toNumber()}),baseReserve:m.baseReserve,quoteReserve:m.quoteReserve,slippage:new ae(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new se.default(r.toString()).div(10**(o?e.mintA.decimals:e.mintB.decimals))}),P=B.amount,g=e.mintA.address===j.NATIVE_MINT.toString(),w=e.mintB.address===j.NATIVE_MINT.toString(),h=this.createTxBuilder(d),[x,N]=[new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address)],{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new k.PublicKey(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:g||(o?r:P).isZero()?{payer:this.scope.ownerPubKey,amount:o?r:P}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:!1,checkCreateATAOwner:f});h.addInstruction(M||{});let{account:R,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new k.PublicKey(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||(o?P:r).isZero()?{payer:this.scope.ownerPubKey,amount:o?P:r}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:!1,checkCreateATAOwner:f});h.addInstruction(F||{}),!S&&!R&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",c.tokenAccounts);let W=await c.getCreatedTokenAccount({mint:new k.PublicKey(e.lpMint.address)}),Be=await c.handleTokenAccount({side:"out",amount:0,mint:new k.PublicKey(e.lpMint.address),tokenAccount:W,bypassAssociatedCheck:y,checkCreateATAOwner:f}),{tokenAccount:D}=Be,G=ge(Be,["tokenAccount"]);h.addInstruction(G);let Q=i!=null?i:await this.getCpmmPoolKeys(e.id),le=new ae(new Y.default(1)).sub(a);return h.addInstruction({instructions:[ai(new k.PublicKey(e.programId),this.scope.ownerPubKey,new k.PublicKey(Q.authority),new k.PublicKey(e.id),D,S,R,new k.PublicKey(Q.vault.A),new k.PublicKey(Q.vault.B),x,N,new k.PublicKey(e.lpMint.address),s?s==null?void 0:s.liquidity:le.mul(T).quotient,o?A.amount:P,o?P:A.amount)],instructionTypes:[ee.CpmmAddLiquidity],lookupTableAddress:Q.lookupTableAccount?[Q.lookupTableAccount]:[]}),h.addCustomComputeBudget(l),h.addTipInstruction(p),h.versionBuild({txVersion:u})}async withdrawLiquidity(t){var G,Q;let{poolInfo:e,poolKeys:i,lpAmount:r,slippage:o,computeBudgetConfig:a,txTipConfig:s,txVersion:l,feePayer:p,closeWsol:b=!0}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=new ae(new Y.default(1)).sub(o),d=await this.getRpcPoolInfo(e.id),[c,y]=[u.mul(r.mul(d.baseReserve).div(d.lpAmount)).quotient,u.mul(r.mul(d.quoteReserve).div(d.lpAmount)).quotient],f=await this.scope.fetchEpochInfo(),[m,T]=[be(c,e.mintA.extensions.feeConfig,f,!1),be(y,e.mintB.extensions.feeConfig,f,!1)],{account:A}=this.scope,B=this.createTxBuilder(p),[P,g]=[new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address)],w=P.equals(re),h=g.equals(re),x,N,{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new k.PublicKey(e.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(w&&b),associatedOnly:!w,checkCreateATAOwner:!1});x=S,M&&B.addInstruction(M);let{account:R,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new k.PublicKey(e.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(h&&b),associatedOnly:!h,checkCreateATAOwner:!1});N=R,F&&B.addInstruction(F),(!x||!N)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",A.tokenAccounts);let W=await A.getCreatedTokenAccount({mint:new k.PublicKey(e.lpMint.address)});W||this.logAndCreateError("cannot found lp token account","tokenAccounts",A.tokenAccounts);let D=i!=null?i:await this.getCpmmPoolKeys(e.id);return B.addInstruction({instructions:[ci(new k.PublicKey(e.programId),this.scope.ownerPubKey,new k.PublicKey(D.authority),new k.PublicKey(e.id),W,x,N,new k.PublicKey(D.vault.A),new k.PublicKey(D.vault.B),P,g,new k.PublicKey(e.lpMint.address),r,c.sub((G=m.fee)!=null?G:new Y.default(0)),y.sub((Q=T.fee)!=null?Q:new Y.default(0)))],instructionTypes:[ee.CpmmWithdrawLiquidity],lookupTableAddress:D.lookupTableAccount?[D.lookupTableAccount]:[]}),B.addCustomComputeBudget(a),B.addTipInstruction(s),B.versionBuild({txVersion:l})}async swap(t){var M,R,F,W,D,G;let{poolInfo:e,poolKeys:i,baseIn:r,fixedOut:o,inputAmount:a,swapResult:s,slippage:l=0,config:p,computeBudgetConfig:b,txTipConfig:u,txVersion:d,feePayer:c}=t,{bypassAssociatedCheck:y,checkCreateATAOwner:f,associatedOnly:m}=E({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},p),T=this.createTxBuilder(c),[A,B]=[new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address)];o?s.sourceAmountSwapped=s.sourceAmountSwapped.mul(new Y.default((1+l)*1e4)).div(new Y.default(1e4)):s.destinationAmountSwapped=s.destinationAmountSwapped.mul(new Y.default((1-l)*1e4)).div(new Y.default(1e4));let P=e.mintA.address===re.toBase58(),g=e.mintB.address===re.toBase58(),{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:A,tokenProgram:new k.PublicKey((M=e.mintA.programId)!=null?M:j.TOKEN_PROGRAM_ID),owner:this.scope.ownerPubKey,createInfo:P||!r?{payer:this.scope.ownerPubKey,amount:r?s.sourceAmountSwapped:0}:void 0,notUseTokenAccount:P,skipCloseAccount:!P,associatedOnly:P?!1:m,checkCreateATAOwner:f});h&&T.addInstruction(h);let{account:x,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:B,tokenProgram:new k.PublicKey((R=e.mintB.programId)!=null?R:j.TOKEN_PROGRAM_ID),owner:this.scope.ownerPubKey,createInfo:g||r?{payer:this.scope.ownerPubKey,amount:r?0:s.sourceAmountSwapped}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:m,checkCreateATAOwner:f});N&&T.addInstruction(N),(!w||!x)&&this.logAndCreateError("user do not have token account",{mintA:e.mintA.symbol||e.mintA.address,mintB:e.mintB.symbol||e.mintB.address,mintATokenAcc:w,mintBTokenAcc:x,mintAUseSOLBalance:P,mintBUseSOLBalance:g,associatedOnly:m});let S=i!=null?i:await this.getCpmmPoolKeys(e.id);return T.addInstruction({instructions:[o?li(new k.PublicKey(e.programId),this.scope.ownerPubKey,new k.PublicKey(S.authority),new k.PublicKey(S.config.id),new k.PublicKey(e.id),r?w:x,r?x:w,new k.PublicKey(S.vault[r?"A":"B"]),new k.PublicKey(S.vault[r?"B":"A"]),new k.PublicKey((D=e[r?"mintA":"mintB"].programId)!=null?D:j.TOKEN_PROGRAM_ID),new k.PublicKey((G=e[r?"mintB":"mintA"].programId)!=null?G:j.TOKEN_PROGRAM_ID),r?A:B,r?B:A,tt(new k.PublicKey(e.programId),new k.PublicKey(e.id)).publicKey,s.sourceAmountSwapped,s.destinationAmountSwapped):ui(new k.PublicKey(e.programId),this.scope.ownerPubKey,new k.PublicKey(S.authority),new k.PublicKey(S.config.id),new k.PublicKey(e.id),r?w:x,r?x:w,new k.PublicKey(S.vault[r?"A":"B"]),new k.PublicKey(S.vault[r?"B":"A"]),new k.PublicKey((F=e[r?"mintA":"mintB"].programId)!=null?F:j.TOKEN_PROGRAM_ID),new k.PublicKey((W=e[r?"mintB":"mintA"].programId)!=null?W:j.TOKEN_PROGRAM_ID),r?A:B,r?B:A,tt(new k.PublicKey(e.programId),new k.PublicKey(e.id)).publicKey,a,s.destinationAmountSwapped)],instructionTypes:[o?ee.CpmmSwapBaseOut:ee.ClmmSwapBaseIn]}),T.addCustomComputeBudget(b),T.addTipInstruction(u),T.versionBuild({txVersion:d})}async lockLp(t){var d,c,y,f,m;let{poolInfo:e,lpAmount:i,computeBudgetConfig:r,txTipConfig:o,txVersion:a,feePayer:s,feeNftOwner:l}=t;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let p=this.createTxBuilder(s),b=(d=t.poolKeys)!=null?d:await this.getCpmmPoolKeys(e.id),u=await mi({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(c=t.feePayer)!=null?c:this.scope.ownerPubKey},feeNftOwner:l!=null?l:this.scope.ownerPubKey,lockProgram:(y=t.programId)!=null?y:bt,lockAuthProgram:(f=t.authProgram)!=null?f:yt,lpAmount:i,withMetadata:(m=t.withMetadata)!=null?m:!0,getEphemeralSigners:t.getEphemeralSigners});return p.addInstruction(u),p.addCustomComputeBudget(r),p.addTipInstruction(o),p.versionBuild({txVersion:a,extInfo:u.address})}async harvestLockLp(t){var R;let{poolInfo:e,lpFeeAmount:i,nftMint:r,programId:o=bt,authProgram:a=yt,cpmmProgram:s,computeBudgetConfig:l,txTipConfig:p,txVersion:b,closeWsol:u=!0}=t;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let d=t.feePayer||this.scope.ownerPubKey,c=this.createTxBuilder(d),[y,f]=[new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address)],m=y.equals(re),T=f.equals(re),A,B,{account:P,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new k.PublicKey(e.mintA.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(m&&u),associatedOnly:!m,checkCreateATAOwner:!1});A=P,g&&c.addInstruction(g);let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new k.PublicKey(e.mintB.address),notUseTokenAccount:T,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(T&&u),associatedOnly:!T,checkCreateATAOwner:!1});B=w,h&&c.addInstruction(h),(!A||!B)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:A,tokenAccountB:B});let x=(R=t.poolKeys)!=null?R:await this.getCpmmPoolKeys(e.id),{publicKey:N}=ce(d,r,j.TOKEN_PROGRAM_ID),{publicKey:S}=nt(o,r),{publicKey:M}=ce(a,new k.PublicKey(e.lpMint.address),j.TOKEN_PROGRAM_ID);return c.addInstruction({instructions:[mn({programId:o,nftOwner:this.scope.ownerPubKey,auth:a,nftMint:r,nftAccount:N,lockPda:S,poolId:new k.PublicKey(e.id),mintLp:new k.PublicKey(x.mintLp.address),userVaultA:A,userVaultB:B,poolVaultA:new k.PublicKey(x.vault.A),poolVaultB:new k.PublicKey(x.vault.B),mintA:y,mintB:f,lockLpVault:M,lpFeeAmount:i,cpmmProgram:s==null?void 0:s.programId,cpmmAuthProgram:s==null?void 0:s.authProgram})],instructionTypes:[ee.CpmmCollectLockFee]}),c.addCustomComputeBudget(l),c.addTipInstruction(p),c.versionBuild({txVersion:b})}async harvestMultiLockLp(t){let{lockInfo:e,programId:i=bt,authProgram:r=yt,cpmmProgram:o,computeBudgetConfig:a,txVersion:s,closeWsol:l=!0}=t,p=t.feePayer||this.scope.ownerPubKey,b=this.createTxBuilder(p),u={};return e.forEach(async d=>{var S;let{poolInfo:c,lpFeeAmount:y,nftMint:f}=d;if(y.isZero())return;let[m,T]=[new k.PublicKey(c.mintA.address),new k.PublicKey(c.mintB.address)],A=m.equals(re),B=T.equals(re),P=u[c.mintA.address],g=u[c.mintB.address];if(!P)if(A){let{account:M,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.mintA.programId,mint:new k.PublicKey(c.mintA.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!l,associatedOnly:!1,checkCreateATAOwner:!1});P=M,R&&b.addInstruction(R),u[c.mintA.address]=M}else{let M=new k.PublicKey(c.mintA.address);P=this.scope.account.getAssociatedTokenAccount(M,new k.PublicKey(c.mintA.programId)),b.addInstruction({instructions:[(0,j.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,P,this.scope.ownerPubKey,M)]}),u[c.mintA.address]=P}if(!g)if(B){let{account:M,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.mintB.programId,mint:new k.PublicKey(c.mintB.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!l,associatedOnly:!1,checkCreateATAOwner:!1});g=M,R&&b.addInstruction(R),u[c.mintB.address]=M}else{let M=new k.PublicKey(c.mintB.address);g=this.scope.account.getAssociatedTokenAccount(M,new k.PublicKey(c.mintB.programId)),b.addInstruction({instructions:[(0,j.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,g,this.scope.ownerPubKey,M)]}),u[c.mintB.address]=g}(!P||!g)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:P,tokenAccountB:g});let w=(S=d.poolKeys)!=null?S:await this.getCpmmPoolKeys(c.id),{publicKey:h}=ce(p,f,j.TOKEN_PROGRAM_ID),{publicKey:x}=nt(i,f),{publicKey:N}=ce(r,new k.PublicKey(c.lpMint.address),j.TOKEN_PROGRAM_ID);b.addInstruction({instructions:[mn({programId:i,nftOwner:this.scope.ownerPubKey,auth:r,nftMint:f,nftAccount:h,lockPda:x,poolId:new k.PublicKey(c.id),mintLp:new k.PublicKey(w.mintLp.address),userVaultA:P,userVaultB:g,poolVaultA:new k.PublicKey(w.vault.A),poolVaultB:new k.PublicKey(w.vault.B),mintA:m,mintB:T,lockLpVault:N,lpFeeAmount:y,cpmmProgram:o==null?void 0:o.programId,cpmmAuthProgram:o==null?void 0:o.authProgram})],instructionTypes:[ee.CpmmCollectLockFee]})}),s===0?b.sizeCheckBuildV0({computeBudgetConfig:a}):b.sizeCheckBuild({computeBudgetConfig:a})}computeSwapAmount({pool:t,amountIn:e,outputMint:i,slippage:r}){let o=i.toString()===t.mintB.address,a=xt.swap(e,o?t.baseReserve:t.quoteReserve,o?t.quoteReserve:t.baseReserve,t.configInfo.tradeFeeRate),s=new se.default(a.destinationAmountSwapped.toString()).div(a.sourceAmountSwapped.toString()),l=a.destinationAmountSwapped.mul(new Y.default((1-r)*1e4)).div(new Y.default(1e4));return{allTrade:a.sourceAmountSwapped.eq(e),amountIn:e,amountOut:a.destinationAmountSwapped,minAmountOut:l,executionPrice:s,fee:a.tradeFee,priceImpact:t.poolPrice.sub(s).div(t.poolPrice)}}computePairAmount({poolInfo:t,baseReserve:e,quoteReserve:i,amount:r,slippage:o,epochInfo:a,baseIn:s}){var P,g,w,h,x,N,S,M,R;let l=1-Number(o.toSignificant())/100,p=new Y.default(new se.default(r).mul(10**t[s?"mintA":"mintB"].decimals).mul(l).toFixed(0)),b=be(p,t[s?"mintA":"mintB"].extensions.feeConfig,a,!1),u=p.sub((P=b.fee)!=null?P:new Y.default(0)),d=new Y.default(new se.default(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,se.default.ROUND_DOWN));this.logDebug("baseReserve:",e.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",s?t.mintA.symbol:t.mintB.symbol,"amountIn:",p.toString(),"amountInFee:",(w=(g=b.fee)==null?void 0:g.toString())!=null?w:0,"anotherToken:",s?t.mintB.symbol:t.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let c=s?"base":"quote";this.logDebug("input side:",c);let y=u.mul(d).div(c==="base"?e:i),f={amount:Ht,fee:void 0,expirationTime:void 0};if(!u.isZero()){let F=Kr(y,e,i,d);this.logDebug("lpAmountData:",{amountA:F.amountA.toString(),amountB:F.amountB.toString()}),f=be(F[s?"amountB":"amountA"],t[s?"mintB":"mintA"].extensions.feeConfig,a,!0)}let m=new ae(new Y.default(1)).add(o),T=new ae(new Y.default(1)).sub(o),A=be(m.mul(f.amount.sub((h=f.fee)!=null?h:new Y.default(0))).quotient,t[s?"mintB":"mintA"].extensions.feeConfig,a,!0),B=be(T.mul(f.amount.sub((x=f.fee)!=null?x:new Y.default(0))).quotient,t[s?"mintB":"mintA"].extensions.feeConfig,a,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(S=(N=f.fee)==null?void 0:N.toString())!=null?S:0,"maxAnotherAmount:",A.amount.toString(),"maxAnotherAmountFee:",(R=(M=A.fee)==null?void 0:M.toString())!=null?R:0),{inputAmountFee:b,anotherAmount:f,maxAnotherAmount:A,minAnotherAmount:B,liquidity:y}}};function Kr(n,t,e,i){let r=n.mul(t).div(i);!r.isZero()&&!n.mul(t).mod(i).isZero()&&(r=r.add(new Y.default(1)));let o=n.mul(e).div(i);return!o.isZero()&&!n.mul(e).mod(i).isZero()&&(o=o.add(new Y.default(1))),{amountA:r,amountB:o}}0&&(module.exports={});
//# sourceMappingURL=cpmm.js.map