var wi=Object.create;var ze=Object.defineProperty,ki=Object.defineProperties,Ti=Object.getOwnPropertyDescriptor,Bi=Object.getOwnPropertyDescriptors,hi=Object.getOwnPropertyNames,bt=Object.getOwnPropertySymbols,xi=Object.getPrototypeOf,Et=Object.prototype.hasOwnProperty,wn=Object.prototype.propertyIsEnumerable;var An=(n,e,t)=>e in n?ze(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,D=(n,e)=>{for(var t in e||(e={}))Et.call(e,t)&&An(n,t,e[t]);if(bt)for(var t of bt(e))wn.call(e,t)&&An(n,t,e[t]);return n},Y=(n,e)=>ki(n,Bi(e));var be=(n,e)=>{var t={};for(var i in n)Et.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&bt)for(var i of bt(n))e.indexOf(i)<0&&wn.call(n,i)&&(t[i]=n[i]);return t};var Ii=(n,e)=>{for(var t in e)ze(n,t,{get:e[t],enumerable:!0})},kn=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of hi(e))!Et.call(n,o)&&o!==t&&ze(n,o,{get:()=>e[o],enumerable:!(i=Ti(e,o))||i.enumerable});return n};var _=(n,e,t)=>(t=n!=null?wi(xi(n)):{},kn(e||!n||!n.__esModule?ze(t,"default",{value:n,enumerable:!0}):t,n)),Ci=n=>kn(ze({},"__esModule",{value:!0}),n);var Er={};Ii(Er,{default:()=>Ot});module.exports=Ci(Er);var P=require("@solana/web3.js"),q=require("@solana/spl-token");var Pe=_(require("bn.js")),Ui=_(require("decimal.js"));var qn=_(require("big.js")),qi=_(require("bn.js"));var He=require("lodash");var Vt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Tn={},Si={};function ne(n){let e=(0,He.get)(Tn,n);if(!e){let t=(0,He.get)(Si,n);e=new Vt({name:n,logLevel:t}),(0,He.set)(Tn,n,e)}return e}var Dt=require("@solana/web3.js");var Ie=require("@solana/spl-token"),Wt=ne("Raydium_accountInfo_util");async function Ye(n,e,t){let{batchRequest:i,commitment:o="confirmed",chunkCount:s=100}=D({batchRequest:!1},t),c=vt(e,s),r=new Array(c.length).fill([]);if(i){let p=c.map(u=>{let m=n._buildArgs([u.map(f=>f.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:m}}),y=vt(p,10);r=(await(await Promise.all(y.map(async u=>await n._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&Wt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(m=>{if(m){let{data:f,executable:a,lamports:g,owner:l,rentEpoch:h}=m;return f.length!==2&&f[1]!=="base64"&&Wt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:a,lamports:g,owner:new Dt.PublicKey(l),rentEpoch:h}}return null})))}else try{r=await Promise.all(c.map(p=>n.getMultipleAccountsInfo(p,o)))}catch(p){p instanceof Error&&Wt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${p.message}`)}return r.flat()}async function Ne(n,e,t){let i=await Ye(n,e.map(o=>o.pubkey),t);return e.map((o,s)=>Y(D({},o),{accountInfo:i[s]}))}async function _t({connection:n,mints:e,config:t}){var s,c,r;if(e.length===0)return{};let i=await Ne(n,e.map(p=>({pubkey:Ze(p)})),t),o={};for(let p of i){if(!p.accountInfo||p.accountInfo.data.length<Ie.MINT_SIZE){console.log("invalid mint account",p.pubkey.toBase58());continue}let y=(0,Ie.unpackMint)(p.pubkey,p.accountInfo,(s=p.accountInfo)==null?void 0:s.owner);o[p.pubkey.toString()]=Y(D({},y),{programId:((c=p.accountInfo)==null?void 0:c.owner)||Ie.TOKEN_PROGRAM_ID,feeConfig:(r=(0,Ie.getTransferFeeConfig)(y))!=null?r:void 0})}return o[Dt.PublicKey.default.toBase58()]=o[ce.toBase58()],o}var Ve=_(require("bn.js"));var Bn=9007199254740991;function Ae(n){let e=ne("Raydium_parseBigNumberish");if(n instanceof Ve.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new Ve.default(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=Bn||n<=-Bn)&&e.logWithError(`BigNumberish number overflow: ${n}`),new Ve.default(String(n))):typeof n=="bigint"?new Ve.default(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new Ve.default(0))}var hn=require("@solana/web3.js"),qt=require("@solana/spl-token"),Gt={chainId:101,address:hn.PublicKey.default.toBase58(),programId:qt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ce={chainId:101,address:"So11111111111111111111111111111111111111112",programId:qt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var At=require("@solana/web3.js");var U=require("@solana/web3.js"),xn=require("@solana/spl-token");function Ut({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var jr=[Ut({pubkey:xn.TOKEN_PROGRAM_ID,isWritable:!1}),Ut({pubkey:U.SystemProgram.programId,isWritable:!1}),Ut({pubkey:U.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Xt({publicKey:n,transformSol:e}){let t=In(n.toString());if(t instanceof U.PublicKey)return e&&t.equals(je)?ce:t;if(e&&t.toString()===je.toBase58())return ce;if(typeof t=="string"){if(t===U.PublicKey.default.toBase58())return U.PublicKey.default;try{return new U.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function In(n){try{return new U.PublicKey(n)}catch{return n}}var Ki=new U.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),gt=new U.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Pt=new U.PublicKey("SysvarRent111111111111111111111111111111111"),Qr=new U.PublicKey("SysvarC1ock11111111111111111111111111111111"),We=new U.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Jr=new U.PublicKey("Sysvar1nstructions1111111111111111111111111"),Cn=U.SystemProgram.programId,$r=new U.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),eo=new U.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),to=new U.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),no=new U.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),io=new U.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ro=new U.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),oo=new U.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),so=new U.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ao=new U.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),co=new U.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),uo=new U.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ce=new U.PublicKey("So11111111111111111111111111111111111111112"),je=U.PublicKey.default;function Ze(n){return Xt({publicKey:n,transformSol:!0})}var zt=class{constructor({mint:e,decimals:t,symbol:i,name:o,skipMint:s=!1,isToken2022:c=!1}){if(e===je.toBase58()||e instanceof At.PublicKey&&je.equals(e)){this.decimals=Ce.decimals,this.symbol=Ce.symbol,this.name=Ce.name,this.mint=new At.PublicKey(Ce.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?At.PublicKey.default:Xt({publicKey:e}),this.isToken2022=c}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Se=zt;Se.WSOL=new zt(Y(D({},Ce),{mint:Ce.address}));var Ht=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},wt=Ht;wt.SOL=new Ht(Gt);var Sn=_(require("toformat")),Li=Sn.default,Qe=Li;var Je=_(require("big.js")),Kn=_(require("bn.js")),Ln=_(require("decimal.js-light"));var kt=ne("module/fraction"),Yt=Qe(Je.default),$e=Qe(Ln.default),Ni={[0]:$e.ROUND_DOWN,[1]:$e.ROUND_HALF_UP,[2]:$e.ROUND_UP},Mi={[0]:Je.default.roundDown,[1]:Je.default.roundHalfUp,[2]:Je.default.roundUp},Z=class{constructor(e,t=new Kn.default(1)){this.numerator=Ae(e),this.denominator=Ae(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Z(this.denominator,this.numerator)}add(e){let t=e instanceof Z?e:new Z(Ae(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.add(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Z?e:new Z(Ae(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.sub(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Z?e:new Z(Ae(e));return new Z(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Z?e:new Z(Ae(e));return new Z(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||kt.logWithError(`${e} is not an integer.`),e<=0&&kt.logWithError(`${e} is not positive.`),$e.set({precision:e+1,rounding:Ni[i]});let o=new $e(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||kt.logWithError(`${e} is not an integer.`),e<0&&kt.logWithError(`${e} is negative.`),Yt.DP=e,Yt.RM=Mi[i]||1,new Yt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Nn=_(require("bn.js"));var Rn=new Z(new Nn.default(100)),pe=class extends Z{toSignificant(e=5,t,i){return this.mul(Rn).toSignificant(e,t,i)}toFixed(e=2,t,i){return this.mul(Rn).toFixed(e,t,i)}};var Ro=ne("Raydium_price");function vt(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}var we=class{constructor(e){this._owner=e}get publicKey(){return we.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return we.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return we.isKeyPair(this._owner)}get isPublicKey(){return we.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!we.isKeyPair(e)}};var En=require("@solana/web3.js"),Vn=require("@solana/spl-token");var oe=require("@solana/web3.js");var ie={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var On=require("@solana/spl-token"),Mn=ne("Raydium_txUtil"),Fn=1644;function et(n){let e=[],t=[];return n.microLamports&&(e.push(oe.ComputeBudgetProgram.setComputeUnitPrice({microLamports:n.microLamports})),t.push(ie.SetComputeUnitPrice)),n.units&&(e.push(oe.ComputeBudgetProgram.setComputeUnitLimit({units:n.units})),t.push(ie.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Me(n,e){var i,o;let t=e!=null?e:"confirmed";return(o=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:o.blockhash}async function tt(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let o=setTimeout(i,6e4);n.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}i(Object.assign(s.err,{txId:e}))},"confirmed")})}function Oi(n,e){n.length<1&&Mn.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Mn.logWithError(`no signers provided:, ${e.toString()}`);let t=new oe.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Fn}catch{return!1}}function fe(n,e){let[t,i]=oe.PublicKey.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function nt({instructions:n,payer:e,signers:t}){return Oi(n,[e,...t])}function Te({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=oe.Keypair.generate().publicKey.toString()}){let s=new oe.TransactionMessage({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new oe.VersionedTransaction(s).serialize()).toString("base64").length<Fn}catch{return!1}}var Fi=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Ei=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof oe.VersionedTransaction&&(e=Fi(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Ke(n){let e=[];return n.forEach(t=>{t instanceof oe.Transaction&&(t.recentBlockhash||(t.recentBlockhash=On.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=oe.Keypair.generate().publicKey)),e.push(Ei(t))}),console.log("simulate tx string:",e),e}function le(n,e,t){return fe([n.toBuffer(),(t!=null?t:Vn.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new En.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var M=require("@solana/web3.js"),ss=new M.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),as=new M.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),cs=new M.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),us=new M.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ls=new M.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ms=new M.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ds=new M.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ps=new M.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),fs=new M.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ys=new M.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Vi=new M.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Wi=new M.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),vi=new M.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),bs=new M.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),gs=new M.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ps=new M.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),As=new M.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ws=new M.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ks=new M.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ts=new M.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),it=new M.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Wn=new M.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Bs=new M.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Bt=new M.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ht=new M.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),hs=new M.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),xs=new M.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Is=new M.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Cs=new M.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ss=new M.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Ks=new M.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ls={OPEN_BOOK_PROGRAM:new M.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new M.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new M.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new M.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new M.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new M.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new M.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new M.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new M.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new M.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new M.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new M.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:M.PublicKey.default,Router:new M.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new M.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new M.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new M.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new M.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new M.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new M.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new M.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new M.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new M.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new M.PublicKey("Ray1111111111111111111111111111111111111111")};var ye=_(require("bn.js")),rt=1e4;function ke(n,e,t,i){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let o=Y(D({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),s=t.epoch<o.newerTransferFee.epoch?o.olderTransferFee:o.newerTransferFee,c=new ye.default(s.maximumFee.toString()),r=t.epoch<o.newerTransferFee.epoch?(Number(o.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(i)if(s.transferFeeBasisPoints===rt){let p=new ye.default(s.maximumFee.toString());return{amount:n.add(p),fee:p,expirationTime:r}}else{let p=Qt(n.mul(new ye.default(rt)),new ye.default(rt-s.transferFeeBasisPoints)),y=new ye.default(s.maximumFee.toString()),d=p.sub(n).gt(y)?n.add(y):p,u=Qt(d.mul(new ye.default(s.transferFeeBasisPoints)),new ye.default(rt)),m=u.gt(c)?c:u;return{amount:d,fee:m,expirationTime:r}}else{let p=Qt(n.mul(new ye.default(s.transferFeeBasisPoints)),new ye.default(rt)),y=p.gt(c)?c:p;return{amount:n,fee:y,expirationTime:r}}}function Qt(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new ye.default(0))?t.add(new ye.default(1)):t}var ge=require("@solana/web3.js");async function xt({connection:n,address:e,cluster:t="mainnet"}){let i=await Ye(n,[...new Set(e.map(s=>s.toString()))].map(s=>new ge.PublicKey(s))),o={};for(let s=0;s<e.length;s++){let c=i[s],r=e[s];if(!c)continue;let p=new ge.AddressLookupTableAccount({key:r,state:ge.AddressLookupTableAccount.deserialize(c.data)});o[r.toString()]=p,t==="devnet"?ve[r.toString()]=p:Le[r.toString()]=p}return o}var Le={},Jt=async n=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(Le[e])return Le;let t=new ge.PublicKey(e),i=await n.getAccountInfo(t);return i&&(Le[e]=new ge.AddressLookupTableAccount({key:t,state:ge.AddressLookupTableAccount.deserialize(i.data)})),Le},ve={},It=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ve[e])return ve;let t=new ge.PublicKey(e),i=await n.getAccountInfo(t);return i&&(ve[e]=new ge.AddressLookupTableAccount({key:t,state:ge.AddressLookupTableAccount.deserialize(i.data)})),ve};var v=require("@solana/web3.js"),Dn=_(require("axios"));var ot=2e3,st=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Dn.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=et(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(v.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new v.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(ie.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:c=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...c.filter(r=>r!==v.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(D({},t||{})):this.build(t)}build(e){var i;let t=new v.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var d;let{recentBlockHash:s,skipPreflight:c=!0,sendAndConfirm:r,notSendToRpc:p}=o||{},y=s!=null?s:await Me(this.connection,this.blockhashCommitment);if(t.recentBlockhash=y,this.signers.length&&t.sign(...this.signers),Ke([t]),(d=this.owner)!=null&&d.isKeyPair)return{txId:r?await(0,v.sendAndConfirmTransaction)(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:c}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:c}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);if(this.signers.length)for(let m of u)try{m.sign(...this.signers)}catch{}return{txId:p?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:c}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var y;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:o}=this.build(i),s=t.filter(d=>d.transaction.instructions.length>0),c=[o,...s.map(d=>d.transaction)],r=[this.signers,...s.map(d=>d.signers)],p=[...this.instructionTypes,...s.map(d=>d.instructionTypes).flat()];return(y=this.owner)!=null&&y.signer&&r.forEach(d=>{d.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:c,signers:r,instructionTypes:p,execute:async d=>{var h;let{sequentially:u,onTxUpdate:m,skipTxCount:f=0,recentBlockHash:a,skipPreflight:g=!0}=d||{},l=a!=null?a:await Me(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(u){let k=[],x=0;for(let w of c){if(++x,x<=f)continue;let A=await(0,v.sendAndConfirmTransaction)(this.connection,w,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});k.push(A)}return{txIds:k,signedTxs:c}}return{txIds:await await Promise.all(c.map(async k=>(k.recentBlockhash=l,await this.connection.sendRawTransaction(k.serialize(),{skipPreflight:g})))),signedTxs:c}}if(this.signAllTransactions){let k=c.map((w,A)=>(w.recentBlockhash=l,r[A].length&&w.sign(...r[A]),w));Ke(k);let x=await this.signAllTransactions(k);if(u){let w=0,A=[],b=async()=>{if(!x[w])return;let B=await this.connection.sendRawTransaction(x[w].serialize(),{skipPreflight:g});A.push({txId:B,status:"sent",signedTx:x[w]}),m==null||m([...A]),w++;let T=!1,K=null,L=null,S=C=>{K!==null&&clearInterval(K),L!==null&&this.connection.removeSignatureListener(L);let R=A.findIndex(F=>F.txId===B);if(R>-1){if(A[R].status==="error"||A[R].status==="success")return;A[R].status=C.err?"error":"success"}m==null||m([...A]),C.err||b()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var C;if(T){clearInterval(K);return}try{let R=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(T=!0,clearInterval(K),S({err:((C=R.meta)==null?void 0:C.err)||null}),console.log("tx status from getTransaction:",B))}catch(R){T=!0,clearInterval(K),console.error("getTransaction timeout:",R,B)}},ot)),L=this.connection.onSignature(B,C=>{if(T){this.connection.removeSignatureListener(L);return}T=!0,S(C)},"confirmed"),this.connection.getSignatureStatus(B)};return await b(),{txIds:A.map(B=>B.txId),signedTxs:x}}else{let w=[];for(let A=0;A<x.length;A+=1){let b=await this.connection.sendRawTransaction(x[A].serialize(),{skipPreflight:g});w.push(b)}return{txIds:w,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var g;let a=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:o,recentBlockhash:s}=a,c=be(a,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),r=D(D({},this.cluster==="devnet"?await It(this.connection):await Jt(this.connection)),t),p=Array.from(new Set([...i,...this.lookupTableAddress])),y=[];for(let l of p)r[l]===void 0&&y.push(new v.PublicKey(l));let d=await xt({connection:this.connection,address:y});for(let[l,h]of Object.entries(d))r[l]=h;let u=o?v.PublicKey.default.toBase58():s!=null?s:await Me(this.connection,this.blockhashCommitment),m=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(r));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(l=>l.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let f=new v.VersionedTransaction(m);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async l=>{var w;let{skipPreflight:h=!0,sendAndConfirm:k,notSendToRpc:x}=l||{};if(Ke([f]),(w=this.owner)!=null&&w.isKeyPair){let A=await this.connection.sendTransaction(f,{skipPreflight:h});return k&&await tt(this.connection,A),{txId:A,signedTx:f}}if(this.signAllTransactions){let A=await this.signAllTransactions([f]);if(this.signers.length)for(let b of A)try{b.sign(this.signers)}catch{}return{txId:x?"":await this.connection.sendTransaction(A[0],{skipPreflight:h}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:c||{}}}async buildV0MultiTx(e){var y;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:o}=await this.buildV0(i),s=t.filter(d=>d.builder.instructions.length>0),c=[o,...s.map(d=>d.transaction)],r=[this.signers,...s.map(d=>d.signers)],p=[...this.instructionTypes,...s.map(d=>d.instructionTypes).flat()];return(y=this.owner)!=null&&y.signer&&r.forEach(d=>{d.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),c.forEach(async(d,u)=>{d.sign(r[u])}),{builder:this,transactions:c,signers:r,instructionTypes:p,buildProps:i,execute:async d=>{var g;let{sequentially:u,onTxUpdate:m,recentBlockHash:f,skipPreflight:a=!0}=d||{};if(f&&c.forEach(l=>l.message.recentBlockhash=f),Ke(c),(g=this.owner)!=null&&g.isKeyPair){if(u){let l=[];for(let h of c){let k=await this.connection.sendTransaction(h,{skipPreflight:a});await tt(this.connection,k),l.push(k)}return{txIds:l,signedTxs:c}}return{txIds:await Promise.all(c.map(async l=>await this.connection.sendTransaction(l,{skipPreflight:a}))),signedTxs:c}}if(this.signAllTransactions){let l=await this.signAllTransactions(c);if(u){let h=0,k=[],x=async()=>{if(!l[h])return;let w=await this.connection.sendTransaction(l[h],{skipPreflight:a});k.push({txId:w,status:"sent",signedTx:l[h]}),m==null||m([...k]),h++;let A=!1,b=null,B=null,T=K=>{b!==null&&clearInterval(b),B!==null&&this.connection.removeSignatureListener(B);let L=k.findIndex(S=>S.txId===w);if(L>-1){if(k[L].status==="error"||k[L].status==="success")return;k[L].status=K.err?"error":"success"}m==null||m([...k]),K.err||x()};this.loopMultiTxStatus&&(b=setInterval(async()=>{var K;if(A){clearInterval(b);return}try{let L=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(A=!0,clearInterval(b),T({err:((K=L.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",w))}catch(L){A=!0,clearInterval(b),console.error("getTransaction timeout:",L,w)}},ot)),B=this.connection.onSignature(w,K=>{if(A){this.connection.removeSignatureListener(B);return}A=!0,T(K)},"confirmed"),this.connection.getSignatureStatus(w)};return x(),{txIds:[],signedTxs:l}}else{let h=[];for(let k=0;k<l.length;k+=1){let x=await this.connection.sendTransaction(l[k],{skipPreflight:a});h.push(x)}return{txIds:h,signedTxs:l}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var m;let u=e||{},{splitIns:t=[],computeBudgetConfig:i}=u,o=be(u,["splitIns","computeBudgetConfig"]),s=i?et(i):{instructions:[],instructionTypes:[]},c=this.signers.reduce((f,a)=>Y(D({},f),{[a.publicKey.toBase58()]:a}),{}),r=[],p=[],y=[],d=0;if(this.allInstructions.forEach(f=>{let a=[...y,f],g=i?[...s.instructions,...a]:a,h=[...new Set(a.map(k=>k.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(k=>new v.PublicKey(k));if(f!==t[d]&&y.length<12&&(nt({instructions:g,payer:this.feePayer,signers:h})||nt({instructions:a,payer:this.feePayer,signers:h})))y.push(f);else{if(y.length===0)throw Error("item ins too big");d+=f===t[d]?1:0,nt({instructions:i?[...s.instructions,...y]:[...y],payer:this.feePayer,signers:h})?r.push(new v.Transaction().add(...s.instructions,...y)):r.push(new v.Transaction().add(...y)),p.push(Array.from(new Set(y.map(k=>k.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(k=>c[k]).filter(k=>k!==void 0)),y=[f]}}),y.length>0){let a=[...new Set(y.map(g=>g.keys.filter(l=>l.isSigner).map(l=>l.pubkey.toString())).flat()).values()].map(g=>c[g]).filter(g=>g!==void 0);nt({instructions:i?[...s.instructions,...y]:[...y],payer:this.feePayer,signers:a.map(g=>g.publicKey)})?r.push(new v.Transaction().add(...s.instructions,...y)):r.push(new v.Transaction().add(...y)),p.push(a)}return r.forEach(f=>f.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&p.forEach(f=>{f.some(a=>a.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),{builder:this,transactions:r,signers:p,instructionTypes:this.instructionTypes,execute:async f=>{var w;let{sequentially:a,onTxUpdate:g,skipTxCount:l=0,recentBlockHash:h,skipPreflight:k=!0}=f||{},x=h!=null?h:await Me(this.connection,this.blockhashCommitment);if(r.forEach(async(A,b)=>{A.recentBlockhash=x,p[b].length&&A.sign(...p[b])}),Ke(r),(w=this.owner)!=null&&w.isKeyPair){if(a){let A=0,b=[];for(let B of r){if(++A,A<=l){b.push("tx skipped");continue}let T=await(0,v.sendAndConfirmTransaction)(this.connection,B,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:k});b.push(T)}return{txIds:b,signedTxs:r}}return{txIds:await Promise.all(r.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:k}))),signedTxs:r}}if(this.signAllTransactions){let A=await this.signAllTransactions(r.slice(l,r.length)),b=[...r.slice(0,l),...A];if(a){let B=0,T=[],K=async()=>{if(!b[B])return;B<l&&(T.push({txId:"",status:"success",signedTx:b[B]}),g==null||g([...T]),B++,K());let L=await this.connection.sendRawTransaction(b[B].serialize(),{skipPreflight:k});T.push({txId:L,status:"sent",signedTx:b[B]}),g==null||g([...T]),B++;let S=!1,C=null,R=null,F=W=>{C!==null&&clearInterval(C),R!==null&&this.connection.removeSignatureListener(R);let E=T.findIndex(H=>H.txId===L);if(E>-1){if(T[E].status==="error"||T[E].status==="success")return;T[E].status=W.err?"error":"success"}g==null||g([...T]),W.err||K()};this.loopMultiTxStatus&&(C=setInterval(async()=>{var W;if(S){clearInterval(C);return}try{let E=await this.connection.getTransaction(L,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(S=!0,clearInterval(C),F({err:((W=E.meta)==null?void 0:W.err)||null}),console.log("tx status from getTransaction:",L))}catch(E){S=!0,clearInterval(C),console.error("getTransaction timeout:",E,L)}},ot)),R=this.connection.onSignature(L,W=>{if(S){this.connection.removeSignatureListener(R);return}S=!0,F(W)},"confirmed"),this.connection.getSignatureStatus(L)};return await K(),{txIds:T.map(L=>L.txId),signedTxs:b}}else{let B=[];for(let T=0;T<b.length;T+=1){let K=await this.connection.sendRawTransaction(b[T].serialize(),{skipPreflight:k});B.push(K)}return{txIds:B,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var x;let k=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:o={},lookupTableAddress:s=[]}=k,c=be(k,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),r=D(D({},this.cluster==="devnet"?await It(this.connection):Le),o),p=Array.from(new Set([...this.lookupTableAddress,...s])),y=[];for(let w of p)r[w]===void 0&&y.push(new v.PublicKey(w));let d=await xt({connection:this.connection,address:y});for(let[w,A]of Object.entries(d))r[w]=A;let u=t?et(t):{instructions:[],instructionTypes:[]},m=await Me(this.connection,this.blockhashCommitment),f=this.signers.reduce((w,A)=>Y(D({},w),{[A.publicKey.toBase58()]:A}),{}),a=[],g=[],l=[],h=0;if(this.allInstructions.forEach(w=>{let A=[...l,w],b=t?[...u.instructions,...A]:A;if(w!==i[h]&&l.length<12&&(Te({instructions:b,payer:this.feePayer,lookupTableAddressAccount:r})||Te({instructions:A,payer:this.feePayer,lookupTableAddressAccount:r})))l.push(w);else{if(l.length===0)throw Error("item ins too big");h+=w===i[h]?1:0;let B={};for(let T of[...new Set(p)])r[T]!==void 0&&(B[T]=r[T]);if(t&&Te({instructions:[...u.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:m})){let T=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...u.instructions,...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(T))}else{let T=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(T))}g.push(Array.from(new Set(l.map(T=>T.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(T=>f[T]).filter(T=>T!==void 0)),l=[w]}}),l.length>0){let A=[...new Set(l.map(b=>b.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(b=>f[b]).filter(b=>b!==void 0);if(t&&Te({instructions:[...u.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:m})){let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...u.instructions,...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(b))}else{let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(b))}g.push(A)}return(x=this.owner)!=null&&x.signer&&g.forEach(w=>{w.some(A=>A.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),a.forEach((w,A)=>{w.sign(g[A])}),{builder:this,transactions:a,buildProps:e,signers:g,blockHash:m,instructionTypes:this.instructionTypes,execute:async w=>{var L;let{sequentially:A,onTxUpdate:b,skipTxCount:B=0,recentBlockHash:T,skipPreflight:K=!0}=w||{};if(a.map(async(S,C)=>{g[C].length&&S.sign(g[C]),T&&(S.message.recentBlockhash=T)}),Ke(a),(L=this.owner)!=null&&L.isKeyPair){if(A){let S=0,C=[];for(let R of a){if(++S,S<=B){console.log("skip tx: ",S),C.push("tx skipped");continue}let F=await this.connection.sendTransaction(R,{skipPreflight:K});await tt(this.connection,F),C.push(F)}return{txIds:C,signedTxs:a}}return{txIds:await Promise.all(a.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:K}))),signedTxs:a}}if(this.signAllTransactions){let S=await this.signAllTransactions(a.slice(B,a.length)),C=[...a.slice(0,B),...S];if(A){let R=0,F=[],W=async()=>{if(!C[R])return;if(R<B){F.push({txId:"",status:"success",signedTx:C[R]}),b==null||b([...F]),R++,W();return}let E=await this.connection.sendTransaction(C[R],{skipPreflight:K});F.push({txId:E,status:"sent",signedTx:C[R]}),b==null||b([...F]),R++;let H=!1,$=null,se=null,Xe=ae=>{$!==null&&clearInterval($),se!==null&&this.connection.removeSignatureListener(se);let ee=F.findIndex(Ft=>Ft.txId===E);if(ee>-1){if(F[ee].status==="error"||F[ee].status==="success")return;F[ee].status=ae.err?"error":"success"}b==null||b([...F]),ae.err||W()};this.loopMultiTxStatus&&($=setInterval(async()=>{var ae;if(H){clearInterval($);return}try{let ee=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});ee&&(H=!0,clearInterval($),Xe({err:((ae=ee.meta)==null?void 0:ae.err)||null}),console.log("tx status from getTransaction:",E))}catch(ee){H=!0,clearInterval($),console.error("getTransaction timeout:",ee,E)}},ot)),se=this.connection.onSignature(E,ae=>{if(H){this.connection.removeSignatureListener(se);return}H=!0,Xe(ae)},"confirmed"),this.connection.getSignatureStatus(E)};return W(),{txIds:[],signedTxs:C}}else{let R=[];for(let F=0;F<C.length;F+=1){let W=await this.connection.sendTransaction(C[F],{skipPreflight:K});R.push(W)}return{txIds:R,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:c||{}}}async buildSniperTransaction(e){var x;let k=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:o={},lookupTableAddress:s=[]}=k,c=be(k,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),r=D(D({},this.cluster==="devnet"?await It(this.connection):await Jt(this.connection)),o),p=Array.from(new Set([...this.lookupTableAddress,...s])),y=[];for(let w of p)r[w]===void 0&&y.push(new v.PublicKey(w));let d=await xt({connection:this.connection,address:y});for(let[w,A]of Object.entries(d))r[w]=A;let u=t?et(t):{instructions:[],instructionTypes:[]},m=await Me(this.connection,this.blockhashCommitment),f=this.signers.reduce((w,A)=>Y(D({},w),{[A.publicKey.toBase58()]:A}),{}),a=[],g=[],l=[],h=0;if(this.allInstructions.forEach(w=>{let A=[...l,w],b=t?[...u.instructions,...A]:A;if(w!==i[h]&&l.length<12&&(Te({instructions:b,payer:this.feePayer,lookupTableAddressAccount:r})||Te({instructions:A,payer:this.feePayer,lookupTableAddressAccount:r})))l.push(w);else{if(l.length===0)throw Error("item ins too big");h+=w===i[h]?1:0;let B={};for(let T of[...new Set(p)])r[T]!==void 0&&(B[T]=r[T]);if(t&&Te({instructions:[...u.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:m})){let T=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...u.instructions,...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(T))}else{let T=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(T))}g.push(Array.from(new Set(l.map(T=>T.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(T=>f[T]).filter(T=>T!==void 0)),l=[w]}}),l.length>0){let A=[...new Set(l.map(b=>b.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(b=>f[b]).filter(b=>b!==void 0);if(t&&Te({instructions:[...u.instructions,...l],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:m})){let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...u.instructions,...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(b))}else{let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l]}).compileToV0Message(Object.values(r));a.push(new v.VersionedTransaction(b))}g.push(A)}return(x=this.owner)!=null&&x.signer&&g.forEach(w=>{w.some(A=>A.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),a.forEach((w,A)=>{w.sign(g[A])}),{builder:this,transactions:a,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async w=>{var L;let{sequentially:A,onTxUpdate:b,skipTxCount:B=0,recentBlockHash:T,skipPreflight:K=!0}=w||{};if(a.map(async(S,C)=>{g[C].length&&S.sign(g[C]),T&&(S.message.recentBlockhash=T)}),Ke(a),(L=this.owner)!=null&&L.isKeyPair){if(A){let S=0,C=[];for(let R of a){if(++S,S<=B){console.log("skip tx: ",S),C.push("tx skipped");continue}let F=await this.connection.sendTransaction(R,{skipPreflight:K});await tt(this.connection,F),C.push(F)}return{txIds:C,signedTxs:a}}return{txIds:await Promise.all(a.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:K}))),signedTxs:a}}if(this.signAllTransactions){let S=await this.signAllTransactions(a.slice(B,a.length)),C=[...a.slice(0,B),...S];if(A){let R=0,F=[],W=async()=>{if(!C[R])return;if(R<B){F.push({txId:"",status:"success",signedTx:C[R]}),b==null||b([...F]),R++,W();return}let E=await this.connection.sendTransaction(C[R],{skipPreflight:K});F.push({txId:E,status:"sent",signedTx:C[R]}),b==null||b([...F]),R++;let H=!1,$=null,se=null,Xe=ae=>{$!==null&&clearInterval($),se!==null&&this.connection.removeSignatureListener(se);let ee=F.findIndex(Ft=>Ft.txId===E);if(ee>-1){if(F[ee].status==="error"||F[ee].status==="success")return;F[ee].status=ae.err?"error":"success"}b==null||b([...F]),ae.err||W()};this.loopMultiTxStatus&&($=setInterval(async()=>{var ae;if(H){clearInterval($);return}try{let ee=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});ee&&(H=!0,clearInterval($),Xe({err:((ae=ee.meta)==null?void 0:ae.err)||null}),console.log("tx status from getTransaction:",E))}catch(ee){H=!0,clearInterval($),console.error("getTransaction timeout:",ee,E)}},ot)),se=this.connection.onSignature(E,ae=>{if(H){this.connection.removeSignatureListener(se);return}H=!0,Xe(ae)},"confirmed"),this.connection.getSignatureStatus(E)};return W(),{txIds:[],signedTxs:C}}else{let R=[];for(let F=0;F<C.length;F+=1){let W=await this.connection.sendTransaction(C[F],{skipPreflight:K});R.push(W)}return{txIds:R,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:c||{}}}};var Di=require("@solana/web3.js"),_i=_(require("bn.js"));var _n=_(require("bn.js")),Oe=new _n.default(1e6);var ha=ne("Raydium_amount"),xa=Qe(qn.default);var jt=new Pe.default(0),Va=new Pe.default(1),Wa=new Pe.default(2),va=new Pe.default(3),Da=new Pe.default(5),Gi=new Pe.default(10),_a=new Pe.default(100),qa=new Pe.default(1e3),Ga=new Pe.default(1e4);function $t(n,e,t){return n.mul(e).add(t).sub(new Pe.default(1)).div(t)}function Ct(n,e,t){return n.mul(e).div(t)}var tn=_(require("bn.js"));var ct=_(require("bn.js"));function en(n,e){if(e.isZero())throw Error("divisor is zero");return n.mod(e)}function Xi(n,e){if(e.isZero())throw Error("rhs is zero");let t=n.div(e);return en(n,e).gt(at)&&(t=t.add(new ct.default(1))),[t,e]}var at=new ct.default(0),ut=class{static swapBaseInputWithoutFees(e,t,i){let o=e.mul(i),s=t.add(e);return o.div(s)}static swapBaseOutputWithoutFees(e,t,i){let o=t.mul(e),s=i.sub(e),[c]=Xi(o,s);return c}static lpTokensToTradingTokens(e,t,i,o,s){let c=e.mul(i).div(t),r=e.mul(o).div(t);if(s===0)return{tokenAmount0:c,tokenAmount1:r};if(s===1)return en(e.mul(i),t).gt(at)&&c.gt(at)&&(c=c.add(new ct.default(1))),en(e.mul(o),t).gt(at)&&r.gt(at)&&(r=r.add(new ct.default(1))),{tokenAmount0:c,tokenAmount1:r};throw Error("roundDirection value error")}};var Gn=_(require("bn.js"));var ue=class{static tradingFee(e,t){return $t(e,t,Oe)}static protocolFee(e,t){return Ct(e,t,Oe)}static fundFee(e,t){return Ct(e,t,Oe)}static creatorFee(e,t){return $t(e,t,Oe)}static splitCreatorFee(e,t,i){return Ct(e,i,t.add(i))}static calculatePreFeeAmount(e,t){if(t.isZero())return e;let i=e.mul(Oe),o=Oe.sub(t);return i.add(o).sub(new Gn.default(1)).div(o)}};var lt=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swapBaseInput(e,t,i,o,s,c,r,p){let y=new tn.default(0),d=ue.tradingFee(e,o),u;p?(y=ue.creatorFee(e,s),u=e.sub(d).sub(y)):u=e.sub(d);let m=ue.protocolFee(d,c),f=ue.protocolFee(d,r),a=ut.swapBaseInputWithoutFees(u,t,i),g;return p?g=a:(y=ue.creatorFee(a,s),g=a.sub(y)),{newInputVaultAmount:t.add(u),newOutputVaultAmount:i.sub(a),inputAmount:e,outputAmount:g,tradeFee:d,protocolFee:m,fundFee:f,creatorFee:y}}static swapBaseOutput(e,t,i,o,s,c,r,p){let y,d=new tn.default(0),u;if(p)u=e;else{let l=ue.calculatePreFeeAmount(e,s);d=l.sub(e),u=l}let m=ut.swapBaseOutputWithoutFees(u,t,i),f;if(p){let l=ue.calculatePreFeeAmount(m,o.add(s)),h=l.sub(m);d=ue.splitCreatorFee(h,o,s),y=h.sub(d),f=l}else{let l=ue.calculatePreFeeAmount(m,o);y=l.sub(m),f=l}let a=ue.protocolFee(y,c),g=ue.fundFee(y,r);return{newInputVaultAmount:t.add(m),newOutputVaultAmount:e.sub(u),inputAmount:f,outputAmount:e,tradeFee:y,protocolFee:a,fundFee:g,creatorFee:d}}};var j=_(require("bn.js")),de=_(require("decimal.js"));var nn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),De=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ne(t)}createTxBuilder(e){return this.scope.checkOwner(),new st({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let i=new we(e);return new st({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:i,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(nn(e))}logInfo(...e){this.logger.info(nn(e))}logAndCreateError(...e){let t=nn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Hn=require("@solana/web3.js"),_e=_(require("bn.js"));var O=require("@solana/buffer-layout"),rn=O.Layout,Un=O.Structure;var on=O.UInt;var Xn=O.u8,Fe=O.u16;var Be=O.s32;var zn=O.seq;var re=O.blob;var qe=class extends rn{constructor(t,i,o){super(t,o);this.blob=re(t),this.signed=i}decode(t,i=0){let o=new _e.default(this.blob.decode(t,i),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,i,o=0){return typeof t=="number"&&(t=new _e.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,o)}};function X(n){return new on(1,n)}function he(n){return new on(4,n)}function I(n){return new qe(8,!1,n)}function Q(n){return new qe(16,!1,n)}function Yn(n){return new qe(8,!0,n)}function Zn(n){return new qe(16,!0,n)}var St=class extends rn{constructor(t,i,o,s){super(t.span,s);this.layout=t,this.decoder=i,this.encoder=o}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,o){return this.layout.encode(this.encoder(t),i,o)}getSpan(t,i){return this.layout.getSpan(t,i)}};function V(n){return new St(re(32),e=>new Hn.PublicKey(e),e=>e.toBuffer(),n)}function Re(n){return new St(Xn(),zi,Hi,n)}function zi(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Hi(n){return n?1:0}var sn=class extends Un{decode(e,t){return super.decode(e,t)}};function G(n,e,t){return new sn(n,e,t)}function z(n,e,t){let i,o=typeof e=="number"?e:(0,_e.isBN)(e)?e.toNumber():new Proxy(e,{get(s,c){if(!i){let r=Reflect.get(s,"count");i=(0,_e.isBN)(r)?r.toNumber():r,Reflect.set(s,"count",i)}return Reflect.get(s,c)},set(s,c,r){return c==="count"&&(i=r),Reflect.set(s,c,r)}});return zn(n,o,t)}var gc=G([he("mintAuthorityOption"),V("mintAuthority"),I("supply"),X("decimals"),X("isInitialized"),he("freezeAuthorityOption"),V("freezeAuthority")]);var Yi=require("@solana/web3.js"),jn=require("@solana/spl-token");var Ee=o=>{var s=o,{address:n,programId:e,decimals:t}=s,i=be(s,["address","programId","decimals"]);return D({chainId:101,address:Ze(n).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:i.extensions||{}},i)},Ge=n=>n?Y(D({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:Y(D({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:Y(D({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;var J=require("@solana/web3.js"),te=require("@solana/spl-token");var Zi=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Nc=Buffer.from("amm_config","utf8"),ji=Buffer.from("pool","utf8"),Qi=Buffer.from("pool_lp_mint","utf8"),Ji=Buffer.from("pool_vault","utf8"),$i=Buffer.from("observation","utf8"),er=Buffer.from("permission","utf8");function Kt(n){return fe([Zi],n)}function an(n,e,t,i){return fe([ji,e.toBuffer(),t.toBuffer(),i.toBuffer()],n)}function tr(n,e){return fe([Qi,e.toBuffer()],n)}function Qn(n,e,t){return fe([Ji,e.toBuffer(),t.toBuffer()],n)}function mt(n,e){return fe([$i,e.toBuffer()],n)}function cn({poolId:n,programId:e,configId:t,mintA:i,mintB:o}){let s=Kt(e).publicKey,c=n||an(e,t,i,o).publicKey,r=tr(e,c).publicKey,p=Qn(e,c,i).publicKey,y=Qn(e,c,o).publicKey,d=mt(e,c).publicKey;return{poolId:c,configId:t,authority:s,lpMint:r,vaultA:p,vaultB:y,observationId:d}}var nr=Buffer.from("locked_liquidity","utf8");function dt(n,e){return fe([nr,e.toBuffer()],n)}function Jn(n,e){return fe([er,e.toBuffer()],n)}var Lr=require("@solana/web3.js"),Rr=_(require("bn.js")),Nr=_(require("decimal.js"));var Mt=require("@solana/spl-token");var Nt=require("@solana/web3.js"),Kr=_(require("bn.js"));var bn=require("@solana/spl-token");var gr=_(require("bn.js")),Pr=_(require("decimal.js"));var me=_(require("bn.js")),un=new me.default(0),$n=new me.default(1),ei=new me.default(-1),Lt=new me.default(1).shln(64),ti=new me.default(1).shln(128),ir=Lt.sub($n);var rr=ti.subn(1),Ue=-443636,pt=-Ue,ln=new me.default("4295048016"),mn=new me.default("79226673521066979257578248091"),Oc=new me.default("4295048017"),Fc=new me.default("79226673521066979257578248090");var or=new me.default(10).pow(new me.default(6));var Ec=new me.default("18446744073700000000");var yr=_(require("bn.js")),br=_(require("decimal.js"));var Gc=Buffer.from("amm_config","utf8"),Uc=Buffer.from("pool","utf8"),Xc=Buffer.from("pool_vault","utf8"),zc=Buffer.from("pool_reward_vault","utf8"),Hc=Buffer.from("position","utf8"),Yc=Buffer.from("tick_array","utf8"),Zc=Buffer.from("operation","utf8"),jc=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Qc=Buffer.from("observation","utf8");function dn(n){return fe([Buffer.from("metadata","utf8"),We.toBuffer(),n.toBuffer()],We)}var Jc=Buffer.from("locked_position","utf8");var $c=Buffer.from("support_mint","utf8");var lr=require("@solana/web3.js"),mr=require("@solana/spl-token"),dr=_(require("bn.js")),pr=_(require("decimal.js"));var sr=_(require("bn.js")),ar=_(require("decimal.js"));var yn=14;var Rt=60;var Ar=G([re(8),X("bump"),Fe("index"),V(""),he("protocolFeeRate"),he("tradeFeeRate"),Fe("tickSpacing"),z(I(),8,"")]),wr=G([he("blockTimestamp"),Yn("tickCumulative"),z(I(),4)]),li=G([re(8),Re("initialized"),I("recentEpoch"),Fe("observationIndex"),V("poolId"),z(wr,100,"observations"),z(I(),4)]),kr=G([X("rewardState"),I("openTime"),I("endTime"),I("lastUpdateTime"),Q("emissionsPerSecondX64"),I("rewardTotalEmissioned"),I("rewardClaimed"),V("tokenMint"),V("tokenVault"),V("creator"),Q("rewardGrowthGlobalX64")]),ai=G([re(8),X("bump"),V("ammConfig"),V("creator"),V("mintA"),V("mintB"),V("vaultA"),V("vaultB"),V("observationId"),X("mintDecimalsA"),X("mintDecimalsB"),Fe("tickSpacing"),Q("liquidity"),Q("sqrtPriceX64"),Be("tickCurrent"),he(),Q("feeGrowthGlobalX64A"),Q("feeGrowthGlobalX64B"),I("protocolFeesTokenA"),I("protocolFeesTokenB"),Q("swapInAmountTokenA"),Q("swapOutAmountTokenB"),Q("swapInAmountTokenB"),Q("swapOutAmountTokenA"),X("status"),z(X(),7,""),z(kr,3,"rewardInfos"),z(I(),16,"tickArrayBitmap"),I("totalFeesTokenA"),I("totalFeesClaimedTokenA"),I("totalFeesTokenB"),I("totalFeesClaimedTokenB"),I("fundFeesTokenA"),I("fundFeesTokenB"),I("startTime"),z(I(),15*4-3,"padding")]),Tr=G([Q("growthInsideLastX64"),I("rewardAmountOwed")]),ci=G([re(8),X("bump"),V("nftMint"),V("poolId"),Be("tickLower"),Be("tickUpper"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),z(Tr,3,"rewardInfos"),z(I(),8,"")]),pl=G([re(8),X("bump"),V("poolId"),Be("tickLowerIndex"),Be("tickUpperIndex"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),z(Q(),3,"rewardGrowthInside"),z(I(),8,"")]),Br=G([Be("tick"),Zn("liquidityNet"),Q("liquidityGross"),Q("feeGrowthOutsideX64A"),Q("feeGrowthOutsideX64B"),z(Q(),3,"rewardGrowthsOutsideX64"),z(he(),13,"")]),ri=G([re(8),V("poolId"),Be("startTickIndex"),z(Br,Rt,"ticks"),X("initializedTickCount"),z(X(),115,"")]),hr=G([re(329),z(V(),100,"whitelistMints")]),fr=G([re(8),V("poolId"),z(z(I(),8),yn,"positiveTickArrayBitmap"),z(z(I(),8),yn,"negativeTickArrayBitmap")]),fl=G([I(),X("bump"),V("owner"),V("poolId"),V("positionId"),V("nftAccount"),z(I(),8)]),xr=G([re(8),X("bump"),V("lockOwner"),V("poolId"),V("positionId"),V("nftAccount"),V("lockNftMint"),I("recentEpoch"),z(I(),8)]);li.span;var Nl=ne("Raydium_Clmm");var Mr=ne("Raydium_cpmm"),xe={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133],createPermissionPda:Buffer.from([135,136,2,216,137,169,181,202]),closePermissionPda:Buffer.from([156,84,32,118,69,135,70,123]),initializeWithPermission:Buffer.from([63,55,254,65,49,178,89,121]),collectCreatorFee:Buffer.from([20,22,86,123,198,28,219,132])};function mi(n,e,t,i,o,s,c,r,p,y,d,u,m,f,a,g,l,h,k,x){let w=G([I("amountMaxA"),I("amountMaxB"),I("openTime")]),A=an(n,t,s,c).publicKey,b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!o.equals(A),isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:te.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:te.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Cn,isSigner:!1,isWritable:!1},{pubkey:Pt,isSigner:!1,isWritable:!1}],B=Buffer.alloc(w.span);return w.encode({amountMaxA:h,amountMaxB:k,openTime:x},B),new J.TransactionInstruction({keys:b,programId:n,data:Buffer.from([...xe.initialize,...B])})}function di(n,e,t,i,o,s,c,r,p,y,d,u,m,f,a){let g=G([I("lpAmount"),I("amountMaxA"),I("amountMaxB")]),l=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:te.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:te.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],h=Buffer.alloc(g.span);return Mr.debug("cpmm deposit data",{lpAmount:m.toString(),amountMaxA:f.toString(),amountMaxB:a.toString()}),g.encode({lpAmount:m,amountMaxA:f,amountMaxB:a},h),new J.TransactionInstruction({keys:l,programId:n,data:Buffer.from([...xe.deposit,...h])})}function pi(n,e,t,i,o,s,c,r,p,y,d,u,m,f,a){let g=G([I("lpAmount"),I("amountMinA"),I("amountMinB")]),l=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:te.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:te.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:gt,isSigner:!1,isWritable:!1}],h=Buffer.alloc(g.span);return g.encode({lpAmount:m,amountMinA:f,amountMinB:a},h),new J.TransactionInstruction({keys:l,programId:n,data:Buffer.from([...xe.withdraw,...h])})}function fi(n,e,t,i,o,s,c,r,p,y,d,u,m,f,a,g){let l=G([I("amountIn"),I("amounOutMin")]),h=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!0}],k=Buffer.alloc(l.span);return l.encode({amountIn:a,amounOutMin:g},k),new J.TransactionInstruction({keys:h,programId:n,data:Buffer.from([...xe.swapBaseInput,...k])})}function yi(n,e,t,i,o,s,c,r,p,y,d,u,m,f,a,g){let l=G([I("amountInMax"),I("amountOut")]),h=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!0}],k=Buffer.alloc(l.span);return l.encode({amountInMax:a,amountOut:g},k),new J.TransactionInstruction({keys:h,programId:n,data:Buffer.from([...xe.swapBaseOutput,...k])})}async function bi(n){var l;let{ownerInfo:e,poolInfo:t,poolKeys:i,feeNftOwner:o,getEphemeralSigners:s}=n,c=[],[r,p]=[new J.PublicKey(t.id),new J.PublicKey(t.lpMint.address)],y;if(s)y=new J.PublicKey((await s(1))[0]);else{let h=J.Keypair.generate();c.push(h),y=h.publicKey}let{publicKey:d}=le(o,y,te.TOKEN_PROGRAM_ID),{publicKey:u}=dn(y),{publicKey:m}=dt(n.lockProgram,y),{publicKey:f}=le(e.wallet,p,te.TOKEN_PROGRAM_ID),{publicKey:a}=le(n.lockAuthProgram,p,te.TOKEN_PROGRAM_ID),g=Or({programId:n.lockProgram,auth:n.lockAuthProgram,payer:e.feePayer,liquidityOwner:e.wallet,nftOwner:o,nftMint:y,nftAccount:d,poolId:r,lockPda:m,mintLp:p,userLpVault:f,lockLpVault:a,poolVaultA:new J.PublicKey(i.vault.A),poolVaultB:new J.PublicKey(i.vault.B),metadataAccount:u,lpAmount:n.lpAmount,withMetadata:(l=n.withMetadata)!=null?l:!0});return{address:{nftMint:y,nftAccount:d,metadataAccount:u,lockPda:m,userLpVault:f,lockLpVault:a},instructions:[g],signers:c,instructionTypes:[ie.CpmmLockLp],lookupTableAddress:[]}}function Or({programId:n,auth:e,payer:t,liquidityOwner:i,nftOwner:o,nftMint:s,nftAccount:c,poolId:r,lockPda:p,mintLp:y,userLpVault:d,lockLpVault:u,poolVaultA:m,poolVaultB:f,metadataAccount:a,lpAmount:g,withMetadata:l}){let h=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:J.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:te.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:te.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1}],k=G([I("lpAmount"),Re("withMetadata")]),x=Buffer.alloc(k.span);k.encode({lpAmount:g,withMetadata:l},x);let w=Buffer.from([...xe.lockCpLiquidity,...x]);return new J.TransactionInstruction({keys:h,programId:n,data:w})}function gn({programId:n,nftOwner:e,auth:t,nftAccount:i,lockPda:o,poolId:s,mintLp:c,userVaultA:r,userVaultB:p,poolVaultA:y,poolVaultB:d,mintA:u,mintB:m,lockLpVault:f,lpFeeAmount:a,cpmmProgram:g,cpmmAuthProgram:l}){let h=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:g!=null?g:it,isSigner:!1,isWritable:!1},{pubkey:l!=null?l:Wn,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:te.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:te.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:gt,isSigner:!1,isWritable:!1}],k=G([I("lpFeeAmount")]),x=Buffer.alloc(k.span);k.encode({lpFeeAmount:a},x);let w=Buffer.from([...xe.collectCpFee,...x]);return new J.TransactionInstruction({keys:h,programId:n,data:w})}function Pn(n,e,t,i,o,s,c,r,p,y,d,u,m){let f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:te.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:J.SystemProgram.programId,isSigner:!1,isWritable:!1}];return new J.TransactionInstruction({keys:f,programId:n,data:xe.collectCreatorFee})}function gi(n,e,t,i,o,s,c,r,p,y,d,u,m,f,a,g,l,h,k,x,w,A,b){let B=G([I("amountA"),I("amountB"),I("openTime"),X("feeOn")]),T=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:h,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:te.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:te.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:J.SystemProgram.programId,isSigner:!1,isWritable:!1}],K=Buffer.alloc(B.span);return B.encode({amountA:x,amountB:w,openTime:A,feeOn:b},K),new J.TransactionInstruction({keys:T,programId:n,data:Buffer.from([...xe.initializeWithPermission,...K])})}var Pi=G([re(8),X("bump"),Re("disableCreatePool"),Fe("index"),I("tradeFeeRate"),I("protocolFeeRate"),I("fundFeeRate"),I("createPoolFee"),V("protocolOwner"),V("fundOwner"),I("creatorFeeRate"),z(I(),15)]),Ai=G([re(8),V("configId"),V("poolCreator"),V("vaultA"),V("vaultB"),V("mintLp"),V("mintA"),V("mintB"),V("mintProgramA"),V("mintProgramB"),V("observationId"),X("bump"),X("status"),X("lpDecimals"),X("mintDecimalA"),X("mintDecimalB"),I("lpAmount"),I("protocolFeesMintA"),I("protocolFeesMintB"),I("fundFeesMintA"),I("fundFeesMintB"),I("openTime"),I("epoch"),X("feeOn"),Re("enableCreatorFee"),z(X(),6),I("creatorFeesMintA"),I("creatorFeesMintB"),z(I(),28)]),Km=G([re(8),V("configId"),z(I(),30)]);var Ot=class extends De{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){return(await this.getRpcPoolInfos([e],t))[e]}async getRpcPoolInfos(e,t){let i=await Ne(this.scope.connection,e.map(u=>({pubkey:new P.PublicKey(u)}))),o={},s=new Set,c=[];for(let u=0;u<e.length;u++){let m=i[u];if(m.accountInfo===null)throw Error("fetch pool info error: "+String(e[u]));let f=Ai.decode(m.accountInfo.data);o[String(e[u])]=Y(D({},f),{programId:m.accountInfo.owner}),s.add(String(f.configId)),c.push(f.vaultA,f.vaultB)}let r={};if(t){let u=[...s],m=await Ne(this.scope.connection,u.map(f=>({pubkey:new P.PublicKey(f)})));for(let f=0;f<u.length;f++){let a=m[f].accountInfo;if(a===null)throw Error("fetch pool config error: "+u[f]);r[u[f]]=Pi.decode(a.data)}}let p={},y=await Ne(this.scope.connection,c.map(u=>({pubkey:new P.PublicKey(u)})));for(let u=0;u<c.length;u++){let m=y[u].accountInfo;if(m===null)throw Error("fetch vault info error: "+c[u]);p[String(c[u])]=new j.default(q.AccountLayout.decode(m.data).amount.toString())}let d={};for(let[u,m]of Object.entries(o)){let f=p[m.vaultA.toString()].sub(m.protocolFeesMintA).sub(m.fundFeesMintA).sub(m.creatorFeesMintA),a=p[m.vaultB.toString()].sub(m.protocolFeesMintB).sub(m.fundFeesMintB).sub(m.creatorFeesMintB);d[u]=Y(D({},m),{baseReserve:f,quoteReserve:a,vaultAAmount:p[m.vaultA.toString()],vaultBAmount:p[m.vaultB.toString()],configInfo:r[m.configId.toString()],poolPrice:new de.default(a.toString()).div(new de.default(10).pow(m.mintDecimalB)).div(new de.default(f.toString()).div(new de.default(10).pow(m.mintDecimalA)))})}return d}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((i,o)=>{var p,y,d,u;let s=e[o],[c,r]=[s.mintA.toBase58(),s.mintB.toBase58()];return Y(D({},i),{[o]:Y(D({},s),{id:new P.PublicKey(o),configInfo:s.configInfo,version:7,authority:Kt(s.programId).publicKey,mintA:Ee({address:c,decimals:s.mintDecimalA,programId:s.mintProgramA.toBase58(),extensions:{feeConfig:(p=t[c])!=null&&p.feeConfig?Ge((y=t[c])==null?void 0:y.feeConfig):void 0}}),mintB:Ee({address:r,decimals:s.mintDecimalB,programId:s.mintProgramB.toBase58(),extensions:{feeConfig:(d=t[r])!=null&&d.feeConfig?Ge((u=t[r])==null?void 0:u.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(e){let t=await this.getRpcPoolInfo(e,!0),i=await _t({connection:this.scope.connection,mints:[t.mintA,t.mintB]}),o=Ee({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:i[t.mintA.toBase58()].feeConfig?Ge(i[t.mintA.toBase58()].feeConfig):void 0}}),s=Ee({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:i[t.mintB.toBase58()].feeConfig?Ge(i[t.mintB.toBase58()].feeConfig):void 0}}),c=Ee({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:q.TOKEN_PROGRAM_ID.toBase58()}),r={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},p={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:c,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:r,mintA:o,mintB:s,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new de.default(t.vaultAAmount.toString()).div(10**o.decimals).toNumber(),mintAmountB:new de.default(t.vaultBAmount.toString()).div(10**s.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,burnPercent:0,day:p,week:p,month:p,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:o,mintB:s,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:Kt(t.programId).publicKey.toBase58(),mintLp:c,config:r,observationId:mt(t.programId,new P.PublicKey(e)).publicKey.toBase58()},rpcData:t}}async createPool(a){var g=a,{poolId:e,programId:t,poolFeeAccount:i,startTime:o,ownerInfo:s,associatedOnly:c=!1,checkCreateATAOwner:r=!1,txVersion:p,feeConfig:y,computeBudgetConfig:d,txTipConfig:u,feePayer:m}=g,f=be(g,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig","txTipConfig","feePayer"]);var E,H,$;let l=s.feePayer||((E=this.scope.owner)==null?void 0:E.publicKey),h=new j.default(new P.PublicKey(f.mintA.address).toBuffer()).lte(new j.default(new P.PublicKey(f.mintB.address).toBuffer())),[k,x]=h?[f.mintA,f.mintB]:[f.mintB,f.mintA],[w,A]=h?[f.mintAAmount,f.mintBAmount]:[f.mintBAmount,f.mintAAmount],b=s.useSOLBalance&&k.address===q.NATIVE_MINT.toBase58(),B=s.useSOLBalance&&x.address===q.NATIVE_MINT.toBase58(),[T,K]=[new P.PublicKey(k.address),new P.PublicKey(x.address)],L=this.createTxBuilder(m),{account:S,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({mint:T,tokenProgram:k.programId,owner:this.scope.ownerPubKey,createInfo:b?{payer:l,amount:w}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:r});L.addInstruction(C||{});let{account:R,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:new P.PublicKey(x.address),tokenProgram:x.programId,owner:this.scope.ownerPubKey,createInfo:B?{payer:l,amount:A}:void 0,notUseTokenAccount:B,skipCloseAccount:!B,associatedOnly:B?!1:c,checkCreateATAOwner:r});if(L.addInstruction(F||{}),S===void 0||R===void 0)throw Error("you don't has some token account");let W=cn({poolId:e,programId:t,configId:new P.PublicKey(y.id),mintA:T,mintB:K});return L.addInstruction({instructions:[mi(t,this.scope.ownerPubKey,new P.PublicKey(y.id),W.authority,W.poolId,T,K,W.lpMint,S,R,le(this.scope.ownerPubKey,W.lpMint).publicKey,W.vaultA,W.vaultB,i,new P.PublicKey((H=k.programId)!=null?H:q.TOKEN_PROGRAM_ID),new P.PublicKey(($=x.programId)!=null?$:q.TOKEN_PROGRAM_ID),W.observationId,w,A,o)],instructionTypes:[ie.CpmmCreatePool]}),L.addCustomComputeBudget(d),L.addTipInstruction(u),L.versionBuild({txVersion:p,extInfo:{address:Y(D({},W),{mintA:k,mintB:x,programId:t,poolFeeAccount:i,feeConfig:y})}})}async addLiquidity(e){let{poolInfo:t,poolKeys:i,inputAmount:o,baseIn:s,slippage:c,computeResult:r,computeBudgetConfig:p,txTipConfig:y,config:d,txVersion:u,feePayer:m}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),o.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:o.toString()});let{account:f}=this.scope,{bypassAssociatedCheck:a,checkCreateATAOwner:g}=D({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},d),l=r?void 0:await this.getRpcPoolInfo(t.id),{liquidity:h,inputAmountFee:k,anotherAmount:x}=r||this.computePairAmount({poolInfo:Y(D({},t),{lpAmount:new de.default(l.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()}),baseReserve:l.baseReserve,quoteReserve:l.quoteReserve,slippage:new pe(0),baseIn:s,epochInfo:await this.scope.fetchEpochInfo(),amount:new de.default(o.toString()).div(10**(s?t.mintA.decimals:t.mintB.decimals))}),w=x.amount,A=t.mintA.address===q.NATIVE_MINT.toString(),b=t.mintB.address===q.NATIVE_MINT.toString(),B=this.createTxBuilder(m),[T,K]=[new P.PublicKey(t.mintA.address),new P.PublicKey(t.mintB.address)],{account:L,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new P.PublicKey(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||(s?o:w).isZero()?{payer:this.scope.ownerPubKey,amount:s?o:w}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!1,checkCreateATAOwner:g});B.addInstruction(S||{});let{account:C,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new P.PublicKey(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||(s?w:o).isZero()?{payer:this.scope.ownerPubKey,amount:s?w:o}:void 0,skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:!1,checkCreateATAOwner:g});B.addInstruction(R||{}),!L&&!C&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",f.tokenAccounts);let F=await f.getCreatedTokenAccount({mint:new P.PublicKey(t.lpMint.address)}),se=await f.handleTokenAccount({side:"out",amount:0,mint:new P.PublicKey(t.lpMint.address),tokenAccount:F,bypassAssociatedCheck:a,checkCreateATAOwner:g}),{tokenAccount:W}=se,E=be(se,["tokenAccount"]);B.addInstruction(E);let H=i!=null?i:await this.getCpmmPoolKeys(t.id),$=new pe(new j.default(1)).sub(c);return B.addInstruction({instructions:[di(new P.PublicKey(t.programId),this.scope.ownerPubKey,new P.PublicKey(H.authority),new P.PublicKey(t.id),W,L,C,new P.PublicKey(H.vault.A),new P.PublicKey(H.vault.B),T,K,new P.PublicKey(t.lpMint.address),r?r==null?void 0:r.liquidity:$.mul(h).quotient,s?k.amount:w,s?w:k.amount)],instructionTypes:[ie.CpmmAddLiquidity],lookupTableAddress:H.lookupTableAccount?[H.lookupTableAccount]:[]}),B.addCustomComputeBudget(p),B.addTipInstruction(y),B.versionBuild({txVersion:u})}async withdrawLiquidity(e){var E,H;let{poolInfo:t,poolKeys:i,lpAmount:o,slippage:s,computeBudgetConfig:c,txTipConfig:r,txVersion:p,feePayer:y,closeWsol:d=!0}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=new pe(new j.default(1)).sub(s),m=await this.getRpcPoolInfo(t.id),[f,a]=[u.mul(o.mul(m.baseReserve).div(m.lpAmount)).quotient,u.mul(o.mul(m.quoteReserve).div(m.lpAmount)).quotient],g=await this.scope.fetchEpochInfo(),[l,h]=[ke(f,t.mintA.extensions.feeConfig,g,!1),ke(a,t.mintB.extensions.feeConfig,g,!1)],{account:k}=this.scope,x=this.createTxBuilder(y),[w,A]=[new P.PublicKey(t.mintA.address),new P.PublicKey(t.mintB.address)],b=w.equals(ce),B=A.equals(ce),T,K,{account:L,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new P.PublicKey(t.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(b&&d),associatedOnly:!b,checkCreateATAOwner:!1});T=L,S&&x.addInstruction(S);let{account:C,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new P.PublicKey(t.mintB.address),notUseTokenAccount:B,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(B&&d),associatedOnly:!B,checkCreateATAOwner:!1});K=C,R&&x.addInstruction(R),(!T||!K)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",k.tokenAccounts);let F=await k.getCreatedTokenAccount({mint:new P.PublicKey(t.lpMint.address)});F||this.logAndCreateError("cannot found lp token account","tokenAccounts",k.tokenAccounts);let W=i!=null?i:await this.getCpmmPoolKeys(t.id);return x.addInstruction({instructions:[pi(new P.PublicKey(t.programId),this.scope.ownerPubKey,new P.PublicKey(W.authority),new P.PublicKey(t.id),F,T,K,new P.PublicKey(W.vault.A),new P.PublicKey(W.vault.B),w,A,new P.PublicKey(t.lpMint.address),o,f.sub((E=l.fee)!=null?E:new j.default(0)),a.sub((H=h.fee)!=null?H:new j.default(0)))],instructionTypes:[ie.CpmmWithdrawLiquidity],lookupTableAddress:W.lookupTableAccount?[W.lookupTableAccount]:[]}),x.addCustomComputeBudget(c),x.addTipInstruction(r),x.versionBuild({txVersion:p})}async swap(e){var S,C,R,F,W,E;let{poolInfo:t,poolKeys:i,baseIn:o,fixedOut:s,inputAmount:c,swapResult:r,slippage:p=0,config:y,computeBudgetConfig:d,txTipConfig:u,txVersion:m,feePayer:f}=e,{bypassAssociatedCheck:a,checkCreateATAOwner:g,associatedOnly:l}=D({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},y),h=this.createTxBuilder(f),[k,x]=[new P.PublicKey(t.mintA.address),new P.PublicKey(t.mintB.address)];s?r.inputAmount=r.inputAmount.mul(new j.default((1+p)*1e4)).div(new j.default(1e4)):r.outputAmount=r.outputAmount.mul(new j.default((1-p)*1e4)).div(new j.default(1e4));let w=t.mintA.address===ce.toBase58(),A=t.mintB.address===ce.toBase58(),{account:b,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({mint:k,tokenProgram:new P.PublicKey((S=t.mintA.programId)!=null?S:q.TOKEN_PROGRAM_ID),owner:this.scope.ownerPubKey,createInfo:w||!o?{payer:this.scope.ownerPubKey,amount:o?r.inputAmount:0}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:l,checkCreateATAOwner:g});B&&h.addInstruction(B);let{account:T,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({mint:x,tokenProgram:new P.PublicKey((C=t.mintB.programId)!=null?C:q.TOKEN_PROGRAM_ID),owner:this.scope.ownerPubKey,createInfo:A||o?{payer:this.scope.ownerPubKey,amount:o?0:r.inputAmount}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:l,checkCreateATAOwner:g});K&&h.addInstruction(K),(!b||!T)&&this.logAndCreateError("user do not have token account",{mintA:t.mintA.symbol||t.mintA.address,mintB:t.mintB.symbol||t.mintB.address,mintATokenAcc:b,mintBTokenAcc:T,mintAUseSOLBalance:w,mintBUseSOLBalance:A,associatedOnly:l});let L=i!=null?i:await this.getCpmmPoolKeys(t.id);return h.addInstruction({instructions:[s?yi(new P.PublicKey(t.programId),this.scope.ownerPubKey,new P.PublicKey(L.authority),new P.PublicKey(L.config.id),new P.PublicKey(t.id),o?b:T,o?T:b,new P.PublicKey(L.vault[o?"A":"B"]),new P.PublicKey(L.vault[o?"B":"A"]),new P.PublicKey((W=t[o?"mintA":"mintB"].programId)!=null?W:q.TOKEN_PROGRAM_ID),new P.PublicKey((E=t[o?"mintB":"mintA"].programId)!=null?E:q.TOKEN_PROGRAM_ID),o?k:x,o?x:k,mt(new P.PublicKey(t.programId),new P.PublicKey(t.id)).publicKey,r.inputAmount,r.outputAmount):fi(new P.PublicKey(t.programId),this.scope.ownerPubKey,new P.PublicKey(L.authority),new P.PublicKey(L.config.id),new P.PublicKey(t.id),o?b:T,o?T:b,new P.PublicKey(L.vault[o?"A":"B"]),new P.PublicKey(L.vault[o?"B":"A"]),new P.PublicKey((R=t[o?"mintA":"mintB"].programId)!=null?R:q.TOKEN_PROGRAM_ID),new P.PublicKey((F=t[o?"mintB":"mintA"].programId)!=null?F:q.TOKEN_PROGRAM_ID),o?k:x,o?x:k,mt(new P.PublicKey(t.programId),new P.PublicKey(t.id)).publicKey,c,r.outputAmount)],instructionTypes:[s?ie.CpmmSwapBaseOut:ie.ClmmSwapBaseIn]}),h.addCustomComputeBudget(d),h.addTipInstruction(u),h.versionBuild({txVersion:m})}async lockLp(e){var m,f,a,g,l;let{poolInfo:t,lpAmount:i,computeBudgetConfig:o,txTipConfig:s,txVersion:c,feePayer:r,feeNftOwner:p}=e;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let y=this.createTxBuilder(r),d=(m=e.poolKeys)!=null?m:await this.getCpmmPoolKeys(t.id),u=await bi({poolInfo:t,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(f=e.feePayer)!=null?f:this.scope.ownerPubKey},feeNftOwner:p!=null?p:this.scope.ownerPubKey,lockProgram:(a=e.programId)!=null?a:Bt,lockAuthProgram:(g=e.authProgram)!=null?g:ht,lpAmount:i,withMetadata:(l=e.withMetadata)!=null?l:!0,getEphemeralSigners:e.getEphemeralSigners});return y.addInstruction(u),y.addCustomComputeBudget(o),y.addTipInstruction(s),y.versionBuild({txVersion:c,extInfo:u.address})}async harvestLockLp(e){var C;let{poolInfo:t,lpFeeAmount:i,nftMint:o,programId:s=Bt,authProgram:c=ht,cpmmProgram:r,computeBudgetConfig:p,txTipConfig:y,txVersion:d,closeWsol:u=!0}=e;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let m=e.feePayer||this.scope.ownerPubKey,f=this.createTxBuilder(m),[a,g]=[new P.PublicKey(t.mintA.address),new P.PublicKey(t.mintB.address)],l=a.equals(ce),h=g.equals(ce),k,x,{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new P.PublicKey(t.mintA.address),notUseTokenAccount:l,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(l&&u),associatedOnly:!l,checkCreateATAOwner:!1});k=w,A&&f.addInstruction(A);let{account:b,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new P.PublicKey(t.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(h&&u),associatedOnly:!h,checkCreateATAOwner:!1});x=b,B&&f.addInstruction(B),(!k||!x)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:k,tokenAccountB:x});let T=(C=e.poolKeys)!=null?C:await this.getCpmmPoolKeys(t.id),{publicKey:K}=le(m,o,q.TOKEN_PROGRAM_ID),{publicKey:L}=dt(s,o),{publicKey:S}=le(c,new P.PublicKey(t.lpMint.address),q.TOKEN_PROGRAM_ID);return f.addInstruction({instructions:[gn({programId:s,nftOwner:this.scope.ownerPubKey,auth:c,nftMint:o,nftAccount:K,lockPda:L,poolId:new P.PublicKey(t.id),mintLp:new P.PublicKey(T.mintLp.address),userVaultA:k,userVaultB:x,poolVaultA:new P.PublicKey(T.vault.A),poolVaultB:new P.PublicKey(T.vault.B),mintA:a,mintB:g,lockLpVault:S,lpFeeAmount:i,cpmmProgram:r==null?void 0:r.programId,cpmmAuthProgram:r==null?void 0:r.authProgram})],instructionTypes:[ie.CpmmCollectLockFee]}),f.addCustomComputeBudget(p),f.addTipInstruction(y),f.versionBuild({txVersion:d})}async harvestMultiLockLp(e){var m;let{lockInfo:t,programId:i=Bt,authProgram:o=ht,cpmmProgram:s,computeBudgetConfig:c,txVersion:r,closeWsol:p=!0}=e,y=e.feePayer||this.scope.ownerPubKey,d=this.createTxBuilder(y),u={};for(let f of t){let{poolInfo:a,lpFeeAmount:g,nftMint:l}=f;if(g.isZero())continue;let[h,k]=[new P.PublicKey(a.mintA.address),new P.PublicKey(a.mintB.address)],x=h.equals(ce),w=k.equals(ce),A=u[a.mintA.address],b=u[a.mintB.address];if(!A)if(x){let{account:S,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:a.mintA.programId,mint:new P.PublicKey(a.mintA.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:!1,checkCreateATAOwner:!1});A=S,C&&d.addInstruction(C),u[a.mintA.address]=S}else{let S=new P.PublicKey(a.mintA.address);A=this.scope.account.getAssociatedTokenAccount(S,new P.PublicKey(a.mintA.programId)),d.addInstruction({instructions:[(0,q.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,A,this.scope.ownerPubKey,S,new P.PublicKey(a.mintA.programId))]}),u[a.mintA.address]=A}if(!b)if(w){let{account:S,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:a.mintB.programId,mint:new P.PublicKey(a.mintB.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:!1,checkCreateATAOwner:!1});b=S,C&&d.addInstruction(C),u[a.mintB.address]=S}else{let S=new P.PublicKey(a.mintB.address);b=this.scope.account.getAssociatedTokenAccount(S,new P.PublicKey(a.mintB.programId)),d.addInstruction({instructions:[(0,q.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,b,this.scope.ownerPubKey,S,new P.PublicKey(a.mintB.programId))]}),u[a.mintB.address]=b}(!A||!b)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:A,tokenAccountB:b});let B=(m=f.poolKeys)!=null?m:await this.getCpmmPoolKeys(a.id),{publicKey:T}=le(y,l,q.TOKEN_PROGRAM_ID),{publicKey:K}=dt(i,l),{publicKey:L}=le(o,new P.PublicKey(a.lpMint.address),q.TOKEN_PROGRAM_ID);d.addInstruction({instructions:[gn({programId:i,nftOwner:this.scope.ownerPubKey,auth:o,nftMint:l,nftAccount:T,lockPda:K,poolId:new P.PublicKey(a.id),mintLp:new P.PublicKey(B.mintLp.address),userVaultA:A,userVaultB:b,poolVaultA:new P.PublicKey(B.vault.A),poolVaultB:new P.PublicKey(B.vault.B),mintA:h,mintB:k,lockLpVault:L,lpFeeAmount:g,cpmmProgram:s==null?void 0:s.programId,cpmmAuthProgram:s==null?void 0:s.authProgram})],instructionTypes:[ie.CpmmCollectLockFee]})}return r===0?d.sizeCheckBuildV0({computeBudgetConfig:c}):d.sizeCheckBuild({computeBudgetConfig:c})}async createPoolWithPermission(g){var l=g,{poolId:e,programId:t,poolFeeAccount:i,startTime:o,ownerInfo:s,associatedOnly:c=!1,checkCreateATAOwner:r=!1,txVersion:p,feeConfig:y,computeBudgetConfig:d,txTipConfig:u,feePayer:m,feeOn:f}=l,a=be(l,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig","txTipConfig","feePayer","feeOn"]);var H,$,se;console.log("***this method only available for wallet with permissions***");let h=s.feePayer||((H=this.scope.owner)==null?void 0:H.publicKey),k=new j.default(new P.PublicKey(a.mintA.address).toBuffer()).lte(new j.default(new P.PublicKey(a.mintB.address).toBuffer())),[x,w]=k?[a.mintA,a.mintB]:[a.mintB,a.mintA],[A,b]=k?[a.mintAAmount,a.mintBAmount]:[a.mintBAmount,a.mintAAmount],B=s.useSOLBalance&&x.address===q.NATIVE_MINT.toBase58(),T=s.useSOLBalance&&w.address===q.NATIVE_MINT.toBase58(),[K,L]=[new P.PublicKey(x.address),new P.PublicKey(w.address)],S=this.createTxBuilder(m),{account:C,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:K,tokenProgram:x.programId,owner:this.scope.ownerPubKey,createInfo:B?{payer:h,amount:A}:void 0,notUseTokenAccount:B,skipCloseAccount:!B,associatedOnly:B?!1:c,checkCreateATAOwner:r});S.addInstruction(R||{});let{account:F,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:new P.PublicKey(w.address),tokenProgram:w.programId,owner:this.scope.ownerPubKey,createInfo:T?{payer:h,amount:b}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:c,checkCreateATAOwner:r});if(S.addInstruction(W||{}),C===void 0||F===void 0)throw Error("you don't has some token account");let E=cn({poolId:e,programId:t,configId:new P.PublicKey(y.id),mintA:K,mintB:L});return S.addInstruction({instructions:[gi(t,this.scope.ownerPubKey,this.scope.ownerPubKey,new P.PublicKey(y.id),E.authority,E.poolId,K,L,E.lpMint,C,F,le(this.scope.ownerPubKey,E.lpMint).publicKey,E.vaultA,E.vaultB,i,new P.PublicKey(($=x.programId)!=null?$:q.TOKEN_PROGRAM_ID),new P.PublicKey((se=w.programId)!=null?se:q.TOKEN_PROGRAM_ID),E.observationId,Jn(t,this.scope.ownerPubKey).publicKey,A,b,o,f)],instructionTypes:[ie.CpmmCreatePool]}),S.addCustomComputeBudget(d),S.addTipInstruction(u),S.versionBuild({txVersion:p,extInfo:{address:Y(D({},E),{mintA:x,mintB:w,programId:t,poolFeeAccount:i,feeConfig:y})}})}async collectCreatorFees({poolInfo:e,poolKeys:t,programId:i=it,txVersion:o,computeBudgetConfig:s,txTipConfig:c,feePayer:r}){let p=r||this.scope.ownerPubKey,y=this.createTxBuilder(p),d=t!=null?t:await this.getCpmmPoolKeys(e.id),[u,m,f,a]=[new P.PublicKey(e.mintA.address),new P.PublicKey(e.mintB.address),new P.PublicKey(e.mintA.programId),new P.PublicKey(e.mintB.programId)],g=this.scope.account.getAssociatedTokenAccount(u,f),l=this.scope.account.getAssociatedTokenAccount(m,a);return y.addInstruction({instructions:[(0,q.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,g,this.scope.ownerPubKey,u,new P.PublicKey(e.mintA.programId)),(0,q.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,l,this.scope.ownerPubKey,m,new P.PublicKey(e.mintB.programId))]}),y.addInstruction({instructions:[Pn(i,this.scope.ownerPubKey,new P.PublicKey(d.authority),new P.PublicKey(d.id),new P.PublicKey(d.config.id),new P.PublicKey(d.vault.A),new P.PublicKey(d.vault.B),u,m,g,l,f,a)],instructionTypes:[]}),y.addCustomComputeBudget(s),y.addTipInstruction(c),y.versionBuild({txVersion:o})}async collectMultiCreatorFees({poolInfoList:e,programId:t=it,txVersion:i,computeBudgetConfig:o,feePayer:s}){let c=s||this.scope.ownerPubKey,r=this.createTxBuilder(c),p={},y=await this.scope.api.fetchPoolKeysById({idList:e.map(d=>d.id)});for(let d of e){let u=y.find(k=>k.id===d.id)||await this.getCpmmPoolKeys(d.id),[m,f,a,g]=[new P.PublicKey(d.mintA.address),new P.PublicKey(d.mintB.address),new P.PublicKey(d.mintA.programId),new P.PublicKey(d.mintB.programId)],l=p[d.mintA.address]||this.scope.account.getAssociatedTokenAccount(m,a),h=p[d.mintB.address]||this.scope.account.getAssociatedTokenAccount(f,g);p[d.mintA.address]||r.addInstruction({instructions:[(0,q.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,l,this.scope.ownerPubKey,m,a)]}),p[d.mintB.address]||r.addInstruction({instructions:[(0,q.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,h,this.scope.ownerPubKey,f,g)]}),p[d.mintA.address]=l,p[d.mintB.address]=h,r.addInstruction({instructions:[Pn(t,this.scope.ownerPubKey,new P.PublicKey(u.authority),new P.PublicKey(u.id),new P.PublicKey(u.config.id),new P.PublicKey(u.vault.A),new P.PublicKey(u.vault.B),m,f,l,h,a,g)],instructionTypes:[]})}return i===0?r.sizeCheckBuildV0({computeBudgetConfig:o}):r.sizeCheckBuild({computeBudgetConfig:o})}computeSwapAmount({pool:e,amountIn:t,outputMint:i,slippage:o}){let s=i.toString()===e.mintB.address,c=e.feeOn===0||e.feeOn===2,r=s?lt.swapBaseInput(t,s?e.baseReserve:e.quoteReserve,s?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate,e.configInfo.creatorFeeRate,e.configInfo.protocolFeeRate,e.configInfo.fundFeeRate,c):lt.swapBaseOutput(t,s?e.baseReserve:e.quoteReserve,s?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate,e.configInfo.creatorFeeRate,e.configInfo.protocolFeeRate,e.configInfo.fundFeeRate,c),p=new de.default(r.outputAmount.toString()).div(r.inputAmount.toString()),y=r.outputAmount.mul(new j.default((1-o)*1e4)).div(new j.default(1e4));return{allTrade:r.inputAmount.eq(t),amountIn:t,amountOut:r.outputAmount,minAmountOut:y,executionPrice:p,fee:r.tradeFee,priceImpact:e.poolPrice.sub(p).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:i,amount:o,slippage:s,epochInfo:c,baseIn:r}){var w,A,b,B,T,K,L,S,C;let p=1-Number(s.toSignificant())/100,y=new j.default(new de.default(o).mul(10**e[r?"mintA":"mintB"].decimals).mul(p).toFixed(0)),d=ke(y,e[r?"mintA":"mintB"].extensions.feeConfig,c,!1),u=y.sub((w=d.fee)!=null?w:new j.default(0)),m=new j.default(new de.default(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,de.default.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",r?e.mintA.symbol:e.mintB.symbol,"amountIn:",y.toString(),"amountInFee:",(b=(A=d.fee)==null?void 0:A.toString())!=null?b:0,"anotherToken:",r?e.mintB.symbol:e.mintA.symbol,"slippage:",`${s.toSignificant()}%`);let f=r?"base":"quote";this.logDebug("input side:",f);let a=u.mul(m).div(f==="base"?t:i),g={amount:jt,fee:void 0,expirationTime:void 0};if(!u.isZero()){let R=Fr(a,t,i,m);this.logDebug("lpAmountData:",{amountA:R.amountA.toString(),amountB:R.amountB.toString()}),g=ke(R[r?"amountB":"amountA"],e[r?"mintB":"mintA"].extensions.feeConfig,c,!0)}let l=new pe(new j.default(1)).add(s),h=new pe(new j.default(1)).sub(s),k=ke(l.mul(g.amount.sub((B=g.fee)!=null?B:new j.default(0))).quotient,e[r?"mintB":"mintA"].extensions.feeConfig,c,!0),x=ke(h.mul(g.amount.sub((T=g.fee)!=null?T:new j.default(0))).quotient,e[r?"mintB":"mintA"].extensions.feeConfig,c,!0);return this.logDebug("anotherAmount:",g.amount.toString(),"anotherAmountFee:",(L=(K=g.fee)==null?void 0:K.toString())!=null?L:0,"maxAnotherAmount:",k.amount.toString(),"maxAnotherAmountFee:",(C=(S=k.fee)==null?void 0:S.toString())!=null?C:0),{inputAmountFee:d,anotherAmount:g,maxAnotherAmount:k,minAnotherAmount:x,liquidity:a}}};function Fr(n,e,t,i){let o=n.mul(e).div(i);!o.isZero()&&!n.mul(e).mod(i).isZero()&&(o=o.add(new j.default(1)));let s=n.mul(t).div(i);return!s.isZero()&&!n.mul(t).mod(i).isZero()&&(s=s.add(new j.default(1))),{amountA:o,amountB:s}}0&&(module.exports={});
//# sourceMappingURL=cpmm.js.map