var li=Object.defineProperty,mi=Object.defineProperties;var di=Object.getOwnPropertyDescriptors;var ut=Object.getOwnPropertySymbols;var dn=Object.prototype.hasOwnProperty,pn=Object.prototype.propertyIsEnumerable;var mn=(n,t,e)=>t in n?li(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,v=(n,t)=>{for(var e in t||(t={}))dn.call(t,e)&&mn(n,e,t[e]);if(ut)for(var e of ut(t))pn.call(t,e)&&mn(n,e,t[e]);return n},q=(n,t)=>mi(n,di(t));var le=(n,t)=>{var e={};for(var i in n)dn.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&ut)for(var i of ut(n))t.indexOf(i)<0&&pn.call(n,i)&&(e[i]=n[i]);return e};import{PublicKey as T}from"@solana/web3.js";import{AccountLayout as Nr,NATIVE_MINT as Lt,TOKEN_PROGRAM_ID as ne,createAssociatedTokenAccountIdempotentInstruction as ui}from"@solana/spl-token";import fe from"bn.js";import oc from"decimal.js";import Xi from"big.js";import qa from"bn.js";import{get as fn,set as pi}from"lodash";var Nt=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},bn={},fi={};function Q(n){let t=fn(bn,n);if(!t){let e=fn(fi,n);t=new Nt({name:n,logLevel:e}),pi(bn,n,t)}return t}import{PublicKey as yn}from"@solana/web3.js";import{MINT_SIZE as bi,TOKEN_PROGRAM_ID as yi,getTransferFeeConfig as gi,unpackMint as Pi}from"@solana/spl-token";var Mt=Q("Raydium_accountInfo_util");async function qe(n,t,e){let{batchRequest:i,commitment:s="confirmed",chunkCount:o=100}=v({batchRequest:!1},e),a=Ot(t,o),r=new Array(a.length).fill([]);if(i){let d=a.map(l=>{let b=n._buildArgs([l.map(c=>c.toBase58())],s,"base64");return{methodName:"getMultipleAccounts",args:b}}),g=Ot(d,10);r=(await(await Promise.all(g.map(async l=>await n._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(b=>{if(b){let{data:c,executable:p,lamports:P,owner:u,rentEpoch:h}=b;return c.length!==2&&c[1]!=="base64"&&Mt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(c[0],"base64"),executable:p,lamports:P,owner:new yn(u),rentEpoch:h}}return null})))}else try{r=await Promise.all(a.map(d=>n.getMultipleAccountsInfo(d,s)))}catch(d){d instanceof Error&&Mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.message}`)}return r.flat()}async function Be(n,t,e){let i=await qe(n,t.map(s=>s.pubkey),e);return t.map((s,o)=>q(v({},s),{accountInfo:i[o]}))}async function Ft({connection:n,mints:t,config:e}){var o,a,r;if(t.length===0)return{};let i=await Be(n,t.map(d=>({pubkey:Ge(d)})),e),s={};for(let d of i){if(!d.accountInfo||d.accountInfo.data.length<bi){console.log("invalid mint account",d.pubkey.toBase58());continue}let g=Pi(d.pubkey,d.accountInfo,(o=d.accountInfo)==null?void 0:o.owner);s[d.pubkey.toString()]=q(v({},g),{programId:((a=d.accountInfo)==null?void 0:a.owner)||yi,feeConfig:(r=gi(g))!=null?r:void 0})}return s[yn.default.toBase58()]=s[te.toBase58()],s}import Ue from"bn.js";var gn=9007199254740991;function me(n){let t=Q("Raydium_parseBigNumberish");if(n instanceof Ue)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new Ue(n);t.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&t.logWithError(`BigNumberish number underflow: ${n}`),(n>=gn||n<=-gn)&&t.logWithError(`BigNumberish number overflow: ${n}`),new Ue(String(n))):typeof n=="bigint"?new Ue(n.toString()):(t.error(`invalid BigNumberish value: ${n}`),new Ue(0))}import{PublicKey as Ai}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Pn}from"@solana/spl-token";var Et={chainId:101,address:Ai.default.toBase58(),programId:Pn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},we={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Pn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Vt}from"@solana/web3.js";import{PublicKey as z,SystemProgram as An,SYSVAR_RENT_PUBKEY as wi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ki}from"@solana/spl-token";function Dt({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var to=[Dt({pubkey:ki,isWritable:!1}),Dt({pubkey:An.programId,isWritable:!1}),Dt({pubkey:wi,isWritable:!1})];function vt({publicKey:n,transformSol:t}){let e=wn(n.toString());if(e instanceof z)return t&&e.equals(Xe)?te:e;if(t&&e.toString()===Xe.toBase58())return te;if(typeof e=="string"){if(e===z.default.toBase58())return z.default;try{return new z(e)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function wn(n){try{return new z(n)}catch{return n}}var Ti=new z("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),lt=new z("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),mt=new z("SysvarRent111111111111111111111111111111111"),no=new z("SysvarC1ock11111111111111111111111111111111"),Ne=new z("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),io=new z("Sysvar1nstructions1111111111111111111111111"),kn=An.programId,ro=new z("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),oo=new z("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),so=new z("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ao=new z("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),co=new z("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),uo=new z("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),lo=new z("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),mo=new z("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),po=new z("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),fo=new z("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),bo=new z("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),te=new z("So11111111111111111111111111111111111111112"),Xe=z.default;function Ge(n){return vt({publicKey:n,transformSol:!0})}var Wt=class{constructor({mint:t,decimals:e,symbol:i,name:s,skipMint:o=!1,isToken2022:a=!1}){if(t===Xe.toBase58()||t instanceof Vt&&Xe.equals(t)){this.decimals=we.decimals,this.symbol=we.symbol,this.name=we.name,this.mint=new Vt(we.address),this.isToken2022=!1;return}this.decimals=e,this.symbol=i||t.toString().substring(0,6),this.name=s||t.toString().substring(0,6),this.mint=o?Vt.default:vt({publicKey:t}),this.isToken2022=a}equals(t){return this===t?!0:this.mint.equals(t.mint)}},ke=Wt;ke.WSOL=new Wt(q(v({},we),{mint:we.address}));var _t=class{constructor({decimals:t,symbol:e="UNKNOWN",name:i="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=i}equals(t){return this===t}},dt=_t;dt.SOL=new _t(Et);import hi from"toformat";var Bi=hi,ze=Bi;import ft from"big.js";import Ii from"bn.js";import Si from"decimal.js-light";var pt=Q("module/fraction"),qt=ze(ft),He=ze(Si),Ci={[0]:He.ROUND_DOWN,[1]:He.ROUND_HALF_UP,[2]:He.ROUND_UP},Ki={[0]:ft.roundDown,[1]:ft.roundHalfUp,[2]:ft.roundUp},G=class{constructor(t,e=new Ii(1)){this.numerator=me(t),this.denominator=me(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new G(this.denominator,this.numerator)}add(t){let e=t instanceof G?t:new G(me(t));return this.denominator.eq(e.denominator)?new G(this.numerator.add(e.numerator),this.denominator):new G(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof G?t:new G(me(t));return this.denominator.eq(e.denominator)?new G(this.numerator.sub(e.numerator),this.denominator):new G(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof G?t:new G(me(t));return new G(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof G?t:new G(me(t));return new G(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},i=1){Number.isInteger(t)||pt.logWithError(`${t} is not an integer.`),t<=0&&pt.logWithError(`${t} is not positive.`),He.set({precision:t+1,rounding:Ci[i]});let s=new He(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return s.toFormat(s.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},i=1){return Number.isInteger(t)||pt.logWithError(`${t} is not an integer.`),t<0&&pt.logWithError(`${t} is negative.`),qt.DP=t,qt.RM=Ki[i]||1,new qt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};import Li from"bn.js";var Tn=new G(new Li(100)),re=class extends G{toSignificant(t=5,e,i){return this.mul(Tn).toSignificant(t,e,i)}toFixed(t=2,e,i){return this.mul(Tn).toFixed(t,e,i)}};var qo=Q("Raydium_price");function Ot(n,t=1,e=[]){let i=[...n];if(t<=0)return e;for(;i.length;)e.push(i.splice(0,t));return e}var de=class{constructor(t){this._owner=t}get publicKey(){return de.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return de.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return de.isKeyPair(this._owner)}get isPublicKey(){return de.isPublicKey(this._owner)}static isKeyPair(t){return t.secretKey!==void 0}static isPublicKey(t){return!de.isKeyPair(t)}};import{PublicKey as Di}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vi}from"@solana/spl-token";import{ComputeBudgetProgram as hn,Keypair as xn,PublicKey as Ri,Transaction as In,TransactionMessage as Ni,VersionedTransaction as Sn}from"@solana/web3.js";var J={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Mi}from"@solana/spl-token";var Bn=Q("Raydium_txUtil"),Cn=1644;function Ze(n){let t=[],e=[];return n.microLamports&&(t.push(hn.setComputeUnitPrice({microLamports:n.microLamports})),e.push(J.SetComputeUnitPrice)),n.units&&(t.push(hn.setComputeUnitLimit({units:n.units})),e.push(J.SetComputeUnitLimit)),{instructions:t,instructionTypes:e}}async function xe(n,t){var i,s;let e=t!=null?t:"confirmed";return(s=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:e})))==null?void 0:s.blockhash}async function je(n,t){return n.getSignatureStatuses([t]),new Promise((e,i)=>{let s=setTimeout(i,6e4);n.onSignature(t,o=>{if(clearTimeout(s),!o.err){e("");return}i(Object.assign(o.err,{txId:t}))},"confirmed")})}function Oi(n,t){n.length<1&&Bn.logWithError(`no instructions provided: ${n.toString()}`),t.length<1&&Bn.logWithError(`no signers provided:, ${t.toString()}`);let e=new In;e.recentBlockhash="11111111111111111111111111111111",e.feePayer=t[0],e.add(...n);try{return Buffer.from(e.serialize({verifySignatures:!1})).toString("base64").length<Cn}catch{return!1}}function ce(n,t){let[e,i]=Ri.findProgramAddressSync(n,t);return{publicKey:e,nonce:i}}function Ye({instructions:n,payer:t,signers:e}){return Oi(n,[t,...e])}function be({instructions:n,payer:t,lookupTableAddressAccount:e,recentBlockhash:i=xn.generate().publicKey.toString()}){let o=new Ni({payerKey:t,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(e!=null?e:{}));try{return Buffer.from(new Sn(o).serialize()).toString("base64").length<Cn}catch{return!1}}var Fi=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Ei=n=>{let t=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Sn&&(t=Fi(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function Te(n){let t=[];return n.forEach(e=>{e instanceof In&&(e.recentBlockhash||(e.recentBlockhash=Mi.toBase58()),e.feePayer||(e.feePayer=xn.generate().publicKey)),t.push(Ei(e))}),console.log("simulate tx string:",t),t}function oe(n,t,e){return ce([n.toBuffer(),(e!=null?e:vi).toBuffer(),t.toBuffer()],new Di("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var Ts=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),hs=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Bs=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),xs=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Is=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ss=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Cs=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ks=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ls=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Rs=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Vi=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Wi=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),_i=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ns=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ms=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Os=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Fs=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Es=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ds=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),vs=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Kn=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ln=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Vs=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),yt=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),gt=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ws=new O("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),_s=new O("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),qs=new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Gs=new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Us=new O("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Xs=new O("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var zs={OPEN_BOOK_PROGRAM:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O("Ray1111111111111111111111111111111111111111"),AMM_V4:new O("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.default,Router:new O("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O("Ray1111111111111111111111111111111111111111")};import ue from"bn.js";var Qe=1e4;function pe(n,t,e,i){if(t===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let s=q(v({},t),{olderTransferFee:{epoch:BigInt(t.olderTransferFee.epoch),maximumFee:BigInt(t.olderTransferFee.maximumFee),transferFeeBasisPoints:t.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(t.newerTransferFee.epoch),maximumFee:BigInt(t.newerTransferFee.maximumFee),transferFeeBasisPoints:t.newerTransferFee.transferFeeBasisPoints}}),o=e.epoch<s.newerTransferFee.epoch?s.olderTransferFee:s.newerTransferFee,a=new ue(o.maximumFee.toString()),r=e.epoch<s.newerTransferFee.epoch?(Number(s.newerTransferFee.epoch)*e.slotsInEpoch-e.absoluteSlot)*400/1e3:void 0;if(i)if(o.transferFeeBasisPoints===Qe){let d=new ue(o.maximumFee.toString());return{amount:n.add(d),fee:d,expirationTime:r}}else{let d=Me(n.mul(new ue(Qe)),new ue(Qe-o.transferFeeBasisPoints)),g=new ue(o.maximumFee.toString()),A=d.sub(n).gt(g)?n.add(g):d,l=Me(A.mul(new ue(o.transferFeeBasisPoints)),new ue(Qe)),b=l.gt(a)?a:l;return{amount:A,fee:b,expirationTime:r}}else{let d=Me(n.mul(new ue(o.transferFeeBasisPoints)),new ue(Qe)),g=d.gt(a)?a:d;return{amount:n,fee:g,expirationTime:r}}}function Me(n,t){let{div:e,mod:i}=n.divmod(t);return i.gt(new ue(0))?e.add(new ue(1)):e}import{PublicKey as Xt,AddressLookupTableAccount as Fe}from"@solana/web3.js";async function Pt({connection:n,address:t,cluster:e="mainnet"}){let i=await qe(n,[...new Set(t.map(o=>o.toString()))].map(o=>new Xt(o))),s={};for(let o=0;o<t.length;o++){let a=i[o],r=t[o];if(!a)continue;let d=new Fe({key:r,state:Fe.deserialize(a.data)});s[r.toString()]=d,e==="devnet"?Oe[r.toString()]=d:Je[r.toString()]=d}return s}var Je={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Fe({key:new Xt("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Fe.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Oe={},At=async n=>{let t="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Oe[t])return Oe;let e=new Xt(t),i=await n.getAccountInfo(e);return i&&(Oe[t]=new Fe({key:e,state:Fe.deserialize(i.data)})),Oe};import{PublicKey as Ie,sendAndConfirmTransaction as zt,SystemProgram as qi,Transaction as $e,TransactionMessage as ye,VersionedTransaction as ge}from"@solana/web3.js";import Gi from"axios";var et=2e3,tt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.loopMultiTxStatus=!!t.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let t=(await Gi.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:e}=(i=t==null?void 0:t[15])!=null?i:{};if(!!e)return{units:6e5,microLamports:Math.min(Math.ceil(e*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:e,instructionTypes:i}=Ze(t);return this.instructions.unshift(...e),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(t){var e;return t?(this.endInstructions.push(qi.transfer({fromPubkey:(e=t.feePayer)!=null?e:this.feePayer,toPubkey:new Ie(t.address),lamports:BigInt(t.amount.toString())})),this.endInstructionTypes.push(J.TransferTip),!0):!1}async calComputeBudget({config:t,defaultIns:e}){try{let i=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;e&&this.instructions.unshift(...e)}catch{e&&this.instructions.unshift(...e)}}addInstruction({instructions:t=[],endInstructions:e=[],signers:i=[],instructionTypes:s=[],endInstructionTypes:o=[],lookupTableAddress:a=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...i),this.instructionTypes.push(...s),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...a.filter(r=>r!==Ie.default.toString())),this}async versionBuild({txVersion:t,extInfo:e}){return t===0?await this.buildV0(v({},e||{})):this.build(e)}build(t){var i;let e=new $e;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(s=>s.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:e,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async s=>{var A;let{recentBlockHash:o,skipPreflight:a=!0,sendAndConfirm:r,notSendToRpc:d}=s||{},g=o!=null?o:await xe(this.connection,this.blockhashCommitment);if(e.recentBlockhash=g,this.signers.length&&e.sign(...this.signers),Te([e]),(A=this.owner)!=null&&A.isKeyPair)return{txId:r?await zt(this.connection,e,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(e.serialize(),{skipPreflight:a}),signedTx:e};if(this.signAllTransactions){let l=await this.signAllTransactions([e]);if(this.signers.length)for(let b of l)try{b.sign(...this.signers)}catch{}return{txId:d?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:a}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var g;let{extraPreBuildData:e=[],extInfo:i}=t,{transaction:s}=this.build(i),o=e.filter(A=>A.transaction.instructions.length>0),a=[s,...o.map(A=>A.transaction)],r=[this.signers,...o.map(A=>A.signers)],d=[...this.instructionTypes,...o.map(A=>A.instructionTypes).flat()];return(g=this.owner)!=null&&g.signer&&r.forEach(A=>{A.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:r,instructionTypes:d,execute:async A=>{var h;let{sequentially:l,onTxUpdate:b,skipTxCount:c=0,recentBlockHash:p,skipPreflight:P=!0}=A||{},u=p!=null?p:await xe(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(l){let w=[],x=0;for(let m of a){if(++x,x<=c)continue;let f=await zt(this.connection,m,this.signers.find(y=>y.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:P});w.push(f)}return{txIds:w,signedTxs:a}}return{txIds:await await Promise.all(a.map(async w=>(w.recentBlockhash=u,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:P})))),signedTxs:a}}if(this.signAllTransactions){let w=a.map((m,f)=>(m.recentBlockhash=u,r[f].length&&m.sign(...r[f]),m));Te(w);let x=await this.signAllTransactions(w);if(l){let m=0,f=[],y=async()=>{if(!x[m])return;let B=await this.connection.sendRawTransaction(x[m].serialize(),{skipPreflight:P});f.push({txId:B,status:"sent",signedTx:x[m]}),b==null||b([...f]),m++;let k=!1,K=null,L=null,C=I=>{K!==null&&clearInterval(K),L!==null&&this.connection.removeSignatureListener(L);let M=f.findIndex(F=>F.txId===B);if(M>-1){if(f[M].status==="error"||f[M].status==="success")return;f[M].status=I.err?"error":"success"}b==null||b([...f]),I.err||y()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var I;if(k){clearInterval(K);return}try{let M=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(k=!0,clearInterval(K),C({err:((I=M.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",B))}catch(M){k=!0,clearInterval(K),console.error("getTransaction timeout:",M,B)}},et)),L=this.connection.onSignature(B,I=>{if(k){this.connection.removeSignatureListener(L);return}k=!0,C(I)},"confirmed"),this.connection.getSignatureStatus(B)};return await y(),{txIds:f.map(B=>B.txId),signedTxs:x}}else{let m=[];for(let f=0;f<x.length;f+=1){let y=await this.connection.sendRawTransaction(x[f].serialize(),{skipPreflight:P});m.push(y)}return{txIds:m,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:e,extInfo:i}){return e===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:i})}async buildV0(t){var P;let p=t||{},{lookupTableCache:e={},lookupTableAddress:i=[],forerunCreate:s,recentBlockhash:o}=p,a=le(p,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),r=v(v({},this.cluster==="devnet"?await At(this.connection):Je),e),d=Array.from(new Set([...i,...this.lookupTableAddress])),g=[];for(let u of d)r[u]===void 0&&g.push(new Ie(u));let A=await Pt({connection:this.connection,address:g});for(let[u,h]of Object.entries(A))r[u]=h;let l=s?Ie.default.toBase58():o!=null?o:await xe(this.connection,this.blockhashCommitment),b=new ye({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(r));((P=this.owner)==null?void 0:P.signer)&&!this.signers.some(u=>u.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let c=new ge(b);return c.sign(this.signers),{builder:this,transaction:c,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async u=>{var m;let{skipPreflight:h=!0,sendAndConfirm:w,notSendToRpc:x}=u||{};if(Te([c]),(m=this.owner)!=null&&m.isKeyPair){let f=await this.connection.sendTransaction(c,{skipPreflight:h});return w&&await je(this.connection,f),{txId:f,signedTx:c}}if(this.signAllTransactions){let f=await this.signAllTransactions([c]);if(this.signers.length)for(let y of f)try{y.sign(this.signers)}catch{}return{txId:x?"":await this.connection.sendTransaction(f[0],{skipPreflight:h}),signedTx:f[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(t){var g;let{extraPreBuildData:e=[],buildProps:i}=t,{transaction:s}=await this.buildV0(i),o=e.filter(A=>A.builder.instructions.length>0),a=[s,...o.map(A=>A.transaction)],r=[this.signers,...o.map(A=>A.signers)],d=[...this.instructionTypes,...o.map(A=>A.instructionTypes).flat()];return(g=this.owner)!=null&&g.signer&&r.forEach(A=>{A.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(A,l)=>{A.sign(r[l])}),{builder:this,transactions:a,signers:r,instructionTypes:d,buildProps:i,execute:async A=>{var P;let{sequentially:l,onTxUpdate:b,recentBlockHash:c,skipPreflight:p=!0}=A||{};if(c&&a.forEach(u=>u.message.recentBlockhash=c),Te(a),(P=this.owner)!=null&&P.isKeyPair){if(l){let u=[];for(let h of a){let w=await this.connection.sendTransaction(h,{skipPreflight:p});await je(this.connection,w),u.push(w)}return{txIds:u,signedTxs:a}}return{txIds:await Promise.all(a.map(async u=>await this.connection.sendTransaction(u,{skipPreflight:p}))),signedTxs:a}}if(this.signAllTransactions){let u=await this.signAllTransactions(a);if(l){let h=0,w=[],x=async()=>{if(!u[h])return;let m=await this.connection.sendTransaction(u[h],{skipPreflight:p});w.push({txId:m,status:"sent",signedTx:u[h]}),b==null||b([...w]),h++;let f=!1,y=null,B=null,k=K=>{y!==null&&clearInterval(y),B!==null&&this.connection.removeSignatureListener(B);let L=w.findIndex(C=>C.txId===m);if(L>-1){if(w[L].status==="error"||w[L].status==="success")return;w[L].status=K.err?"error":"success"}b==null||b([...w]),K.err||x()};this.loopMultiTxStatus&&(y=setInterval(async()=>{var K;if(f){clearInterval(y);return}try{let L=await this.connection.getTransaction(m,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(f=!0,clearInterval(y),k({err:((K=L.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",m))}catch(L){f=!0,clearInterval(y),console.error("getTransaction timeout:",L,m)}},et)),B=this.connection.onSignature(m,K=>{if(f){this.connection.removeSignatureListener(B);return}f=!0,k(K)},"confirmed"),this.connection.getSignatureStatus(m)};return x(),{txIds:[],signedTxs:u}}else{let h=[];for(let w=0;w<u.length;w+=1){let x=await this.connection.sendTransaction(u[w],{skipPreflight:p});h.push(x)}return{txIds:h,signedTxs:u}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(t){var b;let l=t||{},{splitIns:e=[],computeBudgetConfig:i}=l,s=le(l,["splitIns","computeBudgetConfig"]),o=i?Ze(i):{instructions:[],instructionTypes:[]},a=this.signers.reduce((c,p)=>q(v({},c),{[p.publicKey.toBase58()]:p}),{}),r=[],d=[],g=[],A=0;if(this.allInstructions.forEach(c=>{let p=[...g,c],P=i?[...o.instructions,...p]:p,h=[...new Set(p.map(w=>w.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(w=>new Ie(w));if(c!==e[A]&&g.length<12&&(Ye({instructions:P,payer:this.feePayer,signers:h})||Ye({instructions:p,payer:this.feePayer,signers:h})))g.push(c);else{if(g.length===0)throw Error("item ins too big");A+=c===e[A]?1:0,Ye({instructions:i?[...o.instructions,...g]:[...g],payer:this.feePayer,signers:h})?r.push(new $e().add(...o.instructions,...g)):r.push(new $e().add(...g)),d.push(Array.from(new Set(g.map(w=>w.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(w=>a[w]).filter(w=>w!==void 0)),g=[c]}}),g.length>0){let p=[...new Set(g.map(P=>P.keys.filter(u=>u.isSigner).map(u=>u.pubkey.toString())).flat()).values()].map(P=>a[P]).filter(P=>P!==void 0);Ye({instructions:i?[...o.instructions,...g]:[...g],payer:this.feePayer,signers:p.map(P=>P.publicKey)})?r.push(new $e().add(...o.instructions,...g)):r.push(new $e().add(...g)),d.push(p)}return r.forEach(c=>c.feePayer=this.feePayer),(b=this.owner)!=null&&b.signer&&d.forEach(c=>{c.some(p=>p.publicKey.equals(this.owner.publicKey))||c.push(this.owner.signer)}),{builder:this,transactions:r,signers:d,instructionTypes:this.instructionTypes,execute:async c=>{var m;let{sequentially:p,onTxUpdate:P,skipTxCount:u=0,recentBlockHash:h,skipPreflight:w=!0}=c||{},x=h!=null?h:await xe(this.connection,this.blockhashCommitment);if(r.forEach(async(f,y)=>{f.recentBlockhash=x,d[y].length&&f.sign(...d[y])}),Te(r),(m=this.owner)!=null&&m.isKeyPair){if(p){let f=0,y=[];for(let B of r){if(++f,f<=u){y.push("tx skipped");continue}let k=await zt(this.connection,B,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});y.push(k)}return{txIds:y,signedTxs:r}}return{txIds:await Promise.all(r.map(async f=>await this.connection.sendRawTransaction(f.serialize(),{skipPreflight:w}))),signedTxs:r}}if(this.signAllTransactions){let f=await this.signAllTransactions(r.slice(u,r.length)),y=[...r.slice(0,u),...f];if(p){let B=0,k=[],K=async()=>{if(!y[B])return;B<u&&(k.push({txId:"",status:"success",signedTx:y[B]}),P==null||P([...k]),B++,K());let L=await this.connection.sendRawTransaction(y[B].serialize(),{skipPreflight:w});k.push({txId:L,status:"sent",signedTx:y[B]}),P==null||P([...k]),B++;let C=!1,I=null,M=null,F=D=>{I!==null&&clearInterval(I),M!==null&&this.connection.removeSignatureListener(M);let V=k.findIndex(U=>U.txId===L);if(V>-1){if(k[V].status==="error"||k[V].status==="success")return;k[V].status=D.err?"error":"success"}P==null||P([...k]),D.err||K()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var D;if(C){clearInterval(I);return}try{let V=await this.connection.getTransaction(L,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(C=!0,clearInterval(I),F({err:((D=V.meta)==null?void 0:D.err)||null}),console.log("tx status from getTransaction:",L))}catch(V){C=!0,clearInterval(I),console.error("getTransaction timeout:",V,L)}},et)),M=this.connection.onSignature(L,D=>{if(C){this.connection.removeSignatureListener(M);return}C=!0,F(D)},"confirmed"),this.connection.getSignatureStatus(L)};return await K(),{txIds:k.map(L=>L.txId),signedTxs:y}}else{let B=[];for(let k=0;k<y.length;k+=1){let K=await this.connection.sendRawTransaction(y[k].serialize(),{skipPreflight:w});B.push(K)}return{txIds:B,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async sizeCheckBuildV0(t){var x;let w=t||{},{computeBudgetConfig:e,splitIns:i=[],lookupTableCache:s={},lookupTableAddress:o=[]}=w,a=le(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),r=v(v({},this.cluster==="devnet"?await At(this.connection):Je),s),d=Array.from(new Set([...this.lookupTableAddress,...o])),g=[];for(let m of d)r[m]===void 0&&g.push(new Ie(m));let A=await Pt({connection:this.connection,address:g});for(let[m,f]of Object.entries(A))r[m]=f;let l=e?Ze(e):{instructions:[],instructionTypes:[]},b=await xe(this.connection,this.blockhashCommitment),c=this.signers.reduce((m,f)=>q(v({},m),{[f.publicKey.toBase58()]:f}),{}),p=[],P=[],u=[],h=0;if(this.allInstructions.forEach(m=>{let f=[...u,m],y=e?[...l.instructions,...f]:f;if(m!==i[h]&&u.length<12&&(be({instructions:y,payer:this.feePayer,lookupTableAddressAccount:r})||be({instructions:f,payer:this.feePayer,lookupTableAddressAccount:r})))u.push(m);else{if(u.length===0)throw Error("item ins too big");h+=m===i[h]?1:0;let B={};for(let k of[...new Set(d)])r[k]!==void 0&&(B[k]=r[k]);if(e&&be({instructions:[...l.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:b})){let k=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...l.instructions,...u]}).compileToV0Message(Object.values(r));p.push(new ge(k))}else{let k=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...u]}).compileToV0Message(Object.values(r));p.push(new ge(k))}P.push(Array.from(new Set(u.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>c[k]).filter(k=>k!==void 0)),u=[m]}}),u.length>0){let f=[...new Set(u.map(y=>y.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(y=>c[y]).filter(y=>y!==void 0);if(e&&be({instructions:[...l.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:b})){let y=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...l.instructions,...u]}).compileToV0Message(Object.values(r));p.push(new ge(y))}else{let y=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...u]}).compileToV0Message(Object.values(r));p.push(new ge(y))}P.push(f)}return(x=this.owner)!=null&&x.signer&&P.forEach(m=>{m.some(f=>f.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),p.forEach((m,f)=>{m.sign(P[f])}),{builder:this,transactions:p,buildProps:t,signers:P,instructionTypes:this.instructionTypes,execute:async m=>{var L;let{sequentially:f,onTxUpdate:y,skipTxCount:B=0,recentBlockHash:k,skipPreflight:K=!0}=m||{};if(p.map(async(C,I)=>{P[I].length&&C.sign(P[I]),k&&(C.message.recentBlockhash=k)}),Te(p),(L=this.owner)!=null&&L.isKeyPair){if(f){let C=0,I=[];for(let M of p){if(++C,C<=B){console.log("skip tx: ",C),I.push("tx skipped");continue}let F=await this.connection.sendTransaction(M,{skipPreflight:K});await je(this.connection,F),I.push(F)}return{txIds:I,signedTxs:p}}return{txIds:await Promise.all(p.map(async C=>await this.connection.sendTransaction(C,{skipPreflight:K}))),signedTxs:p}}if(this.signAllTransactions){let C=await this.signAllTransactions(p.slice(B,p.length)),I=[...p.slice(0,B),...C];if(f){let M=0,F=[],D=async()=>{if(!I[M])return;if(M<B){F.push({txId:"",status:"success",signedTx:I[M]}),y==null||y([...F]),M++,D();return}let V=await this.connection.sendTransaction(I[M],{skipPreflight:K});F.push({txId:V,status:"sent",signedTx:I[M]}),y==null||y([...F]),M++;let U=!1,Y=null,ie=null,_e=ee=>{Y!==null&&clearInterval(Y),ie!==null&&this.connection.removeSignatureListener(ie);let j=F.findIndex(Rt=>Rt.txId===V);if(j>-1){if(F[j].status==="error"||F[j].status==="success")return;F[j].status=ee.err?"error":"success"}y==null||y([...F]),ee.err||D()};this.loopMultiTxStatus&&(Y=setInterval(async()=>{var ee;if(U){clearInterval(Y);return}try{let j=await this.connection.getTransaction(V,{commitment:"confirmed",maxSupportedTransactionVersion:0});j&&(U=!0,clearInterval(Y),_e({err:((ee=j.meta)==null?void 0:ee.err)||null}),console.log("tx status from getTransaction:",V))}catch(j){U=!0,clearInterval(Y),console.error("getTransaction timeout:",j,V)}},et)),ie=this.connection.onSignature(V,ee=>{if(U){this.connection.removeSignatureListener(ie);return}U=!0,_e(ee)},"confirmed"),this.connection.getSignatureStatus(V)};return D(),{txIds:[],signedTxs:I}}else{let M=[];for(let F=0;F<I.length;F+=1){let D=await this.connection.sendTransaction(I[F],{skipPreflight:K});M.push(D)}return{txIds:M,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildSniperTransaction(t){var x;let w=t||{},{computeBudgetConfig:e,splitIns:i=[],lookupTableCache:s={},lookupTableAddress:o=[]}=w,a=le(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),r=v(v({},this.cluster==="devnet"?await At(this.connection):Je),s),d=Array.from(new Set([...this.lookupTableAddress,...o])),g=[];for(let m of d)r[m]===void 0&&g.push(new Ie(m));let A=await Pt({connection:this.connection,address:g});for(let[m,f]of Object.entries(A))r[m]=f;let l=e?Ze(e):{instructions:[],instructionTypes:[]},b=await xe(this.connection,this.blockhashCommitment),c=this.signers.reduce((m,f)=>q(v({},m),{[f.publicKey.toBase58()]:f}),{}),p=[],P=[],u=[],h=0;if(this.allInstructions.forEach(m=>{let f=[...u,m],y=e?[...l.instructions,...f]:f;if(m!==i[h]&&u.length<12&&(be({instructions:y,payer:this.feePayer,lookupTableAddressAccount:r})||be({instructions:f,payer:this.feePayer,lookupTableAddressAccount:r})))u.push(m);else{if(u.length===0)throw Error("item ins too big");h+=m===i[h]?1:0;let B={};for(let k of[...new Set(d)])r[k]!==void 0&&(B[k]=r[k]);if(e&&be({instructions:[...l.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:b})){let k=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...l.instructions,...u]}).compileToV0Message(Object.values(r));p.push(new ge(k))}else{let k=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...u]}).compileToV0Message(Object.values(r));p.push(new ge(k))}P.push(Array.from(new Set(u.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>c[k]).filter(k=>k!==void 0)),u=[m]}}),u.length>0){let f=[...new Set(u.map(y=>y.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(y=>c[y]).filter(y=>y!==void 0);if(e&&be({instructions:[...l.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:r,recentBlockhash:b})){let y=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...l.instructions,...u]}).compileToV0Message(Object.values(r));p.push(new ge(y))}else{let y=new ye({payerKey:this.feePayer,recentBlockhash:b,instructions:[...u]}).compileToV0Message(Object.values(r));p.push(new ge(y))}P.push(f)}return(x=this.owner)!=null&&x.signer&&P.forEach(m=>{m.some(f=>f.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),p.forEach((m,f)=>{m.sign(P[f])}),{builder:this,transactions:p,buildProps:t,signers:P,instructionTypes:this.instructionTypes,execute:async m=>{var L;let{sequentially:f,onTxUpdate:y,skipTxCount:B=0,recentBlockHash:k,skipPreflight:K=!0}=m||{};if(p.map(async(C,I)=>{P[I].length&&C.sign(P[I]),k&&(C.message.recentBlockhash=k)}),Te(p),(L=this.owner)!=null&&L.isKeyPair){if(f){let C=0,I=[];for(let M of p){if(++C,C<=B){console.log("skip tx: ",C),I.push("tx skipped");continue}let F=await this.connection.sendTransaction(M,{skipPreflight:K});await je(this.connection,F),I.push(F)}return{txIds:I,signedTxs:p}}return{txIds:await Promise.all(p.map(async C=>await this.connection.sendTransaction(C,{skipPreflight:K}))),signedTxs:p}}if(this.signAllTransactions){let C=await this.signAllTransactions(p.slice(B,p.length)),I=[...p.slice(0,B),...C];if(f){let M=0,F=[],D=async()=>{if(!I[M])return;if(M<B){F.push({txId:"",status:"success",signedTx:I[M]}),y==null||y([...F]),M++,D();return}let V=await this.connection.sendTransaction(I[M],{skipPreflight:K});F.push({txId:V,status:"sent",signedTx:I[M]}),y==null||y([...F]),M++;let U=!1,Y=null,ie=null,_e=ee=>{Y!==null&&clearInterval(Y),ie!==null&&this.connection.removeSignatureListener(ie);let j=F.findIndex(Rt=>Rt.txId===V);if(j>-1){if(F[j].status==="error"||F[j].status==="success")return;F[j].status=ee.err?"error":"success"}y==null||y([...F]),ee.err||D()};this.loopMultiTxStatus&&(Y=setInterval(async()=>{var ee;if(U){clearInterval(Y);return}try{let j=await this.connection.getTransaction(V,{commitment:"confirmed",maxSupportedTransactionVersion:0});j&&(U=!0,clearInterval(Y),_e({err:((ee=j.meta)==null?void 0:ee.err)||null}),console.log("tx status from getTransaction:",V))}catch(j){U=!0,clearInterval(Y),console.error("getTransaction timeout:",j,V)}},et)),ie=this.connection.onSignature(V,ee=>{if(U){this.connection.removeSignatureListener(ie);return}U=!0,_e(ee)},"confirmed"),this.connection.getSignatureStatus(V)};return D(),{txIds:[],signedTxs:I}}else{let M=[];for(let F=0;F<I.length;F+=1){let D=await this.connection.sendTransaction(I[F],{skipPreflight:K});M.push(D)}return{txIds:M,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};import{PublicKey as pa}from"@solana/web3.js";import ba from"bn.js";import Ui from"bn.js";var wt=new Ui(1e6);var Qa=Q("Raydium_amount"),Ja=ze(Xi);var Ut=new fe(0),bc=new fe(1),yc=new fe(2),gc=new fe(3),Pc=new fe(5),zi=new fe(10),Ac=new fe(100),wc=new fe(1e3),kc=new fe(1e4);function Nn(n,t,e){return n.mul(t).add(e).sub(new fe(1)).div(e)}function Ht(n,t,e){return n.mul(t).div(e)}import Zt from"bn.js";import Bt from"decimal.js-light";import nt from"bn.js";function kt(n,t){if(t.isZero())throw Error("divisor is zero");return n.mod(t)}function Hi(n,t){if(t.isZero())throw Error("rhs is zero");let e=n.div(t);if(e.isZero())throw Error("quotient is zero");let i=kt(n,t);return i.gt(Ee)&&(e=e.add(new nt(1)),t=n.div(e),i=kt(n,e),i.gt(Ee)&&(t=t.add(new nt(1)))),[e,t]}var Ee=new nt(0),Tt=class{static swapWithoutFees(t,e,i){let s=e.mul(i),o=e.add(t),[a]=Hi(s,o),r=i.sub(a);if(r.isZero())throw Error("destinationAmountSwapped is zero");return{destinationAmountSwapped:r}}static lpTokensToTradingTokens(t,e,i,s,o){let a=t.mul(i).div(e),r=t.mul(s).div(e);if(o===0)return{tokenAmount0:a,tokenAmount1:r};if(o===1)return kt(t.mul(i),e).gt(Ee)&&a.gt(Ee)&&(a=a.add(new nt(1))),kt(t.mul(s),e).gt(Ee)&&r.gt(Ee)&&(r=r.add(new nt(1))),{tokenAmount0:a,tokenAmount1:r};throw Error("roundDirection value error")}};var ht=class{static tradingFee(t,e){return Nn(t,e,wt)}static protocolFee(t,e){return Ht(t,e,wt)}static fundFee(t,e){return Ht(t,e,wt)}};var xt=class{static validate_supply(t,e){if(t.isZero())throw Error("tokenAmount0 is zero");if(e.isZero())throw Error("tokenAmount1 is zero")}static swap(t,e,i,s){let o=ht.tradingFee(t,s),a=t.sub(o),{destinationAmountSwapped:r}=Tt.swapWithoutFees(a,e,i);return{newSwapDestinationAmount:i.sub(r),sourceAmountSwapped:t,destinationAmountSwapped:r,tradeFee:o}}static swapBaseOut({poolMintA:t,poolMintB:e,tradeFeeRate:i,baseReserve:s,quoteReserve:o,outputMint:a,outputAmount:r}){let[d,g,A,l,b]=e.address===a.toString()?[s,o,t.decimals,e.decimals,t.address]:[o,s,e.decimals,t.decimals,e.address],c=new Bt(g.toString()).div(10**l).div(new Bt(d.toString()).div(10**A)),p=r.gte(g)?g.sub(new Zt(1)):r,P=g.sub(p),u=Me(d.mul(p),P),h=Me(u.mul(new Zt(1e6)),new Zt(1e6).sub(i)),w=h.sub(u),x=new Bt(p.toString()).div(10**l).div(new Bt(h.toString()).div(10**A)),m=c.isZero()?0:x.sub(c).div(c).abs().toNumber();return{amountRealOut:p,amountIn:h,amountInWithoutFee:u,tradeFee:w,priceImpact:m}}};import Z from"bn.js";import ae from"decimal.js";var jt=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),De=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=Q(e)}createTxBuilder(t){return this.scope.checkOwner(),new tt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(t,e){let i=new de(t);return new tt({connection:this.scope.connection,feePayer:e,cluster:this.scope.cluster,owner:i,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(jt(t))}logInfo(...t){this.logger.info(jt(t))}logAndCreateError(...t){let e=jt(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as nr}from"@solana/web3.js";import En,{isBN as Dn}from"bn.js";import{bits as Uc,BitStructure as Xc,blob as Zi,Blob as zc,cstr as Hc,f32 as Zc,f32be as jc,f64 as Yc,f64be as Qc,greedy as Jc,Layout as ji,ns64 as $c,ns64be as eu,nu64 as tu,nu64be as nu,offset as iu,s16 as ru,s16be as ou,s24 as su,s24be as au,s32 as Yi,s32be as cu,s40 as uu,s40be as lu,s48 as mu,s48be as du,s8 as pu,seq as Qi,struct as fu,Structure as Ji,u16 as $i,u16be as bu,u24 as yu,u24be as gu,u32 as Pu,u32be as Au,u40 as wu,u40be as ku,u48 as Tu,u48be as hu,u8 as er,UInt as tr,union as Bu,Union as xu,unionLayoutDiscriminator as Iu,utf8 as Su}from"@solana/buffer-layout";var Yt=ji,Mn=Ji;var Qt=tr;var On=er,Se=$i;var Pe=Yi;var Fn=Qi;var $=Zi;var ve=class extends Yt{constructor(e,i,s){super(e,s);this.blob=$(e),this.signed=i}decode(e,i=0){let s=new En(this.blob.decode(e,i),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(e,i,s=0){return typeof e=="number"&&(e=new En(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),i,s)}};function X(n){return new Qt(1,n)}function Ae(n){return new Qt(4,n)}function S(n){return new ve(8,!1,n)}function H(n){return new ve(16,!1,n)}function vn(n){return new ve(8,!0,n)}function Vn(n){return new ve(16,!0,n)}var It=class extends Yt{constructor(e,i,s,o){super(e.span,o);this.layout=e,this.decoder=i,this.encoder=s}decode(e,i){return this.decoder(this.layout.decode(e,i))}encode(e,i,s){return this.layout.encode(this.encoder(e),i,s)}getSpan(e,i){return this.layout.getSpan(e,i)}};function E(n){return new It($(32),t=>new nr(t),t=>t.toBuffer(),n)}function Ce(n){return new It(On(),ir,rr,n)}function ir(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function rr(n){return n?1:0}var Jt=class extends Mn{decode(t,e){return super.decode(t,e)}};function W(n,t,e){return new Jt(n,t,e)}function _(n,t,e){let i,s=typeof t=="number"?t:Dn(t)?t.toNumber():new Proxy(t,{get(o,a){if(!i){let r=Reflect.get(o,"count");i=Dn(r)?r.toNumber():r,Reflect.set(o,"count",i)}return Reflect.get(o,a)},set(o,a,r){return a==="count"&&(i=r),Reflect.set(o,a,r)}});return Fn(n,s,e)}var _u=W([Ae("mintAuthorityOption"),E("mintAuthority"),S("supply"),X("decimals"),X("isInitialized"),Ae("freezeAuthorityOption"),E("freezeAuthority")]);import{PublicKey as Xu}from"@solana/web3.js";import{MintLayout as Hu,TOKEN_PROGRAM_ID as ju}from"@solana/spl-token";var Ke=s=>{var o=s,{address:n,programId:t,decimals:e}=o,i=le(o,["address","programId","decimals"]);return v({chainId:101,address:Ge(n).toBase58(),programId:t,logoURI:"",symbol:"",name:"",decimals:e,tags:[],extensions:i.extensions||{}},i)},Ve=n=>n?q(v({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:q(v({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:q(v({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;import{PublicKey as ct,TransactionInstruction as Le,Keypair as Cr,SystemProgram as Kr}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ei,TOKEN_2022_PROGRAM_ID as cn,TOKEN_PROGRAM_ID as he}from"@solana/spl-token";var or=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),al=Buffer.from("amm_config","utf8"),sr=Buffer.from("pool","utf8"),ar=Buffer.from("pool_lp_mint","utf8"),cr=Buffer.from("pool_vault","utf8"),ur=Buffer.from("observation","utf8");function St(n){return ce([or],n)}function $t(n,t,e,i){return ce([sr,t.toBuffer(),e.toBuffer(),i.toBuffer()],n)}function lr(n,t){return ce([ar,t.toBuffer()],n)}function Wn(n,t,e){return ce([cr,t.toBuffer(),e.toBuffer()],n)}function it(n,t){return ce([ur,t.toBuffer()],n)}function _n({poolId:n,programId:t,configId:e,mintA:i,mintB:s}){let o=St(t).publicKey,a=n||$t(t,e,i,s).publicKey,r=lr(t,a).publicKey,d=Wn(t,a,i).publicKey,g=Wn(t,a,s).publicKey,A=it(t,a).publicKey;return{poolId:a,configId:e,authority:o,lpMint:r,vaultA:d,vaultB:g,observationId:A}}var mr=Buffer.from("locked_liquidity","utf8");function rt(n,t){return ce([mr,t.toBuffer()],n)}import{PublicKey as Xd}from"@solana/web3.js";import Hd from"bn.js";import jd from"decimal.js";import{AccountLayout as Jd,createAssociatedTokenAccountIdempotentInstruction as $d,TOKEN_2022_PROGRAM_ID as ep,TOKEN_PROGRAM_ID as tp}from"@solana/spl-token";import{Keypair as Pd,PublicKey as Ad,SystemProgram as kd,TransactionInstruction as Td}from"@solana/web3.js";import Bd from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Sd,TOKEN_2022_PROGRAM_ID as Cd,TOKEN_PROGRAM_ID as Kd}from"@solana/spl-token";import Qm from"bn.js";import $m from"decimal.js";import se from"bn.js";var en=new se(0),qn=new se(1),Gn=new se(-1),Ct=new se(1).shln(64),Un=new se(1).shln(128),dr=Ct.sub(qn);var pr=Un.subn(1),We=-443636,ot=-We,tn=new se("4295048016"),nn=new se("79226673521066979257578248091"),ll=new se("4295048017"),ml=new se("79226673521066979257578248090");var fr=new se(10).pow(new se(6));var dl=new se("18446744073700000000");import Em from"bn.js";import vm from"decimal.js";var Al=Buffer.from("amm_config","utf8"),wl=Buffer.from("pool","utf8"),kl=Buffer.from("pool_vault","utf8"),Tl=Buffer.from("pool_reward_vault","utf8"),hl=Buffer.from("position","utf8"),Bl=Buffer.from("tick_array","utf8"),xl=Buffer.from("operation","utf8"),Il=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Sl=Buffer.from("observation","utf8");function rn(n){return ce([Buffer.from("metadata","utf8"),Ne.toBuffer(),n.toBuffer()],Ne)}var Cl=Buffer.from("locked_position","utf8");var Kl=Buffer.from("support_mint","utf8");import{PublicKey as um}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as mm}from"@solana/spl-token";import pm from"bn.js";import bm from"decimal.js";import Nl from"bn.js";import Ol from"decimal.js";var an=14;var Kt=60;var Pr=W([$(8),X("bump"),Se("index"),E(""),Ae("protocolFeeRate"),Ae("tradeFeeRate"),Se("tickSpacing"),_(S(),8,"")]),Ar=W([Ae("blockTimestamp"),vn("tickCumulative"),_(S(),4)]),$n=W([$(8),Ce("initialized"),S("recentEpoch"),Se("observationIndex"),E("poolId"),_(Ar,100,"observations"),_(S(),4)]),wr=W([X("rewardState"),S("openTime"),S("endTime"),S("lastUpdateTime"),H("emissionsPerSecondX64"),S("rewardTotalEmissioned"),S("rewardClaimed"),E("tokenMint"),E("tokenVault"),E("creator"),H("rewardGrowthGlobalX64")]),Yn=W([$(8),X("bump"),E("ammConfig"),E("creator"),E("mintA"),E("mintB"),E("vaultA"),E("vaultB"),E("observationId"),X("mintDecimalsA"),X("mintDecimalsB"),Se("tickSpacing"),H("liquidity"),H("sqrtPriceX64"),Pe("tickCurrent"),Ae(),H("feeGrowthGlobalX64A"),H("feeGrowthGlobalX64B"),S("protocolFeesTokenA"),S("protocolFeesTokenB"),H("swapInAmountTokenA"),H("swapOutAmountTokenB"),H("swapInAmountTokenB"),H("swapOutAmountTokenA"),X("status"),_(X(),7,""),_(wr,3,"rewardInfos"),_(S(),16,"tickArrayBitmap"),S("totalFeesTokenA"),S("totalFeesClaimedTokenA"),S("totalFeesTokenB"),S("totalFeesClaimedTokenB"),S("fundFeesTokenA"),S("fundFeesTokenB"),S("startTime"),_(S(),15*4-3,"padding")]),kr=W([H("growthInsideLastX64"),S("rewardAmountOwed")]),Qn=W([$(8),X("bump"),E("nftMint"),E("poolId"),Pe("tickLower"),Pe("tickUpper"),H("liquidity"),H("feeGrowthInsideLastX64A"),H("feeGrowthInsideLastX64B"),S("tokenFeesOwedA"),S("tokenFeesOwedB"),_(kr,3,"rewardInfos"),_(S(),8,"")]),cd=W([$(8),X("bump"),E("poolId"),Pe("tickLowerIndex"),Pe("tickUpperIndex"),H("liquidity"),H("feeGrowthInsideLastX64A"),H("feeGrowthInsideLastX64B"),S("tokenFeesOwedA"),S("tokenFeesOwedB"),_(H(),3,"rewardGrowthInside"),_(S(),8,"")]),Tr=W([Pe("tick"),Vn("liquidityNet"),H("liquidityGross"),H("feeGrowthOutsideX64A"),H("feeGrowthOutsideX64B"),_(H(),3,"rewardGrowthsOutsideX64"),_(Ae(),13,"")]),Hn=W([$(8),E("poolId"),Pe("startTickIndex"),_(Tr,Kt,"ticks"),X("initializedTickCount"),_(X(),115,"")]),hr=W([$(329),_(E(),100,"whitelistMints")]),gr=W([$(8),E("poolId"),_(_(S(),8),an,"positiveTickArrayBitmap"),_(_(S(),8),an,"negativeTickArrayBitmap")]),ud=W([S(),X("bump"),E("owner"),E("poolId"),E("positionId"),E("nftAccount"),_(S(),8)]),Br=W([$(8),X("bump"),E("lockOwner"),E("poolId"),E("positionId"),E("nftAccount"),E("lockNftMint"),S("recentEpoch"),_(S(),8)]);$n.span;var vd=Q("Raydium_Clmm");var Lr=Q("Raydium_cpmm"),Re={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function ti(n,t,e,i,s,o,a,r,d,g,A,l,b,c,p,P,u,h,w,x){let m=W([S("amountMaxA"),S("amountMaxB"),S("openTime")]),f=$t(n,e,o,a).publicKey,y=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!s.equals(f),isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:ei,isSigner:!1,isWritable:!1},{pubkey:kn,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1}],B=Buffer.alloc(m.span);return m.encode({amountMaxA:h,amountMaxB:w,openTime:x},B),new Le({keys:y,programId:n,data:Buffer.from([...Re.initialize,...B])})}function ni(n,t,e,i,s,o,a,r,d,g,A,l,b,c,p){let P=W([S("lpAmount"),S("amountMaxA"),S("amountMaxB")]),u=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:cn,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0}],h=Buffer.alloc(P.span);return Lr.debug("cpmm deposit data",{lpAmount:b.toString(),amountMaxA:c.toString(),amountMaxB:p.toString()}),P.encode({lpAmount:b,amountMaxA:c,amountMaxB:p},h),new Le({keys:u,programId:n,data:Buffer.from([...Re.deposit,...h])})}function ii(n,t,e,i,s,o,a,r,d,g,A,l,b,c,p){let P=W([S("lpAmount"),S("amountMinA"),S("amountMinB")]),u=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:cn,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1}],h=Buffer.alloc(P.span);return P.encode({lpAmount:b,amountMinA:c,amountMinB:p},h),new Le({keys:u,programId:n,data:Buffer.from([...Re.withdraw,...h])})}function ri(n,t,e,i,s,o,a,r,d,g,A,l,b,c,p,P){let u=W([S("amountIn"),S("amounOutMin")]),h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0}],w=Buffer.alloc(u.span);return u.encode({amountIn:p,amounOutMin:P},w),new Le({keys:h,programId:n,data:Buffer.from([...Re.swapBaseInput,...w])})}function oi(n,t,e,i,s,o,a,r,d,g,A,l,b,c,p,P){let u=W([S("amountInMax"),S("amountOut")]),h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0}],w=Buffer.alloc(u.span);return u.encode({amountInMax:p,amountOut:P},w),new Le({keys:h,programId:n,data:Buffer.from([...Re.swapBaseOutput,...w])})}async function si(n){var u;let{ownerInfo:t,poolInfo:e,poolKeys:i,feeNftOwner:s,getEphemeralSigners:o}=n,a=[],[r,d]=[new ct(e.id),new ct(e.lpMint.address)],g;if(o)g=new ct((await o(1))[0]);else{let h=Cr.generate();a.push(h),g=h.publicKey}let{publicKey:A}=oe(s,g,he),{publicKey:l}=rn(g),{publicKey:b}=rt(n.lockProgram,g),{publicKey:c}=oe(t.wallet,d,he),{publicKey:p}=oe(n.lockAuthProgram,d,he),P=Rr({programId:n.lockProgram,auth:n.lockAuthProgram,payer:t.feePayer,liquidityOwner:t.wallet,nftOwner:s,nftMint:g,nftAccount:A,poolId:r,lockPda:b,mintLp:d,userLpVault:c,lockLpVault:p,poolVaultA:new ct(i.vault.A),poolVaultB:new ct(i.vault.B),metadataAccount:l,lpAmount:n.lpAmount,withMetadata:(u=n.withMetadata)!=null?u:!0});return{address:{nftMint:g,nftAccount:A,metadataAccount:l,lockPda:b,userLpVault:c,lockLpVault:p},instructions:[P],signers:a,instructionTypes:[J.CpmmLockLp],lookupTableAddress:[]}}function Rr({programId:n,auth:t,payer:e,liquidityOwner:i,nftOwner:s,nftMint:o,nftAccount:a,poolId:r,lockPda:d,mintLp:g,userLpVault:A,lockLpVault:l,poolVaultA:b,poolVaultB:c,metadataAccount:p,lpAmount:P,withMetadata:u}){let h=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:Kr.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:ei,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1}],w=W([S("lpAmount"),Ce("withMetadata")]),x=Buffer.alloc(w.span);w.encode({lpAmount:P,withMetadata:u},x);let m=Buffer.from([...Re.lockCpLiquidity,...x]);return new Le({keys:h,programId:n,data:m})}function un({programId:n,nftOwner:t,auth:e,nftAccount:i,lockPda:s,poolId:o,mintLp:a,userVaultA:r,userVaultB:d,poolVaultA:g,poolVaultB:A,mintA:l,mintB:b,lockLpVault:c,lpFeeAmount:p,cpmmProgram:P,cpmmAuthProgram:u}){let h=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:P!=null?P:Kn,isSigner:!1,isWritable:!1},{pubkey:u!=null?u:Ln,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:cn,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1}],w=W([S("lpFeeAmount")]),x=Buffer.alloc(w.span);w.encode({lpFeeAmount:p},x);let m=Buffer.from([...Re.collectCpFee,...x]);return new Le({keys:h,programId:n,data:m})}var ai=W([$(8),X("bump"),Ce("disableCreatePool"),Se("index"),S("tradeFeeRate"),S("protocolFeeRate"),S("fundFeeRate"),S("createPoolFee"),E("protocolOwner"),E("fundOwner"),_(S(),16)]),ci=W([$(8),E("configId"),E("poolCreator"),E("vaultA"),E("vaultB"),E("mintLp"),E("mintA"),E("mintB"),E("mintProgramA"),E("mintProgramB"),E("observationId"),X("bump"),X("status"),X("lpDecimals"),X("mintDecimalA"),X("mintDecimalB"),S("lpAmount"),S("protocolFeesMintA"),S("protocolFeesMintB"),S("fundFeesMintA"),S("fundFeesMintB"),S("openTime"),_(S(),32)]);var ln=class extends De{constructor(t){super(t)}async load(){this.checkDisabled()}async getCpmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async getRpcPoolInfo(t,e){return(await this.getRpcPoolInfos([t],e))[t]}async getRpcPoolInfos(t,e){let i=await Be(this.scope.connection,t.map(l=>({pubkey:new T(l)}))),s={},o=new Set,a=[];for(let l=0;l<t.length;l++){let b=i[l];if(b.accountInfo===null)throw Error("fetch pool info error: "+String(t[l]));let c=ci.decode(b.accountInfo.data);s[String(t[l])]=q(v({},c),{programId:b.accountInfo.owner}),o.add(String(c.configId)),a.push(c.vaultA,c.vaultB)}let r={};if(e){let l=[...o],b=await Be(this.scope.connection,l.map(c=>({pubkey:new T(c)})));for(let c=0;c<l.length;c++){let p=b[c].accountInfo;if(p===null)throw Error("fetch pool config error: "+l[c]);r[l[c]]=ai.decode(p.data)}}let d={},g=await Be(this.scope.connection,a.map(l=>({pubkey:new T(l)})));for(let l=0;l<a.length;l++){let b=g[l].accountInfo;if(b===null)throw Error("fetch vault info error: "+a[l]);d[String(a[l])]=new Z(Nr.decode(b.data).amount.toString())}let A={};for(let[l,b]of Object.entries(s)){let c=d[b.vaultA.toString()].sub(b.protocolFeesMintA).sub(b.fundFeesMintA),p=d[b.vaultB.toString()].sub(b.protocolFeesMintB).sub(b.fundFeesMintB);A[l]=q(v({},b),{baseReserve:c,quoteReserve:p,vaultAAmount:d[b.vaultA.toString()],vaultBAmount:d[b.vaultB.toString()],configInfo:r[b.configId.toString()],poolPrice:new ae(p.toString()).div(new ae(10).pow(b.mintDecimalB)).div(new ae(c.toString()).div(new ae(10).pow(b.mintDecimalA)))})}return A}toComputePoolInfos({pools:t,mintInfos:e}){return Object.keys(t).reduce((i,s)=>{var d,g,A,l;let o=t[s],[a,r]=[o.mintA.toBase58(),o.mintB.toBase58()];return q(v({},i),{[s]:q(v({},o),{id:new T(s),configInfo:o.configInfo,version:7,authority:St(o.programId).publicKey,mintA:Ke({address:a,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(d=e[a])!=null&&d.feeConfig?Ve((g=e[a])==null?void 0:g.feeConfig):void 0}}),mintB:Ke({address:r,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(A=e[r])!=null&&A.feeConfig?Ve((l=e[r])==null?void 0:l.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(t){let e=await this.getRpcPoolInfo(t,!0),i=await Ft({connection:this.scope.connection,mints:[e.mintA,e.mintB]}),s=Ke({address:e.mintA.toBase58(),decimals:e.mintDecimalA,programId:e.mintProgramA.toBase58(),extensions:{feeConfig:i[e.mintA.toBase58()].feeConfig?Ve(i[e.mintA.toBase58()].feeConfig):void 0}}),o=Ke({address:e.mintB.toBase58(),decimals:e.mintDecimalB,programId:e.mintProgramB.toBase58(),extensions:{feeConfig:i[e.mintB.toBase58()].feeConfig?Ve(i[e.mintB.toBase58()].feeConfig):void 0}}),a=Ke({address:e.mintLp.toBase58(),decimals:e.lpDecimals,programId:ne.toBase58()}),r={id:e.configId.toBase58(),index:e.configInfo.index,protocolFeeRate:e.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:e.configInfo.tradeFeeRate.toNumber(),fundFeeRate:e.configInfo.fundFeeRate.toNumber(),createPoolFee:e.configInfo.createPoolFee.toString()},d={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:e.programId.toBase58(),id:t,type:"Standard",lpMint:a,lpPrice:0,lpAmount:e.lpAmount.toNumber(),config:r,mintA:s,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:e.poolPrice.toNumber(),mintAmountA:new ae(e.vaultAAmount.toString()).div(10**s.decimals).toNumber(),mintAmountB:new ae(e.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:e.configInfo.tradeFeeRate.toNumber(),openTime:e.openTime.toString(),tvl:0,burnPercent:0,day:d,week:d,month:d,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:e.programId.toBase58(),id:t,mintA:s,mintB:o,openTime:e.openTime.toString(),vault:{A:e.vaultA.toBase58(),B:e.vaultB.toBase58()},authority:St(e.programId).publicKey.toBase58(),mintLp:a,config:r,observationId:it(e.programId,new T(t)).publicKey.toBase58()},rpcData:e}}async createPool(p){var P=p,{poolId:t,programId:e,poolFeeAccount:i,startTime:s,ownerInfo:o,associatedOnly:a=!1,checkCreateATAOwner:r=!1,txVersion:d,feeConfig:g,computeBudgetConfig:A,txTipConfig:l,feePayer:b}=P,c=le(P,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig","txTipConfig","feePayer"]);var V,U,Y;let u=o.feePayer||((V=this.scope.owner)==null?void 0:V.publicKey),h=new Z(new T(c.mintA.address).toBuffer()).lte(new Z(new T(c.mintB.address).toBuffer())),[w,x]=h?[c.mintA,c.mintB]:[c.mintB,c.mintA],[m,f]=h?[c.mintAAmount,c.mintBAmount]:[c.mintBAmount,c.mintAAmount],y=o.useSOLBalance&&w.address===Lt.toBase58(),B=o.useSOLBalance&&x.address===Lt.toBase58(),[k,K]=[new T(w.address),new T(x.address)],L=this.createTxBuilder(b),{account:C,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:k,tokenProgram:w.programId,owner:this.scope.ownerPubKey,createInfo:y?{payer:u,amount:m}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:a,checkCreateATAOwner:r});L.addInstruction(I||{});let{account:M,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:new T(x.address),tokenProgram:x.programId,owner:this.scope.ownerPubKey,createInfo:B?{payer:u,amount:f}:void 0,notUseTokenAccount:B,skipCloseAccount:!B,associatedOnly:B?!1:a,checkCreateATAOwner:r});if(L.addInstruction(F||{}),C===void 0||M===void 0)throw Error("you don't has some token account");let D=_n({poolId:t,programId:e,configId:new T(g.id),mintA:k,mintB:K});return L.addInstruction({instructions:[ti(e,this.scope.ownerPubKey,new T(g.id),D.authority,D.poolId,k,K,D.lpMint,C,M,oe(this.scope.ownerPubKey,D.lpMint).publicKey,D.vaultA,D.vaultB,i,new T((U=w.programId)!=null?U:ne),new T((Y=x.programId)!=null?Y:ne),D.observationId,m,f,s)],instructionTypes:[J.CpmmCreatePool]}),L.addCustomComputeBudget(A),L.addTipInstruction(l),L.versionBuild({txVersion:d,extInfo:{address:q(v({},D),{mintA:w,mintB:x,programId:e,poolFeeAccount:i,feeConfig:g})}})}async addLiquidity(t){let{poolInfo:e,poolKeys:i,inputAmount:s,baseIn:o,slippage:a,computeResult:r,computeBudgetConfig:d,txTipConfig:g,config:A,txVersion:l,feePayer:b}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),s.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:s.toString()});let{account:c}=this.scope,{bypassAssociatedCheck:p,checkCreateATAOwner:P}=v({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},A),u=r?void 0:await this.getRpcPoolInfo(e.id),{liquidity:h,inputAmountFee:w,anotherAmount:x}=r||this.computePairAmount({poolInfo:q(v({},e),{lpAmount:new ae(u.lpAmount.toString()).div(10**e.lpMint.decimals).toNumber()}),baseReserve:u.baseReserve,quoteReserve:u.quoteReserve,slippage:new re(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new ae(s.toString()).div(10**(o?e.mintA.decimals:e.mintB.decimals))}),m=x.amount,f=e.mintA.address===Lt.toString(),y=e.mintB.address===Lt.toString(),B=this.createTxBuilder(b),[k,K]=[new T(e.mintA.address),new T(e.mintB.address)],{account:L,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new T(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:f||(o?s:m).isZero()?{payer:this.scope.ownerPubKey,amount:o?s:m}:void 0,skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:!1,checkCreateATAOwner:P});B.addInstruction(C||{});let{account:I,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new T(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(o?m:s).isZero()?{payer:this.scope.ownerPubKey,amount:o?m:s}:void 0,skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:!1,checkCreateATAOwner:P});B.addInstruction(M||{}),!L&&!I&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",c.tokenAccounts);let F=await c.getCreatedTokenAccount({mint:new T(e.lpMint.address)}),ie=await c.handleTokenAccount({side:"out",amount:0,mint:new T(e.lpMint.address),tokenAccount:F,bypassAssociatedCheck:p,checkCreateATAOwner:P}),{tokenAccount:D}=ie,V=le(ie,["tokenAccount"]);B.addInstruction(V);let U=i!=null?i:await this.getCpmmPoolKeys(e.id),Y=new re(new Z(1)).sub(a);return B.addInstruction({instructions:[ni(new T(e.programId),this.scope.ownerPubKey,new T(U.authority),new T(e.id),D,L,I,new T(U.vault.A),new T(U.vault.B),k,K,new T(e.lpMint.address),r?r==null?void 0:r.liquidity:Y.mul(h).quotient,o?w.amount:m,o?m:w.amount)],instructionTypes:[J.CpmmAddLiquidity],lookupTableAddress:U.lookupTableAccount?[U.lookupTableAccount]:[]}),B.addCustomComputeBudget(d),B.addTipInstruction(g),B.versionBuild({txVersion:l})}async withdrawLiquidity(t){var V,U;let{poolInfo:e,poolKeys:i,lpAmount:s,slippage:o,computeBudgetConfig:a,txTipConfig:r,txVersion:d,feePayer:g,closeWsol:A=!0}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let l=new re(new Z(1)).sub(o),b=await this.getRpcPoolInfo(e.id),[c,p]=[l.mul(s.mul(b.baseReserve).div(b.lpAmount)).quotient,l.mul(s.mul(b.quoteReserve).div(b.lpAmount)).quotient],P=await this.scope.fetchEpochInfo(),[u,h]=[pe(c,e.mintA.extensions.feeConfig,P,!1),pe(p,e.mintB.extensions.feeConfig,P,!1)],{account:w}=this.scope,x=this.createTxBuilder(g),[m,f]=[new T(e.mintA.address),new T(e.mintB.address)],y=m.equals(te),B=f.equals(te),k,K,{account:L,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new T(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(y&&A),associatedOnly:!y,checkCreateATAOwner:!1});k=L,C&&x.addInstruction(C);let{account:I,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new T(e.mintB.address),notUseTokenAccount:B,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(B&&A),associatedOnly:!B,checkCreateATAOwner:!1});K=I,M&&x.addInstruction(M),(!k||!K)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",w.tokenAccounts);let F=await w.getCreatedTokenAccount({mint:new T(e.lpMint.address)});F||this.logAndCreateError("cannot found lp token account","tokenAccounts",w.tokenAccounts);let D=i!=null?i:await this.getCpmmPoolKeys(e.id);return x.addInstruction({instructions:[ii(new T(e.programId),this.scope.ownerPubKey,new T(D.authority),new T(e.id),F,k,K,new T(D.vault.A),new T(D.vault.B),m,f,new T(e.lpMint.address),s,c.sub((V=u.fee)!=null?V:new Z(0)),p.sub((U=h.fee)!=null?U:new Z(0)))],instructionTypes:[J.CpmmWithdrawLiquidity],lookupTableAddress:D.lookupTableAccount?[D.lookupTableAccount]:[]}),x.addCustomComputeBudget(a),x.addTipInstruction(r),x.versionBuild({txVersion:d})}async swap(t){var C,I,M,F,D,V;let{poolInfo:e,poolKeys:i,baseIn:s,fixedOut:o,inputAmount:a,swapResult:r,slippage:d=0,config:g,computeBudgetConfig:A,txTipConfig:l,txVersion:b,feePayer:c}=t,{bypassAssociatedCheck:p,checkCreateATAOwner:P,associatedOnly:u}=v({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},g),h=this.createTxBuilder(c),[w,x]=[new T(e.mintA.address),new T(e.mintB.address)];o?r.sourceAmountSwapped=r.sourceAmountSwapped.mul(new Z((1+d)*1e4)).div(new Z(1e4)):r.destinationAmountSwapped=r.destinationAmountSwapped.mul(new Z((1-d)*1e4)).div(new Z(1e4));let m=e.mintA.address===te.toBase58(),f=e.mintB.address===te.toBase58(),{account:y,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({mint:w,tokenProgram:new T((C=e.mintA.programId)!=null?C:ne),owner:this.scope.ownerPubKey,createInfo:m||!s?{payer:this.scope.ownerPubKey,amount:s?r.sourceAmountSwapped:0}:void 0,notUseTokenAccount:m,skipCloseAccount:!m,associatedOnly:m?!1:u,checkCreateATAOwner:P});B&&h.addInstruction(B);let{account:k,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({mint:x,tokenProgram:new T((I=e.mintB.programId)!=null?I:ne),owner:this.scope.ownerPubKey,createInfo:f||s?{payer:this.scope.ownerPubKey,amount:s?0:r.sourceAmountSwapped}:void 0,notUseTokenAccount:f,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:P});K&&h.addInstruction(K),(!y||!k)&&this.logAndCreateError("user do not have token account",{mintA:e.mintA.symbol||e.mintA.address,mintB:e.mintB.symbol||e.mintB.address,mintATokenAcc:y,mintBTokenAcc:k,mintAUseSOLBalance:m,mintBUseSOLBalance:f,associatedOnly:u});let L=i!=null?i:await this.getCpmmPoolKeys(e.id);return h.addInstruction({instructions:[o?oi(new T(e.programId),this.scope.ownerPubKey,new T(L.authority),new T(L.config.id),new T(e.id),s?y:k,s?k:y,new T(L.vault[s?"A":"B"]),new T(L.vault[s?"B":"A"]),new T((D=e[s?"mintA":"mintB"].programId)!=null?D:ne),new T((V=e[s?"mintB":"mintA"].programId)!=null?V:ne),s?w:x,s?x:w,it(new T(e.programId),new T(e.id)).publicKey,r.sourceAmountSwapped,r.destinationAmountSwapped):ri(new T(e.programId),this.scope.ownerPubKey,new T(L.authority),new T(L.config.id),new T(e.id),s?y:k,s?k:y,new T(L.vault[s?"A":"B"]),new T(L.vault[s?"B":"A"]),new T((M=e[s?"mintA":"mintB"].programId)!=null?M:ne),new T((F=e[s?"mintB":"mintA"].programId)!=null?F:ne),s?w:x,s?x:w,it(new T(e.programId),new T(e.id)).publicKey,a,r.destinationAmountSwapped)],instructionTypes:[o?J.CpmmSwapBaseOut:J.ClmmSwapBaseIn]}),h.addCustomComputeBudget(A),h.addTipInstruction(l),h.versionBuild({txVersion:b})}async lockLp(t){var b,c,p,P,u;let{poolInfo:e,lpAmount:i,computeBudgetConfig:s,txTipConfig:o,txVersion:a,feePayer:r,feeNftOwner:d}=t;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let g=this.createTxBuilder(r),A=(b=t.poolKeys)!=null?b:await this.getCpmmPoolKeys(e.id),l=await si({poolInfo:e,poolKeys:A,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(c=t.feePayer)!=null?c:this.scope.ownerPubKey},feeNftOwner:d!=null?d:this.scope.ownerPubKey,lockProgram:(p=t.programId)!=null?p:yt,lockAuthProgram:(P=t.authProgram)!=null?P:gt,lpAmount:i,withMetadata:(u=t.withMetadata)!=null?u:!0,getEphemeralSigners:t.getEphemeralSigners});return g.addInstruction(l),g.addCustomComputeBudget(s),g.addTipInstruction(o),g.versionBuild({txVersion:a,extInfo:l.address})}async harvestLockLp(t){var I;let{poolInfo:e,lpFeeAmount:i,nftMint:s,programId:o=yt,authProgram:a=gt,cpmmProgram:r,computeBudgetConfig:d,txTipConfig:g,txVersion:A,closeWsol:l=!0}=t;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let b=t.feePayer||this.scope.ownerPubKey,c=this.createTxBuilder(b),[p,P]=[new T(e.mintA.address),new T(e.mintB.address)],u=p.equals(te),h=P.equals(te),w,x,{account:m,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new T(e.mintA.address),notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(u&&l),associatedOnly:!u,checkCreateATAOwner:!1});w=m,f&&c.addInstruction(f);let{account:y,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new T(e.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(h&&l),associatedOnly:!h,checkCreateATAOwner:!1});x=y,B&&c.addInstruction(B),(!w||!x)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:w,tokenAccountB:x});let k=(I=t.poolKeys)!=null?I:await this.getCpmmPoolKeys(e.id),{publicKey:K}=oe(b,s,ne),{publicKey:L}=rt(o,s),{publicKey:C}=oe(a,new T(e.lpMint.address),ne);return c.addInstruction({instructions:[un({programId:o,nftOwner:this.scope.ownerPubKey,auth:a,nftMint:s,nftAccount:K,lockPda:L,poolId:new T(e.id),mintLp:new T(k.mintLp.address),userVaultA:w,userVaultB:x,poolVaultA:new T(k.vault.A),poolVaultB:new T(k.vault.B),mintA:p,mintB:P,lockLpVault:C,lpFeeAmount:i,cpmmProgram:r==null?void 0:r.programId,cpmmAuthProgram:r==null?void 0:r.authProgram})],instructionTypes:[J.CpmmCollectLockFee]}),c.addCustomComputeBudget(d),c.addTipInstruction(g),c.versionBuild({txVersion:A})}async harvestMultiLockLp(t){let{lockInfo:e,programId:i=yt,authProgram:s=gt,cpmmProgram:o,computeBudgetConfig:a,txVersion:r,closeWsol:d=!0}=t,g=t.feePayer||this.scope.ownerPubKey,A=this.createTxBuilder(g),l={};return e.forEach(async b=>{var L;let{poolInfo:c,lpFeeAmount:p,nftMint:P}=b;if(p.isZero())return;let[u,h]=[new T(c.mintA.address),new T(c.mintB.address)],w=u.equals(te),x=h.equals(te),m=l[c.mintA.address],f=l[c.mintB.address];if(!m)if(w){let{account:C,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.mintA.programId,mint:new T(c.mintA.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!d,associatedOnly:!1,checkCreateATAOwner:!1});m=C,I&&A.addInstruction(I),l[c.mintA.address]=C}else{let C=new T(c.mintA.address);m=this.scope.account.getAssociatedTokenAccount(C,new T(c.mintA.programId)),A.addInstruction({instructions:[ui(this.scope.ownerPubKey,m,this.scope.ownerPubKey,C)]}),l[c.mintA.address]=m}if(!f)if(x){let{account:C,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.mintB.programId,mint:new T(c.mintB.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!d,associatedOnly:!1,checkCreateATAOwner:!1});f=C,I&&A.addInstruction(I),l[c.mintB.address]=C}else{let C=new T(c.mintB.address);f=this.scope.account.getAssociatedTokenAccount(C,new T(c.mintB.programId)),A.addInstruction({instructions:[ui(this.scope.ownerPubKey,f,this.scope.ownerPubKey,C)]}),l[c.mintB.address]=f}(!m||!f)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:m,tokenAccountB:f});let y=(L=b.poolKeys)!=null?L:await this.getCpmmPoolKeys(c.id),{publicKey:B}=oe(g,P,ne),{publicKey:k}=rt(i,P),{publicKey:K}=oe(s,new T(c.lpMint.address),ne);A.addInstruction({instructions:[un({programId:i,nftOwner:this.scope.ownerPubKey,auth:s,nftMint:P,nftAccount:B,lockPda:k,poolId:new T(c.id),mintLp:new T(y.mintLp.address),userVaultA:m,userVaultB:f,poolVaultA:new T(y.vault.A),poolVaultB:new T(y.vault.B),mintA:u,mintB:h,lockLpVault:K,lpFeeAmount:p,cpmmProgram:o==null?void 0:o.programId,cpmmAuthProgram:o==null?void 0:o.authProgram})],instructionTypes:[J.CpmmCollectLockFee]})}),r===0?A.sizeCheckBuildV0({computeBudgetConfig:a}):A.sizeCheckBuild({computeBudgetConfig:a})}computeSwapAmount({pool:t,amountIn:e,outputMint:i,slippage:s}){let o=i.toString()===t.mintB.address,a=xt.swap(e,o?t.baseReserve:t.quoteReserve,o?t.quoteReserve:t.baseReserve,t.configInfo.tradeFeeRate),r=new ae(a.destinationAmountSwapped.toString()).div(a.sourceAmountSwapped.toString()),d=a.destinationAmountSwapped.mul(new Z((1-s)*1e4)).div(new Z(1e4));return{allTrade:a.sourceAmountSwapped.eq(e),amountIn:e,amountOut:a.destinationAmountSwapped,minAmountOut:d,executionPrice:r,fee:a.tradeFee,priceImpact:t.poolPrice.sub(r).div(t.poolPrice)}}computePairAmount({poolInfo:t,baseReserve:e,quoteReserve:i,amount:s,slippage:o,epochInfo:a,baseIn:r}){var m,f,y,B,k,K,L,C,I;let d=1-Number(o.toSignificant())/100,g=new Z(new ae(s).mul(10**t[r?"mintA":"mintB"].decimals).mul(d).toFixed(0)),A=pe(g,t[r?"mintA":"mintB"].extensions.feeConfig,a,!1),l=g.sub((m=A.fee)!=null?m:new Z(0)),b=new Z(new ae(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,ae.ROUND_DOWN));this.logDebug("baseReserve:",e.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",r?t.mintA.symbol:t.mintB.symbol,"amountIn:",g.toString(),"amountInFee:",(y=(f=A.fee)==null?void 0:f.toString())!=null?y:0,"anotherToken:",r?t.mintB.symbol:t.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let c=r?"base":"quote";this.logDebug("input side:",c);let p=l.mul(b).div(c==="base"?e:i),P={amount:Ut,fee:void 0,expirationTime:void 0};if(!l.isZero()){let M=Mr(p,e,i,b);this.logDebug("lpAmountData:",{amountA:M.amountA.toString(),amountB:M.amountB.toString()}),P=pe(M[r?"amountB":"amountA"],t[r?"mintB":"mintA"].extensions.feeConfig,a,!0)}let u=new re(new Z(1)).add(o),h=new re(new Z(1)).sub(o),w=pe(u.mul(P.amount.sub((B=P.fee)!=null?B:new Z(0))).quotient,t[r?"mintB":"mintA"].extensions.feeConfig,a,!0),x=pe(h.mul(P.amount.sub((k=P.fee)!=null?k:new Z(0))).quotient,t[r?"mintB":"mintA"].extensions.feeConfig,a,!0);return this.logDebug("anotherAmount:",P.amount.toString(),"anotherAmountFee:",(L=(K=P.fee)==null?void 0:K.toString())!=null?L:0,"maxAnotherAmount:",w.amount.toString(),"maxAnotherAmountFee:",(I=(C=w.fee)==null?void 0:C.toString())!=null?I:0),{inputAmountFee:A,anotherAmount:P,maxAnotherAmount:w,minAnotherAmount:x,liquidity:p}}};function Mr(n,t,e,i){let s=n.mul(t).div(i);!s.isZero()&&!n.mul(t).mod(i).isZero()&&(s=s.add(new Z(1)));let o=n.mul(e).div(i);return!o.isZero()&&!n.mul(e).mod(i).isZero()&&(o=o.add(new Z(1))),{amountA:s,amountB:o}}export{ln as default};
//# sourceMappingURL=cpmm.mjs.map