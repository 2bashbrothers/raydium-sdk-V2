var ui=Object.defineProperty,li=Object.defineProperties;var mi=Object.getOwnPropertyDescriptors;var nt=Object.getOwnPropertySymbols;var ln=Object.prototype.hasOwnProperty,mn=Object.prototype.propertyIsEnumerable;var un=(n,t,e)=>t in n?ui(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,E=(n,t)=>{for(var e in t||(t={}))ln.call(t,e)&&un(n,e,t[e]);if(nt)for(var e of nt(t))mn.call(t,e)&&un(n,e,t[e]);return n},G=(n,t)=>li(n,mi(t));var me=(n,t)=>{var e={};for(var i in n)ln.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&nt)for(var i of nt(n))t.indexOf(i)<0&&mn.call(n,i)&&(e[i]=n[i]);return e};import{PublicKey as k}from"@solana/web3.js";import{AccountLayout as Rr,NATIVE_MINT as It,TOKEN_PROGRAM_ID as $,createAssociatedTokenAccountIdempotentInstruction as ai}from"@solana/spl-token";import ue from"bn.js";import rc from"decimal.js";import Ui from"big.js";import _a from"bn.js";import{get as dn,set as di}from"lodash";var St=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},pn={},pi={};function j(n){let t=dn(pn,n);if(!t){let e=dn(pi,n);t=new St({name:n,logLevel:e}),di(pn,n,t)}return t}import{PublicKey as fn}from"@solana/web3.js";import{MINT_SIZE as fi,TOKEN_PROGRAM_ID as bi,getTransferFeeConfig as yi,unpackMint as gi}from"@solana/spl-token";var Ct=j("Raydium_accountInfo_util");async function De(n,t,e){let{batchRequest:i,commitment:s="confirmed",chunkCount:r=100}=E({batchRequest:!1},e),a=Kt(t,r),o=new Array(a.length).fill([]);if(i){let l=a.map(u=>{let d=n._buildArgs([u.map(c=>c.toBase58())],s,"base64");return{methodName:"getMultipleAccounts",args:d}}),p=Kt(l,10);o=(await(await Promise.all(p.map(async u=>await n._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&Ct.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(d=>{if(d){let{data:c,executable:y,lamports:f,owner:m,rentEpoch:T}=d;return c.length!==2&&c[1]!=="base64"&&Ct.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(c[0],"base64"),executable:y,lamports:f,owner:new fn(m),rentEpoch:T}}return null})))}else try{o=await Promise.all(a.map(l=>n.getMultipleAccountsInfo(l,s)))}catch(l){l instanceof Error&&Ct.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.message}`)}return o.flat()}async function Ae(n,t,e){let i=await De(n,t.map(s=>s.pubkey),e);return t.map((s,r)=>G(E({},s),{accountInfo:i[r]}))}async function Lt({connection:n,mints:t,config:e}){var r,a,o;if(t.length===0)return{};let i=await Ae(n,t.map(l=>({pubkey:ve(l)})),e),s={};for(let l of i){if(!l.accountInfo||l.accountInfo.data.length<fi){console.log("invalid mint account",l.pubkey.toBase58());continue}let p=gi(l.pubkey,l.accountInfo,(r=l.accountInfo)==null?void 0:r.owner);s[l.pubkey.toString()]=G(E({},p),{programId:((a=l.accountInfo)==null?void 0:a.owner)||bi,feeConfig:(o=yi(p))!=null?o:void 0})}return s[fn.default.toBase58()]=s[J.toBase58()],s}import We from"bn.js";var bn=9007199254740991;function ae(n){let t=j("Raydium_parseBigNumberish");if(n instanceof We)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new We(n);t.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&t.logWithError(`BigNumberish number underflow: ${n}`),(n>=bn||n<=-bn)&&t.logWithError(`BigNumberish number overflow: ${n}`),new We(String(n))):typeof n=="bigint"?new We(n.toString()):(t.error(`invalid BigNumberish value: ${n}`),new We(0))}import{PublicKey as Pi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as yn}from"@solana/spl-token";var Rt={chainId:101,address:Pi.default.toBase58(),programId:yn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},fe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:yn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ot}from"@solana/web3.js";import{PublicKey as X,SystemProgram as gn,SYSVAR_RENT_PUBKEY as Ai}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wi}from"@solana/spl-token";function Nt({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var eo=[Nt({pubkey:wi,isWritable:!1}),Nt({pubkey:gn.programId,isWritable:!1}),Nt({pubkey:Ai,isWritable:!1})];function Mt({publicKey:n,transformSol:t}){let e=Pn(n.toString());if(e instanceof X)return t&&e.equals(Ve)?J:e;if(t&&e.toString()===Ve.toBase58())return J;if(typeof e=="string"){if(e===X.default.toBase58())return X.default;try{return new X(e)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Pn(n){try{return new X(n)}catch{return n}}var ki=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),it=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),rt=new X("SysvarRent111111111111111111111111111111111"),to=new X("SysvarC1ock11111111111111111111111111111111"),Ie=new X("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),no=new X("Sysvar1nstructions1111111111111111111111111"),An=gn.programId,io=new X("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ro=new X("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),oo=new X("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),so=new X("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ao=new X("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),co=new X("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),uo=new X("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),lo=new X("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),mo=new X("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),po=new X("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),fo=new X("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),J=new X("So11111111111111111111111111111111111111112"),Ve=X.default;function ve(n){return Mt({publicKey:n,transformSol:!0})}var Ft=class{constructor({mint:t,decimals:e,symbol:i,name:s,skipMint:r=!1,isToken2022:a=!1}){if(t===Ve.toBase58()||t instanceof Ot&&Ve.equals(t)){this.decimals=fe.decimals,this.symbol=fe.symbol,this.name=fe.name,this.mint=new Ot(fe.address),this.isToken2022=!1;return}this.decimals=e,this.symbol=i||t.toString().substring(0,6),this.name=s||t.toString().substring(0,6),this.mint=r?Ot.default:Mt({publicKey:t}),this.isToken2022=a}equals(t){return this===t?!0:this.mint.equals(t.mint)}},be=Ft;be.WSOL=new Ft(G(E({},fe),{mint:fe.address}));var Et=class{constructor({decimals:t,symbol:e="UNKNOWN",name:i="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=i}equals(t){return this===t}},ot=Et;ot.SOL=new Et(Rt);import Ti from"toformat";var Bi=Ti,_e=Bi;import at from"big.js";import xi from"bn.js";import Ii from"decimal.js-light";var st=j("module/fraction"),Dt=_e(at),qe=_e(Ii),Si={[0]:qe.ROUND_DOWN,[1]:qe.ROUND_HALF_UP,[2]:qe.ROUND_UP},Ci={[0]:at.roundDown,[1]:at.roundHalfUp,[2]:at.roundUp},q=class{constructor(t,e=new xi(1)){this.numerator=ae(t),this.denominator=ae(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new q(this.denominator,this.numerator)}add(t){let e=t instanceof q?t:new q(ae(t));return this.denominator.eq(e.denominator)?new q(this.numerator.add(e.numerator),this.denominator):new q(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof q?t:new q(ae(t));return this.denominator.eq(e.denominator)?new q(this.numerator.sub(e.numerator),this.denominator):new q(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof q?t:new q(ae(t));return new q(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof q?t:new q(ae(t));return new q(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},i=1){Number.isInteger(t)||st.logWithError(`${t} is not an integer.`),t<=0&&st.logWithError(`${t} is not positive.`),qe.set({precision:t+1,rounding:Si[i]});let s=new qe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return s.toFormat(s.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},i=1){return Number.isInteger(t)||st.logWithError(`${t} is not an integer.`),t<0&&st.logWithError(`${t} is negative.`),Dt.DP=t,Dt.RM=Ci[i]||1,new Dt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};import Ki from"bn.js";var wn=new q(new Ki(100)),ee=class extends q{toSignificant(t=5,e,i){return this.mul(wn).toSignificant(t,e,i)}toFixed(t=2,e,i){return this.mul(wn).toFixed(t,e,i)}};var _o=j("Raydium_price");function Kt(n,t=1,e=[]){let i=[...n];if(t<=0)return e;for(;i.length;)e.push(i.splice(0,t));return e}import{PublicKey as Ei}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Di}from"@solana/spl-token";import{ComputeBudgetProgram as kn,Keypair as Bn,PublicKey as Li,Transaction as hn,TransactionMessage as Ri,VersionedTransaction as xn}from"@solana/web3.js";var Y={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Ni}from"@solana/spl-token";var Tn=j("Raydium_txUtil"),In=1644;function ut(n){let t=[],e=[];return n.microLamports&&(t.push(kn.setComputeUnitPrice({microLamports:n.microLamports})),e.push(Y.SetComputeUnitPrice)),n.units&&(t.push(kn.setComputeUnitLimit({units:n.units})),e.push(Y.SetComputeUnitLimit)),{instructions:t,instructionTypes:e}}async function Se(n,t){var i,s;let e=t!=null?t:"confirmed";return(s=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:e})))==null?void 0:s.blockhash}async function lt(n,t){return n.getSignatureStatuses([t]),new Promise((e,i)=>{let s=setTimeout(i,6e4);n.onSignature(t,r=>{if(clearTimeout(s),!r.err){e("");return}i(Object.assign(r.err,{txId:t}))},"confirmed")})}function Mi(n,t){n.length<1&&Tn.logWithError(`no instructions provided: ${n.toString()}`),t.length<1&&Tn.logWithError(`no signers provided:, ${t.toString()}`);let e=new hn;e.recentBlockhash="11111111111111111111111111111111",e.feePayer=t[0],e.add(...n);try{return Buffer.from(e.serialize({verifySignatures:!1})).toString("base64").length<In}catch{return!1}}function oe(n,t){let[e,i]=Li.findProgramAddressSync(n,t);return{publicKey:e,nonce:i}}function Ge({instructions:n,payer:t,signers:e}){return Mi(n,[t,...e])}function Ue({instructions:n,payer:t,lookupTableAddressAccount:e,recentBlockhash:i=Bn.generate().publicKey.toString()}){let r=new Ri({payerKey:t,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(e!=null?e:{}));try{return Buffer.from(new xn(r).serialize()).toString("base64").length<In}catch{return!1}}var Oi=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Fi=n=>{let t=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof xn&&(t=Oi(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function we(n){let t=[];return n.forEach(e=>{e instanceof hn&&(e.recentBlockhash||(e.recentBlockhash=Ni.toBase58()),e.feePayer||(e.feePayer=Bn.generate().publicKey)),t.push(Fi(e))}),console.log("simulate tx string:",t),t}function te(n,t,e){return oe([n.toBuffer(),(e!=null?e:Di).toBuffer(),t.toBuffer()],new Ei("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as L}from"@solana/web3.js";var ks=new L("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ts=new L("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Bs=new L("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),hs=new L("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),xs=new L("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Is=new L("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ss=new L("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Cs=new L("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ks=new L("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ls=new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),vi=new L("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Wi=new L("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Vi=new L("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Rs=new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ns=new L("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ms=new L("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Os=new L("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Fs=new L("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Es=new L("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ds=new L("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Sn=new L("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Cn=new L("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),vs=new L("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),mt=new L("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),dt=new L("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ws=new L("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Vs=new L("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),_s=new L("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),qs=new L("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Gs=new L("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Us=new L("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Xs={OPEN_BOOK_PROGRAM:new L("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new L("Ray1111111111111111111111111111111111111111"),AMM_V4:new L("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new L("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new L("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new L("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new L("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new L("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new L("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new L("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new L("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new L("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:L.default,Router:new L("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new L("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new L("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new L("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new L("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new L("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new L("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new L("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new L("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new L("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new L("Ray1111111111111111111111111111111111111111")};import se from"bn.js";var Xe=1e4;function ce(n,t,e,i){if(t===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let s=G(E({},t),{olderTransferFee:{epoch:BigInt(t.olderTransferFee.epoch),maximumFee:BigInt(t.olderTransferFee.maximumFee),transferFeeBasisPoints:t.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(t.newerTransferFee.epoch),maximumFee:BigInt(t.newerTransferFee.maximumFee),transferFeeBasisPoints:t.newerTransferFee.transferFeeBasisPoints}}),r=e.epoch<s.newerTransferFee.epoch?s.olderTransferFee:s.newerTransferFee,a=new se(r.maximumFee.toString()),o=e.epoch<s.newerTransferFee.epoch?(Number(s.newerTransferFee.epoch)*e.slotsInEpoch-e.absoluteSlot)*400/1e3:void 0;if(i)if(r.transferFeeBasisPoints===Xe){let l=new se(r.maximumFee.toString());return{amount:n.add(l),fee:l,expirationTime:o}}else{let l=Ce(n.mul(new se(Xe)),new se(Xe-r.transferFeeBasisPoints)),p=new se(r.maximumFee.toString()),b=l.sub(n).gt(p)?n.add(p):l,u=Ce(b.mul(new se(r.transferFeeBasisPoints)),new se(Xe)),d=u.gt(a)?a:u;return{amount:b,fee:d,expirationTime:o}}else{let l=Ce(n.mul(new se(r.transferFeeBasisPoints)),new se(Xe)),p=l.gt(a)?a:l;return{amount:n,fee:p,expirationTime:o}}}function Ce(n,t){let{div:e,mod:i}=n.divmod(t);return i.gt(new se(0))?e.add(new se(1)):e}import{PublicKey as Vt,AddressLookupTableAccount as Le}from"@solana/web3.js";async function _t({connection:n,address:t,cluster:e="mainnet"}){let i=await De(n,[...new Set(t.map(r=>r.toString()))].map(r=>new Vt(r))),s={};for(let r=0;r<t.length;r++){let a=i[r],o=t[r];if(!a)continue;let l=new Le({key:o,state:Le.deserialize(a.data)});s[o.toString()]=l,e==="devnet"?Ke[o.toString()]=l:pt[o.toString()]=l}return s}var pt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Le({key:new Vt("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Le.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Ke={},qt=async n=>{let t="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Ke[t])return Ke;let e=new Vt(t),i=await n.getAccountInfo(e);return i&&(Ke[t]=new Le({key:e,state:Le.deserialize(i.data)})),Ke};import{PublicKey as Re,sendAndConfirmTransaction as Gt,SystemProgram as _i,Transaction as ze,TransactionMessage as He,VersionedTransaction as Ze}from"@solana/web3.js";import qi from"axios";var ft=2e3,bt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.loopMultiTxStatus=!!t.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let t=(await qi.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:e}=(i=t==null?void 0:t[15])!=null?i:{};if(!!e)return{units:6e5,microLamports:Math.min(Math.ceil(e*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:e,instructionTypes:i}=ut(t);return this.instructions.unshift(...e),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(t){var e;return t?(this.endInstructions.push(_i.transfer({fromPubkey:(e=t.feePayer)!=null?e:this.feePayer,toPubkey:new Re(t.address),lamports:BigInt(t.amount.toString())})),this.endInstructionTypes.push(Y.TransferTip),!0):!1}async calComputeBudget({config:t,defaultIns:e}){try{let i=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;e&&this.instructions.unshift(...e)}catch{e&&this.instructions.unshift(...e)}}addInstruction({instructions:t=[],endInstructions:e=[],signers:i=[],instructionTypes:s=[],endInstructionTypes:r=[],lookupTableAddress:a=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...i),this.instructionTypes.push(...s),this.endInstructionTypes.push(...r),this.lookupTableAddress.push(...a.filter(o=>o!==Re.default.toString())),this}async versionBuild({txVersion:t,extInfo:e}){return t===0?await this.buildV0(E({},e||{})):this.build(e)}build(t){var i;let e=new ze;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(s=>s.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:e,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async s=>{var b;let{recentBlockHash:r,skipPreflight:a=!0,sendAndConfirm:o,notSendToRpc:l}=s||{},p=r!=null?r:await Se(this.connection,this.blockhashCommitment);if(e.recentBlockhash=p,this.signers.length&&e.sign(...this.signers),we([e]),(b=this.owner)!=null&&b.isKeyPair)return{txId:o?await Gt(this.connection,e,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(e.serialize(),{skipPreflight:a}),signedTx:e};if(this.signAllTransactions){let u=await this.signAllTransactions([e]);if(this.signers.length)for(let d of u)try{d.sign(...this.signers)}catch{}return{txId:l?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:a}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var p;let{extraPreBuildData:e=[],extInfo:i}=t,{transaction:s}=this.build(i),r=e.filter(b=>b.transaction.instructions.length>0),a=[s,...r.map(b=>b.transaction)],o=[this.signers,...r.map(b=>b.signers)],l=[...this.instructionTypes,...r.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&o.forEach(b=>{b.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:o,instructionTypes:l,execute:async b=>{var T;let{sequentially:u,onTxUpdate:d,skipTxCount:c=0,recentBlockHash:y,skipPreflight:f=!0}=b||{},m=y!=null?y:await Se(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(u){let A=[],B=0;for(let P of a){if(++B,B<=c)continue;let g=await Gt(this.connection,P,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(g)}return{txIds:A,signedTxs:a}}return{txIds:await await Promise.all(a.map(async A=>(A.recentBlockhash=m,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f})))),signedTxs:a}}if(this.signAllTransactions){let A=a.map((P,g)=>(P.recentBlockhash=m,o[g].length&&P.sign(...o[g]),P));we(A);let B=await this.signAllTransactions(A);if(u){let P=0,g=[],w=async()=>{if(!B[P])return;let h=await this.connection.sendRawTransaction(B[P].serialize(),{skipPreflight:f});g.push({txId:h,status:"sent",signedTx:B[P]}),d==null||d([...g]),P++;let x=!1,N=null,S=null,M=R=>{N!==null&&clearInterval(N),S!==null&&this.connection.removeSignatureListener(S);let F=g.findIndex(v=>v.txId===h);if(F>-1){if(g[F].status==="error"||g[F].status==="success")return;g[F].status=R.err?"error":"success"}d==null||d([...g]),R.err||w()};this.loopMultiTxStatus&&(N=setInterval(async()=>{var R;if(x){clearInterval(N);return}try{let F=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(x=!0,clearInterval(N),M({err:((R=F.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",h))}catch(F){x=!0,clearInterval(N),console.error("getTransaction timeout:",F,h)}},ft)),S=this.connection.onSignature(h,R=>{if(x){this.connection.removeSignatureListener(S);return}x=!0,M(R)},"confirmed"),this.connection.getSignatureStatus(h)};return await w(),{txIds:g.map(h=>h.txId),signedTxs:B}}else{let P=[];for(let g=0;g<B.length;g+=1){let w=await this.connection.sendRawTransaction(B[g].serialize(),{skipPreflight:f});P.push(w)}return{txIds:P,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:e,extInfo:i}){return e===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:i})}async buildV0(t){var f;let y=t||{},{lookupTableCache:e={},lookupTableAddress:i=[],forerunCreate:s,recentBlockhash:r}=y,a=me(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=E(E({},this.cluster==="devnet"?await qt(this.connection):pt),e),l=Array.from(new Set([...i,...this.lookupTableAddress])),p=[];for(let m of l)o[m]===void 0&&p.push(new Re(m));let b=await _t({connection:this.connection,address:p});for(let[m,T]of Object.entries(b))o[m]=T;let u=s?Re.default.toBase58():r!=null?r:await Se(this.connection,this.blockhashCommitment),d=new He({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(m=>m.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let c=new Ze(d);return c.sign(this.signers),{builder:this,transaction:c,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async m=>{var P;let{skipPreflight:T=!0,sendAndConfirm:A,notSendToRpc:B}=m||{};if(we([c]),(P=this.owner)!=null&&P.isKeyPair){let g=await this.connection.sendTransaction(c,{skipPreflight:T});return A&&await lt(this.connection,g),{txId:g,signedTx:c}}if(this.signAllTransactions){let g=await this.signAllTransactions([c]);if(this.signers.length)for(let w of g)try{w.sign(this.signers)}catch{}return{txId:B?"":await this.connection.sendTransaction(g[0],{skipPreflight:T}),signedTx:g[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(t){var p;let{extraPreBuildData:e=[],buildProps:i}=t,{transaction:s}=await this.buildV0(i),r=e.filter(b=>b.builder.instructions.length>0),a=[s,...r.map(b=>b.transaction)],o=[this.signers,...r.map(b=>b.signers)],l=[...this.instructionTypes,...r.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&o.forEach(b=>{b.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(b,u)=>{b.sign(o[u])}),{builder:this,transactions:a,signers:o,instructionTypes:l,buildProps:i,execute:async b=>{var f;let{sequentially:u,onTxUpdate:d,recentBlockHash:c,skipPreflight:y=!0}=b||{};if(c&&a.forEach(m=>m.message.recentBlockhash=c),we(a),(f=this.owner)!=null&&f.isKeyPair){if(u){let m=[];for(let T of a){let A=await this.connection.sendTransaction(T,{skipPreflight:y});await lt(this.connection,A),m.push(A)}return{txIds:m,signedTxs:a}}return{txIds:await Promise.all(a.map(async m=>await this.connection.sendTransaction(m,{skipPreflight:y}))),signedTxs:a}}if(this.signAllTransactions){let m=await this.signAllTransactions(a);if(u){let T=0,A=[],B=async()=>{if(!m[T])return;let P=await this.connection.sendTransaction(m[T],{skipPreflight:y});A.push({txId:P,status:"sent",signedTx:m[T]}),d==null||d([...A]),T++;let g=!1,w=null,h=null,x=N=>{w!==null&&clearInterval(w),h!==null&&this.connection.removeSignatureListener(h);let S=A.findIndex(M=>M.txId===P);if(S>-1){if(A[S].status==="error"||A[S].status==="success")return;A[S].status=N.err?"error":"success"}d==null||d([...A]),N.err||B()};this.loopMultiTxStatus&&(w=setInterval(async()=>{var N;if(g){clearInterval(w);return}try{let S=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});S&&(g=!0,clearInterval(w),x({err:((N=S.meta)==null?void 0:N.err)||null}),console.log("tx status from getTransaction:",P))}catch(S){g=!0,clearInterval(w),console.error("getTransaction timeout:",S,P)}},ft)),h=this.connection.onSignature(P,N=>{if(g){this.connection.removeSignatureListener(h);return}g=!0,x(N)},"confirmed"),this.connection.getSignatureStatus(P)};return B(),{txIds:[],signedTxs:m}}else{let T=[];for(let A=0;A<m.length;A+=1){let B=await this.connection.sendTransaction(m[A],{skipPreflight:y});T.push(B)}return{txIds:T,signedTxs:m}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(t){var d;let u=t||{},{splitIns:e=[],computeBudgetConfig:i}=u,s=me(u,["splitIns","computeBudgetConfig"]),r=i?ut(i):{instructions:[],instructionTypes:[]},a=this.signers.reduce((c,y)=>G(E({},c),{[y.publicKey.toBase58()]:y}),{}),o=[],l=[],p=[],b=0;if(this.allInstructions.forEach(c=>{let y=[...p,c],f=i?[...r.instructions,...y]:y,T=[...new Set(y.map(A=>A.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(A=>new Re(A));if(c!==e[b]&&p.length<12&&(Ge({instructions:f,payer:this.feePayer,signers:T})||Ge({instructions:y,payer:this.feePayer,signers:T})))p.push(c);else{if(p.length===0)throw Error("item ins too big");b+=c===e[b]?1:0,Ge({instructions:i?[...r.instructions,...p]:[...p],payer:this.feePayer,signers:T})?o.push(new ze().add(...r.instructions,...p)):o.push(new ze().add(...p)),l.push(Array.from(new Set(p.map(A=>A.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(A=>a[A]).filter(A=>A!==void 0)),p=[c]}}),p.length>0){let y=[...new Set(p.map(f=>f.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()).values()].map(f=>a[f]).filter(f=>f!==void 0);Ge({instructions:i?[...r.instructions,...p]:[...p],payer:this.feePayer,signers:y.map(f=>f.publicKey)})?o.push(new ze().add(...r.instructions,...p)):o.push(new ze().add(...p)),l.push(y)}return o.forEach(c=>c.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&l.forEach(c=>{c.some(y=>y.publicKey.equals(this.owner.publicKey))||c.push(this.owner.signer)}),{builder:this,transactions:o,signers:l,instructionTypes:this.instructionTypes,execute:async c=>{var P;let{sequentially:y,onTxUpdate:f,skipTxCount:m=0,recentBlockHash:T,skipPreflight:A=!0}=c||{},B=T!=null?T:await Se(this.connection,this.blockhashCommitment);if(o.forEach(async(g,w)=>{g.recentBlockhash=B,l[w].length&&g.sign(...l[w])}),we(o),(P=this.owner)!=null&&P.isKeyPair){if(y){let g=0,w=[];for(let h of o){if(++g,g<=m){w.push("tx skipped");continue}let x=await Gt(this.connection,h,this.signers.find(N=>N.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});w.push(x)}return{txIds:w,signedTxs:o}}return{txIds:await Promise.all(o.map(async g=>await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:A}))),signedTxs:o}}if(this.signAllTransactions){let g=await this.signAllTransactions(o.slice(m,o.length)),w=[...o.slice(0,m),...g];if(y){let h=0,x=[],N=async()=>{if(!w[h])return;h<m&&(x.push({txId:"",status:"success",signedTx:w[h]}),f==null||f([...x]),h++,N());let S=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:A});x.push({txId:S,status:"sent",signedTx:w[h]}),f==null||f([...x]),h++;let M=!1,R=null,F=null,v=D=>{R!==null&&clearInterval(R),F!==null&&this.connection.removeSignatureListener(F);let V=x.findIndex(Z=>Z.txId===S);if(V>-1){if(x[V].status==="error"||x[V].status==="success")return;x[V].status=D.err?"error":"success"}f==null||f([...x]),D.err||N()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var D;if(M){clearInterval(R);return}try{let V=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(M=!0,clearInterval(R),v({err:((D=V.meta)==null?void 0:D.err)||null}),console.log("tx status from getTransaction:",S))}catch(V){M=!0,clearInterval(R),console.error("getTransaction timeout:",V,S)}},ft)),F=this.connection.onSignature(S,D=>{if(M){this.connection.removeSignatureListener(F);return}M=!0,v(D)},"confirmed"),this.connection.getSignatureStatus(S)};return await N(),{txIds:x.map(S=>S.txId),signedTxs:w}}else{let h=[];for(let x=0;x<w.length;x+=1){let N=await this.connection.sendRawTransaction(w[x].serialize(),{skipPreflight:A});h.push(N)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async sizeCheckBuildV0(t){var B;let A=t||{},{computeBudgetConfig:e,splitIns:i=[],lookupTableCache:s={},lookupTableAddress:r=[]}=A,a=me(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=E(E({},this.cluster==="devnet"?await qt(this.connection):pt),s),l=Array.from(new Set([...this.lookupTableAddress,...r])),p=[];for(let P of l)o[P]===void 0&&p.push(new Re(P));let b=await _t({connection:this.connection,address:p});for(let[P,g]of Object.entries(b))o[P]=g;let u=e?ut(e):{instructions:[],instructionTypes:[]},d=await Se(this.connection,this.blockhashCommitment),c=this.signers.reduce((P,g)=>G(E({},P),{[g.publicKey.toBase58()]:g}),{}),y=[],f=[],m=[],T=0;if(this.allInstructions.forEach(P=>{let g=[...m,P],w=e?[...u.instructions,...g]:g;if(P!==i[T]&&m.length<12&&(Ue({instructions:w,payer:this.feePayer,lookupTableAddressAccount:o})||Ue({instructions:g,payer:this.feePayer,lookupTableAddressAccount:o})))m.push(P);else{if(m.length===0)throw Error("item ins too big");T+=P===i[T]?1:0;let h={};for(let x of[...new Set(l)])o[x]!==void 0&&(h[x]=o[x]);if(e&&Ue({instructions:[...u.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:d})){let x=new He({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...m]}).compileToV0Message(Object.values(o));y.push(new Ze(x))}else{let x=new He({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m]}).compileToV0Message(Object.values(o));y.push(new Ze(x))}f.push(Array.from(new Set(m.map(x=>x.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat())).map(x=>c[x]).filter(x=>x!==void 0)),m=[P]}}),m.length>0){let g=[...new Set(m.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(w=>c[w]).filter(w=>w!==void 0);if(e&&Ue({instructions:[...u.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:d})){let w=new He({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...m]}).compileToV0Message(Object.values(o));y.push(new Ze(w))}else{let w=new He({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m]}).compileToV0Message(Object.values(o));y.push(new Ze(w))}f.push(g)}return(B=this.owner)!=null&&B.signer&&f.forEach(P=>{P.some(g=>g.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),y.forEach((P,g)=>{P.sign(f[g])}),{builder:this,transactions:y,buildProps:t,signers:f,instructionTypes:this.instructionTypes,execute:async P=>{var S;let{sequentially:g,onTxUpdate:w,skipTxCount:h=0,recentBlockHash:x,skipPreflight:N=!0}=P||{};if(y.map(async(M,R)=>{f[R].length&&M.sign(f[R]),x&&(M.message.recentBlockhash=x)}),we(y),(S=this.owner)!=null&&S.isKeyPair){if(g){let M=0,R=[];for(let F of y){if(++M,M<=h){console.log("skip tx: ",M),R.push("tx skipped");continue}let v=await this.connection.sendTransaction(F,{skipPreflight:N});await lt(this.connection,v),R.push(v)}return{txIds:R,signedTxs:y}}return{txIds:await Promise.all(y.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:N}))),signedTxs:y}}if(this.signAllTransactions){let M=await this.signAllTransactions(y.slice(h,y.length)),R=[...y.slice(0,h),...M];if(g){let F=0,v=[],D=async()=>{if(!R[F])return;if(F<h){v.push({txId:"",status:"success",signedTx:R[F]}),w==null||w([...v]),F++,D();return}let V=await this.connection.sendTransaction(R[F],{skipPreflight:N});v.push({txId:V,status:"sent",signedTx:R[F]}),w==null||w([...v]),F++;let Z=!1,re=null,ge=null,cn=Pe=>{re!==null&&clearInterval(re),ge!==null&&this.connection.removeSignatureListener(ge);let le=v.findIndex(ci=>ci.txId===V);if(le>-1){if(v[le].status==="error"||v[le].status==="success")return;v[le].status=Pe.err?"error":"success"}w==null||w([...v]),Pe.err||D()};this.loopMultiTxStatus&&(re=setInterval(async()=>{var Pe;if(Z){clearInterval(re);return}try{let le=await this.connection.getTransaction(V,{commitment:"confirmed",maxSupportedTransactionVersion:0});le&&(Z=!0,clearInterval(re),cn({err:((Pe=le.meta)==null?void 0:Pe.err)||null}),console.log("tx status from getTransaction:",V))}catch(le){Z=!0,clearInterval(re),console.error("getTransaction timeout:",le,V)}},ft)),ge=this.connection.onSignature(V,Pe=>{if(Z){this.connection.removeSignatureListener(ge);return}Z=!0,cn(Pe)},"confirmed"),this.connection.getSignatureStatus(V)};return D(),{txIds:[],signedTxs:R}}else{let F=[];for(let v=0;v<R.length;v+=1){let D=await this.connection.sendTransaction(R[v],{skipPreflight:N});F.push(D)}return{txIds:F,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};import{PublicKey as da}from"@solana/web3.js";import fa from"bn.js";import Gi from"bn.js";var yt=new Gi(1e6);var Ya=j("Raydium_amount"),Qa=_e(Ui);var Wt=new ue(0),fc=new ue(1),bc=new ue(2),yc=new ue(3),gc=new ue(5),Xi=new ue(10),Pc=new ue(100),Ac=new ue(1e3),wc=new ue(1e4);function Ln(n,t,e){return n.mul(t).add(e).sub(new ue(1)).div(e)}function Ut(n,t,e){return n.mul(t).div(e)}import Xt from"bn.js";import wt from"decimal.js-light";import je from"bn.js";function gt(n,t){if(t.isZero())throw Error("divisor is zero");return n.mod(t)}function zi(n,t){if(t.isZero())throw Error("rhs is zero");let e=n.div(t);if(e.isZero())throw Error("quotient is zero");let i=gt(n,t);return i.gt(Ne)&&(e=e.add(new je(1)),t=n.div(e),i=gt(n,e),i.gt(Ne)&&(t=t.add(new je(1)))),[e,t]}var Ne=new je(0),Pt=class{static swapWithoutFees(t,e,i){let s=e.mul(i),r=e.add(t),[a]=zi(s,r),o=i.sub(a);if(o.isZero())throw Error("destinationAmountSwapped is zero");return{destinationAmountSwapped:o}}static lpTokensToTradingTokens(t,e,i,s,r){let a=t.mul(i).div(e),o=t.mul(s).div(e);if(r===0)return{tokenAmount0:a,tokenAmount1:o};if(r===1)return gt(t.mul(i),e).gt(Ne)&&a.gt(Ne)&&(a=a.add(new je(1))),gt(t.mul(s),e).gt(Ne)&&o.gt(Ne)&&(o=o.add(new je(1))),{tokenAmount0:a,tokenAmount1:o};throw Error("roundDirection value error")}};var At=class{static tradingFee(t,e){return Ln(t,e,yt)}static protocolFee(t,e){return Ut(t,e,yt)}static fundFee(t,e){return Ut(t,e,yt)}};var kt=class{static validate_supply(t,e){if(t.isZero())throw Error("tokenAmount0 is zero");if(e.isZero())throw Error("tokenAmount1 is zero")}static swap(t,e,i,s){let r=At.tradingFee(t,s),a=t.sub(r),{destinationAmountSwapped:o}=Pt.swapWithoutFees(a,e,i);return{newSwapDestinationAmount:i.sub(o),sourceAmountSwapped:t,destinationAmountSwapped:o,tradeFee:r}}static swapBaseOut({poolMintA:t,poolMintB:e,tradeFeeRate:i,baseReserve:s,quoteReserve:r,outputMint:a,outputAmount:o}){let[l,p,b,u,d]=e.address===a.toString()?[s,r,t.decimals,e.decimals,t.address]:[r,s,e.decimals,t.decimals,e.address],c=new wt(p.toString()).div(10**u).div(new wt(l.toString()).div(10**b)),y=o.gte(p)?p.sub(new Xt(1)):o,f=p.sub(y),m=Ce(l.mul(y),f),T=Ce(m.mul(new Xt(1e6)),new Xt(1e6).sub(i)),A=T.sub(m),B=new wt(y.toString()).div(10**u).div(new wt(T.toString()).div(10**b)),P=c.isZero()?0:B.sub(c).div(c).abs().toNumber();return{amountRealOut:y,amountIn:T,amountInWithoutFee:m,tradeFee:A,priceImpact:P}}};import H from"bn.js";import ie from"decimal.js";var zt=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),Me=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=j(e)}createTxBuilder(t){return this.scope.checkOwner(),new bt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(zt(t))}logInfo(...t){this.logger.info(zt(t))}logAndCreateError(...t){let e=zt(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as tr}from"@solana/web3.js";import On,{isBN as Fn}from"bn.js";import{bits as qc,BitStructure as Gc,blob as Hi,Blob as Uc,cstr as Xc,f32 as zc,f32be as Hc,f64 as Zc,f64be as jc,greedy as Yc,Layout as Zi,ns64 as Qc,ns64be as Jc,nu64 as $c,nu64be as eu,offset as tu,s16 as nu,s16be as iu,s24 as ru,s24be as ou,s32 as ji,s32be as su,s40 as au,s40be as cu,s48 as uu,s48be as lu,s8 as mu,seq as Yi,struct as du,Structure as Qi,u16 as Ji,u16be as pu,u24 as fu,u24be as bu,u32 as yu,u32be as gu,u40 as Pu,u40be as Au,u48 as wu,u48be as ku,u8 as $i,UInt as er,union as Tu,Union as Bu,unionLayoutDiscriminator as hu,utf8 as xu}from"@solana/buffer-layout";var Ht=Zi,Rn=Qi;var Zt=er;var Nn=$i,ke=Ji;var de=ji;var Mn=Yi;var Q=Hi;var Oe=class extends Ht{constructor(e,i,s){super(e,s);this.blob=Q(e),this.signed=i}decode(e,i=0){let s=new On(this.blob.decode(e,i),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(e,i,s=0){return typeof e=="number"&&(e=new On(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),i,s)}};function U(n){return new Zt(1,n)}function pe(n){return new Zt(4,n)}function I(n){return new Oe(8,!1,n)}function z(n){return new Oe(16,!1,n)}function En(n){return new Oe(8,!0,n)}function Dn(n){return new Oe(16,!0,n)}var Tt=class extends Ht{constructor(e,i,s,r){super(e.span,r);this.layout=e,this.decoder=i,this.encoder=s}decode(e,i){return this.decoder(this.layout.decode(e,i))}encode(e,i,s){return this.layout.encode(this.encoder(e),i,s)}getSpan(e,i){return this.layout.getSpan(e,i)}};function O(n){return new Tt(Q(32),t=>new tr(t),t=>t.toBuffer(),n)}function Te(n){return new Tt(Nn(),nr,ir,n)}function nr(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function ir(n){return n?1:0}var jt=class extends Rn{decode(t,e){return super.decode(t,e)}};function W(n,t,e){return new jt(n,t,e)}function _(n,t,e){let i,s=typeof t=="number"?t:Fn(t)?t.toNumber():new Proxy(t,{get(r,a){if(!i){let o=Reflect.get(r,"count");i=Fn(o)?o.toNumber():o,Reflect.set(r,"count",i)}return Reflect.get(r,a)},set(r,a,o){return a==="count"&&(i=o),Reflect.set(r,a,o)}});return Mn(n,s,e)}var Wu=W([pe("mintAuthorityOption"),O("mintAuthority"),I("supply"),U("decimals"),U("isInitialized"),pe("freezeAuthorityOption"),O("freezeAuthority")]);import{PublicKey as Gu}from"@solana/web3.js";import{MintLayout as Xu,TOKEN_PROGRAM_ID as Hu}from"@solana/spl-token";var Be=s=>{var r=s,{address:n,programId:t,decimals:e}=r,i=me(r,["address","programId","decimals"]);return E({chainId:101,address:ve(n).toBase58(),programId:t,logoURI:"",symbol:"",name:"",decimals:e,tags:[],extensions:i.extensions||{}},i)},Fe=n=>n?G(E({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:G(E({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:G(E({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;import{PublicKey as tt,TransactionInstruction as he,Keypair as Sr,SystemProgram as Cr}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Jn,TOKEN_2022_PROGRAM_ID as on,TOKEN_PROGRAM_ID as ye}from"@solana/spl-token";var rr=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),ol=Buffer.from("amm_config","utf8"),or=Buffer.from("pool","utf8"),sr=Buffer.from("pool_lp_mint","utf8"),ar=Buffer.from("pool_vault","utf8"),cr=Buffer.from("observation","utf8");function Bt(n){return oe([rr],n)}function Yt(n,t,e,i){return oe([or,t.toBuffer(),e.toBuffer(),i.toBuffer()],n)}function ur(n,t){return oe([sr,t.toBuffer()],n)}function vn(n,t,e){return oe([ar,t.toBuffer(),e.toBuffer()],n)}function Ye(n,t){return oe([cr,t.toBuffer()],n)}function Wn({poolId:n,programId:t,configId:e,mintA:i,mintB:s}){let r=Bt(t).publicKey,a=n||Yt(t,e,i,s).publicKey,o=ur(t,a).publicKey,l=vn(t,a,i).publicKey,p=vn(t,a,s).publicKey,b=Ye(t,a).publicKey;return{poolId:a,configId:e,authority:r,lpMint:o,vaultA:l,vaultB:p,observationId:b}}var lr=Buffer.from("locked_liquidity","utf8");function Qe(n,t){return oe([lr,t.toBuffer()],n)}import{PublicKey as Gd}from"@solana/web3.js";import Xd from"bn.js";import Hd from"decimal.js";import{AccountLayout as Yd,createAssociatedTokenAccountIdempotentInstruction as Qd,TOKEN_2022_PROGRAM_ID as Jd,TOKEN_PROGRAM_ID as $d}from"@solana/spl-token";import{Keypair as yd,PublicKey as gd,SystemProgram as Ad,TransactionInstruction as wd}from"@solana/web3.js";import Td from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as xd,TOKEN_2022_PROGRAM_ID as Id,TOKEN_PROGRAM_ID as Sd}from"@solana/spl-token";import jm from"bn.js";import Qm from"decimal.js";import ne from"bn.js";var Qt=new ne(0),Vn=new ne(1),_n=new ne(-1),ht=new ne(1).shln(64),qn=new ne(1).shln(128),mr=ht.sub(Vn);var dr=qn.subn(1),Ee=-443636,Je=-Ee,Jt=new ne("4295048016"),$t=new ne("79226673521066979257578248091"),cl=new ne("4295048017"),ul=new ne("79226673521066979257578248090");var pr=new ne(10).pow(new ne(6));var ll=new ne("18446744073700000000");import Om from"bn.js";import Em from"decimal.js";var gl=Buffer.from("amm_config","utf8"),Pl=Buffer.from("pool","utf8"),Al=Buffer.from("pool_vault","utf8"),wl=Buffer.from("pool_reward_vault","utf8"),kl=Buffer.from("position","utf8"),Tl=Buffer.from("tick_array","utf8"),Bl=Buffer.from("operation","utf8"),hl=Buffer.from("pool_tick_array_bitmap_extension","utf8"),xl=Buffer.from("observation","utf8");function en(n){return oe([Buffer.from("metadata","utf8"),Ie.toBuffer(),n.toBuffer()],Ie)}var Il=Buffer.from("locked_position","utf8");var Sl=Buffer.from("support_mint","utf8");import{PublicKey as am}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as um}from"@solana/spl-token";import mm from"bn.js";import pm from"decimal.js";import Ll from"bn.js";import Nl from"decimal.js";var rn=14;var xt=60;var gr=W([Q(8),U("bump"),ke("index"),O(""),pe("protocolFeeRate"),pe("tradeFeeRate"),ke("tickSpacing"),_(I(),8,"")]),Pr=W([pe("blockTimestamp"),En("tickCumulative"),_(I(),4)]),Qn=W([Q(8),Te("initialized"),I("recentEpoch"),ke("observationIndex"),O("poolId"),_(Pr,100,"observations"),_(I(),4)]),Ar=W([U("rewardState"),I("openTime"),I("endTime"),I("lastUpdateTime"),z("emissionsPerSecondX64"),I("rewardTotalEmissioned"),I("rewardClaimed"),O("tokenMint"),O("tokenVault"),O("creator"),z("rewardGrowthGlobalX64")]),Zn=W([Q(8),U("bump"),O("ammConfig"),O("creator"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("observationId"),U("mintDecimalsA"),U("mintDecimalsB"),ke("tickSpacing"),z("liquidity"),z("sqrtPriceX64"),de("tickCurrent"),pe(),z("feeGrowthGlobalX64A"),z("feeGrowthGlobalX64B"),I("protocolFeesTokenA"),I("protocolFeesTokenB"),z("swapInAmountTokenA"),z("swapOutAmountTokenB"),z("swapInAmountTokenB"),z("swapOutAmountTokenA"),U("status"),_(U(),7,""),_(Ar,3,"rewardInfos"),_(I(),16,"tickArrayBitmap"),I("totalFeesTokenA"),I("totalFeesClaimedTokenA"),I("totalFeesTokenB"),I("totalFeesClaimedTokenB"),I("fundFeesTokenA"),I("fundFeesTokenB"),I("startTime"),_(I(),15*4-3,"padding")]),wr=W([z("growthInsideLastX64"),I("rewardAmountOwed")]),jn=W([Q(8),U("bump"),O("nftMint"),O("poolId"),de("tickLower"),de("tickUpper"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),_(wr,3,"rewardInfos"),_(I(),8,"")]),sd=W([Q(8),U("bump"),O("poolId"),de("tickLowerIndex"),de("tickUpperIndex"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),_(z(),3,"rewardGrowthInside"),_(I(),8,"")]),kr=W([de("tick"),Dn("liquidityNet"),z("liquidityGross"),z("feeGrowthOutsideX64A"),z("feeGrowthOutsideX64B"),_(z(),3,"rewardGrowthsOutsideX64"),_(pe(),13,"")]),Xn=W([Q(8),O("poolId"),de("startTickIndex"),_(kr,xt,"ticks"),U("initializedTickCount"),_(U(),115,"")]),Tr=W([Q(329),_(O(),100,"whitelistMints")]),yr=W([Q(8),O("poolId"),_(_(I(),8),rn,"positiveTickArrayBitmap"),_(_(I(),8),rn,"negativeTickArrayBitmap")]),ad=W([I(),U("bump"),O("owner"),O("poolId"),O("positionId"),O("nftAccount"),_(I(),8)]),Br=W([Q(8),U("bump"),O("lockOwner"),O("poolId"),O("positionId"),O("nftAccount"),O("lockNftMint"),I("recentEpoch"),_(I(),8)]);Qn.span;var Ed=j("Raydium_Clmm");var Kr=j("Raydium_cpmm"),xe={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function $n(n,t,e,i,s,r,a,o,l,p,b,u,d,c,y,f,m,T,A,B){let P=W([I("amountMaxA"),I("amountMaxB"),I("openTime")]),g=Yt(n,e,r,a).publicKey,w=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!s.equals(g),isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:Jn,isSigner:!1,isWritable:!1},{pubkey:An,isSigner:!1,isWritable:!1},{pubkey:rt,isSigner:!1,isWritable:!1}],h=Buffer.alloc(P.span);return P.encode({amountMaxA:T,amountMaxB:A,openTime:B},h),new he({keys:w,programId:n,data:Buffer.from([...xe.initialize,...h])})}function ei(n,t,e,i,s,r,a,o,l,p,b,u,d,c,y){let f=W([I("lpAmount"),I("amountMaxA"),I("amountMaxB")]),m=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0}],T=Buffer.alloc(f.span);return Kr.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:c.toString(),amountMaxB:y.toString()}),f.encode({lpAmount:d,amountMaxA:c,amountMaxB:y},T),new he({keys:m,programId:n,data:Buffer.from([...xe.deposit,...T])})}function ti(n,t,e,i,s,r,a,o,l,p,b,u,d,c,y){let f=W([I("lpAmount"),I("amountMinA"),I("amountMinB")]),m=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:it,isSigner:!1,isWritable:!1}],T=Buffer.alloc(f.span);return f.encode({lpAmount:d,amountMinA:c,amountMinB:y},T),new he({keys:m,programId:n,data:Buffer.from([...xe.withdraw,...T])})}function ni(n,t,e,i,s,r,a,o,l,p,b,u,d,c,y,f){let m=W([I("amountIn"),I("amounOutMin")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0}],A=Buffer.alloc(m.span);return m.encode({amountIn:y,amounOutMin:f},A),new he({keys:T,programId:n,data:Buffer.from([...xe.swapBaseInput,...A])})}function ii(n,t,e,i,s,r,a,o,l,p,b,u,d,c,y,f){let m=W([I("amountInMax"),I("amountOut")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0}],A=Buffer.alloc(m.span);return m.encode({amountInMax:y,amountOut:f},A),new he({keys:T,programId:n,data:Buffer.from([...xe.swapBaseOutput,...A])})}async function ri(n){var m;let{ownerInfo:t,poolInfo:e,poolKeys:i,feeNftOwner:s,getEphemeralSigners:r}=n,a=[],[o,l]=[new tt(e.id),new tt(e.lpMint.address)],p;if(r)p=new tt((await r(1))[0]);else{let T=Sr.generate();a.push(T),p=T.publicKey}let{publicKey:b}=te(s,p,ye),{publicKey:u}=en(p),{publicKey:d}=Qe(n.lockProgram,p),{publicKey:c}=te(t.wallet,l,ye),{publicKey:y}=te(n.lockAuthProgram,l,ye),f=Lr({programId:n.lockProgram,auth:n.lockAuthProgram,payer:t.feePayer,liquidityOwner:t.wallet,nftOwner:s,nftMint:p,nftAccount:b,poolId:o,lockPda:d,mintLp:l,userLpVault:c,lockLpVault:y,poolVaultA:new tt(i.vault.A),poolVaultB:new tt(i.vault.B),metadataAccount:u,lpAmount:n.lpAmount,withMetadata:(m=n.withMetadata)!=null?m:!0});return{address:{nftMint:p,nftAccount:b,metadataAccount:u,lockPda:d,userLpVault:c,lockLpVault:y},instructions:[f],signers:a,instructionTypes:[Y.CpmmLockLp],lookupTableAddress:[]}}function Lr({programId:n,auth:t,payer:e,liquidityOwner:i,nftOwner:s,nftMint:r,nftAccount:a,poolId:o,lockPda:l,mintLp:p,userLpVault:b,lockLpVault:u,poolVaultA:d,poolVaultB:c,metadataAccount:y,lpAmount:f,withMetadata:m}){let T=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:rt,isSigner:!1,isWritable:!1},{pubkey:Cr.programId,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:Jn,isSigner:!1,isWritable:!1},{pubkey:Ie,isSigner:!1,isWritable:!1}],A=W([I("lpAmount"),Te("withMetadata")]),B=Buffer.alloc(A.span);A.encode({lpAmount:f,withMetadata:m},B);let P=Buffer.from([...xe.lockCpLiquidity,...B]);return new he({keys:T,programId:n,data:P})}function sn({programId:n,nftOwner:t,auth:e,nftAccount:i,lockPda:s,poolId:r,mintLp:a,userVaultA:o,userVaultB:l,poolVaultA:p,poolVaultB:b,mintA:u,mintB:d,lockLpVault:c,lpFeeAmount:y,cpmmProgram:f,cpmmAuthProgram:m}){let T=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:f!=null?f:Sn,isSigner:!1,isWritable:!1},{pubkey:m!=null?m:Cn,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1}],A=W([I("lpFeeAmount")]),B=Buffer.alloc(A.span);A.encode({lpFeeAmount:y},B);let P=Buffer.from([...xe.collectCpFee,...B]);return new he({keys:T,programId:n,data:P})}var oi=W([Q(8),U("bump"),Te("disableCreatePool"),ke("index"),I("tradeFeeRate"),I("protocolFeeRate"),I("fundFeeRate"),I("createPoolFee"),O("protocolOwner"),O("fundOwner"),_(I(),16)]),si=W([Q(8),O("configId"),O("poolCreator"),O("vaultA"),O("vaultB"),O("mintLp"),O("mintA"),O("mintB"),O("mintProgramA"),O("mintProgramB"),O("observationId"),U("bump"),U("status"),U("lpDecimals"),U("mintDecimalA"),U("mintDecimalB"),I("lpAmount"),I("protocolFeesMintA"),I("protocolFeesMintB"),I("fundFeesMintA"),I("fundFeesMintB"),I("openTime"),_(I(),32)]);var an=class extends Me{constructor(t){super(t)}async load(){this.checkDisabled()}async getCpmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async getRpcPoolInfo(t,e){return(await this.getRpcPoolInfos([t],e))[t]}async getRpcPoolInfos(t,e){let i=await Ae(this.scope.connection,t.map(u=>({pubkey:new k(u)}))),s={},r=new Set,a=[];for(let u=0;u<t.length;u++){let d=i[u];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(t[u]));let c=si.decode(d.accountInfo.data);s[String(t[u])]=G(E({},c),{programId:d.accountInfo.owner}),r.add(String(c.configId)),a.push(c.vaultA,c.vaultB)}let o={};if(e){let u=[...r],d=await Ae(this.scope.connection,u.map(c=>({pubkey:new k(c)})));for(let c=0;c<u.length;c++){let y=d[c].accountInfo;if(y===null)throw Error("fetch pool config error: "+u[c]);o[u[c]]=oi.decode(y.data)}}let l={},p=await Ae(this.scope.connection,a.map(u=>({pubkey:new k(u)})));for(let u=0;u<a.length;u++){let d=p[u].accountInfo;if(d===null)throw Error("fetch vault info error: "+a[u]);l[String(a[u])]=new H(Rr.decode(d.data).amount.toString())}let b={};for(let[u,d]of Object.entries(s)){let c=l[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),y=l[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);b[u]=G(E({},d),{baseReserve:c,quoteReserve:y,vaultAAmount:l[d.vaultA.toString()],vaultBAmount:l[d.vaultB.toString()],configInfo:o[d.configId.toString()],poolPrice:new ie(y.toString()).div(new ie(10).pow(d.mintDecimalB)).div(new ie(c.toString()).div(new ie(10).pow(d.mintDecimalA)))})}return b}toComputePoolInfos({pools:t,mintInfos:e}){return Object.keys(t).reduce((i,s)=>{var l,p,b,u;let r=t[s],[a,o]=[r.mintA.toBase58(),r.mintB.toBase58()];return G(E({},i),{[s]:G(E({},r),{id:new k(s),configInfo:r.configInfo,version:7,authority:Bt(r.programId).publicKey,mintA:Be({address:a,decimals:r.mintDecimalA,programId:r.mintProgramA.toBase58(),extensions:{feeConfig:(l=e[a])!=null&&l.feeConfig?Fe((p=e[a])==null?void 0:p.feeConfig):void 0}}),mintB:Be({address:o,decimals:r.mintDecimalB,programId:r.mintProgramB.toBase58(),extensions:{feeConfig:(b=e[o])!=null&&b.feeConfig?Fe((u=e[o])==null?void 0:u.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(t){let e=await this.getRpcPoolInfo(t,!0),i=await Lt({connection:this.scope.connection,mints:[e.mintA,e.mintB]}),s=Be({address:e.mintA.toBase58(),decimals:e.mintDecimalA,programId:e.mintProgramA.toBase58(),extensions:{feeConfig:i[e.mintA.toBase58()].feeConfig?Fe(i[e.mintA.toBase58()].feeConfig):void 0}}),r=Be({address:e.mintB.toBase58(),decimals:e.mintDecimalB,programId:e.mintProgramB.toBase58(),extensions:{feeConfig:i[e.mintB.toBase58()].feeConfig?Fe(i[e.mintB.toBase58()].feeConfig):void 0}}),a=Be({address:e.mintLp.toBase58(),decimals:e.lpDecimals,programId:$.toBase58()}),o={id:e.configId.toBase58(),index:e.configInfo.index,protocolFeeRate:e.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:e.configInfo.tradeFeeRate.toNumber(),fundFeeRate:e.configInfo.fundFeeRate.toNumber(),createPoolFee:e.configInfo.createPoolFee.toString()},l={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:e.programId.toBase58(),id:t,type:"Standard",lpMint:a,lpPrice:0,lpAmount:e.lpAmount.toNumber(),config:o,mintA:s,mintB:r,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:e.poolPrice.toNumber(),mintAmountA:new ie(e.vaultAAmount.toString()).div(10**s.decimals).toNumber(),mintAmountB:new ie(e.vaultBAmount.toString()).div(10**r.decimals).toNumber(),feeRate:e.configInfo.tradeFeeRate.toNumber(),openTime:e.openTime.toString(),tvl:0,burnPercent:0,day:l,week:l,month:l,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:e.programId.toBase58(),id:t,mintA:s,mintB:r,openTime:e.openTime.toString(),vault:{A:e.vaultA.toBase58(),B:e.vaultB.toBase58()},authority:Bt(e.programId).publicKey.toBase58(),mintLp:a,config:o,observationId:Ye(e.programId,new k(t)).publicKey.toBase58()},rpcData:e}}async createPool(y){var f=y,{poolId:t,programId:e,poolFeeAccount:i,startTime:s,ownerInfo:r,associatedOnly:a=!1,checkCreateATAOwner:o=!1,txVersion:l,feeConfig:p,computeBudgetConfig:b,txTipConfig:u,feePayer:d}=f,c=me(f,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig","txTipConfig","feePayer"]);var V,Z,re;let m=r.feePayer||((V=this.scope.owner)==null?void 0:V.publicKey),T=new H(new k(c.mintA.address).toBuffer()).lte(new H(new k(c.mintB.address).toBuffer())),[A,B]=T?[c.mintA,c.mintB]:[c.mintB,c.mintA],[P,g]=T?[c.mintAAmount,c.mintBAmount]:[c.mintBAmount,c.mintAAmount],w=r.useSOLBalance&&A.address===It.toBase58(),h=r.useSOLBalance&&B.address===It.toBase58(),[x,N]=[new k(A.address),new k(B.address)],S=this.createTxBuilder(d),{account:M,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:x,tokenProgram:A.programId,owner:this.scope.ownerPubKey,createInfo:w?{payer:m,amount:P}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:a,checkCreateATAOwner:o});S.addInstruction(R||{});let{account:F,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:new k(B.address),tokenProgram:B.programId,owner:this.scope.ownerPubKey,createInfo:h?{payer:m,amount:g}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:a,checkCreateATAOwner:o});if(S.addInstruction(v||{}),M===void 0||F===void 0)throw Error("you don't has some token account");let D=Wn({poolId:t,programId:e,configId:new k(p.id),mintA:x,mintB:N});return S.addInstruction({instructions:[$n(e,this.scope.ownerPubKey,new k(p.id),D.authority,D.poolId,x,N,D.lpMint,M,F,te(this.scope.ownerPubKey,D.lpMint).publicKey,D.vaultA,D.vaultB,i,new k((Z=A.programId)!=null?Z:$),new k((re=B.programId)!=null?re:$),D.observationId,P,g,s)],instructionTypes:[Y.CpmmCreatePool]}),S.addCustomComputeBudget(b),S.addTipInstruction(u),S.versionBuild({txVersion:l,extInfo:{address:G(E({},D),{mintA:A,mintB:B,programId:e,poolFeeAccount:i,feeConfig:p})}})}async addLiquidity(t){let{poolInfo:e,poolKeys:i,inputAmount:s,baseIn:r,slippage:a,computeResult:o,computeBudgetConfig:l,txTipConfig:p,config:b,txVersion:u,feePayer:d}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),s.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:s.toString()});let{account:c}=this.scope,{bypassAssociatedCheck:y,checkCreateATAOwner:f}=E({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},b),m=o?void 0:await this.getRpcPoolInfo(e.id),{liquidity:T,inputAmountFee:A,anotherAmount:B}=o||this.computePairAmount({poolInfo:G(E({},e),{lpAmount:new ie(m.lpAmount.toString()).div(10**e.lpMint.decimals).toNumber()}),baseReserve:m.baseReserve,quoteReserve:m.quoteReserve,slippage:new ee(0),baseIn:r,epochInfo:await this.scope.fetchEpochInfo(),amount:new ie(s.toString()).div(10**(r?e.mintA.decimals:e.mintB.decimals))}),P=B.amount,g=e.mintA.address===It.toString(),w=e.mintB.address===It.toString(),h=this.createTxBuilder(d),[x,N]=[new k(e.mintA.address),new k(e.mintB.address)],{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new k(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:g||(r?s:P).isZero()?{payer:this.scope.ownerPubKey,amount:r?s:P}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:!1,checkCreateATAOwner:f});h.addInstruction(M||{});let{account:R,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new k(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||(r?P:s).isZero()?{payer:this.scope.ownerPubKey,amount:r?P:s}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:!1,checkCreateATAOwner:f});h.addInstruction(F||{}),!S&&!R&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",c.tokenAccounts);let v=await c.getCreatedTokenAccount({mint:new k(e.lpMint.address)}),ge=await c.handleTokenAccount({side:"out",amount:0,mint:new k(e.lpMint.address),tokenAccount:v,bypassAssociatedCheck:y,checkCreateATAOwner:f}),{tokenAccount:D}=ge,V=me(ge,["tokenAccount"]);h.addInstruction(V);let Z=i!=null?i:await this.getCpmmPoolKeys(e.id),re=new ee(new H(1)).sub(a);return h.addInstruction({instructions:[ei(new k(e.programId),this.scope.ownerPubKey,new k(Z.authority),new k(e.id),D,S,R,new k(Z.vault.A),new k(Z.vault.B),x,N,new k(e.lpMint.address),o?o==null?void 0:o.liquidity:re.mul(T).quotient,r?A.amount:P,r?P:A.amount)],instructionTypes:[Y.CpmmAddLiquidity],lookupTableAddress:Z.lookupTableAccount?[Z.lookupTableAccount]:[]}),h.addCustomComputeBudget(l),h.addTipInstruction(p),h.versionBuild({txVersion:u})}async withdrawLiquidity(t){var V,Z;let{poolInfo:e,poolKeys:i,lpAmount:s,slippage:r,computeBudgetConfig:a,txTipConfig:o,txVersion:l,feePayer:p,closeWsol:b=!0}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=new ee(new H(1)).sub(r),d=await this.getRpcPoolInfo(e.id),[c,y]=[u.mul(s.mul(d.baseReserve).div(d.lpAmount)).quotient,u.mul(s.mul(d.quoteReserve).div(d.lpAmount)).quotient],f=await this.scope.fetchEpochInfo(),[m,T]=[ce(c,e.mintA.extensions.feeConfig,f,!1),ce(y,e.mintB.extensions.feeConfig,f,!1)],{account:A}=this.scope,B=this.createTxBuilder(p),[P,g]=[new k(e.mintA.address),new k(e.mintB.address)],w=P.equals(J),h=g.equals(J),x,N,{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new k(e.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(w&&b),associatedOnly:!w,checkCreateATAOwner:!1});x=S,M&&B.addInstruction(M);let{account:R,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new k(e.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(h&&b),associatedOnly:!h,checkCreateATAOwner:!1});N=R,F&&B.addInstruction(F),(!x||!N)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",A.tokenAccounts);let v=await A.getCreatedTokenAccount({mint:new k(e.lpMint.address)});v||this.logAndCreateError("cannot found lp token account","tokenAccounts",A.tokenAccounts);let D=i!=null?i:await this.getCpmmPoolKeys(e.id);return B.addInstruction({instructions:[ti(new k(e.programId),this.scope.ownerPubKey,new k(D.authority),new k(e.id),v,x,N,new k(D.vault.A),new k(D.vault.B),P,g,new k(e.lpMint.address),s,c.sub((V=m.fee)!=null?V:new H(0)),y.sub((Z=T.fee)!=null?Z:new H(0)))],instructionTypes:[Y.CpmmWithdrawLiquidity],lookupTableAddress:D.lookupTableAccount?[D.lookupTableAccount]:[]}),B.addCustomComputeBudget(a),B.addTipInstruction(o),B.versionBuild({txVersion:l})}async swap(t){var M,R,F,v,D,V;let{poolInfo:e,poolKeys:i,baseIn:s,fixedOut:r,inputAmount:a,swapResult:o,slippage:l=0,config:p,computeBudgetConfig:b,txTipConfig:u,txVersion:d,feePayer:c}=t,{bypassAssociatedCheck:y,checkCreateATAOwner:f,associatedOnly:m}=E({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},p),T=this.createTxBuilder(c),[A,B]=[new k(e.mintA.address),new k(e.mintB.address)];r?o.sourceAmountSwapped=o.sourceAmountSwapped.mul(new H((1+l)*1e4)).div(new H(1e4)):o.destinationAmountSwapped=o.destinationAmountSwapped.mul(new H((1-l)*1e4)).div(new H(1e4));let P=e.mintA.address===J.toBase58(),g=e.mintB.address===J.toBase58(),{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:A,tokenProgram:new k((M=e.mintA.programId)!=null?M:$),owner:this.scope.ownerPubKey,createInfo:P||!s?{payer:this.scope.ownerPubKey,amount:s?o.sourceAmountSwapped:0}:void 0,notUseTokenAccount:P,skipCloseAccount:!P,associatedOnly:P?!1:m,checkCreateATAOwner:f});h&&T.addInstruction(h);let{account:x,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:B,tokenProgram:new k((R=e.mintB.programId)!=null?R:$),owner:this.scope.ownerPubKey,createInfo:g||s?{payer:this.scope.ownerPubKey,amount:s?0:o.sourceAmountSwapped}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:m,checkCreateATAOwner:f});N&&T.addInstruction(N),(!w||!x)&&this.logAndCreateError("user do not have token account",{mintA:e.mintA.symbol||e.mintA.address,mintB:e.mintB.symbol||e.mintB.address,mintATokenAcc:w,mintBTokenAcc:x,mintAUseSOLBalance:P,mintBUseSOLBalance:g,associatedOnly:m});let S=i!=null?i:await this.getCpmmPoolKeys(e.id);return T.addInstruction({instructions:[r?ii(new k(e.programId),this.scope.ownerPubKey,new k(S.authority),new k(S.config.id),new k(e.id),s?w:x,s?x:w,new k(S.vault[s?"A":"B"]),new k(S.vault[s?"B":"A"]),new k((D=e[s?"mintA":"mintB"].programId)!=null?D:$),new k((V=e[s?"mintB":"mintA"].programId)!=null?V:$),s?A:B,s?B:A,Ye(new k(e.programId),new k(e.id)).publicKey,o.sourceAmountSwapped,o.destinationAmountSwapped):ni(new k(e.programId),this.scope.ownerPubKey,new k(S.authority),new k(S.config.id),new k(e.id),s?w:x,s?x:w,new k(S.vault[s?"A":"B"]),new k(S.vault[s?"B":"A"]),new k((F=e[s?"mintA":"mintB"].programId)!=null?F:$),new k((v=e[s?"mintB":"mintA"].programId)!=null?v:$),s?A:B,s?B:A,Ye(new k(e.programId),new k(e.id)).publicKey,a,o.destinationAmountSwapped)],instructionTypes:[r?Y.CpmmSwapBaseOut:Y.ClmmSwapBaseIn]}),T.addCustomComputeBudget(b),T.addTipInstruction(u),T.versionBuild({txVersion:d})}async lockLp(t){var d,c,y,f,m;let{poolInfo:e,lpAmount:i,computeBudgetConfig:s,txTipConfig:r,txVersion:a,feePayer:o,feeNftOwner:l}=t;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let p=this.createTxBuilder(o),b=(d=t.poolKeys)!=null?d:await this.getCpmmPoolKeys(e.id),u=await ri({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(c=t.feePayer)!=null?c:this.scope.ownerPubKey},feeNftOwner:l!=null?l:this.scope.ownerPubKey,lockProgram:(y=t.programId)!=null?y:mt,lockAuthProgram:(f=t.authProgram)!=null?f:dt,lpAmount:i,withMetadata:(m=t.withMetadata)!=null?m:!0,getEphemeralSigners:t.getEphemeralSigners});return p.addInstruction(u),p.addCustomComputeBudget(s),p.addTipInstruction(r),p.versionBuild({txVersion:a,extInfo:u.address})}async harvestLockLp(t){var R;let{poolInfo:e,lpFeeAmount:i,nftMint:s,programId:r=mt,authProgram:a=dt,cpmmProgram:o,computeBudgetConfig:l,txTipConfig:p,txVersion:b,closeWsol:u=!0}=t;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let d=t.feePayer||this.scope.ownerPubKey,c=this.createTxBuilder(d),[y,f]=[new k(e.mintA.address),new k(e.mintB.address)],m=y.equals(J),T=f.equals(J),A,B,{account:P,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new k(e.mintA.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(m&&u),associatedOnly:!m,checkCreateATAOwner:!1});A=P,g&&c.addInstruction(g);let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new k(e.mintB.address),notUseTokenAccount:T,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(T&&u),associatedOnly:!T,checkCreateATAOwner:!1});B=w,h&&c.addInstruction(h),(!A||!B)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:A,tokenAccountB:B});let x=(R=t.poolKeys)!=null?R:await this.getCpmmPoolKeys(e.id),{publicKey:N}=te(d,s,$),{publicKey:S}=Qe(r,s),{publicKey:M}=te(a,new k(e.lpMint.address),$);return c.addInstruction({instructions:[sn({programId:r,nftOwner:this.scope.ownerPubKey,auth:a,nftMint:s,nftAccount:N,lockPda:S,poolId:new k(e.id),mintLp:new k(x.mintLp.address),userVaultA:A,userVaultB:B,poolVaultA:new k(x.vault.A),poolVaultB:new k(x.vault.B),mintA:y,mintB:f,lockLpVault:M,lpFeeAmount:i,cpmmProgram:o==null?void 0:o.programId,cpmmAuthProgram:o==null?void 0:o.authProgram})],instructionTypes:[Y.CpmmCollectLockFee]}),c.addCustomComputeBudget(l),c.addTipInstruction(p),c.versionBuild({txVersion:b})}async harvestMultiLockLp(t){let{lockInfo:e,programId:i=mt,authProgram:s=dt,cpmmProgram:r,computeBudgetConfig:a,txVersion:o,closeWsol:l=!0}=t,p=t.feePayer||this.scope.ownerPubKey,b=this.createTxBuilder(p),u={};return e.forEach(async d=>{var S;let{poolInfo:c,lpFeeAmount:y,nftMint:f}=d;if(y.isZero())return;let[m,T]=[new k(c.mintA.address),new k(c.mintB.address)],A=m.equals(J),B=T.equals(J),P=u[c.mintA.address],g=u[c.mintB.address];if(!P)if(A){let{account:M,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.mintA.programId,mint:new k(c.mintA.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!l,associatedOnly:!1,checkCreateATAOwner:!1});P=M,R&&b.addInstruction(R),u[c.mintA.address]=M}else{let M=new k(c.mintA.address);P=this.scope.account.getAssociatedTokenAccount(M,new k(c.mintA.programId)),b.addInstruction({instructions:[ai(this.scope.ownerPubKey,P,this.scope.ownerPubKey,M)]}),u[c.mintA.address]=P}if(!g)if(B){let{account:M,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.mintB.programId,mint:new k(c.mintB.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!l,associatedOnly:!1,checkCreateATAOwner:!1});g=M,R&&b.addInstruction(R),u[c.mintB.address]=M}else{let M=new k(c.mintB.address);g=this.scope.account.getAssociatedTokenAccount(M,new k(c.mintB.programId)),b.addInstruction({instructions:[ai(this.scope.ownerPubKey,g,this.scope.ownerPubKey,M)]}),u[c.mintB.address]=g}(!P||!g)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:P,tokenAccountB:g});let w=(S=d.poolKeys)!=null?S:await this.getCpmmPoolKeys(c.id),{publicKey:h}=te(p,f,$),{publicKey:x}=Qe(i,f),{publicKey:N}=te(s,new k(c.lpMint.address),$);b.addInstruction({instructions:[sn({programId:i,nftOwner:this.scope.ownerPubKey,auth:s,nftMint:f,nftAccount:h,lockPda:x,poolId:new k(c.id),mintLp:new k(w.mintLp.address),userVaultA:P,userVaultB:g,poolVaultA:new k(w.vault.A),poolVaultB:new k(w.vault.B),mintA:m,mintB:T,lockLpVault:N,lpFeeAmount:y,cpmmProgram:r==null?void 0:r.programId,cpmmAuthProgram:r==null?void 0:r.authProgram})],instructionTypes:[Y.CpmmCollectLockFee]})}),o===0?b.sizeCheckBuildV0({computeBudgetConfig:a}):b.sizeCheckBuild({computeBudgetConfig:a})}computeSwapAmount({pool:t,amountIn:e,outputMint:i,slippage:s}){let r=i.toString()===t.mintB.address,a=kt.swap(e,r?t.baseReserve:t.quoteReserve,r?t.quoteReserve:t.baseReserve,t.configInfo.tradeFeeRate),o=new ie(a.destinationAmountSwapped.toString()).div(a.sourceAmountSwapped.toString()),l=a.destinationAmountSwapped.mul(new H((1-s)*1e4)).div(new H(1e4));return{allTrade:a.sourceAmountSwapped.eq(e),amountIn:e,amountOut:a.destinationAmountSwapped,minAmountOut:l,executionPrice:o,fee:a.tradeFee,priceImpact:t.poolPrice.sub(o).div(t.poolPrice)}}computePairAmount({poolInfo:t,baseReserve:e,quoteReserve:i,amount:s,slippage:r,epochInfo:a,baseIn:o}){var P,g,w,h,x,N,S,M,R;let l=1-Number(r.toSignificant())/100,p=new H(new ie(s).mul(10**t[o?"mintA":"mintB"].decimals).mul(l).toFixed(0)),b=ce(p,t[o?"mintA":"mintB"].extensions.feeConfig,a,!1),u=p.sub((P=b.fee)!=null?P:new H(0)),d=new H(new ie(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,ie.ROUND_DOWN));this.logDebug("baseReserve:",e.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",o?t.mintA.symbol:t.mintB.symbol,"amountIn:",p.toString(),"amountInFee:",(w=(g=b.fee)==null?void 0:g.toString())!=null?w:0,"anotherToken:",o?t.mintB.symbol:t.mintA.symbol,"slippage:",`${r.toSignificant()}%`);let c=o?"base":"quote";this.logDebug("input side:",c);let y=u.mul(d).div(c==="base"?e:i),f={amount:Wt,fee:void 0,expirationTime:void 0};if(!u.isZero()){let F=Nr(y,e,i,d);this.logDebug("lpAmountData:",{amountA:F.amountA.toString(),amountB:F.amountB.toString()}),f=ce(F[o?"amountB":"amountA"],t[o?"mintB":"mintA"].extensions.feeConfig,a,!0)}let m=new ee(new H(1)).add(r),T=new ee(new H(1)).sub(r),A=ce(m.mul(f.amount.sub((h=f.fee)!=null?h:new H(0))).quotient,t[o?"mintB":"mintA"].extensions.feeConfig,a,!0),B=ce(T.mul(f.amount.sub((x=f.fee)!=null?x:new H(0))).quotient,t[o?"mintB":"mintA"].extensions.feeConfig,a,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(S=(N=f.fee)==null?void 0:N.toString())!=null?S:0,"maxAnotherAmount:",A.amount.toString(),"maxAnotherAmountFee:",(R=(M=A.fee)==null?void 0:M.toString())!=null?R:0),{inputAmountFee:b,anotherAmount:f,maxAnotherAmount:A,minAnotherAmount:B,liquidity:y}}};function Nr(n,t,e,i){let s=n.mul(t).div(i);!s.isZero()&&!n.mul(t).mod(i).isZero()&&(s=s.add(new H(1)));let r=n.mul(e).div(i);return!r.isZero()&&!n.mul(e).mod(i).isZero()&&(r=r.add(new H(1))),{amountA:s,amountB:r}}export{an as default};
//# sourceMappingURL=cpmm.mjs.map