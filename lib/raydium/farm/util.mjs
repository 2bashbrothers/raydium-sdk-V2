var ut=Object.defineProperty,ct=Object.defineProperties;var lt=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var mt=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var Ae=(r,e,t)=>e in r?ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))mt.call(e,t)&&Ae(r,t,e[t]);if(Se)for(var t of Se(e))dt.call(e,t)&&Ae(r,t,e[t]);return r},B=(r,e)=>ct(r,lt(e));import R from"bn.js";import{PublicKey as gt}from"@solana/web3.js";import{get as Le,set as pt}from"lodash";var ie=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Be={},ft={};function A(r){let e=Le(Be,r);if(!e){let t=Le(ft,r);e=new ie({name:r,logLevel:t}),pt(Be,r,e)}return e}import{MINT_SIZE as hr,TOKEN_PROGRAM_ID as br,getTransferFeeConfig as wr,unpackMint as xr}from"@solana/spl-token";var se=A("Raydium_accountInfo_util");async function Re(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:u=100}=S({batchRequest:!1},t),m=ae(e,u),p=new Array(m.length).fill([]);if(n){let T=m.map(I=>{let P=r._buildArgs([I.map(f=>f.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:P}}),b=ae(T,10);p=(await(await Promise.all(b.map(async I=>await r._rpcBatchRequest(I)))).flat()).map(I=>(I.error&&se.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${I.error.message}`),I.result.value.map(P=>{if(P){let{data:f,executable:F,lamports:U,owner:L,rentEpoch:k}=P;return f.length!==2&&f[1]!=="base64"&&se.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:F,lamports:U,owner:new gt(L),rentEpoch:k}}return null})))}else try{p=await Promise.all(m.map(T=>r.getMultipleAccountsInfo(T,o)))}catch(T){T instanceof Error&&se.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${T.message}`)}return p.flat()}async function Ie(r,e,t){let n=await Re(r,e.map(o=>o.pubkey),t);return e.map((o,u)=>B(S({},o),{accountInfo:n[u]}))}import M from"bn.js";import oo from"decimal.js";import St from"big.js";import Q from"bn.js";import yt from"toformat";var ht=yt,G=ht;import Y from"big.js";import wt from"bn.js";import xt from"decimal.js-light";import q from"bn.js";var ke=9007199254740991;function w(r){let e=A("Raydium_parseBigNumberish");if(r instanceof q)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new q(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=ke||r<=-ke)&&e.logWithError(`BigNumberish number overflow: ${r}`),new q(String(r))):typeof r=="bigint"?new q(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new q(0))}var J=A("module/fraction"),ce=G(Y),j=G(xt),Tt={[0]:j.ROUND_DOWN,[1]:j.ROUND_HALF_UP,[2]:j.ROUND_UP},Pt={[0]:Y.roundDown,[1]:Y.roundHalfUp,[2]:Y.roundUp},d=class{constructor(e,t=new wt(1)){this.numerator=w(e),this.denominator=w(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new d(this.denominator,this.numerator)}add(e){let t=e instanceof d?e:new d(w(e));return this.denominator.eq(t.denominator)?new d(this.numerator.add(t.numerator),this.denominator):new d(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof d?e:new d(w(e));return this.denominator.eq(t.denominator)?new d(this.numerator.sub(t.numerator),this.denominator):new d(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof d?e:new d(w(e));return new d(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof d?e:new d(w(e));return new d(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||J.logWithError(`${e} is not an integer.`),e<=0&&J.logWithError(`${e} is not positive.`),j.set({precision:e+1,rounding:Tt[n]});let o=new j(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||J.logWithError(`${e} is not an integer.`),e<0&&J.logWithError(`${e} is negative.`),ce.DP=e,ce.RM=Pt[n]||1,new ce(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var At=A("Raydium_amount"),Ce=G(St);function Lt(r,e){let t="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([t,n]=o,n=n.padEnd(e,"0")):At.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var _=class extends d{constructor(t,n,o=!0,u){let m=new Q(0),p=le.pow(new Q(t.decimals));if(o)m=w(n);else{let T=new Q(0),b=new Q(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[C,I]=Lt(n.toString(),t.decimals);T=w(C),b=w(I)}T=T.mul(p),m=T.add(b)}super(m,p);this.logger=A(u||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new _(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new _(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return Ce.DP=this.token.decimals,new Ce(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Bt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Fe}from"@solana/spl-token";var _e={chainId:101,address:Bt.default.toBase58(),programId:Fe.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},E={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Fe.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as pe}from"@solana/web3.js";import{PublicKey as g,SystemProgram as Ve,SYSVAR_RENT_PUBKEY as Rt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as It}from"@solana/spl-token";function me({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var $r=[me({pubkey:It,isWritable:!1}),me({pubkey:Ve.programId,isWritable:!1}),me({pubkey:Rt,isWritable:!1})];function Me({publicKey:r,transformSol:e}){let t=de(r.toString());if(t instanceof g)return e&&t.equals(H)?ue:t;if(e&&t.toString()===H.toBase58())return ue;if(typeof t=="string"){if(t===g.default.toBase58())return g.default;try{return new g(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function de(r){try{return new g(r)}catch{return r}}var en=new g("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),tn=new g("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),rn=new g("SysvarRent111111111111111111111111111111111"),nn=new g("SysvarC1ock11111111111111111111111111111111"),on=new g("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),sn=new g("Sysvar1nstructions1111111111111111111111111"),an=Ve.programId,un=new g("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),cn=new g("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ln=new g("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),mn=new g("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),dn=new g("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),pn=new g("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),fn=new g("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),gn=new g("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),yn=new g("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),hn=new g("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),bn=new g("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ue=new g("So11111111111111111111111111111111111111112"),H=g.default;var fe=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:u=!1,isToken2022:m=!1}){if(e===H.toBase58()||e instanceof pe&&H.equals(e)){this.decimals=E.decimals,this.symbol=E.symbol,this.name=E.name,this.mint=new pe(E.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=u?pe.default:Me({publicKey:e}),this.isToken2022=m}equals(e){return this===e?!0:this.mint.equals(e.mint)}},O=fe;O.WSOL=new fe(B(S({},E),{mint:E.address}));var ge=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},$=ge;$.SOL=new ge(_e);import kt from"bn.js";var De=new d(new kt(100)),K=class extends d{toSignificant(e=5,t,n){return this.mul(De).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(De).toFixed(e,t,n)}};var Ct=A("Raydium_price"),V=class extends d{constructor(t){let{baseToken:n,quoteToken:o,numerator:u,denominator:m}=t;super(u,m);this.baseToken=n,this.quoteToken=o,this.scalar=new d(ye(n.decimals),ye(o.decimals))}get raw(){return new d(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new V({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ct.logWithError("mul token not equals");let n=super.mul(t);return new V({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};import{PublicKey as _t}from"@solana/web3.js";import Vt from"bn.js";function Ne(r){return typeof r=="object"&&r!==null&&![O,_,_t,d,Vt,V,K].some(e=>typeof e=="object"&&r instanceof e)}function ee(r){return typeof r=="string"?de(r):Array.isArray(r)?r.map(e=>ee(e)):Ne(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,ee(t)])):r}var Ft=new M(0),go=new M(1),yo=new M(2),ho=new M(3),bo=new M(5),le=new M(10),wo=new M(100),xo=new M(1e3),To=new M(1e4);function ye(r){return le.pow(w(r))}var Ee=r=>typeof r=="number";function Oe(r,e,t){let n=Ee(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()<=n}function ve(r,e,t){let n=Ee(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()>n}function ae(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as jo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zo}from"@solana/spl-token";import{ComputeBudgetProgram as ko,Keypair as _o,PublicKey as Dt,Transaction as Mo,TransactionMessage as No,VersionedTransaction as Eo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wo}from"@solana/spl-token";var Uo=A("Raydium_txUtil");function z(r,e){let[t,n]=Dt.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}import{PublicKey as s}from"@solana/web3.js";var Ke=new s("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),We=new s("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ue=new s("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ge=new s("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Yo=new s("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Qo=new s("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),$o=new s("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ei=new s("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ti=new s("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ri=new s("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ni=new s("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),oi=new s("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ii=new s("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),si=new s("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ai=new s("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ui=new s("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ci=new s("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),li=new s("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),mi=new s("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),di=new s("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),pi=new s("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),fi=new s("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),gi=new s("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),yi=new s("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),hi=new s("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),bi=new s("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),wi=new s("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),xi=new s("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ti=new s("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Pi=new s("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Si=new s("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var X={OPEN_BOOK_PROGRAM:new s("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new s("Ray1111111111111111111111111111111111111111"),AMM_V4:new s("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new s("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new s("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new s("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new s("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new s("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new s("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new s("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new s("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new s("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:s.default,Router:new s("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new s("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new s("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new s("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new s("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new s("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new s("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new s("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new s("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new s("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new s("Ray1111111111111111111111111111111111111111")};import Bi from"bn.js";import{PublicKey as Nt,AddressLookupTableAccount as qe}from"@solana/web3.js";var Et={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new qe({key:new Nt("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:qe.deserialize(Buffer.from("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","base64"))})};import{PublicKey as ji,sendAndConfirmTransaction as Hi,SystemProgram as Zi,Transaction as Ji,TransactionMessage as Qi,VersionedTransaction as $i}from"@solana/web3.js";import ts from"axios";import Ot from"bn.js";var us=new Ot(1e6);import{PublicKey as jt}from"@solana/web3.js";import Xe,{isBN as Ze}from"bn.js";import{bits as Cs,BitStructure as Fs,blob as vt,Blob as _s,cstr as Vs,f32 as Ms,f32be as Ds,f64 as Ns,f64be as Es,greedy as Os,Layout as Kt,ns64 as vs,ns64be as Ks,nu64 as Ws,nu64be as Us,offset as Gs,s16 as qs,s16be as js,s24 as Hs,s24be as zs,s32 as Xs,s32be as Zs,s40 as Js,s40be as Ys,s48 as Qs,s48be as $s,s8 as ea,seq as Wt,struct as ta,Structure as Ut,u16 as ra,u16be as na,u24 as oa,u24be as ia,u32 as sa,u32be as aa,u40 as ua,u40be as ca,u48 as la,u48be as ma,u8 as Gt,UInt as qt,union as da,Union as pa,unionLayoutDiscriminator as fa,utf8 as ga}from"@solana/buffer-layout";var he=Kt,je=Ut;var be=qt;var He=Gt;var ze=Wt;var v=vt;var W=class extends he{constructor(t,n,o){super(t,o);this.blob=v(t),this.signed=n}decode(t,n=0){let o=new Xe(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new Xe(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function x(r){return new be(1,r)}function re(r){return new be(4,r)}function i(r){return new W(8,!1,r)}function D(r){return new W(16,!1,r)}function Je(r){return new W(1,!0,r)}function ne(r){return new W(8,!0,r)}var te=class extends he{constructor(t,n,o,u){super(t.span,u);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function a(r){return new te(v(32),e=>new jt(e),e=>e.toBuffer(),r)}function xe(r){return new te(He(),Ht,zt,r)}function Ht(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function zt(r){return r?1:0}var we=class extends je{decode(e,t){return super.decode(e,t)}};function y(r,e,t){return new we(r,e,t)}function h(r,e,t){let n,o=typeof e=="number"?e:Ze(e)?e.toNumber():new Proxy(e,{get(u,m){if(!n){let p=Reflect.get(u,"count");n=Ze(p)?p.toNumber():p,Reflect.set(u,"count",n)}return Reflect.get(u,m)},set(u,m,p){return m==="count"&&(n=p),Reflect.set(u,m,p)}});return ze(r,o,t)}var Te=y([a("mint"),a("owner"),i("amount"),re("delegateOption"),a("delegate"),x("state"),re("isNativeOption"),i("isNative"),i("delegatedAmount"),re("closeAuthorityOption"),a("closeAuthority")]);import{PublicKey as Pe}from"@solana/web3.js";var Da=y([x("instruction")]),Na=y([x("instruction")]),Xt=y([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),D("accRewardPerShare"),a("rewardVault"),a("rewardMint"),a("rewardSender"),i("rewardType"),h(i(),15,"padding")]),Zt=y([i("state"),i("nonce"),a("lpVault"),a("rewardVault"),a(),a(),i(),i(),i("totalReward"),D("perShareReward"),i("lastSlot"),i("perSlotReward")]),Jt=y([i("state"),i("nonce"),a("lpVault"),a("rewardVaultA"),i("totalRewardA"),D("perShareRewardA"),i("perSlotRewardA"),x("option"),a("rewardVaultB"),v(7),i("totalRewardB"),D("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),a()]),Yt=y([i(),i("state"),i("nonce"),i("validRewardTokenNum"),D("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),a("lpMint"),a("lpVault"),h(Xt,5,"rewardInfos"),a("creator"),a(),h(i(),32,"padding")]),Ye=new Proxy(Zt,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return B(S({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,e,t)}}),Qe=new Proxy(Jt,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return B(S({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,e,t)}}),$e=new Proxy(Yt,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return B(S({},o),{version:6,rewardInfos:o.rewardInfos.map(u=>{var m;return B(S({},u),{rewardType:((m=Object.entries(oe).find(p=>String(p[1])===u.rewardType.toString()))!=null?m:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),Qt=y([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),Ea=y([x("instruction"),i("nonce"),h(Qt,5,"rewardTimeInfo")]),Oa=y([x("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),va=y([x("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),Ka=y([i("state"),a("id"),a("owner"),i("deposited"),h(i(),1,"rewardDebts")]),et=y([i("state"),a("id"),a("owner"),i("deposited"),h(D(),1,"rewardDebts"),i(""),i("voteLockedBalance"),h(i(),15)]),Wa=y([i("state"),a("id"),a("owner"),i("deposited"),h(i(),2,"rewardDebts")]),tt=y([i("state"),a("id"),a("owner"),i("deposited"),h(D(),2,"rewardDebts"),h(i(),17)]),rt=y([i(),i("state"),a("id"),a("owner"),i("deposited"),h(D(),5,"rewardDebts"),h(i(),16)]),Ua=y([x("instruction"),i("amount")]),$t=y([a("mint"),a("grantAuthority"),i("baselineVoteWeightScaledFactor"),i("maxExtraLockupVoteWeightScaledFactor"),i("lockupSaturationSecs"),Je("digitShift"),h(x(),7,"reserved1"),h(i(),7,"reserved2")]),nt=y([v(8),a("governanceProgramId"),a("realm"),a("realmGoverningTokenMint"),a("realmAuthority"),h(x(),32,"reserved1"),h($t,4,"votingMints"),ne("timeOffset"),x("bump"),h(x(),7,"reserved2"),h(i(),11,"reserved3")]),er=y([ne("startTime"),ne("endTime"),x("kind"),h(x(),15,"reserved")]),tr=y([h(er,1,"lockup"),i("amountDeposited_native"),i("amountInitiallyLockedNative"),xe("isUsed"),xe("allowClawback"),x("votingMintConfigIdx"),h(x(),29,"reserved")]),ot=y([v(8),a("voterAuthority"),a("registrar"),h(tr,32,"deposits"),x("voterBump"),x("voterWweightRecordBump"),h(x(),94,"reserved")]);import{NATIVE_MINT as Ya}from"@solana/spl-token";var Qa=A("Raydium_farm_config"),$a=new Pe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),eu=new Pe("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var tu=new Pe("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX"),it={3:Ye,5:Qe,6:$e},st={3:et,5:tt,6:rt};var oe={"Standard SPL":0,"Option tokens":1},ru={[Ke.toString()]:3,[We.toString()]:4,[Ue.toString()]:5,[Ge.toString()]:6,[X.FARM_PROGRAM_ID_V3.toString()]:3,[X.FARM_PROGRAM_ID_V4.toString()]:4,[X.FARM_PROGRAM_ID_V5.toString()]:5,[X.FARM_PROGRAM_ID_V6.toString()]:6};var Z=A("Raydium.farm.util");function hu({programId:r,poolId:e,mint:t,type:n}){let{publicKey:o}=z([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function rr({programId:r,poolId:e,owner:t,version:n}){let{publicKey:o}=z([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var bu=({programId:r,poolId:e})=>z([e.toBuffer()],r);function wu(r){return{isSet:new R(1),rewardPerSecond:w(r.perSecond),rewardOpenTime:w(r.openTime),rewardEndTime:w(r.endTime),rewardType:w(oe[r.rewardType])}}function xu(r){return w(r.endTime).sub(w(r.openTime)).mul(w(r.perSecond))}function nr(r){let e=st[r];return e||Z.logWithError("invalid version",r),e}function or(r){let e=it[r];return e||Z.logWithError("invalid version",r),e}function ir(r,e,t,n){if(r.version===3||r.version===5){if(r.lastSlot.gte(new R(t)))return r;let o=new R(t).sub(r.lastSlot);r.lastSlot=new R(t);for(let u of r.rewardInfos){if(e.amount.eq(new R(0)))continue;let m=u.perSlotReward.mul(o);u.perShareReward=u.perShareReward.add(m.mul(new R(10).pow(new R(r.version===3?9:15))).div(e.amount)),u.totalReward=u.totalReward.add(m)}}else if(r.version===6)for(let o of r.rewardInfos){if(o.rewardState.eq(new R(0)))continue;let u=R.min(new R(n),o.rewardEndTime);if(o.rewardOpenTime.gte(u))continue;let p=u.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),T=o.totalReward.sub(o.totalRewardEmissioned);T.lt(p)?(p=T,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(T.div(o.rewardPerSecond))):o.rewardLastUpdateTime=u,!e.amount.eq(new R(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(p.mul(r.rewardMultiplier).div(e.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(p))}return r}async function Tu({connection:r,farmPools:e,owner:t,config:n,chainTime:o}){let u=!1,m=!1,p=new R(10),T=[];for(let P of e){let f=ee(P);f.version===6?m=!0:u=!0,T.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),t&&T.push({pubkey:rr({programId:f.programId,poolId:f.id,owner:t,version:P.version}),version:f.version,key:"ledger",poolId:f.id})}let b={},C=await Ie(r,T,n);for(let{pubkey:P,version:f,key:F,poolId:U,accountInfo:L}of C){let k=U.toBase58();if(b[k]=S({},b[k]),F==="state"){let N=or(f);(!L||!L.data||L.data.length!==N.span)&&Z.logWithError(`invalid farm state account info, pools.id, ${P}`),b[k].state=N.decode(L.data)}else if(F==="lpVault")(!L||!L.data||L.data.length!==Te.span)&&Z.logWithError(`invalid farm lp vault account info, pools.lpVault, ${P}`),b[k].lpVault=Te.decode(L.data);else if(F==="ledger"){let N=nr(f);L&&L.data&&(L.data.length!==N.span&&Z.logWithError(`invalid farm ledger account info, ledger, ${P}`),b[k].ledger=N.decode(L.data))}}let I=m||u?await r.getSlot():0;for(let P of Object.keys(b))b[P]!==void 0&&(b[P].state=ir(b[P].state,b[P].lpVault,I,o));for(let[P,{state:f,ledger:F}]of Object.entries(b))if(F){let U=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?p.pow(new R(9)):p.pow(new R(15)),L=f.rewardInfos.map((k,N)=>{let at=F.rewardDebts[N];return F.deposited.mul(f.version===6?k.accRewardPerShare:k.perShareReward).div(U).sub(at)});b[P].wrapped=B(S({},b[P].wrapped),{pendingRewards:L})}return b}function Pu(r,e=Date.now()){if(r.version===6){let t=r.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>Oe(e,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>ve(e,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=r.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}async function Su(r,e,t,n){let o=await r.getAccountInfo(e);if(o===null)throw Error("registrar info check error");let m=nt.decode(o.data).votingMints.findIndex(C=>C.mint.equals(n));if(m===-1)throw Error("find voter mint error");let p=await r.getAccountInfo(t);if(p===null)return{index:m,isInit:!1};let b=ot.decode(p.data).deposits.findIndex(C=>C.isUsed&&C.votingMintConfigIdx===m);return b===-1?{index:m,isInit:!1}:{index:b,isInit:!0}}export{xu as calFarmRewardAmount,wu as farmRewardInfoToConfig,Tu as fetchMultipleFarmInfoAndUpdate,bu as getAssociatedAuthority,rr as getAssociatedLedgerAccount,hu as getAssociatedLedgerPoolAccount,Su as getDepositEntryIndex,nr as getFarmLedgerLayout,or as getFarmStateLayout,Pu as judgeFarmType,ir as updateFarmPoolInfo};
//# sourceMappingURL=util.mjs.map