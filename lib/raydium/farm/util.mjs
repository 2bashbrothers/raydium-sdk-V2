var st=Object.defineProperty,at=Object.defineProperties;var ut=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var Le=(n,e,t)=>e in n?st(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,S=(n,e)=>{for(var t in e||(e={}))ct.call(e,t)&&Le(n,t,e[t]);if(Se)for(var t of Se(e))lt.call(e,t)&&Le(n,t,e[t]);return n},B=(n,e)=>at(n,ut(e));import R from"bn.js";import{PublicKey as pt}from"@solana/web3.js";import{get as Ae,set as dt}from"lodash";var ie=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Be={},mt={};function L(n){let e=Ae(Be,n);if(!e){let t=Ae(mt,n);e=new ie({name:n,logLevel:t}),dt(Be,n,e)}return e}import{MINT_SIZE as gn,TOKEN_PROGRAM_ID as yn,getTransferFeeConfig as hn,unpackMint as bn}from"@solana/spl-token";var se=L("Raydium_accountInfo_util");async function Re(n,e,t){let{batchRequest:r,commitment:o="confirmed",chunkCount:u=100}=S({batchRequest:!1},t),d=ae(e,u),p=new Array(d.length).fill([]);if(r){let x=d.map(I=>{let P=n._buildArgs([I.map(f=>f.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:P}}),b=ae(x,10);p=(await(await Promise.all(b.map(async I=>await n._rpcBatchRequest(I)))).flat()).map(I=>(I.error&&se.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${I.error.message}`),I.result.value.map(P=>{if(P){let{data:f,executable:C,lamports:U,owner:A,rentEpoch:k}=P;return f.length!==2&&f[1]!=="base64"&&se.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:C,lamports:U,owner:new pt(A),rentEpoch:k}}return null})))}else try{p=await Promise.all(d.map(x=>n.getMultipleAccountsInfo(x,o)))}catch(x){x instanceof Error&&se.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${x.message}`)}return p.flat()}async function Ie(n,e,t){let r=await Re(n,e.map(o=>o.pubkey),t);return e.map((o,u)=>B(S({},o),{accountInfo:r[u]}))}import M from"bn.js";import Xr from"decimal.js";import xt from"big.js";import Q from"bn.js";import ft from"toformat";var gt=ft,q=gt;import Z from"big.js";import ht from"bn.js";import bt from"decimal.js-light";import G from"bn.js";var ke=9007199254740991;function w(n){let e=L("Raydium_parseBigNumberish");if(n instanceof G)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new G(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=ke||n<=-ke)&&e.logWithError(`BigNumberish number overflow: ${n}`),new G(String(n))):typeof n=="bigint"?new G(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new G(0))}var X=L("module/fraction"),ce=q(Z),H=q(bt),wt={[0]:H.ROUND_DOWN,[1]:H.ROUND_HALF_UP,[2]:H.ROUND_UP},Tt={[0]:Z.roundDown,[1]:Z.roundHalfUp,[2]:Z.roundUp},m=class{constructor(e,t=new ht(1)){this.numerator=w(e),this.denominator=w(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new m(this.denominator,this.numerator)}add(e){let t=e instanceof m?e:new m(w(e));return this.denominator.eq(t.denominator)?new m(this.numerator.add(t.numerator),this.denominator):new m(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof m?e:new m(w(e));return this.denominator.eq(t.denominator)?new m(this.numerator.sub(t.numerator),this.denominator):new m(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof m?e:new m(w(e));return new m(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof m?e:new m(w(e));return new m(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||X.logWithError(`${e} is not an integer.`),e<=0&&X.logWithError(`${e} is not positive.`),H.set({precision:e+1,rounding:wt[r]});let o=new H(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||X.logWithError(`${e} is not an integer.`),e<0&&X.logWithError(`${e} is negative.`),ce.DP=e,ce.RM=Tt[r]||1,new ce(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Pt=L("Raydium_amount"),_e=q(xt);function St(n,e){let t="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([t,r]=o,r=r.padEnd(e,"0")):Pt.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var F=class extends m{constructor(t,r,o=!0,u){let d=new Q(0),p=le.pow(new Q(t.decimals));if(o)d=w(r);else{let x=new Q(0),b=new Q(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[_,I]=St(r.toString(),t.decimals);x=w(_),b=w(I)}x=x.mul(p),d=x.add(b)}super(d,p);this.logger=L(u||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new F(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new F(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,o=0){return super.toSignificant(t,r,o)}toFixed(t=this.token.decimals,r,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,o)}toExact(t={groupSeparator:""}){return _e.DP=this.token.decimals,new _e(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Lt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ce}from"@solana/spl-token";var Fe={chainId:101,address:Lt.default.toBase58(),programId:Ce.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},E={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ce.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as pe}from"@solana/web3.js";import{PublicKey as g,SystemProgram as Ve,SYSVAR_RENT_PUBKEY as At}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bt}from"@solana/spl-token";function de({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Zn=[de({pubkey:Bt,isWritable:!1}),de({pubkey:Ve.programId,isWritable:!1}),de({pubkey:At,isWritable:!1})];function Me({publicKey:n,transformSol:e}){let t=me(n.toString());if(t instanceof g)return e&&t.equals(j)?ue:t;if(e&&t.toString()===j.toBase58())return ue;if(typeof t=="string"){if(t===g.default.toBase58())return g.default;try{return new g(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function me(n){try{return new g(n)}catch{return n}}var Qn=new g("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),$n=new g("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),er=new g("SysvarRent111111111111111111111111111111111"),tr=new g("SysvarC1ock11111111111111111111111111111111"),nr=new g("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),rr=new g("Sysvar1nstructions1111111111111111111111111"),or=Ve.programId,ir=new g("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),sr=new g("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ar=new g("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ur=new g("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),cr=new g("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),lr=new g("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),dr=new g("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),mr=new g("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),pr=new g("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),fr=new g("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),gr=new g("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ue=new g("So11111111111111111111111111111111111111112"),j=g.default;var fe=class{constructor({mint:e,decimals:t,symbol:r,name:o,skipMint:u=!1,isToken2022:d=!1}){if(e===j.toBase58()||e instanceof pe&&j.equals(e)){this.decimals=E.decimals,this.symbol=E.symbol,this.name=E.name,this.mint=new pe(E.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=u?pe.default:Me({publicKey:e}),this.isToken2022=d}equals(e){return this===e?!0:this.mint.equals(e.mint)}},v=fe;v.WSOL=new fe(B(S({},E),{mint:E.address}));var ge=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},$=ge;$.SOL=new ge(Fe);import Rt from"bn.js";var De=new m(new Rt(100)),K=class extends m{toSignificant(e=5,t,r){return this.mul(De).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(De).toFixed(e,t,r)}};var It=L("Raydium_price"),V=class extends m{constructor(t){let{baseToken:r,quoteToken:o,numerator:u,denominator:d}=t;super(u,d);this.baseToken=r,this.quoteToken=o,this.scalar=new m(ye(r.decimals),ye(o.decimals))}get raw(){return new m(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new V({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&It.logWithError("mul token not equals");let r=super.mul(t);return new V({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(t,r,o)}toFixed(t=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(t,r,o)}};var kt=new M(0),io=new M(1),so=new M(2),ao=new M(3),uo=new M(5),le=new M(10),co=new M(100),lo=new M(1e3),mo=new M(1e4);function ye(n){return le.pow(w(n))}var Ne=n=>typeof n=="number";function Ee(n,e,t){let r=Ne(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(n).getTime()<=r}function ve(n,e,t){let r=Ne(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(n).getTime()>r}function ae(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}import{PublicKey as No}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vo}from"@solana/spl-token";import{ComputeBudgetProgram as To,Keypair as So,PublicKey as Ct,Transaction as Ao,TransactionMessage as Ro,VersionedTransaction as Io}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Fo}from"@solana/spl-token";var Vo=L("Raydium_txUtil");function z(n,e){let[t,r]=Ct.findProgramAddressSync(n,e);return{publicKey:t,nonce:r}}import{PublicKey as s}from"@solana/web3.js";var Oe=new s("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ke=new s("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),We=new s("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ue=new s("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Uo=new s("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),qo=new s("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Go=new s("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ho=new s("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),jo=new s("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),zo=new s("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Yo=new s("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Jo=new s("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Xo=new s("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Zo=new s("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Qo=new s("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$o=new s("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ei=new s("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ti=new s("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ni=new s("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ri=new s("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),oi=new s("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ii=new s("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),si=new s("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ai=new s("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ui=new s("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ci=new s("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),li=new s("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),di=new s("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),mi=new s("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),pi=new s("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),fi=new s("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Y={OPEN_BOOK_PROGRAM:new s("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new s("Ray1111111111111111111111111111111111111111"),AMM_V4:new s("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new s("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new s("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new s("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new s("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new s("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new s("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new s("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new s("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new s("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:s.default,Router:new s("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new s("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new s("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new s("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new s("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new s("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new s("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new s("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new s("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new s("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new s("Ray1111111111111111111111111111111111111111")};import hi from"bn.js";import{PublicKey as xi,AddressLookupTableAccount as Pi}from"@solana/web3.js";import{PublicKey as Ki,sendAndConfirmTransaction as Wi,SystemProgram as Gi,Transaction as Hi,TransactionMessage as zi,VersionedTransaction as Yi}from"@solana/web3.js";import Xi from"axios";import{PublicKey as Ft}from"@solana/web3.js";import Vt from"bn.js";function Mt(n){return typeof n=="object"&&n!==null&&![v,F,Ft,m,Vt,V,K].some(e=>typeof e=="object"&&n instanceof e)}function ee(n){return typeof n=="string"?me(n):Array.isArray(n)?n.map(e=>ee(e)):Mt(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,ee(t)])):n}import Dt from"bn.js";var cs=new Dt(1e6);import{PublicKey as Ut}from"@solana/web3.js";import je,{isBN as ze}from"bn.js";import{bits as Cs,BitStructure as Fs,blob as Nt,Blob as Vs,cstr as Ms,f32 as Ds,f32be as Ns,f64 as Es,f64be as vs,greedy as Os,Layout as Et,ns64 as Ks,ns64be as Ws,nu64 as Us,nu64be as qs,offset as Gs,s16 as Hs,s16be as js,s24 as zs,s24be as Ys,s32 as Js,s32be as Xs,s40 as Zs,s40be as Qs,s48 as $s,s48be as ea,s8 as ta,seq as vt,struct as na,Structure as Ot,u16 as ra,u16be as oa,u24 as ia,u24be as sa,u32 as aa,u32be as ua,u40 as ca,u40be as la,u48 as da,u48be as ma,u8 as Kt,UInt as Wt,union as pa,Union as fa,unionLayoutDiscriminator as ga,utf8 as ya}from"@solana/buffer-layout";var he=Et,qe=Ot;var be=Wt;var Ge=Kt;var He=vt;var O=Nt;var W=class extends he{constructor(t,r,o){super(t,o);this.blob=O(t),this.signed=r}decode(t,r=0){let o=new je(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new je(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}};function T(n){return new be(1,n)}function ne(n){return new be(4,n)}function i(n){return new W(8,!1,n)}function D(n){return new W(16,!1,n)}function Ye(n){return new W(1,!0,n)}function re(n){return new W(8,!0,n)}var te=class extends he{constructor(t,r,o,u){super(t.span,u);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function a(n){return new te(O(32),e=>new Ut(e),e=>e.toBuffer(),n)}function Te(n){return new te(Ge(),qt,Gt,n)}function qt(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Gt(n){return n?1:0}var we=class extends qe{decode(e,t){return super.decode(e,t)}};function y(n,e,t){return new we(n,e,t)}function h(n,e,t){let r,o=typeof e=="number"?e:ze(e)?e.toNumber():new Proxy(e,{get(u,d){if(!r){let p=Reflect.get(u,"count");r=ze(p)?p.toNumber():p,Reflect.set(u,"count",r)}return Reflect.get(u,d)},set(u,d,p){return d==="count"&&(r=p),Reflect.set(u,d,p)}});return He(n,o,t)}var xe=y([a("mint"),a("owner"),i("amount"),ne("delegateOption"),a("delegate"),T("state"),ne("isNativeOption"),i("isNative"),i("delegatedAmount"),ne("closeAuthorityOption"),a("closeAuthority")]);import{PublicKey as Pe}from"@solana/web3.js";var Na=y([T("instruction")]),Ea=y([T("instruction")]),Ht=y([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),D("accRewardPerShare"),a("rewardVault"),a("rewardMint"),a("rewardSender"),i("rewardType"),h(i(),15,"padding")]),jt=y([i("state"),i("nonce"),a("lpVault"),a("rewardVault"),a(),a(),i(),i(),i("totalReward"),D("perShareReward"),i("lastSlot"),i("perSlotReward")]),zt=y([i("state"),i("nonce"),a("lpVault"),a("rewardVaultA"),i("totalRewardA"),D("perShareRewardA"),i("perSlotRewardA"),T("option"),a("rewardVaultB"),O(7),i("totalRewardB"),D("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),a()]),Yt=y([i(),i("state"),i("nonce"),i("validRewardTokenNum"),D("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),a("lpMint"),a("lpVault"),h(Ht,5,"rewardInfos"),a("creator"),a(),h(i(),32,"padding")]),Je=new Proxy(jt,{get(n,e,t){return e==="decode"?(...r)=>{let o=n.decode(...r);return B(S({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(n,e,t)}}),Xe=new Proxy(zt,{get(n,e,t){return e==="decode"?(...r)=>{let o=n.decode(...r);return B(S({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(n,e,t)}}),Ze=new Proxy(Yt,{get(n,e,t){return e==="decode"?(...r)=>{let o=n.decode(...r);return B(S({},o),{version:6,rewardInfos:o.rewardInfos.map(u=>{var d;return B(S({},u),{rewardType:((d=Object.entries(oe).find(p=>String(p[1])===u.rewardType.toString()))!=null?d:["Standard SPL"])[0]})})})}:Reflect.get(n,e,t)}}),Jt=y([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),va=y([T("instruction"),i("nonce"),h(Jt,5,"rewardTimeInfo")]),Oa=y([T("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),Ka=y([T("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),Wa=y([i("state"),a("id"),a("owner"),i("deposited"),h(i(),1,"rewardDebts")]),Qe=y([i("state"),a("id"),a("owner"),i("deposited"),h(D(),1,"rewardDebts"),i(""),i("voteLockedBalance"),h(i(),15)]),Ua=y([i("state"),a("id"),a("owner"),i("deposited"),h(i(),2,"rewardDebts")]),$e=y([i("state"),a("id"),a("owner"),i("deposited"),h(D(),2,"rewardDebts"),h(i(),17)]),et=y([i(),i("state"),a("id"),a("owner"),i("deposited"),h(D(),5,"rewardDebts"),h(i(),16)]),qa=y([T("instruction"),i("amount")]),Xt=y([a("mint"),a("grantAuthority"),i("baselineVoteWeightScaledFactor"),i("maxExtraLockupVoteWeightScaledFactor"),i("lockupSaturationSecs"),Ye("digitShift"),h(T(),7,"reserved1"),h(i(),7,"reserved2")]),tt=y([O(8),a("governanceProgramId"),a("realm"),a("realmGoverningTokenMint"),a("realmAuthority"),h(T(),32,"reserved1"),h(Xt,4,"votingMints"),re("timeOffset"),T("bump"),h(T(),7,"reserved2"),h(i(),11,"reserved3")]),Zt=y([re("startTime"),re("endTime"),T("kind"),h(T(),15,"reserved")]),Qt=y([h(Zt,1,"lockup"),i("amountDeposited_native"),i("amountInitiallyLockedNative"),Te("isUsed"),Te("allowClawback"),T("votingMintConfigIdx"),h(T(),29,"reserved")]),nt=y([O(8),a("voterAuthority"),a("registrar"),h(Qt,32,"deposits"),T("voterBump"),T("voterWweightRecordBump"),h(T(),94,"reserved")]);import{NATIVE_MINT as Qa}from"@solana/spl-token";var $a=L("Raydium_farm_config"),eu=new Pe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),tu=new Pe("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var nu=new Pe("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX"),rt={3:Je,5:Xe,6:Ze},ot={3:Qe,5:$e,6:et};var oe={"Standard SPL":0,"Option tokens":1},ru={[Oe.toString()]:3,[Ke.toString()]:4,[We.toString()]:5,[Ue.toString()]:6,[Y.FARM_PROGRAM_ID_V3.toString()]:3,[Y.FARM_PROGRAM_ID_V4.toString()]:4,[Y.FARM_PROGRAM_ID_V5.toString()]:5,[Y.FARM_PROGRAM_ID_V6.toString()]:6};var J=L("Raydium.farm.util");function bu({programId:n,poolId:e,mint:t,type:r}){let{publicKey:o}=z([e.toBuffer(),t.toBuffer(),Buffer.from(r==="lpVault"?"lp_vault_associated_seed":r==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],n);return o}function $t({programId:n,poolId:e,owner:t,version:r}){let{publicKey:o}=z([e.toBuffer(),t.toBuffer(),Buffer.from(r===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],n);return o}var wu=({programId:n,poolId:e})=>z([e.toBuffer()],n);function Tu(n){return{isSet:new R(1),rewardPerSecond:w(n.perSecond),rewardOpenTime:w(n.openTime),rewardEndTime:w(n.endTime),rewardType:w(oe[n.rewardType])}}function xu(n){return w(n.endTime).sub(w(n.openTime)).mul(w(n.perSecond))}function en(n){let e=ot[n];return e||J.logWithError("invalid version",n),e}function tn(n){let e=rt[n];return e||J.logWithError("invalid version",n),e}function nn(n,e,t,r){if(n.version===3||n.version===5){if(n.lastSlot.gte(new R(t)))return n;let o=new R(t).sub(n.lastSlot);n.lastSlot=new R(t);for(let u of n.rewardInfos){if(e.amount.eq(new R(0)))continue;let d=u.perSlotReward.mul(o);u.perShareReward=u.perShareReward.add(d.mul(new R(10).pow(new R(n.version===3?9:15))).div(e.amount)),u.totalReward=u.totalReward.add(d)}}else if(n.version===6)for(let o of n.rewardInfos){if(o.rewardState.eq(new R(0)))continue;let u=R.min(new R(r),o.rewardEndTime);if(o.rewardOpenTime.gte(u))continue;let p=u.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),x=o.totalReward.sub(o.totalRewardEmissioned);x.lt(p)?(p=x,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(x.div(o.rewardPerSecond))):o.rewardLastUpdateTime=u,!e.amount.eq(new R(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(p.mul(n.rewardMultiplier).div(e.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(p))}return n}async function Pu({connection:n,farmPools:e,owner:t,config:r,chainTime:o}){let u=!1,d=!1,p=new R(10),x=[];for(let P of e){let f=ee(P);f.version===6?d=!0:u=!0,x.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),t&&x.push({pubkey:$t({programId:f.programId,poolId:f.id,owner:t,version:P.version}),version:f.version,key:"ledger",poolId:f.id})}let b={},_=await Ie(n,x,r);for(let{pubkey:P,version:f,key:C,poolId:U,accountInfo:A}of _){let k=U.toBase58();if(b[k]=S({},b[k]),C==="state"){let N=tn(f);(!A||!A.data||A.data.length!==N.span)&&J.logWithError(`invalid farm state account info, pools.id, ${P}`),b[k].state=N.decode(A.data)}else if(C==="lpVault")(!A||!A.data||A.data.length!==xe.span)&&J.logWithError(`invalid farm lp vault account info, pools.lpVault, ${P}`),b[k].lpVault=xe.decode(A.data);else if(C==="ledger"){let N=en(f);A&&A.data&&(A.data.length!==N.span&&J.logWithError(`invalid farm ledger account info, ledger, ${P}`),b[k].ledger=N.decode(A.data))}}let I=d||u?await n.getSlot():0;for(let P of Object.keys(b))b[P]!==void 0&&(b[P].state=nn(b[P].state,b[P].lpVault,I,o));for(let[P,{state:f,ledger:C}]of Object.entries(b))if(C){let U=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?p.pow(new R(9)):p.pow(new R(15)),A=f.rewardInfos.map((k,N)=>{let it=C.rewardDebts[N];return C.deposited.mul(f.version===6?k.accRewardPerShare:k.perShareReward).div(U).sub(it)});b[P].wrapped=B(S({},b[P].wrapped),{pendingRewards:A})}return b}function Su(n,e=Date.now()){if(n.version===6){let t=n.state.rewardInfos;if(t.every(({rewardOpenTime:r})=>Ee(e,r.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:r})=>ve(e,r.toNumber(),{unit:"s"})))return"closed pool"}else{let t=n.state.rewardInfos.map(({perSlotReward:r})=>r);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}async function Lu(n,e,t,r){let o=await n.getAccountInfo(e);if(o===null)throw Error("registrar info check error");let d=tt.decode(o.data).votingMints.findIndex(_=>_.mint.equals(r));if(d===-1)throw Error("find voter mint error");let p=await n.getAccountInfo(t);if(p===null)return{index:d,isInit:!1};let b=nt.decode(p.data).deposits.findIndex(_=>_.isUsed&&_.votingMintConfigIdx===d);return b===-1?{index:d,isInit:!1}:{index:b,isInit:!0}}export{xu as calFarmRewardAmount,Tu as farmRewardInfoToConfig,Pu as fetchMultipleFarmInfoAndUpdate,wu as getAssociatedAuthority,$t as getAssociatedLedgerAccount,bu as getAssociatedLedgerPoolAccount,Lu as getDepositEntryIndex,en as getFarmLedgerLayout,tn as getFarmStateLayout,Su as judgeFarmType,nn as updateFarmPoolInfo};
//# sourceMappingURL=util.mjs.map