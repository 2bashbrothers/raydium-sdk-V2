var en=Object.defineProperty,tn=Object.defineProperties;var rn=Object.getOwnPropertyDescriptors;var et=Object.getOwnPropertySymbols;var ar=Object.prototype.hasOwnProperty,ur=Object.prototype.propertyIsEnumerable;var sr=(r,e,t)=>e in r?en(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,G=(r,e)=>{for(var t in e||(e={}))ar.call(e,t)&&sr(r,t,e[t]);if(et)for(var t of et(e))ur.call(e,t)&&sr(r,t,e[t]);return r},X=(r,e)=>tn(r,rn(e));var Ee=(r,e)=>{var t={};for(var n in r)ar.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&et)for(var n of et(r))e.indexOf(n)<0&&ur.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as U,SystemProgram as So}from"@solana/web3.js";import{createAssociatedTokenAccountIdempotentInstruction as $r}from"@solana/spl-token";import{PublicKey as sn}from"@solana/web3.js";import{get as cr,set as nn}from"lodash";var bt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},lr={},on={};function Y(r){let e=cr(lr,r);if(!e){let t=cr(on,r);e=new bt({name:r,logLevel:t}),nn(lr,r,e)}return e}import{MINT_SIZE as vo,TOKEN_PROGRAM_ID as No,getTransferFeeConfig as Oo,unpackMint as Wo}from"@solana/spl-token";var ht=Y("Raydium_accountInfo_util");async function dr(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:s=100}=G({batchRequest:!1},t),a=wt(e,s),i=new Array(a.length).fill([]);if(n){let f=a.map(u=>{let p=r._buildArgs([u.map(w=>w.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),d=wt(f,10);i=(await(await Promise.all(d.map(async u=>await r._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(p=>{if(p){let{data:w,executable:l,lamports:x,owner:y,rentEpoch:B}=p;return w.length!==2&&w[1]!=="base64"&&ht.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(w[0],"base64"),executable:l,lamports:x,owner:new sn(y),rentEpoch:B}}return null})))}else try{i=await Promise.all(a.map(f=>r.getMultipleAccountsInfo(f,o)))}catch(f){f instanceof Error&&ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return i.flat()}import pe from"bn.js";import ys from"decimal.js";import fn from"big.js";import ot from"bn.js";import an from"toformat";var un=an,ve=un;import nt from"big.js";import ln from"bn.js";import dn from"decimal.js-light";import Ne from"bn.js";var pr=9007199254740991;function D(r){let e=Y("Raydium_parseBigNumberish");if(r instanceof Ne)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Ne(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=pr||r<=-pr)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Ne(String(r))):typeof r=="bigint"?new Ne(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Ne(0))}var rt=Y("module/fraction"),xt=ve(nt),Oe=ve(dn),pn={[0]:Oe.ROUND_DOWN,[1]:Oe.ROUND_HALF_UP,[2]:Oe.ROUND_UP},mn={[0]:nt.roundDown,[1]:nt.roundHalfUp,[2]:nt.roundUp},W=class{constructor(e,t=new ln(1)){this.numerator=D(e),this.denominator=D(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new W(this.denominator,this.numerator)}add(e){let t=e instanceof W?e:new W(D(e));return this.denominator.eq(t.denominator)?new W(this.numerator.add(t.numerator),this.denominator):new W(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof W?e:new W(D(e));return this.denominator.eq(t.denominator)?new W(this.numerator.sub(t.numerator),this.denominator):new W(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof W?e:new W(D(e));return new W(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof W?e:new W(D(e));return new W(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||rt.logWithError(`${e} is not an integer.`),e<=0&&rt.logWithError(`${e} is not positive.`),Oe.set({precision:e+1,rounding:pn[n]});let o=new Oe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||rt.logWithError(`${e} is not an integer.`),e<0&&rt.logWithError(`${e} is negative.`),xt.DP=e,xt.RM=mn[n]||1,new xt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var yn=Y("Raydium_amount"),mr=ve(fn);function gn(r,e){let t="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([t,n]=o,n=n.padEnd(e,"0")):yn.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var le=class extends W{constructor(t,n,o=!0,s){let a=new ot(0),i=Tt.pow(new ot(t.decimals));if(o)a=D(n);else{let f=new ot(0),d=new ot(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,u]=gn(n.toString(),t.decimals);f=D(m),d=D(u)}f=f.mul(i),a=f.add(d)}super(a,i);this.logger=Y(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new le(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new le(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return mr.DP=this.token.decimals,new mr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fr}from"@solana/spl-token";var yr={chainId:101,address:bn.default.toBase58(),programId:fr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},re={chainId:101,address:"So11111111111111111111111111111111111111112",programId:fr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as At}from"@solana/web3.js";import{PublicKey as j,SystemProgram as gr,SYSVAR_RENT_PUBKEY as hn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wn}from"@solana/spl-token";function c({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Pt=[c({pubkey:wn,isWritable:!1}),c({pubkey:gr.programId,isWritable:!1}),c({pubkey:hn,isWritable:!1})];function kt({publicKey:r,transformSol:e}){let t=It(r.toString());if(t instanceof j)return e&&t.equals(Q)?ce:t;if(e&&t.toString()===Q.toBase58())return ce;if(typeof t=="string"){if(t===j.default.toBase58())return j.default;try{return new j(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function It(r){try{return new j(r)}catch{return r}}var wi=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xi=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xn=new j("SysvarRent111111111111111111111111111111111"),Ti=new j("SysvarC1ock11111111111111111111111111111111"),Pi=new j("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Tn=new j("Sysvar1nstructions1111111111111111111111111"),ki=gr.programId,Ii=new j("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ai=new j("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Si=new j("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Li=new j("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ri=new j("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Bi=new j("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ki=new j("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ci=new j("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Vi=new j("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),_i=new j("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Fi=new j("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ce=new j("So11111111111111111111111111111111111111112"),Q=j.default;function tt(r){return kt({publicKey:r,transformSol:!0})}var St=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:s=!1,isToken2022:a=!1}){if(e===Q.toBase58()||e instanceof At&&Q.equals(e)){this.decimals=re.decimals,this.symbol=re.symbol,this.name=re.name,this.mint=new At(re.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?At.default:kt({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ae=St;Ae.WSOL=new St(X(G({},re),{mint:re.address}));var Lt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},it=Lt;it.SOL=new Lt(yr);import Pn from"bn.js";var br=new W(new Pn(100)),Ce=class extends W{toSignificant(e=5,t,n){return this.mul(br).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(br).toFixed(e,t,n)}};var kn=Y("Raydium_price"),de=class extends W{constructor(t){let{baseToken:n,quoteToken:o,numerator:s,denominator:a}=t;super(s,a);this.baseToken=n,this.quoteToken=o,this.scalar=new W(Rt(n.decimals),Rt(o.decimals))}get raw(){return new W(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new de({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&kn.logWithError("mul token not equals");let n=super.mul(t);return new de({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var Bt=new pe(0),Is=new pe(1),As=new pe(2),Ss=new pe(3),Ls=new pe(5),Tt=new pe(10),Rs=new pe(100),Bs=new pe(1e3),Ks=new pe(1e4);function Rt(r){return Tt.pow(D(r))}function wt(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var se=class{constructor(e){this._owner=e}get publicKey(){return se.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return se.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return se.isKeyPair(this._owner)}get isPublicKey(){return se.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!se.isKeyPair(e)}};import{PublicKey as Kn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Cn}from"@solana/spl-token";import{ComputeBudgetProgram as hr,Keypair as xr,PublicKey as In,Transaction as Tr,TransactionMessage as An,VersionedTransaction as Pr}from"@solana/web3.js";var q={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Sn}from"@solana/spl-token";var wr=Y("Raydium_txUtil"),kr=1644;function We(r){let e=[],t=[];return r.microLamports&&(e.push(hr.setComputeUnitPrice({microLamports:r.microLamports})),t.push(q.SetComputeUnitPrice)),r.units&&(e.push(hr.setComputeUnitLimit({units:r.units})),t.push(q.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Se(r,e){var n,o;let t=e!=null?e:"confirmed";return(o=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:o.blockhash}async function Ue(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let o=setTimeout(n,6e4);r.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function Ln(r,e){r.length<1&&wr.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&wr.logWithError(`no signers provided:, ${e.toString()}`);let t=new Tr;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<kr}catch{return!1}}function Le(r,e){let[t,n]=In.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Ge({instructions:r,payer:e,signers:t}){return Ln(r,[e,...t])}function me({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=xr.generate().publicKey.toString()}){let s=new An({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Pr(s).serialize()).toString("base64").length<kr}catch{return!1}}var Rn=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Bn=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Pr&&(e=Rn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function xe(r){let e=[];return r.forEach(t=>{t instanceof Tr&&(t.recentBlockhash||(t.recentBlockhash=Sn.toBase58()),t.feePayer||(t.feePayer=xr.generate().publicKey)),e.push(Bn(t))}),console.log("simulate tx string:",e),e}function Ve(r,e,t){return Le([r.toBuffer(),(t!=null?t:Cn).toBuffer(),e.toBuffer()],new Kn("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as C}from"@solana/web3.js";var Ir=new C("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ar=new C("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Sr=new C("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),qe=new C("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Zs=new C("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Qs=new C("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),$s=new C("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ea=new C("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ta=new C("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ra=new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),na=new C("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),oa=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ia=new C("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),sa=new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),aa=new C("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ua=new C("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ca=new C("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),la=new C("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),da=new C("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),pa=new C("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ma=new C("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),fa=new C("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ya=new C("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ga=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ba=new C("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ha=new C("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),wa=new C("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),xa=new C("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ta=new C("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Pa=new C("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),ka=new C("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Re={OPEN_BOOK_PROGRAM:new C("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new C("Ray1111111111111111111111111111111111111111"),AMM_V4:new C("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new C("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new C("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new C("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new C("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new C("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new C("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new C("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new C("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new C("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:C.default,Router:new C("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new C("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new C("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new C("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new C("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new C("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new C("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new C("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new C("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new C("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new C("Ray1111111111111111111111111111111111111111")};import Sa from"bn.js";import{PublicKey as Kt,AddressLookupTableAccount as Fe}from"@solana/web3.js";async function st({connection:r,address:e,cluster:t="mainnet"}){let n=await dr(r,[...new Set(e.map(s=>s.toString()))].map(s=>new Kt(s))),o={};for(let s=0;s<e.length;s++){let a=n[s],i=e[s];if(!a)continue;let f=new Fe({key:i,state:Fe.deserialize(a.data)});o[i.toString()]=f,t==="devnet"?_e[i.toString()]=f:Te[i.toString()]=f}return o}var Te={},Ct=async r=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(Te[e])return Te;let t=new Kt(e),n=await r.getAccountInfo(t);return n&&(Te[e]=new Fe({key:t,state:Fe.deserialize(n.data)})),Te},_e={},at=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(_e[e])return _e;let t=new Kt(e),n=await r.getAccountInfo(t);return n&&(_e[e]=new Fe({key:t,state:Fe.deserialize(n.data)})),_e};import{PublicKey as Be,sendAndConfirmTransaction as Vt,SystemProgram as _n,Transaction as He,TransactionMessage as fe,VersionedTransaction as ye}from"@solana/web3.js";import Fn from"axios";var je=2e3,ze=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Fn.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=We(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(_n.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Be(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(q.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:a=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...a.filter(i=>i!==Be.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(G({},t||{})):this.build(t)}build(e){var n;let t=new He;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var m;let{recentBlockHash:s,skipPreflight:a=!0,sendAndConfirm:i,notSendToRpc:f}=o||{},d=s!=null?s:await Se(this.connection,this.blockhashCommitment);if(t.recentBlockhash=d,this.signers.length&&t.sign(...this.signers),xe([t]),(m=this.owner)!=null&&m.isKeyPair)return{txId:i?await Vt(this.connection,t,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:a}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);if(this.signers.length)for(let p of u)try{p.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:a}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var d;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:o}=this.build(n),s=t.filter(m=>m.transaction.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(d=this.owner)!=null&&d.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:i,instructionTypes:f,execute:async m=>{var B;let{sequentially:u,onTxUpdate:p,skipTxCount:w=0,recentBlockHash:l,skipPreflight:x=!0}=m||{},y=l!=null?l:await Se(this.connection,this.blockhashCommitment);if((B=this.owner)!=null&&B.isKeyPair){if(u){let S=[],_=0;for(let g of a){if(++_,_<=w)continue;let h=await Vt(this.connection,g,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});S.push(h)}return{txIds:S,signedTxs:a}}return{txIds:await await Promise.all(a.map(async S=>(S.recentBlockhash=y,await this.connection.sendRawTransaction(S.serialize(),{skipPreflight:x})))),signedTxs:a}}if(this.signAllTransactions){let S=a.map((g,h)=>(g.recentBlockhash=y,i[h].length&&g.sign(...i[h]),g));xe(S);let _=await this.signAllTransactions(S);if(u){let g=0,h=[],b=async()=>{if(!_[g])return;let A=await this.connection.sendRawTransaction(_[g].serialize(),{skipPreflight:x});h.push({txId:A,status:"sent",signedTx:_[g]}),p==null||p([...h]),g++;let k=!1,L=null,R=null,V=P=>{L!==null&&clearInterval(L),R!==null&&this.connection.removeSignatureListener(R);let K=h.findIndex(I=>I.txId===A);if(K>-1){if(h[K].status==="error"||h[K].status==="success")return;h[K].status=P.err?"error":"success"}p==null||p([...h]),P.err||b()};this.loopMultiTxStatus&&(L=setInterval(async()=>{var P;if(k){clearInterval(L);return}try{let K=await this.connection.getTransaction(A,{commitment:"confirmed",maxSupportedTransactionVersion:0});K&&(k=!0,clearInterval(L),V({err:((P=K.meta)==null?void 0:P.err)||null}),console.log("tx status from getTransaction:",A))}catch(K){k=!0,clearInterval(L),console.error("getTransaction timeout:",K,A)}},je)),R=this.connection.onSignature(A,P=>{if(k){this.connection.removeSignatureListener(R);return}k=!0,V(P)},"confirmed"),this.connection.getSignatureStatus(A)};return await b(),{txIds:h.map(A=>A.txId),signedTxs:_}}else{let g=[];for(let h=0;h<_.length;h+=1){let b=await this.connection.sendRawTransaction(_[h].serialize(),{skipPreflight:x});g.push(b)}return{txIds:g,signedTxs:_}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var x;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:s}=l,a=Ee(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=G(G({},this.cluster==="devnet"?await at(this.connection):await Ct(this.connection)),t),f=Array.from(new Set([...n,...this.lookupTableAddress])),d=[];for(let y of f)i[y]===void 0&&d.push(new Be(y));let m=await st({connection:this.connection,address:d});for(let[y,B]of Object.entries(m))i[y]=B;let u=o?Be.default.toBase58():s!=null?s:await Se(this.connection,this.blockhashCommitment),p=new fe({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((x=this.owner)==null?void 0:x.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let w=new ye(p);return w.sign(this.signers),{builder:this,transaction:w,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var g;let{skipPreflight:B=!0,sendAndConfirm:S,notSendToRpc:_}=y||{};if(xe([w]),(g=this.owner)!=null&&g.isKeyPair){let h=await this.connection.sendTransaction(w,{skipPreflight:B});return S&&await Ue(this.connection,h),{txId:h,signedTx:w}}if(this.signAllTransactions){let h=await this.signAllTransactions([w]);if(this.signers.length)for(let b of h)try{b.sign(this.signers)}catch{}return{txId:_?"":await this.connection.sendTransaction(h[0],{skipPreflight:B}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){var d;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),s=t.filter(m=>m.builder.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(d=this.owner)!=null&&d.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(m,u)=>{m.sign(i[u])}),{builder:this,transactions:a,signers:i,instructionTypes:f,buildProps:n,execute:async m=>{var x;let{sequentially:u,onTxUpdate:p,recentBlockHash:w,skipPreflight:l=!0}=m||{};if(w&&a.forEach(y=>y.message.recentBlockhash=w),xe(a),(x=this.owner)!=null&&x.isKeyPair){if(u){let y=[];for(let B of a){let S=await this.connection.sendTransaction(B,{skipPreflight:l});await Ue(this.connection,S),y.push(S)}return{txIds:y,signedTxs:a}}return{txIds:await Promise.all(a.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:l}))),signedTxs:a}}if(this.signAllTransactions){let y=await this.signAllTransactions(a);if(u){let B=0,S=[],_=async()=>{if(!y[B])return;let g=await this.connection.sendTransaction(y[B],{skipPreflight:l});S.push({txId:g,status:"sent",signedTx:y[B]}),p==null||p([...S]),B++;let h=!1,b=null,A=null,k=L=>{b!==null&&clearInterval(b),A!==null&&this.connection.removeSignatureListener(A);let R=S.findIndex(V=>V.txId===g);if(R>-1){if(S[R].status==="error"||S[R].status==="success")return;S[R].status=L.err?"error":"success"}p==null||p([...S]),L.err||_()};this.loopMultiTxStatus&&(b=setInterval(async()=>{var L;if(h){clearInterval(b);return}try{let R=await this.connection.getTransaction(g,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(h=!0,clearInterval(b),k({err:((L=R.meta)==null?void 0:L.err)||null}),console.log("tx status from getTransaction:",g))}catch(R){h=!0,clearInterval(b),console.error("getTransaction timeout:",R,g)}},je)),A=this.connection.onSignature(g,L=>{if(h){this.connection.removeSignatureListener(A);return}h=!0,k(L)},"confirmed"),this.connection.getSignatureStatus(g)};return _(),{txIds:[],signedTxs:y}}else{let B=[];for(let S=0;S<y.length;S+=1){let _=await this.connection.sendTransaction(y[S],{skipPreflight:l});B.push(_)}return{txIds:B,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var p;let u=e||{},{splitIns:t=[],computeBudgetConfig:n}=u,o=Ee(u,["splitIns","computeBudgetConfig"]),s=n?We(n):{instructions:[],instructionTypes:[]},a=this.signers.reduce((w,l)=>X(G({},w),{[l.publicKey.toBase58()]:l}),{}),i=[],f=[],d=[],m=0;if(this.allInstructions.forEach(w=>{let l=[...d,w],x=n?[...s.instructions,...l]:l,B=[...new Set(l.map(S=>S.keys.filter(_=>_.isSigner).map(_=>_.pubkey.toString())).flat()).values()].map(S=>new Be(S));if(w!==t[m]&&d.length<12&&(Ge({instructions:x,payer:this.feePayer,signers:B})||Ge({instructions:l,payer:this.feePayer,signers:B})))d.push(w);else{if(d.length===0)throw Error("item ins too big");m+=w===t[m]?1:0,Ge({instructions:n?[...s.instructions,...d]:[...d],payer:this.feePayer,signers:B})?i.push(new He().add(...s.instructions,...d)):i.push(new He().add(...d)),f.push(Array.from(new Set(d.map(S=>S.keys.filter(_=>_.isSigner).map(_=>_.pubkey.toString())).flat())).map(S=>a[S]).filter(S=>S!==void 0)),d=[w]}}),d.length>0){let l=[...new Set(d.map(x=>x.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(x=>a[x]).filter(x=>x!==void 0);Ge({instructions:n?[...s.instructions,...d]:[...d],payer:this.feePayer,signers:l.map(x=>x.publicKey)})?i.push(new He().add(...s.instructions,...d)):i.push(new He().add(...d)),f.push(l)}return i.forEach(w=>w.feePayer=this.feePayer),(p=this.owner)!=null&&p.signer&&f.forEach(w=>{w.some(l=>l.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:i,signers:f,instructionTypes:this.instructionTypes,execute:async w=>{var g;let{sequentially:l,onTxUpdate:x,skipTxCount:y=0,recentBlockHash:B,skipPreflight:S=!0}=w||{},_=B!=null?B:await Se(this.connection,this.blockhashCommitment);if(i.forEach(async(h,b)=>{h.recentBlockhash=_,f[b].length&&h.sign(...f[b])}),xe(i),(g=this.owner)!=null&&g.isKeyPair){if(l){let h=0,b=[];for(let A of i){if(++h,h<=y){b.push("tx skipped");continue}let k=await Vt(this.connection,A,this.signers.find(L=>L.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:S});b.push(k)}return{txIds:b,signedTxs:i}}return{txIds:await Promise.all(i.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:S}))),signedTxs:i}}if(this.signAllTransactions){let h=await this.signAllTransactions(i.slice(y,i.length)),b=[...i.slice(0,y),...h];if(l){let A=0,k=[],L=async()=>{if(!b[A])return;A<y&&(k.push({txId:"",status:"success",signedTx:b[A]}),x==null||x([...k]),A++,L());let R=await this.connection.sendRawTransaction(b[A].serialize(),{skipPreflight:S});k.push({txId:R,status:"sent",signedTx:b[A]}),x==null||x([...k]),A++;let V=!1,P=null,K=null,I=O=>{P!==null&&clearInterval(P),K!==null&&this.connection.removeSignatureListener(K);let N=k.findIndex(ee=>ee.txId===R);if(N>-1){if(k[N].status==="error"||k[N].status==="success")return;k[N].status=O.err?"error":"success"}x==null||x([...k]),O.err||L()};this.loopMultiTxStatus&&(P=setInterval(async()=>{var O;if(V){clearInterval(P);return}try{let N=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(V=!0,clearInterval(P),I({err:((O=N.meta)==null?void 0:O.err)||null}),console.log("tx status from getTransaction:",R))}catch(N){V=!0,clearInterval(P),console.error("getTransaction timeout:",N,R)}},je)),K=this.connection.onSignature(R,O=>{if(V){this.connection.removeSignatureListener(K);return}V=!0,I(O)},"confirmed"),this.connection.getSignatureStatus(R)};return await L(),{txIds:k.map(R=>R.txId),signedTxs:b}}else{let A=[];for(let k=0;k<b.length;k+=1){let L=await this.connection.sendRawTransaction(b[k].serialize(),{skipPreflight:S});A.push(L)}return{txIds:A,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var _;let S=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=S,a=Ee(S,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=G(G({},this.cluster==="devnet"?await at(this.connection):Te),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),d=[];for(let g of f)i[g]===void 0&&d.push(new Be(g));let m=await st({connection:this.connection,address:d});for(let[g,h]of Object.entries(m))i[g]=h;let u=t?We(t):{instructions:[],instructionTypes:[]},p=await Se(this.connection,this.blockhashCommitment),w=this.signers.reduce((g,h)=>X(G({},g),{[h.publicKey.toBase58()]:h}),{}),l=[],x=[],y=[],B=0;if(this.allInstructions.forEach(g=>{let h=[...y,g],b=t?[...u.instructions,...h]:h;if(g!==n[B]&&y.length<12&&(me({instructions:b,payer:this.feePayer,lookupTableAddressAccount:i})||me({instructions:h,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(g);else{if(y.length===0)throw Error("item ins too big");B+=g===n[B]?1:0;let A={};for(let k of[...new Set(f)])i[k]!==void 0&&(A[k]=i[k]);if(t&&me({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let k=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new ye(k))}else{let k=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new ye(k))}x.push(Array.from(new Set(y.map(k=>k.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(k=>w[k]).filter(k=>k!==void 0)),y=[g]}}),y.length>0){let h=[...new Set(y.map(b=>b.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(b=>w[b]).filter(b=>b!==void 0);if(t&&me({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let b=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new ye(b))}else{let b=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new ye(b))}x.push(h)}return(_=this.owner)!=null&&_.signer&&x.forEach(g=>{g.some(h=>h.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),l.forEach((g,h)=>{g.sign(x[h])}),{builder:this,transactions:l,buildProps:e,signers:x,blockHash:p,instructionTypes:this.instructionTypes,execute:async g=>{var R;let{sequentially:h,onTxUpdate:b,skipTxCount:A=0,recentBlockHash:k,skipPreflight:L=!0}=g||{};if(l.map(async(V,P)=>{x[P].length&&V.sign(x[P]),k&&(V.message.recentBlockhash=k)}),xe(l),(R=this.owner)!=null&&R.isKeyPair){if(h){let V=0,P=[];for(let K of l){if(++V,V<=A){console.log("skip tx: ",V),P.push("tx skipped");continue}let I=await this.connection.sendTransaction(K,{skipPreflight:L});await Ue(this.connection,I),P.push(I)}return{txIds:P,signedTxs:l}}return{txIds:await Promise.all(l.map(async V=>await this.connection.sendTransaction(V,{skipPreflight:L}))),signedTxs:l}}if(this.signAllTransactions){let V=await this.signAllTransactions(l.slice(A,l.length)),P=[...l.slice(0,A),...V];if(h){let K=0,I=[],O=async()=>{if(!P[K])return;if(K<A){I.push({txId:"",status:"success",signedTx:P[K]}),b==null||b([...I]),K++,O();return}let N=await this.connection.sendTransaction(P[K],{skipPreflight:L});I.push({txId:N,status:"sent",signedTx:P[K]}),b==null||b([...I]),K++;let ee=!1,$=null,ue=null,De=te=>{$!==null&&clearInterval($),ue!==null&&this.connection.removeSignatureListener(ue);let Z=I.findIndex(gt=>gt.txId===N);if(Z>-1){if(I[Z].status==="error"||I[Z].status==="success")return;I[Z].status=te.err?"error":"success"}b==null||b([...I]),te.err||O()};this.loopMultiTxStatus&&($=setInterval(async()=>{var te;if(ee){clearInterval($);return}try{let Z=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});Z&&(ee=!0,clearInterval($),De({err:((te=Z.meta)==null?void 0:te.err)||null}),console.log("tx status from getTransaction:",N))}catch(Z){ee=!0,clearInterval($),console.error("getTransaction timeout:",Z,N)}},je)),ue=this.connection.onSignature(N,te=>{if(ee){this.connection.removeSignatureListener(ue);return}ee=!0,De(te)},"confirmed"),this.connection.getSignatureStatus(N)};return O(),{txIds:[],signedTxs:P}}else{let K=[];for(let I=0;I<P.length;I+=1){let O=await this.connection.sendTransaction(P[I],{skipPreflight:L});K.push(O)}return{txIds:K,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildSniperTransaction(e){var _;let S=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=S,a=Ee(S,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=G(G({},this.cluster==="devnet"?await at(this.connection):await Ct(this.connection)),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),d=[];for(let g of f)i[g]===void 0&&d.push(new Be(g));let m=await st({connection:this.connection,address:d});for(let[g,h]of Object.entries(m))i[g]=h;let u=t?We(t):{instructions:[],instructionTypes:[]},p=await Se(this.connection,this.blockhashCommitment),w=this.signers.reduce((g,h)=>X(G({},g),{[h.publicKey.toBase58()]:h}),{}),l=[],x=[],y=[],B=0;if(this.allInstructions.forEach(g=>{let h=[...y,g],b=t?[...u.instructions,...h]:h;if(g!==n[B]&&y.length<12&&(me({instructions:b,payer:this.feePayer,lookupTableAddressAccount:i})||me({instructions:h,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(g);else{if(y.length===0)throw Error("item ins too big");B+=g===n[B]?1:0;let A={};for(let k of[...new Set(f)])i[k]!==void 0&&(A[k]=i[k]);if(t&&me({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let k=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new ye(k))}else{let k=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new ye(k))}x.push(Array.from(new Set(y.map(k=>k.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(k=>w[k]).filter(k=>k!==void 0)),y=[g]}}),y.length>0){let h=[...new Set(y.map(b=>b.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(b=>w[b]).filter(b=>b!==void 0);if(t&&me({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let b=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new ye(b))}else{let b=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new ye(b))}x.push(h)}return(_=this.owner)!=null&&_.signer&&x.forEach(g=>{g.some(h=>h.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),l.forEach((g,h)=>{g.sign(x[h])}),{builder:this,transactions:l,buildProps:e,signers:x,instructionTypes:this.instructionTypes,execute:async g=>{var R;let{sequentially:h,onTxUpdate:b,skipTxCount:A=0,recentBlockHash:k,skipPreflight:L=!0}=g||{};if(l.map(async(V,P)=>{x[P].length&&V.sign(x[P]),k&&(V.message.recentBlockhash=k)}),xe(l),(R=this.owner)!=null&&R.isKeyPair){if(h){let V=0,P=[];for(let K of l){if(++V,V<=A){console.log("skip tx: ",V),P.push("tx skipped");continue}let I=await this.connection.sendTransaction(K,{skipPreflight:L});await Ue(this.connection,I),P.push(I)}return{txIds:P,signedTxs:l}}return{txIds:await Promise.all(l.map(async V=>await this.connection.sendTransaction(V,{skipPreflight:L}))),signedTxs:l}}if(this.signAllTransactions){let V=await this.signAllTransactions(l.slice(A,l.length)),P=[...l.slice(0,A),...V];if(h){let K=0,I=[],O=async()=>{if(!P[K])return;if(K<A){I.push({txId:"",status:"success",signedTx:P[K]}),b==null||b([...I]),K++,O();return}let N=await this.connection.sendTransaction(P[K],{skipPreflight:L});I.push({txId:N,status:"sent",signedTx:P[K]}),b==null||b([...I]),K++;let ee=!1,$=null,ue=null,De=te=>{$!==null&&clearInterval($),ue!==null&&this.connection.removeSignatureListener(ue);let Z=I.findIndex(gt=>gt.txId===N);if(Z>-1){if(I[Z].status==="error"||I[Z].status==="success")return;I[Z].status=te.err?"error":"success"}b==null||b([...I]),te.err||O()};this.loopMultiTxStatus&&($=setInterval(async()=>{var te;if(ee){clearInterval($);return}try{let Z=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});Z&&(ee=!0,clearInterval($),De({err:((te=Z.meta)==null?void 0:te.err)||null}),console.log("tx status from getTransaction:",N))}catch(Z){ee=!0,clearInterval($),console.error("getTransaction timeout:",Z,N)}},je)),ue=this.connection.onSignature(N,te=>{if(ee){this.connection.removeSignatureListener(ue);return}ee=!0,De(te)},"confirmed"),this.connection.getSignatureStatus(N)};return O(),{txIds:[],signedTxs:P}}else{let K=[];for(let I=0;I<P.length;I+=1){let O=await this.connection.sendTransaction(P[I],{skipPreflight:L});K.push(O)}return{txIds:K,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};import{PublicKey as Mn}from"@solana/web3.js";import Dn from"bn.js";function En(r){return typeof r=="object"&&r!==null&&![Ae,le,Mn,W,Dn,de,Ce].some(e=>typeof e=="object"&&r instanceof e)}function ge(r){return typeof r=="string"?It(r):Array.isArray(r)?r.map(e=>ge(e)):En(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,ge(t)])):r}import vn from"bn.js";var Za=new vn(1e6);import{Keypair as Qn,PublicKey as $n}from"@solana/web3.js";import Mc from"bn.js";import{TOKEN_PROGRAM_ID as eo}from"@solana/spl-token";function Nn(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function _t(r,...e){if(!Nn(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function Ft(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Lr(r,e){_t(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var ct=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ie=(r,e)=>r<<32-e|r>>>e;var xu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function On(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Mt(r){return typeof r=="string"&&(r=On(r)),_t(r),r}var ut=class{clone(){return this._cloneInto()}},Tu={}.toString;function Rr(r){let e=n=>r().update(Mt(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Wn(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),s=BigInt(4294967295),a=Number(t>>o&s),i=Number(t&s),f=n?4:0,d=n?0:4;r.setUint32(e+f,a,n),r.setUint32(e+d,i,n)}var Br=(r,e,t)=>r&e^~r&t,Kr=(r,e,t)=>r&e^r&t^e&t,lt=class extends ut{constructor(e,t,n,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ct(this.buffer)}update(e){Ft(this);let{view:t,buffer:n,blockLen:o}=this;e=Mt(e);let s=e.length;for(let a=0;a<s;){let i=Math.min(o-this.pos,s-a);if(i===o){let f=ct(e);for(;o<=s-a;a+=o)this.process(f,a);continue}n.set(e.subarray(a,a+i),this.pos),this.pos+=i,a+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ft(this),Lr(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(n,0),a=0);for(let u=a;u<o;u++)t[u]=0;Wn(n,o-8,BigInt(this.length*8),s),this.process(n,0);let i=ct(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let d=f/4,m=this.get();if(d>m.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<d;u++)i.setUint32(4*u,m[u],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:s,destroyed:a,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=a,o%t&&e.buffer.set(n),e}};var Un=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ke=new Uint32Array(64),Dt=class extends lt{constructor(){super(64,32,8,!1),this.A=Pe[0]|0,this.B=Pe[1]|0,this.C=Pe[2]|0,this.D=Pe[3]|0,this.E=Pe[4]|0,this.F=Pe[5]|0,this.G=Pe[6]|0,this.H=Pe[7]|0}get(){let{A:e,B:t,C:n,D:o,E:s,F:a,G:i,H:f}=this;return[e,t,n,o,s,a,i,f]}set(e,t,n,o,s,a,i,f){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=i|0,this.H=f|0}process(e,t){for(let u=0;u<16;u++,t+=4)ke[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){let p=ke[u-15],w=ke[u-2],l=ie(p,7)^ie(p,18)^p>>>3,x=ie(w,17)^ie(w,19)^w>>>10;ke[u]=x+ke[u-7]+l+ke[u-16]|0}let{A:n,B:o,C:s,D:a,E:i,F:f,G:d,H:m}=this;for(let u=0;u<64;u++){let p=ie(i,6)^ie(i,11)^ie(i,25),w=m+p+Br(i,f,d)+Un[u]+ke[u]|0,x=(ie(n,2)^ie(n,13)^ie(n,22))+Kr(n,o,s)|0;m=d,d=f,f=i,i=a+w|0,a=s,s=o,o=n,n=w+x|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,i=i+this.E|0,f=f+this.F|0,d=d+this.G|0,m=m+this.H|0,this.set(n,o,s,a,i,f,d,m)}roundClean(){ke.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Cr=Rr(()=>new Dt);import{PublicKey as Jn}from"@solana/web3.js";import Mr,{isBN as Dr}from"bn.js";import{bits as Ku,BitStructure as Cu,blob as Gn,Blob as Vu,cstr as _u,f32 as Fu,f32be as Mu,f64 as Du,f64be as Eu,greedy as vu,Layout as qn,ns64 as Nu,ns64be as Ou,nu64 as Wu,nu64be as Uu,offset as Gu,s16 as qu,s16be as Hu,s24 as ju,s24be as zu,s32 as Yu,s32be as Ju,s40 as Xu,s40be as Zu,s48 as Qu,s48be as $u,s8 as ec,seq as Hn,struct as tc,Structure as jn,u16 as rc,u16be as nc,u24 as oc,u24be as ic,u32 as sc,u32be as ac,u40 as uc,u40be as cc,u48 as lc,u48be as dc,u8 as zn,UInt as Yn,union as pc,Union as mc,unionLayoutDiscriminator as fc,utf8 as yc}from"@solana/buffer-layout";var Et=qn,Vr=jn;var vt=Yn;var _r=zn;var Fr=Hn;var Ke=Gn;var Me=class extends Et{constructor(t,n,o){super(t,o);this.blob=Ke(t),this.signed=n}decode(t,n=0){let o=new Mr(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new Mr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function J(r){return new vt(1,r)}function Ye(r){return new vt(4,r)}function T(r){return new Me(8,!1,r)}function be(r){return new Me(16,!1,r)}function Er(r){return new Me(1,!0,r)}function pt(r){return new Me(8,!0,r)}var dt=class extends Et{constructor(t,n,o,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function E(r){return new dt(Ke(32),e=>new Jn(e),e=>e.toBuffer(),r)}function mt(r){return new dt(_r(),Xn,Zn,r)}function Xn(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Zn(r){return r?1:0}var Nt=class extends Vr{decode(e,t){return super.decode(e,t)}};function H(r,e,t){return new Nt(r,e,t)}function z(r,e,t){let n,o=typeof e=="number"?e:Dr(e)?e.toNumber():new Proxy(e,{get(s,a){if(!n){let i=Reflect.get(s,"count");n=Dr(i)?i.toNumber():i,Reflect.set(s,"count",n)}return Reflect.get(s,a)},set(s,a,i){return a==="count"&&(n=i),Reflect.set(s,a,i)}});return Fr(r,o,t)}var Je=H([E("mint"),E("owner"),T("amount"),Ye("delegateOption"),E("delegate"),J("state"),Ye("isNativeOption"),T("isNative"),T("delegatedAmount"),Ye("closeAuthorityOption"),E("closeAuthority")]);var Oc=Y("Raydium_Util");function ft({fromPublicKey:r,programId:e=eo,assignSeed:t}){let n=t?btoa(t).slice(0,32):Qn.generate().publicKey.toBase58().slice(0,32);return{publicKey:to(r,n,e),seed:n}}function to(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),o=Cr(n);return new $n(o)}import Lo from"decimal.js";import{PublicKey as ro,SystemProgram as no}from"@solana/web3.js";import oo from"bn.js";import{createCloseAccountInstruction as io,createInitializeAccountInstruction as so,createTransferInstruction as Zc,TOKEN_PROGRAM_ID as Xe}from"@solana/spl-token";function ao(r){let{mint:e,tokenAccount:t,owner:n,programId:o=Xe}=r;return so(t,e,n,o)}function uo(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:o,programId:s=Xe}=r;return io(e,t,o,n,s)}async function Ot(r){let{connection:e,amount:t,commitment:n,payer:o,owner:s,skipCloseAccount:a}=r,i=await e.getMinimumBalanceForRentExemption(Je.span,n),f=D(t).add(new oo(i)),d=ft({fromPublicKey:o,programId:Xe});return{addresses:{newAccount:d.publicKey},signers:[],instructions:[no.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:d.seed,newAccountPubkey:d.publicKey,lamports:f.toNumber(),space:Je.span,programId:Xe}),ao({mint:new ro(re.address),tokenAccount:d.publicKey,owner:s,programId:Xe})],instructionTypes:[q.CreateAccount,q.InitAccount],endInstructionTypes:a?[]:[q.CloseAccount],endInstructions:a?[]:[uo({tokenAccount:d.publicKey,payer:o,owner:s})]}}var Wt=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ze=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Y(t)}createTxBuilder(e){return this.scope.checkOwner(),new ze({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new se(e);return new ze({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Wt(e))}logInfo(...e){this.logger.info(Wt(e))}logAndCreateError(...e){let t=Wt(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Yt}from"@solana/web3.js";var Ut=H([J("instruction")]),Gt=H([J("instruction")]),co=H([T("rewardState"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardLastUpdateTime"),T("totalReward"),T("totalRewardEmissioned"),T("rewardClaimed"),T("rewardPerSecond"),be("accRewardPerShare"),E("rewardVault"),E("rewardMint"),E("rewardSender"),T("rewardType"),z(T(),15,"padding")]),lo=H([T("state"),T("nonce"),E("lpVault"),E("rewardVault"),E(),E(),T(),T(),T("totalReward"),be("perShareReward"),T("lastSlot"),T("perSlotReward")]),po=H([T("state"),T("nonce"),E("lpVault"),E("rewardVaultA"),T("totalRewardA"),be("perShareRewardA"),T("perSlotRewardA"),J("option"),E("rewardVaultB"),Ke(7),T("totalRewardB"),be("perShareRewardB"),T("perSlotRewardB"),T("lastSlot"),E()]),mo=H([T(),T("state"),T("nonce"),T("validRewardTokenNum"),be("rewardMultiplier"),T("rewardPeriodMax"),T("rewardPeriodMin"),T("rewardPeriodExtend"),E("lpMint"),E("lpVault"),z(co,5,"rewardInfos"),E("creator"),E(),z(T(),32,"padding")]),fo=new Proxy(lo,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return X(G({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,e,t)}}),yo=new Proxy(po,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return X(G({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,e,t)}}),yt=new Proxy(mo,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return X(G({},o),{version:6,rewardInfos:o.rewardInfos.map(s=>{var a;return X(G({},s),{rewardType:((a=Object.entries(Ie).find(i=>String(i[1])===s.rewardType.toString()))!=null?a:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),go=H([T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),qt=H([J("instruction"),T("nonce"),z(go,5,"rewardTimeInfo")]),Ht=H([J("instruction"),T("rewardReopenTime"),T("rewardEndTime"),T("rewardPerSecond")]),jt=H([J("instruction"),T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),ml=H([T("state"),E("id"),E("owner"),T("deposited"),z(T(),1,"rewardDebts")]),zt=H([T("state"),E("id"),E("owner"),T("deposited"),z(be(),1,"rewardDebts"),T(""),T("voteLockedBalance"),z(T(),15)]),fl=H([T("state"),E("id"),E("owner"),T("deposited"),z(T(),2,"rewardDebts")]),vr=H([T("state"),E("id"),E("owner"),T("deposited"),z(be(),2,"rewardDebts"),z(T(),17)]),Nr=H([T(),T("state"),E("id"),E("owner"),T("deposited"),z(be(),5,"rewardDebts"),z(T(),16)]),ne=H([J("instruction"),T("amount")]),bo=H([E("mint"),E("grantAuthority"),T("baselineVoteWeightScaledFactor"),T("maxExtraLockupVoteWeightScaledFactor"),T("lockupSaturationSecs"),Er("digitShift"),z(J(),7,"reserved1"),z(T(),7,"reserved2")]),ho=H([Ke(8),E("governanceProgramId"),E("realm"),E("realmGoverningTokenMint"),E("realmAuthority"),z(J(),32,"reserved1"),z(bo,4,"votingMints"),pt("timeOffset"),J("bump"),z(J(),7,"reserved2"),z(T(),11,"reserved3")]),wo=H([pt("startTime"),pt("endTime"),J("kind"),z(J(),15,"reserved")]),xo=H([z(wo,1,"lockup"),T("amountDeposited_native"),T("amountInitiallyLockedNative"),mt("isUsed"),mt("allowClawback"),J("votingMintConfigIdx"),z(J(),29,"reserved")]),To=H([Ke(8),E("voterAuthority"),E("registrar"),z(xo,32,"deposits"),J("voterBump"),J("voterWweightRecordBump"),z(J(),94,"reserved")]);import{NATIVE_MINT as kl}from"@solana/spl-token";var Il=Y("Raydium_farm_config"),Or=new Yt("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Wr=new Yt("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Al=new Yt("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX");var Ur={3:zt,5:vr,6:Nr},Jt=r=>[3,4,5,6].indexOf(r)!==-1,Xt=r=>{var a;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=r,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,s={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(a=s[e])==null?void 0:a.call(s)},Ie={"Standard SPL":0,"Option tokens":1},he={[Ir.toString()]:3,[Ar.toString()]:4,[Sr.toString()]:5,[qe.toString()]:6,[Re.FARM_PROGRAM_ID_V3.toString()]:3,[Re.FARM_PROGRAM_ID_V4.toString()]:4,[Re.FARM_PROGRAM_ID_V5.toString()]:5,[Re.FARM_PROGRAM_ID_V6.toString()]:6};import{PublicKey as v,SystemProgram as Hr,SYSVAR_CLOCK_PUBKEY as $e,SYSVAR_RENT_PUBKEY as Io,TransactionInstruction as oe}from"@solana/web3.js";import jr from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as od,createAssociatedTokenAccountIdempotentInstruction as id,TOKEN_PROGRAM_ID as we}from"@solana/spl-token";import Po from"bn.js";var ko=Y("Raydium.farm.util");function Qe({programId:r,poolId:e,mint:t,type:n}){let{publicKey:o}=Le([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function ae({programId:r,poolId:e,owner:t,version:n}){let{publicKey:o}=Le([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var Gr=({programId:r,poolId:e})=>Le([e.toBuffer()],r);function qr(r){return{isSet:new Po(1),rewardPerSecond:D(r.perSecond),rewardOpenTime:D(r.openTime),rewardEndTime:D(r.endTime),rewardType:D(Ie[r.rewardType])}}function Zt(r){return D(r.endTime).sub(D(r.openTime)).mul(D(r.perSecond))}function Qt(r){let e=Ur[r];return e||ko.logWithError("invalid version",r),e}var Ao=Y("Raydium_farm_instruction"),gd={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function $t(r){let{version:e,id:t,ledger:n,programId:o,owner:s}=r,a={3:9,5:10}[e];a||Ao.logWithError(`invalid farm pool version: ${e}`);let i=Buffer.alloc(Ut.span);Ut.encode({instruction:a},i);let f=[c({pubkey:t}),c({pubkey:n}),c({pubkey:s,isWritable:!1}),c({pubkey:Hr.programId,isWritable:!1}),c({pubkey:Io,isWritable:!1})];return{instruction:new oe({programId:o,keys:f,data:i}),instructionType:q.FarmV3CreateLedger}}function zr(r){var n;let e=Buffer.alloc(qt.span);qt.encode({instruction:0,nonce:new jr(r.nonce),rewardTimeInfo:r.rewardInfoConfig},e);let t=[...Pt,c({pubkey:r.farmId}),c({pubkey:r.farmAuthority,isWritable:!1}),c({pubkey:r.lpVault}),c({pubkey:r.lpMint,isWritable:!1}),c({pubkey:r.lockVault}),c({pubkey:r.lockMint,isWritable:!1}),c({pubkey:(n=r.lockUserAccount)!=null?n:Q}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let o of r.rewardInfo)t.push(c({pubkey:o.rewardMint,isWritable:!1}),c({pubkey:o.rewardVault}),c({pubkey:o.userRewardToken}));return{instruction:new oe({programId:r.programId,keys:t,data:e}),instructionType:q.FarmV6Create}}function Yr(r){let e=Buffer.alloc(Gt.span);Gt.encode({instruction:5},e);let t=[c({pubkey:we,isWritable:!1}),c({pubkey:r.id}),c({pubkey:r.authority,isWritable:!1}),c({pubkey:r.lpVault,isWritable:!1}),c({pubkey:r.rewardVault}),c({pubkey:r.userRewardToken}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new oe({programId:r.programId,keys:t,data:e}),instructionType:q.FarmV6CreatorWithdraw}}function er({payer:r,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:o}){let s=Buffer.alloc(Ht.span);Ht.encode({instruction:3,rewardReopenTime:D(o.openTime),rewardEndTime:D(o.endTime),rewardPerSecond:D(o.perSecond)},s);let a=[c({pubkey:we,isWritable:!1}),c({pubkey:n.id}),c({pubkey:n.lpVault,isWritable:!1}),c({pubkey:e}),c({pubkey:t}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new oe({programId:n.programId,keys:a,data:s})}function tr({payer:r,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:o}){let s=Buffer.alloc(jt.span);jt.encode({instruction:4,isSet:new jr(1),rewardPerSecond:D(o.perSecond),rewardOpenTime:D(o.openTime),rewardEndTime:D(o.endTime),rewardType:D(Ie[o.rewardType])},s);let a=[...Pt,c({pubkey:t.id}),c({pubkey:t.authority,isWritable:!1}),c({pubkey:o.mint,isWritable:!1}),c({pubkey:n}),c({pubkey:e}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new oe({programId:t.programId,keys:a,data:s})}function rr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new v(e.programId),new v(e.id)],d=ae({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(ne.span);ne.encode({instruction:2,amount:D(a)},m);let u=[c({pubkey:we,isWritable:!1}),c({pubkey:f}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:new v(t.lpVault)}),c({pubkey:d}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)u.push(c({pubkey:new v(t.rewardInfos[p].vault)})),u.push(c({pubkey:o[p]}));return new oe({programId:i,keys:u,data:m})}function nr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new v(e.programId),new v(e.id)],m=ae({programId:f,poolId:d,owner:s,version:5}),u=Buffer.alloc(ne.span);ne.encode({instruction:12,amount:D(a)},u);let p=[c({pubkey:d}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:$e,isWritable:!1}),c({pubkey:we,isWritable:!1})];for(let w=1;w<t.rewardInfos.length;w++)p.push(c({pubkey:o[w]})),p.push(c({pubkey:new v(t.rewardInfos[w].vault)}));if(i)for(let w of i)p.push(c({pubkey:w}));return new oe({programId:f,keys:p,data:u})}function Jr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new v(e.programId),new v(e.id)],m=H([J("instruction"),T("amount")]),u=[c({pubkey:d}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:i[0]}),c({pubkey:s,isSigner:!0,isWritable:!1}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:$e,isWritable:!1}),c({pubkey:we,isWritable:!1}),c({pubkey:o[1]}),c({pubkey:new v(t.rewardInfos[1].vault)})],p=Buffer.alloc(m.span);return m.encode({instruction:2,amount:a},p),new oe({keys:u,programId:f,data:p})}function or(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new v(e.programId),new v(e.id)],m=ae({programId:f,poolId:d,owner:s,version:3}),u=Buffer.alloc(ne.span);ne.encode({instruction:11,amount:D(a)},u);let p=[c({pubkey:d}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:$e,isWritable:!1}),c({pubkey:we,isWritable:!1})];if(i)for(let w of i)p.push(c({pubkey:w}));return new oe({programId:f,keys:p,data:u})}function Xr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new v(e.programId),new v(e.id)],m=ae({programId:f,poolId:d,owner:s,version:3}),u=Buffer.alloc(ne.span);ne.encode({instruction:10,amount:D(a)},u);let p=[c({pubkey:d}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:$e,isWritable:!1}),c({pubkey:we,isWritable:!1})];if(i)for(let w of i)p.push(c({pubkey:w}));return new oe({programId:f,keys:p,data:u})}function Zr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new v(e.programId),new v(e.id)],m=ae({programId:f,poolId:d,owner:s,version:5}),u=Buffer.alloc(ne.span);ne.encode({instruction:11,amount:D(a)},u);let p=[c({pubkey:d}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:$e,isWritable:!1}),c({pubkey:we,isWritable:!1})];for(let w=1;w<t.rewardInfos.length;w++)p.push(c({pubkey:o[w]})),p.push(c({pubkey:new v(t.rewardInfos[w].vault)}));if(i)for(let w of i)p.push(c({pubkey:w}));return new oe({programId:f,keys:p,data:u})}function Qr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new v(e.programId),new v(e.id)],d=ae({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(ne.span);ne.encode({instruction:1,amount:D(a)},m);let u=[c({pubkey:we,isWritable:!1}),c({pubkey:Hr.programId,isWritable:!1}),c({pubkey:f}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:new v(t.lpVault)}),c({pubkey:d}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)u.push(c({pubkey:new v(t.rewardInfos[p].vault)})),u.push(c({pubkey:o[p]}));return new oe({programId:i,keys:u,data:m})}var ir=class extends Ze{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(Q)){let n=await Ot({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:Zt(X(G({},t),{openTime:t.openTime.toString(),endTime:t.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:o=qe,txVersion:s,feePayer:a,lockProgram:i}){var A,k;this.checkDisabled(),this.scope.checkOwner();let d={lpMint:new U(e.lpMint.address),lockInfo:{lockMint:(A=i==null?void 0:i.mint)!=null?A:Or,lockVault:(k=i==null?void 0:i.vault)!=null?k:Wr},version:6,rewardInfos:t,programId:o},m=this.createTxBuilder(a),u=n!=null?n:this.scope.ownerPubKey,p=ft({fromPublicKey:u,programId:d.programId}),w=await this.scope.connection.getMinimumBalanceForRentExemption(yt.span);m.addInstruction({instructions:[So.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:p.seed,newAccountPubkey:p.publicKey,lamports:w,space:yt.span,programId:d.programId})]});let{publicKey:l,nonce:x}=Gr({programId:new U(d.programId),poolId:p.publicKey}),y=Qe({programId:d.programId,poolId:p.publicKey,mint:d.lpMint,type:"lpVault"}),B=[],S=[];for(let L of d.rewardInfos){L.openTime>=L.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",L.openTime.toString()),isNaN(Ie[L.rewardType])&&this.logAndCreateError("rewardType error",L.rewardType),Number(L.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",L.perSecond),B.push(qr(L));let{rewardPubKey:R,newInstruction:V}=await this._getUserRewardInfo({rewardInfo:L,payer:u});V&&m.addInstruction(V),R||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let P=L.mint.equals(Q)?new U(re.address):L.mint;S.push({rewardMint:P,rewardVault:Qe({programId:d.programId,poolId:p.publicKey,mint:P,type:"rewardVault"}),userRewardToken:R})}let{account:_,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({mint:new U(d.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});g&&m.addInstruction(g),_||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:h,instructionType:b}=zr({farmId:p.publicKey,owner:this.scope.ownerPubKey,farmAuthority:l,lpVault:y,lpMint:d.lpMint,lockVault:d.lockInfo.lockVault,lockMint:d.lockInfo.lockMint,lockUserAccount:_,programId:d.programId,rewardInfo:S,rewardInfoConfig:B,nonce:x});return m.addInstruction({instructions:[h],instructionTypes:[b]}).versionBuild({txVersion:s,extInfo:{farmId:p.publicKey,farmAuthority:l,lpVault:y,lockUserAccount:_,nonce:x}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:o,feePayer:s}){var B;let a=he[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=ge((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let d=t||this.scope.ownerPubKey,m=n.mint.equals(Q)?new U(re.address):n.mint,u=f.rewardInfos.findIndex(S=>new U(S.mint.address).equals(m)),p=i.rewardInfos[u];p||this.logAndCreateError("configuration does not exist","rewardMint",m);let w=(B=p.vault)!=null?B:Q,l=this.createTxBuilder(s),{rewardPubKey:x,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:n,payer:d});return y&&l.addInstruction(y),x||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),l.addInstruction({instructions:[er({payer:this.scope.ownerPubKey,rewardVault:w,userRewardTokenPub:x,farmKeys:f,rewardInfo:n})],instructionTypes:[q.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:o,feePayer:s}){var u;let a=he[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=ge((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.forEach(p=>{p.openTime>=p.endTime&&this.logAndCreateError("start time error","newRewardInfo",p)});let d=t||this.scope.ownerPubKey,m=this.createTxBuilder(s);for(let p of n){let w=p.mint.equals(Q)?new U(re.address):p.mint,l=f.rewardInfos.findIndex(g=>new U(g.mint.address).equals(w)),x=i.rewardInfos[l];x||this.logAndCreateError("configuration does not exist","rewardMint",w);let y=(u=x.vault)!=null?u:Q,{rewardPubKey:B,newInstruction:S}=await this._getUserRewardInfo({rewardInfo:p,payer:d});S&&m.addInstruction(S),B||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let _=er({payer:this.scope.ownerPubKey,rewardVault:y,userRewardTokenPub:B,farmKeys:f,rewardInfo:p});m.addInstruction({instructions:[_],instructionTypes:[q.FarmV6Restart]})}return m.versionBuild({txVersion:o})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:o,payer:s,feePayer:a}=e,i=he[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=ge((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),d=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a),u=o.mint.equals(Q)?new U(re.address):o.mint,p=Qe({programId:new U(n.programId),poolId:new U(n.id),mint:u,type:"rewardVault"}),{rewardPubKey:w,newInstruction:l}=await this._getUserRewardInfo({rewardInfo:o,payer:d});return l&&m.addInstruction(l),w||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=u,m.addInstruction({instructions:[tr({payer:this.scope.ownerPubKey,userRewardTokenPub:w,farmKeys:f,rewardVault:p,rewardInfo:o})],instructionTypes:[q.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:o,payer:s,feePayer:a}=e,i=he[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=ge((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),d=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a);for(let u of o){let p=u.mint.equals(Q)?new U(re.address):u.mint,w=Qe({programId:new U(n.programId),poolId:new U(n.id),mint:p,type:"rewardVault"}),{rewardPubKey:l,newInstruction:x}=await this._getUserRewardInfo({rewardInfo:u,payer:d});x&&m.addInstruction(x),l||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let y=tr({payer:this.scope.ownerPubKey,userRewardTokenPub:l,farmKeys:f,rewardVault:w,rewardInfo:X(G({},u),{mint:p})});m.addInstruction({instructions:[y],instructionTypes:[q.FarmV6CreatorAddReward]})}return m.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:o,feePayer:s,useSOLBalance:a,associatedOnly:i=!0,checkCreateATAOwner:f=!1,userAuxiliaryLedgers:d,computeBudgetConfig:m,txTipConfig:u}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:p,programId:w}=n,l=he[w];l===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),Jt(l)||this.logAndCreateError("invalid farm program:",n.programId);let[x,y]=[new U(n.programId),new U(n.id)],B=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],S=ae({programId:x,poolId:y,owner:this.scope.ownerPubKey,version:l}),_=this.createTxBuilder(s);_.addCustomComputeBudget(m),_.addTipInstruction(u);let g={};for(let I of this.scope.account.tokenAccounts)if(i){let O=Ve(this.scope.ownerPubKey,I.mint,I.programId).publicKey;I.publicKey&&O.equals(I.publicKey)&&(g[I.mint.toString()]=I.publicKey)}else g[I.mint.toString()]=I.publicKey;let h=B.lpMint,b=g[h.address];b||this.logAndCreateError("you don't have any lp","lp zero",g);let A=[];for(let I of p){let O=a&&I.mint.address===ce.toString(),N=g[I.mint.address];if(!N){let{account:ee,instructionParams:$}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:I.mint.programId,mint:new U(I.mint.address),notUseTokenAccount:O,createInfo:{payer:s||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!O,associatedOnly:O?!1:i,checkCreateATAOwner:f});N=ee,$&&_.addInstruction($)}g[I.mint.address]=N,A.push(N)}let k,L=await this.scope.connection.getAccountInfo(S);if(L&&(k=Qt(l).decode(L.data)),n.programId!==qe.toString()&&n.programId!==Re.FARM_PROGRAM_ID_V6.toString()&&!k){let{instruction:I,instructionType:O}=$t({id:y,programId:x,version:l,ledger:S,owner:this.scope.ownerPubKey});_.addInstruction({instructions:[I],instructionTypes:[O]})}let R=Xt({version:l,rewardInfos:p,rewardTokenAccountsPublicKeys:A});R&&this.logAndCreateError(R);let V={amount:D(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:B,lpAccount:b,rewardAccounts:A,userAuxiliaryLedgers:d==null?void 0:d.map(I=>new U(I))},P=l===6?Qr(V):l===5?Zr(V):Xr(V),K={3:q.FarmV3Deposit,5:q.FarmV5Deposit,6:q.FarmV6Deposit};return _.addInstruction({instructions:[P],instructionTypes:[K[l]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:o,deposited:s,useSOLBalance:a,feePayer:i,associatedOnly:f=!0,checkCreateATAOwner:d=!1,userAuxiliaryLedgers:m,computeBudgetConfig:u,txTipConfig:p}=e,{rewardInfos:w}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let l=he[n.programId];Jt(l)||this.logAndCreateError("invalid farm program:",n.programId);let x=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],y=this.createTxBuilder(i);y.addCustomComputeBudget(u),y.addTipInstruction(p);let B={};for(let R of this.scope.account.tokenAccounts)if(f){let V=Ve(this.scope.ownerPubKey,R.mint).publicKey;R.publicKey&&V.equals(R.publicKey)&&(B[R.mint.toString()]=R.publicKey)}else B[R.mint.toString()]=R.publicKey;if(l!==4){let R=ae({programId:new U(n.programId),poolId:new U(n.id),owner:this.scope.ownerPubKey,version:l}),V=await this.scope.connection.getAccountInfo(R);if(V)Qt(l).decode(V.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(l!==6){let{instruction:P,instructionType:K}=$t({id:new U(x.id),programId:new U(x.programId),version:l,ledger:R,owner:this.scope.ownerPubKey});y.addInstruction({instructions:[P],instructionTypes:[K]})}}s&&s.isZero()&&!(m||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let S=x.lpMint.address,_=a&&S===ce.toString(),g=B[S.toString()];if(!g){let{account:R,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:x.lpMint.programId,mint:new U(S),notUseTokenAccount:_,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:_?!1:f,checkCreateATAOwner:d});g=R,V&&y.addInstruction(V)}B[S.toString()]=g;let h=[];for(let R of w){let V=a&&R.mint.address===ce.toString(),P=B[R.mint.address];if(!P){let{account:K,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:R.mint.programId,mint:new U(R.mint.address),notUseTokenAccount:V,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!V,associatedOnly:V?!1:f,checkCreateATAOwner:d});P=K,I&&y.addInstruction(I)}B[R.mint.address]=P,h.push(P)}let b=Xt({version:l,rewardInfos:w,rewardTokenAccountsPublicKeys:h});b&&this.logAndCreateError(b);let A={amount:D(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:x,lpAccount:g,rewardAccounts:h,userAuxiliaryLedgers:m==null?void 0:m.map(R=>new U(R))},k=l===6?rr(A):l===5?nr(A):l===4?Jr(A):or(A),L={3:q.FarmV3Withdraw,4:q.FarmV4Withdraw,5:q.FarmV5Withdraw,6:q.FarmV6Withdraw};return y.addInstruction({instructions:[k],instructionTypes:[L[l]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){var x;this.scope.checkOwner();let i=ge((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f=he[e.programId];f!==6&&this.logAndCreateError("invalid farm version",f);let d=i.rewardInfos.find(y=>tt(y.mint.address).equals(tt(t)));d||this.logAndCreateError("withdraw mint error","rewardInfos",e);let m=(x=d==null?void 0:d.vault)!=null?x:Q,u=this.createTxBuilder(a),p;if(t.equals(Q)||t.equals(U.default)){let y=await Ot({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:Zt(X(G({},d),{openTime:d.openTime,endTime:d.endTime,perSecond:new Lo(d.perSecond).mul(10**d.mint.decimals).toString()}))});p=y.addresses.newAccount,u.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(p=await this.scope.account.getAssociatedTokenAccount(t),u.addInstruction({instructions:[$r(this.scope.ownerPubKey,p,this.scope.ownerPubKey,t)],instructionTypes:[q.CreateATA]})):p=y}let{instruction:w,instructionType:l}=Yr({programId:i.programId,id:i.id,authority:i.authority,lpVault:i.lpVault,rewardVault:m,userRewardToken:p,owner:this.scope.ownerPubKey});return u.addCustomComputeBudget(o),u.addTipInstruction(s),u.addInstruction({instructions:[w],instructionTypes:[l]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:o,associatedOnly:s=!0,checkCreateATAOwner:a=!1,userAuxiliaryLedgers:i,txVersion:f,computeBudgetConfig:d}=e,m=this.createTxBuilder(o),u={};for(let l of this.scope.account.tokenAccounts)if(s){let x=Ve(this.scope.ownerPubKey,l.mint).publicKey;l.publicKey&&x.equals(l.publicKey)&&(u[l.mint.toString()]=l.publicKey)}else u[l.mint.toString()]=l.publicKey;let w=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(l=>l.id).join(",")})).reduce((l,x)=>X(G({},l),{[x.id]:x}),{});for(let l of Object.values(t)){let{programId:x,lpMint:y,rewardInfos:B,id:S}=l,_=he[x],g=y.address,h=n&&g===ce.toString(),b=u[g];if(!b){let{account:P,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.programId,mint:new U(g),notUseTokenAccount:h,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:h?!1:s,checkCreateATAOwner:a});b=P,K&&m.addInstruction(K)}u[g.toString()]=b;let A=[];for(let P of B){let K=n&&P.mint.address===ce.toString(),I=u[P.mint.address];if(!I)if(K){let{account:O,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:P.mint.programId,mint:new U(P.mint.address),notUseTokenAccount:K,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!K,associatedOnly:K?!1:s,checkCreateATAOwner:a});I=O,N&&m.addInstruction(N)}else{let O=new U(P.mint.address);I=this.scope.account.getAssociatedTokenAccount(O),m.addInstruction({instructions:[$r(this.scope.ownerPubKey,I,this.scope.ownerPubKey,O)]})}u[P.mint.address]=I,A.push(I)}let k=w[S],L={amount:Bt,owner:this.scope.ownerPubKey,farmInfo:l,farmKeys:k,lpAccount:b,rewardAccounts:A,userAuxiliaryLedgers:i==null?void 0:i.map(P=>new U(P))},R=_===6?rr(L):_===5?nr(L):or(L),V={3:q.FarmV3Withdraw,5:q.FarmV5Withdraw,6:q.FarmV6Withdraw};m.addInstruction({instructions:[R],instructionTypes:[V[_]]})}return f===1?m.sizeCheckBuild({computeBudgetConfig:d}):m.sizeCheckBuildV0({computeBudgetConfig:d})}};export{ir as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.mjs.map