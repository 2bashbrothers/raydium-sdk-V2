var $r=Object.defineProperty,en=Object.defineProperties;var tn=Object.getOwnPropertyDescriptors;var He=Object.getOwnPropertySymbols;var or=Object.prototype.hasOwnProperty,ir=Object.prototype.propertyIsEnumerable;var nr=(r,e,t)=>e in r?$r(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,G=(r,e)=>{for(var t in e||(e={}))or.call(e,t)&&nr(r,t,e[t]);if(He)for(var t of He(e))ir.call(e,t)&&nr(r,t,e[t]);return r},Z=(r,e)=>en(r,tn(e));var ze=(r,e)=>{var t={};for(var n in r)or.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&He)for(var n of He(r))e.indexOf(n)<0&&ir.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as O,SystemProgram as ko}from"@solana/web3.js";import{createAssociatedTokenAccountIdempotentInstruction as Jr}from"@solana/spl-token";import{PublicKey as on}from"@solana/web3.js";import{get as sr,set as rn}from"lodash";var pt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ar={},nn={};function X(r){let e=sr(ar,r);if(!e){let t=sr(nn,r);e=new pt({name:r,logLevel:t}),rn(ar,r,e)}return e}import{MINT_SIZE as Do,TOKEN_PROGRAM_ID as Eo,getTransferFeeConfig as vo,unpackMint as No}from"@solana/spl-token";var mt=X("Raydium_accountInfo_util");async function ur(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:s=100}=G({batchRequest:!1},t),a=ft(e,s),i=new Array(a.length).fill([]);if(n){let f=a.map(u=>{let d=r._buildArgs([u.map(g=>g.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:d}}),l=ft(f,10);i=(await(await Promise.all(l.map(async u=>await r._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(d=>{if(d){let{data:g,executable:p,lamports:w,owner:y,rentEpoch:L}=d;return g.length!==2&&g[1]!=="base64"&&mt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(g[0],"base64"),executable:p,lamports:w,owner:new on(y),rentEpoch:L}}return null})))}else try{i=await Promise.all(a.map(f=>r.getMultipleAccountsInfo(f,o)))}catch(f){f instanceof Error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return i.flat()}import le from"bn.js";import ws from"decimal.js";import mn from"big.js";import Je from"bn.js";import sn from"toformat";var an=sn,Ke=an;import Ze from"big.js";import cn from"bn.js";import ln from"decimal.js-light";import Ce from"bn.js";var cr=9007199254740991;function D(r){let e=X("Raydium_parseBigNumberish");if(r instanceof Ce)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Ce(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=cr||r<=-cr)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Ce(String(r))):typeof r=="bigint"?new Ce(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Ce(0))}var Ye=X("module/fraction"),yt=Ke(Ze),Ve=Ke(ln),dn={[0]:Ve.ROUND_DOWN,[1]:Ve.ROUND_HALF_UP,[2]:Ve.ROUND_UP},pn={[0]:Ze.roundDown,[1]:Ze.roundHalfUp,[2]:Ze.roundUp},N=class{constructor(e,t=new cn(1)){this.numerator=D(e),this.denominator=D(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(e){let t=e instanceof N?e:new N(D(e));return this.denominator.eq(t.denominator)?new N(this.numerator.add(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof N?e:new N(D(e));return this.denominator.eq(t.denominator)?new N(this.numerator.sub(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof N?e:new N(D(e));return new N(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof N?e:new N(D(e));return new N(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ye.logWithError(`${e} is not an integer.`),e<=0&&Ye.logWithError(`${e} is not positive.`),Ve.set({precision:e+1,rounding:dn[n]});let o=new Ve(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ye.logWithError(`${e} is not an integer.`),e<0&&Ye.logWithError(`${e} is negative.`),yt.DP=e,yt.RM=pn[n]||1,new yt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var fn=X("Raydium_amount"),lr=Ke(mn);function yn(r,e){let t="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([t,n]=o,n=n.padEnd(e,"0")):fn.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var ae=class extends N{constructor(t,n,o=!0,s){let a=new Je(0),i=gt.pow(new Je(t.decimals));if(o)a=D(n);else{let f=new Je(0),l=new Je(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,u]=yn(n.toString(),t.decimals);f=D(m),l=D(u)}f=f.mul(i),a=f.add(l)}super(a,i);this.logger=X(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ae(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ae(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return lr.DP=this.token.decimals,new lr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as gn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as dr}from"@solana/spl-token";var pr={chainId:101,address:gn.default.toBase58(),programId:dr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Q={chainId:101,address:"So11111111111111111111111111111111111111112",programId:dr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as xt}from"@solana/web3.js";import{PublicKey as H,SystemProgram as mr,SYSVAR_RENT_PUBKEY as bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wn}from"@solana/spl-token";function c({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var bt=[c({pubkey:wn,isWritable:!1}),c({pubkey:mr.programId,isWritable:!1}),c({pubkey:bn,isWritable:!1})];function wt({publicKey:r,transformSol:e}){let t=ht(r.toString());if(t instanceof H)return e&&t.equals(J)?se:t;if(e&&t.toString()===J.toBase58())return se;if(typeof t=="string"){if(t===H.default.toBase58())return H.default;try{return new H(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ht(r){try{return new H(r)}catch{return r}}var bi=new H("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),wi=new H("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),hn=new H("SysvarRent111111111111111111111111111111111"),hi=new H("SysvarC1ock11111111111111111111111111111111"),xi=new H("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),xn=new H("Sysvar1nstructions1111111111111111111111111"),Ti=mr.programId,Pi=new H("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ai=new H("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ki=new H("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ii=new H("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Si=new H("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Li=new H("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ri=new H("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Bi=new H("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ki=new H("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ci=new H("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Vi=new H("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),se=new H("So11111111111111111111111111111111111111112"),J=H.default;function Xe(r){return wt({publicKey:r,transformSol:!0})}var Tt=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:s=!1,isToken2022:a=!1}){if(e===J.toBase58()||e instanceof xt&&J.equals(e)){this.decimals=Q.decimals,this.symbol=Q.symbol,this.name=Q.name,this.mint=new xt(Q.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?xt.default:wt({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},we=Tt;we.WSOL=new Tt(Z(G({},Q),{mint:Q.address}));var Pt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Qe=Pt;Qe.SOL=new Pt(pr);import Tn from"bn.js";var fr=new N(new Tn(100)),Ae=class extends N{toSignificant(e=5,t,n){return this.mul(fr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(fr).toFixed(e,t,n)}};var Pn=X("Raydium_price"),ue=class extends N{constructor(t){let{baseToken:n,quoteToken:o,numerator:s,denominator:a}=t;super(s,a);this.baseToken=n,this.quoteToken=o,this.scalar=new N(At(n.decimals),At(o.decimals))}get raw(){return new N(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ue({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Pn.logWithError("mul token not equals");let n=super.mul(t);return new ue({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};import{PublicKey as An}from"@solana/web3.js";import kn from"bn.js";function yr(r){return typeof r=="object"&&r!==null&&![we,ae,An,N,kn,ue,Ae].some(e=>typeof e=="object"&&r instanceof e)}function ce(r){return typeof r=="string"?ht(r):Array.isArray(r)?r.map(e=>ce(e)):yr(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,ce(t)])):r}var kt=new le(0),Rs=new le(1),Bs=new le(2),Ks=new le(3),Cs=new le(5),gt=new le(10),Vs=new le(100),Fs=new le(1e3),_s=new le(1e4);function At(r){return gt.pow(D(r))}function ft(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Cn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Vn}from"@solana/spl-token";import{ComputeBudgetProgram as gr,Keypair as wr,PublicKey as In,Transaction as hr,TransactionMessage as Sn,VersionedTransaction as xr}from"@solana/web3.js";var W={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Ln}from"@solana/spl-token";var br=X("Raydium_txUtil"),Tr=1644;function $e(r){let e=[],t=[];return r.microLamports&&(e.push(gr.setComputeUnitPrice({microLamports:r.microLamports})),t.push(W.SetComputeUnitPrice)),r.units&&(e.push(gr.setComputeUnitLimit({units:r.units})),t.push(W.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ke(r,e){var n,o;let t=e!=null?e:"confirmed";return(o=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:o.blockhash}async function et(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let o=setTimeout(n,6e4);r.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function Rn(r,e){r.length<1&&br.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&br.logWithError(`no signers provided:, ${e.toString()}`);let t=new hr;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Tr}catch{return!1}}function he(r,e){let[t,n]=In.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Fe({instructions:r,payer:e,signers:t}){return Rn(r,[e,...t])}function _e({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=wr.generate().publicKey.toString()}){let s=new Sn({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new xr(s).serialize()).toString("base64").length<Tr}catch{return!1}}var Bn=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Kn=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof xr&&(e=Bn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function xe(r){let e=[];return r.forEach(t=>{t instanceof hr&&(t.recentBlockhash||(t.recentBlockhash=Ln.toBase58()),t.feePayer||(t.feePayer=wr.generate().publicKey)),e.push(Kn(t))}),console.log("simulate tx string:",e),e}function Ie(r,e,t){return he([r.toBuffer(),(t!=null?t:Vn).toBuffer(),e.toBuffer()],new Cn("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as k}from"@solana/web3.js";var Pr=new k("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ar=new k("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),kr=new k("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Me=new k("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ta=new k("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ra=new k("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),na=new k("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),oa=new k("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ia=new k("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),sa=new k("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),aa=new k("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ua=new k("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ca=new k("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),la=new k("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),da=new k("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),pa=new k("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ma=new k("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),fa=new k("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ya=new k("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ga=new k("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ba=new k("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),wa=new k("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ha=new k("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),xa=new k("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ta=new k("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Pa=new k("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Aa=new k("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ka=new k("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ia=new k("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Sa=new k("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),La=new k("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Te={OPEN_BOOK_PROGRAM:new k("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new k("Ray1111111111111111111111111111111111111111"),AMM_V4:new k("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new k("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new k("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new k("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new k("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new k("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new k("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new k("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new k("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new k("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:k.default,Router:new k("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new k("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new k("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new k("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new k("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new k("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new k("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new k("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new k("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new k("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new k("Ray1111111111111111111111111111111111111111")};import Ka from"bn.js";import{PublicKey as It,AddressLookupTableAccount as Le}from"@solana/web3.js";async function St({connection:r,address:e,cluster:t="mainnet"}){let n=await ur(r,[...new Set(e.map(s=>s.toString()))].map(s=>new It(s))),o={};for(let s=0;s<e.length;s++){let a=n[s],i=e[s];if(!a)continue;let f=new Le({key:i,state:Le.deserialize(a.data)});o[i.toString()]=f,t==="devnet"?Se[i.toString()]=f:tt[i.toString()]=f}return o}var tt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Le({key:new It("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Le.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Se={},Lt=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Se[e])return Se;let t=new It(e),n=await r.getAccountInfo(t);return n&&(Se[e]=new Le({key:t,state:Le.deserialize(n.data)})),Se};import{PublicKey as Re,sendAndConfirmTransaction as Rt,SystemProgram as _n,Transaction as De,TransactionMessage as Ee,VersionedTransaction as ve}from"@solana/web3.js";import Mn from"axios";var rt=2e3,nt=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Mn.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=$e(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(_n.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Re(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(W.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:a=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...a.filter(i=>i!==Re.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(G({},t||{})):this.build(t)}build(e){var n;let t=new De;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var m;let{recentBlockHash:s,skipPreflight:a=!0,sendAndConfirm:i,notSendToRpc:f}=o||{},l=s!=null?s:await ke(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),xe([t]),(m=this.owner)!=null&&m.isKeyPair)return{txId:i?await Rt(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:a}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);if(this.signers.length)for(let d of u)try{d.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:a}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:o}=this.build(n),s=t.filter(m=>m.transaction.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:i,instructionTypes:f,execute:async m=>{var L;let{sequentially:u,onTxUpdate:d,skipTxCount:g=0,recentBlockHash:p,skipPreflight:w=!0}=m||{},y=p!=null?p:await ke(this.connection,this.blockhashCommitment);if((L=this.owner)!=null&&L.isKeyPair){if(u){let P=[],C=0;for(let h of a){if(++C,C<=g)continue;let x=await Rt(this.connection,h,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});P.push(x)}return{txIds:P,signedTxs:a}}return{txIds:await await Promise.all(a.map(async P=>(P.recentBlockhash=y,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:w})))),signedTxs:a}}if(this.signAllTransactions){let P=a.map((h,x)=>(h.recentBlockhash=y,i[x].length&&h.sign(...i[x]),h));xe(P);let C=await this.signAllTransactions(P);if(u){let h=0,x=[],T=async()=>{if(!C[h])return;let I=await this.connection.sendRawTransaction(C[h].serialize(),{skipPreflight:w});x.push({txId:I,status:"sent",signedTx:C[h]}),d==null||d([...x]),h++;let R=!1,B=null,A=null,_=S=>{B!==null&&clearInterval(B),A!==null&&this.connection.removeSignatureListener(A);let M=x.findIndex(K=>K.txId===I);if(M>-1){if(x[M].status==="error"||x[M].status==="success")return;x[M].status=S.err?"error":"success"}d==null||d([...x]),S.err||T()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var S;if(R){clearInterval(B);return}try{let M=await this.connection.getTransaction(I,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(R=!0,clearInterval(B),_({err:((S=M.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",I))}catch(M){R=!0,clearInterval(B),console.error("getTransaction timeout:",M,I)}},rt)),A=this.connection.onSignature(I,S=>{if(R){this.connection.removeSignatureListener(A);return}R=!0,_(S)},"confirmed"),this.connection.getSignatureStatus(I)};return await T(),{txIds:x.map(I=>I.txId),signedTxs:C}}else{let h=[];for(let x=0;x<C.length;x+=1){let T=await this.connection.sendRawTransaction(C[x].serialize(),{skipPreflight:w});h.push(T)}return{txIds:h,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var w;let p=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:s}=p,a=ze(p,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=G(G({},this.cluster==="devnet"?await Lt(this.connection):tt),t),f=Array.from(new Set([...n,...this.lookupTableAddress])),l=[];for(let y of f)i[y]===void 0&&l.push(new Re(y));let m=await St({connection:this.connection,address:l});for(let[y,L]of Object.entries(m))i[y]=L;let u=o?Re.default.toBase58():s!=null?s:await ke(this.connection,this.blockhashCommitment),d=new Ee({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((w=this.owner)==null?void 0:w.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let g=new ve(d);return g.sign(this.signers),{builder:this,transaction:g,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var h;let{skipPreflight:L=!0,sendAndConfirm:P,notSendToRpc:C}=y||{};if(xe([g]),(h=this.owner)!=null&&h.isKeyPair){let x=await this.connection.sendTransaction(g,{skipPreflight:L});return P&&await et(this.connection,x),{txId:x,signedTx:g}}if(this.signAllTransactions){let x=await this.signAllTransactions([g]);if(this.signers.length)for(let T of x)try{T.sign(this.signers)}catch{}return{txId:C?"":await this.connection.sendTransaction(x[0],{skipPreflight:L}),signedTx:x[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),s=t.filter(m=>m.builder.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(m,u)=>{m.sign(i[u])}),{builder:this,transactions:a,signers:i,instructionTypes:f,buildProps:n,execute:async m=>{var w;let{sequentially:u,onTxUpdate:d,recentBlockHash:g,skipPreflight:p=!0}=m||{};if(g&&a.forEach(y=>y.message.recentBlockhash=g),xe(a),(w=this.owner)!=null&&w.isKeyPair){if(u){let y=[];for(let L of a){let P=await this.connection.sendTransaction(L,{skipPreflight:p});await et(this.connection,P),y.push(P)}return{txIds:y,signedTxs:a}}return{txIds:await Promise.all(a.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:p}))),signedTxs:a}}if(this.signAllTransactions){let y=await this.signAllTransactions(a);if(u){let L=0,P=[],C=async()=>{if(!y[L])return;let h=await this.connection.sendTransaction(y[L],{skipPreflight:p});P.push({txId:h,status:"sent",signedTx:y[L]}),d==null||d([...P]),L++;let x=!1,T=null,I=null,R=B=>{T!==null&&clearInterval(T),I!==null&&this.connection.removeSignatureListener(I);let A=P.findIndex(_=>_.txId===h);if(A>-1){if(P[A].status==="error"||P[A].status==="success")return;P[A].status=B.err?"error":"success"}d==null||d([...P]),B.err||C()};this.loopMultiTxStatus&&(T=setInterval(async()=>{var B;if(x){clearInterval(T);return}try{let A=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});A&&(x=!0,clearInterval(T),R({err:((B=A.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",h))}catch(A){x=!0,clearInterval(T),console.error("getTransaction timeout:",A,h)}},rt)),I=this.connection.onSignature(h,B=>{if(x){this.connection.removeSignatureListener(I);return}x=!0,R(B)},"confirmed"),this.connection.getSignatureStatus(h)};return C(),{txIds:[],signedTxs:y}}else{let L=[];for(let P=0;P<y.length;P+=1){let C=await this.connection.sendTransaction(y[P],{skipPreflight:p});L.push(C)}return{txIds:L,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var d;let u=e||{},{splitIns:t=[],computeBudgetConfig:n}=u,o=ze(u,["splitIns","computeBudgetConfig"]),s=n?$e(n):{instructions:[],instructionTypes:[]},a=this.signers.reduce((g,p)=>Z(G({},g),{[p.publicKey.toBase58()]:p}),{}),i=[],f=[],l=[],m=0;if(this.allInstructions.forEach(g=>{let p=[...l,g],w=n?[...s.instructions,...p]:p,L=[...new Set(p.map(P=>P.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat()).values()].map(P=>new Re(P));if(g!==t[m]&&l.length<12&&(Fe({instructions:w,payer:this.feePayer,signers:L})||Fe({instructions:p,payer:this.feePayer,signers:L})))l.push(g);else{if(l.length===0)throw Error("item ins too big");m+=g===t[m]?1:0,Fe({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:L})?i.push(new De().add(...s.instructions,...l)):i.push(new De().add(...l)),f.push(Array.from(new Set(l.map(P=>P.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(P=>a[P]).filter(P=>P!==void 0)),l=[g]}}),l.length>0){let p=[...new Set(l.map(w=>w.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(w=>a[w]).filter(w=>w!==void 0);Fe({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:p.map(w=>w.publicKey)})?i.push(new De().add(...s.instructions,...l)):i.push(new De().add(...l)),f.push(p)}return i.forEach(g=>g.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&f.forEach(g=>{g.some(p=>p.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),{builder:this,transactions:i,signers:f,instructionTypes:this.instructionTypes,execute:async g=>{var h;let{sequentially:p,onTxUpdate:w,skipTxCount:y=0,recentBlockHash:L,skipPreflight:P=!0}=g||{},C=L!=null?L:await ke(this.connection,this.blockhashCommitment);if(i.forEach(async(x,T)=>{x.recentBlockhash=C,f[T].length&&x.sign(...f[T])}),xe(i),(h=this.owner)!=null&&h.isKeyPair){if(p){let x=0,T=[];for(let I of i){if(++x,x<=y){T.push("tx skipped");continue}let R=await Rt(this.connection,I,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:P});T.push(R)}return{txIds:T,signedTxs:i}}return{txIds:await Promise.all(i.map(async x=>await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:P}))),signedTxs:i}}if(this.signAllTransactions){let x=await this.signAllTransactions(i.slice(y,i.length)),T=[...i.slice(0,y),...x];if(p){let I=0,R=[],B=async()=>{if(!T[I])return;I<y&&(R.push({txId:"",status:"success",signedTx:T[I]}),w==null||w([...R]),I++,B());let A=await this.connection.sendRawTransaction(T[I].serialize(),{skipPreflight:P});R.push({txId:A,status:"sent",signedTx:T[I]}),w==null||w([...R]),I++;let _=!1,S=null,M=null,K=U=>{S!==null&&clearInterval(S),M!==null&&this.connection.removeSignatureListener(M);let j=R.findIndex(ne=>ne.txId===A);if(j>-1){if(R[j].status==="error"||R[j].status==="success")return;R[j].status=U.err?"error":"success"}w==null||w([...R]),U.err||B()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var U;if(_){clearInterval(S);return}try{let j=await this.connection.getTransaction(A,{commitment:"confirmed",maxSupportedTransactionVersion:0});j&&(_=!0,clearInterval(S),K({err:((U=j.meta)==null?void 0:U.err)||null}),console.log("tx status from getTransaction:",A))}catch(j){_=!0,clearInterval(S),console.error("getTransaction timeout:",j,A)}},rt)),M=this.connection.onSignature(A,U=>{if(_){this.connection.removeSignatureListener(M);return}_=!0,K(U)},"confirmed"),this.connection.getSignatureStatus(A)};return await B(),{txIds:R.map(A=>A.txId),signedTxs:T}}else{let I=[];for(let R=0;R<T.length;R+=1){let B=await this.connection.sendRawTransaction(T[R].serialize(),{skipPreflight:P});I.push(B)}return{txIds:I,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var C;let P=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=P,a=ze(P,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=G(G({},this.cluster==="devnet"?await Lt(this.connection):tt),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),l=[];for(let h of f)i[h]===void 0&&l.push(new Re(h));let m=await St({connection:this.connection,address:l});for(let[h,x]of Object.entries(m))i[h]=x;let u=t?$e(t):{instructions:[],instructionTypes:[]},d=await ke(this.connection,this.blockhashCommitment),g=this.signers.reduce((h,x)=>Z(G({},h),{[x.publicKey.toBase58()]:x}),{}),p=[],w=[],y=[],L=0;if(this.allInstructions.forEach(h=>{let x=[...y,h],T=t?[...u.instructions,...x]:x;if(h!==n[L]&&y.length<12&&(_e({instructions:T,payer:this.feePayer,lookupTableAddressAccount:i})||_e({instructions:x,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(h);else{if(y.length===0)throw Error("item ins too big");L+=h===n[L]?1:0;let I={};for(let R of[...new Set(f)])i[R]!==void 0&&(I[R]=i[R]);if(t&&_e({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:d})){let R=new Ee({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));p.push(new ve(R))}else{let R=new Ee({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(i));p.push(new ve(R))}w.push(Array.from(new Set(y.map(R=>R.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(R=>g[R]).filter(R=>R!==void 0)),y=[h]}}),y.length>0){let x=[...new Set(y.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(T=>g[T]).filter(T=>T!==void 0);if(t&&_e({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:d})){let T=new Ee({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));p.push(new ve(T))}else{let T=new Ee({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(i));p.push(new ve(T))}w.push(x)}return(C=this.owner)!=null&&C.signer&&w.forEach(h=>{h.some(x=>x.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),p.forEach((h,x)=>{h.sign(w[x])}),{builder:this,transactions:p,buildProps:e,signers:w,instructionTypes:this.instructionTypes,execute:async h=>{var A;let{sequentially:x,onTxUpdate:T,skipTxCount:I=0,recentBlockHash:R,skipPreflight:B=!0}=h||{};if(p.map(async(_,S)=>{w[S].length&&_.sign(w[S]),R&&(_.message.recentBlockhash=R)}),xe(p),(A=this.owner)!=null&&A.isKeyPair){if(x){let _=0,S=[];for(let M of p){if(++_,_<=I){console.log("skip tx: ",_),S.push("tx skipped");continue}let K=await this.connection.sendTransaction(M,{skipPreflight:B});await et(this.connection,K),S.push(K)}return{txIds:S,signedTxs:p}}return{txIds:await Promise.all(p.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:B}))),signedTxs:p}}if(this.signAllTransactions){let _=await this.signAllTransactions(p.slice(I,p.length)),S=[...p.slice(0,I),..._];if(x){let M=0,K=[],U=async()=>{if(!S[M])return;if(M<I){K.push({txId:"",status:"success",signedTx:S[M]}),T==null||T([...K]),M++,U();return}let j=await this.connection.sendTransaction(S[M],{skipPreflight:B});K.push({txId:j,status:"sent",signedTx:S[M]}),T==null||T([...K]),M++;let ne=!1,oe=null,je=null,rr=be=>{oe!==null&&clearInterval(oe),je!==null&&this.connection.removeSignatureListener(je);let ie=K.findIndex(Qr=>Qr.txId===j);if(ie>-1){if(K[ie].status==="error"||K[ie].status==="success")return;K[ie].status=be.err?"error":"success"}T==null||T([...K]),be.err||U()};this.loopMultiTxStatus&&(oe=setInterval(async()=>{var be;if(ne){clearInterval(oe);return}try{let ie=await this.connection.getTransaction(j,{commitment:"confirmed",maxSupportedTransactionVersion:0});ie&&(ne=!0,clearInterval(oe),rr({err:((be=ie.meta)==null?void 0:be.err)||null}),console.log("tx status from getTransaction:",j))}catch(ie){ne=!0,clearInterval(oe),console.error("getTransaction timeout:",ie,j)}},rt)),je=this.connection.onSignature(j,be=>{if(ne){this.connection.removeSignatureListener(je);return}ne=!0,rr(be)},"confirmed"),this.connection.getSignatureStatus(j)};return U(),{txIds:[],signedTxs:S}}else{let M=[];for(let K=0;K<S.length;K+=1){let U=await this.connection.sendTransaction(S[K],{skipPreflight:B});M.push(U)}return{txIds:M,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};import Dn from"bn.js";var Ya=new Dn(1e6);import{Keypair as Zn,PublicKey as Jn}from"@solana/web3.js";import Fc from"bn.js";import{TOKEN_PROGRAM_ID as Qn}from"@solana/spl-token";function En(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Bt(r,...e){if(!En(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function Kt(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Ir(r,e){Bt(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var it=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),te=(r,e)=>r<<32-e|r>>>e;var wu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function vn(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Ct(r){return typeof r=="string"&&(r=vn(r)),Bt(r),r}var ot=class{clone(){return this._cloneInto()}},hu={}.toString;function Sr(r){let e=n=>r().update(Ct(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Nn(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),s=BigInt(4294967295),a=Number(t>>o&s),i=Number(t&s),f=n?4:0,l=n?0:4;r.setUint32(e+f,a,n),r.setUint32(e+l,i,n)}var Lr=(r,e,t)=>r&e^~r&t,Rr=(r,e,t)=>r&e^r&t^e&t,st=class extends ot{constructor(e,t,n,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=it(this.buffer)}update(e){Kt(this);let{view:t,buffer:n,blockLen:o}=this;e=Ct(e);let s=e.length;for(let a=0;a<s;){let i=Math.min(o-this.pos,s-a);if(i===o){let f=it(e);for(;o<=s-a;a+=o)this.process(f,a);continue}n.set(e.subarray(a,a+i),this.pos),this.pos+=i,a+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Kt(this),Ir(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(n,0),a=0);for(let u=a;u<o;u++)t[u]=0;Nn(n,o-8,BigInt(this.length*8),s),this.process(n,0);let i=it(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=f/4,m=this.get();if(l>m.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)i.setUint32(4*u,m[u],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:s,destroyed:a,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=a,o%t&&e.buffer.set(n),e}};var On=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),fe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ye=new Uint32Array(64),Vt=class extends st{constructor(){super(64,32,8,!1),this.A=fe[0]|0,this.B=fe[1]|0,this.C=fe[2]|0,this.D=fe[3]|0,this.E=fe[4]|0,this.F=fe[5]|0,this.G=fe[6]|0,this.H=fe[7]|0}get(){let{A:e,B:t,C:n,D:o,E:s,F:a,G:i,H:f}=this;return[e,t,n,o,s,a,i,f]}set(e,t,n,o,s,a,i,f){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=i|0,this.H=f|0}process(e,t){for(let u=0;u<16;u++,t+=4)ye[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){let d=ye[u-15],g=ye[u-2],p=te(d,7)^te(d,18)^d>>>3,w=te(g,17)^te(g,19)^g>>>10;ye[u]=w+ye[u-7]+p+ye[u-16]|0}let{A:n,B:o,C:s,D:a,E:i,F:f,G:l,H:m}=this;for(let u=0;u<64;u++){let d=te(i,6)^te(i,11)^te(i,25),g=m+d+Lr(i,f,l)+On[u]+ye[u]|0,w=(te(n,2)^te(n,13)^te(n,22))+Rr(n,o,s)|0;m=l,l=f,f=i,i=a+g|0,a=s,s=o,o=n,n=g+w|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,i=i+this.E|0,f=f+this.F|0,l=l+this.G|0,m=m+this.H|0,this.set(n,o,s,a,i,f,l,m)}roundClean(){ye.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Br=Sr(()=>new Vt);import{PublicKey as zn}from"@solana/web3.js";import Fr,{isBN as _r}from"bn.js";import{bits as Ru,BitStructure as Bu,blob as Wn,Blob as Ku,cstr as Cu,f32 as Vu,f32be as Fu,f64 as _u,f64be as Mu,greedy as Du,Layout as Un,ns64 as Eu,ns64be as vu,nu64 as Nu,nu64be as Ou,offset as Wu,s16 as Uu,s16be as Gu,s24 as qu,s24be as ju,s32 as Hu,s32be as zu,s40 as Xu,s40be as Yu,s48 as Zu,s48be as Ju,s8 as Qu,seq as Gn,struct as $u,Structure as qn,u16 as ec,u16be as tc,u24 as rc,u24be as nc,u32 as oc,u32be as ic,u40 as sc,u40be as ac,u48 as uc,u48be as cc,u8 as jn,UInt as Hn,union as lc,Union as dc,unionLayoutDiscriminator as pc,utf8 as mc}from"@solana/buffer-layout";var Ft=Un,Kr=qn;var _t=Hn;var Cr=jn;var Vr=Gn;var Pe=Wn;var Be=class extends Ft{constructor(t,n,o){super(t,o);this.blob=Pe(t),this.signed=n}decode(t,n=0){let o=new Fr(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new Fr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function Y(r){return new _t(1,r)}function Ne(r){return new _t(4,r)}function b(r){return new Be(8,!1,r)}function de(r){return new Be(16,!1,r)}function Mr(r){return new Be(1,!0,r)}function ut(r){return new Be(8,!0,r)}var at=class extends Ft{constructor(t,n,o,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function E(r){return new at(Pe(32),e=>new zn(e),e=>e.toBuffer(),r)}function ct(r){return new at(Cr(),Xn,Yn,r)}function Xn(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Yn(r){return r?1:0}var Mt=class extends Kr{decode(e,t){return super.decode(e,t)}};function q(r,e,t){return new Mt(r,e,t)}function z(r,e,t){let n,o=typeof e=="number"?e:_r(e)?e.toNumber():new Proxy(e,{get(s,a){if(!n){let i=Reflect.get(s,"count");n=_r(i)?i.toNumber():i,Reflect.set(s,"count",n)}return Reflect.get(s,a)},set(s,a,i){return a==="count"&&(n=i),Reflect.set(s,a,i)}});return Vr(r,o,t)}var Oe=q([E("mint"),E("owner"),b("amount"),Ne("delegateOption"),E("delegate"),Y("state"),Ne("isNativeOption"),b("isNative"),b("delegatedAmount"),Ne("closeAuthorityOption"),E("closeAuthority")]);var vc=X("Raydium_Util");function lt({fromPublicKey:r,programId:e=Qn,assignSeed:t}){let n=t?btoa(t).slice(0,32):Zn.generate().publicKey.toBase58().slice(0,32);return{publicKey:$n(r,n,e),seed:n}}function $n(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),o=Br(n);return new Jn(o)}import Io from"decimal.js";import{PublicKey as eo,SystemProgram as to}from"@solana/web3.js";import ro from"bn.js";import{createCloseAccountInstruction as no,createInitializeAccountInstruction as oo,createTransferInstruction as Yc,TOKEN_PROGRAM_ID as We}from"@solana/spl-token";function io(r){let{mint:e,tokenAccount:t,owner:n,programId:o=We}=r;return oo(t,e,n,o)}function so(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:o,programId:s=We}=r;return no(e,t,o,n,s)}async function Dt(r){let{connection:e,amount:t,commitment:n,payer:o,owner:s,skipCloseAccount:a}=r,i=await e.getMinimumBalanceForRentExemption(Oe.span,n),f=D(t).add(new ro(i)),l=lt({fromPublicKey:o,programId:We});return{addresses:{newAccount:l.publicKey},signers:[],instructions:[to.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:l.seed,newAccountPubkey:l.publicKey,lamports:f.toNumber(),space:Oe.span,programId:We}),io({mint:new eo(Q.address),tokenAccount:l.publicKey,owner:s,programId:We})],instructionTypes:[W.CreateAccount,W.InitAccount],endInstructionTypes:a?[]:[W.CloseAccount],endInstructions:a?[]:[so({tokenAccount:l.publicKey,payer:o,owner:s})]}}var Et=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ue=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=X(t)}createTxBuilder(e){return this.scope.checkOwner(),new nt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Et(e))}logInfo(...e){this.logger.info(Et(e))}logAndCreateError(...e){let t=Et(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as qt}from"@solana/web3.js";var vt=q([Y("instruction")]),Nt=q([Y("instruction")]),ao=q([b("rewardState"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardLastUpdateTime"),b("totalReward"),b("totalRewardEmissioned"),b("rewardClaimed"),b("rewardPerSecond"),de("accRewardPerShare"),E("rewardVault"),E("rewardMint"),E("rewardSender"),b("rewardType"),z(b(),15,"padding")]),uo=q([b("state"),b("nonce"),E("lpVault"),E("rewardVault"),E(),E(),b(),b(),b("totalReward"),de("perShareReward"),b("lastSlot"),b("perSlotReward")]),co=q([b("state"),b("nonce"),E("lpVault"),E("rewardVaultA"),b("totalRewardA"),de("perShareRewardA"),b("perSlotRewardA"),Y("option"),E("rewardVaultB"),Pe(7),b("totalRewardB"),de("perShareRewardB"),b("perSlotRewardB"),b("lastSlot"),E()]),lo=q([b(),b("state"),b("nonce"),b("validRewardTokenNum"),de("rewardMultiplier"),b("rewardPeriodMax"),b("rewardPeriodMin"),b("rewardPeriodExtend"),E("lpMint"),E("lpVault"),z(ao,5,"rewardInfos"),E("creator"),E(),z(b(),32,"padding")]),po=new Proxy(uo,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Z(G({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,e,t)}}),mo=new Proxy(co,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Z(G({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,e,t)}}),dt=new Proxy(lo,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Z(G({},o),{version:6,rewardInfos:o.rewardInfos.map(s=>{var a;return Z(G({},s),{rewardType:((a=Object.entries(ge).find(i=>String(i[1])===s.rewardType.toString()))!=null?a:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),fo=q([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),Ot=q([Y("instruction"),b("nonce"),z(fo,5,"rewardTimeInfo")]),Wt=q([Y("instruction"),b("rewardReopenTime"),b("rewardEndTime"),b("rewardPerSecond")]),Ut=q([Y("instruction"),b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),ll=q([b("state"),E("id"),E("owner"),b("deposited"),z(b(),1,"rewardDebts")]),Gt=q([b("state"),E("id"),E("owner"),b("deposited"),z(de(),1,"rewardDebts"),b(""),b("voteLockedBalance"),z(b(),15)]),dl=q([b("state"),E("id"),E("owner"),b("deposited"),z(b(),2,"rewardDebts")]),Dr=q([b("state"),E("id"),E("owner"),b("deposited"),z(de(),2,"rewardDebts"),z(b(),17)]),Er=q([b(),b("state"),E("id"),E("owner"),b("deposited"),z(de(),5,"rewardDebts"),z(b(),16)]),$=q([Y("instruction"),b("amount")]),yo=q([E("mint"),E("grantAuthority"),b("baselineVoteWeightScaledFactor"),b("maxExtraLockupVoteWeightScaledFactor"),b("lockupSaturationSecs"),Mr("digitShift"),z(Y(),7,"reserved1"),z(b(),7,"reserved2")]),go=q([Pe(8),E("governanceProgramId"),E("realm"),E("realmGoverningTokenMint"),E("realmAuthority"),z(Y(),32,"reserved1"),z(yo,4,"votingMints"),ut("timeOffset"),Y("bump"),z(Y(),7,"reserved2"),z(b(),11,"reserved3")]),bo=q([ut("startTime"),ut("endTime"),Y("kind"),z(Y(),15,"reserved")]),wo=q([z(bo,1,"lockup"),b("amountDeposited_native"),b("amountInitiallyLockedNative"),ct("isUsed"),ct("allowClawback"),Y("votingMintConfigIdx"),z(Y(),29,"reserved")]),ho=q([Pe(8),E("voterAuthority"),E("registrar"),z(wo,32,"deposits"),Y("voterBump"),Y("voterWweightRecordBump"),z(Y(),94,"reserved")]);import{NATIVE_MINT as xl}from"@solana/spl-token";var Tl=X("Raydium_farm_config"),vr=new qt("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Nr=new qt("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Pl=new qt("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX");var Or={3:Gt,5:Dr,6:Er},jt=r=>[3,4,5,6].indexOf(r)!==-1,Ht=r=>{var a;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=r,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,s={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(a=s[e])==null?void 0:a.call(s)},ge={"Standard SPL":0,"Option tokens":1},pe={[Pr.toString()]:3,[Ar.toString()]:4,[kr.toString()]:5,[Me.toString()]:6,[Te.FARM_PROGRAM_ID_V3.toString()]:3,[Te.FARM_PROGRAM_ID_V4.toString()]:4,[Te.FARM_PROGRAM_ID_V5.toString()]:5,[Te.FARM_PROGRAM_ID_V6.toString()]:6};import{PublicKey as v,SystemProgram as Gr,SYSVAR_CLOCK_PUBKEY as qe,SYSVAR_RENT_PUBKEY as Po,TransactionInstruction as ee}from"@solana/web3.js";import qr from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as td,createAssociatedTokenAccountIdempotentInstruction as rd,TOKEN_PROGRAM_ID as me}from"@solana/spl-token";import xo from"bn.js";var To=X("Raydium.farm.util");function Ge({programId:r,poolId:e,mint:t,type:n}){let{publicKey:o}=he([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function re({programId:r,poolId:e,owner:t,version:n}){let{publicKey:o}=he([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var Wr=({programId:r,poolId:e})=>he([e.toBuffer()],r);function Ur(r){return{isSet:new xo(1),rewardPerSecond:D(r.perSecond),rewardOpenTime:D(r.openTime),rewardEndTime:D(r.endTime),rewardType:D(ge[r.rewardType])}}function zt(r){return D(r.endTime).sub(D(r.openTime)).mul(D(r.perSecond))}function Xt(r){let e=Or[r];return e||To.logWithError("invalid version",r),e}var Ao=X("Raydium_farm_instruction"),md={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Yt(r){let{version:e,id:t,ledger:n,programId:o,owner:s}=r,a={3:9,5:10}[e];a||Ao.logWithError(`invalid farm pool version: ${e}`);let i=Buffer.alloc(vt.span);vt.encode({instruction:a},i);let f=[c({pubkey:t}),c({pubkey:n}),c({pubkey:s,isWritable:!1}),c({pubkey:Gr.programId,isWritable:!1}),c({pubkey:Po,isWritable:!1})];return{instruction:new ee({programId:o,keys:f,data:i}),instructionType:W.FarmV3CreateLedger}}function jr(r){var n;let e=Buffer.alloc(Ot.span);Ot.encode({instruction:0,nonce:new qr(r.nonce),rewardTimeInfo:r.rewardInfoConfig},e);let t=[...bt,c({pubkey:r.farmId}),c({pubkey:r.farmAuthority,isWritable:!1}),c({pubkey:r.lpVault}),c({pubkey:r.lpMint,isWritable:!1}),c({pubkey:r.lockVault}),c({pubkey:r.lockMint,isWritable:!1}),c({pubkey:(n=r.lockUserAccount)!=null?n:J}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let o of r.rewardInfo)t.push(c({pubkey:o.rewardMint,isWritable:!1}),c({pubkey:o.rewardVault}),c({pubkey:o.userRewardToken}));return{instruction:new ee({programId:r.programId,keys:t,data:e}),instructionType:W.FarmV6Create}}function Hr(r){let e=Buffer.alloc(Nt.span);Nt.encode({instruction:5},e);let t=[c({pubkey:me,isWritable:!1}),c({pubkey:r.id}),c({pubkey:r.authority,isWritable:!1}),c({pubkey:r.lpVault,isWritable:!1}),c({pubkey:r.rewardVault}),c({pubkey:r.userRewardToken}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new ee({programId:r.programId,keys:t,data:e}),instructionType:W.FarmV6CreatorWithdraw}}function Zt({payer:r,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:o}){let s=Buffer.alloc(Wt.span);Wt.encode({instruction:3,rewardReopenTime:D(o.openTime),rewardEndTime:D(o.endTime),rewardPerSecond:D(o.perSecond)},s);let a=[c({pubkey:me,isWritable:!1}),c({pubkey:n.id}),c({pubkey:n.lpVault,isWritable:!1}),c({pubkey:e}),c({pubkey:t}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new ee({programId:n.programId,keys:a,data:s})}function Jt({payer:r,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:o}){let s=Buffer.alloc(Ut.span);Ut.encode({instruction:4,isSet:new qr(1),rewardPerSecond:D(o.perSecond),rewardOpenTime:D(o.openTime),rewardEndTime:D(o.endTime),rewardType:D(ge[o.rewardType])},s);let a=[...bt,c({pubkey:t.id}),c({pubkey:t.authority,isWritable:!1}),c({pubkey:o.mint,isWritable:!1}),c({pubkey:n}),c({pubkey:e}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new ee({programId:t.programId,keys:a,data:s})}function Qt(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new v(e.programId),new v(e.id)],l=re({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc($.span);$.encode({instruction:2,amount:D(a)},m);let u=[c({pubkey:me,isWritable:!1}),c({pubkey:f}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:new v(t.lpVault)}),c({pubkey:l}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)u.push(c({pubkey:new v(t.rewardInfos[d].vault)})),u.push(c({pubkey:o[d]}));return new ee({programId:i,keys:u,data:m})}function $t(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new v(e.programId),new v(e.id)],m=re({programId:f,poolId:l,owner:s,version:5}),u=Buffer.alloc($.span);$.encode({instruction:12,amount:D(a)},u);let d=[c({pubkey:l}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:qe,isWritable:!1}),c({pubkey:me,isWritable:!1})];for(let g=1;g<t.rewardInfos.length;g++)d.push(c({pubkey:o[g]})),d.push(c({pubkey:new v(t.rewardInfos[g].vault)}));if(i)for(let g of i)d.push(c({pubkey:g}));return new ee({programId:f,keys:d,data:u})}function zr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new v(e.programId),new v(e.id)],m=q([Y("instruction"),b("amount")]),u=[c({pubkey:l}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:i[0]}),c({pubkey:s,isSigner:!0,isWritable:!1}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:qe,isWritable:!1}),c({pubkey:me,isWritable:!1}),c({pubkey:o[1]}),c({pubkey:new v(t.rewardInfos[1].vault)})],d=Buffer.alloc(m.span);return m.encode({instruction:2,amount:a},d),new ee({keys:u,programId:f,data:d})}function er(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new v(e.programId),new v(e.id)],m=re({programId:f,poolId:l,owner:s,version:3}),u=Buffer.alloc($.span);$.encode({instruction:11,amount:D(a)},u);let d=[c({pubkey:l}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:qe,isWritable:!1}),c({pubkey:me,isWritable:!1})];if(i)for(let g of i)d.push(c({pubkey:g}));return new ee({programId:f,keys:d,data:u})}function Xr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new v(e.programId),new v(e.id)],m=re({programId:f,poolId:l,owner:s,version:3}),u=Buffer.alloc($.span);$.encode({instruction:10,amount:D(a)},u);let d=[c({pubkey:l}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:qe,isWritable:!1}),c({pubkey:me,isWritable:!1})];if(i)for(let g of i)d.push(c({pubkey:g}));return new ee({programId:f,keys:d,data:u})}function Yr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new v(e.programId),new v(e.id)],m=re({programId:f,poolId:l,owner:s,version:5}),u=Buffer.alloc($.span);$.encode({instruction:11,amount:D(a)},u);let d=[c({pubkey:l}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new v(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new v(t.rewardInfos[0].vault)}),c({pubkey:qe,isWritable:!1}),c({pubkey:me,isWritable:!1})];for(let g=1;g<t.rewardInfos.length;g++)d.push(c({pubkey:o[g]})),d.push(c({pubkey:new v(t.rewardInfos[g].vault)}));if(i)for(let g of i)d.push(c({pubkey:g}));return new ee({programId:f,keys:d,data:u})}function Zr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new v(e.programId),new v(e.id)],l=re({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc($.span);$.encode({instruction:1,amount:D(a)},m);let u=[c({pubkey:me,isWritable:!1}),c({pubkey:Gr.programId,isWritable:!1}),c({pubkey:f}),c({pubkey:new v(t.authority),isWritable:!1}),c({pubkey:new v(t.lpVault)}),c({pubkey:l}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)u.push(c({pubkey:new v(t.rewardInfos[d].vault)})),u.push(c({pubkey:o[d]}));return new ee({programId:i,keys:u,data:m})}var tr=class extends Ue{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(J)){let n=await Dt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:zt(Z(G({},t),{openTime:t.openTime.toString(),endTime:t.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:o=Me,txVersion:s,feePayer:a,lockProgram:i}){var I,R;this.checkDisabled(),this.scope.checkOwner();let l={lpMint:new O(e.lpMint.address),lockInfo:{lockMint:(I=i==null?void 0:i.mint)!=null?I:vr,lockVault:(R=i==null?void 0:i.vault)!=null?R:Nr},version:6,rewardInfos:t,programId:o},m=this.createTxBuilder(a),u=n!=null?n:this.scope.ownerPubKey,d=lt({fromPublicKey:u,programId:l.programId}),g=await this.scope.connection.getMinimumBalanceForRentExemption(dt.span);m.addInstruction({instructions:[ko.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:d.seed,newAccountPubkey:d.publicKey,lamports:g,space:dt.span,programId:l.programId})]});let{publicKey:p,nonce:w}=Wr({programId:new O(l.programId),poolId:d.publicKey}),y=Ge({programId:l.programId,poolId:d.publicKey,mint:l.lpMint,type:"lpVault"}),L=[],P=[];for(let B of l.rewardInfos){B.openTime>=B.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",B.openTime.toString()),isNaN(ge[B.rewardType])&&this.logAndCreateError("rewardType error",B.rewardType),Number(B.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",B.perSecond),L.push(Ur(B));let{rewardPubKey:A,newInstruction:_}=await this._getUserRewardInfo({rewardInfo:B,payer:u});_&&m.addInstruction(_),A||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let S=B.mint.equals(J)?new O(Q.address):B.mint;P.push({rewardMint:S,rewardVault:Ge({programId:l.programId,poolId:d.publicKey,mint:S,type:"rewardVault"}),userRewardToken:A})}let{account:C,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:new O(l.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});h&&m.addInstruction(h),C||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:x,instructionType:T}=jr({farmId:d.publicKey,owner:this.scope.ownerPubKey,farmAuthority:p,lpVault:y,lpMint:l.lpMint,lockVault:l.lockInfo.lockVault,lockMint:l.lockInfo.lockMint,lockUserAccount:C,programId:l.programId,rewardInfo:P,rewardInfoConfig:L,nonce:w});return m.addInstruction({instructions:[x],instructionTypes:[T]}).versionBuild({txVersion:s,extInfo:{farmId:d.publicKey,farmAuthority:p,lpVault:y,lockUserAccount:C,nonce:w}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:o,feePayer:s}){var L;let a=pe[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=ce((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let l=t||this.scope.ownerPubKey,m=n.mint.equals(J)?new O(Q.address):n.mint,u=f.rewardInfos.findIndex(P=>new O(P.mint.address).equals(m)),d=i.rewardInfos[u];d||this.logAndCreateError("configuration does not exist","rewardMint",m);let g=(L=d.vault)!=null?L:J,p=this.createTxBuilder(s),{rewardPubKey:w,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:n,payer:l});return y&&p.addInstruction(y),w||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[Zt({payer:this.scope.ownerPubKey,rewardVault:g,userRewardTokenPub:w,farmKeys:f,rewardInfo:n})],instructionTypes:[W.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:o,feePayer:s}){var u;let a=pe[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=ce((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.forEach(d=>{d.openTime>=d.endTime&&this.logAndCreateError("start time error","newRewardInfo",d)});let l=t||this.scope.ownerPubKey,m=this.createTxBuilder(s);for(let d of n){let g=d.mint.equals(J)?new O(Q.address):d.mint,p=f.rewardInfos.findIndex(h=>new O(h.mint.address).equals(g)),w=i.rewardInfos[p];w||this.logAndCreateError("configuration does not exist","rewardMint",g);let y=(u=w.vault)!=null?u:J,{rewardPubKey:L,newInstruction:P}=await this._getUserRewardInfo({rewardInfo:d,payer:l});P&&m.addInstruction(P),L||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let C=Zt({payer:this.scope.ownerPubKey,rewardVault:y,userRewardTokenPub:L,farmKeys:f,rewardInfo:d});m.addInstruction({instructions:[C],instructionTypes:[W.FarmV6Restart]})}return m.versionBuild({txVersion:o})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:o,payer:s,feePayer:a}=e,i=pe[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=ce((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),l=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a),u=o.mint.equals(J)?new O(Q.address):o.mint,d=Ge({programId:new O(n.programId),poolId:new O(n.id),mint:u,type:"rewardVault"}),{rewardPubKey:g,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:o,payer:l});return p&&m.addInstruction(p),g||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=u,m.addInstruction({instructions:[Jt({payer:this.scope.ownerPubKey,userRewardTokenPub:g,farmKeys:f,rewardVault:d,rewardInfo:o})],instructionTypes:[W.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:o,payer:s,feePayer:a}=e,i=pe[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=ce((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),l=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a);for(let u of o){let d=u.mint.equals(J)?new O(Q.address):u.mint,g=Ge({programId:new O(n.programId),poolId:new O(n.id),mint:d,type:"rewardVault"}),{rewardPubKey:p,newInstruction:w}=await this._getUserRewardInfo({rewardInfo:u,payer:l});w&&m.addInstruction(w),p||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let y=Jt({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:f,rewardVault:g,rewardInfo:Z(G({},u),{mint:d})});m.addInstruction({instructions:[y],instructionTypes:[W.FarmV6CreatorAddReward]})}return m.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:o,feePayer:s,useSOLBalance:a,associatedOnly:i=!0,checkCreateATAOwner:f=!1,userAuxiliaryLedgers:l,computeBudgetConfig:m,txTipConfig:u}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:d,programId:g}=n,p=pe[g];p===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),jt(p)||this.logAndCreateError("invalid farm program:",n.programId);let[w,y]=[new O(n.programId),new O(n.id)],L=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],P=re({programId:w,poolId:y,owner:this.scope.ownerPubKey,version:p}),C=this.createTxBuilder(s);C.addCustomComputeBudget(m),C.addTipInstruction(u);let h={};for(let K of this.scope.account.tokenAccounts)if(i){let U=Ie(this.scope.ownerPubKey,K.mint,K.programId).publicKey;K.publicKey&&U.equals(K.publicKey)&&(h[K.mint.toString()]=K.publicKey)}else h[K.mint.toString()]=K.publicKey;let x=L.lpMint,T=h[x.address];T||this.logAndCreateError("you don't have any lp","lp zero",h);let I=[];for(let K of d){let U=a&&K.mint.address===se.toString(),j=h[K.mint.address];if(!j){let{account:ne,instructionParams:oe}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:K.mint.programId,mint:new O(K.mint.address),notUseTokenAccount:U,createInfo:{payer:s||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!U,associatedOnly:U?!1:i,checkCreateATAOwner:f});j=ne,oe&&C.addInstruction(oe)}h[K.mint.address]=j,I.push(j)}let R,B=await this.scope.connection.getAccountInfo(P);if(B&&(R=Xt(p).decode(B.data)),n.programId!==Me.toString()&&n.programId!==Te.FARM_PROGRAM_ID_V6.toString()&&!R){let{instruction:K,instructionType:U}=Yt({id:y,programId:w,version:p,ledger:P,owner:this.scope.ownerPubKey});C.addInstruction({instructions:[K],instructionTypes:[U]})}let A=Ht({version:p,rewardInfos:d,rewardTokenAccountsPublicKeys:I});A&&this.logAndCreateError(A);let _={amount:D(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:L,lpAccount:T,rewardAccounts:I,userAuxiliaryLedgers:l==null?void 0:l.map(K=>new O(K))},S=p===6?Zr(_):p===5?Yr(_):Xr(_),M={3:W.FarmV3Deposit,5:W.FarmV5Deposit,6:W.FarmV6Deposit};return C.addInstruction({instructions:[S],instructionTypes:[M[p]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:o,deposited:s,useSOLBalance:a,feePayer:i,associatedOnly:f=!0,checkCreateATAOwner:l=!1,userAuxiliaryLedgers:m,computeBudgetConfig:u,txTipConfig:d}=e,{rewardInfos:g}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let p=pe[n.programId];jt(p)||this.logAndCreateError("invalid farm program:",n.programId);let w=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],y=this.createTxBuilder(i);y.addCustomComputeBudget(u),y.addTipInstruction(d);let L={};for(let A of this.scope.account.tokenAccounts)if(f){let _=Ie(this.scope.ownerPubKey,A.mint).publicKey;A.publicKey&&_.equals(A.publicKey)&&(L[A.mint.toString()]=A.publicKey)}else L[A.mint.toString()]=A.publicKey;if(p!==4){let A=re({programId:new O(n.programId),poolId:new O(n.id),owner:this.scope.ownerPubKey,version:p}),_=await this.scope.connection.getAccountInfo(A);if(_)Xt(p).decode(_.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(p!==6){let{instruction:S,instructionType:M}=Yt({id:new O(w.id),programId:new O(w.programId),version:p,ledger:A,owner:this.scope.ownerPubKey});y.addInstruction({instructions:[S],instructionTypes:[M]})}}s&&s.isZero()&&!(m||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let P=w.lpMint.address,C=a&&P===se.toString(),h=L[P.toString()];if(!h){let{account:A,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:w.lpMint.programId,mint:new O(P),notUseTokenAccount:C,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:C?!1:f,checkCreateATAOwner:l});h=A,_&&y.addInstruction(_)}L[P.toString()]=h;let x=[];for(let A of g){let _=a&&A.mint.address===se.toString(),S=L[A.mint.address];if(!S){let{account:M,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:A.mint.programId,mint:new O(A.mint.address),notUseTokenAccount:_,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!_,associatedOnly:_?!1:f,checkCreateATAOwner:l});S=M,K&&y.addInstruction(K)}L[A.mint.address]=S,x.push(S)}let T=Ht({version:p,rewardInfos:g,rewardTokenAccountsPublicKeys:x});T&&this.logAndCreateError(T);let I={amount:D(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:w,lpAccount:h,rewardAccounts:x,userAuxiliaryLedgers:m==null?void 0:m.map(A=>new O(A))},R=p===6?Qt(I):p===5?$t(I):p===4?zr(I):er(I),B={3:W.FarmV3Withdraw,4:W.FarmV4Withdraw,5:W.FarmV5Withdraw,6:W.FarmV6Withdraw};return y.addInstruction({instructions:[R],instructionTypes:[B[p]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){var w;this.scope.checkOwner();let i=ce((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f=pe[e.programId];f!==6&&this.logAndCreateError("invalid farm version",f);let l=i.rewardInfos.find(y=>Xe(y.mint.address).equals(Xe(t)));l||this.logAndCreateError("withdraw mint error","rewardInfos",e);let m=(w=l==null?void 0:l.vault)!=null?w:J,u=this.createTxBuilder(a),d;if(t.equals(J)||t.equals(O.default)){let y=await Dt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:zt(Z(G({},l),{openTime:l.openTime,endTime:l.endTime,perSecond:new Io(l.perSecond).mul(10**l.mint.decimals).toString()}))});d=y.addresses.newAccount,u.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(d=await this.scope.account.getAssociatedTokenAccount(t),u.addInstruction({instructions:[Jr(this.scope.ownerPubKey,d,this.scope.ownerPubKey,t)],instructionTypes:[W.CreateATA]})):d=y}let{instruction:g,instructionType:p}=Hr({programId:i.programId,id:i.id,authority:i.authority,lpVault:i.lpVault,rewardVault:m,userRewardToken:d,owner:this.scope.ownerPubKey});return u.addCustomComputeBudget(o),u.addTipInstruction(s),u.addInstruction({instructions:[g],instructionTypes:[p]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:o,associatedOnly:s=!0,checkCreateATAOwner:a=!1,userAuxiliaryLedgers:i,txVersion:f,computeBudgetConfig:l}=e,m=this.createTxBuilder(o),u={};for(let p of this.scope.account.tokenAccounts)if(s){let w=Ie(this.scope.ownerPubKey,p.mint).publicKey;p.publicKey&&w.equals(p.publicKey)&&(u[p.mint.toString()]=p.publicKey)}else u[p.mint.toString()]=p.publicKey;let g=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(p=>p.id).join(",")})).reduce((p,w)=>Z(G({},p),{[w.id]:w}),{});for(let p of Object.values(t)){let{programId:w,lpMint:y,rewardInfos:L,id:P}=p,C=pe[w],h=y.address,x=n&&h===se.toString(),T=u[h];if(!T){let{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.programId,mint:new O(h),notUseTokenAccount:x,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:x?!1:s,checkCreateATAOwner:a});T=S,M&&m.addInstruction(M)}u[h.toString()]=T;let I=[];for(let S of L){let M=n&&S.mint.address===se.toString(),K=u[S.mint.address];if(!K)if(M){let{account:U,instructionParams:j}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:S.mint.programId,mint:new O(S.mint.address),notUseTokenAccount:M,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!M,associatedOnly:M?!1:s,checkCreateATAOwner:a});K=U,j&&m.addInstruction(j)}else{let U=new O(S.mint.address);K=this.scope.account.getAssociatedTokenAccount(U),m.addInstruction({instructions:[Jr(this.scope.ownerPubKey,K,this.scope.ownerPubKey,U)]})}u[S.mint.address]=K,I.push(K)}let R=g[P],B={amount:kt,owner:this.scope.ownerPubKey,farmInfo:p,farmKeys:R,lpAccount:T,rewardAccounts:I,userAuxiliaryLedgers:i==null?void 0:i.map(S=>new O(S))},A=C===6?Qt(B):C===5?$t(B):er(B),_={3:W.FarmV3Withdraw,5:W.FarmV5Withdraw,6:W.FarmV6Withdraw};m.addInstruction({instructions:[A],instructionTypes:[_[C]]})}return f===1?m.sizeCheckBuild({computeBudgetConfig:l}):m.sizeCheckBuildV0({computeBudgetConfig:l})}};export{tr as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.mjs.map