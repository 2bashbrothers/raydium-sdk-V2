var wr=Object.create;var ae=Object.defineProperty,Tr=Object.defineProperties,xr=Object.getOwnPropertyDescriptor,Pr=Object.getOwnPropertyDescriptors,Sr=Object.getOwnPropertyNames,gt=Object.getOwnPropertySymbols,kr=Object.getPrototypeOf,ht=Object.prototype.hasOwnProperty,Ir=Object.prototype.propertyIsEnumerable;var bt=(r,t,e)=>t in r?ae(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,_=(r,t)=>{for(var e in t||(t={}))ht.call(t,e)&&bt(r,e,t[e]);if(gt)for(var e of gt(t))Ir.call(t,e)&&bt(r,e,t[e]);return r},v=(r,t)=>Tr(r,Pr(t));var Lr=(r,t)=>{for(var e in t)ae(r,e,{get:t[e],enumerable:!0})},wt=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Sr(t))!ht.call(r,o)&&o!==e&&ae(r,o,{get:()=>t[o],enumerable:!(n=xr(t,o))||n.enumerable});return r};var F=(r,t,e)=>(e=r!=null?wr(kr(r)):{},wt(t||!r||!r.__esModule?ae(e,"default",{value:r,enumerable:!0}):e,r)),Ar=r=>wt(ae({},"__esModule",{value:!0}),r);var Sn={};Lr(Sn,{DEV_FARM_LOCK_MINT:()=>_r,DEV_FARM_LOCK_VAULT:()=>Fr,FARM_LOCK_MINT:()=>Cr,FARM_LOCK_VAULT:()=>Vr,FARM_PROGRAM_TO_VERSION:()=>Nr,FARM_VERSION_TO_LEDGER_LAYOUT:()=>ze,FARM_VERSION_TO_STATE_LAYOUT:()=>Ye,Voter:()=>tt,VoterDepositEntry:()=>Nt,VoterLockup:()=>Dt,VoterRegistrar:()=>et,VoterVotingMintConfig:()=>Mt,associatedLedgerAccountLayout:()=>Se,calFarmRewardAmount:()=>nn,createAssociatedLedgerAccountInstruction:()=>un,dwLayout:()=>M,farmAddRewardLayout:()=>Ae,farmLedgerLayoutV3_1:()=>Er,farmLedgerLayoutV3_2:()=>te,farmLedgerLayoutV5_1:()=>Wr,farmLedgerLayoutV5_2:()=>Qe,farmLedgerLayoutV6_1:()=>$e,farmRewardInfoToConfig:()=>rn,farmRewardLayout:()=>Ie,farmRewardRestartLayout:()=>Le,farmRewardTimeInfoLayout:()=>Ft,farmStateV3Layout:()=>Je,farmStateV5Layout:()=>Xe,farmStateV6Layout:()=>Ze,fetchMultipleFarmInfoAndUpdate:()=>on,getAssociatedAuthority:()=>tn,getAssociatedLedgerAccount:()=>W,getAssociatedLedgerPoolAccount:()=>en,getDepositEntryIndex:()=>Fe,getFarmLedgerLayout:()=>ur,getFarmStateLayout:()=>cr,getRegistrarAddress:()=>Me,getTokenOwnerRecordAddress:()=>We,getVoterAddress:()=>ve,getVoterWeightRecordAddress:()=>Ee,getVotingMintAuthority:()=>Ne,getVotingTokenMint:()=>De,governanceCreateTokenOwnerRecord:()=>fr,isValidFarmVersion:()=>Mr,judgeFarmType:()=>sn,makeAddNewRewardInstruction:()=>fn,makeCreateFarmInstruction:()=>cn,makeCreatorWithdrawFarmRewardInstruction:()=>ln,makeDepositInstructionV3:()=>Tn,makeDepositInstructionV5:()=>xn,makeDepositInstructionV6:()=>Pn,makeDepositTokenInstruction:()=>dn,makeDepositWithdrawInstruction:()=>yn,makeRestartRewardInstruction:()=>mn,makeWithdrawInstructionV3:()=>wn,makeWithdrawInstructionV4:()=>hn,makeWithdrawInstructionV5:()=>bn,makeWithdrawInstructionV6:()=>gn,makeWithdrawTokenInstruction:()=>pn,poolTypeV6:()=>Y,realFarmStateV3Layout:()=>Ct,realFarmStateV5Layout:()=>Vt,realFarmV6Layout:()=>_t,updateFarmPoolInfo:()=>lr,validateFarmRewards:()=>Dr,voterStakeRegistryCreateDepositEntry:()=>gr,voterStakeRegistryCreateVoter:()=>yr,voterStakeRegistryDeposit:()=>dr,voterStakeRegistryUpdateVoterWeightRecord:()=>pr,voterStakeRegistryWithdraw:()=>mr,withdrawRewardLayout:()=>ke});module.exports=Ar(Sn);var St=require("@solana/web3.js"),Q=F(require("bn.js"));var g=require("@solana/buffer-layout"),Ge=g.Layout,Tt=g.Structure;var qe=g.UInt;var xt=g.u8;var Pt=g.seq;var j=g.blob;var $=class extends Ge{constructor(e,n,o){super(e,o);this.blob=j(e),this.signed=n}decode(e,n=0){let o=new Q.default(this.blob.decode(e,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,n,o=0){return typeof e=="number"&&(e=new Q.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),n,o)}};function k(r){return new qe(1,r)}function ee(r){return new qe(4,r)}function c(r){return new $(8,!1,r)}function U(r){return new $(16,!1,r)}function kt(r){return new $(1,!0,r)}function xe(r){return new $(8,!0,r)}var Te=class extends Ge{constructor(e,n,o,a){super(e.span,a);this.layout=e,this.decoder=n,this.encoder=o}decode(e,n){return this.decoder(this.layout.decode(e,n))}encode(e,n,o){return this.layout.encode(this.encoder(e),n,o)}getSpan(e,n){return this.layout.getSpan(e,n)}};function w(r){return new Te(j(32),t=>new St.PublicKey(t),t=>t.toBuffer(),r)}function ue(r){return new Te(xt(),Rr,Br,r)}function Rr(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Br(r){return r?1:0}var He=class extends Tt{decode(t,e){return super.decode(t,e)}};function P(r,t,e){return new He(r,t,e)}function B(r,t,e){let n,o=typeof t=="number"?t:(0,Q.isBN)(t)?t.toNumber():new Proxy(t,{get(a,s){if(!n){let l=Reflect.get(a,"count");n=(0,Q.isBN)(l)?l.toNumber():l,Reflect.set(a,"count",n)}return Reflect.get(a,s)},set(a,s,l){return s==="count"&&(n=l),Reflect.set(a,s,l)}});return Pt(r,o,e)}var Pe=require("@solana/web3.js");var ce=require("lodash");var je=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},It={},Kr={};function K(r){let t=(0,ce.get)(It,r);if(!t){let e=(0,ce.get)(Kr,r);t=new je({name:r,logLevel:e}),(0,ce.set)(It,r,t)}return t}var y=require("@solana/web3.js"),Lt=new y.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),At=new y.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Rt=new y.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Bt=new y.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),vn=new y.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),En=new y.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Wn=new y.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),On=new y.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Un=new y.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Gn=new y.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),qn=new y.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Hn=new y.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),jn=new y.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Yn=new y.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),zn=new y.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Jn=new y.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Xn=new y.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Zn=new y.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Qn=new y.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),$n=new y.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),eo=new y.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),to=new y.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ro=new y.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),no=new y.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),oo=new y.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),io=new y.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),so=new y.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ao=new y.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),uo=new y.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),co=new y.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),lo=new y.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var le={OPEN_BOOK_PROGRAM:new y.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new y.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new y.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new y.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new y.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new y.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new y.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new y.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new y.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new y.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new y.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new y.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:y.PublicKey.default,Router:new y.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new y.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new y.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new y.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new y.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new y.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new y.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new y.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new y.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new y.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new y.PublicKey("Ray1111111111111111111111111111111111111111")};var Kt=require("@solana/spl-token"),ho=K("Raydium_farm_config"),Cr=new Pe.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Vr=new Pe.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),_r=Kt.NATIVE_MINT,Fr=new Pe.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX"),Ye={3:Je,5:Xe,6:Ze},ze={3:te,5:Qe,6:$e},Mr=r=>[3,4,5,6].indexOf(r)!==-1,Dr=r=>{var s;let{version:t,rewardInfos:e,rewardTokenAccountsPublicKeys:n}=r,o=`rewardInfo:${JSON.stringify(e)}, rewardAccount:${JSON.stringify(n)}`,a={3:()=>{if(e.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(e.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||e.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(s=a[t])==null?void 0:s.call(a)},Y={"Standard SPL":0,"Option tokens":1},Nr={[Lt.toString()]:3,[At.toString()]:4,[Rt.toString()]:5,[Bt.toString()]:6,[le.FARM_PROGRAM_ID_V3.toString()]:3,[le.FARM_PROGRAM_ID_V4.toString()]:4,[le.FARM_PROGRAM_ID_V5.toString()]:5,[le.FARM_PROGRAM_ID_V6.toString()]:6};var Se=P([k("instruction")]),ke=P([k("instruction")]),vr=P([c("rewardState"),c("rewardOpenTime"),c("rewardEndTime"),c("rewardLastUpdateTime"),c("totalReward"),c("totalRewardEmissioned"),c("rewardClaimed"),c("rewardPerSecond"),U("accRewardPerShare"),w("rewardVault"),w("rewardMint"),w("rewardSender"),c("rewardType"),B(c(),15,"padding")]),Ct=P([c("state"),c("nonce"),w("lpVault"),w("rewardVault"),w(),w(),c(),c(),c("totalReward"),U("perShareReward"),c("lastSlot"),c("perSlotReward")]),Vt=P([c("state"),c("nonce"),w("lpVault"),w("rewardVaultA"),c("totalRewardA"),U("perShareRewardA"),c("perSlotRewardA"),k("option"),w("rewardVaultB"),j(7),c("totalRewardB"),U("perShareRewardB"),c("perSlotRewardB"),c("lastSlot"),w()]),_t=P([c(),c("state"),c("nonce"),c("validRewardTokenNum"),U("rewardMultiplier"),c("rewardPeriodMax"),c("rewardPeriodMin"),c("rewardPeriodExtend"),w("lpMint"),w("lpVault"),B(vr,5,"rewardInfos"),w("creator"),w(),B(c(),32,"padding")]),Je=new Proxy(Ct,{get(r,t,e){return t==="decode"?(...n)=>{let o=r.decode(...n);return v(_({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,t,e)}}),Xe=new Proxy(Vt,{get(r,t,e){return t==="decode"?(...n)=>{let o=r.decode(...n);return v(_({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,t,e)}}),Ze=new Proxy(_t,{get(r,t,e){return t==="decode"?(...n)=>{let o=r.decode(...n);return v(_({},o),{version:6,rewardInfos:o.rewardInfos.map(a=>{var s;return v(_({},a),{rewardType:((s=Object.entries(Y).find(l=>String(l[1])===a.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(r,t,e)}}),Ft=P([c("isSet"),c("rewardPerSecond"),c("rewardOpenTime"),c("rewardEndTime"),c("rewardType")]),Ie=P([k("instruction"),c("nonce"),B(Ft,5,"rewardTimeInfo")]),Le=P([k("instruction"),c("rewardReopenTime"),c("rewardEndTime"),c("rewardPerSecond")]),Ae=P([k("instruction"),c("isSet"),c("rewardPerSecond"),c("rewardOpenTime"),c("rewardEndTime"),c("rewardType")]),Er=P([c("state"),w("id"),w("owner"),c("deposited"),B(c(),1,"rewardDebts")]),te=P([c("state"),w("id"),w("owner"),c("deposited"),B(U(),1,"rewardDebts"),c(""),c("voteLockedBalance"),B(c(),15)]),Wr=P([c("state"),w("id"),w("owner"),c("deposited"),B(c(),2,"rewardDebts")]),Qe=P([c("state"),w("id"),w("owner"),c("deposited"),B(U(),2,"rewardDebts"),B(c(),17)]),$e=P([c(),c("state"),w("id"),w("owner"),c("deposited"),B(U(),5,"rewardDebts"),B(c(),16)]),M=P([k("instruction"),c("amount")]),Mt=P([w("mint"),w("grantAuthority"),c("baselineVoteWeightScaledFactor"),c("maxExtraLockupVoteWeightScaledFactor"),c("lockupSaturationSecs"),kt("digitShift"),B(k(),7,"reserved1"),B(c(),7,"reserved2")]),et=P([j(8),w("governanceProgramId"),w("realm"),w("realmGoverningTokenMint"),w("realmAuthority"),B(k(),32,"reserved1"),B(Mt,4,"votingMints"),xe("timeOffset"),k("bump"),B(k(),7,"reserved2"),B(c(),11,"reserved3")]),Dt=P([xe("startTime"),xe("endTime"),k("kind"),B(k(),15,"reserved")]),Nt=P([B(Dt,1,"lockup"),c("amountDeposited_native"),c("amountInitiallyLockedNative"),ue("isUsed"),ue("allowClawback"),k("votingMintConfigIdx"),B(k(),29,"reserved")]),tt=P([j(8),w("voterAuthority"),w("registrar"),B(Nt,32,"deposits"),k("voterBump"),k("voterWweightRecordBump"),B(k(),94,"reserved")]);var D=F(require("bn.js"));var vt=require("@solana/web3.js");var Re=require("@solana/spl-token"),rt=K("Raydium_accountInfo_util");async function Et(r,t,e){let{batchRequest:n,commitment:o="confirmed",chunkCount:a=100}=_({batchRequest:!1},e),s=nt(t,a),l=new Array(s.length).fill([]);if(n){let f=s.map(b=>{let p=r._buildArgs([b.map(m=>m.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),d=nt(f,10);l=(await(await Promise.all(d.map(async b=>await r._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&rt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(p=>{if(p){let{data:m,executable:S,lamports:R,owner:L,rentEpoch:V}=p;return m.length!==2&&m[1]!=="base64"&&rt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:S,lamports:R,owner:new vt.PublicKey(L),rentEpoch:V}}return null})))}else try{l=await Promise.all(s.map(f=>r.getMultipleAccountsInfo(f,o)))}catch(f){f instanceof Error&&rt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return l.flat()}async function Wt(r,t,e){let n=await Et(r,t.map(o=>o.pubkey),e);return t.map((o,a)=>v(_({},o),{accountInfo:n[a]}))}var O=F(require("bn.js")),Jr=F(require("decimal.js"));var jt=F(require("big.js")),fe=F(require("bn.js"));var Ot=F(require("toformat")),Or=Ot.default,de=Or;var pe=F(require("big.js")),Gt=F(require("bn.js")),qt=F(require("decimal.js-light"));var re=F(require("bn.js"));var Ut=9007199254740991;function x(r){let t=K("Raydium_parseBigNumberish");if(r instanceof re.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new re.default(r);t.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&t.logWithError(`BigNumberish number underflow: ${r}`),(r>=Ut||r<=-Ut)&&t.logWithError(`BigNumberish number overflow: ${r}`),new re.default(String(r))):typeof r=="bigint"?new re.default(r.toString()):(t.error(`invalid BigNumberish value: ${r}`),new re.default(0))}var Be=K("module/fraction"),it=de(pe.default),me=de(qt.default),Gr={[0]:me.ROUND_DOWN,[1]:me.ROUND_HALF_UP,[2]:me.ROUND_UP},qr={[0]:pe.default.roundDown,[1]:pe.default.roundHalfUp,[2]:pe.default.roundUp},I=class{constructor(t,e=new Gt.default(1)){this.numerator=x(t),this.denominator=x(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new I(this.denominator,this.numerator)}add(t){let e=t instanceof I?t:new I(x(t));return this.denominator.eq(e.denominator)?new I(this.numerator.add(e.numerator),this.denominator):new I(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof I?t:new I(x(t));return this.denominator.eq(e.denominator)?new I(this.numerator.sub(e.numerator),this.denominator):new I(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof I?t:new I(x(t));return new I(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof I?t:new I(x(t));return new I(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},n=1){Number.isInteger(t)||Be.logWithError(`${t} is not an integer.`),t<=0&&Be.logWithError(`${t} is not positive.`),me.set({precision:t+1,rounding:Gr[n]});let o=new me(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},n=1){return Number.isInteger(t)||Be.logWithError(`${t} is not an integer.`),t<0&&Be.logWithError(`${t} is negative.`),it.DP=t,it.RM=qr[n]||1,new it(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var Hr=K("Raydium_amount"),Ht=de(jt.default);function jr(r,t){let e="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([e,n]=o,n=n.padEnd(t,"0")):Hr.logWithError(`invalid number string, num: ${r}`)}else e=r;return[e,n.slice(0,t)||n]}var G=class extends I{constructor(e,n,o=!0,a){let s=new fe.default(0),l=st.pow(new fe.default(e.decimals));if(o)s=x(n);else{let f=new fe.default(0),d=new fe.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[h,b]=jr(n.toString(),e.decimals);f=x(h),d=x(b)}f=f.mul(l),s=f.add(d)}super(s,l);this.logger=K(a||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new G(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new G(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,n,o=0){return super.toSignificant(e,n,o)}toFixed(e=this.token.decimals,n,o=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,n,o)}toExact(e={groupSeparator:""}){return Ht.DP=this.token.decimals,new Ht(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};var Yt=require("@solana/web3.js"),at=require("@solana/spl-token"),zt={chainId:101,address:Yt.PublicKey.default.toBase58(),programId:at.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},z={chainId:101,address:"So11111111111111111111111111111111111111112",programId:at.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Ce=require("@solana/web3.js");var A=require("@solana/web3.js"),Jt=require("@solana/spl-token");function i({pubkey:r,isSigner:t=!1,isWritable:e=!0}){return{pubkey:r,isWritable:e,isSigner:t}}var ut=[i({pubkey:Jt.TOKEN_PROGRAM_ID,isWritable:!1}),i({pubkey:A.SystemProgram.programId,isWritable:!1}),i({pubkey:A.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Xt({publicKey:r,transformSol:t}){let e=ct(r.toString());if(e instanceof A.PublicKey)return t&&e.equals(J)?ot:e;if(t&&e.toString()===J.toBase58())return ot;if(typeof e=="string"){if(e===A.PublicKey.default.toBase58())return A.PublicKey.default;try{return new A.PublicKey(e)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ct(r){try{return new A.PublicKey(r)}catch{return r}}var Qo=new A.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),$o=new A.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),lt=new A.PublicKey("SysvarRent111111111111111111111111111111111"),ei=new A.PublicKey("SysvarC1ock11111111111111111111111111111111"),ti=new A.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ke=new A.PublicKey("Sysvar1nstructions1111111111111111111111111"),ri=A.SystemProgram.programId,ni=new A.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),oi=new A.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ii=new A.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),si=new A.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ai=new A.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ui=new A.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ci=new A.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),li=new A.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),di=new A.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),pi=new A.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),mi=new A.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ot=new A.PublicKey("So11111111111111111111111111111111111111112"),J=A.PublicKey.default;var dt=class{constructor({mint:t,decimals:e,symbol:n,name:o,skipMint:a=!1,isToken2022:s=!1}){if(t===J.toBase58()||t instanceof Ce.PublicKey&&J.equals(t)){this.decimals=z.decimals,this.symbol=z.symbol,this.name=z.name,this.mint=new Ce.PublicKey(z.address),this.isToken2022=!1;return}this.decimals=e,this.symbol=n||t.toString().substring(0,6),this.name=o||t.toString().substring(0,6),this.mint=a?Ce.PublicKey.default:Xt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},X=dt;X.WSOL=new dt(v(_({},z),{mint:z.address}));var pt=class{constructor({decimals:t,symbol:e="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=n}equals(t){return this===t}},Ve=pt;Ve.SOL=new pt(zt);var Qt=F(require("bn.js"));var Zt=new I(new Qt.default(100)),ne=class extends I{toSignificant(t=5,e,n){return this.mul(Zt).toSignificant(t,e,n)}toFixed(t=2,e,n){return this.mul(Zt).toFixed(t,e,n)}};var Yr=K("Raydium_price"),q=class extends I{constructor(e){let{baseToken:n,quoteToken:o,numerator:a,denominator:s}=e;super(a,s);this.baseToken=n,this.quoteToken=o,this.scalar=new I(mt(n.decimals),mt(o.decimals))}get raw(){return new I(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new q({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Yr.logWithError("mul token not equals");let n=super.mul(e);return new q({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(e=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(e,n,o)}toFixed(e=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(e,n,o)}};var zr=new O.default(0),Qi=new O.default(1),$i=new O.default(2),es=new O.default(3),ts=new O.default(5),st=new O.default(10),rs=new O.default(100),ns=new O.default(1e3),os=new O.default(1e4);function mt(r){return st.pow(x(r))}var $t=r=>typeof r=="number";function er(r,t,e){let n=$t(t)?t*((e==null?void 0:e.unit)==="s"?1e3:1):t;return new Date(r).getTime()<=n}function tr(r,t,e){let n=$t(t)?t*((e==null?void 0:e.unit)==="s"?1e3:1):t;return new Date(r).getTime()>n}function nt(r,t=1,e=[]){let n=[...r];if(t<=0)return e;for(;n.length;)e.push(n.splice(0,t));return e}var rr=require("@solana/web3.js"),nr=require("@solana/spl-token");var Z=require("@solana/web3.js");var oe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Xr=require("@solana/spl-token"),bs=K("Raydium_txUtil");function E(r,t){let[e,n]=Z.PublicKey.findProgramAddressSync(r,t);return{publicKey:e,nonce:n}}function ye(r,t,e){return E([r.toBuffer(),(e!=null?e:nr.TOKEN_PROGRAM_ID).toBuffer(),t.toBuffer()],new rr.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var Zr=F(require("bn.js"));var or=require("@solana/web3.js");var ie=require("@solana/web3.js"),Qr=F(require("axios"));var ir=require("@solana/web3.js"),sr=F(require("bn.js"));function $r(r){return typeof r=="object"&&r!==null&&![X,G,ir.PublicKey,I,sr.default,q,ne].some(t=>typeof t=="object"&&r instanceof t)}function _e(r){return typeof r=="string"?ct(r):Array.isArray(r)?r.map(t=>_e(t)):$r(r)?Object.fromEntries(Object.entries(r).map(([t,e])=>[t,_e(e)])):r}var ar=F(require("bn.js")),Zs=new ar.default(1e6);var ft=P([w("mint"),w("owner"),c("amount"),ee("delegateOption"),w("delegate"),k("state"),ee("isNativeOption"),c("isNative"),c("delegatedAmount"),ee("closeAuthorityOption"),w("closeAuthority")]);var ge=K("Raydium.farm.util");function en({programId:r,poolId:t,mint:e,type:n}){let{publicKey:o}=E([t.toBuffer(),e.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function W({programId:r,poolId:t,owner:e,version:n}){let{publicKey:o}=E([t.toBuffer(),e.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var tn=({programId:r,poolId:t})=>E([t.toBuffer()],r);function rn(r){return{isSet:new D.default(1),rewardPerSecond:x(r.perSecond),rewardOpenTime:x(r.openTime),rewardEndTime:x(r.endTime),rewardType:x(Y[r.rewardType])}}function nn(r){return x(r.endTime).sub(x(r.openTime)).mul(x(r.perSecond))}function ur(r){let t=ze[r];return t||ge.logWithError("invalid version",r),t}function cr(r){let t=Ye[r];return t||ge.logWithError("invalid version",r),t}function lr(r,t,e,n){if(r.version===3||r.version===5){if(r.lastSlot.gte(new D.default(e)))return r;let o=new D.default(e).sub(r.lastSlot);r.lastSlot=new D.default(e);for(let a of r.rewardInfos){if(t.amount.eq(new D.default(0)))continue;let s=a.perSlotReward.mul(o);a.perShareReward=a.perShareReward.add(s.mul(new D.default(10).pow(new D.default(r.version===3?9:15))).div(t.amount)),a.totalReward=a.totalReward.add(s)}}else if(r.version===6)for(let o of r.rewardInfos){if(o.rewardState.eq(new D.default(0)))continue;let a=D.default.min(new D.default(n),o.rewardEndTime);if(o.rewardOpenTime.gte(a))continue;let l=a.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),f=o.totalReward.sub(o.totalRewardEmissioned);f.lt(l)?(l=f,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(f.div(o.rewardPerSecond))):o.rewardLastUpdateTime=a,!t.amount.eq(new D.default(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(l.mul(r.rewardMultiplier).div(t.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(l))}return r}async function on({connection:r,farmPools:t,owner:e,config:n,chainTime:o}){let a=!1,s=!1,l=new D.default(10),f=[];for(let p of t){let m=_e(p);m.version===6?s=!0:a=!0,f.push({pubkey:m.id,version:m.version,key:"state",poolId:m.id},{pubkey:m.lpVault,version:m.version,key:"lpVault",poolId:m.id}),e&&f.push({pubkey:W({programId:m.programId,poolId:m.id,owner:e,version:p.version}),version:m.version,key:"ledger",poolId:m.id})}let d={},h=await Wt(r,f,n);for(let{pubkey:p,version:m,key:S,poolId:R,accountInfo:L}of h){let V=R.toBase58();if(d[V]=_({},d[V]),S==="state"){let N=cr(m);(!L||!L.data||L.data.length!==N.span)&&ge.logWithError(`invalid farm state account info, pools.id, ${p}`),d[V].state=N.decode(L.data)}else if(S==="lpVault")(!L||!L.data||L.data.length!==ft.span)&&ge.logWithError(`invalid farm lp vault account info, pools.lpVault, ${p}`),d[V].lpVault=ft.decode(L.data);else if(S==="ledger"){let N=ur(m);L&&L.data&&(L.data.length!==N.span&&ge.logWithError(`invalid farm ledger account info, ledger, ${p}`),d[V].ledger=N.decode(L.data))}}let b=s||a?await r.getSlot():0;for(let p of Object.keys(d))d[p]!==void 0&&(d[p].state=lr(d[p].state,d[p].lpVault,b,o));for(let[p,{state:m,ledger:S}]of Object.entries(d))if(S){let R=m.version===6?m.rewardMultiplier:m.rewardInfos.length===1?l.pow(new D.default(9)):l.pow(new D.default(15)),L=m.rewardInfos.map((V,N)=>{let H=S.rewardDebts[N];return S.deposited.mul(m.version===6?V.accRewardPerShare:V.perShareReward).div(R).sub(H)});d[p].wrapped=v(_({},d[p].wrapped),{pendingRewards:L})}return d}function sn(r,t=Date.now()){if(r.version===6){let e=r.state.rewardInfos;if(e.every(({rewardOpenTime:n})=>er(t,n.toNumber(),{unit:"s"})))return"upcoming pool";if(e.every(({rewardEndTime:n})=>tr(t,n.toNumber(),{unit:"s"})))return"closed pool"}else{let e=r.state.rewardInfos.map(({perSlotReward:n})=>n);if(e.length===2){if(String(e[0])==="0"&&String(e[1])!=="0")return"normal fusion pool";if(String(e[0])!=="0"&&String(e[1])!=="0")return"dual fusion pool";if(String(e[0])==="0"&&String(e[1])==="0")return"closed pool"}else if(e.length===1&&String(e[0])==="0")return"closed pool"}}async function Fe(r,t,e,n){let o=await r.getAccountInfo(t);if(o===null)throw Error("registrar info check error");let s=et.decode(o.data).votingMints.findIndex(h=>h.mint.equals(n));if(s===-1)throw Error("find voter mint error");let l=await r.getAccountInfo(e);if(l===null)return{index:s,isInit:!1};let d=tt.decode(l.data).deposits.findIndex(h=>h.isUsed&&h.votingMintConfigIdx===s);return d===-1?{index:s,isInit:!1}:{index:d,isInit:!0}}var u=require("@solana/web3.js"),be=F(require("bn.js")),C=require("@solana/spl-token");function Me(r,t,e){return E([t.toBuffer(),Buffer.from("registrar","utf8"),e.toBuffer()],r)}function De(r,t){return E([t.toBuffer(),Buffer.from("voting_mint_seed","utf8")],r)}function Ne(r,t){return E([t.toBuffer()],r)}function ve(r,t,e){return E([t.toBuffer(),Buffer.from("voter","utf8"),e.toBuffer()],r)}function Ee(r,t,e){return E([t.toBuffer(),Buffer.from("voter-weight-record","utf8"),e.toBuffer()],r)}function We(r,t,e,n){return E([Buffer.from("governance","utf8"),t.toBuffer(),e.toBuffer(),n.toBuffer()],r)}var an=K("Raydium_farm_instruction"),he={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function un(r){let{version:t,id:e,ledger:n,programId:o,owner:a}=r,s={3:9,5:10}[t];s||an.logWithError(`invalid farm pool version: ${t}`);let l=Buffer.alloc(Se.span);Se.encode({instruction:s},l);let f=[i({pubkey:e}),i({pubkey:n}),i({pubkey:a,isWritable:!1}),i({pubkey:u.SystemProgram.programId,isWritable:!1}),i({pubkey:u.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new u.TransactionInstruction({programId:o,keys:f,data:l}),instructionType:oe.FarmV3CreateLedger}}function cn(r){var n;let t=Buffer.alloc(Ie.span);Ie.encode({instruction:0,nonce:new be.default(r.nonce),rewardTimeInfo:r.rewardInfoConfig},t);let e=[...ut,i({pubkey:r.farmId}),i({pubkey:r.farmAuthority,isWritable:!1}),i({pubkey:r.lpVault}),i({pubkey:r.lpMint,isWritable:!1}),i({pubkey:r.lockVault}),i({pubkey:r.lockMint,isWritable:!1}),i({pubkey:(n=r.lockUserAccount)!=null?n:J}),i({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let o of r.rewardInfo)e.push(i({pubkey:o.rewardMint,isWritable:!1}),i({pubkey:o.rewardVault}),i({pubkey:o.userRewardToken}));return{instruction:new u.TransactionInstruction({programId:r.programId,keys:e,data:t}),instructionType:oe.FarmV6Create}}function ln(r){let t=Buffer.alloc(ke.span);ke.encode({instruction:5},t);let e=[i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),i({pubkey:r.id}),i({pubkey:r.authority,isWritable:!1}),i({pubkey:r.lpVault,isWritable:!1}),i({pubkey:r.rewardVault}),i({pubkey:r.userRewardToken}),i({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new u.TransactionInstruction({programId:r.programId,keys:e,data:t}),instructionType:oe.FarmV6CreatorWithdraw}}function dr(r,t,e,n,o,a,s,l,f,d,h,b,p){let m=P([k("depositEntryIndex"),c("amount")]),S=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:Ke,isSigner:!1,isWritable:!1}],R=Buffer.alloc(m.span);m.encode({depositEntryIndex:b,amount:p},R);let L=Buffer.from([...he.voterStakeRegistryDeposit,...R]);return new u.TransactionInstruction({keys:S,programId:r,data:L})}function pr(r,t,e,n){let o=P([]),a=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u.SystemProgram.programId,isSigner:!1,isWritable:!1}],s=Buffer.alloc(o.span);o.encode({},s);let l=Buffer.from([...he.voterStakeRegistryUpdateVoterWeightRecord,...s]);return new u.TransactionInstruction({keys:a,programId:r,data:l})}function mr(r,t,e,n,o,a,s,l,f,d,h,b,p,m,S){let R=P([k("depositEntryIndex"),c("amount")]),L=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Ke,isSigner:!1,isWritable:!1}],V=Buffer.alloc(R.span);R.encode({depositEntryIndex:m,amount:S},V);let N=Buffer.from([...he.voterStakeRegistryWithdraw,...V]);return new u.TransactionInstruction({keys:L,programId:r,data:N})}function fr(r,t,e,n,o,a){let s=P([k("ins")]),l=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:u.SystemProgram.programId,isSigner:!1,isWritable:!1}],f=Buffer.alloc(s.span);return s.encode({ins:23},f),new u.TransactionInstruction({keys:l,programId:r,data:f})}function yr(r,t,e,n,o,a,s,l){let f=P([k("voterBump"),k("voterWeightRecordBump")]),d=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:u.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:Ke,isSigner:!1,isWritable:!1}],h=Buffer.alloc(f.span);f.encode({voterBump:s,voterWeightRecordBump:l},h);let b=Buffer.from([...he.voterStakeRegistryCreateVoter,...h]);return new u.TransactionInstruction({keys:d,programId:r,data:b})}function gr(r,t,e,n,o,a,s,l,f,d,h,b){let p=P([k("depositEntryIndex"),k("kind"),k("option"),c("startTs"),ee("periods"),ue("allowClawback")]),m=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:C.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:C.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1}],S=Buffer.alloc(p.span);p.encode({depositEntryIndex:l,kind:f,option:d===void 0?0:1,startTs:d,periods:h,allowClawback:b},S);let R=Buffer.from([...he.voterStakeRegistryCreateDepositEntry,...S]);return new u.TransactionInstruction({keys:m,programId:r,data:R})}async function dn({connection:r,programId:t,governanceProgramId:e,voteWeightAddinProgramId:n,realm:o,communityTokenMint:a,owner:s,poolId:l,tokenProgram:f}){let d=Me(n,o,a).publicKey,h=W({programId:t,poolId:l,owner:s,version:3}),b=await r.getAccountInfo(h);if(b===null)throw Error("user is not staker");let p=te.decode(b.data),m=p.deposited.sub(p.voteLockedBalance);if(console.log("amount",m.toString()),m.eq(new be.default(0)))throw Error("user do not has new stake amount");let S=De(t,l).publicKey,R=Ne(t,l).publicKey,{publicKey:L,nonce:V}=ve(n,d,s),N=ye(L,S,f).publicKey,{publicKey:H,nonce:we}=Ee(n,d,s),Oe=We(e,o,a,s).publicKey,se=[],Ue=ye(s,S,f).publicKey;if(await r.getAccountInfo(Ue)===null&&se.push((0,C.createAssociatedTokenAccountIdempotentInstruction)(s,Ue,s,S)),await r.getAccountInfo(L)===null){let hr=fr(e,o,s,a,s,Oe);se.push(hr,yr(n,d,L,H,s,s,V,we))}let{index:yt,isInit:br}=await Fe(r,d,L,S);return br||se.push(gr(n,d,L,N,s,s,S,yt,0,void 0,0,!1)),se.push(dr(n,d,L,N,Ue,s,h,l,S,R,t,yt,m),pr(n,d,L,H)),se}async function pn({connection:r,programId:t,governanceProgramId:e,voteWeightAddinProgramId:n,realm:o,communityTokenMint:a,owner:s,poolId:l,tokenProgram:f}){let d=Me(n,o,a).publicKey,h=W({programId:t,poolId:l,owner:s,version:3}),b=await r.getAccountInfo(h);if(b===null)throw Error("user is not staker");let p=te.decode(b.data);if(p.voteLockedBalance.eq(new be.default(0)))throw Error("user has vote locked balance = 0");let m=De(t,l).publicKey,S=Ne(t,l).publicKey,{publicKey:R}=ve(n,d,s),L=ye(R,m,f).publicKey,{publicKey:V}=Ee(n,d,s),N=We(e,o,a,s).publicKey,H=[],{index:we,isInit:Oe}=await Fe(r,d,R,m);if(!Oe)throw Error("deposit entry index check error");return H.push(mr(n,d,R,s,N,V,L,ye(s,m,f).publicKey,h,l,m,S,t,we,p.voteLockedBalance)),H}function mn({payer:r,rewardVault:t,userRewardTokenPub:e,farmKeys:n,rewardInfo:o}){let a=Buffer.alloc(Le.span);Le.encode({instruction:3,rewardReopenTime:x(o.openTime),rewardEndTime:x(o.endTime),rewardPerSecond:x(o.perSecond)},a);let s=[i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),i({pubkey:n.id}),i({pubkey:n.lpVault,isWritable:!1}),i({pubkey:t}),i({pubkey:e}),i({pubkey:r,isWritable:!1,isSigner:!0})];return new u.TransactionInstruction({programId:n.programId,keys:s,data:a})}function fn({payer:r,userRewardTokenPub:t,farmKeys:e,rewardVault:n,rewardInfo:o}){let a=Buffer.alloc(Ae.span);Ae.encode({instruction:4,isSet:new be.default(1),rewardPerSecond:x(o.perSecond),rewardOpenTime:x(o.openTime),rewardEndTime:x(o.endTime),rewardType:x(Y[o.rewardType])},a);let s=[...ut,i({pubkey:e.id}),i({pubkey:e.authority,isWritable:!1}),i({pubkey:o.mint,isWritable:!1}),i({pubkey:n}),i({pubkey:t}),i({pubkey:r,isWritable:!1,isSigner:!0})];return new u.TransactionInstruction({programId:e.programId,keys:s,data:a})}function yn(r){let{farmInfo:t,farmKeys:e,version:n,lpAccount:o,rewardAccounts:a,owner:s,instruction:l,amount:f,deposit:d}=r,[h,b]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],p=W({programId:h,poolId:b,owner:s,version:n}),m=Buffer.alloc(M.span);M.encode({instruction:l,amount:f},m);let S=n===6?[i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),...d?[i({pubkey:u.SystemProgram.programId,isWritable:!1})]:[],i({pubkey:b}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:p}),i({pubkey:s,isWritable:!1,isSigner:!0}),i({pubkey:o})]:[i({pubkey:b}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:p}),i({pubkey:s,isWritable:!1,isSigner:!0}),i({pubkey:o}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:a[0]}),i({pubkey:new u.PublicKey(e.rewardInfos[0].vault)}),i({pubkey:u.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1})];if(n===5)for(let R=1;R<e.rewardInfos.length;R++)S.push(i({pubkey:a[R]})),S.push(i({pubkey:new u.PublicKey(e.rewardInfos[R].vault)}));if(n===6)for(let R=0;R<e.rewardInfos.length;R++)S.push(i({pubkey:new u.PublicKey(e.rewardInfos[R].vault)})),S.push(i({pubkey:a[R]}));return new u.TransactionInstruction({programId:h,keys:S,data:m})}function gn(r){let{farmInfo:t,farmKeys:e,lpAccount:n,rewardAccounts:o,owner:a,amount:s}=r,[l,f]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],d=W({programId:l,poolId:f,owner:a,version:6}),h=Buffer.alloc(M.span);M.encode({instruction:2,amount:x(s)},h);let b=[i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),i({pubkey:f}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:d}),i({pubkey:a,isWritable:!1,isSigner:!0}),i({pubkey:n})];for(let p=0;p<e.rewardInfos.length;p++)b.push(i({pubkey:new u.PublicKey(e.rewardInfos[p].vault)})),b.push(i({pubkey:o[p]}));return new u.TransactionInstruction({programId:l,keys:b,data:h})}function bn(r){let{farmInfo:t,farmKeys:e,lpAccount:n,rewardAccounts:o,owner:a,amount:s,userAuxiliaryLedgers:l}=r,[f,d]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],h=W({programId:f,poolId:d,owner:a,version:5}),b=Buffer.alloc(M.span);M.encode({instruction:12,amount:x(s)},b);let p=[i({pubkey:d}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:h}),i({pubkey:a,isWritable:!1,isSigner:!0}),i({pubkey:n}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:o[0]}),i({pubkey:new u.PublicKey(e.rewardInfos[0].vault)}),i({pubkey:u.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1})];for(let m=1;m<e.rewardInfos.length;m++)p.push(i({pubkey:o[m]})),p.push(i({pubkey:new u.PublicKey(e.rewardInfos[m].vault)}));if(l)for(let m of l)p.push(i({pubkey:m}));return new u.TransactionInstruction({programId:f,keys:p,data:b})}function hn(r){let{farmInfo:t,farmKeys:e,lpAccount:n,rewardAccounts:o,owner:a,amount:s,userAuxiliaryLedgers:l}=r,[f,d]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],h=P([k("instruction"),c("amount")]),b=[i({pubkey:d}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:l[0]}),i({pubkey:a,isSigner:!0,isWritable:!1}),i({pubkey:n}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:o[0]}),i({pubkey:new u.PublicKey(e.rewardInfos[0].vault)}),i({pubkey:u.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),i({pubkey:o[1]}),i({pubkey:new u.PublicKey(e.rewardInfos[1].vault)})],p=Buffer.alloc(h.span);return h.encode({instruction:2,amount:s},p),new u.TransactionInstruction({keys:b,programId:f,data:p})}function wn(r){let{farmInfo:t,farmKeys:e,lpAccount:n,rewardAccounts:o,owner:a,amount:s,userAuxiliaryLedgers:l}=r,[f,d]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],h=W({programId:f,poolId:d,owner:a,version:3}),b=Buffer.alloc(M.span);M.encode({instruction:11,amount:x(s)},b);let p=[i({pubkey:d}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:h}),i({pubkey:a,isWritable:!1,isSigner:!0}),i({pubkey:n}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:o[0]}),i({pubkey:new u.PublicKey(e.rewardInfos[0].vault)}),i({pubkey:u.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1})];if(l)for(let m of l)p.push(i({pubkey:m}));return new u.TransactionInstruction({programId:f,keys:p,data:b})}function Tn(r){let{farmInfo:t,farmKeys:e,lpAccount:n,rewardAccounts:o,owner:a,amount:s,userAuxiliaryLedgers:l}=r,[f,d]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],h=W({programId:f,poolId:d,owner:a,version:3}),b=Buffer.alloc(M.span);M.encode({instruction:10,amount:x(s)},b);let p=[i({pubkey:d}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:h}),i({pubkey:a,isWritable:!1,isSigner:!0}),i({pubkey:n}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:o[0]}),i({pubkey:new u.PublicKey(e.rewardInfos[0].vault)}),i({pubkey:u.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1})];if(l)for(let m of l)p.push(i({pubkey:m}));return new u.TransactionInstruction({programId:f,keys:p,data:b})}function xn(r){let{farmInfo:t,farmKeys:e,lpAccount:n,rewardAccounts:o,owner:a,amount:s,userAuxiliaryLedgers:l}=r,[f,d]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],h=W({programId:f,poolId:d,owner:a,version:5}),b=Buffer.alloc(M.span);M.encode({instruction:11,amount:x(s)},b);let p=[i({pubkey:d}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:h}),i({pubkey:a,isWritable:!1,isSigner:!0}),i({pubkey:n}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:o[0]}),i({pubkey:new u.PublicKey(e.rewardInfos[0].vault)}),i({pubkey:u.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1})];for(let m=1;m<e.rewardInfos.length;m++)p.push(i({pubkey:o[m]})),p.push(i({pubkey:new u.PublicKey(e.rewardInfos[m].vault)}));if(l)for(let m of l)p.push(i({pubkey:m}));return new u.TransactionInstruction({programId:f,keys:p,data:b})}function Pn(r){let{farmInfo:t,farmKeys:e,lpAccount:n,rewardAccounts:o,owner:a,amount:s}=r,[l,f]=[new u.PublicKey(t.programId),new u.PublicKey(t.id)],d=W({programId:l,poolId:f,owner:a,version:6}),h=Buffer.alloc(M.span);M.encode({instruction:1,amount:x(s)},h);let b=[i({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),i({pubkey:u.SystemProgram.programId,isWritable:!1}),i({pubkey:f}),i({pubkey:new u.PublicKey(e.authority),isWritable:!1}),i({pubkey:new u.PublicKey(e.lpVault)}),i({pubkey:d}),i({pubkey:a,isWritable:!1,isSigner:!0}),i({pubkey:n})];for(let p=0;p<e.rewardInfos.length;p++)b.push(i({pubkey:new u.PublicKey(e.rewardInfos[p].vault)})),b.push(i({pubkey:o[p]}));return new u.TransactionInstruction({programId:l,keys:b,data:h})}0&&(module.exports={DEV_FARM_LOCK_MINT,DEV_FARM_LOCK_VAULT,FARM_LOCK_MINT,FARM_LOCK_VAULT,FARM_PROGRAM_TO_VERSION,FARM_VERSION_TO_LEDGER_LAYOUT,FARM_VERSION_TO_STATE_LAYOUT,Voter,VoterDepositEntry,VoterLockup,VoterRegistrar,VoterVotingMintConfig,associatedLedgerAccountLayout,calFarmRewardAmount,createAssociatedLedgerAccountInstruction,dwLayout,farmAddRewardLayout,farmLedgerLayoutV3_1,farmLedgerLayoutV3_2,farmLedgerLayoutV5_1,farmLedgerLayoutV5_2,farmLedgerLayoutV6_1,farmRewardInfoToConfig,farmRewardLayout,farmRewardRestartLayout,farmRewardTimeInfoLayout,farmStateV3Layout,farmStateV5Layout,farmStateV6Layout,fetchMultipleFarmInfoAndUpdate,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getDepositEntryIndex,getFarmLedgerLayout,getFarmStateLayout,getRegistrarAddress,getTokenOwnerRecordAddress,getVoterAddress,getVoterWeightRecordAddress,getVotingMintAuthority,getVotingTokenMint,governanceCreateTokenOwnerRecord,isValidFarmVersion,judgeFarmType,makeAddNewRewardInstruction,makeCreateFarmInstruction,makeCreatorWithdrawFarmRewardInstruction,makeDepositInstructionV3,makeDepositInstructionV5,makeDepositInstructionV6,makeDepositTokenInstruction,makeDepositWithdrawInstruction,makeRestartRewardInstruction,makeWithdrawInstructionV3,makeWithdrawInstructionV4,makeWithdrawInstructionV5,makeWithdrawInstructionV6,makeWithdrawTokenInstruction,poolTypeV6,realFarmStateV3Layout,realFarmStateV5Layout,realFarmV6Layout,updateFarmPoolInfo,validateFarmRewards,voterStakeRegistryCreateDepositEntry,voterStakeRegistryCreateVoter,voterStakeRegistryDeposit,voterStakeRegistryUpdateVoterWeightRecord,voterStakeRegistryWithdraw,withdrawRewardLayout});
//# sourceMappingURL=index.js.map