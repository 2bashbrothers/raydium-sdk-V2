var fn=Object.create;var ve=Object.defineProperty,yn=Object.defineProperties,gn=Object.getOwnPropertyDescriptor,bn=Object.getOwnPropertyDescriptors,hn=Object.getOwnPropertyNames,rt=Object.getOwnPropertySymbols,wn=Object.getPrototypeOf,At=Object.prototype.hasOwnProperty,dr=Object.prototype.propertyIsEnumerable;var lr=(r,e,t)=>e in r?ve(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,j=(r,e)=>{for(var t in e||(e={}))At.call(e,t)&&lr(r,t,e[t]);if(rt)for(var t of rt(e))dr.call(e,t)&&lr(r,t,e[t]);return r},J=(r,e)=>yn(r,bn(e));var Ne=(r,e)=>{var t={};for(var n in r)At.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&rt)for(var n of rt(r))e.indexOf(n)<0&&dr.call(r,n)&&(t[n]=r[n]);return t};var xn=(r,e)=>{for(var t in e)ve(r,t,{get:e[t],enumerable:!0})},pr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of hn(e))!At.call(r,o)&&o!==t&&ve(r,o,{get:()=>e[o],enumerable:!(n=gn(e,o))||n.enumerable});return r};var Q=(r,e,t)=>(t=r!=null?fn(wn(r)):{},pr(e||!r||!r.__esModule?ve(t,"default",{value:r,enumerable:!0}):t,r)),Tn=r=>pr(ve({},"__esModule",{value:!0}),r);var co={};xn(co,{default:()=>Tt});module.exports=Tn(co);var W=require("@solana/web3.js"),cr=require("@solana/spl-token");var fr=require("@solana/web3.js");var Oe=require("lodash");var kt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},mr={},Pn={};function Y(r){let e=(0,Oe.get)(mr,r);if(!e){let t=(0,Oe.get)(Pn,r);e=new kt({name:r,logLevel:t}),(0,Oe.set)(mr,r,e)}return e}var nt=require("@solana/spl-token"),It=Y("Raydium_accountInfo_util");async function yr(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:s=100}=j({batchRequest:!1},t),a=St(e,s),i=new Array(a.length).fill([]);if(n){let f=a.map(u=>{let p=r._buildArgs([u.map(w=>w.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),d=St(f,10);i=(await(await Promise.all(d.map(async u=>await r._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&It.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(p=>{if(p){let{data:w,executable:l,lamports:x,owner:y,rentEpoch:K}=p;return w.length!==2&&w[1]!=="base64"&&It.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(w[0],"base64"),executable:l,lamports:x,owner:new fr.PublicKey(y),rentEpoch:K}}return null})))}else try{i=await Promise.all(a.map(f=>r.getMultipleAccountsInfo(f,o)))}catch(f){f instanceof Error&&It.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return i.flat()}var de=Q(require("bn.js")),Vn=Q(require("decimal.js"));var Tr=Q(require("big.js")),qe=Q(require("bn.js"));var gr=Q(require("toformat")),An=gr.default,We=An;var Ue=Q(require("big.js")),hr=Q(require("bn.js")),wr=Q(require("decimal.js-light"));var Ce=Q(require("bn.js"));var br=9007199254740991;function E(r){let e=Y("Raydium_parseBigNumberish");if(r instanceof Ce.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Ce.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=br||r<=-br)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Ce.default(String(r))):typeof r=="bigint"?new Ce.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Ce.default(0))}var it=Y("module/fraction"),Lt=We(Ue.default),Ge=We(wr.default),In={[0]:Ge.ROUND_DOWN,[1]:Ge.ROUND_HALF_UP,[2]:Ge.ROUND_UP},Sn={[0]:Ue.default.roundDown,[1]:Ue.default.roundHalfUp,[2]:Ue.default.roundUp},G=class{constructor(e,t=new hr.default(1)){this.numerator=E(e),this.denominator=E(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new G(this.denominator,this.numerator)}add(e){let t=e instanceof G?e:new G(E(e));return this.denominator.eq(t.denominator)?new G(this.numerator.add(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof G?e:new G(E(e));return this.denominator.eq(t.denominator)?new G(this.numerator.sub(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof G?e:new G(E(e));return new G(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof G?e:new G(E(e));return new G(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||it.logWithError(`${e} is not an integer.`),e<=0&&it.logWithError(`${e} is not positive.`),Ge.set({precision:e+1,rounding:In[n]});let o=new Ge(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||it.logWithError(`${e} is not an integer.`),e<0&&it.logWithError(`${e} is negative.`),Lt.DP=e,Lt.RM=Sn[n]||1,new Lt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ln=Y("Raydium_amount"),xr=We(Tr.default);function Bn(r,e){let t="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([t,n]=o,n=n.padEnd(e,"0")):Ln.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var ge=class extends G{constructor(t,n,o=!0,s){let a=new qe.default(0),i=Bt.pow(new qe.default(t.decimals));if(o)a=E(n);else{let f=new qe.default(0),d=new qe.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,u]=Bn(n.toString(),t.decimals);f=E(m),d=E(u)}f=f.mul(i),a=f.add(d)}super(a,i);this.logger=Y(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ge(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ge(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return xr.DP=this.token.decimals,new xr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var Pr=require("@solana/web3.js"),Rt=require("@solana/spl-token"),Ar={chainId:101,address:Pr.PublicKey.default.toBase58(),programId:Rt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ie={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Rt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var st=require("@solana/web3.js");var q=require("@solana/web3.js"),kr=require("@solana/spl-token");function c({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Kt=[c({pubkey:kr.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:q.SystemProgram.programId,isWritable:!1}),c({pubkey:q.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Ct({publicKey:r,transformSol:e}){let t=Vt(r.toString());if(t instanceof q.PublicKey)return e&&t.equals(ee)?ye:t;if(e&&t.toString()===ee.toBase58())return ye;if(typeof t=="string"){if(t===q.PublicKey.default.toBase58())return q.PublicKey.default;try{return new q.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Vt(r){try{return new q.PublicKey(r)}catch{return r}}var vo=new q.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),No=new q.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Rn=new q.PublicKey("SysvarRent111111111111111111111111111111111"),Oo=new q.PublicKey("SysvarC1ock11111111111111111111111111111111"),Wo=new q.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Kn=new q.PublicKey("Sysvar1nstructions1111111111111111111111111"),Uo=q.SystemProgram.programId,Go=new q.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),qo=new q.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),jo=new q.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ho=new q.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),zo=new q.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Xo=new q.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Yo=new q.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Zo=new q.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Jo=new q.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Qo=new q.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),$o=new q.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ye=new q.PublicKey("So11111111111111111111111111111111111111112"),ee=q.PublicKey.default;function ot(r){return Ct({publicKey:r,transformSol:!0})}var Ft=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:s=!1,isToken2022:a=!1}){if(e===ee.toBase58()||e instanceof st.PublicKey&&ee.equals(e)){this.decimals=ie.decimals,this.symbol=ie.symbol,this.name=ie.name,this.mint=new st.PublicKey(ie.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?st.PublicKey.default:Ct({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Se=Ft;Se.WSOL=new Ft(J(j({},ie),{mint:ie.address}));var Mt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},at=Mt;at.SOL=new Mt(Ar);var Sr=Q(require("bn.js"));var Ir=new G(new Sr.default(100)),Ve=class extends G{toSignificant(e=5,t,n){return this.mul(Ir).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ir).toFixed(e,t,n)}};var Cn=Y("Raydium_price"),be=class extends G{constructor(t){let{baseToken:n,quoteToken:o,numerator:s,denominator:a}=t;super(s,a);this.baseToken=n,this.quoteToken=o,this.scalar=new G(_t(n.decimals),_t(o.decimals))}get raw(){return new G(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new be({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Cn.logWithError("mul token not equals");let n=super.mul(t);return new be({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var Lr=require("@solana/web3.js"),Br=Q(require("bn.js"));function Rr(r){return typeof r=="object"&&r!==null&&![Se,ge,Lr.PublicKey,G,Br.default,be,Ve].some(e=>typeof e=="object"&&r instanceof e)}function he(r){return typeof r=="string"?Vt(r):Array.isArray(r)?r.map(e=>he(e)):Rr(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,he(t)])):r}var Dt=new de.default(0),Ui=new de.default(1),Gi=new de.default(2),qi=new de.default(3),ji=new de.default(5),Bt=new de.default(10),Hi=new de.default(100),zi=new de.default(1e3),Xi=new de.default(1e4);function _t(r){return Bt.pow(E(r))}function St(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var pe=class{constructor(e){this._owner=e}get publicKey(){return pe.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return pe.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return pe.isKeyPair(this._owner)}get isPublicKey(){return pe.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!pe.isKeyPair(e)}};var Fr=require("@solana/web3.js"),Mr=require("@solana/spl-token");var re=require("@solana/web3.js");var H={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Cr=require("@solana/spl-token"),Kr=Y("Raydium_txUtil"),Vr=1644;function je(r){let e=[],t=[];return r.microLamports&&(e.push(re.ComputeBudgetProgram.setComputeUnitPrice({microLamports:r.microLamports})),t.push(H.SetComputeUnitPrice)),r.units&&(e.push(re.ComputeBudgetProgram.setComputeUnitLimit({units:r.units})),t.push(H.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Le(r,e){var n,o;let t=e!=null?e:"confirmed";return(o=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:o.blockhash}async function He(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let o=setTimeout(n,6e4);r.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function Fn(r,e){r.length<1&&Kr.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Kr.logWithError(`no signers provided:, ${e.toString()}`);let t=new re.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Vr}catch{return!1}}function Be(r,e){let[t,n]=re.PublicKey.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function ze({instructions:r,payer:e,signers:t}){return Fn(r,[e,...t])}function we({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=re.Keypair.generate().publicKey.toString()}){let s=new re.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new re.VersionedTransaction(s).serialize()).toString("base64").length<Vr}catch{return!1}}var Mn=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),_n=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof re.VersionedTransaction&&(e=Mn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Pe(r){let e=[];return r.forEach(t=>{t instanceof re.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Cr.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=re.Keypair.generate().publicKey)),e.push(_n(t))}),console.log("simulate tx string:",e),e}function Fe(r,e,t){return Be([r.toBuffer(),(t!=null?t:Mr.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new Fr.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var C=require("@solana/web3.js"),_r=new C.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Dr=new C.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Er=new C.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Xe=new C.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ls=new C.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ds=new C.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ps=new C.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ms=new C.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),fs=new C.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ys=new C.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),gs=new C.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),bs=new C.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),hs=new C.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ws=new C.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),xs=new C.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ts=new C.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ps=new C.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),As=new C.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ks=new C.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Is=new C.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ss=new C.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ls=new C.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Bs=new C.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Rs=new C.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ks=new C.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Cs=new C.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Vs=new C.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Fs=new C.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ms=new C.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),_s=new C.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Ds=new C.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Re={OPEN_BOOK_PROGRAM:new C.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new C.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new C.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new C.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new C.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new C.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new C.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new C.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new C.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new C.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new C.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new C.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:C.PublicKey.default,Router:new C.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new C.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new C.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new C.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new C.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new C.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new C.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new C.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new C.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new C.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new C.PublicKey("Ray1111111111111111111111111111111111111111")};var Dn=Q(require("bn.js"));var ue=require("@solana/web3.js");async function ut({connection:r,address:e,cluster:t="mainnet"}){let n=await yr(r,[...new Set(e.map(s=>s.toString()))].map(s=>new ue.PublicKey(s))),o={};for(let s=0;s<e.length;s++){let a=n[s],i=e[s];if(!a)continue;let f=new ue.AddressLookupTableAccount({key:i,state:ue.AddressLookupTableAccount.deserialize(a.data)});o[i.toString()]=f,t==="devnet"?Me[i.toString()]=f:Ye[i.toString()]=f}return o}var Ye={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ue.AddressLookupTableAccount({key:new ue.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ue.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Me={},ct=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Me[e])return Me;let t=new ue.PublicKey(e),n=await r.getAccountInfo(t);return n&&(Me[e]=new ue.AddressLookupTableAccount({key:t,state:ue.AddressLookupTableAccount.deserialize(n.data)})),Me};var v=require("@solana/web3.js"),vr=Q(require("axios"));var Ze=2e3,Je=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await vr.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=je(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(v.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new v.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(H.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:a=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...a.filter(i=>i!==v.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(j({},t||{})):this.build(t)}build(e){var n;let t=new v.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var m;let{recentBlockHash:s,skipPreflight:a=!0,sendAndConfirm:i,notSendToRpc:f}=o||{},d=s!=null?s:await Le(this.connection,this.blockhashCommitment);if(t.recentBlockhash=d,this.signers.length&&t.sign(...this.signers),Pe([t]),(m=this.owner)!=null&&m.isKeyPair)return{txId:i?await(0,v.sendAndConfirmTransaction)(this.connection,t,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:a}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);if(this.signers.length)for(let p of u)try{p.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:a}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var d;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:o}=this.build(n),s=t.filter(m=>m.transaction.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(d=this.owner)!=null&&d.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:i,instructionTypes:f,execute:async m=>{var K;let{sequentially:u,onTxUpdate:p,skipTxCount:w=0,recentBlockHash:l,skipPreflight:x=!0}=m||{},y=l!=null?l:await Le(this.connection,this.blockhashCommitment);if((K=this.owner)!=null&&K.isKeyPair){if(u){let S=[],M=0;for(let g of a){if(++M,M<=w)continue;let h=await(0,v.sendAndConfirmTransaction)(this.connection,g,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});S.push(h)}return{txIds:S,signedTxs:a}}return{txIds:await await Promise.all(a.map(async S=>(S.recentBlockhash=y,await this.connection.sendRawTransaction(S.serialize(),{skipPreflight:x})))),signedTxs:a}}if(this.signAllTransactions){let S=a.map((g,h)=>(g.recentBlockhash=y,i[h].length&&g.sign(...i[h]),g));Pe(S);let M=await this.signAllTransactions(S);if(u){let g=0,h=[],b=async()=>{if(!M[g])return;let I=await this.connection.sendRawTransaction(M[g].serialize(),{skipPreflight:x});h.push({txId:I,status:"sent",signedTx:M[g]}),p==null||p([...h]),g++;let A=!1,B=null,R=null,F=P=>{B!==null&&clearInterval(B),R!==null&&this.connection.removeSignatureListener(R);let V=h.findIndex(k=>k.txId===I);if(V>-1){if(h[V].status==="error"||h[V].status==="success")return;h[V].status=P.err?"error":"success"}p==null||p([...h]),P.err||b()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var P;if(A){clearInterval(B);return}try{let V=await this.connection.getTransaction(I,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(A=!0,clearInterval(B),F({err:((P=V.meta)==null?void 0:P.err)||null}),console.log("tx status from getTransaction:",I))}catch(V){A=!0,clearInterval(B),console.error("getTransaction timeout:",V,I)}},Ze)),R=this.connection.onSignature(I,P=>{if(A){this.connection.removeSignatureListener(R);return}A=!0,F(P)},"confirmed"),this.connection.getSignatureStatus(I)};return await b(),{txIds:h.map(I=>I.txId),signedTxs:M}}else{let g=[];for(let h=0;h<M.length;h+=1){let b=await this.connection.sendRawTransaction(M[h].serialize(),{skipPreflight:x});g.push(b)}return{txIds:g,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var x;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:s}=l,a=Ne(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=j(j({},this.cluster==="devnet"?await ct(this.connection):Ye),t),f=Array.from(new Set([...n,...this.lookupTableAddress])),d=[];for(let y of f)i[y]===void 0&&d.push(new v.PublicKey(y));let m=await ut({connection:this.connection,address:d});for(let[y,K]of Object.entries(m))i[y]=K;let u=o?v.PublicKey.default.toBase58():s!=null?s:await Le(this.connection,this.blockhashCommitment),p=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((x=this.owner)==null?void 0:x.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let w=new v.VersionedTransaction(p);return w.sign(this.signers),{builder:this,transaction:w,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var g;let{skipPreflight:K=!0,sendAndConfirm:S,notSendToRpc:M}=y||{};if(Pe([w]),(g=this.owner)!=null&&g.isKeyPair){let h=await this.connection.sendTransaction(w,{skipPreflight:K});return S&&await He(this.connection,h),{txId:h,signedTx:w}}if(this.signAllTransactions){let h=await this.signAllTransactions([w]);if(this.signers.length)for(let b of h)try{b.sign(this.signers)}catch{}return{txId:M?"":await this.connection.sendTransaction(h[0],{skipPreflight:K}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){var d;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),s=t.filter(m=>m.builder.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(d=this.owner)!=null&&d.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(m,u)=>{m.sign(i[u])}),{builder:this,transactions:a,signers:i,instructionTypes:f,buildProps:n,execute:async m=>{var x;let{sequentially:u,onTxUpdate:p,recentBlockHash:w,skipPreflight:l=!0}=m||{};if(w&&a.forEach(y=>y.message.recentBlockhash=w),Pe(a),(x=this.owner)!=null&&x.isKeyPair){if(u){let y=[];for(let K of a){let S=await this.connection.sendTransaction(K,{skipPreflight:l});await He(this.connection,S),y.push(S)}return{txIds:y,signedTxs:a}}return{txIds:await Promise.all(a.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:l}))),signedTxs:a}}if(this.signAllTransactions){let y=await this.signAllTransactions(a);if(u){let K=0,S=[],M=async()=>{if(!y[K])return;let g=await this.connection.sendTransaction(y[K],{skipPreflight:l});S.push({txId:g,status:"sent",signedTx:y[K]}),p==null||p([...S]),K++;let h=!1,b=null,I=null,A=B=>{b!==null&&clearInterval(b),I!==null&&this.connection.removeSignatureListener(I);let R=S.findIndex(F=>F.txId===g);if(R>-1){if(S[R].status==="error"||S[R].status==="success")return;S[R].status=B.err?"error":"success"}p==null||p([...S]),B.err||M()};this.loopMultiTxStatus&&(b=setInterval(async()=>{var B;if(h){clearInterval(b);return}try{let R=await this.connection.getTransaction(g,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(h=!0,clearInterval(b),A({err:((B=R.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",g))}catch(R){h=!0,clearInterval(b),console.error("getTransaction timeout:",R,g)}},Ze)),I=this.connection.onSignature(g,B=>{if(h){this.connection.removeSignatureListener(I);return}h=!0,A(B)},"confirmed"),this.connection.getSignatureStatus(g)};return M(),{txIds:[],signedTxs:y}}else{let K=[];for(let S=0;S<y.length;S+=1){let M=await this.connection.sendTransaction(y[S],{skipPreflight:l});K.push(M)}return{txIds:K,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var p;let u=e||{},{splitIns:t=[],computeBudgetConfig:n}=u,o=Ne(u,["splitIns","computeBudgetConfig"]),s=n?je(n):{instructions:[],instructionTypes:[]},a=this.signers.reduce((w,l)=>J(j({},w),{[l.publicKey.toBase58()]:l}),{}),i=[],f=[],d=[],m=0;if(this.allInstructions.forEach(w=>{let l=[...d,w],x=n?[...s.instructions,...l]:l,K=[...new Set(l.map(S=>S.keys.filter(M=>M.isSigner).map(M=>M.pubkey.toString())).flat()).values()].map(S=>new v.PublicKey(S));if(w!==t[m]&&d.length<12&&(ze({instructions:x,payer:this.feePayer,signers:K})||ze({instructions:l,payer:this.feePayer,signers:K})))d.push(w);else{if(d.length===0)throw Error("item ins too big");m+=w===t[m]?1:0,ze({instructions:n?[...s.instructions,...d]:[...d],payer:this.feePayer,signers:K})?i.push(new v.Transaction().add(...s.instructions,...d)):i.push(new v.Transaction().add(...d)),f.push(Array.from(new Set(d.map(S=>S.keys.filter(M=>M.isSigner).map(M=>M.pubkey.toString())).flat())).map(S=>a[S]).filter(S=>S!==void 0)),d=[w]}}),d.length>0){let l=[...new Set(d.map(x=>x.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(x=>a[x]).filter(x=>x!==void 0);ze({instructions:n?[...s.instructions,...d]:[...d],payer:this.feePayer,signers:l.map(x=>x.publicKey)})?i.push(new v.Transaction().add(...s.instructions,...d)):i.push(new v.Transaction().add(...d)),f.push(l)}return i.forEach(w=>w.feePayer=this.feePayer),(p=this.owner)!=null&&p.signer&&f.forEach(w=>{w.some(l=>l.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:i,signers:f,instructionTypes:this.instructionTypes,execute:async w=>{var g;let{sequentially:l,onTxUpdate:x,skipTxCount:y=0,recentBlockHash:K,skipPreflight:S=!0}=w||{},M=K!=null?K:await Le(this.connection,this.blockhashCommitment);if(i.forEach(async(h,b)=>{h.recentBlockhash=M,f[b].length&&h.sign(...f[b])}),Pe(i),(g=this.owner)!=null&&g.isKeyPair){if(l){let h=0,b=[];for(let I of i){if(++h,h<=y){b.push("tx skipped");continue}let A=await(0,v.sendAndConfirmTransaction)(this.connection,I,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:S});b.push(A)}return{txIds:b,signedTxs:i}}return{txIds:await Promise.all(i.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:S}))),signedTxs:i}}if(this.signAllTransactions){let h=await this.signAllTransactions(i.slice(y,i.length)),b=[...i.slice(0,y),...h];if(l){let I=0,A=[],B=async()=>{if(!b[I])return;I<y&&(A.push({txId:"",status:"success",signedTx:b[I]}),x==null||x([...A]),I++,B());let R=await this.connection.sendRawTransaction(b[I].serialize(),{skipPreflight:S});A.push({txId:R,status:"sent",signedTx:b[I]}),x==null||x([...A]),I++;let F=!1,P=null,V=null,k=U=>{P!==null&&clearInterval(P),V!==null&&this.connection.removeSignatureListener(V);let O=A.findIndex(ne=>ne.txId===R);if(O>-1){if(A[O].status==="error"||A[O].status==="success")return;A[O].status=U.err?"error":"success"}x==null||x([...A]),U.err||B()};this.loopMultiTxStatus&&(P=setInterval(async()=>{var U;if(F){clearInterval(P);return}try{let O=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(F=!0,clearInterval(P),k({err:((U=O.meta)==null?void 0:U.err)||null}),console.log("tx status from getTransaction:",R))}catch(O){F=!0,clearInterval(P),console.error("getTransaction timeout:",O,R)}},Ze)),V=this.connection.onSignature(R,U=>{if(F){this.connection.removeSignatureListener(V);return}F=!0,k(U)},"confirmed"),this.connection.getSignatureStatus(R)};return await B(),{txIds:A.map(R=>R.txId),signedTxs:b}}else{let I=[];for(let A=0;A<b.length;A+=1){let B=await this.connection.sendRawTransaction(b[A].serialize(),{skipPreflight:S});I.push(B)}return{txIds:I,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var M;let S=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=S,a=Ne(S,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=j(j({},this.cluster==="devnet"?await ct(this.connection):Ye),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),d=[];for(let g of f)i[g]===void 0&&d.push(new v.PublicKey(g));let m=await ut({connection:this.connection,address:d});for(let[g,h]of Object.entries(m))i[g]=h;let u=t?je(t):{instructions:[],instructionTypes:[]},p=await Le(this.connection,this.blockhashCommitment),w=this.signers.reduce((g,h)=>J(j({},g),{[h.publicKey.toBase58()]:h}),{}),l=[],x=[],y=[],K=0;if(this.allInstructions.forEach(g=>{let h=[...y,g],b=t?[...u.instructions,...h]:h;if(g!==n[K]&&y.length<12&&(we({instructions:b,payer:this.feePayer,lookupTableAddressAccount:i})||we({instructions:h,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(g);else{if(y.length===0)throw Error("item ins too big");K+=g===n[K]?1:0;let I={};for(let A of[...new Set(f)])i[A]!==void 0&&(I[A]=i[A]);if(t&&we({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let A=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(A))}else{let A=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(A))}x.push(Array.from(new Set(y.map(A=>A.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(A=>w[A]).filter(A=>A!==void 0)),y=[g]}}),y.length>0){let h=[...new Set(y.map(b=>b.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(b=>w[b]).filter(b=>b!==void 0);if(t&&we({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}else{let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}x.push(h)}return(M=this.owner)!=null&&M.signer&&x.forEach(g=>{g.some(h=>h.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),l.forEach((g,h)=>{g.sign(x[h])}),{builder:this,transactions:l,buildProps:e,signers:x,blockHash:p,instructionTypes:this.instructionTypes,execute:async g=>{var R;let{sequentially:h,onTxUpdate:b,skipTxCount:I=0,recentBlockHash:A,skipPreflight:B=!0}=g||{};if(l.map(async(F,P)=>{x[P].length&&F.sign(x[P]),A&&(F.message.recentBlockhash=A)}),Pe(l),(R=this.owner)!=null&&R.isKeyPair){if(h){let F=0,P=[];for(let V of l){if(++F,F<=I){console.log("skip tx: ",F),P.push("tx skipped");continue}let k=await this.connection.sendTransaction(V,{skipPreflight:B});await He(this.connection,k),P.push(k)}return{txIds:P,signedTxs:l}}return{txIds:await Promise.all(l.map(async F=>await this.connection.sendTransaction(F,{skipPreflight:B}))),signedTxs:l}}if(this.signAllTransactions){let F=await this.signAllTransactions(l.slice(I,l.length)),P=[...l.slice(0,I),...F];if(h){let V=0,k=[],U=async()=>{if(!P[V])return;if(V<I){k.push({txId:"",status:"success",signedTx:P[V]}),b==null||b([...k]),V++,U();return}let O=await this.connection.sendTransaction(P[V],{skipPreflight:B});k.push({txId:O,status:"sent",signedTx:P[V]}),b==null||b([...k]),V++;let ne=!1,te=null,fe=null,Ee=oe=>{te!==null&&clearInterval(te),fe!==null&&this.connection.removeSignatureListener(fe);let $=k.findIndex(Pt=>Pt.txId===O);if($>-1){if(k[$].status==="error"||k[$].status==="success")return;k[$].status=oe.err?"error":"success"}b==null||b([...k]),oe.err||U()};this.loopMultiTxStatus&&(te=setInterval(async()=>{var oe;if(ne){clearInterval(te);return}try{let $=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});$&&(ne=!0,clearInterval(te),Ee({err:((oe=$.meta)==null?void 0:oe.err)||null}),console.log("tx status from getTransaction:",O))}catch($){ne=!0,clearInterval(te),console.error("getTransaction timeout:",$,O)}},Ze)),fe=this.connection.onSignature(O,oe=>{if(ne){this.connection.removeSignatureListener(fe);return}ne=!0,Ee(oe)},"confirmed"),this.connection.getSignatureStatus(O)};return U(),{txIds:[],signedTxs:P}}else{let V=[];for(let k=0;k<P.length;k+=1){let U=await this.connection.sendTransaction(P[k],{skipPreflight:B});V.push(U)}return{txIds:V,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildSniperTransaction(e){var M;let S=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=S,a=Ne(S,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=j(j({},this.cluster==="devnet"?await ct(this.connection):Ye),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),d=[];for(let g of f)i[g]===void 0&&d.push(new v.PublicKey(g));let m=await ut({connection:this.connection,address:d});for(let[g,h]of Object.entries(m))i[g]=h;let u=t?je(t):{instructions:[],instructionTypes:[]},p=await Le(this.connection,this.blockhashCommitment),w=this.signers.reduce((g,h)=>J(j({},g),{[h.publicKey.toBase58()]:h}),{}),l=[],x=[],y=[],K=0;if(this.allInstructions.forEach(g=>{let h=[...y,g],b=t?[...u.instructions,...h]:h;if(g!==n[K]&&y.length<12&&(we({instructions:b,payer:this.feePayer,lookupTableAddressAccount:i})||we({instructions:h,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(g);else{if(y.length===0)throw Error("item ins too big");K+=g===n[K]?1:0;let I={};for(let A of[...new Set(f)])i[A]!==void 0&&(I[A]=i[A]);if(t&&we({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let A=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(A))}else{let A=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(A))}x.push(Array.from(new Set(y.map(A=>A.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(A=>w[A]).filter(A=>A!==void 0)),y=[g]}}),y.length>0){let h=[...new Set(y.map(b=>b.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(b=>w[b]).filter(b=>b!==void 0);if(t&&we({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}else{let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}x.push(h)}return(M=this.owner)!=null&&M.signer&&x.forEach(g=>{g.some(h=>h.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),l.forEach((g,h)=>{g.sign(x[h])}),{builder:this,transactions:l,buildProps:e,signers:x,instructionTypes:this.instructionTypes,execute:async g=>{var R;let{sequentially:h,onTxUpdate:b,skipTxCount:I=0,recentBlockHash:A,skipPreflight:B=!0}=g||{};if(l.map(async(F,P)=>{x[P].length&&F.sign(x[P]),A&&(F.message.recentBlockhash=A)}),Pe(l),(R=this.owner)!=null&&R.isKeyPair){if(h){let F=0,P=[];for(let V of l){if(++F,F<=I){console.log("skip tx: ",F),P.push("tx skipped");continue}let k=await this.connection.sendTransaction(V,{skipPreflight:B});await He(this.connection,k),P.push(k)}return{txIds:P,signedTxs:l}}return{txIds:await Promise.all(l.map(async F=>await this.connection.sendTransaction(F,{skipPreflight:B}))),signedTxs:l}}if(this.signAllTransactions){let F=await this.signAllTransactions(l.slice(I,l.length)),P=[...l.slice(0,I),...F];if(h){let V=0,k=[],U=async()=>{if(!P[V])return;if(V<I){k.push({txId:"",status:"success",signedTx:P[V]}),b==null||b([...k]),V++,U();return}let O=await this.connection.sendTransaction(P[V],{skipPreflight:B});k.push({txId:O,status:"sent",signedTx:P[V]}),b==null||b([...k]),V++;let ne=!1,te=null,fe=null,Ee=oe=>{te!==null&&clearInterval(te),fe!==null&&this.connection.removeSignatureListener(fe);let $=k.findIndex(Pt=>Pt.txId===O);if($>-1){if(k[$].status==="error"||k[$].status==="success")return;k[$].status=oe.err?"error":"success"}b==null||b([...k]),oe.err||U()};this.loopMultiTxStatus&&(te=setInterval(async()=>{var oe;if(ne){clearInterval(te);return}try{let $=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});$&&(ne=!0,clearInterval(te),Ee({err:((oe=$.meta)==null?void 0:oe.err)||null}),console.log("tx status from getTransaction:",O))}catch($){ne=!0,clearInterval(te),console.error("getTransaction timeout:",$,O)}},Ze)),fe=this.connection.onSignature(O,oe=>{if(ne){this.connection.removeSignatureListener(fe);return}ne=!0,Ee(oe)},"confirmed"),this.connection.getSignatureStatus(O)};return U(),{txIds:[],signedTxs:P}}else{let V=[];for(let k=0;k<P.length;k+=1){let U=await this.connection.sendTransaction(P[k],{skipPreflight:B});V.push(U)}return{txIds:V,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};var Nr=Q(require("bn.js")),Qs=new Nr.default(1e6);var gt=require("@solana/web3.js"),qn=Q(require("bn.js"));var Zr=require("@solana/spl-token");function vn(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Et(r,...e){if(!vn(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function vt(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Or(r,e){Et(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var dt=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ce=(r,e)=>r<<32-e|r>>>e;var Ta=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Nn(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Nt(r){return typeof r=="string"&&(r=Nn(r)),Et(r),r}var lt=class{clone(){return this._cloneInto()}},Pa={}.toString;function Wr(r){let e=n=>r().update(Nt(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function On(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),s=BigInt(4294967295),a=Number(t>>o&s),i=Number(t&s),f=n?4:0,d=n?0:4;r.setUint32(e+f,a,n),r.setUint32(e+d,i,n)}var Ur=(r,e,t)=>r&e^~r&t,Gr=(r,e,t)=>r&e^r&t^e&t,pt=class extends lt{constructor(e,t,n,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=dt(this.buffer)}update(e){vt(this);let{view:t,buffer:n,blockLen:o}=this;e=Nt(e);let s=e.length;for(let a=0;a<s;){let i=Math.min(o-this.pos,s-a);if(i===o){let f=dt(e);for(;o<=s-a;a+=o)this.process(f,a);continue}n.set(e.subarray(a,a+i),this.pos),this.pos+=i,a+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){vt(this),Or(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(n,0),a=0);for(let u=a;u<o;u++)t[u]=0;On(n,o-8,BigInt(this.length*8),s),this.process(n,0);let i=dt(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let d=f/4,m=this.get();if(d>m.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<d;u++)i.setUint32(4*u,m[u],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:s,destroyed:a,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=a,o%t&&e.buffer.set(n),e}};var Wn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ae=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ke=new Uint32Array(64),Ot=class extends pt{constructor(){super(64,32,8,!1),this.A=Ae[0]|0,this.B=Ae[1]|0,this.C=Ae[2]|0,this.D=Ae[3]|0,this.E=Ae[4]|0,this.F=Ae[5]|0,this.G=Ae[6]|0,this.H=Ae[7]|0}get(){let{A:e,B:t,C:n,D:o,E:s,F:a,G:i,H:f}=this;return[e,t,n,o,s,a,i,f]}set(e,t,n,o,s,a,i,f){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=i|0,this.H=f|0}process(e,t){for(let u=0;u<16;u++,t+=4)ke[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){let p=ke[u-15],w=ke[u-2],l=ce(p,7)^ce(p,18)^p>>>3,x=ce(w,17)^ce(w,19)^w>>>10;ke[u]=x+ke[u-7]+l+ke[u-16]|0}let{A:n,B:o,C:s,D:a,E:i,F:f,G:d,H:m}=this;for(let u=0;u<64;u++){let p=ce(i,6)^ce(i,11)^ce(i,25),w=m+p+Ur(i,f,d)+Wn[u]+ke[u]|0,x=(ce(n,2)^ce(n,13)^ce(n,22))+Gr(n,o,s)|0;m=d,d=f,f=i,i=a+w|0,a=s,s=o,o=n,n=w+x|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,i=i+this.E|0,f=f+this.F|0,d=d+this.G|0,m=m+this.H|0,this.set(n,o,s,a,i,f,d,m)}roundClean(){ke.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var qr=Wr(()=>new Ot);var Xr=require("@solana/web3.js"),_e=Q(require("bn.js"));var _=require("@solana/buffer-layout"),Wt=_.Layout,jr=_.Structure;var Ut=_.UInt;var Hr=_.u8;var zr=_.seq;var Ke=_.blob;var De=class extends Wt{constructor(t,n,o){super(t,o);this.blob=Ke(t),this.signed=n}decode(t,n=0){let o=new _e.default(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new _e.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function Z(r){return new Ut(1,r)}function Qe(r){return new Ut(4,r)}function T(r){return new De(8,!1,r)}function xe(r){return new De(16,!1,r)}function Yr(r){return new De(1,!0,r)}function ft(r){return new De(8,!0,r)}var mt=class extends Wt{constructor(t,n,o,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function N(r){return new mt(Ke(32),e=>new Xr.PublicKey(e),e=>e.toBuffer(),r)}function yt(r){return new mt(Hr(),Un,Gn,r)}function Un(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Gn(r){return r?1:0}var Gt=class extends jr{decode(e,t){return super.decode(e,t)}};function z(r,e,t){return new Gt(r,e,t)}function X(r,e,t){let n,o=typeof e=="number"?e:(0,_e.isBN)(e)?e.toNumber():new Proxy(e,{get(s,a){if(!n){let i=Reflect.get(s,"count");n=(0,_e.isBN)(i)?i.toNumber():i,Reflect.set(s,"count",n)}return Reflect.get(s,a)},set(s,a,i){return a==="count"&&(n=i),Reflect.set(s,a,i)}});return zr(r,o,t)}var $e=z([N("mint"),N("owner"),T("amount"),Qe("delegateOption"),N("delegate"),Z("state"),Qe("isNativeOption"),T("isNative"),T("delegatedAmount"),Qe("closeAuthorityOption"),N("closeAuthority")]);var Xa=Y("Raydium_Util");function bt({fromPublicKey:r,programId:e=Zr.TOKEN_PROGRAM_ID,assignSeed:t}){let n=t?btoa(t).slice(0,32):gt.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:jn(r,n,e),seed:n}}function jn(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),o=qr(n);return new gt.PublicKey(o)}var mn=Q(require("decimal.js"));var ht=require("@solana/web3.js"),Jr=Q(require("bn.js"));var le=require("@solana/spl-token");function Hn(r){let{mint:e,tokenAccount:t,owner:n,programId:o=le.TOKEN_PROGRAM_ID}=r;return(0,le.createInitializeAccountInstruction)(t,e,n,o)}function zn(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:o,programId:s=le.TOKEN_PROGRAM_ID}=r;return(0,le.createCloseAccountInstruction)(e,t,o,n,s)}async function qt(r){let{connection:e,amount:t,commitment:n,payer:o,owner:s,skipCloseAccount:a}=r,i=await e.getMinimumBalanceForRentExemption($e.span,n),f=E(t).add(new Jr.default(i)),d=bt({fromPublicKey:o,programId:le.TOKEN_PROGRAM_ID});return{addresses:{newAccount:d.publicKey},signers:[],instructions:[ht.SystemProgram.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:d.seed,newAccountPubkey:d.publicKey,lamports:f.toNumber(),space:$e.span,programId:le.TOKEN_PROGRAM_ID}),Hn({mint:new ht.PublicKey(ie.address),tokenAccount:d.publicKey,owner:s,programId:le.TOKEN_PROGRAM_ID})],instructionTypes:[H.CreateAccount,H.InitAccount],endInstructionTypes:a?[]:[H.CloseAccount],endInstructions:a?[]:[zn({tokenAccount:d.publicKey,payer:o,owner:s})]}}var jt=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),et=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Y(t)}createTxBuilder(e){return this.scope.checkOwner(),new Je({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new pe(e);return new Je({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(jt(e))}logInfo(...e){this.logger.info(jt(e))}logAndCreateError(...e){let t=jt(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var xt=require("@solana/web3.js");var Ht=z([Z("instruction")]),zt=z([Z("instruction")]),Xn=z([T("rewardState"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardLastUpdateTime"),T("totalReward"),T("totalRewardEmissioned"),T("rewardClaimed"),T("rewardPerSecond"),xe("accRewardPerShare"),N("rewardVault"),N("rewardMint"),N("rewardSender"),T("rewardType"),X(T(),15,"padding")]),Yn=z([T("state"),T("nonce"),N("lpVault"),N("rewardVault"),N(),N(),T(),T(),T("totalReward"),xe("perShareReward"),T("lastSlot"),T("perSlotReward")]),Zn=z([T("state"),T("nonce"),N("lpVault"),N("rewardVaultA"),T("totalRewardA"),xe("perShareRewardA"),T("perSlotRewardA"),Z("option"),N("rewardVaultB"),Ke(7),T("totalRewardB"),xe("perShareRewardB"),T("perSlotRewardB"),T("lastSlot"),N()]),Jn=z([T(),T("state"),T("nonce"),T("validRewardTokenNum"),xe("rewardMultiplier"),T("rewardPeriodMax"),T("rewardPeriodMin"),T("rewardPeriodExtend"),N("lpMint"),N("lpVault"),X(Xn,5,"rewardInfos"),N("creator"),N(),X(T(),32,"padding")]),Qn=new Proxy(Yn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return J(j({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,e,t)}}),$n=new Proxy(Zn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return J(j({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,e,t)}}),wt=new Proxy(Jn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return J(j({},o),{version:6,rewardInfos:o.rewardInfos.map(s=>{var a;return J(j({},s),{rewardType:((a=Object.entries(Ie).find(i=>String(i[1])===s.rewardType.toString()))!=null?a:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),eo=z([T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),Xt=z([Z("instruction"),T("nonce"),X(eo,5,"rewardTimeInfo")]),Yt=z([Z("instruction"),T("rewardReopenTime"),T("rewardEndTime"),T("rewardPerSecond")]),Zt=z([Z("instruction"),T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),bu=z([T("state"),N("id"),N("owner"),T("deposited"),X(T(),1,"rewardDebts")]),Jt=z([T("state"),N("id"),N("owner"),T("deposited"),X(xe(),1,"rewardDebts"),T(""),T("voteLockedBalance"),X(T(),15)]),hu=z([T("state"),N("id"),N("owner"),T("deposited"),X(T(),2,"rewardDebts")]),Qr=z([T("state"),N("id"),N("owner"),T("deposited"),X(xe(),2,"rewardDebts"),X(T(),17)]),$r=z([T(),T("state"),N("id"),N("owner"),T("deposited"),X(xe(),5,"rewardDebts"),X(T(),16)]),se=z([Z("instruction"),T("amount")]),to=z([N("mint"),N("grantAuthority"),T("baselineVoteWeightScaledFactor"),T("maxExtraLockupVoteWeightScaledFactor"),T("lockupSaturationSecs"),Yr("digitShift"),X(Z(),7,"reserved1"),X(T(),7,"reserved2")]),ro=z([Ke(8),N("governanceProgramId"),N("realm"),N("realmGoverningTokenMint"),N("realmAuthority"),X(Z(),32,"reserved1"),X(to,4,"votingMints"),ft("timeOffset"),Z("bump"),X(Z(),7,"reserved2"),X(T(),11,"reserved3")]),no=z([ft("startTime"),ft("endTime"),Z("kind"),X(Z(),15,"reserved")]),oo=z([X(no,1,"lockup"),T("amountDeposited_native"),T("amountInitiallyLockedNative"),yt("isUsed"),yt("allowClawback"),Z("votingMintConfigIdx"),X(Z(),29,"reserved")]),io=z([Ke(8),N("voterAuthority"),N("registrar"),X(oo,32,"deposits"),Z("voterBump"),Z("voterWweightRecordBump"),X(Z(),94,"reserved")]);var so=require("@solana/spl-token"),Iu=Y("Raydium_farm_config"),en=new xt.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),tn=new xt.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Su=new xt.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX");var rn={3:Jt,5:Qr,6:$r},Qt=r=>[3,4,5,6].indexOf(r)!==-1,$t=r=>{var a;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=r,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,s={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(a=s[e])==null?void 0:a.call(s)},Ie={"Standard SPL":0,"Option tokens":1},Te={[_r.toString()]:3,[Dr.toString()]:4,[Er.toString()]:5,[Xe.toString()]:6,[Re.FARM_PROGRAM_ID_V3.toString()]:3,[Re.FARM_PROGRAM_ID_V4.toString()]:4,[Re.FARM_PROGRAM_ID_V5.toString()]:5,[Re.FARM_PROGRAM_ID_V6.toString()]:6};var L=require("@solana/web3.js"),rr=Q(require("bn.js")),ae=require("@solana/spl-token");var nn=Q(require("bn.js"));var ao=Y("Raydium.farm.util");function tt({programId:r,poolId:e,mint:t,type:n}){let{publicKey:o}=Be([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function me({programId:r,poolId:e,owner:t,version:n}){let{publicKey:o}=Be([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var on=({programId:r,poolId:e})=>Be([e.toBuffer()],r);function sn(r){return{isSet:new nn.default(1),rewardPerSecond:E(r.perSecond),rewardOpenTime:E(r.openTime),rewardEndTime:E(r.endTime),rewardType:E(Ie[r.rewardType])}}function er(r){return E(r.endTime).sub(E(r.openTime)).mul(E(r.perSecond))}function tr(r){let e=rn[r];return e||ao.logWithError("invalid version",r),e}var uo=Y("Raydium_farm_instruction"),dc={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function nr(r){let{version:e,id:t,ledger:n,programId:o,owner:s}=r,a={3:9,5:10}[e];a||uo.logWithError(`invalid farm pool version: ${e}`);let i=Buffer.alloc(Ht.span);Ht.encode({instruction:a},i);let f=[c({pubkey:t}),c({pubkey:n}),c({pubkey:s,isWritable:!1}),c({pubkey:L.SystemProgram.programId,isWritable:!1}),c({pubkey:L.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new L.TransactionInstruction({programId:o,keys:f,data:i}),instructionType:H.FarmV3CreateLedger}}function an(r){var n;let e=Buffer.alloc(Xt.span);Xt.encode({instruction:0,nonce:new rr.default(r.nonce),rewardTimeInfo:r.rewardInfoConfig},e);let t=[...Kt,c({pubkey:r.farmId}),c({pubkey:r.farmAuthority,isWritable:!1}),c({pubkey:r.lpVault}),c({pubkey:r.lpMint,isWritable:!1}),c({pubkey:r.lockVault}),c({pubkey:r.lockMint,isWritable:!1}),c({pubkey:(n=r.lockUserAccount)!=null?n:ee}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let o of r.rewardInfo)t.push(c({pubkey:o.rewardMint,isWritable:!1}),c({pubkey:o.rewardVault}),c({pubkey:o.userRewardToken}));return{instruction:new L.TransactionInstruction({programId:r.programId,keys:t,data:e}),instructionType:H.FarmV6Create}}function un(r){let e=Buffer.alloc(zt.span);zt.encode({instruction:5},e);let t=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:r.id}),c({pubkey:r.authority,isWritable:!1}),c({pubkey:r.lpVault,isWritable:!1}),c({pubkey:r.rewardVault}),c({pubkey:r.userRewardToken}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new L.TransactionInstruction({programId:r.programId,keys:t,data:e}),instructionType:H.FarmV6CreatorWithdraw}}function or({payer:r,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:o}){let s=Buffer.alloc(Yt.span);Yt.encode({instruction:3,rewardReopenTime:E(o.openTime),rewardEndTime:E(o.endTime),rewardPerSecond:E(o.perSecond)},s);let a=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:n.id}),c({pubkey:n.lpVault,isWritable:!1}),c({pubkey:e}),c({pubkey:t}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new L.TransactionInstruction({programId:n.programId,keys:a,data:s})}function ir({payer:r,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:o}){let s=Buffer.alloc(Zt.span);Zt.encode({instruction:4,isSet:new rr.default(1),rewardPerSecond:E(o.perSecond),rewardOpenTime:E(o.openTime),rewardEndTime:E(o.endTime),rewardType:E(Ie[o.rewardType])},s);let a=[...Kt,c({pubkey:t.id}),c({pubkey:t.authority,isWritable:!1}),c({pubkey:o.mint,isWritable:!1}),c({pubkey:n}),c({pubkey:e}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new L.TransactionInstruction({programId:t.programId,keys:a,data:s})}function sr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],d=me({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(se.span);se.encode({instruction:2,amount:E(a)},m);let u=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:f}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:d}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)u.push(c({pubkey:new L.PublicKey(t.rewardInfos[p].vault)})),u.push(c({pubkey:o[p]}));return new L.TransactionInstruction({programId:i,keys:u,data:m})}function ar(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:5}),u=Buffer.alloc(se.span);se.encode({instruction:12,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];for(let w=1;w<t.rewardInfos.length;w++)p.push(c({pubkey:o[w]})),p.push(c({pubkey:new L.PublicKey(t.rewardInfos[w].vault)}));if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function cn(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=z([Z("instruction"),T("amount")]),u=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:i[0]}),c({pubkey:s,isSigner:!0,isWritable:!1}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:o[1]}),c({pubkey:new L.PublicKey(t.rewardInfos[1].vault)})],p=Buffer.alloc(m.span);return m.encode({instruction:2,amount:a},p),new L.TransactionInstruction({keys:u,programId:f,data:p})}function ur(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:3}),u=Buffer.alloc(se.span);se.encode({instruction:11,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function ln(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:3}),u=Buffer.alloc(se.span);se.encode({instruction:10,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function dn(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:5}),u=Buffer.alloc(se.span);se.encode({instruction:11,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];for(let w=1;w<t.rewardInfos.length;w++)p.push(c({pubkey:o[w]})),p.push(c({pubkey:new L.PublicKey(t.rewardInfos[w].vault)}));if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function pn(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],d=me({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(se.span);se.encode({instruction:1,amount:E(a)},m);let u=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:L.SystemProgram.programId,isWritable:!1}),c({pubkey:f}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:d}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)u.push(c({pubkey:new L.PublicKey(t.rewardInfos[p].vault)})),u.push(c({pubkey:o[p]}));return new L.TransactionInstruction({programId:i,keys:u,data:m})}var Tt=class extends et{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(ee)){let n=await qt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:er(J(j({},t),{openTime:t.openTime.toString(),endTime:t.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:o=Xe,txVersion:s,feePayer:a,lockProgram:i}){var I,A;this.checkDisabled(),this.scope.checkOwner();let d={lpMint:new W.PublicKey(e.lpMint.address),lockInfo:{lockMint:(I=i==null?void 0:i.mint)!=null?I:en,lockVault:(A=i==null?void 0:i.vault)!=null?A:tn},version:6,rewardInfos:t,programId:o},m=this.createTxBuilder(a),u=n!=null?n:this.scope.ownerPubKey,p=bt({fromPublicKey:u,programId:d.programId}),w=await this.scope.connection.getMinimumBalanceForRentExemption(wt.span);m.addInstruction({instructions:[W.SystemProgram.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:p.seed,newAccountPubkey:p.publicKey,lamports:w,space:wt.span,programId:d.programId})]});let{publicKey:l,nonce:x}=on({programId:new W.PublicKey(d.programId),poolId:p.publicKey}),y=tt({programId:d.programId,poolId:p.publicKey,mint:d.lpMint,type:"lpVault"}),K=[],S=[];for(let B of d.rewardInfos){B.openTime>=B.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",B.openTime.toString()),isNaN(Ie[B.rewardType])&&this.logAndCreateError("rewardType error",B.rewardType),Number(B.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",B.perSecond),K.push(sn(B));let{rewardPubKey:R,newInstruction:F}=await this._getUserRewardInfo({rewardInfo:B,payer:u});F&&m.addInstruction(F),R||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let P=B.mint.equals(ee)?new W.PublicKey(ie.address):B.mint;S.push({rewardMint:P,rewardVault:tt({programId:d.programId,poolId:p.publicKey,mint:P,type:"rewardVault"}),userRewardToken:R})}let{account:M,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({mint:new W.PublicKey(d.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});g&&m.addInstruction(g),M||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:h,instructionType:b}=an({farmId:p.publicKey,owner:this.scope.ownerPubKey,farmAuthority:l,lpVault:y,lpMint:d.lpMint,lockVault:d.lockInfo.lockVault,lockMint:d.lockInfo.lockMint,lockUserAccount:M,programId:d.programId,rewardInfo:S,rewardInfoConfig:K,nonce:x});return m.addInstruction({instructions:[h],instructionTypes:[b]}).versionBuild({txVersion:s,extInfo:{farmId:p.publicKey,farmAuthority:l,lpVault:y,lockUserAccount:M,nonce:x}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:o,feePayer:s}){var K;let a=Te[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=he((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let d=t||this.scope.ownerPubKey,m=n.mint.equals(ee)?new W.PublicKey(ie.address):n.mint,u=f.rewardInfos.findIndex(S=>new W.PublicKey(S.mint.address).equals(m)),p=i.rewardInfos[u];p||this.logAndCreateError("configuration does not exist","rewardMint",m);let w=(K=p.vault)!=null?K:ee,l=this.createTxBuilder(s),{rewardPubKey:x,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:n,payer:d});return y&&l.addInstruction(y),x||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),l.addInstruction({instructions:[or({payer:this.scope.ownerPubKey,rewardVault:w,userRewardTokenPub:x,farmKeys:f,rewardInfo:n})],instructionTypes:[H.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:o,feePayer:s}){var u;let a=Te[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=he((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.forEach(p=>{p.openTime>=p.endTime&&this.logAndCreateError("start time error","newRewardInfo",p)});let d=t||this.scope.ownerPubKey,m=this.createTxBuilder(s);for(let p of n){let w=p.mint.equals(ee)?new W.PublicKey(ie.address):p.mint,l=f.rewardInfos.findIndex(g=>new W.PublicKey(g.mint.address).equals(w)),x=i.rewardInfos[l];x||this.logAndCreateError("configuration does not exist","rewardMint",w);let y=(u=x.vault)!=null?u:ee,{rewardPubKey:K,newInstruction:S}=await this._getUserRewardInfo({rewardInfo:p,payer:d});S&&m.addInstruction(S),K||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let M=or({payer:this.scope.ownerPubKey,rewardVault:y,userRewardTokenPub:K,farmKeys:f,rewardInfo:p});m.addInstruction({instructions:[M],instructionTypes:[H.FarmV6Restart]})}return m.versionBuild({txVersion:o})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:o,payer:s,feePayer:a}=e,i=Te[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=he((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),d=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a),u=o.mint.equals(ee)?new W.PublicKey(ie.address):o.mint,p=tt({programId:new W.PublicKey(n.programId),poolId:new W.PublicKey(n.id),mint:u,type:"rewardVault"}),{rewardPubKey:w,newInstruction:l}=await this._getUserRewardInfo({rewardInfo:o,payer:d});return l&&m.addInstruction(l),w||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=u,m.addInstruction({instructions:[ir({payer:this.scope.ownerPubKey,userRewardTokenPub:w,farmKeys:f,rewardVault:p,rewardInfo:o})],instructionTypes:[H.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:o,payer:s,feePayer:a}=e,i=Te[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=he((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),d=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a);for(let u of o){let p=u.mint.equals(ee)?new W.PublicKey(ie.address):u.mint,w=tt({programId:new W.PublicKey(n.programId),poolId:new W.PublicKey(n.id),mint:p,type:"rewardVault"}),{rewardPubKey:l,newInstruction:x}=await this._getUserRewardInfo({rewardInfo:u,payer:d});x&&m.addInstruction(x),l||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let y=ir({payer:this.scope.ownerPubKey,userRewardTokenPub:l,farmKeys:f,rewardVault:w,rewardInfo:J(j({},u),{mint:p})});m.addInstruction({instructions:[y],instructionTypes:[H.FarmV6CreatorAddReward]})}return m.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:o,feePayer:s,useSOLBalance:a,associatedOnly:i=!0,checkCreateATAOwner:f=!1,userAuxiliaryLedgers:d,computeBudgetConfig:m,txTipConfig:u}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:p,programId:w}=n,l=Te[w];l===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),Qt(l)||this.logAndCreateError("invalid farm program:",n.programId);let[x,y]=[new W.PublicKey(n.programId),new W.PublicKey(n.id)],K=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],S=me({programId:x,poolId:y,owner:this.scope.ownerPubKey,version:l}),M=this.createTxBuilder(s);M.addCustomComputeBudget(m),M.addTipInstruction(u);let g={};for(let k of this.scope.account.tokenAccounts)if(i){let U=Fe(this.scope.ownerPubKey,k.mint,k.programId).publicKey;k.publicKey&&U.equals(k.publicKey)&&(g[k.mint.toString()]=k.publicKey)}else g[k.mint.toString()]=k.publicKey;let h=K.lpMint,b=g[h.address];b||this.logAndCreateError("you don't have any lp","lp zero",g);let I=[];for(let k of p){let U=a&&k.mint.address===ye.toString(),O=g[k.mint.address];if(!O){let{account:ne,instructionParams:te}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:k.mint.programId,mint:new W.PublicKey(k.mint.address),notUseTokenAccount:U,createInfo:{payer:s||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!U,associatedOnly:U?!1:i,checkCreateATAOwner:f});O=ne,te&&M.addInstruction(te)}g[k.mint.address]=O,I.push(O)}let A,B=await this.scope.connection.getAccountInfo(S);if(B&&(A=tr(l).decode(B.data)),n.programId!==Xe.toString()&&n.programId!==Re.FARM_PROGRAM_ID_V6.toString()&&!A){let{instruction:k,instructionType:U}=nr({id:y,programId:x,version:l,ledger:S,owner:this.scope.ownerPubKey});M.addInstruction({instructions:[k],instructionTypes:[U]})}let R=$t({version:l,rewardInfos:p,rewardTokenAccountsPublicKeys:I});R&&this.logAndCreateError(R);let F={amount:E(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:K,lpAccount:b,rewardAccounts:I,userAuxiliaryLedgers:d==null?void 0:d.map(k=>new W.PublicKey(k))},P=l===6?pn(F):l===5?dn(F):ln(F),V={3:H.FarmV3Deposit,5:H.FarmV5Deposit,6:H.FarmV6Deposit};return M.addInstruction({instructions:[P],instructionTypes:[V[l]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:o,deposited:s,useSOLBalance:a,feePayer:i,associatedOnly:f=!0,checkCreateATAOwner:d=!1,userAuxiliaryLedgers:m,computeBudgetConfig:u,txTipConfig:p}=e,{rewardInfos:w}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let l=Te[n.programId];Qt(l)||this.logAndCreateError("invalid farm program:",n.programId);let x=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],y=this.createTxBuilder(i);y.addCustomComputeBudget(u),y.addTipInstruction(p);let K={};for(let R of this.scope.account.tokenAccounts)if(f){let F=Fe(this.scope.ownerPubKey,R.mint).publicKey;R.publicKey&&F.equals(R.publicKey)&&(K[R.mint.toString()]=R.publicKey)}else K[R.mint.toString()]=R.publicKey;if(l!==4){let R=me({programId:new W.PublicKey(n.programId),poolId:new W.PublicKey(n.id),owner:this.scope.ownerPubKey,version:l}),F=await this.scope.connection.getAccountInfo(R);if(F)tr(l).decode(F.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(l!==6){let{instruction:P,instructionType:V}=nr({id:new W.PublicKey(x.id),programId:new W.PublicKey(x.programId),version:l,ledger:R,owner:this.scope.ownerPubKey});y.addInstruction({instructions:[P],instructionTypes:[V]})}}s&&s.isZero()&&!(m||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let S=x.lpMint.address,M=a&&S===ye.toString(),g=K[S.toString()];if(!g){let{account:R,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:x.lpMint.programId,mint:new W.PublicKey(S),notUseTokenAccount:M,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:M?!1:f,checkCreateATAOwner:d});g=R,F&&y.addInstruction(F)}K[S.toString()]=g;let h=[];for(let R of w){let F=a&&R.mint.address===ye.toString(),P=K[R.mint.address];if(!P){let{account:V,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:R.mint.programId,mint:new W.PublicKey(R.mint.address),notUseTokenAccount:F,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!F,associatedOnly:F?!1:f,checkCreateATAOwner:d});P=V,k&&y.addInstruction(k)}K[R.mint.address]=P,h.push(P)}let b=$t({version:l,rewardInfos:w,rewardTokenAccountsPublicKeys:h});b&&this.logAndCreateError(b);let I={amount:E(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:x,lpAccount:g,rewardAccounts:h,userAuxiliaryLedgers:m==null?void 0:m.map(R=>new W.PublicKey(R))},A=l===6?sr(I):l===5?ar(I):l===4?cn(I):ur(I),B={3:H.FarmV3Withdraw,4:H.FarmV4Withdraw,5:H.FarmV5Withdraw,6:H.FarmV6Withdraw};return y.addInstruction({instructions:[A],instructionTypes:[B[l]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){var x;this.scope.checkOwner();let i=he((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f=Te[e.programId];f!==6&&this.logAndCreateError("invalid farm version",f);let d=i.rewardInfos.find(y=>ot(y.mint.address).equals(ot(t)));d||this.logAndCreateError("withdraw mint error","rewardInfos",e);let m=(x=d==null?void 0:d.vault)!=null?x:ee,u=this.createTxBuilder(a),p;if(t.equals(ee)||t.equals(W.PublicKey.default)){let y=await qt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:er(J(j({},d),{openTime:d.openTime,endTime:d.endTime,perSecond:new mn.default(d.perSecond).mul(10**d.mint.decimals).toString()}))});p=y.addresses.newAccount,u.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(p=await this.scope.account.getAssociatedTokenAccount(t),u.addInstruction({instructions:[(0,cr.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,p,this.scope.ownerPubKey,t)],instructionTypes:[H.CreateATA]})):p=y}let{instruction:w,instructionType:l}=un({programId:i.programId,id:i.id,authority:i.authority,lpVault:i.lpVault,rewardVault:m,userRewardToken:p,owner:this.scope.ownerPubKey});return u.addCustomComputeBudget(o),u.addTipInstruction(s),u.addInstruction({instructions:[w],instructionTypes:[l]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:o,associatedOnly:s=!0,checkCreateATAOwner:a=!1,userAuxiliaryLedgers:i,txVersion:f,computeBudgetConfig:d}=e,m=this.createTxBuilder(o),u={};for(let l of this.scope.account.tokenAccounts)if(s){let x=Fe(this.scope.ownerPubKey,l.mint).publicKey;l.publicKey&&x.equals(l.publicKey)&&(u[l.mint.toString()]=l.publicKey)}else u[l.mint.toString()]=l.publicKey;let w=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(l=>l.id).join(",")})).reduce((l,x)=>J(j({},l),{[x.id]:x}),{});for(let l of Object.values(t)){let{programId:x,lpMint:y,rewardInfos:K,id:S}=l,M=Te[x],g=y.address,h=n&&g===ye.toString(),b=u[g];if(!b){let{account:P,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.programId,mint:new W.PublicKey(g),notUseTokenAccount:h,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:h?!1:s,checkCreateATAOwner:a});b=P,V&&m.addInstruction(V)}u[g.toString()]=b;let I=[];for(let P of K){let V=n&&P.mint.address===ye.toString(),k=u[P.mint.address];if(!k)if(V){let{account:U,instructionParams:O}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:P.mint.programId,mint:new W.PublicKey(P.mint.address),notUseTokenAccount:V,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!V,associatedOnly:V?!1:s,checkCreateATAOwner:a});k=U,O&&m.addInstruction(O)}else{let U=new W.PublicKey(P.mint.address);k=this.scope.account.getAssociatedTokenAccount(U),m.addInstruction({instructions:[(0,cr.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,k,this.scope.ownerPubKey,U)]})}u[P.mint.address]=k,I.push(k)}let A=w[S],B={amount:Dt,owner:this.scope.ownerPubKey,farmInfo:l,farmKeys:A,lpAccount:b,rewardAccounts:I,userAuxiliaryLedgers:i==null?void 0:i.map(P=>new W.PublicKey(P))},R=M===6?sr(B):M===5?ar(B):ur(B),F={3:H.FarmV3Withdraw,5:H.FarmV5Withdraw,6:H.FarmV6Withdraw};m.addInstruction({instructions:[R],instructionTypes:[F[M]]})}return f===1?m.sizeCheckBuild({computeBudgetConfig:d}):m.sizeCheckBuildV0({computeBudgetConfig:d})}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.js.map