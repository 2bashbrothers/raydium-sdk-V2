var mn=Object.create;var _e=Object.defineProperty,fn=Object.defineProperties,yn=Object.getOwnPropertyDescriptor,gn=Object.getOwnPropertyDescriptors,bn=Object.getOwnPropertyNames,Xe=Object.getOwnPropertySymbols,wn=Object.getPrototypeOf,wt=Object.prototype.hasOwnProperty,cr=Object.prototype.propertyIsEnumerable;var ur=(r,e,t)=>e in r?_e(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,j=(r,e)=>{for(var t in e||(e={}))wt.call(e,t)&&ur(r,t,e[t]);if(Xe)for(var t of Xe(e))cr.call(e,t)&&ur(r,t,e[t]);return r},Q=(r,e)=>fn(r,gn(e));var Ye=(r,e)=>{var t={};for(var n in r)wt.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Xe)for(var n of Xe(r))e.indexOf(n)<0&&cr.call(r,n)&&(t[n]=r[n]);return t};var hn=(r,e)=>{for(var t in e)_e(r,t,{get:e[t],enumerable:!0})},lr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of bn(e))!wt.call(r,o)&&o!==t&&_e(r,o,{get:()=>e[o],enumerable:!(n=yn(e,o))||n.enumerable});return r};var J=(r,e,t)=>(t=r!=null?mn(wn(r)):{},lr(e||!r||!r.__esModule?_e(t,"default",{value:r,enumerable:!0}):t,r)),xn=r=>lr(_e({},"__esModule",{value:!0}),r);var uo={};hn(uo,{default:()=>bt});module.exports=xn(uo);var N=require("@solana/web3.js"),sr=require("@solana/spl-token");var pr=require("@solana/web3.js");var Me=require("lodash");var ht=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},dr={},Tn={};function Y(r){let e=(0,Me.get)(dr,r);if(!e){let t=(0,Me.get)(Tn,r);e=new ht({name:r,logLevel:t}),(0,Me.set)(dr,r,e)}return e}var Ze=require("@solana/spl-token"),xt=Y("Raydium_accountInfo_util");async function mr(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:s=100}=j({batchRequest:!1},t),a=Tt(e,s),i=new Array(a.length).fill([]);if(n){let f=a.map(u=>{let d=r._buildArgs([u.map(g=>g.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:d}}),l=Tt(f,10);i=(await(await Promise.all(l.map(async u=>await r._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&xt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(d=>{if(d){let{data:g,executable:p,lamports:w,owner:y,rentEpoch:R}=d;return g.length!==2&&g[1]!=="base64"&&xt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(g[0],"base64"),executable:p,lamports:w,owner:new pr.PublicKey(y),rentEpoch:R}}return null})))}else try{i=await Promise.all(a.map(f=>r.getMultipleAccountsInfo(f,o)))}catch(f){f instanceof Error&&xt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return i.flat()}var ae=J(require("bn.js")),Cn=J(require("decimal.js"));var hr=J(require("big.js")),Ne=J(require("bn.js"));var fr=J(require("toformat")),Pn=fr.default,De=Pn;var Ee=J(require("big.js")),gr=J(require("bn.js")),br=J(require("decimal.js-light"));var Le=J(require("bn.js"));var yr=9007199254740991;function E(r){let e=Y("Raydium_parseBigNumberish");if(r instanceof Le.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Le.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=yr||r<=-yr)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Le.default(String(r))):typeof r=="bigint"?new Le.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Le.default(0))}var Qe=Y("module/fraction"),Pt=De(Ee.default),ve=De(br.default),kn={[0]:ve.ROUND_DOWN,[1]:ve.ROUND_HALF_UP,[2]:ve.ROUND_UP},In={[0]:Ee.default.roundDown,[1]:Ee.default.roundHalfUp,[2]:Ee.default.roundUp},O=class{constructor(e,t=new gr.default(1)){this.numerator=E(e),this.denominator=E(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new O(this.denominator,this.numerator)}add(e){let t=e instanceof O?e:new O(E(e));return this.denominator.eq(t.denominator)?new O(this.numerator.add(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof O?e:new O(E(e));return this.denominator.eq(t.denominator)?new O(this.numerator.sub(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof O?e:new O(E(e));return new O(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof O?e:new O(E(e));return new O(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Qe.logWithError(`${e} is not an integer.`),e<=0&&Qe.logWithError(`${e} is not positive.`),ve.set({precision:e+1,rounding:kn[n]});let o=new ve(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Qe.logWithError(`${e} is not an integer.`),e<0&&Qe.logWithError(`${e} is negative.`),Pt.DP=e,Pt.RM=In[n]||1,new Pt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Sn=Y("Raydium_amount"),wr=De(hr.default);function Ln(r,e){let t="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([t,n]=o,n=n.padEnd(e,"0")):Sn.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var me=class extends O{constructor(t,n,o=!0,s){let a=new Ne.default(0),i=At.pow(new Ne.default(t.decimals));if(o)a=E(n);else{let f=new Ne.default(0),l=new Ne.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,u]=Ln(n.toString(),t.decimals);f=E(m),l=E(u)}f=f.mul(i),a=f.add(l)}super(a,i);this.logger=Y(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new me(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new me(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return wr.DP=this.token.decimals,new wr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var xr=require("@solana/web3.js"),kt=require("@solana/spl-token"),Tr={chainId:101,address:xr.PublicKey.default.toBase58(),programId:kt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},te={chainId:101,address:"So11111111111111111111111111111111111111112",programId:kt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var $e=require("@solana/web3.js");var U=require("@solana/web3.js"),Pr=require("@solana/spl-token");function c({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var It=[c({pubkey:Pr.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:U.SystemProgram.programId,isWritable:!1}),c({pubkey:U.SYSVAR_RENT_PUBKEY,isWritable:!1})];function St({publicKey:r,transformSol:e}){let t=Lt(r.toString());if(t instanceof U.PublicKey)return e&&t.equals($)?pe:t;if(e&&t.toString()===$.toBase58())return pe;if(typeof t=="string"){if(t===U.PublicKey.default.toBase58())return U.PublicKey.default;try{return new U.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Lt(r){try{return new U.PublicKey(r)}catch{return r}}var Eo=new U.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),vo=new U.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Rn=new U.PublicKey("SysvarRent111111111111111111111111111111111"),No=new U.PublicKey("SysvarC1ock11111111111111111111111111111111"),Oo=new U.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Bn=new U.PublicKey("Sysvar1nstructions1111111111111111111111111"),Wo=U.SystemProgram.programId,Uo=new U.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Go=new U.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),qo=new U.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),jo=new U.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ho=new U.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),zo=new U.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Xo=new U.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Yo=new U.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Zo=new U.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Jo=new U.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Qo=new U.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),pe=new U.PublicKey("So11111111111111111111111111111111111111112"),$=U.PublicKey.default;function Je(r){return St({publicKey:r,transformSol:!0})}var Rt=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:s=!1,isToken2022:a=!1}){if(e===$.toBase58()||e instanceof $e.PublicKey&&$.equals(e)){this.decimals=te.decimals,this.symbol=te.symbol,this.name=te.name,this.mint=new $e.PublicKey(te.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?$e.PublicKey.default:St({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Pe=Rt;Pe.WSOL=new Rt(Q(j({},te),{mint:te.address}));var Bt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},et=Bt;et.SOL=new Bt(Tr);var kr=J(require("bn.js"));var Ar=new O(new kr.default(100)),Re=class extends O{toSignificant(e=5,t,n){return this.mul(Ar).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ar).toFixed(e,t,n)}};var Kn=Y("Raydium_price"),fe=class extends O{constructor(t){let{baseToken:n,quoteToken:o,numerator:s,denominator:a}=t;super(s,a);this.baseToken=n,this.quoteToken=o,this.scalar=new O(Kt(n.decimals),Kt(o.decimals))}get raw(){return new O(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new fe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Kn.logWithError("mul token not equals");let n=super.mul(t);return new fe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var Ir=require("@solana/web3.js"),Sr=J(require("bn.js"));function Lr(r){return typeof r=="object"&&r!==null&&![Pe,me,Ir.PublicKey,O,Sr.default,fe,Re].some(e=>typeof e=="object"&&r instanceof e)}function ye(r){return typeof r=="string"?Lt(r):Array.isArray(r)?r.map(e=>ye(e)):Lr(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,ye(t)])):r}var Ct=new ae.default(0),Wi=new ae.default(1),Ui=new ae.default(2),Gi=new ae.default(3),qi=new ae.default(5),At=new ae.default(10),ji=new ae.default(100),Hi=new ae.default(1e3),zi=new ae.default(1e4);function Kt(r){return At.pow(E(r))}function Tt(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Cr=require("@solana/web3.js"),Vr=require("@solana/spl-token");var ee=require("@solana/web3.js");var G={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Br=require("@solana/spl-token"),Rr=Y("Raydium_txUtil"),Kr=1644;function tt(r){let e=[],t=[];return r.microLamports&&(e.push(ee.ComputeBudgetProgram.setComputeUnitPrice({microLamports:r.microLamports})),t.push(G.SetComputeUnitPrice)),r.units&&(e.push(ee.ComputeBudgetProgram.setComputeUnitLimit({units:r.units})),t.push(G.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Be(r,e){var n,o;let t=e!=null?e:"confirmed";return(o=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:o.blockhash}async function rt(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let o=setTimeout(n,6e4);r.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function Vn(r,e){r.length<1&&Rr.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Rr.logWithError(`no signers provided:, ${e.toString()}`);let t=new ee.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Kr}catch{return!1}}function Ae(r,e){let[t,n]=ee.PublicKey.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Oe({instructions:r,payer:e,signers:t}){return Vn(r,[e,...t])}function We({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=ee.Keypair.generate().publicKey.toString()}){let s=new ee.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new ee.VersionedTransaction(s).serialize()).toString("base64").length<Kr}catch{return!1}}var Fn=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),_n=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof ee.VersionedTransaction&&(e=Fn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ke(r){let e=[];return r.forEach(t=>{t instanceof ee.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Br.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=ee.Keypair.generate().publicKey)),e.push(_n(t))}),console.log("simulate tx string:",e),e}function Ke(r,e,t){return Ae([r.toBuffer(),(t!=null?t:Vr.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new Cr.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var I=require("@solana/web3.js"),Fr=new I.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),_r=new I.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Mr=new I.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ue=new I.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),cs=new I.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ls=new I.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ds=new I.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ps=new I.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ms=new I.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),fs=new I.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ys=new I.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),gs=new I.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),bs=new I.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ws=new I.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),hs=new I.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),xs=new I.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ts=new I.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ps=new I.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),As=new I.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ks=new I.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Is=new I.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ss=new I.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ls=new I.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Rs=new I.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Bs=new I.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ks=new I.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Cs=new I.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Vs=new I.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Fs=new I.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),_s=new I.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Ms=new I.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ie={OPEN_BOOK_PROGRAM:new I.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new I.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new I.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new I.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new I.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new I.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new I.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new I.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new I.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new I.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new I.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new I.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:I.PublicKey.default,Router:new I.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new I.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new I.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new I.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new I.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new I.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new I.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new I.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new I.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new I.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new I.PublicKey("Ray1111111111111111111111111111111111111111")};var Mn=J(require("bn.js"));var oe=require("@solana/web3.js");async function Vt({connection:r,address:e,cluster:t="mainnet"}){let n=await mr(r,[...new Set(e.map(s=>s.toString()))].map(s=>new oe.PublicKey(s))),o={};for(let s=0;s<e.length;s++){let a=n[s],i=e[s];if(!a)continue;let f=new oe.AddressLookupTableAccount({key:i,state:oe.AddressLookupTableAccount.deserialize(a.data)});o[i.toString()]=f,t==="devnet"?Ce[i.toString()]=f:nt[i.toString()]=f}return o}var nt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new oe.AddressLookupTableAccount({key:new oe.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:oe.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Ce={},Ft=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Ce[e])return Ce;let t=new oe.PublicKey(e),n=await r.getAccountInfo(t);return n&&(Ce[e]=new oe.AddressLookupTableAccount({key:t,state:oe.AddressLookupTableAccount.deserialize(n.data)})),Ce};var W=require("@solana/web3.js"),Dr=J(require("axios"));var ot=2e3,it=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Dr.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=tt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(W.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new W.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(G.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:a=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...a.filter(i=>i!==W.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(j({},t||{})):this.build(t)}build(e){var n;let t=new W.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var m;let{recentBlockHash:s,skipPreflight:a=!0,sendAndConfirm:i,notSendToRpc:f}=o||{},l=s!=null?s:await Be(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),ke([t]),(m=this.owner)!=null&&m.isKeyPair)return{txId:i?await(0,W.sendAndConfirmTransaction)(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:a}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);if(this.signers.length)for(let d of u)try{d.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:a}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:o}=this.build(n),s=t.filter(m=>m.transaction.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:i,instructionTypes:f,execute:async m=>{var R;let{sequentially:u,onTxUpdate:d,skipTxCount:g=0,recentBlockHash:p,skipPreflight:w=!0}=m||{},y=p!=null?p:await Be(this.connection,this.blockhashCommitment);if((R=this.owner)!=null&&R.isKeyPair){if(u){let A=[],F=0;for(let h of a){if(++F,F<=g)continue;let x=await(0,W.sendAndConfirmTransaction)(this.connection,h,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});A.push(x)}return{txIds:A,signedTxs:a}}return{txIds:await await Promise.all(a.map(async A=>(A.recentBlockhash=y,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:w})))),signedTxs:a}}if(this.signAllTransactions){let A=a.map((h,x)=>(h.recentBlockhash=y,i[x].length&&h.sign(...i[x]),h));ke(A);let F=await this.signAllTransactions(A);if(u){let h=0,x=[],T=async()=>{if(!F[h])return;let S=await this.connection.sendRawTransaction(F[h].serialize(),{skipPreflight:w});x.push({txId:S,status:"sent",signedTx:F[h]}),d==null||d([...x]),h++;let B=!1,K=null,k=null,M=L=>{K!==null&&clearInterval(K),k!==null&&this.connection.removeSignatureListener(k);let D=x.findIndex(V=>V.txId===S);if(D>-1){if(x[D].status==="error"||x[D].status==="success")return;x[D].status=L.err?"error":"success"}d==null||d([...x]),L.err||T()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var L;if(B){clearInterval(K);return}try{let D=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(B=!0,clearInterval(K),M({err:((L=D.meta)==null?void 0:L.err)||null}),console.log("tx status from getTransaction:",S))}catch(D){B=!0,clearInterval(K),console.error("getTransaction timeout:",D,S)}},ot)),k=this.connection.onSignature(S,L=>{if(B){this.connection.removeSignatureListener(k);return}B=!0,M(L)},"confirmed"),this.connection.getSignatureStatus(S)};return await T(),{txIds:x.map(S=>S.txId),signedTxs:F}}else{let h=[];for(let x=0;x<F.length;x+=1){let T=await this.connection.sendRawTransaction(F[x].serialize(),{skipPreflight:w});h.push(T)}return{txIds:h,signedTxs:F}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var w;let p=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:s}=p,a=Ye(p,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=j(j({},this.cluster==="devnet"?await Ft(this.connection):nt),t),f=Array.from(new Set([...n,...this.lookupTableAddress])),l=[];for(let y of f)i[y]===void 0&&l.push(new W.PublicKey(y));let m=await Vt({connection:this.connection,address:l});for(let[y,R]of Object.entries(m))i[y]=R;let u=o?W.PublicKey.default.toBase58():s!=null?s:await Be(this.connection,this.blockhashCommitment),d=new W.TransactionMessage({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((w=this.owner)==null?void 0:w.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let g=new W.VersionedTransaction(d);return g.sign(this.signers),{builder:this,transaction:g,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var h;let{skipPreflight:R=!0,sendAndConfirm:A,notSendToRpc:F}=y||{};if(ke([g]),(h=this.owner)!=null&&h.isKeyPair){let x=await this.connection.sendTransaction(g,{skipPreflight:R});return A&&await rt(this.connection,x),{txId:x,signedTx:g}}if(this.signAllTransactions){let x=await this.signAllTransactions([g]);if(this.signers.length)for(let T of x)try{T.sign(this.signers)}catch{}return{txId:F?"":await this.connection.sendTransaction(x[0],{skipPreflight:R}),signedTx:x[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),s=t.filter(m=>m.builder.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(m,u)=>{m.sign(i[u])}),{builder:this,transactions:a,signers:i,instructionTypes:f,buildProps:n,execute:async m=>{var w;let{sequentially:u,onTxUpdate:d,recentBlockHash:g,skipPreflight:p=!0}=m||{};if(g&&a.forEach(y=>y.message.recentBlockhash=g),ke(a),(w=this.owner)!=null&&w.isKeyPair){if(u){let y=[];for(let R of a){let A=await this.connection.sendTransaction(R,{skipPreflight:p});await rt(this.connection,A),y.push(A)}return{txIds:y,signedTxs:a}}return{txIds:await Promise.all(a.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:p}))),signedTxs:a}}if(this.signAllTransactions){let y=await this.signAllTransactions(a);if(u){let R=0,A=[],F=async()=>{if(!y[R])return;let h=await this.connection.sendTransaction(y[R],{skipPreflight:p});A.push({txId:h,status:"sent",signedTx:y[R]}),d==null||d([...A]),R++;let x=!1,T=null,S=null,B=K=>{T!==null&&clearInterval(T),S!==null&&this.connection.removeSignatureListener(S);let k=A.findIndex(M=>M.txId===h);if(k>-1){if(A[k].status==="error"||A[k].status==="success")return;A[k].status=K.err?"error":"success"}d==null||d([...A]),K.err||F()};this.loopMultiTxStatus&&(T=setInterval(async()=>{var K;if(x){clearInterval(T);return}try{let k=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});k&&(x=!0,clearInterval(T),B({err:((K=k.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",h))}catch(k){x=!0,clearInterval(T),console.error("getTransaction timeout:",k,h)}},ot)),S=this.connection.onSignature(h,K=>{if(x){this.connection.removeSignatureListener(S);return}x=!0,B(K)},"confirmed"),this.connection.getSignatureStatus(h)};return F(),{txIds:[],signedTxs:y}}else{let R=[];for(let A=0;A<y.length;A+=1){let F=await this.connection.sendTransaction(y[A],{skipPreflight:p});R.push(F)}return{txIds:R,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var d;let u=e||{},{splitIns:t=[],computeBudgetConfig:n}=u,o=Ye(u,["splitIns","computeBudgetConfig"]),s=n?tt(n):{instructions:[],instructionTypes:[]},a=this.signers.reduce((g,p)=>Q(j({},g),{[p.publicKey.toBase58()]:p}),{}),i=[],f=[],l=[],m=0;if(this.allInstructions.forEach(g=>{let p=[...l,g],w=n?[...s.instructions,...p]:p,R=[...new Set(p.map(A=>A.keys.filter(F=>F.isSigner).map(F=>F.pubkey.toString())).flat()).values()].map(A=>new W.PublicKey(A));if(g!==t[m]&&l.length<12&&(Oe({instructions:w,payer:this.feePayer,signers:R})||Oe({instructions:p,payer:this.feePayer,signers:R})))l.push(g);else{if(l.length===0)throw Error("item ins too big");m+=g===t[m]?1:0,Oe({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:R})?i.push(new W.Transaction().add(...s.instructions,...l)):i.push(new W.Transaction().add(...l)),f.push(Array.from(new Set(l.map(A=>A.keys.filter(F=>F.isSigner).map(F=>F.pubkey.toString())).flat())).map(A=>a[A]).filter(A=>A!==void 0)),l=[g]}}),l.length>0){let p=[...new Set(l.map(w=>w.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(w=>a[w]).filter(w=>w!==void 0);Oe({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:p.map(w=>w.publicKey)})?i.push(new W.Transaction().add(...s.instructions,...l)):i.push(new W.Transaction().add(...l)),f.push(p)}return i.forEach(g=>g.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&f.forEach(g=>{g.some(p=>p.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),{builder:this,transactions:i,signers:f,instructionTypes:this.instructionTypes,execute:async g=>{var h;let{sequentially:p,onTxUpdate:w,skipTxCount:y=0,recentBlockHash:R,skipPreflight:A=!0}=g||{},F=R!=null?R:await Be(this.connection,this.blockhashCommitment);if(i.forEach(async(x,T)=>{x.recentBlockhash=F,f[T].length&&x.sign(...f[T])}),ke(i),(h=this.owner)!=null&&h.isKeyPair){if(p){let x=0,T=[];for(let S of i){if(++x,x<=y){T.push("tx skipped");continue}let B=await(0,W.sendAndConfirmTransaction)(this.connection,S,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});T.push(B)}return{txIds:T,signedTxs:i}}return{txIds:await Promise.all(i.map(async x=>await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:A}))),signedTxs:i}}if(this.signAllTransactions){let x=await this.signAllTransactions(i.slice(y,i.length)),T=[...i.slice(0,y),...x];if(p){let S=0,B=[],K=async()=>{if(!T[S])return;S<y&&(B.push({txId:"",status:"success",signedTx:T[S]}),w==null||w([...B]),S++,K());let k=await this.connection.sendRawTransaction(T[S].serialize(),{skipPreflight:A});B.push({txId:k,status:"sent",signedTx:T[S]}),w==null||w([...B]),S++;let M=!1,L=null,D=null,V=q=>{L!==null&&clearInterval(L),D!==null&&this.connection.removeSignatureListener(D);let z=B.findIndex(ce=>ce.txId===k);if(z>-1){if(B[z].status==="error"||B[z].status==="success")return;B[z].status=q.err?"error":"success"}w==null||w([...B]),q.err||K()};this.loopMultiTxStatus&&(L=setInterval(async()=>{var q;if(M){clearInterval(L);return}try{let z=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});z&&(M=!0,clearInterval(L),V({err:((q=z.meta)==null?void 0:q.err)||null}),console.log("tx status from getTransaction:",k))}catch(z){M=!0,clearInterval(L),console.error("getTransaction timeout:",z,k)}},ot)),D=this.connection.onSignature(k,q=>{if(M){this.connection.removeSignatureListener(D);return}M=!0,V(q)},"confirmed"),this.connection.getSignatureStatus(k)};return await K(),{txIds:B.map(k=>k.txId),signedTxs:T}}else{let S=[];for(let B=0;B<T.length;B+=1){let K=await this.connection.sendRawTransaction(T[B].serialize(),{skipPreflight:A});S.push(K)}return{txIds:S,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var F;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=A,a=Ye(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=j(j({},this.cluster==="devnet"?await Ft(this.connection):nt),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),l=[];for(let h of f)i[h]===void 0&&l.push(new W.PublicKey(h));let m=await Vt({connection:this.connection,address:l});for(let[h,x]of Object.entries(m))i[h]=x;let u=t?tt(t):{instructions:[],instructionTypes:[]},d=await Be(this.connection,this.blockhashCommitment),g=this.signers.reduce((h,x)=>Q(j({},h),{[x.publicKey.toBase58()]:x}),{}),p=[],w=[],y=[],R=0;if(this.allInstructions.forEach(h=>{let x=[...y,h],T=t?[...u.instructions,...x]:x;if(h!==n[R]&&y.length<12&&(We({instructions:T,payer:this.feePayer,lookupTableAddressAccount:i})||We({instructions:x,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(h);else{if(y.length===0)throw Error("item ins too big");R+=h===n[R]?1:0;let S={};for(let B of[...new Set(f)])i[B]!==void 0&&(S[B]=i[B]);if(t&&We({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:d})){let B=new W.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));p.push(new W.VersionedTransaction(B))}else{let B=new W.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(i));p.push(new W.VersionedTransaction(B))}w.push(Array.from(new Set(y.map(B=>B.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(B=>g[B]).filter(B=>B!==void 0)),y=[h]}}),y.length>0){let x=[...new Set(y.map(T=>T.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(T=>g[T]).filter(T=>T!==void 0);if(t&&We({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:d})){let T=new W.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));p.push(new W.VersionedTransaction(T))}else{let T=new W.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(i));p.push(new W.VersionedTransaction(T))}w.push(x)}return(F=this.owner)!=null&&F.signer&&w.forEach(h=>{h.some(x=>x.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),p.forEach((h,x)=>{h.sign(w[x])}),{builder:this,transactions:p,buildProps:e,signers:w,instructionTypes:this.instructionTypes,execute:async h=>{var k;let{sequentially:x,onTxUpdate:T,skipTxCount:S=0,recentBlockHash:B,skipPreflight:K=!0}=h||{};if(p.map(async(M,L)=>{w[L].length&&M.sign(w[L]),B&&(M.message.recentBlockhash=B)}),ke(p),(k=this.owner)!=null&&k.isKeyPair){if(x){let M=0,L=[];for(let D of p){if(++M,M<=S){console.log("skip tx: ",M),L.push("tx skipped");continue}let V=await this.connection.sendTransaction(D,{skipPreflight:K});await rt(this.connection,V),L.push(V)}return{txIds:L,signedTxs:p}}return{txIds:await Promise.all(p.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:K}))),signedTxs:p}}if(this.signAllTransactions){let M=await this.signAllTransactions(p.slice(S,p.length)),L=[...p.slice(0,S),...M];if(x){let D=0,V=[],q=async()=>{if(!L[D])return;if(D<S){V.push({txId:"",status:"success",signedTx:L[D]}),T==null||T([...V]),D++,q();return}let z=await this.connection.sendTransaction(L[D],{skipPreflight:K});V.push({txId:z,status:"sent",signedTx:L[D]}),T==null||T([...V]),D++;let ce=!1,le=null,ze=null,ar=Te=>{le!==null&&clearInterval(le),ze!==null&&this.connection.removeSignatureListener(ze);let de=V.findIndex(pn=>pn.txId===z);if(de>-1){if(V[de].status==="error"||V[de].status==="success")return;V[de].status=Te.err?"error":"success"}T==null||T([...V]),Te.err||q()};this.loopMultiTxStatus&&(le=setInterval(async()=>{var Te;if(ce){clearInterval(le);return}try{let de=await this.connection.getTransaction(z,{commitment:"confirmed",maxSupportedTransactionVersion:0});de&&(ce=!0,clearInterval(le),ar({err:((Te=de.meta)==null?void 0:Te.err)||null}),console.log("tx status from getTransaction:",z))}catch(de){ce=!0,clearInterval(le),console.error("getTransaction timeout:",de,z)}},ot)),ze=this.connection.onSignature(z,Te=>{if(ce){this.connection.removeSignatureListener(ze);return}ce=!0,ar(Te)},"confirmed"),this.connection.getSignatureStatus(z)};return q(),{txIds:[],signedTxs:L}}else{let D=[];for(let V=0;V<L.length;V+=1){let q=await this.connection.sendTransaction(L[V],{skipPreflight:K});D.push(q)}return{txIds:D,signedTxs:L}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};var Er=J(require("bn.js")),Js=new Er.default(1e6);var pt=require("@solana/web3.js"),Gn=J(require("bn.js"));var Xr=require("@solana/spl-token");function En(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function _t(r,...e){if(!En(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function Mt(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function vr(r,e){_t(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var at=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ie=(r,e)=>r<<32-e|r>>>e;var xa=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function vn(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Dt(r){return typeof r=="string"&&(r=vn(r)),_t(r),r}var st=class{clone(){return this._cloneInto()}},Ta={}.toString;function Nr(r){let e=n=>r().update(Dt(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Nn(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),s=BigInt(4294967295),a=Number(t>>o&s),i=Number(t&s),f=n?4:0,l=n?0:4;r.setUint32(e+f,a,n),r.setUint32(e+l,i,n)}var Or=(r,e,t)=>r&e^~r&t,Wr=(r,e,t)=>r&e^r&t^e&t,ut=class extends st{constructor(e,t,n,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=at(this.buffer)}update(e){Mt(this);let{view:t,buffer:n,blockLen:o}=this;e=Dt(e);let s=e.length;for(let a=0;a<s;){let i=Math.min(o-this.pos,s-a);if(i===o){let f=at(e);for(;o<=s-a;a+=o)this.process(f,a);continue}n.set(e.subarray(a,a+i),this.pos),this.pos+=i,a+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Mt(this),vr(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(n,0),a=0);for(let u=a;u<o;u++)t[u]=0;Nn(n,o-8,BigInt(this.length*8),s),this.process(n,0);let i=at(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=f/4,m=this.get();if(l>m.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)i.setUint32(4*u,m[u],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:s,destroyed:a,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=a,o%t&&e.buffer.set(n),e}};var On=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),we=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),he=new Uint32Array(64),Et=class extends ut{constructor(){super(64,32,8,!1),this.A=we[0]|0,this.B=we[1]|0,this.C=we[2]|0,this.D=we[3]|0,this.E=we[4]|0,this.F=we[5]|0,this.G=we[6]|0,this.H=we[7]|0}get(){let{A:e,B:t,C:n,D:o,E:s,F:a,G:i,H:f}=this;return[e,t,n,o,s,a,i,f]}set(e,t,n,o,s,a,i,f){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=i|0,this.H=f|0}process(e,t){for(let u=0;u<16;u++,t+=4)he[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){let d=he[u-15],g=he[u-2],p=ie(d,7)^ie(d,18)^d>>>3,w=ie(g,17)^ie(g,19)^g>>>10;he[u]=w+he[u-7]+p+he[u-16]|0}let{A:n,B:o,C:s,D:a,E:i,F:f,G:l,H:m}=this;for(let u=0;u<64;u++){let d=ie(i,6)^ie(i,11)^ie(i,25),g=m+d+Or(i,f,l)+On[u]+he[u]|0,w=(ie(n,2)^ie(n,13)^ie(n,22))+Wr(n,o,s)|0;m=l,l=f,f=i,i=a+g|0,a=s,s=o,o=n,n=g+w|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,i=i+this.E|0,f=f+this.F|0,l=l+this.G|0,m=m+this.H|0,this.set(n,o,s,a,i,f,l,m)}roundClean(){he.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ur=Nr(()=>new Et);var Hr=require("@solana/web3.js"),Ve=J(require("bn.js"));var C=require("@solana/buffer-layout"),vt=C.Layout,Gr=C.Structure;var Nt=C.UInt;var qr=C.u8;var jr=C.seq;var Se=C.blob;var Fe=class extends vt{constructor(t,n,o){super(t,o);this.blob=Se(t),this.signed=n}decode(t,n=0){let o=new Ve.default(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new Ve.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function Z(r){return new Nt(1,r)}function Ge(r){return new Nt(4,r)}function b(r){return new Fe(8,!1,r)}function ge(r){return new Fe(16,!1,r)}function zr(r){return new Fe(1,!0,r)}function lt(r){return new Fe(8,!0,r)}var ct=class extends vt{constructor(t,n,o,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function v(r){return new ct(Se(32),e=>new Hr.PublicKey(e),e=>e.toBuffer(),r)}function dt(r){return new ct(qr(),Wn,Un,r)}function Wn(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Un(r){return r?1:0}var Ot=class extends Gr{decode(e,t){return super.decode(e,t)}};function H(r,e,t){return new Ot(r,e,t)}function X(r,e,t){let n,o=typeof e=="number"?e:(0,Ve.isBN)(e)?e.toNumber():new Proxy(e,{get(s,a){if(!n){let i=Reflect.get(s,"count");n=(0,Ve.isBN)(i)?i.toNumber():i,Reflect.set(s,"count",n)}return Reflect.get(s,a)},set(s,a,i){return a==="count"&&(n=i),Reflect.set(s,a,i)}});return jr(r,o,t)}var qe=H([v("mint"),v("owner"),b("amount"),Ge("delegateOption"),v("delegate"),Z("state"),Ge("isNativeOption"),b("isNative"),b("delegatedAmount"),Ge("closeAuthorityOption"),v("closeAuthority")]);var za=Y("Raydium_Util");function mt({fromPublicKey:r,programId:e=Xr.TOKEN_PROGRAM_ID,assignSeed:t}){let n=t?btoa(t).slice(0,32):pt.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:qn(r,n,e),seed:n}}function qn(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),o=Ur(n);return new pt.PublicKey(o)}var dn=J(require("decimal.js"));var ft=require("@solana/web3.js"),Yr=J(require("bn.js"));var se=require("@solana/spl-token");function jn(r){let{mint:e,tokenAccount:t,owner:n,programId:o=se.TOKEN_PROGRAM_ID}=r;return(0,se.createInitializeAccountInstruction)(t,e,n,o)}function Hn(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:o,programId:s=se.TOKEN_PROGRAM_ID}=r;return(0,se.createCloseAccountInstruction)(e,t,o,n,s)}async function Wt(r){let{connection:e,amount:t,commitment:n,payer:o,owner:s,skipCloseAccount:a}=r,i=await e.getMinimumBalanceForRentExemption(qe.span,n),f=E(t).add(new Yr.default(i)),l=mt({fromPublicKey:o,programId:se.TOKEN_PROGRAM_ID});return{addresses:{newAccount:l.publicKey},signers:[],instructions:[ft.SystemProgram.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:l.seed,newAccountPubkey:l.publicKey,lamports:f.toNumber(),space:qe.span,programId:se.TOKEN_PROGRAM_ID}),jn({mint:new ft.PublicKey(te.address),tokenAccount:l.publicKey,owner:s,programId:se.TOKEN_PROGRAM_ID})],instructionTypes:[G.CreateAccount,G.InitAccount],endInstructionTypes:a?[]:[G.CloseAccount],endInstructions:a?[]:[Hn({tokenAccount:l.publicKey,payer:o,owner:s})]}}var Ut=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),je=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Y(t)}createTxBuilder(e){return this.scope.checkOwner(),new it({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Ut(e))}logInfo(...e){this.logger.info(Ut(e))}logAndCreateError(...e){let t=Ut(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var gt=require("@solana/web3.js");var Gt=H([Z("instruction")]),qt=H([Z("instruction")]),zn=H([b("rewardState"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardLastUpdateTime"),b("totalReward"),b("totalRewardEmissioned"),b("rewardClaimed"),b("rewardPerSecond"),ge("accRewardPerShare"),v("rewardVault"),v("rewardMint"),v("rewardSender"),b("rewardType"),X(b(),15,"padding")]),Xn=H([b("state"),b("nonce"),v("lpVault"),v("rewardVault"),v(),v(),b(),b(),b("totalReward"),ge("perShareReward"),b("lastSlot"),b("perSlotReward")]),Yn=H([b("state"),b("nonce"),v("lpVault"),v("rewardVaultA"),b("totalRewardA"),ge("perShareRewardA"),b("perSlotRewardA"),Z("option"),v("rewardVaultB"),Se(7),b("totalRewardB"),ge("perShareRewardB"),b("perSlotRewardB"),b("lastSlot"),v()]),Zn=H([b(),b("state"),b("nonce"),b("validRewardTokenNum"),ge("rewardMultiplier"),b("rewardPeriodMax"),b("rewardPeriodMin"),b("rewardPeriodExtend"),v("lpMint"),v("lpVault"),X(zn,5,"rewardInfos"),v("creator"),v(),X(b(),32,"padding")]),Jn=new Proxy(Xn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Q(j({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,e,t)}}),Qn=new Proxy(Yn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Q(j({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,e,t)}}),yt=new Proxy(Zn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Q(j({},o),{version:6,rewardInfos:o.rewardInfos.map(s=>{var a;return Q(j({},s),{rewardType:((a=Object.entries(xe).find(i=>String(i[1])===s.rewardType.toString()))!=null?a:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),$n=H([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),jt=H([Z("instruction"),b("nonce"),X($n,5,"rewardTimeInfo")]),Ht=H([Z("instruction"),b("rewardReopenTime"),b("rewardEndTime"),b("rewardPerSecond")]),zt=H([Z("instruction"),b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),yu=H([b("state"),v("id"),v("owner"),b("deposited"),X(b(),1,"rewardDebts")]),Xt=H([b("state"),v("id"),v("owner"),b("deposited"),X(ge(),1,"rewardDebts"),b(""),b("voteLockedBalance"),X(b(),15)]),gu=H([b("state"),v("id"),v("owner"),b("deposited"),X(b(),2,"rewardDebts")]),Zr=H([b("state"),v("id"),v("owner"),b("deposited"),X(ge(),2,"rewardDebts"),X(b(),17)]),Jr=H([b(),b("state"),v("id"),v("owner"),b("deposited"),X(ge(),5,"rewardDebts"),X(b(),16)]),re=H([Z("instruction"),b("amount")]),eo=H([v("mint"),v("grantAuthority"),b("baselineVoteWeightScaledFactor"),b("maxExtraLockupVoteWeightScaledFactor"),b("lockupSaturationSecs"),zr("digitShift"),X(Z(),7,"reserved1"),X(b(),7,"reserved2")]),to=H([Se(8),v("governanceProgramId"),v("realm"),v("realmGoverningTokenMint"),v("realmAuthority"),X(Z(),32,"reserved1"),X(eo,4,"votingMints"),lt("timeOffset"),Z("bump"),X(Z(),7,"reserved2"),X(b(),11,"reserved3")]),ro=H([lt("startTime"),lt("endTime"),Z("kind"),X(Z(),15,"reserved")]),no=H([X(ro,1,"lockup"),b("amountDeposited_native"),b("amountInitiallyLockedNative"),dt("isUsed"),dt("allowClawback"),Z("votingMintConfigIdx"),X(Z(),29,"reserved")]),oo=H([Se(8),v("voterAuthority"),v("registrar"),X(no,32,"deposits"),Z("voterBump"),Z("voterWweightRecordBump"),X(Z(),94,"reserved")]);var io=require("@solana/spl-token"),Au=Y("Raydium_farm_config"),Qr=new gt.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),$r=new gt.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var ku=new gt.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX");var en={3:Xt,5:Zr,6:Jr},Yt=r=>[3,4,5,6].indexOf(r)!==-1,Zt=r=>{var a;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=r,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,s={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(a=s[e])==null?void 0:a.call(s)},xe={"Standard SPL":0,"Option tokens":1},be={[Fr.toString()]:3,[_r.toString()]:4,[Mr.toString()]:5,[Ue.toString()]:6,[Ie.FARM_PROGRAM_ID_V3.toString()]:3,[Ie.FARM_PROGRAM_ID_V4.toString()]:4,[Ie.FARM_PROGRAM_ID_V5.toString()]:5,[Ie.FARM_PROGRAM_ID_V6.toString()]:6};var P=require("@solana/web3.js"),$t=J(require("bn.js")),ne=require("@solana/spl-token");var tn=J(require("bn.js"));var so=Y("Raydium.farm.util");function He({programId:r,poolId:e,mint:t,type:n}){let{publicKey:o}=Ae([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function ue({programId:r,poolId:e,owner:t,version:n}){let{publicKey:o}=Ae([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var rn=({programId:r,poolId:e})=>Ae([e.toBuffer()],r);function nn(r){return{isSet:new tn.default(1),rewardPerSecond:E(r.perSecond),rewardOpenTime:E(r.openTime),rewardEndTime:E(r.endTime),rewardType:E(xe[r.rewardType])}}function Jt(r){return E(r.endTime).sub(E(r.openTime)).mul(E(r.perSecond))}function Qt(r){let e=en[r];return e||so.logWithError("invalid version",r),e}var ao=Y("Raydium_farm_instruction"),cc={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function er(r){let{version:e,id:t,ledger:n,programId:o,owner:s}=r,a={3:9,5:10}[e];a||ao.logWithError(`invalid farm pool version: ${e}`);let i=Buffer.alloc(Gt.span);Gt.encode({instruction:a},i);let f=[c({pubkey:t}),c({pubkey:n}),c({pubkey:s,isWritable:!1}),c({pubkey:P.SystemProgram.programId,isWritable:!1}),c({pubkey:P.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new P.TransactionInstruction({programId:o,keys:f,data:i}),instructionType:G.FarmV3CreateLedger}}function on(r){var n;let e=Buffer.alloc(jt.span);jt.encode({instruction:0,nonce:new $t.default(r.nonce),rewardTimeInfo:r.rewardInfoConfig},e);let t=[...It,c({pubkey:r.farmId}),c({pubkey:r.farmAuthority,isWritable:!1}),c({pubkey:r.lpVault}),c({pubkey:r.lpMint,isWritable:!1}),c({pubkey:r.lockVault}),c({pubkey:r.lockMint,isWritable:!1}),c({pubkey:(n=r.lockUserAccount)!=null?n:$}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let o of r.rewardInfo)t.push(c({pubkey:o.rewardMint,isWritable:!1}),c({pubkey:o.rewardVault}),c({pubkey:o.userRewardToken}));return{instruction:new P.TransactionInstruction({programId:r.programId,keys:t,data:e}),instructionType:G.FarmV6Create}}function sn(r){let e=Buffer.alloc(qt.span);qt.encode({instruction:5},e);let t=[c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:r.id}),c({pubkey:r.authority,isWritable:!1}),c({pubkey:r.lpVault,isWritable:!1}),c({pubkey:r.rewardVault}),c({pubkey:r.userRewardToken}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new P.TransactionInstruction({programId:r.programId,keys:t,data:e}),instructionType:G.FarmV6CreatorWithdraw}}function tr({payer:r,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:o}){let s=Buffer.alloc(Ht.span);Ht.encode({instruction:3,rewardReopenTime:E(o.openTime),rewardEndTime:E(o.endTime),rewardPerSecond:E(o.perSecond)},s);let a=[c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:n.id}),c({pubkey:n.lpVault,isWritable:!1}),c({pubkey:e}),c({pubkey:t}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new P.TransactionInstruction({programId:n.programId,keys:a,data:s})}function rr({payer:r,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:o}){let s=Buffer.alloc(zt.span);zt.encode({instruction:4,isSet:new $t.default(1),rewardPerSecond:E(o.perSecond),rewardOpenTime:E(o.openTime),rewardEndTime:E(o.endTime),rewardType:E(xe[o.rewardType])},s);let a=[...It,c({pubkey:t.id}),c({pubkey:t.authority,isWritable:!1}),c({pubkey:o.mint,isWritable:!1}),c({pubkey:n}),c({pubkey:e}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new P.TransactionInstruction({programId:t.programId,keys:a,data:s})}function nr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new P.PublicKey(e.programId),new P.PublicKey(e.id)],l=ue({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(re.span);re.encode({instruction:2,amount:E(a)},m);let u=[c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:f}),c({pubkey:new P.PublicKey(t.authority),isWritable:!1}),c({pubkey:new P.PublicKey(t.lpVault)}),c({pubkey:l}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)u.push(c({pubkey:new P.PublicKey(t.rewardInfos[d].vault)})),u.push(c({pubkey:o[d]}));return new P.TransactionInstruction({programId:i,keys:u,data:m})}function or(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new P.PublicKey(e.programId),new P.PublicKey(e.id)],m=ue({programId:f,poolId:l,owner:s,version:5}),u=Buffer.alloc(re.span);re.encode({instruction:12,amount:E(a)},u);let d=[c({pubkey:l}),c({pubkey:new P.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new P.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new P.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:P.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1})];for(let g=1;g<t.rewardInfos.length;g++)d.push(c({pubkey:o[g]})),d.push(c({pubkey:new P.PublicKey(t.rewardInfos[g].vault)}));if(i)for(let g of i)d.push(c({pubkey:g}));return new P.TransactionInstruction({programId:f,keys:d,data:u})}function an(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new P.PublicKey(e.programId),new P.PublicKey(e.id)],m=H([Z("instruction"),b("amount")]),u=[c({pubkey:l}),c({pubkey:new P.PublicKey(t.authority),isWritable:!1}),c({pubkey:i[0]}),c({pubkey:s,isSigner:!0,isWritable:!1}),c({pubkey:n}),c({pubkey:new P.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new P.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:P.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:o[1]}),c({pubkey:new P.PublicKey(t.rewardInfos[1].vault)})],d=Buffer.alloc(m.span);return m.encode({instruction:2,amount:a},d),new P.TransactionInstruction({keys:u,programId:f,data:d})}function ir(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new P.PublicKey(e.programId),new P.PublicKey(e.id)],m=ue({programId:f,poolId:l,owner:s,version:3}),u=Buffer.alloc(re.span);re.encode({instruction:11,amount:E(a)},u);let d=[c({pubkey:l}),c({pubkey:new P.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new P.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new P.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:P.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1})];if(i)for(let g of i)d.push(c({pubkey:g}));return new P.TransactionInstruction({programId:f,keys:d,data:u})}function un(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new P.PublicKey(e.programId),new P.PublicKey(e.id)],m=ue({programId:f,poolId:l,owner:s,version:3}),u=Buffer.alloc(re.span);re.encode({instruction:10,amount:E(a)},u);let d=[c({pubkey:l}),c({pubkey:new P.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new P.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new P.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:P.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1})];if(i)for(let g of i)d.push(c({pubkey:g}));return new P.TransactionInstruction({programId:f,keys:d,data:u})}function cn(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,l]=[new P.PublicKey(e.programId),new P.PublicKey(e.id)],m=ue({programId:f,poolId:l,owner:s,version:5}),u=Buffer.alloc(re.span);re.encode({instruction:11,amount:E(a)},u);let d=[c({pubkey:l}),c({pubkey:new P.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new P.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new P.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:P.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1})];for(let g=1;g<t.rewardInfos.length;g++)d.push(c({pubkey:o[g]})),d.push(c({pubkey:new P.PublicKey(t.rewardInfos[g].vault)}));if(i)for(let g of i)d.push(c({pubkey:g}));return new P.TransactionInstruction({programId:f,keys:d,data:u})}function ln(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new P.PublicKey(e.programId),new P.PublicKey(e.id)],l=ue({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(re.span);re.encode({instruction:1,amount:E(a)},m);let u=[c({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:P.SystemProgram.programId,isWritable:!1}),c({pubkey:f}),c({pubkey:new P.PublicKey(t.authority),isWritable:!1}),c({pubkey:new P.PublicKey(t.lpVault)}),c({pubkey:l}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)u.push(c({pubkey:new P.PublicKey(t.rewardInfos[d].vault)})),u.push(c({pubkey:o[d]}));return new P.TransactionInstruction({programId:i,keys:u,data:m})}var bt=class extends je{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals($)){let n=await Wt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:Jt(Q(j({},t),{openTime:t.openTime.toString(),endTime:t.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:o=Ue,txVersion:s,feePayer:a,lockProgram:i}){var S,B;this.checkDisabled(),this.scope.checkOwner();let l={lpMint:new N.PublicKey(e.lpMint.address),lockInfo:{lockMint:(S=i==null?void 0:i.mint)!=null?S:Qr,lockVault:(B=i==null?void 0:i.vault)!=null?B:$r},version:6,rewardInfos:t,programId:o},m=this.createTxBuilder(a),u=n!=null?n:this.scope.ownerPubKey,d=mt({fromPublicKey:u,programId:l.programId}),g=await this.scope.connection.getMinimumBalanceForRentExemption(yt.span);m.addInstruction({instructions:[N.SystemProgram.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:d.seed,newAccountPubkey:d.publicKey,lamports:g,space:yt.span,programId:l.programId})]});let{publicKey:p,nonce:w}=rn({programId:new N.PublicKey(l.programId),poolId:d.publicKey}),y=He({programId:l.programId,poolId:d.publicKey,mint:l.lpMint,type:"lpVault"}),R=[],A=[];for(let K of l.rewardInfos){K.openTime>=K.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",K.openTime.toString()),isNaN(xe[K.rewardType])&&this.logAndCreateError("rewardType error",K.rewardType),Number(K.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",K.perSecond),R.push(nn(K));let{rewardPubKey:k,newInstruction:M}=await this._getUserRewardInfo({rewardInfo:K,payer:u});M&&m.addInstruction(M),k||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let L=K.mint.equals($)?new N.PublicKey(te.address):K.mint;A.push({rewardMint:L,rewardVault:He({programId:l.programId,poolId:d.publicKey,mint:L,type:"rewardVault"}),userRewardToken:k})}let{account:F,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:new N.PublicKey(l.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});h&&m.addInstruction(h),F||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:x,instructionType:T}=on({farmId:d.publicKey,owner:this.scope.ownerPubKey,farmAuthority:p,lpVault:y,lpMint:l.lpMint,lockVault:l.lockInfo.lockVault,lockMint:l.lockInfo.lockMint,lockUserAccount:F,programId:l.programId,rewardInfo:A,rewardInfoConfig:R,nonce:w});return m.addInstruction({instructions:[x],instructionTypes:[T]}).versionBuild({txVersion:s,extInfo:{farmId:d.publicKey,farmAuthority:p,lpVault:y,lockUserAccount:F,nonce:w}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:o,feePayer:s}){var R;let a=be[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=ye((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let l=t||this.scope.ownerPubKey,m=n.mint.equals($)?new N.PublicKey(te.address):n.mint,u=f.rewardInfos.findIndex(A=>new N.PublicKey(A.mint.address).equals(m)),d=i.rewardInfos[u];d||this.logAndCreateError("configuration does not exist","rewardMint",m);let g=(R=d.vault)!=null?R:$,p=this.createTxBuilder(s),{rewardPubKey:w,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:n,payer:l});return y&&p.addInstruction(y),w||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[tr({payer:this.scope.ownerPubKey,rewardVault:g,userRewardTokenPub:w,farmKeys:f,rewardInfo:n})],instructionTypes:[G.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:o,feePayer:s}){var u;let a=be[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=ye((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.forEach(d=>{d.openTime>=d.endTime&&this.logAndCreateError("start time error","newRewardInfo",d)});let l=t||this.scope.ownerPubKey,m=this.createTxBuilder(s);for(let d of n){let g=d.mint.equals($)?new N.PublicKey(te.address):d.mint,p=f.rewardInfos.findIndex(h=>new N.PublicKey(h.mint.address).equals(g)),w=i.rewardInfos[p];w||this.logAndCreateError("configuration does not exist","rewardMint",g);let y=(u=w.vault)!=null?u:$,{rewardPubKey:R,newInstruction:A}=await this._getUserRewardInfo({rewardInfo:d,payer:l});A&&m.addInstruction(A),R||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let F=tr({payer:this.scope.ownerPubKey,rewardVault:y,userRewardTokenPub:R,farmKeys:f,rewardInfo:d});m.addInstruction({instructions:[F],instructionTypes:[G.FarmV6Restart]})}return m.versionBuild({txVersion:o})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:o,payer:s,feePayer:a}=e,i=be[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=ye((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),l=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a),u=o.mint.equals($)?new N.PublicKey(te.address):o.mint,d=He({programId:new N.PublicKey(n.programId),poolId:new N.PublicKey(n.id),mint:u,type:"rewardVault"}),{rewardPubKey:g,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:o,payer:l});return p&&m.addInstruction(p),g||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=u,m.addInstruction({instructions:[rr({payer:this.scope.ownerPubKey,userRewardTokenPub:g,farmKeys:f,rewardVault:d,rewardInfo:o})],instructionTypes:[G.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:o,payer:s,feePayer:a}=e,i=be[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=ye((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),l=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a);for(let u of o){let d=u.mint.equals($)?new N.PublicKey(te.address):u.mint,g=He({programId:new N.PublicKey(n.programId),poolId:new N.PublicKey(n.id),mint:d,type:"rewardVault"}),{rewardPubKey:p,newInstruction:w}=await this._getUserRewardInfo({rewardInfo:u,payer:l});w&&m.addInstruction(w),p||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let y=rr({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:f,rewardVault:g,rewardInfo:Q(j({},u),{mint:d})});m.addInstruction({instructions:[y],instructionTypes:[G.FarmV6CreatorAddReward]})}return m.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:o,feePayer:s,useSOLBalance:a,associatedOnly:i=!0,checkCreateATAOwner:f=!1,userAuxiliaryLedgers:l,computeBudgetConfig:m,txTipConfig:u}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:d,programId:g}=n,p=be[g];p===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),Yt(p)||this.logAndCreateError("invalid farm program:",n.programId);let[w,y]=[new N.PublicKey(n.programId),new N.PublicKey(n.id)],R=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],A=ue({programId:w,poolId:y,owner:this.scope.ownerPubKey,version:p}),F=this.createTxBuilder(s);F.addCustomComputeBudget(m),F.addTipInstruction(u);let h={};for(let V of this.scope.account.tokenAccounts)if(i){let q=Ke(this.scope.ownerPubKey,V.mint,V.programId).publicKey;V.publicKey&&q.equals(V.publicKey)&&(h[V.mint.toString()]=V.publicKey)}else h[V.mint.toString()]=V.publicKey;let x=R.lpMint,T=h[x.address];T||this.logAndCreateError("you don't have any lp","lp zero",h);let S=[];for(let V of d){let q=a&&V.mint.address===pe.toString(),z=h[V.mint.address];if(!z){let{account:ce,instructionParams:le}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:V.mint.programId,mint:new N.PublicKey(V.mint.address),notUseTokenAccount:q,createInfo:{payer:s||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!q,associatedOnly:q?!1:i,checkCreateATAOwner:f});z=ce,le&&F.addInstruction(le)}h[V.mint.address]=z,S.push(z)}let B,K=await this.scope.connection.getAccountInfo(A);if(K&&(B=Qt(p).decode(K.data)),n.programId!==Ue.toString()&&n.programId!==Ie.FARM_PROGRAM_ID_V6.toString()&&!B){let{instruction:V,instructionType:q}=er({id:y,programId:w,version:p,ledger:A,owner:this.scope.ownerPubKey});F.addInstruction({instructions:[V],instructionTypes:[q]})}let k=Zt({version:p,rewardInfos:d,rewardTokenAccountsPublicKeys:S});k&&this.logAndCreateError(k);let M={amount:E(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:R,lpAccount:T,rewardAccounts:S,userAuxiliaryLedgers:l==null?void 0:l.map(V=>new N.PublicKey(V))},L=p===6?ln(M):p===5?cn(M):un(M),D={3:G.FarmV3Deposit,5:G.FarmV5Deposit,6:G.FarmV6Deposit};return F.addInstruction({instructions:[L],instructionTypes:[D[p]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:o,deposited:s,useSOLBalance:a,feePayer:i,associatedOnly:f=!0,checkCreateATAOwner:l=!1,userAuxiliaryLedgers:m,computeBudgetConfig:u,txTipConfig:d}=e,{rewardInfos:g}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let p=be[n.programId];Yt(p)||this.logAndCreateError("invalid farm program:",n.programId);let w=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],y=this.createTxBuilder(i);y.addCustomComputeBudget(u),y.addTipInstruction(d);let R={};for(let k of this.scope.account.tokenAccounts)if(f){let M=Ke(this.scope.ownerPubKey,k.mint).publicKey;k.publicKey&&M.equals(k.publicKey)&&(R[k.mint.toString()]=k.publicKey)}else R[k.mint.toString()]=k.publicKey;if(p!==4){let k=ue({programId:new N.PublicKey(n.programId),poolId:new N.PublicKey(n.id),owner:this.scope.ownerPubKey,version:p}),M=await this.scope.connection.getAccountInfo(k);if(M)Qt(p).decode(M.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(p!==6){let{instruction:L,instructionType:D}=er({id:new N.PublicKey(w.id),programId:new N.PublicKey(w.programId),version:p,ledger:k,owner:this.scope.ownerPubKey});y.addInstruction({instructions:[L],instructionTypes:[D]})}}s&&s.isZero()&&!(m||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let A=w.lpMint.address,F=a&&A===pe.toString(),h=R[A.toString()];if(!h){let{account:k,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:w.lpMint.programId,mint:new N.PublicKey(A),notUseTokenAccount:F,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:F?!1:f,checkCreateATAOwner:l});h=k,M&&y.addInstruction(M)}R[A.toString()]=h;let x=[];for(let k of g){let M=a&&k.mint.address===pe.toString(),L=R[k.mint.address];if(!L){let{account:D,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:k.mint.programId,mint:new N.PublicKey(k.mint.address),notUseTokenAccount:M,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!M,associatedOnly:M?!1:f,checkCreateATAOwner:l});L=D,V&&y.addInstruction(V)}R[k.mint.address]=L,x.push(L)}let T=Zt({version:p,rewardInfos:g,rewardTokenAccountsPublicKeys:x});T&&this.logAndCreateError(T);let S={amount:E(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:w,lpAccount:h,rewardAccounts:x,userAuxiliaryLedgers:m==null?void 0:m.map(k=>new N.PublicKey(k))},B=p===6?nr(S):p===5?or(S):p===4?an(S):ir(S),K={3:G.FarmV3Withdraw,4:G.FarmV4Withdraw,5:G.FarmV5Withdraw,6:G.FarmV6Withdraw};return y.addInstruction({instructions:[B],instructionTypes:[K[p]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){var w;this.scope.checkOwner();let i=ye((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f=be[e.programId];f!==6&&this.logAndCreateError("invalid farm version",f);let l=i.rewardInfos.find(y=>Je(y.mint.address).equals(Je(t)));l||this.logAndCreateError("withdraw mint error","rewardInfos",e);let m=(w=l==null?void 0:l.vault)!=null?w:$,u=this.createTxBuilder(a),d;if(t.equals($)||t.equals(N.PublicKey.default)){let y=await Wt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:Jt(Q(j({},l),{openTime:l.openTime,endTime:l.endTime,perSecond:new dn.default(l.perSecond).mul(10**l.mint.decimals).toString()}))});d=y.addresses.newAccount,u.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(d=await this.scope.account.getAssociatedTokenAccount(t),u.addInstruction({instructions:[(0,sr.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,d,this.scope.ownerPubKey,t)],instructionTypes:[G.CreateATA]})):d=y}let{instruction:g,instructionType:p}=sn({programId:i.programId,id:i.id,authority:i.authority,lpVault:i.lpVault,rewardVault:m,userRewardToken:d,owner:this.scope.ownerPubKey});return u.addCustomComputeBudget(o),u.addTipInstruction(s),u.addInstruction({instructions:[g],instructionTypes:[p]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:o,associatedOnly:s=!0,checkCreateATAOwner:a=!1,userAuxiliaryLedgers:i,txVersion:f,computeBudgetConfig:l}=e,m=this.createTxBuilder(o),u={};for(let p of this.scope.account.tokenAccounts)if(s){let w=Ke(this.scope.ownerPubKey,p.mint).publicKey;p.publicKey&&w.equals(p.publicKey)&&(u[p.mint.toString()]=p.publicKey)}else u[p.mint.toString()]=p.publicKey;let g=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(p=>p.id).join(",")})).reduce((p,w)=>Q(j({},p),{[w.id]:w}),{});for(let p of Object.values(t)){let{programId:w,lpMint:y,rewardInfos:R,id:A}=p,F=be[w],h=y.address,x=n&&h===pe.toString(),T=u[h];if(!T){let{account:L,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.programId,mint:new N.PublicKey(h),notUseTokenAccount:x,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:x?!1:s,checkCreateATAOwner:a});T=L,D&&m.addInstruction(D)}u[h.toString()]=T;let S=[];for(let L of R){let D=n&&L.mint.address===pe.toString(),V=u[L.mint.address];if(!V)if(D){let{account:q,instructionParams:z}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:L.mint.programId,mint:new N.PublicKey(L.mint.address),notUseTokenAccount:D,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!D,associatedOnly:D?!1:s,checkCreateATAOwner:a});V=q,z&&m.addInstruction(z)}else{let q=new N.PublicKey(L.mint.address);V=this.scope.account.getAssociatedTokenAccount(q),m.addInstruction({instructions:[(0,sr.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,V,this.scope.ownerPubKey,q)]})}u[L.mint.address]=V,S.push(V)}let B=g[A],K={amount:Ct,owner:this.scope.ownerPubKey,farmInfo:p,farmKeys:B,lpAccount:T,rewardAccounts:S,userAuxiliaryLedgers:i==null?void 0:i.map(L=>new N.PublicKey(L))},k=F===6?nr(K):F===5?or(K):ir(K),M={3:G.FarmV3Withdraw,5:G.FarmV5Withdraw,6:G.FarmV6Withdraw};m.addInstruction({instructions:[k],instructionTypes:[M[F]]})}return f===1?m.sizeCheckBuild({computeBudgetConfig:l}):m.sizeCheckBuildV0({computeBudgetConfig:l})}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.js.map