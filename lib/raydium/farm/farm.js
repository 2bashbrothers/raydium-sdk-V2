var fn=Object.create;var Ne=Object.defineProperty,yn=Object.defineProperties,gn=Object.getOwnPropertyDescriptor,bn=Object.getOwnPropertyDescriptors,hn=Object.getOwnPropertyNames,rt=Object.getOwnPropertySymbols,wn=Object.getPrototypeOf,kt=Object.prototype.hasOwnProperty,pr=Object.prototype.propertyIsEnumerable;var dr=(r,e,t)=>e in r?Ne(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,H=(r,e)=>{for(var t in e||(e={}))kt.call(e,t)&&dr(r,t,e[t]);if(rt)for(var t of rt(e))pr.call(e,t)&&dr(r,t,e[t]);return r},Z=(r,e)=>yn(r,bn(e));var Oe=(r,e)=>{var t={};for(var n in r)kt.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&rt)for(var n of rt(r))e.indexOf(n)<0&&pr.call(r,n)&&(t[n]=r[n]);return t};var xn=(r,e)=>{for(var t in e)Ne(r,t,{get:e[t],enumerable:!0})},mr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of hn(e))!kt.call(r,o)&&o!==t&&Ne(r,o,{get:()=>e[o],enumerable:!(n=gn(e,o))||n.enumerable});return r};var Q=(r,e,t)=>(t=r!=null?fn(wn(r)):{},mr(e||!r||!r.__esModule?Ne(t,"default",{value:r,enumerable:!0}):t,r)),Tn=r=>mr(Ne({},"__esModule",{value:!0}),r);var lo={};xn(lo,{default:()=>Tt});module.exports=Tn(lo);var W=require("@solana/web3.js"),lr=require("@solana/spl-token");var yr=require("@solana/web3.js");var We=require("lodash");var It=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},fr={},Pn={};function J(r){let e=(0,We.get)(fr,r);if(!e){let t=(0,We.get)(Pn,r);e=new It({name:r,logLevel:t}),(0,We.set)(fr,r,e)}return e}var nt=require("@solana/spl-token"),At=J("Raydium_accountInfo_util");async function gr(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:s=100}=H({batchRequest:!1},t),a=St(e,s),i=new Array(a.length).fill([]);if(n){let f=a.map(u=>{let p=r._buildArgs([u.map(w=>w.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),d=St(f,10);i=(await(await Promise.all(d.map(async u=>await r._rpcBatchRequest(u)))).flat()).map(u=>(u.error&&At.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.error.message}`),u.result.value.map(p=>{if(p){let{data:w,executable:l,lamports:x,owner:y,rentEpoch:K}=p;return w.length!==2&&w[1]!=="base64"&&At.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(w[0],"base64"),executable:l,lamports:x,owner:new yr.PublicKey(y),rentEpoch:K}}return null})))}else try{i=await Promise.all(a.map(f=>r.getMultipleAccountsInfo(f,o)))}catch(f){f instanceof Error&&At.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return i.flat()}var de=Q(require("bn.js")),Vn=Q(require("decimal.js"));var Pr=Q(require("big.js")),He=Q(require("bn.js"));var br=Q(require("toformat")),kn=br.default,Ue=kn;var Ge=Q(require("big.js")),wr=Q(require("bn.js")),xr=Q(require("decimal.js-light"));var Ve=Q(require("bn.js"));var hr=9007199254740991;function E(r){let e=J("Raydium_parseBigNumberish");if(r instanceof Ve.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Ve.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=hr||r<=-hr)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Ve.default(String(r))):typeof r=="bigint"?new Ve.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Ve.default(0))}var it=J("module/fraction"),Lt=Ue(Ge.default),qe=Ue(xr.default),An={[0]:qe.ROUND_DOWN,[1]:qe.ROUND_HALF_UP,[2]:qe.ROUND_UP},Sn={[0]:Ge.default.roundDown,[1]:Ge.default.roundHalfUp,[2]:Ge.default.roundUp},G=class{constructor(e,t=new wr.default(1)){this.numerator=E(e),this.denominator=E(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new G(this.denominator,this.numerator)}add(e){let t=e instanceof G?e:new G(E(e));return this.denominator.eq(t.denominator)?new G(this.numerator.add(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof G?e:new G(E(e));return this.denominator.eq(t.denominator)?new G(this.numerator.sub(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof G?e:new G(E(e));return new G(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof G?e:new G(E(e));return new G(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||it.logWithError(`${e} is not an integer.`),e<=0&&it.logWithError(`${e} is not positive.`),qe.set({precision:e+1,rounding:An[n]});let o=new qe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||it.logWithError(`${e} is not an integer.`),e<0&&it.logWithError(`${e} is negative.`),Lt.DP=e,Lt.RM=Sn[n]||1,new Lt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ln=J("Raydium_amount"),Tr=Ue(Pr.default);function Rn(r,e){let t="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([t,n]=o,n=n.padEnd(e,"0")):Ln.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var ge=class extends G{constructor(t,n,o=!0,s){let a=new He.default(0),i=Rt.pow(new He.default(t.decimals));if(o)a=E(n);else{let f=new He.default(0),d=new He.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,u]=Rn(n.toString(),t.decimals);f=E(m),d=E(u)}f=f.mul(i),a=f.add(d)}super(a,i);this.logger=J(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ge(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ge(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return Tr.DP=this.token.decimals,new Tr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var kr=require("@solana/web3.js"),Bt=require("@solana/spl-token"),Ir={chainId:101,address:kr.PublicKey.default.toBase58(),programId:Bt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ie={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Bt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var st=require("@solana/web3.js");var q=require("@solana/web3.js"),Ar=require("@solana/spl-token");function c({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Kt=[c({pubkey:Ar.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:q.SystemProgram.programId,isWritable:!1}),c({pubkey:q.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Ct({publicKey:r,transformSol:e}){let t=Vt(r.toString());if(t instanceof q.PublicKey)return e&&t.equals(ee)?ye:t;if(e&&t.toString()===ee.toBase58())return ye;if(typeof t=="string"){if(t===q.PublicKey.default.toBase58())return q.PublicKey.default;try{return new q.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Vt(r){try{return new q.PublicKey(r)}catch{return r}}var No=new q.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Oo=new q.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Bn=new q.PublicKey("SysvarRent111111111111111111111111111111111"),Wo=new q.PublicKey("SysvarC1ock11111111111111111111111111111111"),Uo=new q.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Kn=new q.PublicKey("Sysvar1nstructions1111111111111111111111111"),Go=q.SystemProgram.programId,qo=new q.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ho=new q.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),jo=new q.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),zo=new q.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Yo=new q.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Jo=new q.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Xo=new q.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Zo=new q.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Qo=new q.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),$o=new q.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ei=new q.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ye=new q.PublicKey("So11111111111111111111111111111111111111112"),ee=q.PublicKey.default;function ot(r){return Ct({publicKey:r,transformSol:!0})}var _t=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:s=!1,isToken2022:a=!1}){if(e===ee.toBase58()||e instanceof st.PublicKey&&ee.equals(e)){this.decimals=ie.decimals,this.symbol=ie.symbol,this.name=ie.name,this.mint=new st.PublicKey(ie.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?st.PublicKey.default:Ct({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Le=_t;Le.WSOL=new _t(Z(H({},ie),{mint:ie.address}));var Ft=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},at=Ft;at.SOL=new Ft(Ir);var Lr=Q(require("bn.js"));var Sr=new G(new Lr.default(100)),_e=class extends G{toSignificant(e=5,t,n){return this.mul(Sr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Sr).toFixed(e,t,n)}};var Cn=J("Raydium_price"),be=class extends G{constructor(t){let{baseToken:n,quoteToken:o,numerator:s,denominator:a}=t;super(s,a);this.baseToken=n,this.quoteToken=o,this.scalar=new G(Mt(n.decimals),Mt(o.decimals))}get raw(){return new G(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new be({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Cn.logWithError("mul token not equals");let n=super.mul(t);return new be({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var Dt=new de.default(0),Ni=new de.default(1),Oi=new de.default(2),Wi=new de.default(3),Ui=new de.default(5),Rt=new de.default(10),Gi=new de.default(100),qi=new de.default(1e3),Hi=new de.default(1e4);function Mt(r){return Rt.pow(E(r))}function St(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var pe=class{constructor(e){this._owner=e}get publicKey(){return pe.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return pe.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return pe.isKeyPair(this._owner)}get isPublicKey(){return pe.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!pe.isKeyPair(e)}};var Cr=require("@solana/web3.js"),Vr=require("@solana/spl-token");var re=require("@solana/web3.js");var j={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Br=require("@solana/spl-token"),Rr=J("Raydium_txUtil"),Kr=1644;function je(r){let e=[],t=[];return r.microLamports&&(e.push(re.ComputeBudgetProgram.setComputeUnitPrice({microLamports:r.microLamports})),t.push(j.SetComputeUnitPrice)),r.units&&(e.push(re.ComputeBudgetProgram.setComputeUnitLimit({units:r.units})),t.push(j.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Re(r,e){var n,o;let t=e!=null?e:"confirmed";return(o=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:o.blockhash}async function ze(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let o=setTimeout(n,6e4);r.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function _n(r,e){r.length<1&&Rr.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Rr.logWithError(`no signers provided:, ${e.toString()}`);let t=new re.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Kr}catch{return!1}}function Be(r,e){let[t,n]=re.PublicKey.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Ye({instructions:r,payer:e,signers:t}){return _n(r,[e,...t])}function he({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=re.Keypair.generate().publicKey.toString()}){let s=new re.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new re.VersionedTransaction(s).serialize()).toString("base64").length<Kr}catch{return!1}}var Fn=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Mn=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof re.VersionedTransaction&&(e=Fn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Pe(r){let e=[];return r.forEach(t=>{t instanceof re.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Br.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=re.Keypair.generate().publicKey)),e.push(Mn(t))}),console.log("simulate tx string:",e),e}function Fe(r,e,t){return Be([r.toBuffer(),(t!=null?t:Vr.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new Cr.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var C=require("@solana/web3.js"),_r=new C.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Fr=new C.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Mr=new C.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Je=new C.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),as=new C.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),us=new C.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),cs=new C.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ls=new C.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ds=new C.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ps=new C.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ms=new C.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),fs=new C.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ys=new C.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),gs=new C.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),bs=new C.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),hs=new C.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ws=new C.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),xs=new C.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ts=new C.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ps=new C.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ks=new C.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Is=new C.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),As=new C.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ss=new C.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ls=new C.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Rs=new C.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Bs=new C.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ks=new C.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Cs=new C.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Vs=new C.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),_s=new C.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ke={OPEN_BOOK_PROGRAM:new C.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new C.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new C.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new C.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new C.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new C.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new C.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new C.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new C.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new C.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new C.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new C.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:C.PublicKey.default,Router:new C.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new C.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new C.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new C.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new C.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new C.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new C.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new C.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new C.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new C.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new C.PublicKey("Ray1111111111111111111111111111111111111111")};var Dn=Q(require("bn.js"));var ue=require("@solana/web3.js");async function ut({connection:r,address:e,cluster:t="mainnet"}){let n=await gr(r,[...new Set(e.map(s=>s.toString()))].map(s=>new ue.PublicKey(s))),o={};for(let s=0;s<e.length;s++){let a=n[s],i=e[s];if(!a)continue;let f=new ue.AddressLookupTableAccount({key:i,state:ue.AddressLookupTableAccount.deserialize(a.data)});o[i.toString()]=f,t==="devnet"?Me[i.toString()]=f:ke[i.toString()]=f}return o}var ke={},Et=async r=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(ke[e])return ke;let t=new ue.PublicKey(e),n=await r.getAccountInfo(t);return n&&(ke[e]=new ue.AddressLookupTableAccount({key:t,state:ue.AddressLookupTableAccount.deserialize(n.data)})),ke},Me={},ct=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Me[e])return Me;let t=new ue.PublicKey(e),n=await r.getAccountInfo(t);return n&&(Me[e]=new ue.AddressLookupTableAccount({key:t,state:ue.AddressLookupTableAccount.deserialize(n.data)})),Me};var v=require("@solana/web3.js"),Dr=Q(require("axios"));var Xe=2e3,Ze=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Dr.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=je(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(v.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new v.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(j.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:a=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...a.filter(i=>i!==v.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(H({},t||{})):this.build(t)}build(e){var n;let t=new v.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var m;let{recentBlockHash:s,skipPreflight:a=!0,sendAndConfirm:i,notSendToRpc:f}=o||{},d=s!=null?s:await Re(this.connection,this.blockhashCommitment);if(t.recentBlockhash=d,this.signers.length&&t.sign(...this.signers),Pe([t]),(m=this.owner)!=null&&m.isKeyPair)return{txId:i?await(0,v.sendAndConfirmTransaction)(this.connection,t,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:a}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);if(this.signers.length)for(let p of u)try{p.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:a}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var d;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:o}=this.build(n),s=t.filter(m=>m.transaction.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(d=this.owner)!=null&&d.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:i,instructionTypes:f,execute:async m=>{var K;let{sequentially:u,onTxUpdate:p,skipTxCount:w=0,recentBlockHash:l,skipPreflight:x=!0}=m||{},y=l!=null?l:await Re(this.connection,this.blockhashCommitment);if((K=this.owner)!=null&&K.isKeyPair){if(u){let S=[],F=0;for(let g of a){if(++F,F<=w)continue;let h=await(0,v.sendAndConfirmTransaction)(this.connection,g,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});S.push(h)}return{txIds:S,signedTxs:a}}return{txIds:await await Promise.all(a.map(async S=>(S.recentBlockhash=y,await this.connection.sendRawTransaction(S.serialize(),{skipPreflight:x})))),signedTxs:a}}if(this.signAllTransactions){let S=a.map((g,h)=>(g.recentBlockhash=y,i[h].length&&g.sign(...i[h]),g));Pe(S);let F=await this.signAllTransactions(S);if(u){let g=0,h=[],b=async()=>{if(!F[g])return;let A=await this.connection.sendRawTransaction(F[g].serialize(),{skipPreflight:x});h.push({txId:A,status:"sent",signedTx:F[g]}),p==null||p([...h]),g++;let k=!1,R=null,B=null,_=P=>{R!==null&&clearInterval(R),B!==null&&this.connection.removeSignatureListener(B);let V=h.findIndex(I=>I.txId===A);if(V>-1){if(h[V].status==="error"||h[V].status==="success")return;h[V].status=P.err?"error":"success"}p==null||p([...h]),P.err||b()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var P;if(k){clearInterval(R);return}try{let V=await this.connection.getTransaction(A,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(k=!0,clearInterval(R),_({err:((P=V.meta)==null?void 0:P.err)||null}),console.log("tx status from getTransaction:",A))}catch(V){k=!0,clearInterval(R),console.error("getTransaction timeout:",V,A)}},Xe)),B=this.connection.onSignature(A,P=>{if(k){this.connection.removeSignatureListener(B);return}k=!0,_(P)},"confirmed"),this.connection.getSignatureStatus(A)};return await b(),{txIds:h.map(A=>A.txId),signedTxs:F}}else{let g=[];for(let h=0;h<F.length;h+=1){let b=await this.connection.sendRawTransaction(F[h].serialize(),{skipPreflight:x});g.push(b)}return{txIds:g,signedTxs:F}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var x;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:s}=l,a=Oe(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=H(H({},this.cluster==="devnet"?await ct(this.connection):await Et(this.connection)),t),f=Array.from(new Set([...n,...this.lookupTableAddress])),d=[];for(let y of f)i[y]===void 0&&d.push(new v.PublicKey(y));let m=await ut({connection:this.connection,address:d});for(let[y,K]of Object.entries(m))i[y]=K;let u=o?v.PublicKey.default.toBase58():s!=null?s:await Re(this.connection,this.blockhashCommitment),p=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:u,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((x=this.owner)==null?void 0:x.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let w=new v.VersionedTransaction(p);return w.sign(this.signers),{builder:this,transaction:w,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var g;let{skipPreflight:K=!0,sendAndConfirm:S,notSendToRpc:F}=y||{};if(Pe([w]),(g=this.owner)!=null&&g.isKeyPair){let h=await this.connection.sendTransaction(w,{skipPreflight:K});return S&&await ze(this.connection,h),{txId:h,signedTx:w}}if(this.signAllTransactions){let h=await this.signAllTransactions([w]);if(this.signers.length)for(let b of h)try{b.sign(this.signers)}catch{}return{txId:F?"":await this.connection.sendTransaction(h[0],{skipPreflight:K}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){var d;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),s=t.filter(m=>m.builder.instructions.length>0),a=[o,...s.map(m=>m.transaction)],i=[this.signers,...s.map(m=>m.signers)],f=[...this.instructionTypes,...s.map(m=>m.instructionTypes).flat()];return(d=this.owner)!=null&&d.signer&&i.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(m,u)=>{m.sign(i[u])}),{builder:this,transactions:a,signers:i,instructionTypes:f,buildProps:n,execute:async m=>{var x;let{sequentially:u,onTxUpdate:p,recentBlockHash:w,skipPreflight:l=!0}=m||{};if(w&&a.forEach(y=>y.message.recentBlockhash=w),Pe(a),(x=this.owner)!=null&&x.isKeyPair){if(u){let y=[];for(let K of a){let S=await this.connection.sendTransaction(K,{skipPreflight:l});await ze(this.connection,S),y.push(S)}return{txIds:y,signedTxs:a}}return{txIds:await Promise.all(a.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:l}))),signedTxs:a}}if(this.signAllTransactions){let y=await this.signAllTransactions(a);if(u){let K=0,S=[],F=async()=>{if(!y[K])return;let g=await this.connection.sendTransaction(y[K],{skipPreflight:l});S.push({txId:g,status:"sent",signedTx:y[K]}),p==null||p([...S]),K++;let h=!1,b=null,A=null,k=R=>{b!==null&&clearInterval(b),A!==null&&this.connection.removeSignatureListener(A);let B=S.findIndex(_=>_.txId===g);if(B>-1){if(S[B].status==="error"||S[B].status==="success")return;S[B].status=R.err?"error":"success"}p==null||p([...S]),R.err||F()};this.loopMultiTxStatus&&(b=setInterval(async()=>{var R;if(h){clearInterval(b);return}try{let B=await this.connection.getTransaction(g,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(h=!0,clearInterval(b),k({err:((R=B.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",g))}catch(B){h=!0,clearInterval(b),console.error("getTransaction timeout:",B,g)}},Xe)),A=this.connection.onSignature(g,R=>{if(h){this.connection.removeSignatureListener(A);return}h=!0,k(R)},"confirmed"),this.connection.getSignatureStatus(g)};return F(),{txIds:[],signedTxs:y}}else{let K=[];for(let S=0;S<y.length;S+=1){let F=await this.connection.sendTransaction(y[S],{skipPreflight:l});K.push(F)}return{txIds:K,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var p;let u=e||{},{splitIns:t=[],computeBudgetConfig:n}=u,o=Oe(u,["splitIns","computeBudgetConfig"]),s=n?je(n):{instructions:[],instructionTypes:[]},a=this.signers.reduce((w,l)=>Z(H({},w),{[l.publicKey.toBase58()]:l}),{}),i=[],f=[],d=[],m=0;if(this.allInstructions.forEach(w=>{let l=[...d,w],x=n?[...s.instructions,...l]:l,K=[...new Set(l.map(S=>S.keys.filter(F=>F.isSigner).map(F=>F.pubkey.toString())).flat()).values()].map(S=>new v.PublicKey(S));if(w!==t[m]&&d.length<12&&(Ye({instructions:x,payer:this.feePayer,signers:K})||Ye({instructions:l,payer:this.feePayer,signers:K})))d.push(w);else{if(d.length===0)throw Error("item ins too big");m+=w===t[m]?1:0,Ye({instructions:n?[...s.instructions,...d]:[...d],payer:this.feePayer,signers:K})?i.push(new v.Transaction().add(...s.instructions,...d)):i.push(new v.Transaction().add(...d)),f.push(Array.from(new Set(d.map(S=>S.keys.filter(F=>F.isSigner).map(F=>F.pubkey.toString())).flat())).map(S=>a[S]).filter(S=>S!==void 0)),d=[w]}}),d.length>0){let l=[...new Set(d.map(x=>x.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(x=>a[x]).filter(x=>x!==void 0);Ye({instructions:n?[...s.instructions,...d]:[...d],payer:this.feePayer,signers:l.map(x=>x.publicKey)})?i.push(new v.Transaction().add(...s.instructions,...d)):i.push(new v.Transaction().add(...d)),f.push(l)}return i.forEach(w=>w.feePayer=this.feePayer),(p=this.owner)!=null&&p.signer&&f.forEach(w=>{w.some(l=>l.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:i,signers:f,instructionTypes:this.instructionTypes,execute:async w=>{var g;let{sequentially:l,onTxUpdate:x,skipTxCount:y=0,recentBlockHash:K,skipPreflight:S=!0}=w||{},F=K!=null?K:await Re(this.connection,this.blockhashCommitment);if(i.forEach(async(h,b)=>{h.recentBlockhash=F,f[b].length&&h.sign(...f[b])}),Pe(i),(g=this.owner)!=null&&g.isKeyPair){if(l){let h=0,b=[];for(let A of i){if(++h,h<=y){b.push("tx skipped");continue}let k=await(0,v.sendAndConfirmTransaction)(this.connection,A,this.signers.find(R=>R.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:S});b.push(k)}return{txIds:b,signedTxs:i}}return{txIds:await Promise.all(i.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:S}))),signedTxs:i}}if(this.signAllTransactions){let h=await this.signAllTransactions(i.slice(y,i.length)),b=[...i.slice(0,y),...h];if(l){let A=0,k=[],R=async()=>{if(!b[A])return;A<y&&(k.push({txId:"",status:"success",signedTx:b[A]}),x==null||x([...k]),A++,R());let B=await this.connection.sendRawTransaction(b[A].serialize(),{skipPreflight:S});k.push({txId:B,status:"sent",signedTx:b[A]}),x==null||x([...k]),A++;let _=!1,P=null,V=null,I=U=>{P!==null&&clearInterval(P),V!==null&&this.connection.removeSignatureListener(V);let O=k.findIndex(ne=>ne.txId===B);if(O>-1){if(k[O].status==="error"||k[O].status==="success")return;k[O].status=U.err?"error":"success"}x==null||x([...k]),U.err||R()};this.loopMultiTxStatus&&(P=setInterval(async()=>{var U;if(_){clearInterval(P);return}try{let O=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(_=!0,clearInterval(P),I({err:((U=O.meta)==null?void 0:U.err)||null}),console.log("tx status from getTransaction:",B))}catch(O){_=!0,clearInterval(P),console.error("getTransaction timeout:",O,B)}},Xe)),V=this.connection.onSignature(B,U=>{if(_){this.connection.removeSignatureListener(V);return}_=!0,I(U)},"confirmed"),this.connection.getSignatureStatus(B)};return await R(),{txIds:k.map(B=>B.txId),signedTxs:b}}else{let A=[];for(let k=0;k<b.length;k+=1){let R=await this.connection.sendRawTransaction(b[k].serialize(),{skipPreflight:S});A.push(R)}return{txIds:A,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var F;let S=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=S,a=Oe(S,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=H(H({},this.cluster==="devnet"?await ct(this.connection):ke),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),d=[];for(let g of f)i[g]===void 0&&d.push(new v.PublicKey(g));let m=await ut({connection:this.connection,address:d});for(let[g,h]of Object.entries(m))i[g]=h;let u=t?je(t):{instructions:[],instructionTypes:[]},p=await Re(this.connection,this.blockhashCommitment),w=this.signers.reduce((g,h)=>Z(H({},g),{[h.publicKey.toBase58()]:h}),{}),l=[],x=[],y=[],K=0;if(this.allInstructions.forEach(g=>{let h=[...y,g],b=t?[...u.instructions,...h]:h;if(g!==n[K]&&y.length<12&&(he({instructions:b,payer:this.feePayer,lookupTableAddressAccount:i})||he({instructions:h,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(g);else{if(y.length===0)throw Error("item ins too big");K+=g===n[K]?1:0;let A={};for(let k of[...new Set(f)])i[k]!==void 0&&(A[k]=i[k]);if(t&&he({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let k=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(k))}else{let k=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(k))}x.push(Array.from(new Set(y.map(k=>k.keys.filter(R=>R.isSigner).map(R=>R.pubkey.toString())).flat())).map(k=>w[k]).filter(k=>k!==void 0)),y=[g]}}),y.length>0){let h=[...new Set(y.map(b=>b.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(b=>w[b]).filter(b=>b!==void 0);if(t&&he({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}else{let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}x.push(h)}return(F=this.owner)!=null&&F.signer&&x.forEach(g=>{g.some(h=>h.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),l.forEach((g,h)=>{g.sign(x[h])}),{builder:this,transactions:l,buildProps:e,signers:x,blockHash:p,instructionTypes:this.instructionTypes,execute:async g=>{var B;let{sequentially:h,onTxUpdate:b,skipTxCount:A=0,recentBlockHash:k,skipPreflight:R=!0}=g||{};if(l.map(async(_,P)=>{x[P].length&&_.sign(x[P]),k&&(_.message.recentBlockhash=k)}),Pe(l),(B=this.owner)!=null&&B.isKeyPair){if(h){let _=0,P=[];for(let V of l){if(++_,_<=A){console.log("skip tx: ",_),P.push("tx skipped");continue}let I=await this.connection.sendTransaction(V,{skipPreflight:R});await ze(this.connection,I),P.push(I)}return{txIds:P,signedTxs:l}}return{txIds:await Promise.all(l.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:R}))),signedTxs:l}}if(this.signAllTransactions){let _=await this.signAllTransactions(l.slice(A,l.length)),P=[...l.slice(0,A),..._];if(h){let V=0,I=[],U=async()=>{if(!P[V])return;if(V<A){I.push({txId:"",status:"success",signedTx:P[V]}),b==null||b([...I]),V++,U();return}let O=await this.connection.sendTransaction(P[V],{skipPreflight:R});I.push({txId:O,status:"sent",signedTx:P[V]}),b==null||b([...I]),V++;let ne=!1,te=null,fe=null,ve=oe=>{te!==null&&clearInterval(te),fe!==null&&this.connection.removeSignatureListener(fe);let $=I.findIndex(Pt=>Pt.txId===O);if($>-1){if(I[$].status==="error"||I[$].status==="success")return;I[$].status=oe.err?"error":"success"}b==null||b([...I]),oe.err||U()};this.loopMultiTxStatus&&(te=setInterval(async()=>{var oe;if(ne){clearInterval(te);return}try{let $=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});$&&(ne=!0,clearInterval(te),ve({err:((oe=$.meta)==null?void 0:oe.err)||null}),console.log("tx status from getTransaction:",O))}catch($){ne=!0,clearInterval(te),console.error("getTransaction timeout:",$,O)}},Xe)),fe=this.connection.onSignature(O,oe=>{if(ne){this.connection.removeSignatureListener(fe);return}ne=!0,ve(oe)},"confirmed"),this.connection.getSignatureStatus(O)};return U(),{txIds:[],signedTxs:P}}else{let V=[];for(let I=0;I<P.length;I+=1){let U=await this.connection.sendTransaction(P[I],{skipPreflight:R});V.push(U)}return{txIds:V,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildSniperTransaction(e){var F;let S=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:s=[]}=S,a=Oe(S,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=H(H({},this.cluster==="devnet"?await ct(this.connection):await Et(this.connection)),o),f=Array.from(new Set([...this.lookupTableAddress,...s])),d=[];for(let g of f)i[g]===void 0&&d.push(new v.PublicKey(g));let m=await ut({connection:this.connection,address:d});for(let[g,h]of Object.entries(m))i[g]=h;let u=t?je(t):{instructions:[],instructionTypes:[]},p=await Re(this.connection,this.blockhashCommitment),w=this.signers.reduce((g,h)=>Z(H({},g),{[h.publicKey.toBase58()]:h}),{}),l=[],x=[],y=[],K=0;if(this.allInstructions.forEach(g=>{let h=[...y,g],b=t?[...u.instructions,...h]:h;if(g!==n[K]&&y.length<12&&(he({instructions:b,payer:this.feePayer,lookupTableAddressAccount:i})||he({instructions:h,payer:this.feePayer,lookupTableAddressAccount:i})))y.push(g);else{if(y.length===0)throw Error("item ins too big");K+=g===n[K]?1:0;let A={};for(let k of[...new Set(f)])i[k]!==void 0&&(A[k]=i[k]);if(t&&he({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let k=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(k))}else{let k=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(k))}x.push(Array.from(new Set(y.map(k=>k.keys.filter(R=>R.isSigner).map(R=>R.pubkey.toString())).flat())).map(k=>w[k]).filter(k=>k!==void 0)),y=[g]}}),y.length>0){let h=[...new Set(y.map(b=>b.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(b=>w[b]).filter(b=>b!==void 0);if(t&&he({instructions:[...u.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:p})){let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...u.instructions,...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}else{let b=new v.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(i));l.push(new v.VersionedTransaction(b))}x.push(h)}return(F=this.owner)!=null&&F.signer&&x.forEach(g=>{g.some(h=>h.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),l.forEach((g,h)=>{g.sign(x[h])}),{builder:this,transactions:l,buildProps:e,signers:x,instructionTypes:this.instructionTypes,execute:async g=>{var B;let{sequentially:h,onTxUpdate:b,skipTxCount:A=0,recentBlockHash:k,skipPreflight:R=!0}=g||{};if(l.map(async(_,P)=>{x[P].length&&_.sign(x[P]),k&&(_.message.recentBlockhash=k)}),Pe(l),(B=this.owner)!=null&&B.isKeyPair){if(h){let _=0,P=[];for(let V of l){if(++_,_<=A){console.log("skip tx: ",_),P.push("tx skipped");continue}let I=await this.connection.sendTransaction(V,{skipPreflight:R});await ze(this.connection,I),P.push(I)}return{txIds:P,signedTxs:l}}return{txIds:await Promise.all(l.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:R}))),signedTxs:l}}if(this.signAllTransactions){let _=await this.signAllTransactions(l.slice(A,l.length)),P=[...l.slice(0,A),..._];if(h){let V=0,I=[],U=async()=>{if(!P[V])return;if(V<A){I.push({txId:"",status:"success",signedTx:P[V]}),b==null||b([...I]),V++,U();return}let O=await this.connection.sendTransaction(P[V],{skipPreflight:R});I.push({txId:O,status:"sent",signedTx:P[V]}),b==null||b([...I]),V++;let ne=!1,te=null,fe=null,ve=oe=>{te!==null&&clearInterval(te),fe!==null&&this.connection.removeSignatureListener(fe);let $=I.findIndex(Pt=>Pt.txId===O);if($>-1){if(I[$].status==="error"||I[$].status==="success")return;I[$].status=oe.err?"error":"success"}b==null||b([...I]),oe.err||U()};this.loopMultiTxStatus&&(te=setInterval(async()=>{var oe;if(ne){clearInterval(te);return}try{let $=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});$&&(ne=!0,clearInterval(te),ve({err:((oe=$.meta)==null?void 0:oe.err)||null}),console.log("tx status from getTransaction:",O))}catch($){ne=!0,clearInterval(te),console.error("getTransaction timeout:",$,O)}},Xe)),fe=this.connection.onSignature(O,oe=>{if(ne){this.connection.removeSignatureListener(fe);return}ne=!0,ve(oe)},"confirmed"),this.connection.getSignatureStatus(O)};return U(),{txIds:[],signedTxs:P}}else{let V=[];for(let I=0;I<P.length;I+=1){let U=await this.connection.sendTransaction(P[I],{skipPreflight:R});V.push(U)}return{txIds:V,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};var Er=require("@solana/web3.js"),vr=Q(require("bn.js"));function vn(r){return typeof r=="object"&&r!==null&&![Le,ge,Er.PublicKey,G,vr.default,be,_e].some(e=>typeof e=="object"&&r instanceof e)}function we(r){return typeof r=="string"?Vt(r):Array.isArray(r)?r.map(e=>we(e)):vn(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,we(t)])):r}var Nr=Q(require("bn.js")),$s=new Nr.default(1e6);var gt=require("@solana/web3.js"),Hn=Q(require("bn.js"));var Xr=require("@solana/spl-token");function Nn(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function vt(r,...e){if(!Nn(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function Nt(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Or(r,e){vt(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var dt=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ce=(r,e)=>r<<32-e|r>>>e;var Pa=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function On(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Ot(r){return typeof r=="string"&&(r=On(r)),vt(r),r}var lt=class{clone(){return this._cloneInto()}},ka={}.toString;function Wr(r){let e=n=>r().update(Ot(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Wn(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),s=BigInt(4294967295),a=Number(t>>o&s),i=Number(t&s),f=n?4:0,d=n?0:4;r.setUint32(e+f,a,n),r.setUint32(e+d,i,n)}var Ur=(r,e,t)=>r&e^~r&t,Gr=(r,e,t)=>r&e^r&t^e&t,pt=class extends lt{constructor(e,t,n,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=dt(this.buffer)}update(e){Nt(this);let{view:t,buffer:n,blockLen:o}=this;e=Ot(e);let s=e.length;for(let a=0;a<s;){let i=Math.min(o-this.pos,s-a);if(i===o){let f=dt(e);for(;o<=s-a;a+=o)this.process(f,a);continue}n.set(e.subarray(a,a+i),this.pos),this.pos+=i,a+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nt(this),Or(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(n,0),a=0);for(let u=a;u<o;u++)t[u]=0;Wn(n,o-8,BigInt(this.length*8),s),this.process(n,0);let i=dt(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let d=f/4,m=this.get();if(d>m.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<d;u++)i.setUint32(4*u,m[u],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:s,destroyed:a,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=a,o%t&&e.buffer.set(n),e}};var Un=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ie=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ae=new Uint32Array(64),Wt=class extends pt{constructor(){super(64,32,8,!1),this.A=Ie[0]|0,this.B=Ie[1]|0,this.C=Ie[2]|0,this.D=Ie[3]|0,this.E=Ie[4]|0,this.F=Ie[5]|0,this.G=Ie[6]|0,this.H=Ie[7]|0}get(){let{A:e,B:t,C:n,D:o,E:s,F:a,G:i,H:f}=this;return[e,t,n,o,s,a,i,f]}set(e,t,n,o,s,a,i,f){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=i|0,this.H=f|0}process(e,t){for(let u=0;u<16;u++,t+=4)Ae[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){let p=Ae[u-15],w=Ae[u-2],l=ce(p,7)^ce(p,18)^p>>>3,x=ce(w,17)^ce(w,19)^w>>>10;Ae[u]=x+Ae[u-7]+l+Ae[u-16]|0}let{A:n,B:o,C:s,D:a,E:i,F:f,G:d,H:m}=this;for(let u=0;u<64;u++){let p=ce(i,6)^ce(i,11)^ce(i,25),w=m+p+Ur(i,f,d)+Un[u]+Ae[u]|0,x=(ce(n,2)^ce(n,13)^ce(n,22))+Gr(n,o,s)|0;m=d,d=f,f=i,i=a+w|0,a=s,s=o,o=n,n=w+x|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,i=i+this.E|0,f=f+this.F|0,d=d+this.G|0,m=m+this.H|0,this.set(n,o,s,a,i,f,d,m)}roundClean(){Ae.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var qr=Wr(()=>new Wt);var Yr=require("@solana/web3.js"),De=Q(require("bn.js"));var M=require("@solana/buffer-layout"),Ut=M.Layout,Hr=M.Structure;var Gt=M.UInt;var jr=M.u8;var zr=M.seq;var Ce=M.blob;var Ee=class extends Ut{constructor(t,n,o){super(t,o);this.blob=Ce(t),this.signed=n}decode(t,n=0){let o=new De.default(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new De.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function X(r){return new Gt(1,r)}function Qe(r){return new Gt(4,r)}function T(r){return new Ee(8,!1,r)}function xe(r){return new Ee(16,!1,r)}function Jr(r){return new Ee(1,!0,r)}function ft(r){return new Ee(8,!0,r)}var mt=class extends Ut{constructor(t,n,o,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function N(r){return new mt(Ce(32),e=>new Yr.PublicKey(e),e=>e.toBuffer(),r)}function yt(r){return new mt(jr(),Gn,qn,r)}function Gn(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function qn(r){return r?1:0}var qt=class extends Hr{decode(e,t){return super.decode(e,t)}};function z(r,e,t){return new qt(r,e,t)}function Y(r,e,t){let n,o=typeof e=="number"?e:(0,De.isBN)(e)?e.toNumber():new Proxy(e,{get(s,a){if(!n){let i=Reflect.get(s,"count");n=(0,De.isBN)(i)?i.toNumber():i,Reflect.set(s,"count",n)}return Reflect.get(s,a)},set(s,a,i){return a==="count"&&(n=i),Reflect.set(s,a,i)}});return zr(r,o,t)}var $e=z([N("mint"),N("owner"),T("amount"),Qe("delegateOption"),N("delegate"),X("state"),Qe("isNativeOption"),T("isNative"),T("delegatedAmount"),Qe("closeAuthorityOption"),N("closeAuthority")]);var Ja=J("Raydium_Util");function bt({fromPublicKey:r,programId:e=Xr.TOKEN_PROGRAM_ID,assignSeed:t}){let n=t?btoa(t).slice(0,32):gt.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:jn(r,n,e),seed:n}}function jn(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),o=qr(n);return new gt.PublicKey(o)}var mn=Q(require("decimal.js"));var ht=require("@solana/web3.js"),Zr=Q(require("bn.js"));var le=require("@solana/spl-token");function zn(r){let{mint:e,tokenAccount:t,owner:n,programId:o=le.TOKEN_PROGRAM_ID}=r;return(0,le.createInitializeAccountInstruction)(t,e,n,o)}function Yn(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:o,programId:s=le.TOKEN_PROGRAM_ID}=r;return(0,le.createCloseAccountInstruction)(e,t,o,n,s)}async function Ht(r){let{connection:e,amount:t,commitment:n,payer:o,owner:s,skipCloseAccount:a}=r,i=await e.getMinimumBalanceForRentExemption($e.span,n),f=E(t).add(new Zr.default(i)),d=bt({fromPublicKey:o,programId:le.TOKEN_PROGRAM_ID});return{addresses:{newAccount:d.publicKey},signers:[],instructions:[ht.SystemProgram.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:d.seed,newAccountPubkey:d.publicKey,lamports:f.toNumber(),space:$e.span,programId:le.TOKEN_PROGRAM_ID}),zn({mint:new ht.PublicKey(ie.address),tokenAccount:d.publicKey,owner:s,programId:le.TOKEN_PROGRAM_ID})],instructionTypes:[j.CreateAccount,j.InitAccount],endInstructionTypes:a?[]:[j.CloseAccount],endInstructions:a?[]:[Yn({tokenAccount:d.publicKey,payer:o,owner:s})]}}var jt=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),et=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=J(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ze({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new pe(e);return new Ze({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(jt(e))}logInfo(...e){this.logger.info(jt(e))}logAndCreateError(...e){let t=jt(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var xt=require("@solana/web3.js");var zt=z([X("instruction")]),Yt=z([X("instruction")]),Jn=z([T("rewardState"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardLastUpdateTime"),T("totalReward"),T("totalRewardEmissioned"),T("rewardClaimed"),T("rewardPerSecond"),xe("accRewardPerShare"),N("rewardVault"),N("rewardMint"),N("rewardSender"),T("rewardType"),Y(T(),15,"padding")]),Xn=z([T("state"),T("nonce"),N("lpVault"),N("rewardVault"),N(),N(),T(),T(),T("totalReward"),xe("perShareReward"),T("lastSlot"),T("perSlotReward")]),Zn=z([T("state"),T("nonce"),N("lpVault"),N("rewardVaultA"),T("totalRewardA"),xe("perShareRewardA"),T("perSlotRewardA"),X("option"),N("rewardVaultB"),Ce(7),T("totalRewardB"),xe("perShareRewardB"),T("perSlotRewardB"),T("lastSlot"),N()]),Qn=z([T(),T("state"),T("nonce"),T("validRewardTokenNum"),xe("rewardMultiplier"),T("rewardPeriodMax"),T("rewardPeriodMin"),T("rewardPeriodExtend"),N("lpMint"),N("lpVault"),Y(Jn,5,"rewardInfos"),N("creator"),N(),Y(T(),32,"padding")]),$n=new Proxy(Xn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Z(H({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,e,t)}}),eo=new Proxy(Zn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Z(H({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,e,t)}}),wt=new Proxy(Qn,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return Z(H({},o),{version:6,rewardInfos:o.rewardInfos.map(s=>{var a;return Z(H({},s),{rewardType:((a=Object.entries(Se).find(i=>String(i[1])===s.rewardType.toString()))!=null?a:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),to=z([T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),Jt=z([X("instruction"),T("nonce"),Y(to,5,"rewardTimeInfo")]),Xt=z([X("instruction"),T("rewardReopenTime"),T("rewardEndTime"),T("rewardPerSecond")]),Zt=z([X("instruction"),T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),hu=z([T("state"),N("id"),N("owner"),T("deposited"),Y(T(),1,"rewardDebts")]),Qt=z([T("state"),N("id"),N("owner"),T("deposited"),Y(xe(),1,"rewardDebts"),T(""),T("voteLockedBalance"),Y(T(),15)]),wu=z([T("state"),N("id"),N("owner"),T("deposited"),Y(T(),2,"rewardDebts")]),Qr=z([T("state"),N("id"),N("owner"),T("deposited"),Y(xe(),2,"rewardDebts"),Y(T(),17)]),$r=z([T(),T("state"),N("id"),N("owner"),T("deposited"),Y(xe(),5,"rewardDebts"),Y(T(),16)]),se=z([X("instruction"),T("amount")]),ro=z([N("mint"),N("grantAuthority"),T("baselineVoteWeightScaledFactor"),T("maxExtraLockupVoteWeightScaledFactor"),T("lockupSaturationSecs"),Jr("digitShift"),Y(X(),7,"reserved1"),Y(T(),7,"reserved2")]),no=z([Ce(8),N("governanceProgramId"),N("realm"),N("realmGoverningTokenMint"),N("realmAuthority"),Y(X(),32,"reserved1"),Y(ro,4,"votingMints"),ft("timeOffset"),X("bump"),Y(X(),7,"reserved2"),Y(T(),11,"reserved3")]),oo=z([ft("startTime"),ft("endTime"),X("kind"),Y(X(),15,"reserved")]),io=z([Y(oo,1,"lockup"),T("amountDeposited_native"),T("amountInitiallyLockedNative"),yt("isUsed"),yt("allowClawback"),X("votingMintConfigIdx"),Y(X(),29,"reserved")]),so=z([Ce(8),N("voterAuthority"),N("registrar"),Y(io,32,"deposits"),X("voterBump"),X("voterWweightRecordBump"),Y(X(),94,"reserved")]);var ao=require("@solana/spl-token"),Su=J("Raydium_farm_config"),en=new xt.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),tn=new xt.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Lu=new xt.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX");var rn={3:Qt,5:Qr,6:$r},$t=r=>[3,4,5,6].indexOf(r)!==-1,er=r=>{var a;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=r,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,s={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(a=s[e])==null?void 0:a.call(s)},Se={"Standard SPL":0,"Option tokens":1},Te={[_r.toString()]:3,[Fr.toString()]:4,[Mr.toString()]:5,[Je.toString()]:6,[Ke.FARM_PROGRAM_ID_V3.toString()]:3,[Ke.FARM_PROGRAM_ID_V4.toString()]:4,[Ke.FARM_PROGRAM_ID_V5.toString()]:5,[Ke.FARM_PROGRAM_ID_V6.toString()]:6};var L=require("@solana/web3.js"),nr=Q(require("bn.js")),ae=require("@solana/spl-token");var nn=Q(require("bn.js"));var uo=J("Raydium.farm.util");function tt({programId:r,poolId:e,mint:t,type:n}){let{publicKey:o}=Be([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function me({programId:r,poolId:e,owner:t,version:n}){let{publicKey:o}=Be([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var on=({programId:r,poolId:e})=>Be([e.toBuffer()],r);function sn(r){return{isSet:new nn.default(1),rewardPerSecond:E(r.perSecond),rewardOpenTime:E(r.openTime),rewardEndTime:E(r.endTime),rewardType:E(Se[r.rewardType])}}function tr(r){return E(r.endTime).sub(E(r.openTime)).mul(E(r.perSecond))}function rr(r){let e=rn[r];return e||uo.logWithError("invalid version",r),e}var co=J("Raydium_farm_instruction"),pc={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function or(r){let{version:e,id:t,ledger:n,programId:o,owner:s}=r,a={3:9,5:10}[e];a||co.logWithError(`invalid farm pool version: ${e}`);let i=Buffer.alloc(zt.span);zt.encode({instruction:a},i);let f=[c({pubkey:t}),c({pubkey:n}),c({pubkey:s,isWritable:!1}),c({pubkey:L.SystemProgram.programId,isWritable:!1}),c({pubkey:L.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new L.TransactionInstruction({programId:o,keys:f,data:i}),instructionType:j.FarmV3CreateLedger}}function an(r){var n;let e=Buffer.alloc(Jt.span);Jt.encode({instruction:0,nonce:new nr.default(r.nonce),rewardTimeInfo:r.rewardInfoConfig},e);let t=[...Kt,c({pubkey:r.farmId}),c({pubkey:r.farmAuthority,isWritable:!1}),c({pubkey:r.lpVault}),c({pubkey:r.lpMint,isWritable:!1}),c({pubkey:r.lockVault}),c({pubkey:r.lockMint,isWritable:!1}),c({pubkey:(n=r.lockUserAccount)!=null?n:ee}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let o of r.rewardInfo)t.push(c({pubkey:o.rewardMint,isWritable:!1}),c({pubkey:o.rewardVault}),c({pubkey:o.userRewardToken}));return{instruction:new L.TransactionInstruction({programId:r.programId,keys:t,data:e}),instructionType:j.FarmV6Create}}function un(r){let e=Buffer.alloc(Yt.span);Yt.encode({instruction:5},e);let t=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:r.id}),c({pubkey:r.authority,isWritable:!1}),c({pubkey:r.lpVault,isWritable:!1}),c({pubkey:r.rewardVault}),c({pubkey:r.userRewardToken}),c({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new L.TransactionInstruction({programId:r.programId,keys:t,data:e}),instructionType:j.FarmV6CreatorWithdraw}}function ir({payer:r,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:o}){let s=Buffer.alloc(Xt.span);Xt.encode({instruction:3,rewardReopenTime:E(o.openTime),rewardEndTime:E(o.endTime),rewardPerSecond:E(o.perSecond)},s);let a=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:n.id}),c({pubkey:n.lpVault,isWritable:!1}),c({pubkey:e}),c({pubkey:t}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new L.TransactionInstruction({programId:n.programId,keys:a,data:s})}function sr({payer:r,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:o}){let s=Buffer.alloc(Zt.span);Zt.encode({instruction:4,isSet:new nr.default(1),rewardPerSecond:E(o.perSecond),rewardOpenTime:E(o.openTime),rewardEndTime:E(o.endTime),rewardType:E(Se[o.rewardType])},s);let a=[...Kt,c({pubkey:t.id}),c({pubkey:t.authority,isWritable:!1}),c({pubkey:o.mint,isWritable:!1}),c({pubkey:n}),c({pubkey:e}),c({pubkey:r,isWritable:!1,isSigner:!0})];return new L.TransactionInstruction({programId:t.programId,keys:a,data:s})}function ar(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],d=me({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(se.span);se.encode({instruction:2,amount:E(a)},m);let u=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:f}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:d}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)u.push(c({pubkey:new L.PublicKey(t.rewardInfos[p].vault)})),u.push(c({pubkey:o[p]}));return new L.TransactionInstruction({programId:i,keys:u,data:m})}function ur(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:5}),u=Buffer.alloc(se.span);se.encode({instruction:12,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];for(let w=1;w<t.rewardInfos.length;w++)p.push(c({pubkey:o[w]})),p.push(c({pubkey:new L.PublicKey(t.rewardInfos[w].vault)}));if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function cn(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=z([X("instruction"),T("amount")]),u=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:i[0]}),c({pubkey:s,isSigner:!0,isWritable:!1}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:o[1]}),c({pubkey:new L.PublicKey(t.rewardInfos[1].vault)})],p=Buffer.alloc(m.span);return m.encode({instruction:2,amount:a},p),new L.TransactionInstruction({keys:u,programId:f,data:p})}function cr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:3}),u=Buffer.alloc(se.span);se.encode({instruction:11,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function ln(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:3}),u=Buffer.alloc(se.span);se.encode({instruction:10,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function dn(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a,userAuxiliaryLedgers:i}=r,[f,d]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],m=me({programId:f,poolId:d,owner:s,version:5}),u=Buffer.alloc(se.span);se.encode({instruction:11,amount:E(a)},u);let p=[c({pubkey:d}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:m}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:o[0]}),c({pubkey:new L.PublicKey(t.rewardInfos[0].vault)}),c({pubkey:L.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1})];for(let w=1;w<t.rewardInfos.length;w++)p.push(c({pubkey:o[w]})),p.push(c({pubkey:new L.PublicKey(t.rewardInfos[w].vault)}));if(i)for(let w of i)p.push(c({pubkey:w}));return new L.TransactionInstruction({programId:f,keys:p,data:u})}function pn(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:o,owner:s,amount:a}=r,[i,f]=[new L.PublicKey(e.programId),new L.PublicKey(e.id)],d=me({programId:i,poolId:f,owner:s,version:6}),m=Buffer.alloc(se.span);se.encode({instruction:1,amount:E(a)},m);let u=[c({pubkey:ae.TOKEN_PROGRAM_ID,isWritable:!1}),c({pubkey:L.SystemProgram.programId,isWritable:!1}),c({pubkey:f}),c({pubkey:new L.PublicKey(t.authority),isWritable:!1}),c({pubkey:new L.PublicKey(t.lpVault)}),c({pubkey:d}),c({pubkey:s,isWritable:!1,isSigner:!0}),c({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)u.push(c({pubkey:new L.PublicKey(t.rewardInfos[p].vault)})),u.push(c({pubkey:o[p]}));return new L.TransactionInstruction({programId:i,keys:u,data:m})}var Tt=class extends et{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(ee)){let n=await Ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:tr(Z(H({},t),{openTime:t.openTime.toString(),endTime:t.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:o=Je,txVersion:s,feePayer:a,lockProgram:i}){var A,k;this.checkDisabled(),this.scope.checkOwner();let d={lpMint:new W.PublicKey(e.lpMint.address),lockInfo:{lockMint:(A=i==null?void 0:i.mint)!=null?A:en,lockVault:(k=i==null?void 0:i.vault)!=null?k:tn},version:6,rewardInfos:t,programId:o},m=this.createTxBuilder(a),u=n!=null?n:this.scope.ownerPubKey,p=bt({fromPublicKey:u,programId:d.programId}),w=await this.scope.connection.getMinimumBalanceForRentExemption(wt.span);m.addInstruction({instructions:[W.SystemProgram.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:p.seed,newAccountPubkey:p.publicKey,lamports:w,space:wt.span,programId:d.programId})]});let{publicKey:l,nonce:x}=on({programId:new W.PublicKey(d.programId),poolId:p.publicKey}),y=tt({programId:d.programId,poolId:p.publicKey,mint:d.lpMint,type:"lpVault"}),K=[],S=[];for(let R of d.rewardInfos){R.openTime>=R.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",R.openTime.toString()),isNaN(Se[R.rewardType])&&this.logAndCreateError("rewardType error",R.rewardType),Number(R.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",R.perSecond),K.push(sn(R));let{rewardPubKey:B,newInstruction:_}=await this._getUserRewardInfo({rewardInfo:R,payer:u});_&&m.addInstruction(_),B||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let P=R.mint.equals(ee)?new W.PublicKey(ie.address):R.mint;S.push({rewardMint:P,rewardVault:tt({programId:d.programId,poolId:p.publicKey,mint:P,type:"rewardVault"}),userRewardToken:B})}let{account:F,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({mint:new W.PublicKey(d.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});g&&m.addInstruction(g),F||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:h,instructionType:b}=an({farmId:p.publicKey,owner:this.scope.ownerPubKey,farmAuthority:l,lpVault:y,lpMint:d.lpMint,lockVault:d.lockInfo.lockVault,lockMint:d.lockInfo.lockMint,lockUserAccount:F,programId:d.programId,rewardInfo:S,rewardInfoConfig:K,nonce:x});return m.addInstruction({instructions:[h],instructionTypes:[b]}).versionBuild({txVersion:s,extInfo:{farmId:p.publicKey,farmAuthority:l,lpVault:y,lockUserAccount:F,nonce:x}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:o,feePayer:s}){var K;let a=Te[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=we((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let d=t||this.scope.ownerPubKey,m=n.mint.equals(ee)?new W.PublicKey(ie.address):n.mint,u=f.rewardInfos.findIndex(S=>new W.PublicKey(S.mint.address).equals(m)),p=i.rewardInfos[u];p||this.logAndCreateError("configuration does not exist","rewardMint",m);let w=(K=p.vault)!=null?K:ee,l=this.createTxBuilder(s),{rewardPubKey:x,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:n,payer:d});return y&&l.addInstruction(y),x||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),l.addInstruction({instructions:[ir({payer:this.scope.ownerPubKey,rewardVault:w,userRewardTokenPub:x,farmKeys:f,rewardInfo:n})],instructionTypes:[j.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:o,feePayer:s}){var u;let a=Te[e.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let i=we((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f={id:i.id,rewardInfos:e.rewardInfos,lpVault:i.lpVault,programId:i.programId};n.forEach(p=>{p.openTime>=p.endTime&&this.logAndCreateError("start time error","newRewardInfo",p)});let d=t||this.scope.ownerPubKey,m=this.createTxBuilder(s);for(let p of n){let w=p.mint.equals(ee)?new W.PublicKey(ie.address):p.mint,l=f.rewardInfos.findIndex(g=>new W.PublicKey(g.mint.address).equals(w)),x=i.rewardInfos[l];x||this.logAndCreateError("configuration does not exist","rewardMint",w);let y=(u=x.vault)!=null?u:ee,{rewardPubKey:K,newInstruction:S}=await this._getUserRewardInfo({rewardInfo:p,payer:d});S&&m.addInstruction(S),K||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let F=ir({payer:this.scope.ownerPubKey,rewardVault:y,userRewardTokenPub:K,farmKeys:f,rewardInfo:p});m.addInstruction({instructions:[F],instructionTypes:[j.FarmV6Restart]})}return m.versionBuild({txVersion:o})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:o,payer:s,feePayer:a}=e,i=Te[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=we((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),d=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a),u=o.mint.equals(ee)?new W.PublicKey(ie.address):o.mint,p=tt({programId:new W.PublicKey(n.programId),poolId:new W.PublicKey(n.id),mint:u,type:"rewardVault"}),{rewardPubKey:w,newInstruction:l}=await this._getUserRewardInfo({rewardInfo:o,payer:d});return l&&m.addInstruction(l),w||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=u,m.addInstruction({instructions:[sr({payer:this.scope.ownerPubKey,userRewardTokenPub:w,farmKeys:f,rewardVault:p,rewardInfo:o})],instructionTypes:[j.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:o,payer:s,feePayer:a}=e,i=Te[n.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let f=we((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),d=s!=null?s:this.scope.ownerPubKey,m=this.createTxBuilder(a);for(let u of o){let p=u.mint.equals(ee)?new W.PublicKey(ie.address):u.mint,w=tt({programId:new W.PublicKey(n.programId),poolId:new W.PublicKey(n.id),mint:p,type:"rewardVault"}),{rewardPubKey:l,newInstruction:x}=await this._getUserRewardInfo({rewardInfo:u,payer:d});x&&m.addInstruction(x),l||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let y=sr({payer:this.scope.ownerPubKey,userRewardTokenPub:l,farmKeys:f,rewardVault:w,rewardInfo:Z(H({},u),{mint:p})});m.addInstruction({instructions:[y],instructionTypes:[j.FarmV6CreatorAddReward]})}return m.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:o,feePayer:s,useSOLBalance:a,associatedOnly:i=!0,checkCreateATAOwner:f=!1,userAuxiliaryLedgers:d,computeBudgetConfig:m,txTipConfig:u}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:p,programId:w}=n,l=Te[w];l===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),$t(l)||this.logAndCreateError("invalid farm program:",n.programId);let[x,y]=[new W.PublicKey(n.programId),new W.PublicKey(n.id)],K=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],S=me({programId:x,poolId:y,owner:this.scope.ownerPubKey,version:l}),F=this.createTxBuilder(s);F.addCustomComputeBudget(m),F.addTipInstruction(u);let g={};for(let I of this.scope.account.tokenAccounts)if(i){let U=Fe(this.scope.ownerPubKey,I.mint,I.programId).publicKey;I.publicKey&&U.equals(I.publicKey)&&(g[I.mint.toString()]=I.publicKey)}else g[I.mint.toString()]=I.publicKey;let h=K.lpMint,b=g[h.address];b||this.logAndCreateError("you don't have any lp","lp zero",g);let A=[];for(let I of p){let U=a&&I.mint.address===ye.toString(),O=g[I.mint.address];if(!O){let{account:ne,instructionParams:te}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:I.mint.programId,mint:new W.PublicKey(I.mint.address),notUseTokenAccount:U,createInfo:{payer:s||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!U,associatedOnly:U?!1:i,checkCreateATAOwner:f});O=ne,te&&F.addInstruction(te)}g[I.mint.address]=O,A.push(O)}let k,R=await this.scope.connection.getAccountInfo(S);if(R&&(k=rr(l).decode(R.data)),n.programId!==Je.toString()&&n.programId!==Ke.FARM_PROGRAM_ID_V6.toString()&&!k){let{instruction:I,instructionType:U}=or({id:y,programId:x,version:l,ledger:S,owner:this.scope.ownerPubKey});F.addInstruction({instructions:[I],instructionTypes:[U]})}let B=er({version:l,rewardInfos:p,rewardTokenAccountsPublicKeys:A});B&&this.logAndCreateError(B);let _={amount:E(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:K,lpAccount:b,rewardAccounts:A,userAuxiliaryLedgers:d==null?void 0:d.map(I=>new W.PublicKey(I))},P=l===6?pn(_):l===5?dn(_):ln(_),V={3:j.FarmV3Deposit,5:j.FarmV5Deposit,6:j.FarmV6Deposit};return F.addInstruction({instructions:[P],instructionTypes:[V[l]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:o,deposited:s,useSOLBalance:a,feePayer:i,associatedOnly:f=!0,checkCreateATAOwner:d=!1,userAuxiliaryLedgers:m,computeBudgetConfig:u,txTipConfig:p}=e,{rewardInfos:w}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let l=Te[n.programId];$t(l)||this.logAndCreateError("invalid farm program:",n.programId);let x=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],y=this.createTxBuilder(i);y.addCustomComputeBudget(u),y.addTipInstruction(p);let K={};for(let B of this.scope.account.tokenAccounts)if(f){let _=Fe(this.scope.ownerPubKey,B.mint).publicKey;B.publicKey&&_.equals(B.publicKey)&&(K[B.mint.toString()]=B.publicKey)}else K[B.mint.toString()]=B.publicKey;if(l!==4){let B=me({programId:new W.PublicKey(n.programId),poolId:new W.PublicKey(n.id),owner:this.scope.ownerPubKey,version:l}),_=await this.scope.connection.getAccountInfo(B);if(_)rr(l).decode(_.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(l!==6){let{instruction:P,instructionType:V}=or({id:new W.PublicKey(x.id),programId:new W.PublicKey(x.programId),version:l,ledger:B,owner:this.scope.ownerPubKey});y.addInstruction({instructions:[P],instructionTypes:[V]})}}s&&s.isZero()&&!(m||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let S=x.lpMint.address,F=a&&S===ye.toString(),g=K[S.toString()];if(!g){let{account:B,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:x.lpMint.programId,mint:new W.PublicKey(S),notUseTokenAccount:F,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:F?!1:f,checkCreateATAOwner:d});g=B,_&&y.addInstruction(_)}K[S.toString()]=g;let h=[];for(let B of w){let _=a&&B.mint.address===ye.toString(),P=K[B.mint.address];if(!P){let{account:V,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:B.mint.programId,mint:new W.PublicKey(B.mint.address),notUseTokenAccount:_,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!_,associatedOnly:_?!1:f,checkCreateATAOwner:d});P=V,I&&y.addInstruction(I)}K[B.mint.address]=P,h.push(P)}let b=er({version:l,rewardInfos:w,rewardTokenAccountsPublicKeys:h});b&&this.logAndCreateError(b);let A={amount:E(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:x,lpAccount:g,rewardAccounts:h,userAuxiliaryLedgers:m==null?void 0:m.map(B=>new W.PublicKey(B))},k=l===6?ar(A):l===5?ur(A):l===4?cn(A):cr(A),R={3:j.FarmV3Withdraw,4:j.FarmV4Withdraw,5:j.FarmV5Withdraw,6:j.FarmV6Withdraw};return y.addInstruction({instructions:[k],instructionTypes:[R[l]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){var x;this.scope.checkOwner();let i=we((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),f=Te[e.programId];f!==6&&this.logAndCreateError("invalid farm version",f);let d=i.rewardInfos.find(y=>ot(y.mint.address).equals(ot(t)));d||this.logAndCreateError("withdraw mint error","rewardInfos",e);let m=(x=d==null?void 0:d.vault)!=null?x:ee,u=this.createTxBuilder(a),p;if(t.equals(ee)||t.equals(W.PublicKey.default)){let y=await Ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:tr(Z(H({},d),{openTime:d.openTime,endTime:d.endTime,perSecond:new mn.default(d.perSecond).mul(10**d.mint.decimals).toString()}))});p=y.addresses.newAccount,u.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(p=await this.scope.account.getAssociatedTokenAccount(t),u.addInstruction({instructions:[(0,lr.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,p,this.scope.ownerPubKey,t)],instructionTypes:[j.CreateATA]})):p=y}let{instruction:w,instructionType:l}=un({programId:i.programId,id:i.id,authority:i.authority,lpVault:i.lpVault,rewardVault:m,userRewardToken:p,owner:this.scope.ownerPubKey});return u.addCustomComputeBudget(o),u.addTipInstruction(s),u.addInstruction({instructions:[w],instructionTypes:[l]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:o,associatedOnly:s=!0,checkCreateATAOwner:a=!1,userAuxiliaryLedgers:i,txVersion:f,computeBudgetConfig:d}=e,m=this.createTxBuilder(o),u={};for(let l of this.scope.account.tokenAccounts)if(s){let x=Fe(this.scope.ownerPubKey,l.mint).publicKey;l.publicKey&&x.equals(l.publicKey)&&(u[l.mint.toString()]=l.publicKey)}else u[l.mint.toString()]=l.publicKey;let w=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(l=>l.id).join(",")})).reduce((l,x)=>Z(H({},l),{[x.id]:x}),{});for(let l of Object.values(t)){let{programId:x,lpMint:y,rewardInfos:K,id:S}=l,F=Te[x],g=y.address,h=n&&g===ye.toString(),b=u[g];if(!b){let{account:P,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.programId,mint:new W.PublicKey(g),notUseTokenAccount:h,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:h?!1:s,checkCreateATAOwner:a});b=P,V&&m.addInstruction(V)}u[g.toString()]=b;let A=[];for(let P of K){let V=n&&P.mint.address===ye.toString(),I=u[P.mint.address];if(!I)if(V){let{account:U,instructionParams:O}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:P.mint.programId,mint:new W.PublicKey(P.mint.address),notUseTokenAccount:V,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!V,associatedOnly:V?!1:s,checkCreateATAOwner:a});I=U,O&&m.addInstruction(O)}else{let U=new W.PublicKey(P.mint.address);I=this.scope.account.getAssociatedTokenAccount(U),m.addInstruction({instructions:[(0,lr.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,I,this.scope.ownerPubKey,U)]})}u[P.mint.address]=I,A.push(I)}let k=w[S],R={amount:Dt,owner:this.scope.ownerPubKey,farmInfo:l,farmKeys:k,lpAccount:b,rewardAccounts:A,userAuxiliaryLedgers:i==null?void 0:i.map(P=>new W.PublicKey(P))},B=F===6?ar(R):F===5?ur(R):cr(R),_={3:j.FarmV3Withdraw,5:j.FarmV5Withdraw,6:j.FarmV6Withdraw};m.addInstruction({instructions:[B],instructionTypes:[_[F]]})}return f===1?m.sizeCheckBuild({computeBudgetConfig:d}):m.sizeCheckBuildV0({computeBudgetConfig:d})}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.js.map