var It=Object.create;var Y=Object.defineProperty,kt=Object.defineProperties,_t=Object.getOwnPropertyDescriptor,Ct=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertyNames,Ce=Object.getOwnPropertySymbols,Vt=Object.getPrototypeOf,Ve=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable;var Fe=(n,e,t)=>e in n?Y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,S=(n,e)=>{for(var t in e||(e={}))Ve.call(e,t)&&Fe(n,t,e[t]);if(Ce)for(var t of Ce(e))Mt.call(e,t)&&Fe(n,t,e[t]);return n},I=(n,e)=>kt(n,Ct(e));var Dt=(n,e)=>{for(var t in e)Y(n,t,{get:e[t],enumerable:!0})},Me=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ft(e))!Ve.call(n,o)&&o!==t&&Y(n,o,{get:()=>e[o],enumerable:!(r=_t(e,o))||r.enumerable});return n};var B=(n,e,t)=>(t=n!=null?It(Vt(n)):{},Me(e||!n||!n.__esModule?Y(t,"default",{value:n,enumerable:!0}):t,n)),Nt=n=>Me(Y({},"__esModule",{value:!0}),n);var wn={};Dt(wn,{calFarmRewardAmount:()=>gn,farmRewardInfoToConfig:()=>fn,fetchMultipleFarmInfoAndUpdate:()=>yn,getAssociatedAuthority:()=>pn,getAssociatedLedgerAccount:()=>St,getAssociatedLedgerPoolAccount:()=>mn,getDepositEntryIndex:()=>bn,getFarmLedgerLayout:()=>Lt,getFarmStateLayout:()=>At,judgeFarmType:()=>hn,updateFarmPoolInfo:()=>Bt});module.exports=Nt(wn);var R=B(require("bn.js"));var Ne=require("@solana/web3.js");var J=require("lodash");var fe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},De={},Et={};function L(n){let e=(0,J.get)(De,n);if(!e){let t=(0,J.get)(Et,n);e=new fe({name:n,logLevel:t}),(0,J.set)(De,n,e)}return e}var oe=require("@solana/spl-token"),ge=L("Raydium_accountInfo_util");async function Ee(n,e,t){let{batchRequest:r,commitment:o="confirmed",chunkCount:c=100}=S({batchRequest:!1},t),d=ye(e,c),f=new Array(d.length).fill([]);if(r){let x=d.map(k=>{let P=n._buildArgs([k.map(g=>g.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:P}}),b=ye(x,10);f=(await(await Promise.all(b.map(async k=>await n._rpcBatchRequest(k)))).flat()).map(k=>(k.error&&ge.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${k.error.message}`),k.result.value.map(P=>{if(P){let{data:g,executable:V,lamports:z,owner:A,rentEpoch:_}=P;return g.length!==2&&g[1]!=="base64"&&ge.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(g[0],"base64"),executable:V,lamports:z,owner:new Ne.PublicKey(A),rentEpoch:_}}return null})))}else try{f=await Promise.all(d.map(x=>n.getMultipleAccountsInfo(x,o)))}catch(x){x instanceof Error&&ge.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${x.message}`)}return f.flat()}async function ve(n,e,t){let r=await Ee(n,e.map(o=>o.pubkey),t);return e.map((o,c)=>I(S({},o),{accountInfo:r[c]}))}var C=B(require("bn.js")),jt=B(require("decimal.js"));var Ge=B(require("big.js")),$=B(require("bn.js"));var Oe=B(require("toformat")),vt=Oe.default,X=vt;var Z=B(require("big.js")),We=B(require("bn.js")),Ue=B(require("decimal.js-light"));var U=B(require("bn.js"));var Ke=9007199254740991;function w(n){let e=L("Raydium_parseBigNumberish");if(n instanceof U.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new U.default(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=Ke||n<=-Ke)&&e.logWithError(`BigNumberish number overflow: ${n}`),new U.default(String(n))):typeof n=="bigint"?new U.default(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new U.default(0))}var ie=L("module/fraction"),be=X(Z.default),Q=X(Ue.default),Kt={[0]:Q.ROUND_DOWN,[1]:Q.ROUND_HALF_UP,[2]:Q.ROUND_UP},Wt={[0]:Z.default.roundDown,[1]:Z.default.roundHalfUp,[2]:Z.default.roundUp},m=class{constructor(e,t=new We.default(1)){this.numerator=w(e),this.denominator=w(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new m(this.denominator,this.numerator)}add(e){let t=e instanceof m?e:new m(w(e));return this.denominator.eq(t.denominator)?new m(this.numerator.add(t.numerator),this.denominator):new m(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof m?e:new m(w(e));return this.denominator.eq(t.denominator)?new m(this.numerator.sub(t.numerator),this.denominator):new m(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof m?e:new m(w(e));return new m(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof m?e:new m(w(e));return new m(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||ie.logWithError(`${e} is not an integer.`),e<=0&&ie.logWithError(`${e} is not positive.`),Q.set({precision:e+1,rounding:Kt[r]});let o=new Q(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||ie.logWithError(`${e} is not an integer.`),e<0&&ie.logWithError(`${e} is negative.`),be.DP=e,be.RM=Wt[r]||1,new be(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ut=L("Raydium_amount"),qe=X(Ge.default);function qt(n,e){let t="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([t,r]=o,r=r.padEnd(e,"0")):Ut.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var M=class extends m{constructor(t,r,o=!0,c){let d=new $.default(0),f=we.pow(new $.default(t.decimals));if(o)d=w(r);else{let x=new $.default(0),b=new $.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[F,k]=qt(r.toString(),t.decimals);x=w(F),b=w(k)}x=x.mul(f),d=x.add(b)}super(d,f);this.logger=L(c||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new M(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new M(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,o=0){return super.toSignificant(t,r,o)}toFixed(t=this.token.decimals,r,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,o)}toExact(t={groupSeparator:""}){return qe.DP=this.token.decimals,new qe(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var He=require("@solana/web3.js"),Te=require("@solana/spl-token"),je={chainId:101,address:He.PublicKey.default.toBase58(),programId:Te.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},v={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Te.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var se=require("@solana/web3.js");var p=require("@solana/web3.js"),ze=require("@solana/spl-token");function xe({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Jn=[xe({pubkey:ze.TOKEN_PROGRAM_ID,isWritable:!1}),xe({pubkey:p.SystemProgram.programId,isWritable:!1}),xe({pubkey:p.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Ye({publicKey:n,transformSol:e}){let t=Pe(n.toString());if(t instanceof p.PublicKey)return e&&t.equals(ee)?he:t;if(e&&t.toString()===ee.toBase58())return he;if(typeof t=="string"){if(t===p.PublicKey.default.toBase58())return p.PublicKey.default;try{return new p.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Pe(n){try{return new p.PublicKey(n)}catch{return n}}var Xn=new p.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Zn=new p.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Qn=new p.PublicKey("SysvarRent111111111111111111111111111111111"),$n=new p.PublicKey("SysvarC1ock11111111111111111111111111111111"),er=new p.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),tr=new p.PublicKey("Sysvar1nstructions1111111111111111111111111"),nr=p.SystemProgram.programId,rr=new p.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),or=new p.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ir=new p.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),sr=new p.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ar=new p.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ur=new p.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),cr=new p.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),lr=new p.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),dr=new p.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),mr=new p.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),pr=new p.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),he=new p.PublicKey("So11111111111111111111111111111111111111112"),ee=p.PublicKey.default;var Se=class{constructor({mint:e,decimals:t,symbol:r,name:o,skipMint:c=!1,isToken2022:d=!1}){if(e===ee.toBase58()||e instanceof se.PublicKey&&ee.equals(e)){this.decimals=v.decimals,this.symbol=v.symbol,this.name=v.name,this.mint=new se.PublicKey(v.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=c?se.PublicKey.default:Ye({publicKey:e}),this.isToken2022=d}equals(e){return this===e?!0:this.mint.equals(e.mint)}},O=Se;O.WSOL=new Se(I(S({},v),{mint:v.address}));var Le=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},ae=Le;ae.SOL=new Le(je);var Xe=B(require("bn.js"));var Je=new m(new Xe.default(100)),q=class extends m{toSignificant(e=5,t,r){return this.mul(Je).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(Je).toFixed(e,t,r)}};var Gt=L("Raydium_price"),D=class extends m{constructor(t){let{baseToken:r,quoteToken:o,numerator:c,denominator:d}=t;super(c,d);this.baseToken=r,this.quoteToken=o,this.scalar=new m(Ae(r.decimals),Ae(o.decimals))}get raw(){return new m(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new D({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Gt.logWithError("mul token not equals");let r=super.mul(t);return new D({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(t,r,o)}toFixed(t=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(t,r,o)}};var Ht=new C.default(0),Qr=new C.default(1),$r=new C.default(2),eo=new C.default(3),to=new C.default(5),we=new C.default(10),no=new C.default(100),ro=new C.default(1e3),oo=new C.default(1e4);function Ae(n){return we.pow(w(n))}var Ze=n=>typeof n=="number";function Qe(n,e,t){let r=Ze(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(n).getTime()<=r}function $e(n,e,t){let r=Ze(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(n).getTime()>r}function ye(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var Jt=require("@solana/web3.js"),Xt=require("@solana/spl-token");var K=require("@solana/web3.js");var Yt=require("@solana/spl-token"),bo=L("Raydium_txUtil");function te(n,e){let[t,r]=K.PublicKey.findProgramAddressSync(n,e);return{publicKey:t,nonce:r}}var s=require("@solana/web3.js"),et=new s.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),tt=new s.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),nt=new s.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),rt=new s.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Po=new s.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),So=new s.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Lo=new s.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ao=new s.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Bo=new s.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ro=new s.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Io=new s.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ko=new s.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),_o=new s.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Co=new s.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Fo=new s.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Vo=new s.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Mo=new s.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Do=new s.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),No=new s.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Eo=new s.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),vo=new s.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Oo=new s.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ko=new s.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Wo=new s.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Uo=new s.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),qo=new s.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Go=new s.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ho=new s.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),jo=new s.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),zo=new s.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Yo=new s.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ne={OPEN_BOOK_PROGRAM:new s.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new s.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new s.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new s.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new s.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new s.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new s.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new s.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new s.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new s.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new s.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new s.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:s.PublicKey.default,Router:new s.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new s.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new s.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new s.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new s.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new s.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new s.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new s.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new s.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new s.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new s.PublicKey("Ray1111111111111111111111111111111111111111")};var Zt=B(require("bn.js"));var ot=require("@solana/web3.js");var G=require("@solana/web3.js"),Qt=B(require("axios"));var it=require("@solana/web3.js"),st=B(require("bn.js"));function $t(n){return typeof n=="object"&&n!==null&&![O,M,it.PublicKey,m,st.default,D,q].some(e=>typeof e=="object"&&n instanceof e)}function ue(n){return typeof n=="string"?Pe(n):Array.isArray(n)?n.map(e=>ue(e)):$t(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,ue(t)])):n}var at=B(require("bn.js")),Bi=new at.default(1e6);var dt=require("@solana/web3.js"),H=B(require("bn.js"));var a=require("@solana/buffer-layout"),Be=a.Layout,ut=a.Structure;var Re=a.UInt;var ct=a.u8;var lt=a.seq;var W=a.blob;var j=class extends Be{constructor(t,r,o){super(t,o);this.blob=W(t),this.signed=r}decode(t,r=0){let o=new H.default(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new H.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}};function T(n){return new Re(1,n)}function le(n){return new Re(4,n)}function i(n){return new j(8,!1,n)}function N(n){return new j(16,!1,n)}function mt(n){return new j(1,!0,n)}function de(n){return new j(8,!0,n)}var ce=class extends Be{constructor(t,r,o,c){super(t.span,c);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function u(n){return new ce(W(32),e=>new dt.PublicKey(e),e=>e.toBuffer(),n)}function ke(n){return new ce(ct(),en,tn,n)}function en(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function tn(n){return n?1:0}var Ie=class extends ut{decode(e,t){return super.decode(e,t)}};function y(n,e,t){return new Ie(n,e,t)}function h(n,e,t){let r,o=typeof e=="number"?e:(0,H.isBN)(e)?e.toNumber():new Proxy(e,{get(c,d){if(!r){let f=Reflect.get(c,"count");r=(0,H.isBN)(f)?f.toNumber():f,Reflect.set(c,"count",r)}return Reflect.get(c,d)},set(c,d,f){return d==="count"&&(r=f),Reflect.set(c,d,f)}});return lt(n,o,t)}var _e=y([u("mint"),u("owner"),i("amount"),le("delegateOption"),u("delegate"),T("state"),le("isNativeOption"),i("isNative"),i("delegatedAmount"),le("closeAuthorityOption"),u("closeAuthority")]);var pe=require("@solana/web3.js");var ls=y([T("instruction")]),ds=y([T("instruction")]),nn=y([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),N("accRewardPerShare"),u("rewardVault"),u("rewardMint"),u("rewardSender"),i("rewardType"),h(i(),15,"padding")]),rn=y([i("state"),i("nonce"),u("lpVault"),u("rewardVault"),u(),u(),i(),i(),i("totalReward"),N("perShareReward"),i("lastSlot"),i("perSlotReward")]),on=y([i("state"),i("nonce"),u("lpVault"),u("rewardVaultA"),i("totalRewardA"),N("perShareRewardA"),i("perSlotRewardA"),T("option"),u("rewardVaultB"),W(7),i("totalRewardB"),N("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),u()]),sn=y([i(),i("state"),i("nonce"),i("validRewardTokenNum"),N("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),u("lpMint"),u("lpVault"),h(nn,5,"rewardInfos"),u("creator"),u(),h(i(),32,"padding")]),pt=new Proxy(rn,{get(n,e,t){return e==="decode"?(...r)=>{let o=n.decode(...r);return I(S({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(n,e,t)}}),ft=new Proxy(on,{get(n,e,t){return e==="decode"?(...r)=>{let o=n.decode(...r);return I(S({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(n,e,t)}}),gt=new Proxy(sn,{get(n,e,t){return e==="decode"?(...r)=>{let o=n.decode(...r);return I(S({},o),{version:6,rewardInfos:o.rewardInfos.map(c=>{var d;return I(S({},c),{rewardType:((d=Object.entries(me).find(f=>String(f[1])===c.rewardType.toString()))!=null?d:["Standard SPL"])[0]})})})}:Reflect.get(n,e,t)}}),an=y([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),ms=y([T("instruction"),i("nonce"),h(an,5,"rewardTimeInfo")]),ps=y([T("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),fs=y([T("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),gs=y([i("state"),u("id"),u("owner"),i("deposited"),h(i(),1,"rewardDebts")]),yt=y([i("state"),u("id"),u("owner"),i("deposited"),h(N(),1,"rewardDebts"),i(""),i("voteLockedBalance"),h(i(),15)]),ys=y([i("state"),u("id"),u("owner"),i("deposited"),h(i(),2,"rewardDebts")]),ht=y([i("state"),u("id"),u("owner"),i("deposited"),h(N(),2,"rewardDebts"),h(i(),17)]),bt=y([i(),i("state"),u("id"),u("owner"),i("deposited"),h(N(),5,"rewardDebts"),h(i(),16)]),hs=y([T("instruction"),i("amount")]),un=y([u("mint"),u("grantAuthority"),i("baselineVoteWeightScaledFactor"),i("maxExtraLockupVoteWeightScaledFactor"),i("lockupSaturationSecs"),mt("digitShift"),h(T(),7,"reserved1"),h(i(),7,"reserved2")]),wt=y([W(8),u("governanceProgramId"),u("realm"),u("realmGoverningTokenMint"),u("realmAuthority"),h(T(),32,"reserved1"),h(un,4,"votingMints"),de("timeOffset"),T("bump"),h(T(),7,"reserved2"),h(i(),11,"reserved3")]),cn=y([de("startTime"),de("endTime"),T("kind"),h(T(),15,"reserved")]),ln=y([h(cn,1,"lockup"),i("amountDeposited_native"),i("amountInitiallyLockedNative"),ke("isUsed"),ke("allowClawback"),T("votingMintConfigIdx"),h(T(),29,"reserved")]),Tt=y([W(8),u("voterAuthority"),u("registrar"),h(ln,32,"deposits"),T("voterBump"),T("voterWweightRecordBump"),h(T(),94,"reserved")]);var dn=require("@solana/spl-token"),Ls=L("Raydium_farm_config"),As=new pe.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Bs=new pe.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Rs=new pe.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX"),xt={3:pt,5:ft,6:gt},Pt={3:yt,5:ht,6:bt};var me={"Standard SPL":0,"Option tokens":1},Is={[et.toString()]:3,[tt.toString()]:4,[nt.toString()]:5,[rt.toString()]:6,[ne.FARM_PROGRAM_ID_V3.toString()]:3,[ne.FARM_PROGRAM_ID_V4.toString()]:4,[ne.FARM_PROGRAM_ID_V5.toString()]:5,[ne.FARM_PROGRAM_ID_V6.toString()]:6};var re=L("Raydium.farm.util");function mn({programId:n,poolId:e,mint:t,type:r}){let{publicKey:o}=te([e.toBuffer(),t.toBuffer(),Buffer.from(r==="lpVault"?"lp_vault_associated_seed":r==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],n);return o}function St({programId:n,poolId:e,owner:t,version:r}){let{publicKey:o}=te([e.toBuffer(),t.toBuffer(),Buffer.from(r===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],n);return o}var pn=({programId:n,poolId:e})=>te([e.toBuffer()],n);function fn(n){return{isSet:new R.default(1),rewardPerSecond:w(n.perSecond),rewardOpenTime:w(n.openTime),rewardEndTime:w(n.endTime),rewardType:w(me[n.rewardType])}}function gn(n){return w(n.endTime).sub(w(n.openTime)).mul(w(n.perSecond))}function Lt(n){let e=Pt[n];return e||re.logWithError("invalid version",n),e}function At(n){let e=xt[n];return e||re.logWithError("invalid version",n),e}function Bt(n,e,t,r){if(n.version===3||n.version===5){if(n.lastSlot.gte(new R.default(t)))return n;let o=new R.default(t).sub(n.lastSlot);n.lastSlot=new R.default(t);for(let c of n.rewardInfos){if(e.amount.eq(new R.default(0)))continue;let d=c.perSlotReward.mul(o);c.perShareReward=c.perShareReward.add(d.mul(new R.default(10).pow(new R.default(n.version===3?9:15))).div(e.amount)),c.totalReward=c.totalReward.add(d)}}else if(n.version===6)for(let o of n.rewardInfos){if(o.rewardState.eq(new R.default(0)))continue;let c=R.default.min(new R.default(r),o.rewardEndTime);if(o.rewardOpenTime.gte(c))continue;let f=c.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),x=o.totalReward.sub(o.totalRewardEmissioned);x.lt(f)?(f=x,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(x.div(o.rewardPerSecond))):o.rewardLastUpdateTime=c,!e.amount.eq(new R.default(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(f.mul(n.rewardMultiplier).div(e.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(f))}return n}async function yn({connection:n,farmPools:e,owner:t,config:r,chainTime:o}){let c=!1,d=!1,f=new R.default(10),x=[];for(let P of e){let g=ue(P);g.version===6?d=!0:c=!0,x.push({pubkey:g.id,version:g.version,key:"state",poolId:g.id},{pubkey:g.lpVault,version:g.version,key:"lpVault",poolId:g.id}),t&&x.push({pubkey:St({programId:g.programId,poolId:g.id,owner:t,version:P.version}),version:g.version,key:"ledger",poolId:g.id})}let b={},F=await ve(n,x,r);for(let{pubkey:P,version:g,key:V,poolId:z,accountInfo:A}of F){let _=z.toBase58();if(b[_]=S({},b[_]),V==="state"){let E=At(g);(!A||!A.data||A.data.length!==E.span)&&re.logWithError(`invalid farm state account info, pools.id, ${P}`),b[_].state=E.decode(A.data)}else if(V==="lpVault")(!A||!A.data||A.data.length!==_e.span)&&re.logWithError(`invalid farm lp vault account info, pools.lpVault, ${P}`),b[_].lpVault=_e.decode(A.data);else if(V==="ledger"){let E=Lt(g);A&&A.data&&(A.data.length!==E.span&&re.logWithError(`invalid farm ledger account info, ledger, ${P}`),b[_].ledger=E.decode(A.data))}}let k=d||c?await n.getSlot():0;for(let P of Object.keys(b))b[P]!==void 0&&(b[P].state=Bt(b[P].state,b[P].lpVault,k,o));for(let[P,{state:g,ledger:V}]of Object.entries(b))if(V){let z=g.version===6?g.rewardMultiplier:g.rewardInfos.length===1?f.pow(new R.default(9)):f.pow(new R.default(15)),A=g.rewardInfos.map((_,E)=>{let Rt=V.rewardDebts[E];return V.deposited.mul(g.version===6?_.accRewardPerShare:_.perShareReward).div(z).sub(Rt)});b[P].wrapped=I(S({},b[P].wrapped),{pendingRewards:A})}return b}function hn(n,e=Date.now()){if(n.version===6){let t=n.state.rewardInfos;if(t.every(({rewardOpenTime:r})=>Qe(e,r.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:r})=>$e(e,r.toNumber(),{unit:"s"})))return"closed pool"}else{let t=n.state.rewardInfos.map(({perSlotReward:r})=>r);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}async function bn(n,e,t,r){let o=await n.getAccountInfo(e);if(o===null)throw Error("registrar info check error");let d=wt.decode(o.data).votingMints.findIndex(F=>F.mint.equals(r));if(d===-1)throw Error("find voter mint error");let f=await n.getAccountInfo(t);if(f===null)return{index:d,isInit:!1};let b=Tt.decode(f.data).deposits.findIndex(F=>F.isUsed&&F.votingMintConfigIdx===d);return b===-1?{index:d,isInit:!1}:{index:b,isInit:!0}}0&&(module.exports={calFarmRewardAmount,farmRewardInfoToConfig,fetchMultipleFarmInfoAndUpdate,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getDepositEntryIndex,getFarmLedgerLayout,getFarmStateLayout,judgeFarmType,updateFarmPoolInfo});
//# sourceMappingURL=util.js.map