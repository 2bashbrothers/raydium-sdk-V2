var kt=Object.create;var X=Object.defineProperty,Ct=Object.defineProperties,Ft=Object.getOwnPropertyDescriptor,_t=Object.getOwnPropertyDescriptors,Vt=Object.getOwnPropertyNames,_e=Object.getOwnPropertySymbols,Mt=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty,Dt=Object.prototype.propertyIsEnumerable;var Ve=(r,e,t)=>e in r?X(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))Me.call(e,t)&&Ve(r,t,e[t]);if(_e)for(var t of _e(e))Dt.call(e,t)&&Ve(r,t,e[t]);return r},I=(r,e)=>Ct(r,_t(e));var Nt=(r,e)=>{for(var t in e)X(r,t,{get:e[t],enumerable:!0})},De=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Vt(e))!Me.call(r,o)&&o!==t&&X(r,o,{get:()=>e[o],enumerable:!(n=Ft(e,o))||n.enumerable});return r};var B=(r,e,t)=>(t=r!=null?kt(Mt(r)):{},De(e||!r||!r.__esModule?X(t,"default",{value:r,enumerable:!0}):t,r)),Et=r=>De(X({},"__esModule",{value:!0}),r);var wr={};Nt(wr,{calFarmRewardAmount:()=>gr,farmRewardInfoToConfig:()=>fr,fetchMultipleFarmInfoAndUpdate:()=>yr,getAssociatedAuthority:()=>pr,getAssociatedLedgerAccount:()=>At,getAssociatedLedgerPoolAccount:()=>dr,getDepositEntryIndex:()=>br,getFarmLedgerLayout:()=>Lt,getFarmStateLayout:()=>Bt,judgeFarmType:()=>hr,updateFarmPoolInfo:()=>Rt});module.exports=Et(wr);var R=B(require("bn.js"));var Ee=require("@solana/web3.js");var Z=require("lodash");var ge=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ne={},Ot={};function A(r){let e=(0,Z.get)(Ne,r);if(!e){let t=(0,Z.get)(Ot,r);e=new ge({name:r,logLevel:t}),(0,Z.set)(Ne,r,e)}return e}var ie=require("@solana/spl-token"),ye=A("Raydium_accountInfo_util");async function Oe(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:c=100}=S({batchRequest:!1},t),m=he(e,c),f=new Array(m.length).fill([]);if(n){let T=m.map(k=>{let P=r._buildArgs([k.map(g=>g.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:P}}),b=he(T,10);f=(await(await Promise.all(b.map(async k=>await r._rpcBatchRequest(k)))).flat()).map(k=>(k.error&&ye.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${k.error.message}`),k.result.value.map(P=>{if(P){let{data:g,executable:V,lamports:z,owner:L,rentEpoch:C}=P;return g.length!==2&&g[1]!=="base64"&&ye.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(g[0],"base64"),executable:V,lamports:z,owner:new Ee.PublicKey(L),rentEpoch:C}}return null})))}else try{f=await Promise.all(m.map(T=>r.getMultipleAccountsInfo(T,o)))}catch(T){T instanceof Error&&ye.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${T.message}`)}return f.flat()}async function ve(r,e,t){let n=await Oe(r,e.map(o=>o.pubkey),t);return e.map((o,c)=>I(S({},o),{accountInfo:n[c]}))}var F=B(require("bn.js")),zt=B(require("decimal.js"));var je=B(require("big.js")),$=B(require("bn.js"));var Ke=B(require("toformat")),vt=Ke.default,J=vt;var Y=B(require("big.js")),Ue=B(require("bn.js")),Ge=B(require("decimal.js-light"));var U=B(require("bn.js"));var We=9007199254740991;function w(r){let e=A("Raydium_parseBigNumberish");if(r instanceof U.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new U.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=We||r<=-We)&&e.logWithError(`BigNumberish number overflow: ${r}`),new U.default(String(r))):typeof r=="bigint"?new U.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new U.default(0))}var se=A("module/fraction"),we=J(Y.default),Q=J(Ge.default),Wt={[0]:Q.ROUND_DOWN,[1]:Q.ROUND_HALF_UP,[2]:Q.ROUND_UP},Ut={[0]:Y.default.roundDown,[1]:Y.default.roundHalfUp,[2]:Y.default.roundUp},d=class{constructor(e,t=new Ue.default(1)){this.numerator=w(e),this.denominator=w(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new d(this.denominator,this.numerator)}add(e){let t=e instanceof d?e:new d(w(e));return this.denominator.eq(t.denominator)?new d(this.numerator.add(t.numerator),this.denominator):new d(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof d?e:new d(w(e));return this.denominator.eq(t.denominator)?new d(this.numerator.sub(t.numerator),this.denominator):new d(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof d?e:new d(w(e));return new d(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof d?e:new d(w(e));return new d(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||se.logWithError(`${e} is not an integer.`),e<=0&&se.logWithError(`${e} is not positive.`),Q.set({precision:e+1,rounding:Wt[n]});let o=new Q(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||se.logWithError(`${e} is not an integer.`),e<0&&se.logWithError(`${e} is negative.`),we.DP=e,we.RM=Ut[n]||1,new we(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Gt=A("Raydium_amount"),qe=J(je.default);function qt(r,e){let t="0",n="0";if(r.includes(".")){let o=r.split(".");o.length===2?([t,n]=o,n=n.padEnd(e,"0")):Gt.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var M=class extends d{constructor(t,n,o=!0,c){let m=new $.default(0),f=xe.pow(new $.default(t.decimals));if(o)m=w(n);else{let T=new $.default(0),b=new $.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[_,k]=qt(n.toString(),t.decimals);T=w(_),b=w(k)}T=T.mul(f),m=T.add(b)}super(m,f);this.logger=A(c||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new M(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new M(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return qe.DP=this.token.decimals,new qe(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var He=require("@solana/web3.js"),Te=require("@solana/spl-token"),ze={chainId:101,address:He.PublicKey.default.toBase58(),programId:Te.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},O={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Te.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ae=require("@solana/web3.js");var p=require("@solana/web3.js"),Xe=require("@solana/spl-token");function Pe({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Zr=[Pe({pubkey:Xe.TOKEN_PROGRAM_ID,isWritable:!1}),Pe({pubkey:p.SystemProgram.programId,isWritable:!1}),Pe({pubkey:p.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Ze({publicKey:r,transformSol:e}){let t=Se(r.toString());if(t instanceof p.PublicKey)return e&&t.equals(ee)?be:t;if(e&&t.toString()===ee.toBase58())return be;if(typeof t=="string"){if(t===p.PublicKey.default.toBase58())return p.PublicKey.default;try{return new p.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Se(r){try{return new p.PublicKey(r)}catch{return r}}var Jr=new p.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Yr=new p.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Qr=new p.PublicKey("SysvarRent111111111111111111111111111111111"),$r=new p.PublicKey("SysvarC1ock11111111111111111111111111111111"),en=new p.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),tn=new p.PublicKey("Sysvar1nstructions1111111111111111111111111"),rn=p.SystemProgram.programId,nn=new p.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),on=new p.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),sn=new p.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),an=new p.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),un=new p.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),cn=new p.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ln=new p.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),mn=new p.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),dn=new p.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),pn=new p.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),fn=new p.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),be=new p.PublicKey("So11111111111111111111111111111111111111112"),ee=p.PublicKey.default;var Ae=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:c=!1,isToken2022:m=!1}){if(e===ee.toBase58()||e instanceof ae.PublicKey&&ee.equals(e)){this.decimals=O.decimals,this.symbol=O.symbol,this.name=O.name,this.mint=new ae.PublicKey(O.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=c?ae.PublicKey.default:Ze({publicKey:e}),this.isToken2022=m}equals(e){return this===e?!0:this.mint.equals(e.mint)}},v=Ae;v.WSOL=new Ae(I(S({},O),{mint:O.address}));var Le=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},ue=Le;ue.SOL=new Le(ze);var Ye=B(require("bn.js"));var Je=new d(new Ye.default(100)),G=class extends d{toSignificant(e=5,t,n){return this.mul(Je).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Je).toFixed(e,t,n)}};var jt=A("Raydium_price"),D=class extends d{constructor(t){let{baseToken:n,quoteToken:o,numerator:c,denominator:m}=t;super(c,m);this.baseToken=n,this.quoteToken=o,this.scalar=new d(Be(n.decimals),Be(o.decimals))}get raw(){return new d(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new D({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&jt.logWithError("mul token not equals");let n=super.mul(t);return new D({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var Qe=require("@solana/web3.js"),$e=B(require("bn.js"));function et(r){return typeof r=="object"&&r!==null&&![v,M,Qe.PublicKey,d,$e.default,D,G].some(e=>typeof e=="object"&&r instanceof e)}function ce(r){return typeof r=="string"?Se(r):Array.isArray(r)?r.map(e=>ce(e)):et(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,ce(t)])):r}var Ht=new F.default(0),no=new F.default(1),oo=new F.default(2),io=new F.default(3),so=new F.default(5),xe=new F.default(10),ao=new F.default(100),uo=new F.default(1e3),co=new F.default(1e4);function Be(r){return xe.pow(w(r))}var tt=r=>typeof r=="number";function rt(r,e,t){let n=tt(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()<=n}function nt(r,e,t){let n=tt(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()>n}function he(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Jt=require("@solana/web3.js"),Yt=require("@solana/spl-token");var K=require("@solana/web3.js");var Zt=require("@solana/spl-token"),So=A("Raydium_txUtil");function te(r,e){let[t,n]=K.PublicKey.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}var s=require("@solana/web3.js"),ot=new s.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),it=new s.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),st=new s.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),at=new s.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ro=new s.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Io=new s.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ko=new s.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Co=new s.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Fo=new s.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),_o=new s.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Vo=new s.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Mo=new s.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Do=new s.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),No=new s.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Eo=new s.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Oo=new s.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),vo=new s.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ko=new s.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Wo=new s.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Uo=new s.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Go=new s.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),qo=new s.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),jo=new s.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ho=new s.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),zo=new s.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Xo=new s.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Zo=new s.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Jo=new s.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Yo=new s.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Qo=new s.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),$o=new s.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var re={OPEN_BOOK_PROGRAM:new s.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new s.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new s.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new s.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new s.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new s.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new s.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new s.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new s.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new s.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new s.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new s.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:s.PublicKey.default,Router:new s.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new s.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new s.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new s.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new s.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new s.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new s.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new s.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new s.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new s.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new s.PublicKey("Ray1111111111111111111111111111111111111111")};var Qt=B(require("bn.js"));var ne=require("@solana/web3.js");var $t={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ne.AddressLookupTableAccount({key:new ne.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ne.AddressLookupTableAccount.deserialize(Buffer.from("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","base64"))})};var q=require("@solana/web3.js"),er=B(require("axios"));var ut=B(require("bn.js")),Li=new ut.default(1e6);var dt=require("@solana/web3.js"),j=B(require("bn.js"));var a=require("@solana/buffer-layout"),Re=a.Layout,ct=a.Structure;var Ie=a.UInt;var lt=a.u8;var mt=a.seq;var W=a.blob;var H=class extends Re{constructor(t,n,o){super(t,o);this.blob=W(t),this.signed=n}decode(t,n=0){let o=new j.default(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new j.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function x(r){return new Ie(1,r)}function me(r){return new Ie(4,r)}function i(r){return new H(8,!1,r)}function N(r){return new H(16,!1,r)}function pt(r){return new H(1,!0,r)}function de(r){return new H(8,!0,r)}var le=class extends Re{constructor(t,n,o,c){super(t.span,c);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function u(r){return new le(W(32),e=>new dt.PublicKey(e),e=>e.toBuffer(),r)}function Ce(r){return new le(lt(),tr,rr,r)}function tr(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function rr(r){return r?1:0}var ke=class extends ct{decode(e,t){return super.decode(e,t)}};function y(r,e,t){return new ke(r,e,t)}function h(r,e,t){let n,o=typeof e=="number"?e:(0,j.isBN)(e)?e.toNumber():new Proxy(e,{get(c,m){if(!n){let f=Reflect.get(c,"count");n=(0,j.isBN)(f)?f.toNumber():f,Reflect.set(c,"count",n)}return Reflect.get(c,m)},set(c,m,f){return m==="count"&&(n=f),Reflect.set(c,m,f)}});return mt(r,o,t)}var Fe=y([u("mint"),u("owner"),i("amount"),me("delegateOption"),u("delegate"),x("state"),me("isNativeOption"),i("isNative"),i("delegatedAmount"),me("closeAuthorityOption"),u("closeAuthority")]);var fe=require("@solana/web3.js");var cs=y([x("instruction")]),ls=y([x("instruction")]),nr=y([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),N("accRewardPerShare"),u("rewardVault"),u("rewardMint"),u("rewardSender"),i("rewardType"),h(i(),15,"padding")]),or=y([i("state"),i("nonce"),u("lpVault"),u("rewardVault"),u(),u(),i(),i(),i("totalReward"),N("perShareReward"),i("lastSlot"),i("perSlotReward")]),ir=y([i("state"),i("nonce"),u("lpVault"),u("rewardVaultA"),i("totalRewardA"),N("perShareRewardA"),i("perSlotRewardA"),x("option"),u("rewardVaultB"),W(7),i("totalRewardB"),N("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),u()]),sr=y([i(),i("state"),i("nonce"),i("validRewardTokenNum"),N("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),u("lpMint"),u("lpVault"),h(nr,5,"rewardInfos"),u("creator"),u(),h(i(),32,"padding")]),ft=new Proxy(or,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return I(S({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(r,e,t)}}),gt=new Proxy(ir,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return I(S({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(r,e,t)}}),yt=new Proxy(sr,{get(r,e,t){return e==="decode"?(...n)=>{let o=r.decode(...n);return I(S({},o),{version:6,rewardInfos:o.rewardInfos.map(c=>{var m;return I(S({},c),{rewardType:((m=Object.entries(pe).find(f=>String(f[1])===c.rewardType.toString()))!=null?m:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),ar=y([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),ms=y([x("instruction"),i("nonce"),h(ar,5,"rewardTimeInfo")]),ds=y([x("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),ps=y([x("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),fs=y([i("state"),u("id"),u("owner"),i("deposited"),h(i(),1,"rewardDebts")]),ht=y([i("state"),u("id"),u("owner"),i("deposited"),h(N(),1,"rewardDebts"),i(""),i("voteLockedBalance"),h(i(),15)]),gs=y([i("state"),u("id"),u("owner"),i("deposited"),h(i(),2,"rewardDebts")]),bt=y([i("state"),u("id"),u("owner"),i("deposited"),h(N(),2,"rewardDebts"),h(i(),17)]),wt=y([i(),i("state"),u("id"),u("owner"),i("deposited"),h(N(),5,"rewardDebts"),h(i(),16)]),ys=y([x("instruction"),i("amount")]),ur=y([u("mint"),u("grantAuthority"),i("baselineVoteWeightScaledFactor"),i("maxExtraLockupVoteWeightScaledFactor"),i("lockupSaturationSecs"),pt("digitShift"),h(x(),7,"reserved1"),h(i(),7,"reserved2")]),xt=y([W(8),u("governanceProgramId"),u("realm"),u("realmGoverningTokenMint"),u("realmAuthority"),h(x(),32,"reserved1"),h(ur,4,"votingMints"),de("timeOffset"),x("bump"),h(x(),7,"reserved2"),h(i(),11,"reserved3")]),cr=y([de("startTime"),de("endTime"),x("kind"),h(x(),15,"reserved")]),lr=y([h(cr,1,"lockup"),i("amountDeposited_native"),i("amountInitiallyLockedNative"),Ce("isUsed"),Ce("allowClawback"),x("votingMintConfigIdx"),h(x(),29,"reserved")]),Tt=y([W(8),u("voterAuthority"),u("registrar"),h(lr,32,"deposits"),x("voterBump"),x("voterWweightRecordBump"),h(x(),94,"reserved")]);var mr=require("@solana/spl-token"),Ss=A("Raydium_farm_config"),As=new fe.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ls=new fe.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Bs=new fe.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX"),Pt={3:ft,5:gt,6:yt},St={3:ht,5:bt,6:wt};var pe={"Standard SPL":0,"Option tokens":1},Rs={[ot.toString()]:3,[it.toString()]:4,[st.toString()]:5,[at.toString()]:6,[re.FARM_PROGRAM_ID_V3.toString()]:3,[re.FARM_PROGRAM_ID_V4.toString()]:4,[re.FARM_PROGRAM_ID_V5.toString()]:5,[re.FARM_PROGRAM_ID_V6.toString()]:6};var oe=A("Raydium.farm.util");function dr({programId:r,poolId:e,mint:t,type:n}){let{publicKey:o}=te([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return o}function At({programId:r,poolId:e,owner:t,version:n}){let{publicKey:o}=te([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return o}var pr=({programId:r,poolId:e})=>te([e.toBuffer()],r);function fr(r){return{isSet:new R.default(1),rewardPerSecond:w(r.perSecond),rewardOpenTime:w(r.openTime),rewardEndTime:w(r.endTime),rewardType:w(pe[r.rewardType])}}function gr(r){return w(r.endTime).sub(w(r.openTime)).mul(w(r.perSecond))}function Lt(r){let e=St[r];return e||oe.logWithError("invalid version",r),e}function Bt(r){let e=Pt[r];return e||oe.logWithError("invalid version",r),e}function Rt(r,e,t,n){if(r.version===3||r.version===5){if(r.lastSlot.gte(new R.default(t)))return r;let o=new R.default(t).sub(r.lastSlot);r.lastSlot=new R.default(t);for(let c of r.rewardInfos){if(e.amount.eq(new R.default(0)))continue;let m=c.perSlotReward.mul(o);c.perShareReward=c.perShareReward.add(m.mul(new R.default(10).pow(new R.default(r.version===3?9:15))).div(e.amount)),c.totalReward=c.totalReward.add(m)}}else if(r.version===6)for(let o of r.rewardInfos){if(o.rewardState.eq(new R.default(0)))continue;let c=R.default.min(new R.default(n),o.rewardEndTime);if(o.rewardOpenTime.gte(c))continue;let f=c.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),T=o.totalReward.sub(o.totalRewardEmissioned);T.lt(f)?(f=T,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(T.div(o.rewardPerSecond))):o.rewardLastUpdateTime=c,!e.amount.eq(new R.default(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(f.mul(r.rewardMultiplier).div(e.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(f))}return r}async function yr({connection:r,farmPools:e,owner:t,config:n,chainTime:o}){let c=!1,m=!1,f=new R.default(10),T=[];for(let P of e){let g=ce(P);g.version===6?m=!0:c=!0,T.push({pubkey:g.id,version:g.version,key:"state",poolId:g.id},{pubkey:g.lpVault,version:g.version,key:"lpVault",poolId:g.id}),t&&T.push({pubkey:At({programId:g.programId,poolId:g.id,owner:t,version:P.version}),version:g.version,key:"ledger",poolId:g.id})}let b={},_=await ve(r,T,n);for(let{pubkey:P,version:g,key:V,poolId:z,accountInfo:L}of _){let C=z.toBase58();if(b[C]=S({},b[C]),V==="state"){let E=Bt(g);(!L||!L.data||L.data.length!==E.span)&&oe.logWithError(`invalid farm state account info, pools.id, ${P}`),b[C].state=E.decode(L.data)}else if(V==="lpVault")(!L||!L.data||L.data.length!==Fe.span)&&oe.logWithError(`invalid farm lp vault account info, pools.lpVault, ${P}`),b[C].lpVault=Fe.decode(L.data);else if(V==="ledger"){let E=Lt(g);L&&L.data&&(L.data.length!==E.span&&oe.logWithError(`invalid farm ledger account info, ledger, ${P}`),b[C].ledger=E.decode(L.data))}}let k=m||c?await r.getSlot():0;for(let P of Object.keys(b))b[P]!==void 0&&(b[P].state=Rt(b[P].state,b[P].lpVault,k,o));for(let[P,{state:g,ledger:V}]of Object.entries(b))if(V){let z=g.version===6?g.rewardMultiplier:g.rewardInfos.length===1?f.pow(new R.default(9)):f.pow(new R.default(15)),L=g.rewardInfos.map((C,E)=>{let It=V.rewardDebts[E];return V.deposited.mul(g.version===6?C.accRewardPerShare:C.perShareReward).div(z).sub(It)});b[P].wrapped=I(S({},b[P].wrapped),{pendingRewards:L})}return b}function hr(r,e=Date.now()){if(r.version===6){let t=r.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>rt(e,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>nt(e,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=r.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}async function br(r,e,t,n){let o=await r.getAccountInfo(e);if(o===null)throw Error("registrar info check error");let m=xt.decode(o.data).votingMints.findIndex(_=>_.mint.equals(n));if(m===-1)throw Error("find voter mint error");let f=await r.getAccountInfo(t);if(f===null)return{index:m,isInit:!1};let b=Tt.decode(f.data).deposits.findIndex(_=>_.isUsed&&_.votingMintConfigIdx===m);return b===-1?{index:m,isInit:!1}:{index:b,isInit:!0}}0&&(module.exports={calFarmRewardAmount,farmRewardInfoToConfig,fetchMultipleFarmInfoAndUpdate,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getDepositEntryIndex,getFarmLedgerLayout,getFarmStateLayout,judgeFarmType,updateFarmPoolInfo});
//# sourceMappingURL=util.js.map