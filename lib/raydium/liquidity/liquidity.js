var Oo=Object.create;var $t=Object.defineProperty,Do=Object.defineProperties,qo=Object.getOwnPropertyDescriptor,Go=Object.getOwnPropertyDescriptors,Uo=Object.getOwnPropertyNames,wn=Object.getOwnPropertySymbols,Xo=Object.getPrototypeOf,Zn=Object.prototype.hasOwnProperty,$r=Object.prototype.propertyIsEnumerable;var Jr=(a,e,t)=>e in a?$t(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,D=(a,e)=>{for(var t in e||(e={}))Zn.call(e,t)&&Jr(a,t,e[t]);if(wn)for(var t of wn(e))$r.call(e,t)&&Jr(a,t,e[t]);return a},H=(a,e)=>Do(a,Go(e));var Xe=(a,e)=>{var t={};for(var n in a)Zn.call(a,n)&&e.indexOf(n)<0&&(t[n]=a[n]);if(a!=null&&wn)for(var n of wn(a))e.indexOf(n)<0&&$r.call(a,n)&&(t[n]=a[n]);return t};var Qo=(a,e)=>{for(var t in e)$t(a,t,{get:e[t],enumerable:!0})},ei=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Uo(e))!Zn.call(a,r)&&r!==t&&$t(a,r,{get:()=>e[r],enumerable:!(n=qo(e,r))||n.enumerable});return a};var Y=(a,e,t)=>(t=a!=null?Oo(Xo(a)):{},ei(e||!a||!a.__esModule?$t(t,"default",{value:a,enumerable:!0}):t,a)),zo=a=>ei($t({},"__esModule",{value:!0}),a);var ha={};Qo(ha,{default:()=>Hn});module.exports=zo(ha);var ke=require("@solana/web3.js"),Me=require("@solana/spl-token");var Ci=require("@solana/web3.js");var rt=Y(require("bn.js")),is=Y(require("decimal.js"));var ai=Y(require("big.js")),on=Y(require("bn.js"));var en=require("lodash");var Jn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ti={},jo={};function ue(a){let e=(0,en.get)(ti,a);if(!e){let t=(0,en.get)(jo,a);e=new Jn({name:a,logLevel:t}),(0,en.set)(ti,a,e)}return e}var ni=Y(require("toformat")),Ho=ni.default,tn=Ho;var nn=Y(require("big.js")),ii=Y(require("bn.js")),oi=Y(require("decimal.js-light"));var Ft=Y(require("bn.js"));var ri=9007199254740991;function Z(a){let e=ue("Raydium_parseBigNumberish");if(a instanceof Ft.default)return a;if(typeof a=="string"){if(a.match(/^-?[0-9]+$/))return new Ft.default(a);e.logWithError(`invalid BigNumberish string: ${a}`)}return typeof a=="number"?(a%1&&e.logWithError(`BigNumberish number underflow: ${a}`),(a>=ri||a<=-ri)&&e.logWithError(`BigNumberish number overflow: ${a}`),new Ft.default(String(a))):typeof a=="bigint"?new Ft.default(a.toString()):(e.error(`invalid BigNumberish value: ${a}`),new Ft.default(0))}var kn=ue("module/fraction"),$n=tn(nn.default),rn=tn(oi.default),Zo={[0]:rn.ROUND_DOWN,[1]:rn.ROUND_HALF_UP,[2]:rn.ROUND_UP},Jo={[0]:nn.default.roundDown,[1]:nn.default.roundHalfUp,[2]:nn.default.roundUp},re=class{constructor(e,t=new ii.default(1)){this.numerator=Z(e),this.denominator=Z(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new re(this.denominator,this.numerator)}add(e){let t=e instanceof re?e:new re(Z(e));return this.denominator.eq(t.denominator)?new re(this.numerator.add(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof re?e:new re(Z(e));return this.denominator.eq(t.denominator)?new re(this.numerator.sub(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof re?e:new re(Z(e));return new re(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof re?e:new re(Z(e));return new re(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||kn.logWithError(`${e} is not an integer.`),e<=0&&kn.logWithError(`${e} is not positive.`),rn.set({precision:e+1,rounding:Zo[n]});let r=new rn(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||kn.logWithError(`${e} is not an integer.`),e<0&&kn.logWithError(`${e} is negative.`),$n.DP=e,$n.RM=Jo[n]||1,new $n(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var $o=ue("Raydium_amount"),si=tn(ai.default);function es(a,e){let t="0",n="0";if(a.includes(".")){let r=a.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):$o.logWithError(`invalid number string, num: ${a}`)}else t=a;return[t,n.slice(0,e)||n]}var ge=class extends re{constructor(t,n,r=!0,s){let i=new on.default(0),o=er.pow(new on.default(t.decimals));if(r)i=Z(n);else{let u=new on.default(0),l=new on.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[c,m]=es(n.toString(),t.decimals);u=Z(c),l=Z(m)}u=u.mul(o),i=u.add(l)}super(i,o);this.logger=ue(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ge(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ge(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return si.DP=this.token.decimals,new si(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var ui=require("@solana/web3.js"),tr=require("@solana/spl-token"),nr={chainId:101,address:ui.PublicKey.default.toBase58(),programId:tr.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ut={chainId:101,address:"So11111111111111111111111111111111111111112",programId:tr.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Pn=require("@solana/web3.js");var oe=require("@solana/web3.js"),ci=require("@solana/spl-token");function I({pubkey:a,isSigner:e=!1,isWritable:t=!0}){return{pubkey:a,isWritable:t,isSigner:e}}var ts=[I({pubkey:ci.TOKEN_PROGRAM_ID,isWritable:!1}),I({pubkey:oe.SystemProgram.programId,isWritable:!1}),I({pubkey:oe.SYSVAR_RENT_PUBKEY,isWritable:!1})];function rr({publicKey:a,transformSol:e}){let t=ir(a.toString());if(t instanceof oe.PublicKey)return e&&t.equals(Dt)?Ot:t;if(e&&t.toString()===Dt.toBase58())return Ot;if(typeof t=="string"){if(t===oe.PublicKey.default.toBase58())return oe.PublicKey.default;try{return new oe.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ir(a){try{return new oe.PublicKey(a)}catch{return a}}var An=new oe.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),or=new oe.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ye=new oe.PublicKey("SysvarRent111111111111111111111111111111111"),Xa=new oe.PublicKey("SysvarC1ock11111111111111111111111111111111"),Pt=new oe.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ns=new oe.PublicKey("Sysvar1nstructions1111111111111111111111111"),Qa=oe.SystemProgram.programId,za=new oe.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ja=new oe.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ha=new oe.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ya=new oe.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Za=new oe.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ja=new oe.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),$a=new oe.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),eu=new oe.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),tu=new oe.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),nu=new oe.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ru=new oe.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ot=new oe.PublicKey("So11111111111111111111111111111111111111112"),Dt=oe.PublicKey.default;function qt(a){return rr({publicKey:a,transformSol:!0})}var sr=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:s=!1,isToken2022:i=!1}){if(e===Dt.toBase58()||e instanceof Pn.PublicKey&&Dt.equals(e)){this.decimals=ut.decimals,this.symbol=ut.symbol,this.name=ut.name,this.mint=new Pn.PublicKey(ut.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=s?Pn.PublicKey.default:rr({publicKey:e}),this.isToken2022=i}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Le=sr;Le.WSOL=new sr(H(D({},ut),{mint:ut.address}));var ar=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Tn=ar;Tn.SOL=new ar(nr);var mi=Y(require("bn.js"));var li=new re(new mi.default(100)),Qe=class extends re{toSignificant(e=5,t,n){return this.mul(li).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(li).toFixed(e,t,n)}};var rs=ue("Raydium_price"),ze=class extends re{constructor(t){let{baseToken:n,quoteToken:r,numerator:s,denominator:i}=t;super(s,i);this.baseToken=n,this.quoteToken=r,this.scalar=new re(ur(n.decimals),ur(r.decimals))}get raw(){return new re(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ze({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&rs.logWithError("mul token not equals");let n=super.mul(t);return new ze({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var di=require("@solana/web3.js"),pi=Y(require("bn.js"));function fi(a){return typeof a=="object"&&a!==null&&![Le,ge,di.PublicKey,re,pi.default,ze,Qe].some(e=>typeof e=="object"&&a instanceof e)}function Tt(a){return typeof a=="string"?ir(a):Array.isArray(a)?a.map(e=>Tt(e)):fi(a)?Object.fromEntries(Object.entries(a).map(([e,t])=>[e,Tt(t)])):a}var ft=new rt.default(0),bi=new rt.default(1),Qu=new rt.default(2),zu=new rt.default(3),ju=new rt.default(5),er=new rt.default(10),Hu=new rt.default(100),Yu=new rt.default(1e3),Zu=new rt.default(1e4);function ur(a){return er.pow(Z(a))}function hn(a,e){let t=a.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function cr(a,e=1,t=[]){let n=[...a];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var ki=require("@solana/web3.js"),Ai=require("@solana/spl-token");var Re=require("@solana/web3.js");var X={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var gi=require("@solana/spl-token"),yi=ue("Raydium_txUtil"),wi=1644;function xn(a){let e=[],t=[];return a.microLamports&&(e.push(Re.ComputeBudgetProgram.setComputeUnitPrice({microLamports:a.microLamports})),t.push(X.SetComputeUnitPrice)),a.units&&(e.push(Re.ComputeBudgetProgram.setComputeUnitLimit({units:a.units})),t.push(X.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Gt(a,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=a.getLatestBlockhash)==null?void 0:n.call(a,{commitment:t})))==null?void 0:r.blockhash}async function Sn(a,e){return a.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);a.onSignature(e,s=>{if(clearTimeout(r),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function os(a,e){a.length<1&&yi.logWithError(`no instructions provided: ${a.toString()}`),e.length<1&&yi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Re.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...a);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<wi}catch{return!1}}function ye(a,e){let[t,n]=Re.PublicKey.findProgramAddressSync(a,e);return{publicKey:t,nonce:n}}function sn({instructions:a,payer:e,signers:t}){return os(a,[e,...t])}function an({instructions:a,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Re.Keypair.generate().publicKey.toString()}){let s=new Re.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:a}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Re.VersionedTransaction(s).serialize()).toString("base64").length<wi}catch{return!1}}var ss=a=>Buffer.isBuffer(a)?a:a instanceof Uint8Array?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a),as=a=>{let e=a.serialize({requireAllSignatures:!1,verifySignatures:!1});a instanceof Re.VersionedTransaction&&(e=ss(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ht(a){let e=[];return a.forEach(t=>{t instanceof Re.Transaction&&(t.recentBlockhash||(t.recentBlockhash=gi.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=Re.Keypair.generate().publicKey)),e.push(as(t))}),console.log("simulate tx string:",e),e}function me(a,e,t){return ye([a.toBuffer(),(t!=null?t:Ai.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new ki.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var F=require("@solana/web3.js"),Pi=new F.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ti=new F.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),hi=new F.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),xi=new F.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),pc=new F.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Si=new F.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fc=new F.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Bi=new F.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),bc=new F.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),yc=new F.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),gc=new F.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),wc=new F.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),kc=new F.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),xt=new F.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ac=new F.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ii=new F.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Pc=new F.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Tc=new F.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),hc=new F.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),xc=new F.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Sc=new F.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Bc=new F.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ic=new F.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Kc=new F.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Lc=new F.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Rc=new F.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Cc=new F.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Nc=new F.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Mc=new F.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),_c=new F.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Vc=new F.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var St={OPEN_BOOK_PROGRAM:new F.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new F.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new F.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new F.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new F.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new F.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new F.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new F.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new F.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new F.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new F.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new F.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:F.PublicKey.default,Router:new F.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new F.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new F.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new F.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new F.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new F.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new F.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new F.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new F.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new F.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new F.PublicKey("Ray1111111111111111111111111111111111111111")};var je=Y(require("bn.js")),un=1e4;function we(a,e,t,n){if(e===void 0)return{amount:a,fee:void 0,expirationTime:void 0};let r=H(D({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),s=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,i=new je.default(s.maximumFee.toString()),o=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(s.transferFeeBasisPoints===un){let u=new je.default(s.maximumFee.toString());return{amount:a.add(u),fee:u,expirationTime:o}}else{let u=cn(a.mul(new je.default(un)),new je.default(un-s.transferFeeBasisPoints)),l=new je.default(s.maximumFee.toString()),c=u.sub(a).gt(l)?a.add(l):u,m=cn(c.mul(new je.default(s.transferFeeBasisPoints)),new je.default(un)),p=m.gt(i)?i:m;return{amount:c,fee:p,expirationTime:o}}else{let u=cn(a.mul(new je.default(s.transferFeeBasisPoints)),new je.default(un)),l=u.gt(i)?i:u;return{amount:a,fee:l,expirationTime:o}}}function bt(a,e){return a===void 0?e:e===void 0?a:Math.min(a,e)}function cn(a,e){let{div:t,mod:n}=a.divmod(e);return n.gt(new je.default(0))?t.add(new je.default(1)):t}var Ze=require("@solana/web3.js");async function lr({connection:a,address:e,cluster:t="mainnet"}){let n=await ct(a,[...new Set(e.map(s=>s.toString()))].map(s=>new Ze.PublicKey(s))),r={};for(let s=0;s<e.length;s++){let i=n[s],o=e[s];if(!i)continue;let u=new Ze.AddressLookupTableAccount({key:o,state:Ze.AddressLookupTableAccount.deserialize(i.data)});r[o.toString()]=u,t==="devnet"?Ut[o.toString()]=u:Bn[o.toString()]=u}return r}var Bn={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Ze.AddressLookupTableAccount({key:new Ze.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Ze.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Ut={},mr=async a=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Ut[e])return Ut;let t=new Ze.PublicKey(e),n=await a.getAccountInfo(t);return n&&(Ut[e]=new Ze.AddressLookupTableAccount({key:t,state:Ze.AddressLookupTableAccount.deserialize(n.data)})),Ut};var ie=require("@solana/web3.js"),Li=Y(require("axios"));var In=2e3,Kn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Li.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=xn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(ie.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ie.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(X.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:s=[],lookupTableAddress:i=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...i.filter(o=>o!==ie.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(D({},t||{})):this.build(t)}build(e){var n;let t=new ie.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var c;let{recentBlockHash:s,skipPreflight:i=!0,sendAndConfirm:o,notSendToRpc:u}=r||{},l=s!=null?s:await Gt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),ht([t]),(c=this.owner)!=null&&c.isKeyPair)return{txId:o?await(0,ie.sendAndConfirmTransaction)(this.connection,t,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:i}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:i}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let p of m)try{p.sign(...this.signers)}catch{}return{txId:u?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:i}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),s=t.filter(c=>c.transaction.instructions.length>0),i=[r,...s.map(c=>c.transaction)],o=[this.signers,...s.map(c=>c.signers)],u=[...this.instructionTypes,...s.map(c=>c.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(c=>{c.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:i,signers:o,instructionTypes:u,execute:async c=>{var g;let{sequentially:m,onTxUpdate:p,skipTxCount:d=0,recentBlockHash:b,skipPreflight:y=!0}=c||{},w=b!=null?b:await Gt(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(m){let A=[],T=0;for(let h of i){if(++T,T<=d)continue;let P=await(0,ie.sendAndConfirmTransaction)(this.connection,h,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});A.push(P)}return{txIds:A,signedTxs:i}}return{txIds:await await Promise.all(i.map(async A=>(A.recentBlockhash=w,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:y})))),signedTxs:i}}if(this.signAllTransactions){let A=i.map((h,P)=>(h.recentBlockhash=w,o[P].length&&h.sign(...o[P]),h));ht(A);let T=await this.signAllTransactions(A);if(m){let h=0,P=[],k=async()=>{if(!T[h])return;let B=await this.connection.sendRawTransaction(T[h].serialize(),{skipPreflight:y});P.push({txId:B,status:"sent",signedTx:T[h]}),p==null||p([...P]),h++;let K=!1,R=null,S=null,M=V=>{R!==null&&clearInterval(R),S!==null&&this.connection.removeSignatureListener(S);let _=P.findIndex(U=>U.txId===B);if(_>-1){if(P[_].status==="error"||P[_].status==="success")return;P[_].status=V.err?"error":"success"}p==null||p([...P]),V.err||k()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var V;if(K){clearInterval(R);return}try{let _=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(K=!0,clearInterval(R),M({err:((V=_.meta)==null?void 0:V.err)||null}),console.log("tx status from getTransaction:",B))}catch(_){K=!0,clearInterval(R),console.error("getTransaction timeout:",_,B)}},In)),S=this.connection.onSignature(B,V=>{if(K){this.connection.removeSignatureListener(S);return}K=!0,M(V)},"confirmed"),this.connection.getSignatureStatus(B)};return await k(),{txIds:P.map(B=>B.txId),signedTxs:T}}else{let h=[];for(let P=0;P<T.length;P+=1){let k=await this.connection.sendRawTransaction(T[P].serialize(),{skipPreflight:y});h.push(k)}return{txIds:h,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var y;let b=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:s}=b,i=Xe(b,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=D(D({},this.cluster==="devnet"?await mr(this.connection):Bn),t),u=Array.from(new Set([...n,...this.lookupTableAddress])),l=[];for(let w of u)o[w]===void 0&&l.push(new ie.PublicKey(w));let c=await lr({connection:this.connection,address:l});for(let[w,g]of Object.entries(c))o[w]=g;let m=r?ie.PublicKey.default.toBase58():s!=null?s:await Gt(this.connection,this.blockhashCommitment),p=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((y=this.owner)==null?void 0:y.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new ie.VersionedTransaction(p);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var h;let{skipPreflight:g=!0,sendAndConfirm:A,notSendToRpc:T}=w||{};if(ht([d]),(h=this.owner)!=null&&h.isKeyPair){let P=await this.connection.sendTransaction(d,{skipPreflight:g});return A&&await Sn(this.connection,P),{txId:P,signedTx:d}}if(this.signAllTransactions){let P=await this.signAllTransactions([d]);if(this.signers.length)for(let k of P)try{k.sign(this.signers)}catch{}return{txId:T?"":await this.connection.sendTransaction(P[0],{skipPreflight:g}),signedTx:P[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),s=t.filter(c=>c.builder.instructions.length>0),i=[r,...s.map(c=>c.transaction)],o=[this.signers,...s.map(c=>c.signers)],u=[...this.instructionTypes,...s.map(c=>c.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(c=>{c.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),i.forEach(async(c,m)=>{c.sign(o[m])}),{builder:this,transactions:i,signers:o,instructionTypes:u,buildProps:n,execute:async c=>{var y;let{sequentially:m,onTxUpdate:p,recentBlockHash:d,skipPreflight:b=!0}=c||{};if(d&&i.forEach(w=>w.message.recentBlockhash=d),ht(i),(y=this.owner)!=null&&y.isKeyPair){if(m){let w=[];for(let g of i){let A=await this.connection.sendTransaction(g,{skipPreflight:b});await Sn(this.connection,A),w.push(A)}return{txIds:w,signedTxs:i}}return{txIds:await Promise.all(i.map(async w=>await this.connection.sendTransaction(w,{skipPreflight:b}))),signedTxs:i}}if(this.signAllTransactions){let w=await this.signAllTransactions(i);if(m){let g=0,A=[],T=async()=>{if(!w[g])return;let h=await this.connection.sendTransaction(w[g],{skipPreflight:b});A.push({txId:h,status:"sent",signedTx:w[g]}),p==null||p([...A]),g++;let P=!1,k=null,B=null,K=R=>{k!==null&&clearInterval(k),B!==null&&this.connection.removeSignatureListener(B);let S=A.findIndex(M=>M.txId===h);if(S>-1){if(A[S].status==="error"||A[S].status==="success")return;A[S].status=R.err?"error":"success"}p==null||p([...A]),R.err||T()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var R;if(P){clearInterval(k);return}try{let S=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});S&&(P=!0,clearInterval(k),K({err:((R=S.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",h))}catch(S){P=!0,clearInterval(k),console.error("getTransaction timeout:",S,h)}},In)),B=this.connection.onSignature(h,R=>{if(P){this.connection.removeSignatureListener(B);return}P=!0,K(R)},"confirmed"),this.connection.getSignatureStatus(h)};return T(),{txIds:[],signedTxs:w}}else{let g=[];for(let A=0;A<w.length;A+=1){let T=await this.connection.sendTransaction(w[A],{skipPreflight:b});g.push(T)}return{txIds:g,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var p;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,r=Xe(m,["splitIns","computeBudgetConfig"]),s=n?xn(n):{instructions:[],instructionTypes:[]},i=this.signers.reduce((d,b)=>H(D({},d),{[b.publicKey.toBase58()]:b}),{}),o=[],u=[],l=[],c=0;if(this.allInstructions.forEach(d=>{let b=[...l,d],y=n?[...s.instructions,...b]:b,g=[...new Set(b.map(A=>A.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(A=>new ie.PublicKey(A));if(d!==t[c]&&l.length<12&&(sn({instructions:y,payer:this.feePayer,signers:g})||sn({instructions:b,payer:this.feePayer,signers:g})))l.push(d);else{if(l.length===0)throw Error("item ins too big");c+=d===t[c]?1:0,sn({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:g})?o.push(new ie.Transaction().add(...s.instructions,...l)):o.push(new ie.Transaction().add(...l)),u.push(Array.from(new Set(l.map(A=>A.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(A=>i[A]).filter(A=>A!==void 0)),l=[d]}}),l.length>0){let b=[...new Set(l.map(y=>y.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(y=>i[y]).filter(y=>y!==void 0);sn({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:b.map(y=>y.publicKey)})?o.push(new ie.Transaction().add(...s.instructions,...l)):o.push(new ie.Transaction().add(...l)),u.push(b)}return o.forEach(d=>d.feePayer=this.feePayer),(p=this.owner)!=null&&p.signer&&u.forEach(d=>{d.some(b=>b.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:o,signers:u,instructionTypes:this.instructionTypes,execute:async d=>{var h;let{sequentially:b,onTxUpdate:y,skipTxCount:w=0,recentBlockHash:g,skipPreflight:A=!0}=d||{},T=g!=null?g:await Gt(this.connection,this.blockhashCommitment);if(o.forEach(async(P,k)=>{P.recentBlockhash=T,u[k].length&&P.sign(...u[k])}),ht(o),(h=this.owner)!=null&&h.isKeyPair){if(b){let P=0,k=[];for(let B of o){if(++P,P<=w){k.push("tx skipped");continue}let K=await(0,ie.sendAndConfirmTransaction)(this.connection,B,this.signers.find(R=>R.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});k.push(K)}return{txIds:k,signedTxs:o}}return{txIds:await Promise.all(o.map(async P=>await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:A}))),signedTxs:o}}if(this.signAllTransactions){let P=await this.signAllTransactions(o.slice(w,o.length)),k=[...o.slice(0,w),...P];if(b){let B=0,K=[],R=async()=>{if(!k[B])return;B<w&&(K.push({txId:"",status:"success",signedTx:k[B]}),y==null||y([...K]),B++,R());let S=await this.connection.sendRawTransaction(k[B].serialize(),{skipPreflight:A});K.push({txId:S,status:"sent",signedTx:k[B]}),y==null||y([...K]),B++;let M=!1,V=null,_=null,U=te=>{V!==null&&clearInterval(V),_!==null&&this.connection.removeSignatureListener(_);let ne=K.findIndex(ae=>ae.txId===S);if(ne>-1){if(K[ne].status==="error"||K[ne].status==="success")return;K[ne].status=te.err?"error":"success"}y==null||y([...K]),te.err||R()};this.loopMultiTxStatus&&(V=setInterval(async()=>{var te;if(M){clearInterval(V);return}try{let ne=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});ne&&(M=!0,clearInterval(V),U({err:((te=ne.meta)==null?void 0:te.err)||null}),console.log("tx status from getTransaction:",S))}catch(ne){M=!0,clearInterval(V),console.error("getTransaction timeout:",ne,S)}},In)),_=this.connection.onSignature(S,te=>{if(M){this.connection.removeSignatureListener(_);return}M=!0,U(te)},"confirmed"),this.connection.getSignatureStatus(S)};return await R(),{txIds:K.map(S=>S.txId),signedTxs:k}}else{let B=[];for(let K=0;K<k.length;K+=1){let R=await this.connection.sendRawTransaction(k[K].serialize(),{skipPreflight:A});B.push(R)}return{txIds:B,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var T;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:r={},lookupTableAddress:s=[]}=A,i=Xe(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=D(D({},this.cluster==="devnet"?await mr(this.connection):Bn),r),u=Array.from(new Set([...this.lookupTableAddress,...s])),l=[];for(let h of u)o[h]===void 0&&l.push(new ie.PublicKey(h));let c=await lr({connection:this.connection,address:l});for(let[h,P]of Object.entries(c))o[h]=P;let m=t?xn(t):{instructions:[],instructionTypes:[]},p=await Gt(this.connection,this.blockhashCommitment),d=this.signers.reduce((h,P)=>H(D({},h),{[P.publicKey.toBase58()]:P}),{}),b=[],y=[],w=[],g=0;if(this.allInstructions.forEach(h=>{let P=[...w,h],k=t?[...m.instructions,...P]:P;if(h!==n[g]&&w.length<12&&(an({instructions:k,payer:this.feePayer,lookupTableAddressAccount:o})||an({instructions:P,payer:this.feePayer,lookupTableAddressAccount:o})))w.push(h);else{if(w.length===0)throw Error("item ins too big");g+=h===n[g]?1:0;let B={};for(let K of[...new Set(u)])o[K]!==void 0&&(B[K]=o[K]);if(t&&an({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:p})){let K=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(o));b.push(new ie.VersionedTransaction(K))}else{let K=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(o));b.push(new ie.VersionedTransaction(K))}y.push(Array.from(new Set(w.map(K=>K.keys.filter(R=>R.isSigner).map(R=>R.pubkey.toString())).flat())).map(K=>d[K]).filter(K=>K!==void 0)),w=[h]}}),w.length>0){let P=[...new Set(w.map(k=>k.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&an({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:p})){let k=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(o));b.push(new ie.VersionedTransaction(k))}else{let k=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(o));b.push(new ie.VersionedTransaction(k))}y.push(P)}return(T=this.owner)!=null&&T.signer&&y.forEach(h=>{h.some(P=>P.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),b.forEach((h,P)=>{h.sign(y[P])}),{builder:this,transactions:b,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async h=>{var S;let{sequentially:P,onTxUpdate:k,skipTxCount:B=0,recentBlockHash:K,skipPreflight:R=!0}=h||{};if(b.map(async(M,V)=>{y[V].length&&M.sign(y[V]),K&&(M.message.recentBlockhash=K)}),ht(b),(S=this.owner)!=null&&S.isKeyPair){if(P){let M=0,V=[];for(let _ of b){if(++M,M<=B){console.log("skip tx: ",M),V.push("tx skipped");continue}let U=await this.connection.sendTransaction(_,{skipPreflight:R});await Sn(this.connection,U),V.push(U)}return{txIds:V,signedTxs:b}}return{txIds:await Promise.all(b.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:R}))),signedTxs:b}}if(this.signAllTransactions){let M=await this.signAllTransactions(b.slice(B,b.length)),V=[...b.slice(0,B),...M];if(P){let _=0,U=[],te=async()=>{if(!V[_])return;if(_<B){U.push({txId:"",status:"success",signedTx:V[_]}),k==null||k([...U]),_++,te();return}let ne=await this.connection.sendTransaction(V[_],{skipPreflight:R});U.push({txId:ne,status:"sent",signedTx:V[_]}),k==null||k([...U]),_++;let ae=!1,Te=null,He=null,st=_e=>{Te!==null&&clearInterval(Te),He!==null&&this.connection.removeSignatureListener(He);let Ve=U.findIndex(tt=>tt.txId===ne);if(Ve>-1){if(U[Ve].status==="error"||U[Ve].status==="success")return;U[Ve].status=_e.err?"error":"success"}k==null||k([...U]),_e.err||te()};this.loopMultiTxStatus&&(Te=setInterval(async()=>{var _e;if(ae){clearInterval(Te);return}try{let Ve=await this.connection.getTransaction(ne,{commitment:"confirmed",maxSupportedTransactionVersion:0});Ve&&(ae=!0,clearInterval(Te),st({err:((_e=Ve.meta)==null?void 0:_e.err)||null}),console.log("tx status from getTransaction:",ne))}catch(Ve){ae=!0,clearInterval(Te),console.error("getTransaction timeout:",Ve,ne)}},In)),He=this.connection.onSignature(ne,_e=>{if(ae){this.connection.removeSignatureListener(He);return}ae=!0,st(_e)},"confirmed"),this.connection.getSignatureStatus(ne)};return te(),{txIds:[],signedTxs:V}}else{let _=[];for(let U=0;U<V.length;U+=1){let te=await this.connection.sendTransaction(V[U],{skipPreflight:R});_.push(te)}return{txIds:_,signedTxs:V}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};var Ri=Y(require("bn.js")),Zc=new Ri.default(1e6);var Ln=require("@solana/spl-token"),dr=ue("Raydium_accountInfo_util");async function ct(a,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:s=100}=D({batchRequest:!1},t),i=cr(e,s),o=new Array(i.length).fill([]);if(n){let u=i.map(m=>{let p=a._buildArgs([m.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:p}}),l=cr(u,10);o=(await(await Promise.all(l.map(async m=>await a._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&dr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(p=>{if(p){let{data:d,executable:b,lamports:y,owner:w,rentEpoch:g}=p;return d.length!==2&&d[1]!=="base64"&&dr.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:b,lamports:y,owner:new Ci.PublicKey(w),rentEpoch:g}}return null})))}else try{o=await Promise.all(i.map(u=>a.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&dr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return o.flat()}async function Bt(a,e,t){let n=await ct(a,e.map(r=>r.pubkey),t);return e.map((r,s)=>H(D({},r),{accountInfo:n[s]}))}var Vi=require("@solana/web3.js"),Xt=Y(require("bn.js"));var O=require("@solana/buffer-layout"),Rn=O.Layout,Ni=O.Structure;var pr=O.UInt;var Mi=O.u8,It=O.u16;var fr=O.u32;var pe=O.s32;var _i=O.seq;var he=O.blob;var br=O.bits;var Kt=class extends Rn{constructor(t,n,r){super(t,r);this.blob=he(t),this.signed=n}decode(t,n=0){let r=new Xt.default(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Xt.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}},Cn=class extends Rn{constructor(t){super(8,t);this._lower=br(fr(),!1),this._upper=br(fr(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let r=this._lower.decode(t,n),s=this._upper.decode(t,n+this._lower.span);return D(D({},r),s)}encode(t,n,r=0){return this._lower.encode(t,n,r)+this._upper.encode(t,n,r+this._lower.span)}};function v(a){return new pr(1,a)}function Ce(a){return new pr(4,a)}function f(a){return new Kt(8,!1,a)}function q(a){return new Kt(16,!1,a)}function vi(a){return new Kt(1,!0,a)}function Qt(a){return new Kt(8,!0,a)}function Wi(a){return new Kt(16,!0,a)}var Nn=class extends Rn{constructor(t,n,r,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function L(a){return new Nn(he(32),e=>new Vi.PublicKey(e),e=>e.toBuffer(),a)}function xe(a){return new Nn(Mi(),us,cs,a)}function us(a){if(a===0)return!1;if(a===1)return!0;throw new Error("Invalid bool: "+a)}function cs(a){return a?1:0}var yr=class extends Ni{decode(e,t){return super.decode(e,t)}};function C(a,e,t){return new yr(a,e,t)}function G(a,e,t){let n,r=typeof e=="number"?e:(0,Xt.isBN)(e)?e.toNumber():new Proxy(e,{get(s,i){if(!n){let o=Reflect.get(s,"count");n=(0,Xt.isBN)(o)?o.toNumber():o,Reflect.set(s,"count",n)}return Reflect.get(s,i)},set(s,i,o){return i==="count"&&(n=o),Reflect.set(s,i,o)}});return _i(a,r,t)}var Mn=require("@solana/web3.js");var ls=require("@solana/spl-token"),Wl=ue("Raydium_farm_config"),El=new Mn.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Fl=new Mn.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Ol=new Mn.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX");var Ei={3:wr,5:Fi,6:Oi};var _n={"Standard SPL":0,"Option tokens":1},gr={[Pi.toString()]:3,[Ti.toString()]:4,[hi.toString()]:5,[xi.toString()]:6,[St.FARM_PROGRAM_ID_V3.toString()]:3,[St.FARM_PROGRAM_ID_V4.toString()]:4,[St.FARM_PROGRAM_ID_V5.toString()]:5,[St.FARM_PROGRAM_ID_V6.toString()]:6};var kr=C([v("instruction")]),fs=C([v("instruction")]),bs=C([f("rewardState"),f("rewardOpenTime"),f("rewardEndTime"),f("rewardLastUpdateTime"),f("totalReward"),f("totalRewardEmissioned"),f("rewardClaimed"),f("rewardPerSecond"),q("accRewardPerShare"),L("rewardVault"),L("rewardMint"),L("rewardSender"),f("rewardType"),G(f(),15,"padding")]),ys=C([f("state"),f("nonce"),L("lpVault"),L("rewardVault"),L(),L(),f(),f(),f("totalReward"),q("perShareReward"),f("lastSlot"),f("perSlotReward")]),gs=C([f("state"),f("nonce"),L("lpVault"),L("rewardVaultA"),f("totalRewardA"),q("perShareRewardA"),f("perSlotRewardA"),v("option"),L("rewardVaultB"),he(7),f("totalRewardB"),q("perShareRewardB"),f("perSlotRewardB"),f("lastSlot"),L()]),ws=C([f(),f("state"),f("nonce"),f("validRewardTokenNum"),q("rewardMultiplier"),f("rewardPeriodMax"),f("rewardPeriodMin"),f("rewardPeriodExtend"),L("lpMint"),L("lpVault"),G(bs,5,"rewardInfos"),L("creator"),L(),G(f(),32,"padding")]),ms=new Proxy(ys,{get(a,e,t){return e==="decode"?(...n)=>{let r=a.decode(...n);return H(D({},r),{version:3,rewardInfos:[{rewardVault:r.rewardVault,totalReward:r.totalReward,perSlotReward:r.perSlotReward,perShareReward:r.perShareReward}]})}:Reflect.get(a,e,t)}}),ds=new Proxy(gs,{get(a,e,t){return e==="decode"?(...n)=>{let r=a.decode(...n);return H(D({},r),{version:5,rewardInfos:[{rewardVault:r.rewardVaultA,totalReward:r.totalRewardA,perSlotReward:r.perSlotRewardA,perShareReward:r.perShareRewardA},{rewardVault:r.rewardVaultB,totalReward:r.totalRewardB,perSlotReward:r.perSlotRewardB,perShareReward:r.perShareRewardB}]})}:Reflect.get(a,e,t)}}),ps=new Proxy(ws,{get(a,e,t){return e==="decode"?(...n)=>{let r=a.decode(...n);return H(D({},r),{version:6,rewardInfos:r.rewardInfos.map(s=>{var i;return H(D({},s),{rewardType:((i=Object.entries(_n).find(o=>String(o[1])===s.rewardType.toString()))!=null?i:["Standard SPL"])[0]})})})}:Reflect.get(a,e,t)}}),ks=C([f("isSet"),f("rewardPerSecond"),f("rewardOpenTime"),f("rewardEndTime"),f("rewardType")]),As=C([v("instruction"),f("nonce"),G(ks,5,"rewardTimeInfo")]),Ps=C([v("instruction"),f("rewardReopenTime"),f("rewardEndTime"),f("rewardPerSecond")]),Ts=C([v("instruction"),f("isSet"),f("rewardPerSecond"),f("rewardOpenTime"),f("rewardEndTime"),f("rewardType")]),zl=C([f("state"),L("id"),L("owner"),f("deposited"),G(f(),1,"rewardDebts")]),wr=C([f("state"),L("id"),L("owner"),f("deposited"),G(q(),1,"rewardDebts"),f(""),f("voteLockedBalance"),G(f(),15)]),jl=C([f("state"),L("id"),L("owner"),f("deposited"),G(f(),2,"rewardDebts")]),Fi=C([f("state"),L("id"),L("owner"),f("deposited"),G(q(),2,"rewardDebts"),G(f(),17)]),Oi=C([f(),f("state"),L("id"),L("owner"),f("deposited"),G(q(),5,"rewardDebts"),G(f(),16)]),Lt=C([v("instruction"),f("amount")]),hs=C([L("mint"),L("grantAuthority"),f("baselineVoteWeightScaledFactor"),f("maxExtraLockupVoteWeightScaledFactor"),f("lockupSaturationSecs"),vi("digitShift"),G(v(),7,"reserved1"),G(f(),7,"reserved2")]),xs=C([he(8),L("governanceProgramId"),L("realm"),L("realmGoverningTokenMint"),L("realmAuthority"),G(v(),32,"reserved1"),G(hs,4,"votingMints"),Qt("timeOffset"),v("bump"),G(v(),7,"reserved2"),G(f(),11,"reserved3")]),Ss=C([Qt("startTime"),Qt("endTime"),v("kind"),G(v(),15,"reserved")]),Bs=C([G(Ss,1,"lockup"),f("amountDeposited_native"),f("amountInitiallyLockedNative"),xe("isUsed"),xe("allowClawback"),v("votingMintConfigIdx"),G(v(),29,"reserved")]),Is=C([he(8),L("voterAuthority"),L("registrar"),G(Bs,32,"deposits"),v("voterBump"),v("voterWweightRecordBump"),G(v(),94,"reserved")]);var Ks=Y(require("bn.js"));var Vn=C([L("mint"),L("owner"),f("amount"),Ce("delegateOption"),L("delegate"),v("state"),Ce("isNativeOption"),f("isNative"),f("delegatedAmount"),Ce("closeAuthorityOption"),L("closeAuthority")]);var Ls=ue("Raydium.farm.util");function zt({programId:a,poolId:e,owner:t,version:n}){let{publicKey:r}=ye([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],a);return r}function Di(a){let e=Ei[a];return e||Ls.logWithError("invalid version",a),e}var ce=require("@solana/web3.js"),Rs=Y(require("bn.js")),jt=require("@solana/spl-token");var Cs=ue("Raydium_farm_instruction"),_m={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function qi(a){let{version:e,id:t,ledger:n,programId:r,owner:s}=a,i={3:9,5:10}[e];i||Cs.logWithError(`invalid farm pool version: ${e}`);let o=Buffer.alloc(kr.span);kr.encode({instruction:i},o);let u=[I({pubkey:t}),I({pubkey:n}),I({pubkey:s,isWritable:!1}),I({pubkey:ce.SystemProgram.programId,isWritable:!1}),I({pubkey:ce.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new ce.TransactionInstruction({programId:r,keys:u,data:o}),instructionType:X.FarmV3CreateLedger}}function Gi(a){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:s,amount:i}=a,[o,u]=[new ce.PublicKey(e.programId),new ce.PublicKey(e.id)],l=zt({programId:o,poolId:u,owner:s,version:6}),c=Buffer.alloc(Lt.span);Lt.encode({instruction:2,amount:Z(i)},c);let m=[I({pubkey:jt.TOKEN_PROGRAM_ID,isWritable:!1}),I({pubkey:u}),I({pubkey:new ce.PublicKey(t.authority),isWritable:!1}),I({pubkey:new ce.PublicKey(t.lpVault)}),I({pubkey:l}),I({pubkey:s,isWritable:!1,isSigner:!0}),I({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)m.push(I({pubkey:new ce.PublicKey(t.rewardInfos[p].vault)})),m.push(I({pubkey:r[p]}));return new ce.TransactionInstruction({programId:o,keys:m,data:c})}function Ui(a){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:s,amount:i,userAuxiliaryLedgers:o}=a,[u,l]=[new ce.PublicKey(e.programId),new ce.PublicKey(e.id)],c=zt({programId:u,poolId:l,owner:s,version:5}),m=Buffer.alloc(Lt.span);Lt.encode({instruction:12,amount:Z(i)},m);let p=[I({pubkey:l}),I({pubkey:new ce.PublicKey(t.authority),isWritable:!1}),I({pubkey:c}),I({pubkey:s,isWritable:!1,isSigner:!0}),I({pubkey:n}),I({pubkey:new ce.PublicKey(t.lpVault)}),I({pubkey:r[0]}),I({pubkey:new ce.PublicKey(t.rewardInfos[0].vault)}),I({pubkey:ce.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),I({pubkey:jt.TOKEN_PROGRAM_ID,isWritable:!1})];for(let d=1;d<t.rewardInfos.length;d++)p.push(I({pubkey:r[d]})),p.push(I({pubkey:new ce.PublicKey(t.rewardInfos[d].vault)}));if(o)for(let d of o)p.push(I({pubkey:d}));return new ce.TransactionInstruction({programId:u,keys:p,data:m})}function Xi(a){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:s,amount:i,userAuxiliaryLedgers:o}=a,[u,l]=[new ce.PublicKey(e.programId),new ce.PublicKey(e.id)],c=zt({programId:u,poolId:l,owner:s,version:3}),m=Buffer.alloc(Lt.span);Lt.encode({instruction:11,amount:Z(i)},m);let p=[I({pubkey:l}),I({pubkey:new ce.PublicKey(t.authority),isWritable:!1}),I({pubkey:c}),I({pubkey:s,isWritable:!1,isSigner:!0}),I({pubkey:n}),I({pubkey:new ce.PublicKey(t.lpVault)}),I({pubkey:r[0]}),I({pubkey:new ce.PublicKey(t.rewardInfos[0].vault)}),I({pubkey:ce.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),I({pubkey:jt.TOKEN_PROGRAM_ID,isWritable:!1})];if(o)for(let d of o)p.push(I({pubkey:d}));return new ce.TransactionInstruction({programId:u,keys:p,data:m})}var x=require("@solana/web3.js"),On=Y(require("bn.js"));var W=require("@solana/spl-token");var uo=Y(require("bn.js")),Vt=Y(require("decimal.js"));var Oe=Y(require("bn.js")),fe=new Oe.default(0),it=new Oe.default(1),lt=new Oe.default(-1),De=new Oe.default(1).shln(64),vn=new Oe.default(1).shln(128),Ar=De.sub(it),ln=64,Qi=vn.subn(1),Ne=-443636,ve=-Ne,Rt=new Oe.default("4295048016"),Ct=new Oe.default("79226673521066979257578248091"),Gm=new Oe.default("4295048017"),Um=new Oe.default("79226673521066979257578248090"),zi=16,ji="59543866431248",Hi="184467440737095516",Yi="15793534762490258745",Wn=new Oe.default(10).pow(new Oe.default(6));var Xm=new Oe.default("18446744073700000000");var z=Y(require("bn.js")),$e=Y(require("decimal.js"));function En(a){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,a,!1),new Uint8Array(e)}function Pr(a,e){let t=0;for(let n=a-1;n>=0&&!e.testn(n);n--)t++;return t}function Tr(a,e){let t=0;for(let n=0;n<a&&!e.testn(n);n++)t++;return t}function mn(a,e){for(let t=0;t<a;t++)if(e.testn(t))return!1;return!0}function Zi(a,e){return mn(a,e)?null:Pr(a,e)}function Ji(a,e){return mn(a,e)?null:Tr(a,e)}var Zm=Buffer.from("amm_config","utf8"),Ns=Buffer.from("pool","utf8"),Ms=Buffer.from("pool_vault","utf8"),_s=Buffer.from("pool_reward_vault","utf8"),$i=Buffer.from("position","utf8"),Vs=Buffer.from("tick_array","utf8"),vs=Buffer.from("operation","utf8"),Ws=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Es=Buffer.from("observation","utf8");function eo(a,e,t,n){return ye([Ns,e.toBuffer(),t.toBuffer(),n.toBuffer()],a)}function hr(a,e,t){return ye([Ms,e.toBuffer(),t.toBuffer()],a)}function to(a,e,t){return ye([_s,e.toBuffer(),t.toBuffer()],a)}function se(a,e,t){return ye([Vs,e.toBuffer(),En(t)],a)}function yt(a,e,t,n){return ye([$i,e.toBuffer(),En(t),En(n)],a)}function qe(a,e){return ye([$i,e.toBuffer()],a)}function dn(a){return ye([Buffer.from("metadata","utf8"),Pt.toBuffer(),a.toBuffer()],Pt)}function xr(a){return ye([vs],a)}function Ie(a,e){return ye([Ws,e.toBuffer()],a)}function no(a,e){return ye([Es,e.toBuffer()],a)}var ro=Buffer.from("locked_position","utf8");function Sr(a,e){return ye([ro,e.toBuffer()],a)}function io(a,e){return ye([ro,e.toBuffer()],a)}var Jm=Buffer.from("support_mint","utf8");var Fe=require("@solana/web3.js"),Ir=require("@solana/spl-token"),de=Y(require("bn.js")),J=Y(require("decimal.js"));var Je=Y(require("bn.js")),Fn=Y(require("decimal.js"));var pn=class{static getfeeGrowthInside(e,t,n){let r=new Je.default(0),s=new Je.default(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,s=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let i=new Je.default(0),o=new Je.default(0);e.tickCurrent<n.tick?(i=n.feeGrowthOutsideX64A,o=n.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=j.wrappingSubU128(j.wrappingSubU128(e.feeGrowthGlobalX64A,r),i),l=j.wrappingSubU128(j.wrappingSubU128(e.feeGrowthGlobalX64B,s),o);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:l}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:i}=this.getfeeGrowthInside(e,n,r),o=j.mulDivFloor(j.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,De),u=t.tokenFeesOwedA.add(o),l=j.mulDivFloor(j.wrappingSubU128(i,t.feeGrowthInsideLastX64B),t.liquidity,De),c=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:u,tokenFeeAmountB:c}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:i}=this.getfeeGrowthInside(e,n,r),o=j.mulDivFloor(j.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,De),u=t.tokenFeesOwedA.add(o),l=j.mulDivFloor(j.wrappingSubU128(i,t.feeGrowthInsideLastX64B),t.liquidity,De),c=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:u,tokenFeeAmountB:c}}static GetPositionRewardsV2(e,t,n,r){let s=[],i=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let o=0;o<i.length;o++){let u=i[o],l=t.rewardInfos[o],c=j.wrappingSubU128(u,l.growthInsideLastX64),m=j.mulDivFloor(c,t.liquidity,De),p=l.rewardAmountOwed.add(m);s.push(p)}return s}static GetPositionRewards(e,t,n,r){let s=[],i=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let o=0;o<i.length;o++){let u=i[o],l=t.rewardInfos[o],c=j.wrappingSubU128(u,l.growthInsideLastX64),m=j.mulDivFloor(c,t.liquidity,De),p=l.rewardAmountOwed.add(m);s.push(p)}return s}static getRewardGrowthInside(e,t,n,r){let s=[];for(let i=0;i<r.length;i++){let o=new Je.default(0);t.liquidityGross.eqn(0)?o=r[i].rewardGrowthGlobalX64:e<t.tick?o=r[i].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[i]):o=t.rewardGrowthsOutsideX64[i];let u=new Je.default(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[i]:u=r[i].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[i])),s.push(j.wrappingSubU128(j.wrappingSubU128(r[i].rewardGrowthGlobalX64,o),u))}return s}static getRewardGrowthInsideV2(e,t,n,r){let s=[];for(let i=0;i<r.length;i++){let o=new Je.default(0);t.liquidityGross.eqn(0)?o=r[i].rewardGrowthGlobalX64:e<t.tick?o=r[i].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[i]):o=t.rewardGrowthsOutsideX64[i];let u=new Je.default(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[i]:u=r[i].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[i])),s.push(j.wrappingSubU128(j.wrappingSubU128(r[i].rewardGrowthGlobalX64,o),u))}return s}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:s,epochInfo:i}){var w,g,A,T;let o=Q.priceToSqrtPriceX64(new Fn.default(e.price),e.mintA.decimals,e.mintB.decimals),u=Q.getSqrtPriceX64FromTick(t.tickLower),l=Q.getSqrtPriceX64FromTick(t.tickUpper),c=s?1+r:1-r,m=ee.getAmountsFromLiquidity(o,u,l,n,s),[p,d]=[we(m.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,i,!0),we(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,i,!0)],[b,y]=[we(new Je.default(new Fn.default(m.amountA.toString()).mul(c).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,i,!0),we(new Je.default(new Fn.default(m.amountB.toString()).mul(c).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,i,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:y,expirationTime:bt(p.expirationTime,d.expirationTime)}}};var Fs=15,$=class{static async getTickArrays(e,t,n,r,s,i,o){let u=[],l=E.getTickArrayStartIndexByTick(r,s),c=E.getInitializedTickArrayInRange(i,o,s,l,Math.floor(Fs/2));for(let d=0;d<c.length;d++){let{publicKey:b}=se(t,n,c[d]);u.push(b)}let m=(await ct(e,u)).map(d=>d!==null?fn.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let b=m[d];b!==null&&(p[b.startTickIndex]=H(D({},b),{address:u[d]}))}return p}static nextInitializedTick(e,t,n,r,s,i){let{initializedTick:o,tickArrayAddress:u,tickArrayStartTickIndex:l}=this.nextInitializedTickInOneArray(e,t,n,r,s,i);for(;o==null||o.liquidityGross.lten(0);){if(l=E.getNextTickArrayStartIndex(l,s,i),this.checkIsValidStartIndex(l,s))throw new Error("No enough initialized tickArray");let c=n[l];if(c===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,c,i);[o,u,l]=[m,p,d]}if(o==null)throw new Error("No invaild tickArray cache");return{nextTick:o,tickArrayAddress:u,tickArrayStartTickIndex:l}}static nextInitializedTickArray(e,t,n,r,s){let i=Math.floor(e/$.tickCount(t)),o=n?E.searchLowBitFromStart(r,s,i-1,1,t):E.searchHightBitFromStart(r,s,i+1,1,t);return o.length>0?{isExist:!0,nextStartIndex:o[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let s;if(r){let o=Se-1;for(;o>=0;){let u=n.ticks[o];if(u.liquidityGross.gtn(0)){s=u;break}o=o-1}}else{let o=0;for(;o<Se;){let u=n.ticks[o];if(u.liquidityGross.gtn(0)){s=u;break}o=o+1}}let{publicKey:i}=se(e,t,n.startTickIndex);return{nextTick:s,tickArrayAddress:i,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,s,i){let o=E.getTickArrayStartIndexByTick(r,s),u=Math.floor((r-o)/s),l=n[o];if(l==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:o};let c;if(i)for(;u>=0;){let p=l.ticks[u];if(p.liquidityGross.gtn(0)){c=p;break}u=u-1}else for(u=u+1;u<Se;){let p=l.ticks[u];if(p.liquidityGross.gtn(0)){c=p;break}u=u+1}let{publicKey:m}=se(e,t,o);return{initializedTick:c,tickArrayAddress:m,tickArrayStartTickIndex:l.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(E.checkIsOutOfBoundary(e)){if(e>ve)return!1;let n=E.getTickArrayStartIndexByTick(Ne,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Se*e}};var Br=14,mt=class{static maxTickInTickarrayBitmap(e){return e*Se*Nt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let s=n*r;return e<0?{minValue:-s,maxValue:-s+n}:{minValue:s,maxValue:s+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!$.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let s=this.maxTickInTickarrayBitmap(n),i=r?t-$.tickCount(n):t+$.tickCount(n);if(i<-s||i>=s)return{isInit:!1,tickIndex:t};let o=n*Se,u=i/o+512;i<0&&i%o!=0&&u--;let l=Math.abs(u);if(r){let c=e.shln(1024-l-1),m=Zi(1024,c);if(m!==null){let p=(l-m-512)*o;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-s}}else{let c=e.shrn(l),m=Ji(1024,c);if(m!==null){let p=(l+m-512)*o;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:s-$.tickCount(n)}}}},bn=class{static getBitmapOffset(e,t){if(!$.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=mt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=mt.maxTickInTickarrayBitmap(e),n=-t;if(ve<=t)throw Error(`extensionTickBoundary check error: ${ve}, ${t}`);if(n<=Ne)throw Error(`extensionTickBoundary check error: ${n}, ${Ne}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),s=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:E.mergeTickArrayBitmap(r).testn(s),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let s=$.tickCount(t),i=n?e-s:e+s,{tickarrayBitmap:o}=this.getBitmap(i,t,r);return this.nextInitializedTickArrayInBitmap(o,i,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:s,maxValue:i}=mt.getBitmapTickBoundary(t,n),o=this.tickArrayOffsetInBitmap(t,n);if(r){let u=E.mergeTickArrayBitmap(e).shln(Nt-1-o),l=mn(512,u)?null:Pr(512,u);if(l!==null){let c=t-l*$.tickCount(n);return{isInit:!0,tickIndex:c}}else return{isInit:!1,tickIndex:s}}else{let u=E.mergeTickArrayBitmap(e).shrn(o),l=mn(512,u)?null:Tr(512,u);if(l!==null){let c=t+l*$.tickCount(n);return{isInit:!0,tickIndex:c}}else return{isInit:!1,tickIndex:i-$.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%mt.maxTickInTickarrayBitmap(t),r=Math.floor(n/$.tickCount(t));return e<0&&n!=0&&(r=Nt-r),r}};var Ae=class{static getOutputAmountAndRemainAccounts(e,t,n,r,s,i=!1){let o=n.toBase58()===e.mintA.address,u=[],{isExist:l,startIndex:c,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,o);if(!l||c===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:p,amountCalculated:d,accounts:b,sqrtPriceX64:y,feeAmount:w}=Mt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,s,i);return u.push(...b),{allTrade:p,expectedAmountOut:d.mul(lt),remainingAccounts:u,executionPrice:y,feeAmount:w}}static getInputAmountAndRemainAccounts(e,t,n,r,s){let i=n.toBase58()===e.mintB.address,o=[],{isExist:u,startIndex:l,nextAccountMeta:c}=this.getFirstInitializedTickArray(e,i);if(!u||l===void 0||!c)throw new Error("Invalid tick array");try{let y=this.preInitializedTickArrayStartIndex(e,i);if(y.isExist){let{publicKey:w}=se(e.programId,e.id,y.nextStartIndex);o.push(w)}}catch{}o.push(c);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:b}=Mt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,i,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(lt),l,s);return o.push(...p),{expectedAmountIn:m,remainingAccounts:o,executionPrice:d,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Ae.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?bn.checkTickArrayIsInit($.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):E.checkTickArrayIsInitialized(E.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:o}=se(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:o}}let{isExist:s,nextStartIndex:i}=this.nextInitializedTickArrayStartIndex(e,$.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(s){let{publicKey:o}=se(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:o}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/$.tickCount(e.tickSpacing)),r=t?E.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):E.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=$.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:s}=mt.nextInitializedTickArrayStartIndex(E.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:s};t=s;let{isInit:i,tickIndex:o}=bn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(i)return{isExist:!0,nextStartIndex:o};if(t=o,t<Ne||t>ve)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:s}){var o,u,l;let i=[];for(let c=0;c<s.length;c++){let m=s[c],p=(l=(o=t.rewardDefaultInfos[c])==null?void 0:o.mint.programId)!=null?l:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d=H(D({},m),{perSecond:j.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Fe.PublicKey(p)});if(d.tokenMint.equals(Fe.PublicKey.default))continue;if(n<=d.openTime.toNumber()||r.eq(fe)){i.push(d);continue}let b=new de.default(Math.min(d.endTime.toNumber(),n)),y=b.sub(d.lastUpdateTime),w=j.mulDivFloor(y,d.emissionsPerSecondX64,r),g=d.rewardGrowthGlobalX64.add(w),A=j.mulDivFloor(y,d.emissionsPerSecondX64,De),T=d.rewardTotalEmissioned.add(A);i.push(H(D({},d),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:T,lastUpdateTime:b}))}return i}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let s of t){let i=E.getTickArrayStartIndexByTick(s,e);if(i>=n||i<r)return!0}return!1}static tickRange(e){let t=mt.maxTickInTickarrayBitmap(e),n=-t;return t>ve&&(t=$.getArrayStartIndex(ve,e)+$.tickCount(e)),n<Ne&&(n=$.getArrayStartIndex(Ne,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!$.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/$.tickCount(t)*Nt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Bt(e,t.map(i=>({pubkey:i})),{batchRequest:n}),s={};for(let i of r)i.accountInfo!==null&&(s[i.pubkey.toString()]=ao.decode(i.accountInfo.data));return s}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},s=[];for(let u of t){let l=E.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),c=E.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,l,7);for(let m of c){let{publicKey:p}=se(u.programId,u.id,m);s.push({pubkey:p}),r[p.toString()]=u.id}}let i=await Bt(e,s,{batchRequest:n}),o={};for(let u of i){if(!u.accountInfo)continue;let l=r[u.pubkey.toString()];if(!l)continue;o[l.toString()]===void 0&&(o[l.toString()]={});let c=fn.decode(u.accountInfo.data);o[l.toString()][c.startTickIndex]=H(D({},c),{address:u.pubkey})}return o}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:s=!0}){var o;let i=[];for(let u=0;u<e.length;u++){let l=e[u];l!==null&&(i.find(c=>c.equals(l.state.programId))||i.push(l.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),l=[];for(let p of u)for(let d of i)l.push(qe(d,p).publicKey);let c=await ct(t,l,{batchRequest:r}),m={};for(let p of c){if(p===null)continue;let d=so.decode(p.data),b=d.poolId.toString(),y=e.find(K=>K.state.id.toBase58()===b);if(y===void 0)continue;let w=y.state,g=E._getTickPriceLegacy({poolInfo:w,tick:d.tickLower,baseIn:!0}),A=E._getTickPriceLegacy({poolInfo:w,tick:d.tickUpper,baseIn:!0}),{amountA:T,amountB:h}=ee.getAmountsFromLiquidity(w.sqrtPriceX64,g.tickSqrtPriceX64,A.tickSqrtPriceX64,d.liquidity,!1),P=1/(1-Math.sqrt(Math.sqrt(g.price.div(A.price).toNumber())));y.positionAccount=[...(o=y.positionAccount)!=null?o:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:g.price,priceUpper:A.price,amountA:T,amountB:h,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(K=>H(D({},K),{pendingReward:new de.default(0)})),leverage:P,tokenFeeAmountA:new de.default(0),tokenFeeAmountB:new de.default(0)}];let k=await E.getTickArrayAddressByTick(y.state.programId,d.poolId,d.tickLower,y.state.tickSpacing),B=await E.getTickArrayAddressByTick(y.state.programId,d.poolId,d.tickUpper,y.state.tickSpacing);m[`${y.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=k,m[`${y.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=B}if(s){let p=Object.values(m),d=await ct(t,p,{batchRequest:r}),b={};for(let y=0;y<p.length;y++){let w=d[y];if(w===null)continue;let g=p[y].toString();b[g]=fn.decode(w.data)}for(let{state:y,positionAccount:w}of e)if(!!w)for(let g of w){let A=`${y.programId.toString()}-${y.id.toString()}-${g.tickLower}`,T=`${y.programId.toString()}-${y.id.toString()}-${g.tickUpper}`,h=b[m[A].toString()],P=b[m[T].toString()],k=h.ticks[E.getTickOffsetInArray(g.tickLower,y.tickSpacing)],B=P.ticks[E.getTickOffsetInArray(g.tickUpper,y.tickSpacing)],{tokenFeeAmountA:K,tokenFeeAmountB:R}=await pn.GetPositionFees(y,g,k,B),S=await pn.GetPositionRewards(y,g,k,B);g.tokenFeeAmountA=K.gte(new de.default(0))?K:new de.default(0),g.tokenFeeAmountB=R.gte(new de.default(0))?R:new de.default(0);for(let M=0;M<S.length;M++)g.rewardInfos[M].pendingReward=S[M].gte(new de.default(0))?S[M]:new de.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:s,slippage:i,priceLimit:o=new J.default(0),catchLiquidityInsufficient:u=!1}){var V;let l,c=n.toBase58()===e.mintA.address,[m,p]=c?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];o.equals(new J.default(0))?l=c?Rt.add(new de.default(1)):Ct.sub(new de.default(1)):l=Q.priceToSqrtPriceX64(o,e.mintA.decimals,e.mintB.decimals);let d=we(s,m,r,!1),{allTrade:b,expectedAmountOut:y,remainingAccounts:w,executionPrice:g,feeAmount:A}=Ae.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((V=d.fee)!=null?V:fe),l,u),T=we(y,p,r,!1),h=Q.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),P=c?h:new J.default(1).div(h),k=y.mul(new de.default(Math.floor((1-i)*1e10))).div(new de.default(1e10)),B=we(k,p,r,!1),K=c?e.currentPrice:new J.default(1).div(e.currentPrice),R=new J.default(P).sub(K).abs(),S=K,M=new Qe(new J.default(R).mul(10**15).toFixed(0),new J.default(S).mul(10**15).toFixed(0));return{allTrade:b,realAmountIn:d,amountOut:T,minAmountOut:B,expirationTime:bt(d.expirationTime,T.expirationTime),currentPrice:e.currentPrice,executionPrice:P,priceImpact:M,fee:A,remainingAccounts:w,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:s,epochInfo:i,catchLiquidityInsufficient:o=!1}){let u=r.address===e.mintB.address,[l,c]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,p]=[new Le(H(D({},l),{mint:l.address,isToken2022:l.programId===Ir.TOKEN_2022_PROGRAM_ID.toBase58()})),new Le(H(D({},c),{mint:c.address,isToken2022:c.programId===Ir.TOKEN_2022_PROGRAM_ID.toBase58()}))],{allTrade:d,realAmountIn:b,amountOut:y,minAmountOut:w,expirationTime:g,currentPrice:A,executionPrice:T,priceImpact:h,fee:P,remainingAccounts:k,executionPriceX64:B}=Ae.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Fe.PublicKey(l.address),amountIn:n,slippage:s,epochInfo:i,catchLiquidityInsufficient:o}),K=H(D({},b),{amount:new ge(m,b.amount),fee:b.fee===void 0?void 0:new ge(m,b.fee)}),R=H(D({},y),{amount:new ge(p,y.amount),fee:y.fee===void 0?void 0:new ge(p,y.fee)}),S=H(D({},w),{amount:new ge(p,w.amount),fee:w.fee===void 0?void 0:new ge(p,w.fee)}),M=new ze({baseToken:m,denominator:new de.default(10).pow(new de.default(20+m.decimals)),quoteToken:p,numerator:A.mul(new J.default(10**(20+p.decimals))).toFixed(0)}),V=new ze({baseToken:m,denominator:new de.default(10).pow(new de.default(20+m.decimals)),quoteToken:p,numerator:T.mul(new J.default(10**(20+p.decimals))).toFixed(0)}),_=new ge(m,P);return{allTrade:d,realAmountIn:K,amountOut:R,minAmountOut:S,expirationTime:g,currentPrice:M,executionPrice:V,priceImpact:h,fee:_,remainingAccounts:k,executionPriceX64:B}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:s,slippage:i,priceLimit:o=new J.default(0)}){var S;let u=n.toBase58()===e.mintA.address,l={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},c;o.equals(new J.default(0))?c=u?Ct.sub(new de.default(1)):Rt.add(new de.default(1)):c=Q.priceToSqrtPriceX64(o,e.mintA.decimals,e.mintB.decimals);let m=we(s,l[n.toString()],r,!0),{expectedAmountIn:p,remainingAccounts:d,executionPrice:b,feeAmount:y}=Ae.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((S=m.fee)!=null?S:fe),c),w=u?e.mintB.address:e.mintA.address,g=we(p,l[w],r,!1),A=Q.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),T=u?A:new J.default(1).div(A),h=p.mul(new de.default(Math.floor((1+i)*1e10))).div(new de.default(1e10)),P=we(h,l[w],r,!0),k=u?e.currentPrice:new J.default(1).div(e.currentPrice),B=new J.default(T).sub(k).abs(),K=k,R=new Qe(new J.default(B).mul(10**15).toFixed(0),new J.default(K).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:P,realAmountOut:m,expirationTime:bt(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:T,priceImpact:R,fee:y,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var b,y,w;let s=e[t],i=E.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),o=E.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(i,s.priceMin),c=Math.min(o,s.priceMax)-u,m=o-i,p=s.priceMax-s.priceMin,d;return c<=0?d=0:m===c?d=p/c:p===c?d=c/m:d=c/p*(c/m),{feeApr:s.feeApr*d,rewardsApr:[((b=s.rewardApr[0])!=null?b:0)*d,((y=s.rewardApr[1])!=null?y:0)*d,((w=s.rewardApr[2])!=null?w:0)*d],apr:s.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:s,positionTickLowerIndex:i,positionTickUpperIndex:o,chainTime:u}){let l=n==="day"?1:n==="week"?7:n==="month"?30:0,c=e[n],m=r[qt(e.mintA.address).toString()],p=r[qt(e.mintB.address).toString()],d=e.mintA.decimals,b=e.mintB.decimals;if(!c||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let y=Q.priceToSqrtPriceX64(new J.default(e.price),e.mintA.decimals,e.mintB.decimals),w=Q.getSqrtPriceX64FromTick(i),g=Q.getSqrtPriceX64FromTick(o),{amountSlippageA:A,amountSlippageB:T}=ee.getAmountsFromLiquidityWithSlippage(y,w,g,t,!1,!1,0),{amountSlippageA:h,amountSlippageB:P}=ee.getAmountsFromLiquidityWithSlippage(y,w,g,s,!1,!1,0),k=new J.default(A.toString()).div(new J.default(10).pow(d)).mul(m.value).add(new J.default(T.toString()).div(new J.default(10).pow(b)).mul(p.value)),B=new J.default(h.toString()).div(new J.default(10).pow(d)).mul(m.value).add(new J.default(P.toString()).div(new J.default(10).pow(b)).mul(p.value)),K=new J.default(1).div(k.add(B)),S=new J.default(c.volumeFee).mul(365).div(l).mul(K).mul(100).toNumber(),M=3600*24*365,V=e.rewardDefaultInfos.map(_=>{var ne,ae;let U=_.mint.decimals,te=r[_.mint.address];return u<((ne=_.startTime)!=null?ne:0)||u>((ae=_.endTime)!=null?ae:0)||!_.perSecond||!te||U===void 0?0:new J.default(te.value).mul(new J.default(_.perSecond).mul(M)).div(new J.default(10).pow(U)).mul(K).mul(100).toNumber()});return{feeApr:S,rewardsApr:V,apr:S+V.reduce((_,U)=>_+U,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:s,slippage:i,add:o,epochInfo:u,amountHasFee:l}){var g,A;let c=Q.priceToSqrtPriceX64(new J.default(e.price),e.mintA.decimals,e.mintB.decimals),m=Q.getSqrtPriceX64FromTick(n),p=Q.getSqrtPriceX64FromTick(r),d=we(s,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!l),b=new de.default(new J.default(d.amount.sub((A=d.fee)!=null?A:fe).toString()).toFixed(0)),y;if(c.lte(m))y=t?ee.getLiquidityFromTokenAmountA(m,p,b,!o):new de.default(0);else if(c.lte(p)){let T=ee.getLiquidityFromTokenAmountA(c,p,b,!o),h=ee.getLiquidityFromTokenAmountB(m,c,b);y=t?T:h}else y=t?new de.default(0):ee.getLiquidityFromTokenAmountB(m,p,b);let w=await Ae.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:i,add:o});return{liquidity:y,amountA:t?d:w.amountA,amountB:t?w.amountB:d,amountSlippageA:t?d:w.amountSlippageA,amountSlippageB:t?w.amountSlippageB:d,expirationTime:w.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:s,slippage:i,add:o}){var w,g,A,T;let u=Q.getSqrtPriceX64FromTick(n),l=Q.getSqrtPriceX64FromTick(r),c=o?1+i:1-i,m=ee.getAmountsFromLiquidity(Q.priceToSqrtPriceX64(new J.default(t.price),t.mintA.decimals,t.mintB.decimals),u,l,s,o),[p,d]=[we(m.amountA,(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),we(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[b,y]=[we(m.amountA.muln(c),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),we(m.amountB.muln(c),(T=t.mintB.extensions)==null?void 0:T.feeConfig,e,!0)];return{liquidity:s,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:y,expirationTime:bt(p.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Fe.PublicKey(u.id));(await ct(e,r)).forEach((u,l)=>{!u||(n[r[l].toBase58()]=oo.decode(u.data))});let i=t.map(u=>Ie(new Fe.PublicKey(u.programId),new Fe.PublicKey(u.id)).publicKey),o=await Ae.fetchExBitmaps({connection:e,exBitmapAddress:i,batchRequest:!1});return t.reduce((u,l)=>H(D({},u),{[l.id]:H(D({},n[l.id]),{id:new Fe.PublicKey(l.id),version:6,programId:new Fe.PublicKey(l.programId),mintA:l.mintA,mintB:l.mintB,ammConfig:H(D({},l.config),{id:new Fe.PublicKey(l.config.id),fundOwner:""}),currentPrice:new J.default(l.price),exBitmapAccount:Ie(new Fe.PublicKey(l.programId),new Fe.PublicKey(l.id)).publicKey,exBitmapInfo:o[Ie(new Fe.PublicKey(l.programId),new Fe.PublicKey(l.id)).publicKey.toBase58()],startTime:n[l.id].startTime.toNumber(),rewardInfos:n[l.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var j=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),s=r.div(n);return r.mod(n).eq(fe)||(s=s.add(it)),s}static mulDivFloor(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).add(n.sub(it)).div(n)}static x64ToDecimal(e,t){return new $e.default(e.toString()).div($e.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new z.default(e.mul($e.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(vn).sub(t).mod(vn)}};function Be(a,e){return Kr(a.mul(e),64,256)}function Os(a,e,t){let n=a.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Kr(a,e,t){let n=a.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var Q=class{static sqrtPriceX64ToPrice(e,t,n){return j.x64ToDecimal(e).pow(2).mul($e.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return j.decimalToX64(e.mul($e.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(fe))return e;let s=t.shln(ln);if(r){let i=s,o=s.add(n.mul(e));return o.gte(i)?j.mulDivCeil(i,e,o):j.mulDivRoundingUp(i,it,i.div(e).add(n))}else{let i=n.mul(e);if(!s.gt(i))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let o=s.sub(i);return j.mulDivCeil(s,e,o)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let s=n.shln(ln);if(r)return e.add(s.div(t));{let i=j.mulDivRoundingUp(s,it,t);if(!e.gt(i))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(i)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ne||e>ve)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new z.default("18445821805675395072"):new z.default("18446744073709551616");return(t&2)!=0&&(n=Be(n,new z.default("18444899583751176192"))),(t&4)!=0&&(n=Be(n,new z.default("18443055278223355904"))),(t&8)!=0&&(n=Be(n,new z.default("18439367220385607680"))),(t&16)!=0&&(n=Be(n,new z.default("18431993317065453568"))),(t&32)!=0&&(n=Be(n,new z.default("18417254355718170624"))),(t&64)!=0&&(n=Be(n,new z.default("18387811781193609216"))),(t&128)!=0&&(n=Be(n,new z.default("18329067761203558400"))),(t&256)!=0&&(n=Be(n,new z.default("18212142134806163456"))),(t&512)!=0&&(n=Be(n,new z.default("17980523815641700352"))),(t&1024)!=0&&(n=Be(n,new z.default("17526086738831433728"))),(t&2048)!=0&&(n=Be(n,new z.default("16651378430235570176"))),(t&4096)!=0&&(n=Be(n,new z.default("15030750278694412288"))),(t&8192)!=0&&(n=Be(n,new z.default("12247334978884435968"))),(t&16384)!=0&&(n=Be(n,new z.default("8131365268886854656"))),(t&32768)!=0&&(n=Be(n,new z.default("3584323654725218816"))),(t&65536)!=0&&(n=Be(n,new z.default("696457651848324352"))),(t&131072)!=0&&(n=Be(n,new z.default("26294789957507116"))),(t&262144)!=0&&(n=Be(n,new z.default("37481735321082"))),e>0&&(n=Qi.div(n)),n}static getTickFromPrice(e,t,n){return Q.getTickFromSqrtPriceX64(Q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ct)||e.lt(Rt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new z.default(t-64),r=Os(n,32,128),s=new z.default("8000000000000000","hex"),i=0,o=new z.default(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;s.gt(new z.default(0))&&i<zi;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),o=o.add(s.mul(b)),s=s.shrn(1),i+=1}let l=o.shrn(32),m=r.add(l).mul(new z.default(ji)),p=Kr(m.sub(new z.default(Hi)),64,128).toNumber(),d=Kr(m.add(new z.default(Yi)),64,128).toNumber();return p==d?p:Q.getSqrtPriceX64FromTick(d).lte(e)?d:p}},_t=class{static getTickWithPriceAndTickspacing(e,t,n,r){let i=Q.getTickFromSqrtPriceX64(Q.priceToSqrtPriceX64(e,n,r))/t;return i<0?i=Math.floor(i):i=Math.ceil(i),i*t}static roundPriceWithTickspacing(e,t,n,r){let s=_t.getTickWithPriceAndTickspacing(e,t,n,r),i=Q.getSqrtPriceX64FromTick(s);return Q.sqrtPriceX64ToPrice(i,n,r)}},ee=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");let s=n.ushln(ln),i=t.sub(e);return r?j.mulDivRoundingUp(j.mulDivCeil(s,i,t),it,e):j.mulDivFloor(s,i,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");return r?j.mulDivCeil(n,t.sub(e),De):j.mulDivFloor(n,t.sub(e),De)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let s=n.mul(e).mul(t),i=t.sub(e),o=s.div(i);return r?j.mulDivRoundingUp(o,it,Ar):o.shrn(ln)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),j.mulDivFloor(n,Ar,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ee.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let i=ee.getLiquidityFromTokenAmountA(e,n,r,!1),o=ee.getLiquidityFromTokenAmountB(t,e,s);return i.lt(o)?i:o}else return ee.getLiquidityFromTokenAmountB(t,n,s)}static getAmountsFromLiquidity(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ee.getTokenAmountAFromLiquidity(t,n,r,s),amountB:new z.default(0)};if(e.lt(n)){let i=ee.getTokenAmountAFromLiquidity(e,n,r,s),o=ee.getTokenAmountBFromLiquidity(t,e,r,s);return{amountA:i,amountB:o}}else return{amountA:new z.default(0),amountB:ee.getTokenAmountBFromLiquidity(t,n,r,s)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,s,i,o){let{amountA:u,amountB:l}=ee.getAmountsFromLiquidity(e,t,n,r,i),c=s?1+o:1-o,m=new z.default(new $e.default(u.toString()).mul(c).toFixed(0)),p=new z.default(new $e.default(l.toString()).mul(c).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:s,add:i,epochInfo:o,amountAddFee:u}){var A,T,h,P;let l=Q.priceToSqrtPriceX64(new $e.default(e.price),e.mintA.decimals,e.mintB.decimals),c=Q.getSqrtPriceX64FromTick(t),m=Q.getSqrtPriceX64FromTick(n),p=i?1+s:1-s,d=ee.getAmountsFromLiquidity(l,c,m,r,i),[b,y]=[we(d.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,o,u),we(d.amountB,(T=e.mintB.extensions)==null?void 0:T.feeConfig,o,u)],[w,g]=[we(new z.default(new $e.default(d.amountA.toString()).mul(p).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,o,u),we(new z.default(new $e.default(d.amountB.toString()).mul(p).toFixed(0)),(P=e.mintB.extensions)==null?void 0:P.feeConfig,o,u)];return{liquidity:r,amountA:b,amountB:y,amountSlippageA:w,amountSlippageB:g,expirationTime:bt(b.expirationTime,y.expirationTime)}}},Mt=class{static swapCompute(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y=!1){if(p.eq(fe))throw new Error("amountSpecified must not be 0");if(b||(b=i?Rt.add(it):Ct.sub(it)),i){if(b.lt(Rt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(Ct))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let w=p.gt(fe),g={amountSpecifiedRemaining:p,amountCalculated:fe,sqrtPriceX64:m,tick:l>d?Math.min(d+$.tickCount(c)-1,l):d,accounts:[],liquidity:u,feeAmount:new z.default(0)},A=d,T=n[d],h=0,P=!i&&T.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(fe)&&!g.sqrtPriceX64.eq(b);){h>10;let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let B=E.nextInitTick(T,g.tick,c,i,P),K=B||null,R=null;if(!(K!=null&&K.liquidityGross.gtn(0))){let M=Ae.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:c,tickArrayBitmap:r,exBitmapInfo:s},A,i);if(!M.isExist){if(y)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=M.nextStartIndex;let{publicKey:V}=se(e,t,A);R=V,T=n[A];try{K=E.firstInitializedTick(T,i)}catch{throw Error("not found next tick info")}}k.tickNext=K.tick,k.initialized=K.liquidityGross.gtn(0),d!==A&&R&&(g.accounts.push(R),d=A),k.tickNext<Ne?k.tickNext=Ne:k.tickNext>ve&&(k.tickNext=ve),k.sqrtPriceNextX64=Q.getSqrtPriceX64FromTick(k.tickNext);let S;if(i&&k.sqrtPriceNextX64.lt(b)||!i&&k.sqrtPriceNextX64.gt(b)?S=b:S=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=Mt.swapStepCompute(g.sqrtPriceX64,S,g.liquidity,g.amountSpecifiedRemaining,o,i),g.feeAmount=g.feeAmount.add(k.feeAmount),w?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let M=K.liquidityNet;i&&(M=M.mul(lt)),g.liquidity=ee.addDelta(g.liquidity,M)}P=k.tickNext!=g.tick&&!i&&T.startTickIndex===k.tickNext,g.tick=i?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let M=Q.getTickFromSqrtPriceX64(g.sqrtPriceX64);P=M!=g.tick&&!i&&T.startTickIndex===M,g.tick=M}++h}try{let{nextStartIndex:k,isExist:B}=$.nextInitializedTickArray(g.tick,c,i,r,s);B&&d!==k&&(g.accounts.push(se(e,t,k).publicKey),d=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:fe,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,s,i){let o={sqrtPriceX64Next:new z.default(0),amountIn:new z.default(0),amountOut:new z.default(0),feeAmount:new z.default(0)},u=r.gte(fe);if(u){let c=j.mulDivFloor(r,Wn.sub(new z.default(s.toString())),Wn);o.amountIn=i?ee.getTokenAmountAFromLiquidity(t,e,n,!0):ee.getTokenAmountBFromLiquidity(e,t,n,!0),c.gte(o.amountIn)?o.sqrtPriceX64Next=t:o.sqrtPriceX64Next=Q.getNextSqrtPriceX64FromInput(e,n,c,i)}else o.amountOut=i?ee.getTokenAmountBFromLiquidity(t,e,n,!1):ee.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(lt).gte(o.amountOut)?o.sqrtPriceX64Next=t:o.sqrtPriceX64Next=Q.getNextSqrtPriceX64FromOutput(e,n,r.mul(lt),i);let l=t.eq(o.sqrtPriceX64Next);return i?(l&&u||(o.amountIn=ee.getTokenAmountAFromLiquidity(o.sqrtPriceX64Next,e,n,!0)),l&&!u||(o.amountOut=ee.getTokenAmountBFromLiquidity(o.sqrtPriceX64Next,e,n,!1))):(o.amountIn=l&&u?o.amountIn:ee.getTokenAmountBFromLiquidity(e,o.sqrtPriceX64Next,n,!0),o.amountOut=l&&!u?o.amountOut:ee.getTokenAmountAFromLiquidity(e,o.sqrtPriceX64Next,n,!1)),!u&&o.amountOut.gt(r.mul(lt))&&(o.amountOut=r.mul(lt)),u&&!o.sqrtPriceX64Next.eq(t)?o.feeAmount=r.sub(o.amountIn):o.feeAmount=j.mulDivCeil(o.amountIn,new z.default(s),Wn.sub(new z.default(s))),[o.sqrtPriceX64Next,o.amountIn,o.amountOut,o.feeAmount]}};var Se=60,Nt=512,E=class{static getTickArrayAddressByTick(e,t,n,r){let s=E.getTickArrayStartIndexByTick(n,r),{publicKey:i}=se(e,t,s);return i}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=E.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Se)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=$.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*$.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Se,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Se,s=Math.floor(t/r)+512,i=Math.abs(s);return{isInitialized:e.testn(i),startIndex:(i-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Se:e+t*Se}static mergeTickArrayBitmap(e){let t=new uo.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,s){let i=Math.floor(r/(n*Se));return[...E.searchLowBitFromStart(e,t,i-1,s,n),...E.searchHightBitFromStart(e,t,i,s,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return E.searchHightBitFromStart(e,t,-7680,Nt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,s){let i=[],o=E.getAllInitializedTickArrayStartIndex(n,r,s);for(let u of o){let{publicKey:l}=se(e,t,u);i.push({tickArrayStartIndex:u,tickArrayAddress:l})}return i}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,s){let i=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>E.mergeTickArrayBitmap(l)),o=[];for(;n>=-7680;){let l=Math.floor((n+7680)/512),c=(n+7680)%512;if(i[l].testn(c)&&o.push(n),n--,o.length===r)break}let u=$.tickCount(s);return o.map(l=>l*u)}static searchHightBitFromStart(e,t,n,r,s){let i=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>E.mergeTickArrayBitmap(l)),o=[];for(;n<7680;){let l=Math.floor((n+7680)/512),c=(n+7680)%512;if(i[l].testn(c)&&o.push(n),n++,o.length===r)break}let u=$.tickCount(s);return o.map(l=>l*u)}static checkIsOutOfBoundary(e){return e<Ne||e>ve}static nextInitTick(e,t,n,r,s){if($.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let o=Math.floor((t-e.startTickIndex)/n);if(r)for(;o>=0;){if(e.ticks[o].liquidityGross.gtn(0))return e.ticks[o];o=o-1}else for(s||(o=o+1);o<Se;){if(e.ticks[o].liquidityGross.gtn(0))return e.ticks[o];o=o+1}return null}static firstInitializedTick(e,t){if(t){let n=Se-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Se;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=Q.getSqrtPriceX64FromTick(t),s=Q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new Vt.default(1).div(s),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new Vt.default(1).div(t),s=_t.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),i=Q.getSqrtPriceX64FromTick(s),o=Q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:o}:{tick:s,price:new Vt.default(1).div(o)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=Q.getSqrtPriceX64FromTick(t),s=Q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new Vt.default(1).div(s),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new Vt.default(1).div(t),s=_t.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),i=Q.getSqrtPriceX64FromTick(s),o=Q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:o}:{tick:s,price:new Vt.default(1).div(o)}}};var Yd=C([he(8),v("bump"),It("index"),L(""),Ce("protocolFeeRate"),Ce("tradeFeeRate"),It("tickSpacing"),G(f(),8,"")]),Ds=C([Ce("blockTimestamp"),Qt("tickCumulative"),G(f(),4)]),co=C([he(8),xe("initialized"),f("recentEpoch"),It("observationIndex"),L("poolId"),G(Ds,100,"observations"),G(f(),4)]),qs=C([v("rewardState"),f("openTime"),f("endTime"),f("lastUpdateTime"),q("emissionsPerSecondX64"),f("rewardTotalEmissioned"),f("rewardClaimed"),L("tokenMint"),L("tokenVault"),L("creator"),q("rewardGrowthGlobalX64")]),oo=C([he(8),v("bump"),L("ammConfig"),L("creator"),L("mintA"),L("mintB"),L("vaultA"),L("vaultB"),L("observationId"),v("mintDecimalsA"),v("mintDecimalsB"),It("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),pe("tickCurrent"),Ce(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),f("protocolFeesTokenA"),f("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),v("status"),G(v(),7,""),G(qs,3,"rewardInfos"),G(f(),16,"tickArrayBitmap"),f("totalFeesTokenA"),f("totalFeesClaimedTokenA"),f("totalFeesTokenB"),f("totalFeesClaimedTokenB"),f("fundFeesTokenA"),f("fundFeesTokenB"),f("startTime"),G(f(),15*4-3,"padding")]),Gs=C([q("growthInsideLastX64"),f("rewardAmountOwed")]),so=C([he(8),v("bump"),L("nftMint"),L("poolId"),pe("tickLower"),pe("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),f("tokenFeesOwedA"),f("tokenFeesOwedB"),G(Gs,3,"rewardInfos"),G(f(),8,"")]),Zd=C([he(8),v("bump"),L("poolId"),pe("tickLowerIndex"),pe("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),f("tokenFeesOwedA"),f("tokenFeesOwedB"),G(q(),3,"rewardGrowthInside"),G(f(),8,"")]),Us=C([pe("tick"),Wi("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),G(q(),3,"rewardGrowthsOutsideX64"),G(Ce(),13,"")]),fn=C([he(8),L("poolId"),pe("startTickIndex"),G(Us,Se,"ticks"),v("initializedTickCount"),G(v(),115,"")]),Jd=C([he(329),G(L(),100,"whitelistMints")]),ao=C([he(8),L("poolId"),G(G(f(),8),Br,"positiveTickArrayBitmap"),G(G(f(),8),Br,"negativeTickArrayBitmap")]),$d=C([f(),v("bump"),L("owner"),L("poolId"),L("positionId"),L("nftAccount"),G(f(),8)]),ep=C([he(8),v("bump"),L("lockOwner"),L("poolId"),L("positionId"),L("nftAccount"),L("lockNftMint"),f("recentEpoch"),G(f(),8)]);co.span;var lo=ue("Raydium_Clmm"),Ge={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},mo=[188,37,179,131,82,150,84,73],po=[16,72,250,198,14,162,212,19],Ht=class{static createPoolInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,b){let y=C([q("sqrtPriceX64"),f("zero")]),w=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},...(b==null?void 0:b.map(T=>({pubkey:T,isSigner:!1,isWritable:!1})))||[]],g=Buffer.alloc(y.span);y.encode({sqrtPriceX64:d,zero:fe},g);let A=Buffer.from([...Ge.createPool,...g]);return new x.TransactionInstruction({keys:w,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:s,ammConfigId:i,initialPriceX64:o,extendMintAccount:u}=e,[l,c]=[new x.PublicKey(r.address),new x.PublicKey(s.address)],{publicKey:m}=eo(t,i,l,c),{publicKey:p}=no(t,m),{publicKey:d}=hr(t,m,l),{publicKey:b}=hr(t,m,c),y=Ie(t,m).publicKey,w=[this.createPoolInstruction(t,m,n,i,p,l,d,new x.PublicKey(r.programId||W.TOKEN_PROGRAM_ID),c,b,new x.PublicKey(s.programId||W.TOKEN_PROGRAM_ID),y,o,u)];return{signers:[],instructions:w,instructionTypes:[X.CreateAccount,X.ClmmCreatePool],address:{poolId:m,observationId:p,exBitmapAccount:y,mintAVault:d,mintBVault:b},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g,A,T,h,P,k,B,K,R,S){let M=C([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),q("liquidity"),f("amountMaxA"),f("amountMaxB"),xe("withMetadata"),v("optionBaseFlag"),xe("baseFlag")]),V=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],_=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...V],U=Buffer.alloc(M.span);M.encode({tickLowerIndex:A,tickUpperIndex:T,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:P,liquidity:k,amountMaxA:B,amountMaxB:K,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},U);let te=Buffer.from([...Ge.openPosition,...U]);return new x.TransactionInstruction({keys:_,programId:e,data:te})}static openPositionFromLiquidityInstruction22(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g,A,T,h,P,k,B,K,R){let S=C([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),q("liquidity"),f("amountMaxA"),f("amountMaxB"),xe("withMetadata"),v("optionBaseFlag"),xe("baseFlag")]),M=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],V=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...M],_=Buffer.alloc(S.span);S.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:h,liquidity:P,amountMaxA:k,amountMaxB:B,withMetadata:K==="create",baseFlag:!1,optionBaseFlag:0},_);let U=Buffer.from([...Ge.openPositionWithTokenEx,..._]);return new x.TransactionInstruction({keys:V,programId:e,data:U})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:s,liquidity:i,amountMaxA:o,amountMaxB:u,withMetadata:l,getEphemeralSigners:c,nft2022:m}){let p=[],[d,b]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],y;if(c)y=new x.PublicKey((await c(1))[0]);else{let R=x.Keypair.generate();p.push(R),y=R.publicKey}let w=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=E.getTickArrayStartIndexByTick(s,e.config.tickSpacing),{publicKey:A}=se(d,b,w),{publicKey:T}=se(d,b,g),{publicKey:h}=m?me(n.wallet,y,W.TOKEN_2022_PROGRAM_ID):me(n.wallet,y,W.TOKEN_PROGRAM_ID),{publicKey:P}=dn(y),{publicKey:k}=qe(d,y),{publicKey:B}=yt(d,b,r,s),K=m?this.openPositionFromLiquidityInstruction22(d,n.feePayer,b,n.wallet,y,h,B,A,T,k,n.tokenAccountA,n.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address),r,s,w,g,i,o,u,l,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Ie(d,b).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,b,n.wallet,y,h,P,B,A,T,k,n.tokenAccountA,n.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address),r,s,w,g,i,o,u,l,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Ie(d,b).publicKey:void 0);return{signers:p,instructions:[K],instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:h,metadataAccount:P,personalPosition:k,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:s,base:i,baseAmount:o,otherAmountMax:u,withMetadata:l,getEphemeralSigners:c,nft2022:m}){let p=[],[d,b]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],y;if(c)y=new x.PublicKey((await c(1))[0]);else{let R=x.Keypair.generate();p.push(R),y=R.publicKey}let w=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=E.getTickArrayStartIndexByTick(s,e.config.tickSpacing),{publicKey:A}=se(d,b,w),{publicKey:T}=se(d,b,g),{publicKey:h}=m?me(n.wallet,y,W.TOKEN_2022_PROGRAM_ID):me(n.wallet,y,W.TOKEN_PROGRAM_ID),{publicKey:P}=dn(y),{publicKey:k}=qe(d,y),{publicKey:B}=yt(d,b,r,s),K=m?this.openPositionFromBaseInstruction22(d,n.feePayer,b,n.wallet,y,h,B,A,T,k,n.tokenAccountA,n.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address),r,s,w,g,l,i,o,u,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Ie(d,b).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,b,n.wallet,y,h,P,B,A,T,k,n.tokenAccountA,n.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address),r,s,w,g,l,i,o,u,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Ie(d,b).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:h,metadataAccount:P,personalPosition:k,protocolPosition:B},instructions:[K],signers:p,instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g,A,T,h,P,k,B,K,R,S){let M=C([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),q("liquidity"),f("amountMaxA"),f("amountMaxB"),xe("withMetadata"),v("optionBaseFlag"),xe("baseFlag")]),V=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],_=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...V],U=Buffer.alloc(M.span);M.encode({tickLowerIndex:A,tickUpperIndex:T,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:P,liquidity:new On.default(0),amountMaxA:B==="MintA"?K:R,amountMaxB:B==="MintA"?R:K,withMetadata:k==="create",baseFlag:B==="MintA",optionBaseFlag:1},U);let te=Buffer.from([...Ge.openPosition,...U]);return new x.TransactionInstruction({keys:_,programId:e,data:te})}static openPositionFromBaseInstruction22(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g,A,T,h,P,k,B,K,R){let S=C([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),q("liquidity"),f("amountMaxA"),f("amountMaxB"),xe("withMetadata"),v("optionBaseFlag"),xe("baseFlag")]),M=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],V=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...M],_=Buffer.alloc(S.span);S.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:h,liquidity:new On.default(0),amountMaxA:k==="MintA"?B:K,amountMaxB:k==="MintA"?K:B,withMetadata:P==="create",baseFlag:k==="MintA",optionBaseFlag:1},_);let U=Buffer.from([...Ge.openPositionWithTokenEx,..._]);return new x.TransactionInstruction({keys:V,programId:e,data:U})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:s,liquidity:i,amountMaxA:o,amountMaxB:u,withMetadata:l,getEphemeralSigners:c,nft2022:m}){let p,d=[];if(c)p=new x.PublicKey((await c(1))[0]);else{let R=x.Keypair.generate();d.push(R),p=R.publicKey}let[b,y]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],w=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=E.getTickArrayStartIndexByTick(s,e.config.tickSpacing),{publicKey:A}=se(b,y,w),{publicKey:T}=se(b,y,g),{publicKey:h}=m?me(n.wallet,p,W.TOKEN_2022_PROGRAM_ID):me(n.wallet,p,W.TOKEN_PROGRAM_ID),{publicKey:P}=dn(p),{publicKey:k}=qe(b,p),{publicKey:B}=yt(b,y,r,s),K=m?this.openPositionFromLiquidityInstruction22(b,n.wallet,y,n.wallet,p,h,B,A,T,k,n.tokenAccountA,n.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(t.mintA.address),new x.PublicKey(t.mintB.address),r,s,w,g,i,o,u,l,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Ie(b,y).publicKey:void 0):this.openPositionFromLiquidityInstruction(b,n.wallet,y,n.wallet,p,h,P,B,A,T,k,n.tokenAccountA,n.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(t.mintA.address),new x.PublicKey(t.mintB.address),r,s,w,g,i,o,u,l,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Ie(b,y).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:h,metadataAccount:P,personalPosition:k,protocolPosition:B},instructions:[K],signers:d,instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,s,i){let o=C([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:i?W.TOKEN_2022_PROGRAM_ID:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],l=Buffer.alloc(o.span);o.encode({},l);let c=Buffer.from([...Ge.closePosition,...l]);return new x.TransactionInstruction({keys:u,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:s}){let i=new x.PublicKey(e.programId),o=s?me(n.wallet,r.nftMint,W.TOKEN_2022_PROGRAM_ID).publicKey:me(n.wallet,r.nftMint,W.TOKEN_PROGRAM_ID).publicKey,{publicKey:u}=qe(i,r.nftMint),l=[];return l.push(this.closePositionInstruction(i,n.wallet,r.nftMint,o,u,s)),{address:{positionNftAccount:o,personalPosition:u},signers:[],instructions:l,instructionTypes:[X.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g,A){let T=C([q("liquidity"),f("amountMaxA"),f("amountMaxB"),v("optionBaseFlag"),xe("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(T.span);T.encode({liquidity:y,amountMaxA:w,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},k);let B=Buffer.from([...Ge.increaseLiquidity,...k]);return new x.TransactionInstruction({keys:P,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:s,amountMaxA:i,amountMaxB:o,nft2022:u}){let[l,c]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],m=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(l,c,m),{publicKey:b}=se(l,c,p),{publicKey:y}=u?me(r.wallet,n.nftMint,W.TOKEN_2022_PROGRAM_ID):me(r.wallet,n.nftMint,W.TOKEN_PROGRAM_ID),{publicKey:w}=qe(l,n.nftMint),{publicKey:g}=yt(l,c,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(l,r.wallet,y,w,c,g,d,b,r.tokenAccountA,r.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address),s,i,o,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Ie(l,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:b,positionNftAccount:y,personalPosition:w,protocolPosition:g},signers:[],instructions:[A],instructionTypes:[X.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:s,baseAmount:i,otherAmountMax:o,nft2022:u}){let[l,c]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],m=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(l,c,m),{publicKey:b}=se(l,c,p),{publicKey:y}=u?me(r.wallet,n.nftMint,W.TOKEN_2022_PROGRAM_ID):me(r.wallet,n.nftMint,W.TOKEN_PROGRAM_ID),{publicKey:w}=qe(l,n.nftMint),{publicKey:g}=yt(l,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:b,positionNftAccount:y,personalPosition:w,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(l,r.wallet,y,w,c,g,d,b,r.tokenAccountA,r.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address),s,i,o,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Ie(l,c).publicKey:void 0)],signers:[],instructionTypes:[X.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g,A){let T=C([q("liquidity"),f("amountMaxA"),f("amountMaxB"),v("optionBaseFlag"),xe("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(T.span);T.encode({liquidity:new On.default(0),amountMaxA:y==="MintA"?w:g,amountMaxB:y==="MintA"?g:w,baseFlag:y==="MintA",optionBaseFlag:1},k);let B=Buffer.from([...Ge.increaseLiquidity,...k]);return new x.TransactionInstruction({keys:P,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g,A,T){let h=C([q("liquidity"),f("amountMinA"),f("amountMinB")]),P=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[],...y.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:An,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],B=Buffer.alloc(h.span);h.encode({liquidity:w,amountMinA:g,amountMinB:A},B);let K=Buffer.from([...Ge.decreaseLiquidity,...B]);return new x.TransactionInstruction({keys:k,programId:e,data:K})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:s,amountMinA:i,amountMinB:o,programId:u,nft2022:l}){let[c,m]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],p=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:b}=se(c,m,p),{publicKey:y}=se(c,m,d),{publicKey:w}=l?me(r.wallet,n.nftMint,W.TOKEN_2022_PROGRAM_ID):me(r.wallet,n.nftMint,u),{publicKey:g}=qe(c,n.nftMint),{publicKey:A}=yt(c,m,n.tickLower,n.tickUpper),T=[];for(let k=0;k<e.rewardDefaultInfos.length;k++)T.push({poolRewardVault:new x.PublicKey(t.rewardInfos[k].vault),ownerRewardVault:r.rewardAccounts[k],rewardMint:new x.PublicKey(e.rewardDefaultInfos[k].mint.address)});let h=[],P=this.decreaseLiquidityInstruction(c,r.wallet,w,g,m,A,b,y,r.tokenAccountA,r.tokenAccountB,new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B),new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address),T,s,i,o,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,d])?Ie(c,m).publicKey:void 0);return h.push(P),{address:{tickArrayLower:b,tickArrayUpper:y,positionNftAccount:w,personalPosition:g,protocolPosition:A},signers:[],instructions:h,instructionTypes:[X.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,b,y,w,g){let A=C([f("amount"),f("otherAmountThreshold"),q("sqrtPriceLimitX64"),xe("isBaseInput")]),T=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:An,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...T],P=Buffer.alloc(A.span);A.encode({amount:d,otherAmountThreshold:b,sqrtPriceLimitX64:y,isBaseInput:w},P);let k=Buffer.from([...Ge.swap,...P]);return new x.TransactionInstruction({keys:h,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:s,amountIn:i,amountOutMin:o,sqrtPriceLimitX64:u,remainingAccounts:l}){let[c,m]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],[p,d]=[new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B)],[b,y]=[new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address)],w=e.mintA.address===s.toString(),g=[this.swapInstruction(c,r.wallet,m,new x.PublicKey(e.config.id),w?r.tokenAccountA:r.tokenAccountB,w?r.tokenAccountB:r.tokenAccountA,w?p:d,w?d:p,w?b:y,w?y:b,l,n,i,o,u,!0,Ie(c,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[X.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:s,amountOut:i,amountInMax:o,sqrtPriceLimitX64:u,remainingAccounts:l}){let[c,m]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],[p,d]=[new x.PublicKey(t.vault.A),new x.PublicKey(t.vault.B)],[b,y]=[new x.PublicKey(e.mintA.address),new x.PublicKey(e.mintB.address)],w=e.mintA.address===s.toBase58(),g=[this.swapInstruction(c,r.wallet,m,new x.PublicKey(e.config.id),w?r.tokenAccountB:r.tokenAccountA,w?r.tokenAccountA:r.tokenAccountB,w?d:p,w?p:d,w?y:b,w?b:y,l,n,i,o,u,!1,Ie(c,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[X.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,s,i,o,u,l,c,m,p){let d=C([f("openTime"),f("endTime"),q("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1}],y=Buffer.alloc(d.span);d.encode({openTime:Z(c),endTime:Z(m),emissionsPerSecondX64:p},y);let w=Buffer.from([...Ge.initReward,...y]);return new x.TransactionInstruction({keys:b,programId:e,data:w})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[s,i]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],o=to(s,i,r.mint).publicKey,u=xr(s).publicKey,l=[this.initRewardInstruction(s,n.wallet,i,u,new x.PublicKey(e.config.id),n.tokenAccount,r.programId,r.mint,o,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:o,operationId:u},signers:[],instructions:l,instructionTypes:[X.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,s,i,o,u,l,c,m,p){let d=C([v("rewardIndex"),q("emissionsPerSecondX64"),f("openTime"),f("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],y=Buffer.alloc(d.span);d.encode({rewardIndex:l,emissionsPerSecondX64:p,openTime:Z(c),endTime:Z(m)},y);let w=Buffer.from([...Ge.setRewardEmissions,...y]);return new x.TransactionInstruction({keys:b,programId:e,data:w})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[s,i]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],o,u,l;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===r.mint.toString()&&(o=p,u=new x.PublicKey(t.rewardInfos[p].vault),l=new x.PublicKey(t.rewardInfos[p].mint.address));(o===void 0||u===void 0)&&lo.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=xr(s).publicKey,m=[this.setRewardInstruction(s,n.wallet,i,c,new x.PublicKey(e.config.id),n.tokenAccount,u,l,o,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:c},signers:[],instructions:m,instructionTypes:[X.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,s,i,o){let u=C([v("rewardIndex")]),l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:An,isSigner:!1,isWritable:!1}],c=Buffer.alloc(u.span);u.encode({rewardIndex:o},c);let m=Buffer.from([...Ge.collectReward,...c]);return new x.TransactionInstruction({keys:l,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[s,i]=[new x.PublicKey(e.programId),new x.PublicKey(e.id)],o,u;for(let c=0;c<e.rewardDefaultInfos.length;c++)e.rewardDefaultInfos[c].mint.address===r.toString()&&(o=c,u=new x.PublicKey(t.rewardInfos[c].vault));(o===void 0||u===void 0)&&lo.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=[this.collectRewardInstruction(s,n.wallet,i,n.tokenAccount,u,r,o)];return{address:{rewardVault:u},signers:[],instructions:l,instructionTypes:[X.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:s,nftMint:i,nft2022:o,getEphemeralSigners:u}){let l=[],c;if(u)c=new x.PublicKey((await u(1))[0]);else{let g=x.Keypair.generate();l.push(g),c=g.publicKey}let m=o?me(s,i,W.TOKEN_2022_PROGRAM_ID).publicKey:me(s,i,W.TOKEN_PROGRAM_ID).publicKey,{publicKey:p}=qe(n,i),d=io(e,c).publicKey,b=me(s,c,W.TOKEN_PROGRAM_ID).publicKey,y=dn(c).publicKey,w=Ht.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:s,lockOwner:s,positionNftAccount:m,positionId:p,lockPositionId:d,lockNftMint:c,lockNftAccount:b,metadataAccount:y,withMetadata:!0,nft2022:o,positionNftMint:i,authPositionNftAccount:me(t,i,o?W.TOKEN_2022_PROGRAM_ID:W.TOKEN_PROGRAM_ID).publicKey,positionNftProgram:o?W.TOKEN_2022_PROGRAM_ID:W.TOKEN_PROGRAM_ID});return{address:{positionId:p,lockPositionId:d,lockNftAccount:b,lockNftMint:c,positionNftAccount:m,metadataAccount:y},instructions:[w],signers:l,instructionTypes:[X.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:s,positionNftAccount:i,positionId:o,positionNftMint:u,authPositionNftAccount:l,positionNftProgram:c,lockPositionId:m,lockNftMint:p,lockNftAccount:d,metadataAccount:b,withMetadata:y}){let w=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1}],g=C([xe("withMetadata")]),A=Buffer.alloc(g.span);g.encode({withMetadata:y},A);let T=Buffer.from([...mo,...A]);return new x.TransactionInstruction({keys:w,programId:e,data:T})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:s}){let{publicKey:i}=me(r,s,W.TOKEN_PROGRAM_ID),{publicKey:o}=qe(n,s),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:Sr(e,o).publicKey,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:x.SystemProgram.programId,isSigner:!1,isWritable:!1}];return new x.TransactionInstruction({keys:u,programId:e,data:Buffer.from(mo)})}static harvestLockPositionInstruction(e){let[t,n]=[new x.PublicKey(e.poolKeys.programId),new x.PublicKey(e.poolKeys.id)],r=E.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),s=E.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:i}=se(t,n,r),{publicKey:o}=se(t,n,s),{publicKey:u}=me(e.owner,e.ownerPosition.nftMint,W.TOKEN_PROGRAM_ID),{publicKey:l}=qe(t,e.ownerPosition.nftMint),{publicKey:c}=yt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let b=0;b<e.poolKeys.rewardInfos.length;b++)m.push({poolRewardVault:new x.PublicKey(e.poolKeys.rewardInfos[b].vault),ownerRewardVault:e.ownerRewardAccounts[b],rewardMint:new x.PublicKey(e.poolKeys.rewardInfos[b].mint.address)});let p=[...m.map(b=>[{pubkey:b.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:b.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:b.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Sr(e.programId,l).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:new x.PublicKey(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new x.PublicKey(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:or,isSigner:!1,isWritable:!1},{pubkey:new x.PublicKey(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new x.PublicKey(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...p];return new x.TransactionInstruction({keys:d,programId:e.programId,data:Buffer.from(po)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:s,lockNftMint:i,lockNftAccount:o,positionNftAccount:u,positionId:l,poolId:c,protocolPosition:m,vaultA:p,vaultB:d,tickArrayLower:b,tickArrayUpper:y,userVaultA:w,userVaultB:g,mintA:A,mintB:T,rewardAccounts:h,exTickArrayBitmap:P}){let k=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[],...h.map(K=>[{pubkey:K.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:or,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},...k];return new x.TransactionInstruction({keys:B,programId:e,data:Buffer.from(po)})}};var Lr=(...a)=>a.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Yt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ue(t)}createTxBuilder(e){return this.scope.checkOwner(),new Kn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Lr(e))}logInfo(...e){this.logger.info(Lr(e))}logAndCreateError(...e){let t=Lr(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Xs=C([Ce("mintAuthorityOption"),L("mintAuthority"),f("supply"),v("decimals"),v("isInitialized"),Ce("freezeAuthorityOption"),L("freezeAuthority")]);var Qs=require("@solana/web3.js"),fo=require("@solana/spl-token");var bo=a=>new Le({mint:a.address,decimals:a.decimals,symbol:a.symbol,name:a.name});var Dn=r=>{var s=r,{address:a,programId:e,decimals:t}=s,n=Xe(s,["address","programId","decimals"]);return D({chainId:101,address:qt(a).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};var Rr=Y(require("bn.js")),Cr=new Rr.default(25),qn=new Rr.default(1e4);var Pe=require("@solana/web3.js"),gt=require("@solana/spl-token");var Nr=C([v("instruction"),f("amountIn"),f("minAmountOut")]),Mr=C([v("instruction"),f("maxAmountIn"),f("amountOut")]),Vp=C([v("instruction"),v("nonce")]),zs=C([v("instruction"),v("nonce"),f("startTime")]),_r=C([f("status"),f("nonce"),f("maxOrder"),f("depth"),f("baseDecimal"),f("quoteDecimal"),f("state"),f("resetFlag"),f("minSize"),f("volMaxCutRatio"),f("amountWaveRatio"),f("baseLotSize"),f("quoteLotSize"),f("minPriceMultiplier"),f("maxPriceMultiplier"),f("systemDecimalValue"),f("minSeparateNumerator"),f("minSeparateDenominator"),f("tradeFeeNumerator"),f("tradeFeeDenominator"),f("pnlNumerator"),f("pnlDenominator"),f("swapFeeNumerator"),f("swapFeeDenominator"),f("baseNeedTakePnl"),f("quoteNeedTakePnl"),f("quoteTotalPnl"),f("baseTotalPnl"),f("poolOpenTime"),f("punishPcAmount"),f("punishCoinAmount"),f("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),f("swapBase2QuoteFee"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),f("swapQuote2BaseFee"),L("baseVault"),L("quoteVault"),L("baseMint"),L("quoteMint"),L("lpMint"),L("openOrders"),L("marketId"),L("marketProgramId"),L("targetOrders"),L("withdrawQueue"),L("lpVault"),L("owner"),f("lpReserve"),G(f(),3,"padding")]),vp=C([f("accountType"),f("status"),f("nonce"),f("maxOrder"),f("depth"),f("baseDecimal"),f("quoteDecimal"),f("state"),f("resetFlag"),f("minSize"),f("volMaxCutRatio"),f("amountWaveRatio"),f("baseLotSize"),f("quoteLotSize"),f("minPriceMultiplier"),f("maxPriceMultiplier"),f("systemDecimalsValue"),f("abortTradeFactor"),f("priceTickMultiplier"),f("priceTick"),f("minSeparateNumerator"),f("minSeparateDenominator"),f("tradeFeeNumerator"),f("tradeFeeDenominator"),f("pnlNumerator"),f("pnlDenominator"),f("swapFeeNumerator"),f("swapFeeDenominator"),f("baseNeedTakePnl"),f("quoteNeedTakePnl"),f("quoteTotalPnl"),f("baseTotalPnl"),f("poolOpenTime"),f("punishPcAmount"),f("punishCoinAmount"),f("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),f("swapQuote2BaseFee"),f("swapBase2QuoteFee"),L("baseVault"),L("quoteVault"),L("baseMint"),L("quoteMint"),L("lpMint"),L("modelDataAccount"),L("openOrders"),L("marketId"),L("marketProgramId"),L("targetOrders"),L("owner"),G(f(),64,"padding")]),Vr=C([v("instruction"),f("baseAmountIn"),f("quoteAmountIn"),f("fixedSide"),f("otherAmountMin")]),vr=C([v("instruction"),f("lpAmount"),f("baseAmountMin"),f("quoteAmountMin")]);var yo=C([f("fee")]);var go=ue("Raydium_liquidity_instruction");function wo(a){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:r,quoteAmountIn:s,fixedSide:i,otherAmountMin:o,modelDataPubKey:u=xt}=a,l=Buffer.alloc(Vr.span);Vr.encode({instruction:3,baseAmountIn:Z(r),quoteAmountIn:Z(s),otherAmountMin:Z(o),fixedSide:i==="base"?ft:bi},l);let c=[I({pubkey:gt.TOKEN_PROGRAM_ID,isWritable:!1}),I({pubkey:new Pe.PublicKey(e.id)}),I({pubkey:new Pe.PublicKey(t.authority),isWritable:!1}),I({pubkey:new Pe.PublicKey(t.openOrders),isWritable:!1}),I({pubkey:new Pe.PublicKey(t.targetOrders)}),I({pubkey:new Pe.PublicKey(e.lpMint.address)}),I({pubkey:new Pe.PublicKey(t.vault.A)}),I({pubkey:new Pe.PublicKey(t.vault.B)})];return e.pooltype.includes("StablePool")&&c.push(I({pubkey:u})),c.push(I({pubkey:new Pe.PublicKey(e.marketId),isWritable:!1}),I({pubkey:n.baseTokenAccount}),I({pubkey:n.quoteTokenAccount}),I({pubkey:n.lpTokenAccount}),I({pubkey:n.owner,isWritable:!1,isSigner:!0}),I({pubkey:new Pe.PublicKey(t.marketEventQueue),isWritable:!1})),new Pe.TransactionInstruction({programId:new Pe.PublicKey(e.programId),keys:c,data:l})}function Wr(a){let{poolInfo:e,poolKeys:t,userKeys:n,lpAmount:r,baseAmountMin:s,quoteAmountMin:i,modelDataPubKey:o=xt}=a,u=Tt(t),l=4;if(e.pooltype.includes("StablePool")&&(l=5),l===4||l===5){let c=Buffer.alloc(vr.span);vr.encode({instruction:4,lpAmount:Z(r),baseAmountMin:Z(s),quoteAmountMin:Z(i)},c);let m=[I({pubkey:gt.TOKEN_PROGRAM_ID,isWritable:!1}),I({pubkey:u.id}),I({pubkey:u.authority,isWritable:!1}),I({pubkey:u.openOrders}),I({pubkey:u.targetOrders}),I({pubkey:u.mintLp.address}),I({pubkey:u.vault.A}),I({pubkey:u.vault.B})];return l===5?m.push(I({pubkey:o})):(m.push(I({pubkey:u.id})),m.push(I({pubkey:u.id}))),m.push(I({pubkey:u.marketProgramId,isWritable:!1}),I({pubkey:u.marketId}),I({pubkey:u.marketBaseVault}),I({pubkey:u.marketQuoteVault}),I({pubkey:u.marketAuthority,isWritable:!1}),I({pubkey:n.lpTokenAccount}),I({pubkey:n.baseTokenAccount}),I({pubkey:n.quoteTokenAccount}),I({pubkey:n.owner,isWritable:!1,isSigner:!0}),I({pubkey:u.marketEventQueue}),I({pubkey:u.marketBids}),I({pubkey:u.marketAsks})),new Pe.TransactionInstruction({programId:u.programId,keys:m,data:c})}return new Pe.TransactionInstruction({programId:u.programId,keys:[]})}function Er({programId:a,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:r,coinMint:s,pcMint:i,coinVault:o,pcVault:u,withdrawQueue:l,ammTargetOrders:c,poolTempLp:m,marketProgramId:p,marketId:d,userWallet:b,userCoinVault:y,userPcVault:w,userLpVault:g,nonce:A,openTime:T,coinAmount:h,pcAmount:P,ammConfigId:k,feeDestinationId:B}){let K=C([v("instruction"),v("nonce"),f("openTime"),f("pcAmount"),f("coinAmount")]),R=[{pubkey:gt.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:gt.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Pe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!1},{pubkey:B,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!0,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],S=Buffer.alloc(K.span);return K.encode({instruction:1,nonce:A,openTime:T,coinAmount:h,pcAmount:P},S),{instruction:new Pe.TransactionInstruction({keys:R,programId:a,data:S}),instructionType:X.AmmV4CreatePool}}function js({poolKeys:a,userKeys:e,amountIn:t,minAmountOut:n,modelDataPubKey:r=xt},s){let i=Tt(a),o=Buffer.alloc(Nr.span);Nr.encode({instruction:9,amountIn:Z(t),minAmountOut:Z(n)},o);let u=[I({pubkey:gt.TOKEN_PROGRAM_ID,isWritable:!1}),I({pubkey:i.id}),I({pubkey:i.authority,isWritable:!1}),I({pubkey:i.openOrders})];return s===4&&u.push(I({pubkey:i.targetOrders})),u.push(I({pubkey:i.vault.A}),I({pubkey:i.vault.B})),s===5&&u.push(I({pubkey:r})),u.push(I({pubkey:i.marketProgramId,isWritable:!1}),I({pubkey:i.marketId}),I({pubkey:i.marketBids}),I({pubkey:i.marketAsks}),I({pubkey:i.marketEventQueue}),I({pubkey:i.marketBaseVault}),I({pubkey:i.marketQuoteVault}),I({pubkey:i.marketAuthority,isWritable:!1}),I({pubkey:e.tokenAccountIn}),I({pubkey:e.tokenAccountOut}),I({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Pe.TransactionInstruction({programId:i.programId,keys:u,data:o})}function Hs({poolKeys:a,userKeys:e,maxAmountIn:t,amountOut:n,modelDataPubKey:r=xt},s){let i=Tt(a),o=Buffer.alloc(Mr.span);Mr.encode({instruction:11,maxAmountIn:Z(t),amountOut:Z(n)},o);let u=[I({pubkey:gt.TOKEN_PROGRAM_ID,isWritable:!1}),I({pubkey:i.id}),I({pubkey:i.authority,isWritable:!1}),I({pubkey:i.openOrders}),I({pubkey:i.targetOrders}),I({pubkey:i.vault.A}),I({pubkey:i.vault.B})];return s===5&&u.push(I({pubkey:r})),u.push(I({pubkey:i.marketProgramId,isWritable:!1}),I({pubkey:i.marketId}),I({pubkey:i.marketBids}),I({pubkey:i.marketAsks}),I({pubkey:i.marketEventQueue}),I({pubkey:i.marketBaseVault}),I({pubkey:i.marketQuoteVault}),I({pubkey:i.marketAuthority,isWritable:!1}),I({pubkey:e.tokenAccountIn}),I({pubkey:e.tokenAccountOut}),I({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Pe.TransactionInstruction({programId:i.programId,keys:u,data:o})}function ko(a){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:s,fixedSide:i}=a;if(t===4||t===5){let o={poolKeys:e,userKeys:n};if(i==="in")return js(H(D({},o),{amountIn:r,minAmountOut:s}),t);if(i==="out")return Hs(H(D({},o),{maxAmountIn:r,amountOut:s}),t);go.logWithError("invalid params","params",a)}throw go.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var Wt=5e4,Ys=C([f("x"),f("y"),f("price")]),Zs=C([f("accountType"),f("status"),f("multiplier"),f("validDataCount"),G(Ys,Wt,"DataElement")]);function Js(a,e){return[0,Wt-2]}function $s(a){return[0,Wt-2]}function ea(a){return[0,Wt-2]}function ta(a,e,t){let[n,r]=Js(e,t),s=n,i=r,o=0,u=e*a.multiplier/t;for(;s<=i;){if(o=Math.floor((i+s)/2),o===0||o>=Wt-2)return[o,o,!1];let l=a.DataElement[o].x*a.multiplier/a.DataElement[o].y,c=a.DataElement[o-1].x*a.multiplier/a.DataElement[o-1].y,m=a.DataElement[o+1].x*a.multiplier/a.DataElement[o+1].y;if(u===l)return[o,o,!0];if(u===c)return[o-1,o-1,!0];if(u===m)return[o+1,o+1,!0];if(u<c)i=o-1;else{if(u>c&&u<l)return[o-1,o,!0];if(u>l&&u<m)return[o,o+1,!0];s=o+1}}return[o,o,!1]}function Fr(a,e,t){let[n,r,s]=ta(a,e,t);if(!s)return 0;if(n===r){let i=a.DataElement[n].x;return e*a.multiplier/i}else{let i=a.DataElement[n].x,o=a.DataElement[n].y,u=a.DataElement[r].x,l=a.DataElement[r].y,c=t*(u*o-i*l),m=i*c,p=(u-i)*(e*o-i*t)*l,d=m+p;return e*a.multiplier*c/d}}function vt(a,e,t){return e*a.multiplier/t}function Ao(a,e,t){return e*t/a.multiplier}function na(a,e){let[t,n]=$s(e),r=t,s=n,i=0,o=e;for(;r<s;){if(i=Math.floor((s+r)/2),i<=0||i>Wt-2)return[i,i,!1];let u=a.DataElement[i].x,l=a.DataElement[i-1].x,c=a.DataElement[i+1].x;if(o===u)return[i,i,!0];if(o===l)return[i-1,i-1,!0];if(o===c)return[i+1,i+1,!0];if(o<l)s=i-1;else{if(o>l&&o<u)return[i-1,i,!0];if(o>u&&o<c)return[i,i+1,!0];r=i+1}}return[i,i,!1]}function ra(a,e){let[t,n]=ea(e),r=t,s=n,i=0,o=e;for(;r<=s;){if(i=Math.floor((s+r)/2),i<=0||i>=Wt-2)return[i,i,!1];let u=a.DataElement[i].y,l=a.DataElement[i-1].y,c=a.DataElement[i+1].y;if(o===u)return[i,i,!0];if(o===l)return[i-1,i-1,!0];if(o===c)return[i+1,i+1,!0];if(o<c)r=i+1;else{if(o<l&&o>u)return[i-1,i,!0];if(o<u&&o>c)return[i,i+1,!0];s=i-1}}return[i,i,!1]}function Po(a,e,t,n){let r=n?e+t:e-t,[s,i,o]=na(a,r);if(!o)return[0,0,!1,o];if(s===i)return[a.DataElement[i].price,a.DataElement[i].y,!1,o];{let u=a.DataElement[s].x,l=a.DataElement[i].x,c=a.DataElement[s].price,m=a.DataElement[i].price,p=a.DataElement[s].y,d=a.DataElement[i].y;if(e>=u&&e<=l)return n?[m,d,!0,o]:[c,p,!0,o];{let b,y;return n?(b=c+(m-c)*(e-u)/(l-u),y=p-(r-u)*a.multiplier/m):(b=c+(m-c)*(e-u)/(l-u),y=d+(l-r)*a.multiplier/c),[b,y,!1,o]}}}function ia(a,e,t,n){let r=n?e-t:e+t,[s,i,o]=ra(a,r);if(!o)return[0,0,!1,o];if(s===i)return[a.DataElement[i].price,a.DataElement[i].x,!1,o];{let u=a.DataElement[s].x,l=a.DataElement[i].x,c=a.DataElement[s].price,m=a.DataElement[i].price,p=a.DataElement[s].y,d=a.DataElement[i].y;if(e>=d&&e<=p)return n?[m,l,!0,o]:[c,u,!0,o];{let b,y;return n?(b=c+(m-c)*(p-e)/(p-d),y=u+m*(p-r)/a.multiplier):(b=c+(m-c)*(p-e)/(p-d),y=l-c*(r-d)/a.multiplier),[b,y,!1,o]}}}function oa(a,e){let t=Po(a,e,0,!1);return t[3]?t[0]:0}function To(a,e,t,n){let r=Fr(a,e,t),s=vt(a,e,r),i=vt(a,t,r),o=vt(a,n,r),u=!0,[l,c,m,p]=Po(a,s,o,u);if(!p)return 0;if(m)return n*a.multiplier/l;{let d=i-c;return Ao(a,d,r)}}function ho(a,e,t,n){let r=Fr(a,e,t),s=vt(a,e,r),i=vt(a,t,r),o=vt(a,n,r),u=!1,[l,c,m,p]=ia(a,i,o,u);if(!p)return 0;if(m)return n*l/a.multiplier;{let d=s-c;return Ao(a,d,r)}}function sa(a){let e=Zs.decode(a);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function xo(a,e,t,n){let r=oa(a,vt(a,e,Fr(a,e,t)))/a.multiplier;return n?r:1/r}var yn=class{constructor({connection:e,modelDataPubKey:t=xt}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e,this.modelDataPubKey=t}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(this.modelDataPubKey);e&&(this._layoutData=sa(e==null?void 0:e.data))}}};var _o=require("@solana/web3.js"),ba=Y(require("bn.js")),gn=Y(require("decimal.js")),Vo=require("@solana/spl-token");var So=require("@solana/web3.js");var aa=ue("Raydium_liquidity_serum");function Bo({programId:a,marketId:e}){let t=[e.toBuffer()],n=0,r;for(;n<100;){try{let s=t.concat(Buffer.from([n]),Buffer.alloc(7));r=So.PublicKey.createProgramAddressSync(s,a)}catch(s){if(s instanceof TypeError)throw s;n++;continue}return{publicKey:r,nonce:n}}throw aa.logWithError("unable to find a viable program address nonce","params",{programId:a,marketId:e}),new Error("unable to find a viable program address nonce")}var Qn=require("@solana/web3.js"),da=Y(require("bn.js"));var No=require("@solana/spl-token");function ua(a){return a instanceof Uint8Array||a!=null&&typeof a=="object"&&a.constructor.name==="Uint8Array"}function Or(a,...e){if(!ua(a))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(a.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${a.length}`)}function Dr(a,e=!0){if(a.destroyed)throw new Error("Hash instance has been destroyed");if(e&&a.finished)throw new Error("Hash#digest() has already been called")}function Io(a,e){Or(a);let t=e.outputLen;if(a.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Un=a=>new DataView(a.buffer,a.byteOffset,a.byteLength),et=(a,e)=>a<<32-e|a>>>e;var tf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ca(a){if(typeof a!="string")throw new Error(`utf8ToBytes expected string, got ${typeof a}`);return new Uint8Array(new TextEncoder().encode(a))}function qr(a){return typeof a=="string"&&(a=ca(a)),Or(a),a}var Gn=class{clone(){return this._cloneInto()}},nf={}.toString;function Ko(a){let e=n=>a().update(qr(n)).digest(),t=a();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>a(),e}function la(a,e,t,n){if(typeof a.setBigUint64=="function")return a.setBigUint64(e,t,n);let r=BigInt(32),s=BigInt(4294967295),i=Number(t>>r&s),o=Number(t&s),u=n?4:0,l=n?0:4;a.setUint32(e+u,i,n),a.setUint32(e+l,o,n)}var Lo=(a,e,t)=>a&e^~a&t,Ro=(a,e,t)=>a&e^a&t^e&t,Xn=class extends Gn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Un(this.buffer)}update(e){Dr(this);let{view:t,buffer:n,blockLen:r}=this;e=qr(e);let s=e.length;for(let i=0;i<s;){let o=Math.min(r-this.pos,s-i);if(o===r){let u=Un(e);for(;r<=s-i;i+=r)this.process(u,i);continue}n.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Dr(this),Io(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:s}=this,{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let m=i;m<r;m++)t[m]=0;la(n,r-8,BigInt(this.length*8),s),this.process(n,0);let o=Un(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=u/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<l;m++)o.setUint32(4*m,c[m],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:s,destroyed:i,pos:o}=this;return e.length=r,e.pos=o,e.finished=s,e.destroyed=i,r%t&&e.buffer.set(n),e}};var ma=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),wt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kt=new Uint32Array(64),Gr=class extends Xn{constructor(){super(64,32,8,!1),this.A=wt[0]|0,this.B=wt[1]|0,this.C=wt[2]|0,this.D=wt[3]|0,this.E=wt[4]|0,this.F=wt[5]|0,this.G=wt[6]|0,this.H=wt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:s,F:i,G:o,H:u}=this;return[e,t,n,r,s,i,o,u]}set(e,t,n,r,s,i,o,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=s|0,this.F=i|0,this.G=o|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)kt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let p=kt[m-15],d=kt[m-2],b=et(p,7)^et(p,18)^p>>>3,y=et(d,17)^et(d,19)^d>>>10;kt[m]=y+kt[m-7]+b+kt[m-16]|0}let{A:n,B:r,C:s,D:i,E:o,F:u,G:l,H:c}=this;for(let m=0;m<64;m++){let p=et(o,6)^et(o,11)^et(o,25),d=c+p+Lo(o,u,l)+ma[m]+kt[m]|0,y=(et(n,2)^et(n,13)^et(n,22))+Ro(n,r,s)|0;c=l,l=u,u=o,o=i+d|0,i=s,s=r,r=n,n=d+y|0}n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,u=u+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,s,i,o,u,l,c)}roundClean(){kt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Co=Ko(()=>new Gr);var gf=ue("Raydium_Util");function ot({fromPublicKey:a,programId:e=No.TOKEN_PROGRAM_ID,assignSeed:t}){let n=t?btoa(t).slice(0,32):Qn.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:pa(a,n,e),seed:n}}function pa(a,e,t){let n=Buffer.concat([a.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Co(n);return new Qn.PublicKey(r)}var Mo=require("@solana/web3.js"),fa=Y(require("bn.js"));var zn=require("@solana/spl-token");function jn({programId:a}){let{publicKey:e}=ye([Buffer.from("amm_config_account_seed","utf-8")],a);return e}function Et({name:a,programId:e,marketId:t}){let{publicKey:n}=ye([e.toBuffer(),t.toBuffer(),Buffer.from(a,"utf-8")],e);return n}function ya({programId:a,marketId:e}){let{publicKey:t}=ye([a.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],a);return t}function ga({programId:a}){return ye([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],a)}function Xr({version:a,marketVersion:e,marketId:t,baseMint:n,quoteMint:r,baseDecimals:s,quoteDecimals:i,programId:o,marketProgramId:u}){let l=Et({name:"amm_associated_seed",programId:o,marketId:t}),c=Et({name:"lp_mint_associated_seed",programId:o,marketId:t}),{publicKey:m,nonce:p}=ga({programId:o}),d=Et({name:"coin_vault_associated_seed",programId:o,marketId:t}),b=Et({name:"pc_vault_associated_seed",programId:o,marketId:t}),y=Et({name:"temp_lp_token_associated_seed",programId:o,marketId:t}),w=ya({programId:o,marketId:t}),g=Et({name:"target_associated_seed",programId:o,marketId:t}),A=Et({name:"withdraw_associated_seed",programId:o,marketId:t}),{publicKey:T}=Bo({programId:u,marketId:t});return{id:l,baseMint:n,quoteMint:r,lpMint:c,baseDecimals:s,quoteDecimals:i,lpDecimals:s,version:a,programId:o,authority:m,nonce:p,baseVault:d,quoteVault:b,lpVault:y,openOrders:w,targetOrders:g,withdrawQueue:A,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:T,lookupTableAccount:_o.PublicKey.default,configId:jn({programId:o})}}var Ur={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},vo=a=>{let e={},t=Vo.TOKEN_PROGRAM_ID.toBase58();return Object.keys(a).map(n=>{let r=a[n],[s,i]=[r.baseMint.toBase58(),r.quoteMint.toBase58()];e[n]={id:n,version:4,status:r.status.toNumber(),programId:r.programId.toBase58(),mintA:Dn({address:s,programId:t,decimals:r.baseDecimal.toNumber()}),mintB:Dn({address:i,programId:t,decimals:r.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:r.poolPrice.toNumber(),mintAmountA:new gn.default(r.mintAAmount.toString()).div(10**r.baseDecimal.toNumber()).toNumber(),mintAmountB:new gn.default(r.mintBAmount.toString()).div(10**r.quoteDecimal.toNumber()).toNumber(),baseReserve:r.baseReserve,quoteReserve:r.quoteReserve,feeRate:new gn.default(r.tradeFeeNumerator.toString()).div(r.tradeFeeDenominator.toString()).toNumber(),openTime:r.poolOpenTime.toString(),tvl:0,day:Ur,week:Ur,month:Ur,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:r.marketId.toBase58(),configId:jn({programId:r.programId}).toBase58(),lpPrice:0,lpAmount:new gn.default(r.lpReserve.toString()).div(10**Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())).toNumber(),lpMint:Dn({address:r.lpMint.toBase58(),programId:t,decimals:Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())}),burnPercent:0}}),e};var be=Y(require("bn.js")),le=Y(require("decimal.js"));var Aa=require("@solana/web3.js"),Pa=Y(require("bn.js")),Ta=require("@solana/spl-token");var We=require("@solana/web3.js"),Zt=require("@solana/spl-token");function wa(a="accountFlags"){let e=new Cn(a);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var Qr=C([he(5),wa("accountFlags"),L("ownAddress"),f("vaultSignerNonce"),L("baseMint"),L("quoteMint"),L("baseVault"),f("baseDepositsTotal"),f("baseFeesAccrued"),L("quoteVault"),f("quoteDepositsTotal"),f("quoteFeesAccrued"),f("quoteDustThreshold"),L("requestQueue"),L("eventQueue"),L("bids"),L("asks"),f("baseLotSize"),f("quoteLotSize"),f("feeRateBps"),f("referrerRebatesAccrued"),he(7)]);function ka({programId:a,marketInfo:e}){let t=C([v("version"),Ce("instruction"),f("baseLotSize"),f("quoteLotSize"),It("feeRateBps"),f("vaultSignerNonce"),f("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:We.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),r=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},r),new We.TransactionInstruction({keys:n,programId:a,data:r})}async function zr({connection:a,wallet:e,marketInfo:t}){var i,o,u,l,c,m,p,d;let n=new We.Transaction,r=await a.getMinimumBalanceForRentExemption(165);n.add(We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:r,space:165,programId:Zt.TOKEN_PROGRAM_ID}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:r,space:165,programId:Zt.TOKEN_PROGRAM_ID}),(0,Zt.createInitializeAccountInstruction)(t.baseVault.publicKey,t.baseMint,t.vaultOwner),(0,Zt.createInitializeAccountInstruction)(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await a.getMinimumBalanceForRentExemption(Qr.span),space:Qr.span,programId:t.programId}));let s=new We.Transaction;return s.add(We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:t.lowestFeeMarket?6208320:await a.getMinimumBalanceForRentExemption((i=t.requestQueueSpace)!=null?i:5120+12),space:t.lowestFeeMarket?764:(o=t.requestQueueSpace)!=null?o:5120+12,programId:t.programId}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:t.lowestFeeMarket?79594560:await a.getMinimumBalanceForRentExemption((u=t.eventQueueSpace)!=null?u:262144+12),space:t.lowestFeeMarket?11308:(l=t.eventQueueSpace)!=null?l:262144+12,programId:t.programId}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:t.lowestFeeMarket?101977920:await a.getMinimumBalanceForRentExemption((c=t.orderbookQueueSpace)!=null?c:65536+12),space:t.lowestFeeMarket?14524:(m=t.orderbookQueueSpace)!=null?m:65536+12,programId:t.programId}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:t.lowestFeeMarket?101977920:await a.getMinimumBalanceForRentExemption((p=t.orderbookQueueSpace)!=null?p:65536+12),space:t.lowestFeeMarket?14524:(d=t.orderbookQueueSpace)!=null?d:65536+12,programId:t.programId}),ka({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[X.CreateAccount,X.CreateAccount,X.InitAccount,X.InitAccount]},{transaction:s,signer:[],instructionTypes:[X.CreateAccount,X.CreateAccount,X.CreateAccount,X.CreateAccount,X.CreateAccount,X.InitMarket]}]}var Hn=class extends Yt{constructor(t){super(t);this.stableLayout=new yn({connection:this.scope.connection,modelDataPubKey:this.scope.cluster==="mainnet"?void 0:St.MODEL_DATA_PUBKEY})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:r,baseIn:s}){let i=new be.default(new le.default(n).mul(10**t[s?"mintA":"mintB"].decimals).toFixed(0)),o=bo(t[s?"mintB":"mintA"]),[u,l]=[new be.default(new le.default(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new be.default(new le.default(t.mintAmountB).mul(10**t.mintB.decimals).toString())],c=new be.default(new le.default(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,le.default.ROUND_DOWN));this.logDebug("baseReserve:",u.toString(),"quoteReserve:",l.toString()),this.logDebug("tokenIn:",s?t.mintA.symbol:t.mintB.symbol,"amountIn:",i.toString(),"anotherToken:",s?t.mintB.symbol:t.mintA.symbol,"slippage:",`${r.toSignificant()}%`,"baseReserve",u.toString(),"quoteReserve",l.toString());let m=s?"base":"quote";this.logDebug("input side:",m);let p=ft;i.isZero()||(p=m==="base"?hn(i.mul(l),u):hn(i.mul(u),l)),this.logDebug("amountRaw:",p.toString(),"lpAmount:",c.toString());let d=hn(i.mul(c),m==="base"?u:l);this.logDebug("liquidity:",d.toString());let b=new Qe(new be.default(1)).add(r),y=new Qe(new be.default(1)).sub(r),w=b.mul(p).quotient,g=y.mul(p).quotient,A=new ge(o,p),T=new ge(o,w),h=new ge(o,g);return this.logDebug("anotherAmount:",A.toFixed(),"maxAnotherAmount:",T.toFixed()),{anotherAmount:A,maxAnotherAmount:T,minAnotherAmount:h,liquidity:d}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,poolKeys:r,amountInA:s,amountInB:i,otherAmountMin:o,fixedSide:u,config:l,txVersion:c,computeBudgetConfig:m,txTipConfig:p,feePayer:d}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",s,"amountInB:",i),(s.isZero()||i.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:s.toFixed(),amountInB:i.toFixed()});let{account:b}=this.scope,{bypassAssociatedCheck:y,checkCreateATAOwner:w}=D({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},l),[g,A]=[s.token,i.token],T=await b.getCreatedTokenAccount({mint:g.mint,associatedOnly:!1}),h=await b.getCreatedTokenAccount({mint:A.mint,associatedOnly:!1});!T&&!h&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",b.tokenAccounts);let P=await b.getCreatedTokenAccount({mint:new ke.PublicKey(n.lpMint.address)}),k=[g,A],B=[T,h],K=[s.raw,i.raw],R=s.token.mint.toBase58()===n.mintA.address?"base":"quote",S="base";["quote","base"].includes(R)||this.logAndCreateError("invalid fixedSide","fixedSide",u),R==="quote"?(k.reverse(),B.reverse(),K.reverse(),S=u==="a"?"quote":"base"):R==="base"&&(S=u==="a"?"base":"quote");let[M,V]=k,[_,U]=B,[te,ne]=K,ae=r!=null?r:await this.getAmmPoolKeys(n.id),Te=this.createTxBuilder(d),at=await b.handleTokenAccount({side:"in",amount:te,mint:M.mint,tokenAccount:_,bypassAssociatedCheck:y,checkCreateATAOwner:w}),{tokenAccount:He}=at,st=Xe(at,["tokenAccount"]);Te.addInstruction(st);let Ue=await b.handleTokenAccount({side:"in",amount:ne,mint:V.mint,tokenAccount:U,bypassAssociatedCheck:y,checkCreateATAOwner:w}),{tokenAccount:_e}=Ue,Ve=Xe(Ue,["tokenAccount"]);Te.addInstruction(Ve);let Ee=await b.handleTokenAccount({side:"out",amount:0,mint:new ke.PublicKey(n.lpMint.address),tokenAccount:P,bypassAssociatedCheck:y,checkCreateATAOwner:w}),{tokenAccount:tt}=Ee,dt=Xe(Ee,["tokenAccount"]);return Te.addInstruction(dt),Te.addInstruction({instructions:[wo({poolInfo:n,poolKeys:ae,userKeys:{baseTokenAccount:He,quoteTokenAccount:_e,lpTokenAccount:tt,owner:this.scope.ownerPubKey},baseAmountIn:te,quoteAmountIn:ne,otherAmountMin:o.raw,fixedSide:S})],instructionTypes:[n.pooltype.includes("StablePool")?X.AmmV5AddLiquidity:X.AmmV4AddLiquidity],lookupTableAddress:ae.lookupTableAccount?[ae.lookupTableAccount]:[]}),Te.addCustomComputeBudget(m),Te.addTipInstruction(p),c===0?await Te.buildV0():Te.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,poolKeys:r,lpAmount:s,baseAmountMin:i,quoteAmountMin:o,config:u,txVersion:l,computeBudgetConfig:c,txTipConfig:m,feePayer:p}=t,d=r!=null?r:await this.getAmmPoolKeys(n.id),[b,y,w]=[new ke.PublicKey(n.mintA.address),new ke.PublicKey(n.mintB.address),new ke.PublicKey(n.lpMint.address)];this.logDebug("lpAmount:",s),this.logDebug("baseAmountMin:",i),this.logDebug("quoteAmountMin:",o),s.isZero()&&this.logAndCreateError("amount must greater than zero","lpAmount",s.toString());let{account:g}=this.scope,A=await g.getCreatedTokenAccount({mint:w,associatedOnly:!1});A||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",g.tokenAccounts);let T=await g.getCreatedTokenAccount({mint:b}),h=await g.getCreatedTokenAccount({mint:y}),P=this.createTxBuilder(p),{bypassAssociatedCheck:k,checkCreateATAOwner:B}=D({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),V=await g.handleTokenAccount({side:"out",amount:0,mint:b,tokenAccount:T,bypassAssociatedCheck:k,checkCreateATAOwner:B}),{tokenAccount:K}=V,R=Xe(V,["tokenAccount"]);P.addInstruction(R);let _=await g.handleTokenAccount({side:"out",amount:0,mint:y,tokenAccount:h,bypassAssociatedCheck:k,checkCreateATAOwner:B}),{tokenAccount:S}=_,M=Xe(_,["tokenAccount"]);return P.addInstruction(M),P.addInstruction({instructions:[Wr({poolInfo:n,poolKeys:d,userKeys:{lpTokenAccount:A,baseTokenAccount:K,quoteTokenAccount:S,owner:this.scope.ownerPubKey},lpAmount:s,baseAmountMin:i,quoteAmountMin:o})],lookupTableAddress:d.lookupTableAccount?[d.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?X.AmmV5RemoveLiquidity:X.AmmV4RemoveLiquidity]}),P.addCustomComputeBudget(c),P.addTipInstruction(m),l===0?await P.buildV0():P.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:r,createPositionInfo:s,farmInfo:i,userFarmLpAmount:o,base:u,computeBudgetConfig:l,payer:c,userAuxiliaryLedgers:m,tokenProgram:p=Me.TOKEN_PROGRAM_ID,checkCreateATAOwner:d=!0,getEphemeralSigners:b,txVersion:y,feePayer:w}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let g=this.createTxBuilder(w),A={};for(let ae of this.scope.account.tokenAccountRawInfos)(A[ae.accountInfo.mint.toString()]===void 0||me(this.scope.ownerPubKey,ae.accountInfo.mint,Me.TOKEN_PROGRAM_ID).publicKey.equals(ae.pubkey))&&(A[ae.accountInfo.mint.toString()]=ae.pubkey);let T=A[t.lpMint.address];if(T===void 0)throw Error("find lp account error in trade accounts");let h=r.add(o!=null?o:new be.default(0)),P=t.mintA.address===Le.WSOL.mint.toString(),k=t.mintB.address===Le.WSOL.mint.toString(),{account:B,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Me.TOKEN_PROGRAM_ID,mint:new ke.PublicKey(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:P?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!P,notUseTokenAccount:P,associatedOnly:!0,checkCreateATAOwner:d});if(g.addInstruction(K||{}),B===void 0)throw new Error("base token account not found");let{account:R,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Me.TOKEN_PROGRAM_ID,mint:new ke.PublicKey(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:k?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!0,checkCreateATAOwner:d});if(g.addInstruction(S||{}),R===void 0)throw new Error("quote token account not found");if(A[t.mintA.address]=B,A[t.mintB.address]=R,i!==void 0&&!(o!=null&&o.isZero())){let ae=gr[i.programId],Te=zt({programId:new ke.PublicKey(i.programId),poolId:new ke.PublicKey(i.id),owner:this.scope.ownerPubKey,version:ae}),He,st=await this.scope.connection.getAccountInfo(Te);if(st&&(He=Di(ae).decode(st.data)),ae!==6&&!He){let{instruction:Ee,instructionType:pt}=qi({id:new ke.PublicKey(i.id),programId:new ke.PublicKey(i.programId),version:ae,ledger:Te,owner:this.scope.ownerPubKey});g.addInstruction({instructions:[Ee],instructionTypes:[pt]})}let _e=[];for(let Ee of i.rewardInfos){let pt=Ee.mint.address===Le.WSOL.mint.toString();if(A[Ee.mint.address])_e.push(A[Ee.mint.address]);else{let{account:Jt,instructionParams:At}=await this.scope.account.getOrCreateTokenAccount({mint:new ke.PublicKey(Ee.mint.address),tokenProgram:p,owner:this.scope.ownerPubKey,skipCloseAccount:!pt,createInfo:{payer:c||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:d});Jt||this.logAndCreateError("farm reward account not found:",Ee.mint.address),At&&g.addInstruction(At),_e.push(Jt)}}let Ve=(await this.scope.api.fetchFarmKeysById({ids:i.id}))[0],tt={userAuxiliaryLedgers:m,amount:o,owner:this.scope.ownerPubKey,farmInfo:i,farmKeys:Ve,lpAccount:T,rewardAccounts:_e},dt=gr[i.programId],at=dt===6?Gi(tt):dt===5?Ui(tt):Xi(tt),Ue={3:X.FarmV3Withdraw,5:X.FarmV5Withdraw,6:X.FarmV6Withdraw};g.addInstruction({instructions:[at],instructionTypes:[Ue[dt]]})}let M=await this.getAmmPoolKeys(t.id),V=Wr({poolInfo:t,poolKeys:M,userKeys:{lpTokenAccount:T,baseTokenAccount:B,quoteTokenAccount:R,owner:this.scope.ownerPubKey},lpAmount:h,baseAmountMin:0,quoteAmountMin:0});g.addInstruction({instructions:[V],instructionTypes:[t.pooltype.includes("StablePool")?X.AmmV5RemoveLiquidity:X.AmmV4RemoveLiquidity],lookupTableAddress:M.lookupTableAccount?[M.lookupTableAccount]:[]});let[_,U]=t.mintA.address===n.mintA.address?[B,R]:[R,B],te=await this.scope.clmm.getClmmPoolKeys(n.id),ne=await Ht.openPositionFromBaseInstructions(H(D({poolInfo:n,poolKeys:te,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:_,tokenAccountB:U},withMetadata:"create"},s),{base:u,getEphemeralSigners:b}));return g.addInstruction({instructions:[...ne.instructions],signers:ne.signers,instructionTypes:[...ne.instructionTypes],lookupTableAddress:te.lookupTableAccount?[te.lookupTableAccount]:[]}),y===0?g.sizeCheckBuildV0({computeBudgetConfig:l}):g.sizeCheckBuild({computeBudgetConfig:l})}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:r,quoteMintInfo:s,baseAmount:i,quoteAmount:o,startTime:u,ownerInfo:l,associatedOnly:c=!1,checkCreateATAOwner:m=!1,tokenProgram:p,txVersion:d,feeDestinationId:b,computeBudgetConfig:y,txTipConfig:w,feePayer:g}){var U;let A=l.feePayer||((U=this.scope.owner)==null?void 0:U.publicKey),T=l.useSOLBalance&&r.mint.equals(Me.NATIVE_MINT),h=l.useSOLBalance&&s.mint.equals(Me.NATIVE_MINT),P=this.createTxBuilder(g),{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({mint:r.mint,owner:this.scope.ownerPubKey,createInfo:T?{payer:A,amount:i}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:c,checkCreateATAOwner:m});P.addInstruction(B||{});let{account:K,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:s.mint,owner:this.scope.ownerPubKey,createInfo:h?{payer:A,amount:o}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:c,checkCreateATAOwner:m});if(P.addInstruction(R||{}),k===void 0||K===void 0)throw Error("you don't has some token account");let S=Xr({version:4,marketVersion:3,marketId:n.marketId,baseMint:r.mint,quoteMint:s.mint,baseDecimals:r.decimals,quoteDecimals:s.decimals,programId:t,marketProgramId:n.programId}),M={programId:t,ammId:S.id,ammAuthority:S.authority,ammOpenOrders:S.openOrders,lpMint:S.lpMint,coinMint:S.baseMint,pcMint:S.quoteMint,coinVault:S.baseVault,pcVault:S.quoteVault,withdrawQueue:S.withdrawQueue,ammTargetOrders:S.targetOrders,poolTempLp:S.lpVault,marketProgramId:S.marketProgramId,marketId:S.marketId,ammConfigId:S.configId,feeDestinationId:b},{instruction:V,instructionType:_}=Er(H(D({},M),{userWallet:this.scope.ownerPubKey,userCoinVault:k,userPcVault:K,userLpVault:me(this.scope.ownerPubKey,S.lpMint,p).publicKey,nonce:S.nonce,openTime:u,coinAmount:i,pcAmount:o}));return P.addInstruction({instructions:[V],instructionTypes:[_]}),P.addCustomComputeBudget(y),P.addTipInstruction(w),P.versionBuild({txVersion:d,extInfo:{address:M}})}async createMarketAndPoolV4({programId:t=Bi,marketProgram:n=Si,feeDestinationId:r=Ii,tokenProgram:s,baseMintInfo:i,quoteMintInfo:o,baseAmount:u,quoteAmount:l,startTime:c,ownerInfo:m,lowestFeeMarket:p,assignSeed:d,associatedOnly:b=!1,checkCreateATAOwner:y=!1,lotSize:w=1,tickSize:g=.01,txVersion:A,computeBudgetConfig:T,txTipConfig:h,feePayer:P}){var Hr,Yr,Zr;let k=this.scope.ownerPubKey,B=m.feePayer||((Hr=this.scope.owner)==null?void 0:Hr.publicKey),K=m.useSOLBalance&&i.mint.equals(Me.NATIVE_MINT),R=m.useSOLBalance&&o.mint.equals(Me.NATIVE_MINT),S=d?`${i.mint.toBase58().slice(0,7)}-${o.mint.toBase58().slice(0,7)}-${d}`:void 0,M=ot({fromPublicKey:k,programId:n,assignSeed:S&&`${S}-market`}),V=ot({fromPublicKey:k,programId:n,assignSeed:S&&`${S}-request`}),_=ot({fromPublicKey:k,programId:n,assignSeed:S&&`${S}-event`}),U=ot({fromPublicKey:k,programId:n,assignSeed:S&&`${S}-bids`}),te=ot({fromPublicKey:k,programId:n,assignSeed:S&&`${S}-asks`}),ne=ot({fromPublicKey:k,programId:Me.TOKEN_PROGRAM_ID,assignSeed:S&&`${S}-baseVault`}),ae=ot({fromPublicKey:k,programId:Me.TOKEN_PROGRAM_ID,assignSeed:S&&`${S}-quoteVault`}),Te=0,He=new be.default(100);function st(){let nt=new be.default(0);for(;;)try{return{vaultOwner:ke.PublicKey.createProgramAddressSync([M.publicKey.toBuffer(),nt.toArrayLike(Buffer,"le",8)],n),vaultSignerNonce:nt}}catch{if(nt.iaddn(1),nt.gt(new be.default(25555)))throw Error("find vault owner error")}}let{vaultOwner:_e,vaultSignerNonce:Ve}=st(),tt=new be.default(Math.round(10**i.decimals*w)),dt=new be.default(Math.round(w*10**o.decimals*g));if(tt.eq(ft))throw Error("lot size is too small");if(dt.eq(ft))throw Error("tick size or lot size is too small");let at=await zr({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:n,vaultOwner:_e,baseMint:i.mint,quoteMint:o.mint,id:M,baseVault:ne,quoteVault:ae,requestQueue:V,eventQueue:_,bids:U,asks:te,feeRateBps:Te,quoteDustThreshold:He,vaultSignerNonce:Ve,baseLotSize:tt,quoteLotSize:dt,lowestFeeMarket:p}}),Ue=this.createTxBuilder(P);Ue.addInstruction({instructions:at[0].transaction.instructions,signers:at[0].signer});for await(let nt of at.slice(1,at.length))Ue.addInstruction({instructions:nt.transaction.instructions,signers:nt.signer,instructionTypes:nt.instructionTypes});let{account:Ee,instructionParams:pt}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:K?{payer:B,amount:u}:void 0,notUseTokenAccount:K,skipCloseAccount:!K,associatedOnly:K?!1:b,checkCreateATAOwner:y,assignSeed:K&&S?`${S}-wsol`:void 0});Ue.addInstruction(pt||{});let{account:Jt,instructionParams:At}=await this.scope.account.getOrCreateTokenAccount({mint:o.mint,owner:this.scope.ownerPubKey,createInfo:R?{payer:B,amount:l}:void 0,notUseTokenAccount:R,skipCloseAccount:!R,associatedOnly:R?!1:b,checkCreateATAOwner:y,assignSeed:R&&S?`${S}-wsol`:void 0});if(Ue.addInstruction(At||{}),Ee===void 0)throw Error("you don't has base token account");if(Jt===void 0)throw Error("you don't has quote token account");let Ke=Xr({version:4,marketVersion:3,marketId:M.publicKey,baseMint:i.mint,quoteMint:o.mint,baseDecimals:i.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n}),Yn={programId:t,ammId:Ke.id,ammAuthority:Ke.authority,ammOpenOrders:Ke.openOrders,lpMint:Ke.lpMint,coinMint:Ke.baseMint,pcMint:Ke.quoteMint,coinVault:Ke.baseVault,pcVault:Ke.quoteVault,withdrawQueue:Ke.withdrawQueue,ammTargetOrders:Ke.targetOrders,poolTempLp:Ke.lpVault,marketProgramId:Ke.marketProgramId,marketId:Ke.marketId,ammConfigId:Ke.configId,feeDestinationId:r},{instruction:Wo,instructionType:Eo}=Er(H(D({},Yn),{userWallet:this.scope.ownerPubKey,userCoinVault:Ee,userPcVault:Jt,userLpVault:me(this.scope.ownerPubKey,Ke.lpMint,s).publicKey,nonce:Ke.nonce,openTime:c,coinAmount:u,pcAmount:l}));Ue.addInstruction({instructions:[Wo],instructionTypes:[Eo]});let jr=K||R?[((Yr=pt==null?void 0:pt.instructions)==null?void 0:Yr[0])||((Zr=At==null?void 0:At.instructions)==null?void 0:Zr[0])].filter(nt=>!!nt):void 0;return A===0?Ue.sizeCheckBuildV0({computeBudgetConfig:T,splitIns:jr,address:D({requestQueue:V.publicKey,eventQueue:_.publicKey,bids:U.publicKey,asks:te.publicKey,baseVault:ne.publicKey,quoteVault:ae.publicKey,baseMint:new ke.PublicKey(i.mint),quoteMint:new ke.PublicKey(o.mint)},Yn)}):Ue.sizeCheckBuild({computeBudgetConfig:T,splitIns:jr,address:D({requestQueue:V.publicKey,eventQueue:_.publicKey,bids:U.publicKey,asks:te.publicKey,baseVault:ne.publicKey,quoteVault:ae.publicKey,baseMint:new ke.PublicKey(i.mint),quoteMint:new ke.PublicKey(o.mint)},Yn)})}async getCreatePoolFee({programId:t}){let n=jn({programId:t}),r=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(r===null)throw Error("get config account error");return yo.decode(r.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:r,mintOut:s,slippage:i}){let[o,u]=[r.toString(),s.toString()];if(o!==t.mintA.address&&o!==t.mintB.address)throw new Error("toke not match");if(u!==t.mintA.address&&u!==t.mintB.address)throw new Error("toke not match");let{baseReserve:l,quoteReserve:c}=t,m=[l,c],p=[t.mintA.decimals,t.mintB.decimals],d=o==t.mintA.address?"base":"quote";d==="quote"&&(m.reverse(),p.reverse());let[b,y]=m,[w,g]=p,A=t.version===4,T;if(A)T=new le.default(y.toString()).div(10**g).div(new le.default(b.toString()).div(10**w));else{let _=xo(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),!1);d==="quote"?T=new le.default(1e6).div(_*1e6):T=new le.default(_*1e6).div(1e6)}let h=n,P=new be.default(0),k=new be.default(0);if(!h.isZero())if(A){k=cn(h.mul(Cr),qn);let _=h.sub(k),U=b.add(_);P=y.mul(_).div(U)}else{k=h.mul(new be.default(2)).div(new be.default(1e4));let _=h.sub(k);d==="quote"?P=new be.default(To(this.stableLayout.stableModelData,c.toNumber(),l.toNumber(),_.toNumber())):P=new be.default(ho(this.stableLayout.stableModelData,c.toNumber(),l.toNumber(),_.toNumber()))}let B=new be.default(new le.default(P.toString()).mul(1-i).toFixed(0)),K=P,R=B,S=new le.default(P.toString()).div(new le.default(h.sub(k).toString()).toFixed(0));!h.isZero()&&!P.isZero()&&(S=new le.default(P.toString()).div(10**g).div(new le.default(h.sub(k).toString()).div(10**w)));let M=T.sub(S).div(T).mul(100);return{amountOut:K,minAmountOut:R,currentPrice:T,executionPrice:S,priceImpact:M,fee:k}}computeAmountIn({poolInfo:t,amountOut:n,mintIn:r,mintOut:s,slippage:i}){let{baseReserve:o,quoteReserve:u}=t;r.toString()!==t.mintA.address&&r.toString()!==t.mintB.address&&this.logAndCreateError("mintIn does not match pool"),s.toString()!==t.mintA.address&&s.toString()!==t.mintB.address&&this.logAndCreateError("mintOut does not match pool"),this.logDebug("baseReserve:",o.toString()),this.logDebug("quoteReserve:",u.toString());let l=r.toString()===t.mintA.address,[c,m]=l?[t.mintA,t.mintB]:[t.mintB,t.mintA];this.logDebug("currencyOut:",m.symbol||m.address),this.logDebug("amountOut:",new le.default(n.toString()).div(10**m.decimals).toDecimalPlaces(m.decimals).toString(),c.symbol||c.address),this.logDebug("slippage:",`${i*100}%`);let p=[o,u],d=l?"quote":"base";d==="base"&&p.reverse(),this.logDebug("output side:",d);let[b,y]=p,w=new le.default(y.toString()).div(10**t[l?"mintB":"mintA"].decimals).div(new le.default(b.toString()).div(10**t[l?"mintA":"mintB"].decimals));this.logDebug("currentPrice:",`1 ${c.symbol||c.address} \u2248 ${w.toString()} ${m.symbol||m.address}`),this.logDebug("currentPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new le.default(1).div(w).toString()} ${c.symbol||c.address}`);let g=new be.default(0),A=n;if(!A.isZero()){A.gt(y)&&(A=y.sub(new be.default(1)));let R=y.sub(A);g=b.mul(A).div(R).mul(qn).div(qn.sub(Cr))}let T=new be.default(new le.default(g.toString()).mul(1+i).toFixed(0)),h=g,P=T;this.logDebug("amountIn:",new le.default(h.toString()).div(10**c.decimals).toDecimalPlaces(c.decimals).toString()),this.logDebug("maxAmountIn:",new le.default(P.toString()).div(10**c.decimals).toDecimalPlaces(c.decimals).toString());let k=null;!g.isZero()&&!A.isZero()&&(k=new le.default(A.toString()).div(10**m.decimals).div(new le.default(g.toString()).div(10**c.decimals)),this.logDebug("executionPrice:",`1 ${m.symbol||m.address} \u2248 ${k.toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${c.symbol||c.address}`),this.logDebug("executionPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new le.default(1).div(k).toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${c.symbol||c.address}`));let B=w.mul(h.toString()),K=B.sub(n.toString()).abs().div(B);return this.logDebug("priceImpact:",`${K.toString()}%`),{amountIn:h,maxAmountIn:P,currentPrice:w,executionPrice:k,priceImpact:K}}async swap({poolInfo:t,poolKeys:n,amountIn:r,amountOut:s,inputMint:i,fixedSide:o,txVersion:u,config:l,computeBudgetConfig:c,txTipConfig:m,feePayer:p}){let d=this.createTxBuilder(p),{associatedOnly:b=!0,inputUseSolBalance:y=!0,outputUseSolBalance:w=!0}=l||{},[g,A]=i===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],T=y&&g.address===Ot.toBase58(),h=w&&A.address===Ot.toBase58(),{account:P,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Me.TOKEN_PROGRAM_ID,mint:new ke.PublicKey(g.address),owner:this.scope.ownerPubKey,createInfo:T?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!T,notUseTokenAccount:T,associatedOnly:b});d.addInstruction(k||{}),P||this.logAndCreateError("input token account not found",{token:g.symbol||g.address,tokenAccountIn:P,inputTokenUseSolBalance:T,associatedOnly:b});let{account:B,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Me.TOKEN_PROGRAM_ID,mint:new ke.PublicKey(A.address),owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:b});d.addInstruction(K||{}),B===void 0&&this.logAndCreateError("output token account not found",{token:A.symbol||A.address,tokenAccountOut:B,outputTokenUseSolBalance:h,associatedOnly:b});let R=n||await this.getAmmPoolKeys(t.id),S=4;return t.pooltype.includes("StablePool")&&(S=5),d.addInstruction({instructions:[ko({version:S,poolKeys:R,userKeys:{tokenAccountIn:P,tokenAccountOut:B,owner:this.scope.ownerPubKey},amountIn:r,amountOut:s,fixedSide:o})],instructionTypes:[S===4?X.AmmV4SwapBaseIn:X.AmmV5SwapBaseIn]}),d.addCustomComputeBudget(c),d.addTipInstruction(m),d.versionBuild({txVersion:u})}async getRpcPoolInfo(t){return(await this.getRpcPoolInfos([t]))[t]}async getRpcPoolInfos(t,n){let r=await Bt(this.scope.connection,t.map(c=>({pubkey:new ke.PublicKey(c)})),n),s={},i=[];for(let c=0;c<t.length;c++){let m=r[c];if(m===null||!m.accountInfo)throw Error("fetch pool info error: "+String(t[c]));let p=_r.decode(m.accountInfo.data);s[String(t[c])]=H(D({},p),{programId:m.accountInfo.owner}),i.push(p.baseVault,p.quoteVault)}let o={},u=await Bt(this.scope.connection,i.map(c=>({pubkey:new ke.PublicKey(c)})),n);for(let c=0;c<i.length;c++){let m=u[c].accountInfo;if(m===null)throw Error("fetch vault info error: "+i[c]);o[String(i[c])]=new be.default(Me.AccountLayout.decode(m.data).amount.toString())}let l={};for(let[c,m]of Object.entries(s)){let p=o[m.baseVault.toString()].sub(m.baseNeedTakePnl),d=o[m.quoteVault.toString()].sub(m.quoteNeedTakePnl);l[c]=H(D({},m),{baseReserve:p,mintAAmount:o[m.baseVault.toString()],mintBAmount:o[m.quoteVault.toString()],quoteReserve:d,poolPrice:new le.default(d.toString()).div(new le.default(10).pow(m.quoteDecimal.toString())).div(new le.default(p.toString()).div(new le.default(10).pow(m.baseDecimal.toString())))})}return l}async getPoolInfoFromRpc({poolId:t}){let n=await this.getRpcPoolInfo(t),r=vo({[t]:n}),s=r[t],i=await this.scope.tradeV2.computePoolToPoolKeys({pools:[r[t]],ammRpcData:{[t]:n}});return{poolRpcData:n,poolInfo:s,poolKeys:i[0]}}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=liquidity.js.map