var Do=Object.create;var tn=Object.defineProperty,qo=Object.defineProperties,Go=Object.getOwnPropertyDescriptor,Uo=Object.getOwnPropertyDescriptors,Xo=Object.getOwnPropertyNames,xn=Object.getOwnPropertySymbols,Qo=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty,ei=Object.prototype.propertyIsEnumerable;var $r=(a,e,t)=>e in a?tn(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,F=(a,e)=>{for(var t in e||(e={}))er.call(e,t)&&$r(a,t,e[t]);if(xn)for(var t of xn(e))ei.call(e,t)&&$r(a,t,e[t]);return a},j=(a,e)=>qo(a,Uo(e));var De=(a,e)=>{var t={};for(var n in a)er.call(a,n)&&e.indexOf(n)<0&&(t[n]=a[n]);if(a!=null&&xn)for(var n of xn(a))e.indexOf(n)<0&&ei.call(a,n)&&(t[n]=a[n]);return t};var zo=(a,e)=>{for(var t in e)tn(a,t,{get:e[t],enumerable:!0})},ti=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Xo(e))!er.call(a,r)&&r!==t&&tn(a,r,{get:()=>e[r],enumerable:!(n=Go(e,r))||n.enumerable});return a};var ee=(a,e,t)=>(t=a!=null?Do(Qo(a)):{},ti(e||!a||!a.__esModule?tn(t,"default",{value:a,enumerable:!0}):t,a)),jo=a=>ti(tn({},"__esModule",{value:!0}),a);var xa={};zo(xa,{default:()=>Jn});module.exports=jo(xa);var he=require("@solana/web3.js"),ve=require("@solana/spl-token");var Ni=require("@solana/web3.js");var it=ee(require("bn.js")),os=ee(require("decimal.js"));var ui=ee(require("big.js")),an=ee(require("bn.js"));var nn=require("lodash");var tr=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ni={},Ho={};function ue(a){let e=(0,nn.get)(ni,a);if(!e){let t=(0,nn.get)(Ho,a);e=new tr({name:a,logLevel:t}),(0,nn.set)(ni,a,e)}return e}var ri=ee(require("toformat")),Yo=ri.default,rn=Yo;var on=ee(require("big.js")),oi=ee(require("bn.js")),si=ee(require("decimal.js-light"));var qt=ee(require("bn.js"));var ii=9007199254740991;function te(a){let e=ue("Raydium_parseBigNumberish");if(a instanceof qt.default)return a;if(typeof a=="string"){if(a.match(/^-?[0-9]+$/))return new qt.default(a);e.logWithError(`invalid BigNumberish string: ${a}`)}return typeof a=="number"?(a%1&&e.logWithError(`BigNumberish number underflow: ${a}`),(a>=ii||a<=-ii)&&e.logWithError(`BigNumberish number overflow: ${a}`),new qt.default(String(a))):typeof a=="bigint"?new qt.default(a.toString()):(e.error(`invalid BigNumberish value: ${a}`),new qt.default(0))}var Sn=ue("module/fraction"),nr=rn(on.default),sn=rn(si.default),Jo={[0]:sn.ROUND_DOWN,[1]:sn.ROUND_HALF_UP,[2]:sn.ROUND_UP},$o={[0]:on.default.roundDown,[1]:on.default.roundHalfUp,[2]:on.default.roundUp},oe=class{constructor(e,t=new oi.default(1)){this.numerator=te(e),this.denominator=te(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new oe(this.denominator,this.numerator)}add(e){let t=e instanceof oe?e:new oe(te(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.add(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof oe?e:new oe(te(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.sub(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof oe?e:new oe(te(e));return new oe(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof oe?e:new oe(te(e));return new oe(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Sn.logWithError(`${e} is not an integer.`),e<=0&&Sn.logWithError(`${e} is not positive.`),sn.set({precision:e+1,rounding:Jo[n]});let r=new sn(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Sn.logWithError(`${e} is not an integer.`),e<0&&Sn.logWithError(`${e} is negative.`),nr.DP=e,nr.RM=$o[n]||1,new nr(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var es=ue("Raydium_amount"),ai=rn(ui.default);function ts(a,e){let t="0",n="0";if(a.includes(".")){let r=a.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):es.logWithError(`invalid number string, num: ${a}`)}else t=a;return[t,n.slice(0,e)||n]}var Ae=class extends oe{constructor(t,n,r=!0,s){let i=new an.default(0),o=rr.pow(new an.default(t.decimals));if(r)i=te(n);else{let u=new an.default(0),l=new an.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[c,m]=ts(n.toString(),t.decimals);u=te(c),l=te(m)}u=u.mul(o),i=u.add(l)}super(i,o);this.logger=ue(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Ae(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Ae(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return ai.DP=this.token.decimals,new ai(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var ci=require("@solana/web3.js"),ir=require("@solana/spl-token"),or={chainId:101,address:ci.PublicKey.default.toBase58(),programId:ir.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ct={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ir.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var In=require("@solana/web3.js");var se=require("@solana/web3.js"),li=require("@solana/spl-token");function K({pubkey:a,isSigner:e=!1,isWritable:t=!0}){return{pubkey:a,isWritable:t,isSigner:e}}var ns=[K({pubkey:li.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:se.SystemProgram.programId,isWritable:!1}),K({pubkey:se.SYSVAR_RENT_PUBKEY,isWritable:!1})];function sr({publicKey:a,transformSol:e}){let t=ar(a.toString());if(t instanceof se.PublicKey)return e&&t.equals(Ut)?Gt:t;if(e&&t.toString()===Ut.toBase58())return Gt;if(typeof t=="string"){if(t===se.PublicKey.default.toBase58())return se.PublicKey.default;try{return new se.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ar(a){try{return new se.PublicKey(a)}catch{return a}}var Bn=new se.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ur=new se.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Je=new se.PublicKey("SysvarRent111111111111111111111111111111111"),Qa=new se.PublicKey("SysvarC1ock11111111111111111111111111111111"),xt=new se.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),rs=new se.PublicKey("Sysvar1nstructions1111111111111111111111111"),za=se.SystemProgram.programId,ja=new se.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ha=new se.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ya=new se.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Za=new se.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ja=new se.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),$a=new se.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),eu=new se.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),tu=new se.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),nu=new se.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ru=new se.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),iu=new se.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Gt=new se.PublicKey("So11111111111111111111111111111111111111112"),Ut=se.PublicKey.default;function Xt(a){return sr({publicKey:a,transformSol:!0})}var cr=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:s=!1,isToken2022:i=!1}){if(e===Ut.toBase58()||e instanceof In.PublicKey&&Ut.equals(e)){this.decimals=ct.decimals,this.symbol=ct.symbol,this.name=ct.name,this.mint=new In.PublicKey(ct.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=s?In.PublicKey.default:sr({publicKey:e}),this.isToken2022=i}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ne=cr;Ne.WSOL=new cr(j(F({},ct),{mint:ct.address}));var lr=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Kn=lr;Kn.SOL=new lr(or);var di=ee(require("bn.js"));var mi=new oe(new di.default(100)),He=class extends oe{toSignificant(e=5,t,n){return this.mul(mi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(mi).toFixed(e,t,n)}};var is=ue("Raydium_price"),Ye=class extends oe{constructor(t){let{baseToken:n,quoteToken:r,numerator:s,denominator:i}=t;super(s,i);this.baseToken=n,this.quoteToken=r,this.scalar=new oe(mr(n.decimals),mr(r.decimals))}get raw(){return new oe(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ye({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&is.logWithError("mul token not equals");let n=super.mul(t);return new Ye({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var pi=require("@solana/web3.js"),fi=ee(require("bn.js"));function bi(a){return typeof a=="object"&&a!==null&&![Ne,Ae,pi.PublicKey,oe,fi.default,Ye,He].some(e=>typeof e=="object"&&a instanceof e)}function St(a){return typeof a=="string"?ar(a):Array.isArray(a)?a.map(e=>St(e)):bi(a)?Object.fromEntries(Object.entries(a).map(([e,t])=>[e,St(t)])):a}var yt=new it.default(0),yi=new it.default(1),zu=new it.default(2),ju=new it.default(3),Hu=new it.default(5),rr=new it.default(10),Yu=new it.default(100),Zu=new it.default(1e3),Ju=new it.default(1e4);function mr(a){return rr.pow(te(a))}function Ln(a,e){let t=a.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function dr(a,e=1,t=[]){let n=[...a];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var ot=class{constructor(e){this._owner=e}get publicKey(){return ot.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return ot.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return ot.isKeyPair(this._owner)}get isPublicKey(){return ot.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!ot.isKeyPair(e)}};var Ai=require("@solana/web3.js"),Pi=require("@solana/spl-token");var Me=require("@solana/web3.js");var X={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var wi=require("@solana/spl-token"),gi=ue("Raydium_txUtil"),ki=1644;function un(a){let e=[],t=[];return a.microLamports&&(e.push(Me.ComputeBudgetProgram.setComputeUnitPrice({microLamports:a.microLamports})),t.push(X.SetComputeUnitPrice)),a.units&&(e.push(Me.ComputeBudgetProgram.setComputeUnitLimit({units:a.units})),t.push(X.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Bt(a,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=a.getLatestBlockhash)==null?void 0:n.call(a,{commitment:t})))==null?void 0:r.blockhash}async function cn(a,e){return a.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);a.onSignature(e,s=>{if(clearTimeout(r),!s.err){t("");return}n(Object.assign(s.err,{txId:e}))},"confirmed")})}function ss(a,e){a.length<1&&gi.logWithError(`no instructions provided: ${a.toString()}`),e.length<1&&gi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Me.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...a);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ki}catch{return!1}}function ke(a,e){let[t,n]=Me.PublicKey.findProgramAddressSync(a,e);return{publicKey:t,nonce:n}}function ln({instructions:a,payer:e,signers:t}){return ss(a,[e,...t])}function lt({instructions:a,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Me.Keypair.generate().publicKey.toString()}){let s=new Me.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:a}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Me.VersionedTransaction(s).serialize()).toString("base64").length<ki}catch{return!1}}var as=a=>Buffer.isBuffer(a)?a:a instanceof Uint8Array?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a),us=a=>{let e=a.serialize({requireAllSignatures:!1,verifySignatures:!1});a instanceof Me.VersionedTransaction&&(e=as(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function gt(a){let e=[];return a.forEach(t=>{t instanceof Me.Transaction&&(t.recentBlockhash||(t.recentBlockhash=wi.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=Me.Keypair.generate().publicKey)),e.push(us(t))}),console.log("simulate tx string:",e),e}function de(a,e,t){return ke([a.toBuffer(),(t!=null?t:Pi.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new Ai.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var D=require("@solana/web3.js"),hi=new D.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ti=new D.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),xi=new D.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Si=new D.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),fc=new D.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Bi=new D.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),bc=new D.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ii=new D.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),yc=new D.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),gc=new D.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),wc=new D.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),kc=new D.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ac=new D.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),It=new D.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Pc=new D.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ki=new D.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),hc=new D.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Tc=new D.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),xc=new D.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Sc=new D.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Bc=new D.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ic=new D.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Kc=new D.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Lc=new D.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Rc=new D.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Cc=new D.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Nc=new D.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Mc=new D.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),_c=new D.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Vc=new D.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vc=new D.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Kt={OPEN_BOOK_PROGRAM:new D.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new D.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new D.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new D.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new D.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new D.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new D.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new D.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new D.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new D.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new D.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new D.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:D.PublicKey.default,Router:new D.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new D.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new D.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new D.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new D.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new D.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new D.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new D.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new D.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new D.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new D.PublicKey("Ray1111111111111111111111111111111111111111")};var Ze=ee(require("bn.js")),mn=1e4;function Pe(a,e,t,n){if(e===void 0)return{amount:a,fee:void 0,expirationTime:void 0};let r=j(F({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),s=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,i=new Ze.default(s.maximumFee.toString()),o=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(s.transferFeeBasisPoints===mn){let u=new Ze.default(s.maximumFee.toString());return{amount:a.add(u),fee:u,expirationTime:o}}else{let u=dn(a.mul(new Ze.default(mn)),new Ze.default(mn-s.transferFeeBasisPoints)),l=new Ze.default(s.maximumFee.toString()),c=u.sub(a).gt(l)?a.add(l):u,m=dn(c.mul(new Ze.default(s.transferFeeBasisPoints)),new Ze.default(mn)),p=m.gt(i)?i:m;return{amount:c,fee:p,expirationTime:o}}else{let u=dn(a.mul(new Ze.default(s.transferFeeBasisPoints)),new Ze.default(mn)),l=u.gt(i)?i:u;return{amount:a,fee:l,expirationTime:o}}}function wt(a,e){return a===void 0?e:e===void 0?a:Math.min(a,e)}function dn(a,e){let{div:t,mod:n}=a.divmod(e);return n.gt(new Ze.default(0))?t.add(new Ze.default(1)):t}var $e=require("@solana/web3.js");async function Rn({connection:a,address:e,cluster:t="mainnet"}){let n=await mt(a,[...new Set(e.map(s=>s.toString()))].map(s=>new $e.PublicKey(s))),r={};for(let s=0;s<e.length;s++){let i=n[s],o=e[s];if(!i)continue;let u=new $e.AddressLookupTableAccount({key:o,state:$e.AddressLookupTableAccount.deserialize(i.data)});r[o.toString()]=u,t==="devnet"?Qt[o.toString()]=u:pn[o.toString()]=u}return r}var pn={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new $e.AddressLookupTableAccount({key:new $e.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:$e.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Qt={},Cn=async a=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Qt[e])return Qt;let t=new $e.PublicKey(e),n=await a.getAccountInfo(t);return n&&(Qt[e]=new $e.AddressLookupTableAccount({key:t,state:$e.AddressLookupTableAccount.deserialize(n.data)})),Qt};var Y=require("@solana/web3.js"),Ri=ee(require("axios"));var fn=2e3,bn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Ri.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=un(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Y.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Y.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(X.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:s=[],lookupTableAddress:i=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...i.filter(o=>o!==Y.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(F({},t||{})):this.build(t)}build(e){var n;let t=new Y.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var c;let{recentBlockHash:s,skipPreflight:i=!0,sendAndConfirm:o,notSendToRpc:u}=r||{},l=s!=null?s:await Bt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),gt([t]),(c=this.owner)!=null&&c.isKeyPair)return{txId:o?await(0,Y.sendAndConfirmTransaction)(this.connection,t,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:i}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:i}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let p of m)try{p.sign(...this.signers)}catch{}return{txId:u?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:i}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),s=t.filter(c=>c.transaction.instructions.length>0),i=[r,...s.map(c=>c.transaction)],o=[this.signers,...s.map(c=>c.signers)],u=[...this.instructionTypes,...s.map(c=>c.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(c=>{c.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:i,signers:o,instructionTypes:u,execute:async c=>{var g;let{sequentially:m,onTxUpdate:p,skipTxCount:d=0,recentBlockHash:f,skipPreflight:y=!0}=c||{},w=f!=null?f:await Bt(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(m){let P=[],T=0;for(let h of i){if(++T,T<=d)continue;let A=await(0,Y.sendAndConfirmTransaction)(this.connection,h,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});P.push(A)}return{txIds:P,signedTxs:i}}return{txIds:await await Promise.all(i.map(async P=>(P.recentBlockhash=w,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:y})))),signedTxs:i}}if(this.signAllTransactions){let P=i.map((h,A)=>(h.recentBlockhash=w,o[A].length&&h.sign(...o[A]),h));gt(P);let T=await this.signAllTransactions(P);if(m){let h=0,A=[],k=async()=>{if(!T[h])return;let S=await this.connection.sendRawTransaction(T[h].serialize(),{skipPreflight:y});A.push({txId:S,status:"sent",signedTx:T[h]}),p==null||p([...A]),h++;let x=!1,L=null,I=null,N=M=>{L!==null&&clearInterval(L),I!==null&&this.connection.removeSignatureListener(I);let C=A.findIndex(v=>v.txId===S);if(C>-1){if(A[C].status==="error"||A[C].status==="success")return;A[C].status=M.err?"error":"success"}p==null||p([...A]),M.err||k()};this.loopMultiTxStatus&&(L=setInterval(async()=>{var M;if(x){clearInterval(L);return}try{let C=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(x=!0,clearInterval(L),N({err:((M=C.meta)==null?void 0:M.err)||null}),console.log("tx status from getTransaction:",S))}catch(C){x=!0,clearInterval(L),console.error("getTransaction timeout:",C,S)}},fn)),I=this.connection.onSignature(S,M=>{if(x){this.connection.removeSignatureListener(I);return}x=!0,N(M)},"confirmed"),this.connection.getSignatureStatus(S)};return await k(),{txIds:A.map(S=>S.txId),signedTxs:T}}else{let h=[];for(let A=0;A<T.length;A+=1){let k=await this.connection.sendRawTransaction(T[A].serialize(),{skipPreflight:y});h.push(k)}return{txIds:h,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var y;let f=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:s}=f,i=De(f,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=F(F({},this.cluster==="devnet"?await Cn(this.connection):pn),t),u=Array.from(new Set([...n,...this.lookupTableAddress])),l=[];for(let w of u)o[w]===void 0&&l.push(new Y.PublicKey(w));let c=await Rn({connection:this.connection,address:l});for(let[w,g]of Object.entries(c))o[w]=g;let m=r?Y.PublicKey.default.toBase58():s!=null?s:await Bt(this.connection,this.blockhashCommitment),p=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((y=this.owner)==null?void 0:y.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Y.VersionedTransaction(p);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var h;let{skipPreflight:g=!0,sendAndConfirm:P,notSendToRpc:T}=w||{};if(gt([d]),(h=this.owner)!=null&&h.isKeyPair){let A=await this.connection.sendTransaction(d,{skipPreflight:g});return P&&await cn(this.connection,A),{txId:A,signedTx:d}}if(this.signAllTransactions){let A=await this.signAllTransactions([d]);if(this.signers.length)for(let k of A)try{k.sign(this.signers)}catch{}return{txId:T?"":await this.connection.sendTransaction(A[0],{skipPreflight:g}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),s=t.filter(c=>c.builder.instructions.length>0),i=[r,...s.map(c=>c.transaction)],o=[this.signers,...s.map(c=>c.signers)],u=[...this.instructionTypes,...s.map(c=>c.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(c=>{c.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),i.forEach(async(c,m)=>{c.sign(o[m])}),{builder:this,transactions:i,signers:o,instructionTypes:u,buildProps:n,execute:async c=>{var y;let{sequentially:m,onTxUpdate:p,recentBlockHash:d,skipPreflight:f=!0}=c||{};if(d&&i.forEach(w=>w.message.recentBlockhash=d),gt(i),(y=this.owner)!=null&&y.isKeyPair){if(m){let w=[];for(let g of i){let P=await this.connection.sendTransaction(g,{skipPreflight:f});await cn(this.connection,P),w.push(P)}return{txIds:w,signedTxs:i}}return{txIds:await Promise.all(i.map(async w=>await this.connection.sendTransaction(w,{skipPreflight:f}))),signedTxs:i}}if(this.signAllTransactions){let w=await this.signAllTransactions(i);if(m){let g=0,P=[],T=async()=>{if(!w[g])return;let h=await this.connection.sendTransaction(w[g],{skipPreflight:f});P.push({txId:h,status:"sent",signedTx:w[g]}),p==null||p([...P]),g++;let A=!1,k=null,S=null,x=L=>{k!==null&&clearInterval(k),S!==null&&this.connection.removeSignatureListener(S);let I=P.findIndex(N=>N.txId===h);if(I>-1){if(P[I].status==="error"||P[I].status==="success")return;P[I].status=L.err?"error":"success"}p==null||p([...P]),L.err||T()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var L;if(A){clearInterval(k);return}try{let I=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});I&&(A=!0,clearInterval(k),x({err:((L=I.meta)==null?void 0:L.err)||null}),console.log("tx status from getTransaction:",h))}catch(I){A=!0,clearInterval(k),console.error("getTransaction timeout:",I,h)}},fn)),S=this.connection.onSignature(h,L=>{if(A){this.connection.removeSignatureListener(S);return}A=!0,x(L)},"confirmed"),this.connection.getSignatureStatus(h)};return T(),{txIds:[],signedTxs:w}}else{let g=[];for(let P=0;P<w.length;P+=1){let T=await this.connection.sendTransaction(w[P],{skipPreflight:f});g.push(T)}return{txIds:g,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var p;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,r=De(m,["splitIns","computeBudgetConfig"]),s=n?un(n):{instructions:[],instructionTypes:[]},i=this.signers.reduce((d,f)=>j(F({},d),{[f.publicKey.toBase58()]:f}),{}),o=[],u=[],l=[],c=0;if(this.allInstructions.forEach(d=>{let f=[...l,d],y=n?[...s.instructions,...f]:f,g=[...new Set(f.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(P=>new Y.PublicKey(P));if(d!==t[c]&&l.length<12&&(ln({instructions:y,payer:this.feePayer,signers:g})||ln({instructions:f,payer:this.feePayer,signers:g})))l.push(d);else{if(l.length===0)throw Error("item ins too big");c+=d===t[c]?1:0,ln({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:g})?o.push(new Y.Transaction().add(...s.instructions,...l)):o.push(new Y.Transaction().add(...l)),u.push(Array.from(new Set(l.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(P=>i[P]).filter(P=>P!==void 0)),l=[d]}}),l.length>0){let f=[...new Set(l.map(y=>y.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(y=>i[y]).filter(y=>y!==void 0);ln({instructions:n?[...s.instructions,...l]:[...l],payer:this.feePayer,signers:f.map(y=>y.publicKey)})?o.push(new Y.Transaction().add(...s.instructions,...l)):o.push(new Y.Transaction().add(...l)),u.push(f)}return o.forEach(d=>d.feePayer=this.feePayer),(p=this.owner)!=null&&p.signer&&u.forEach(d=>{d.some(f=>f.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:o,signers:u,instructionTypes:this.instructionTypes,execute:async d=>{var h;let{sequentially:f,onTxUpdate:y,skipTxCount:w=0,recentBlockHash:g,skipPreflight:P=!0}=d||{},T=g!=null?g:await Bt(this.connection,this.blockhashCommitment);if(o.forEach(async(A,k)=>{A.recentBlockhash=T,u[k].length&&A.sign(...u[k])}),gt(o),(h=this.owner)!=null&&h.isKeyPair){if(f){let A=0,k=[];for(let S of o){if(++A,A<=w){k.push("tx skipped");continue}let x=await(0,Y.sendAndConfirmTransaction)(this.connection,S,this.signers.find(L=>L.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:P});k.push(x)}return{txIds:k,signedTxs:o}}return{txIds:await Promise.all(o.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:P}))),signedTxs:o}}if(this.signAllTransactions){let A=await this.signAllTransactions(o.slice(w,o.length)),k=[...o.slice(0,w),...A];if(f){let S=0,x=[],L=async()=>{if(!k[S])return;S<w&&(x.push({txId:"",status:"success",signedTx:k[S]}),y==null||y([...x]),S++,L());let I=await this.connection.sendRawTransaction(k[S].serialize(),{skipPreflight:P});x.push({txId:I,status:"sent",signedTx:k[S]}),y==null||y([...x]),S++;let N=!1,M=null,C=null,v=J=>{M!==null&&clearInterval(M),C!==null&&this.connection.removeSignatureListener(C);let Z=x.findIndex($=>$.txId===I);if(Z>-1){if(x[Z].status==="error"||x[Z].status==="success")return;x[Z].status=J.err?"error":"success"}y==null||y([...x]),J.err||L()};this.loopMultiTxStatus&&(M=setInterval(async()=>{var J;if(N){clearInterval(M);return}try{let Z=await this.connection.getTransaction(I,{commitment:"confirmed",maxSupportedTransactionVersion:0});Z&&(N=!0,clearInterval(M),v({err:((J=Z.meta)==null?void 0:J.err)||null}),console.log("tx status from getTransaction:",I))}catch(Z){N=!0,clearInterval(M),console.error("getTransaction timeout:",Z,I)}},fn)),C=this.connection.onSignature(I,J=>{if(N){this.connection.removeSignatureListener(C);return}N=!0,v(J)},"confirmed"),this.connection.getSignatureStatus(I)};return await L(),{txIds:x.map(I=>I.txId),signedTxs:k}}else{let S=[];for(let x=0;x<k.length;x+=1){let L=await this.connection.sendRawTransaction(k[x].serialize(),{skipPreflight:P});S.push(L)}return{txIds:S,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var T;let P=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:r={},lookupTableAddress:s=[]}=P,i=De(P,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=F(F({},this.cluster==="devnet"?await Cn(this.connection):pn),r),u=Array.from(new Set([...this.lookupTableAddress,...s])),l=[];for(let h of u)o[h]===void 0&&l.push(new Y.PublicKey(h));let c=await Rn({connection:this.connection,address:l});for(let[h,A]of Object.entries(c))o[h]=A;let m=t?un(t):{instructions:[],instructionTypes:[]},p=await Bt(this.connection,this.blockhashCommitment),d=this.signers.reduce((h,A)=>j(F({},h),{[A.publicKey.toBase58()]:A}),{}),f=[],y=[],w=[],g=0;if(this.allInstructions.forEach(h=>{let A=[...w,h],k=t?[...m.instructions,...A]:A;if(h!==n[g]&&w.length<12&&(lt({instructions:k,payer:this.feePayer,lookupTableAddressAccount:o})||lt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:o})))w.push(h);else{if(w.length===0)throw Error("item ins too big");g+=h===n[g]?1:0;let S={};for(let x of[...new Set(u)])o[x]!==void 0&&(S[x]=o[x]);if(t&&lt({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:p})){let x=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(x))}else{let x=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(x))}y.push(Array.from(new Set(w.map(x=>x.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(x=>d[x]).filter(x=>x!==void 0)),w=[h]}}),w.length>0){let A=[...new Set(w.map(k=>k.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&lt({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:p})){let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(k))}else{let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(k))}y.push(A)}return(T=this.owner)!=null&&T.signer&&y.forEach(h=>{h.some(A=>A.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),f.forEach((h,A)=>{h.sign(y[A])}),{builder:this,transactions:f,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async h=>{var I;let{sequentially:A,onTxUpdate:k,skipTxCount:S=0,recentBlockHash:x,skipPreflight:L=!0}=h||{};if(f.map(async(N,M)=>{y[M].length&&N.sign(y[M]),x&&(N.message.recentBlockhash=x)}),gt(f),(I=this.owner)!=null&&I.isKeyPair){if(A){let N=0,M=[];for(let C of f){if(++N,N<=S){console.log("skip tx: ",N),M.push("tx skipped");continue}let v=await this.connection.sendTransaction(C,{skipPreflight:L});await cn(this.connection,v),M.push(v)}return{txIds:M,signedTxs:f}}return{txIds:await Promise.all(f.map(async N=>await this.connection.sendTransaction(N,{skipPreflight:L}))),signedTxs:f}}if(this.signAllTransactions){let N=await this.signAllTransactions(f.slice(S,f.length)),M=[...f.slice(0,S),...N];if(A){let C=0,v=[],J=async()=>{if(!M[C])return;if(C<S){v.push({txId:"",status:"success",signedTx:M[C]}),k==null||k([...v]),C++,J();return}let Z=await this.connection.sendTransaction(M[C],{skipPreflight:L});v.push({txId:Z,status:"sent",signedTx:M[C]}),k==null||k([...v]),C++;let $=!1,me=null,Re=null,Qe=we=>{me!==null&&clearInterval(me),Re!==null&&this.connection.removeSignatureListener(Re);let fe=v.findIndex(ze=>ze.txId===Z);if(fe>-1){if(v[fe].status==="error"||v[fe].status==="success")return;v[fe].status=we.err?"error":"success"}k==null||k([...v]),we.err||J()};this.loopMultiTxStatus&&(me=setInterval(async()=>{var we;if($){clearInterval(me);return}try{let fe=await this.connection.getTransaction(Z,{commitment:"confirmed",maxSupportedTransactionVersion:0});fe&&($=!0,clearInterval(me),Qe({err:((we=fe.meta)==null?void 0:we.err)||null}),console.log("tx status from getTransaction:",Z))}catch(fe){$=!0,clearInterval(me),console.error("getTransaction timeout:",fe,Z)}},fn)),Re=this.connection.onSignature(Z,we=>{if($){this.connection.removeSignatureListener(Re);return}$=!0,Qe(we)},"confirmed"),this.connection.getSignatureStatus(Z)};return J(),{txIds:[],signedTxs:M}}else{let C=[];for(let v=0;v<M.length;v+=1){let J=await this.connection.sendTransaction(M[v],{skipPreflight:L});C.push(J)}return{txIds:C,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildSniperTransaction(e){var T;let P=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:r={},lookupTableAddress:s=[]}=P,i=De(P,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=F(F({},this.cluster==="devnet"?await Cn(this.connection):pn),r),u=Array.from(new Set([...this.lookupTableAddress,...s])),l=[];for(let h of u)o[h]===void 0&&l.push(new Y.PublicKey(h));let c=await Rn({connection:this.connection,address:l});for(let[h,A]of Object.entries(c))o[h]=A;let m=t?un(t):{instructions:[],instructionTypes:[]},p=await Bt(this.connection,this.blockhashCommitment),d=this.signers.reduce((h,A)=>j(F({},h),{[A.publicKey.toBase58()]:A}),{}),f=[],y=[],w=[],g=0;if(this.allInstructions.forEach(h=>{let A=[...w,h],k=t?[...m.instructions,...A]:A;if(h!==n[g]&&w.length<12&&(lt({instructions:k,payer:this.feePayer,lookupTableAddressAccount:o})||lt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:o})))w.push(h);else{if(w.length===0)throw Error("item ins too big");g+=h===n[g]?1:0;let S={};for(let x of[...new Set(u)])o[x]!==void 0&&(S[x]=o[x]);if(t&&lt({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:p})){let x=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(x))}else{let x=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(x))}y.push(Array.from(new Set(w.map(x=>x.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(x=>d[x]).filter(x=>x!==void 0)),w=[h]}}),w.length>0){let A=[...new Set(w.map(k=>k.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&lt({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:p})){let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(k))}else{let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(o));f.push(new Y.VersionedTransaction(k))}y.push(A)}return(T=this.owner)!=null&&T.signer&&y.forEach(h=>{h.some(A=>A.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),f.forEach((h,A)=>{h.sign(y[A])}),{builder:this,transactions:f,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async h=>{var I;let{sequentially:A,onTxUpdate:k,skipTxCount:S=0,recentBlockHash:x,skipPreflight:L=!0}=h||{};if(f.map(async(N,M)=>{y[M].length&&N.sign(y[M]),x&&(N.message.recentBlockhash=x)}),gt(f),(I=this.owner)!=null&&I.isKeyPair){if(A){let N=0,M=[];for(let C of f){if(++N,N<=S){console.log("skip tx: ",N),M.push("tx skipped");continue}let v=await this.connection.sendTransaction(C,{skipPreflight:L});await cn(this.connection,v),M.push(v)}return{txIds:M,signedTxs:f}}return{txIds:await Promise.all(f.map(async N=>await this.connection.sendTransaction(N,{skipPreflight:L}))),signedTxs:f}}if(this.signAllTransactions){let N=await this.signAllTransactions(f.slice(S,f.length)),M=[...f.slice(0,S),...N];if(A){let C=0,v=[],J=async()=>{if(!M[C])return;if(C<S){v.push({txId:"",status:"success",signedTx:M[C]}),k==null||k([...v]),C++,J();return}let Z=await this.connection.sendTransaction(M[C],{skipPreflight:L});v.push({txId:Z,status:"sent",signedTx:M[C]}),k==null||k([...v]),C++;let $=!1,me=null,Re=null,Qe=we=>{me!==null&&clearInterval(me),Re!==null&&this.connection.removeSignatureListener(Re);let fe=v.findIndex(ze=>ze.txId===Z);if(fe>-1){if(v[fe].status==="error"||v[fe].status==="success")return;v[fe].status=we.err?"error":"success"}k==null||k([...v]),we.err||J()};this.loopMultiTxStatus&&(me=setInterval(async()=>{var we;if($){clearInterval(me);return}try{let fe=await this.connection.getTransaction(Z,{commitment:"confirmed",maxSupportedTransactionVersion:0});fe&&($=!0,clearInterval(me),Qe({err:((we=fe.meta)==null?void 0:we.err)||null}),console.log("tx status from getTransaction:",Z))}catch(fe){$=!0,clearInterval(me),console.error("getTransaction timeout:",fe,Z)}},fn)),Re=this.connection.onSignature(Z,we=>{if($){this.connection.removeSignatureListener(Re);return}$=!0,Qe(we)},"confirmed"),this.connection.getSignatureStatus(Z)};return J(),{txIds:[],signedTxs:M}}else{let C=[];for(let v=0;v<M.length;v+=1){let J=await this.connection.sendTransaction(M[v],{skipPreflight:L});C.push(J)}return{txIds:C,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};var Ci=ee(require("bn.js")),Jc=new Ci.default(1e6);var Nn=require("@solana/spl-token"),pr=ue("Raydium_accountInfo_util");async function mt(a,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:s=100}=F({batchRequest:!1},t),i=dr(e,s),o=new Array(i.length).fill([]);if(n){let u=i.map(m=>{let p=a._buildArgs([m.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:p}}),l=dr(u,10);o=(await(await Promise.all(l.map(async m=>await a._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&pr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(p=>{if(p){let{data:d,executable:f,lamports:y,owner:w,rentEpoch:g}=p;return d.length!==2&&d[1]!=="base64"&&pr.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:f,lamports:y,owner:new Ni.PublicKey(w),rentEpoch:g}}return null})))}else try{o=await Promise.all(i.map(u=>a.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&pr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return o.flat()}async function Lt(a,e,t){let n=await mt(a,e.map(r=>r.pubkey),t);return e.map((r,s)=>j(F({},r),{accountInfo:n[s]}))}var vi=require("@solana/web3.js"),zt=ee(require("bn.js"));var q=require("@solana/buffer-layout"),Mn=q.Layout,Mi=q.Structure;var fr=q.UInt;var _i=q.u8,Rt=q.u16;var br=q.u32;var be=q.s32;var Vi=q.seq;var Se=q.blob;var yr=q.bits;var Ct=class extends Mn{constructor(t,n,r){super(t,r);this.blob=Se(t),this.signed=n}decode(t,n=0){let r=new zt.default(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new zt.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}},_n=class extends Mn{constructor(t){super(8,t);this._lower=yr(br(),!1),this._upper=yr(br(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let r=this._lower.decode(t,n),s=this._upper.decode(t,n+this._lower.span);return F(F({},r),s)}encode(t,n,r=0){return this._lower.encode(t,n,r)+this._upper.encode(t,n,r+this._lower.span)}};function E(a){return new fr(1,a)}function _e(a){return new fr(4,a)}function b(a){return new Ct(8,!1,a)}function G(a){return new Ct(16,!1,a)}function Ei(a){return new Ct(1,!0,a)}function jt(a){return new Ct(8,!0,a)}function Wi(a){return new Ct(16,!0,a)}var Vn=class extends Mn{constructor(t,n,r,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function R(a){return new Vn(Se(32),e=>new vi.PublicKey(e),e=>e.toBuffer(),a)}function Be(a){return new Vn(_i(),cs,ls,a)}function cs(a){if(a===0)return!1;if(a===1)return!0;throw new Error("Invalid bool: "+a)}function ls(a){return a?1:0}var gr=class extends Mi{decode(e,t){return super.decode(e,t)}};function _(a,e,t){return new gr(a,e,t)}function U(a,e,t){let n,r=typeof e=="number"?e:(0,zt.isBN)(e)?e.toNumber():new Proxy(e,{get(s,i){if(!n){let o=Reflect.get(s,"count");n=(0,zt.isBN)(o)?o.toNumber():o,Reflect.set(s,"count",n)}return Reflect.get(s,i)},set(s,i,o){return i==="count"&&(n=o),Reflect.set(s,i,o)}});return Vi(a,r,t)}var vn=require("@solana/web3.js");var ms=require("@solana/spl-token"),Wl=ue("Raydium_farm_config"),Ol=new vn.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Fl=new vn.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Dl=new vn.PublicKey("3TRTX4dXUpp2eqxi3tvQDFYUV7SdDJjcPE3Y4mbtftaX");var Oi={3:kr,5:Fi,6:Di};var En={"Standard SPL":0,"Option tokens":1},wr={[hi.toString()]:3,[Ti.toString()]:4,[xi.toString()]:5,[Si.toString()]:6,[Kt.FARM_PROGRAM_ID_V3.toString()]:3,[Kt.FARM_PROGRAM_ID_V4.toString()]:4,[Kt.FARM_PROGRAM_ID_V5.toString()]:5,[Kt.FARM_PROGRAM_ID_V6.toString()]:6};var Ar=_([E("instruction")]),bs=_([E("instruction")]),ys=_([b("rewardState"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardLastUpdateTime"),b("totalReward"),b("totalRewardEmissioned"),b("rewardClaimed"),b("rewardPerSecond"),G("accRewardPerShare"),R("rewardVault"),R("rewardMint"),R("rewardSender"),b("rewardType"),U(b(),15,"padding")]),gs=_([b("state"),b("nonce"),R("lpVault"),R("rewardVault"),R(),R(),b(),b(),b("totalReward"),G("perShareReward"),b("lastSlot"),b("perSlotReward")]),ws=_([b("state"),b("nonce"),R("lpVault"),R("rewardVaultA"),b("totalRewardA"),G("perShareRewardA"),b("perSlotRewardA"),E("option"),R("rewardVaultB"),Se(7),b("totalRewardB"),G("perShareRewardB"),b("perSlotRewardB"),b("lastSlot"),R()]),ks=_([b(),b("state"),b("nonce"),b("validRewardTokenNum"),G("rewardMultiplier"),b("rewardPeriodMax"),b("rewardPeriodMin"),b("rewardPeriodExtend"),R("lpMint"),R("lpVault"),U(ys,5,"rewardInfos"),R("creator"),R(),U(b(),32,"padding")]),ds=new Proxy(gs,{get(a,e,t){return e==="decode"?(...n)=>{let r=a.decode(...n);return j(F({},r),{version:3,rewardInfos:[{rewardVault:r.rewardVault,totalReward:r.totalReward,perSlotReward:r.perSlotReward,perShareReward:r.perShareReward}]})}:Reflect.get(a,e,t)}}),ps=new Proxy(ws,{get(a,e,t){return e==="decode"?(...n)=>{let r=a.decode(...n);return j(F({},r),{version:5,rewardInfos:[{rewardVault:r.rewardVaultA,totalReward:r.totalRewardA,perSlotReward:r.perSlotRewardA,perShareReward:r.perShareRewardA},{rewardVault:r.rewardVaultB,totalReward:r.totalRewardB,perSlotReward:r.perSlotRewardB,perShareReward:r.perShareRewardB}]})}:Reflect.get(a,e,t)}}),fs=new Proxy(ks,{get(a,e,t){return e==="decode"?(...n)=>{let r=a.decode(...n);return j(F({},r),{version:6,rewardInfos:r.rewardInfos.map(s=>{var i;return j(F({},s),{rewardType:((i=Object.entries(En).find(o=>String(o[1])===s.rewardType.toString()))!=null?i:["Standard SPL"])[0]})})})}:Reflect.get(a,e,t)}}),As=_([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),Ps=_([E("instruction"),b("nonce"),U(As,5,"rewardTimeInfo")]),hs=_([E("instruction"),b("rewardReopenTime"),b("rewardEndTime"),b("rewardPerSecond")]),Ts=_([E("instruction"),b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),jl=_([b("state"),R("id"),R("owner"),b("deposited"),U(b(),1,"rewardDebts")]),kr=_([b("state"),R("id"),R("owner"),b("deposited"),U(G(),1,"rewardDebts"),b(""),b("voteLockedBalance"),U(b(),15)]),Hl=_([b("state"),R("id"),R("owner"),b("deposited"),U(b(),2,"rewardDebts")]),Fi=_([b("state"),R("id"),R("owner"),b("deposited"),U(G(),2,"rewardDebts"),U(b(),17)]),Di=_([b(),b("state"),R("id"),R("owner"),b("deposited"),U(G(),5,"rewardDebts"),U(b(),16)]),Nt=_([E("instruction"),b("amount")]),xs=_([R("mint"),R("grantAuthority"),b("baselineVoteWeightScaledFactor"),b("maxExtraLockupVoteWeightScaledFactor"),b("lockupSaturationSecs"),Ei("digitShift"),U(E(),7,"reserved1"),U(b(),7,"reserved2")]),Ss=_([Se(8),R("governanceProgramId"),R("realm"),R("realmGoverningTokenMint"),R("realmAuthority"),U(E(),32,"reserved1"),U(xs,4,"votingMints"),jt("timeOffset"),E("bump"),U(E(),7,"reserved2"),U(b(),11,"reserved3")]),Bs=_([jt("startTime"),jt("endTime"),E("kind"),U(E(),15,"reserved")]),Is=_([U(Bs,1,"lockup"),b("amountDeposited_native"),b("amountInitiallyLockedNative"),Be("isUsed"),Be("allowClawback"),E("votingMintConfigIdx"),U(E(),29,"reserved")]),Ks=_([Se(8),R("voterAuthority"),R("registrar"),U(Is,32,"deposits"),E("voterBump"),E("voterWweightRecordBump"),U(E(),94,"reserved")]);var Ls=ee(require("bn.js"));var Wn=_([R("mint"),R("owner"),b("amount"),_e("delegateOption"),R("delegate"),E("state"),_e("isNativeOption"),b("isNative"),b("delegatedAmount"),_e("closeAuthorityOption"),R("closeAuthority")]);var Rs=ue("Raydium.farm.util");function Ht({programId:a,poolId:e,owner:t,version:n}){let{publicKey:r}=ke([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],a);return r}function qi(a){let e=Oi[a];return e||Rs.logWithError("invalid version",a),e}var ce=require("@solana/web3.js"),Cs=ee(require("bn.js")),Yt=require("@solana/spl-token");var Ns=ue("Raydium_farm_instruction"),Vm={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Gi(a){let{version:e,id:t,ledger:n,programId:r,owner:s}=a,i={3:9,5:10}[e];i||Ns.logWithError(`invalid farm pool version: ${e}`);let o=Buffer.alloc(Ar.span);Ar.encode({instruction:i},o);let u=[K({pubkey:t}),K({pubkey:n}),K({pubkey:s,isWritable:!1}),K({pubkey:ce.SystemProgram.programId,isWritable:!1}),K({pubkey:ce.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new ce.TransactionInstruction({programId:r,keys:u,data:o}),instructionType:X.FarmV3CreateLedger}}function Ui(a){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:s,amount:i}=a,[o,u]=[new ce.PublicKey(e.programId),new ce.PublicKey(e.id)],l=Ht({programId:o,poolId:u,owner:s,version:6}),c=Buffer.alloc(Nt.span);Nt.encode({instruction:2,amount:te(i)},c);let m=[K({pubkey:Yt.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:u}),K({pubkey:new ce.PublicKey(t.authority),isWritable:!1}),K({pubkey:new ce.PublicKey(t.lpVault)}),K({pubkey:l}),K({pubkey:s,isWritable:!1,isSigner:!0}),K({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)m.push(K({pubkey:new ce.PublicKey(t.rewardInfos[p].vault)})),m.push(K({pubkey:r[p]}));return new ce.TransactionInstruction({programId:o,keys:m,data:c})}function Xi(a){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:s,amount:i,userAuxiliaryLedgers:o}=a,[u,l]=[new ce.PublicKey(e.programId),new ce.PublicKey(e.id)],c=Ht({programId:u,poolId:l,owner:s,version:5}),m=Buffer.alloc(Nt.span);Nt.encode({instruction:12,amount:te(i)},m);let p=[K({pubkey:l}),K({pubkey:new ce.PublicKey(t.authority),isWritable:!1}),K({pubkey:c}),K({pubkey:s,isWritable:!1,isSigner:!0}),K({pubkey:n}),K({pubkey:new ce.PublicKey(t.lpVault)}),K({pubkey:r[0]}),K({pubkey:new ce.PublicKey(t.rewardInfos[0].vault)}),K({pubkey:ce.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),K({pubkey:Yt.TOKEN_PROGRAM_ID,isWritable:!1})];for(let d=1;d<t.rewardInfos.length;d++)p.push(K({pubkey:r[d]})),p.push(K({pubkey:new ce.PublicKey(t.rewardInfos[d].vault)}));if(o)for(let d of o)p.push(K({pubkey:d}));return new ce.TransactionInstruction({programId:u,keys:p,data:m})}function Qi(a){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:s,amount:i,userAuxiliaryLedgers:o}=a,[u,l]=[new ce.PublicKey(e.programId),new ce.PublicKey(e.id)],c=Ht({programId:u,poolId:l,owner:s,version:3}),m=Buffer.alloc(Nt.span);Nt.encode({instruction:11,amount:te(i)},m);let p=[K({pubkey:l}),K({pubkey:new ce.PublicKey(t.authority),isWritable:!1}),K({pubkey:c}),K({pubkey:s,isWritable:!1,isSigner:!0}),K({pubkey:n}),K({pubkey:new ce.PublicKey(t.lpVault)}),K({pubkey:r[0]}),K({pubkey:new ce.PublicKey(t.rewardInfos[0].vault)}),K({pubkey:ce.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),K({pubkey:Yt.TOKEN_PROGRAM_ID,isWritable:!1})];if(o)for(let d of o)p.push(K({pubkey:d}));return new ce.TransactionInstruction({programId:u,keys:p,data:m})}var B=require("@solana/web3.js"),Gn=ee(require("bn.js"));var W=require("@solana/spl-token");var co=ee(require("bn.js")),Wt=ee(require("decimal.js"));var qe=ee(require("bn.js")),ye=new qe.default(0),st=new qe.default(1),dt=new qe.default(-1),Ge=new qe.default(1).shln(64),On=new qe.default(1).shln(128),Pr=Ge.sub(st),yn=64,zi=On.subn(1),Ve=-443636,Ee=-Ve,Mt=new qe.default("4295048016"),_t=new qe.default("79226673521066979257578248091"),Um=new qe.default("4295048017"),Xm=new qe.default("79226673521066979257578248090"),ji=16,Hi="59543866431248",Yi="184467440737095516",Zi="15793534762490258745",Fn=new qe.default(10).pow(new qe.default(6));var Qm=new qe.default("18446744073700000000");var z=ee(require("bn.js")),tt=ee(require("decimal.js"));function Dn(a){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,a,!1),new Uint8Array(e)}function hr(a,e){let t=0;for(let n=a-1;n>=0&&!e.testn(n);n--)t++;return t}function Tr(a,e){let t=0;for(let n=0;n<a&&!e.testn(n);n++)t++;return t}function gn(a,e){for(let t=0;t<a;t++)if(e.testn(t))return!1;return!0}function Ji(a,e){return gn(a,e)?null:hr(a,e)}function $i(a,e){return gn(a,e)?null:Tr(a,e)}var Jm=Buffer.from("amm_config","utf8"),Ms=Buffer.from("pool","utf8"),_s=Buffer.from("pool_vault","utf8"),Vs=Buffer.from("pool_reward_vault","utf8"),eo=Buffer.from("position","utf8"),vs=Buffer.from("tick_array","utf8"),Es=Buffer.from("operation","utf8"),Ws=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Os=Buffer.from("observation","utf8");function to(a,e,t,n){return ke([Ms,e.toBuffer(),t.toBuffer(),n.toBuffer()],a)}function xr(a,e,t){return ke([_s,e.toBuffer(),t.toBuffer()],a)}function no(a,e,t){return ke([Vs,e.toBuffer(),t.toBuffer()],a)}function ae(a,e,t){return ke([vs,e.toBuffer(),Dn(t)],a)}function kt(a,e,t,n){return ke([eo,e.toBuffer(),Dn(t),Dn(n)],a)}function Ue(a,e){return ke([eo,e.toBuffer()],a)}function wn(a){return ke([Buffer.from("metadata","utf8"),xt.toBuffer(),a.toBuffer()],xt)}function Sr(a){return ke([Es],a)}function Le(a,e){return ke([Ws,e.toBuffer()],a)}function ro(a,e){return ke([Os,e.toBuffer()],a)}var io=Buffer.from("locked_position","utf8");function Br(a,e){return ke([io,e.toBuffer()],a)}function oo(a,e){return ke([io,e.toBuffer()],a)}var $m=Buffer.from("support_mint","utf8");var Fe=require("@solana/web3.js"),Kr=require("@solana/spl-token"),pe=ee(require("bn.js")),ne=ee(require("decimal.js"));var et=ee(require("bn.js")),qn=ee(require("decimal.js"));var kn=class{static getfeeGrowthInside(e,t,n){let r=new et.default(0),s=new et.default(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,s=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let i=new et.default(0),o=new et.default(0);e.tickCurrent<n.tick?(i=n.feeGrowthOutsideX64A,o=n.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64A,r),i),l=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64B,s),o);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:l}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:i}=this.getfeeGrowthInside(e,n,r),o=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,Ge),u=t.tokenFeesOwedA.add(o),l=H.mulDivFloor(H.wrappingSubU128(i,t.feeGrowthInsideLastX64B),t.liquidity,Ge),c=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:u,tokenFeeAmountB:c}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:i}=this.getfeeGrowthInside(e,n,r),o=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,Ge),u=t.tokenFeesOwedA.add(o),l=H.mulDivFloor(H.wrappingSubU128(i,t.feeGrowthInsideLastX64B),t.liquidity,Ge),c=t.tokenFeesOwedB.add(l);return{tokenFeeAmountA:u,tokenFeeAmountB:c}}static GetPositionRewardsV2(e,t,n,r){let s=[],i=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let o=0;o<i.length;o++){let u=i[o],l=t.rewardInfos[o],c=H.wrappingSubU128(u,l.growthInsideLastX64),m=H.mulDivFloor(c,t.liquidity,Ge),p=l.rewardAmountOwed.add(m);s.push(p)}return s}static GetPositionRewards(e,t,n,r){let s=[],i=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let o=0;o<i.length;o++){let u=i[o],l=t.rewardInfos[o],c=H.wrappingSubU128(u,l.growthInsideLastX64),m=H.mulDivFloor(c,t.liquidity,Ge),p=l.rewardAmountOwed.add(m);s.push(p)}return s}static getRewardGrowthInside(e,t,n,r){let s=[];for(let i=0;i<r.length;i++){let o=new et.default(0);t.liquidityGross.eqn(0)?o=r[i].rewardGrowthGlobalX64:e<t.tick?o=r[i].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[i]):o=t.rewardGrowthsOutsideX64[i];let u=new et.default(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[i]:u=r[i].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[i])),s.push(H.wrappingSubU128(H.wrappingSubU128(r[i].rewardGrowthGlobalX64,o),u))}return s}static getRewardGrowthInsideV2(e,t,n,r){let s=[];for(let i=0;i<r.length;i++){let o=new et.default(0);t.liquidityGross.eqn(0)?o=r[i].rewardGrowthGlobalX64:e<t.tick?o=r[i].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[i]):o=t.rewardGrowthsOutsideX64[i];let u=new et.default(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[i]:u=r[i].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[i])),s.push(H.wrappingSubU128(H.wrappingSubU128(r[i].rewardGrowthGlobalX64,o),u))}return s}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:s,epochInfo:i}){var w,g,P,T;let o=Q.priceToSqrtPriceX64(new qn.default(e.price),e.mintA.decimals,e.mintB.decimals),u=Q.getSqrtPriceX64FromTick(t.tickLower),l=Q.getSqrtPriceX64FromTick(t.tickUpper),c=s?1+r:1-r,m=ie.getAmountsFromLiquidity(o,u,l,n,s),[p,d]=[Pe(m.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,i,!0),Pe(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,i,!0)],[f,y]=[Pe(new et.default(new qn.default(m.amountA.toString()).mul(c).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,i,!0),Pe(new et.default(new qn.default(m.amountB.toString()).mul(c).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,i,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:f,amountSlippageB:y,expirationTime:wt(p.expirationTime,d.expirationTime)}}};var Fs=15,re=class{static async getTickArrays(e,t,n,r,s,i,o){let u=[],l=O.getTickArrayStartIndexByTick(r,s),c=O.getInitializedTickArrayInRange(i,o,s,l,Math.floor(Fs/2));for(let d=0;d<c.length;d++){let{publicKey:f}=ae(t,n,c[d]);u.push(f)}let m=(await mt(e,u)).map(d=>d!==null?An.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let f=m[d];f!==null&&(p[f.startTickIndex]=j(F({},f),{address:u[d]}))}return p}static nextInitializedTick(e,t,n,r,s,i){let{initializedTick:o,tickArrayAddress:u,tickArrayStartTickIndex:l}=this.nextInitializedTickInOneArray(e,t,n,r,s,i);for(;o==null||o.liquidityGross.lten(0);){if(l=O.getNextTickArrayStartIndex(l,s,i),this.checkIsValidStartIndex(l,s))throw new Error("No enough initialized tickArray");let c=n[l];if(c===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,c,i);[o,u,l]=[m,p,d]}if(o==null)throw new Error("No invaild tickArray cache");return{nextTick:o,tickArrayAddress:u,tickArrayStartTickIndex:l}}static nextInitializedTickArray(e,t,n,r,s){let i=Math.floor(e/re.tickCount(t)),o=n?O.searchLowBitFromStart(r,s,i-1,1,t):O.searchHightBitFromStart(r,s,i+1,1,t);return o.length>0?{isExist:!0,nextStartIndex:o[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let s;if(r){let o=Ie-1;for(;o>=0;){let u=n.ticks[o];if(u.liquidityGross.gtn(0)){s=u;break}o=o-1}}else{let o=0;for(;o<Ie;){let u=n.ticks[o];if(u.liquidityGross.gtn(0)){s=u;break}o=o+1}}let{publicKey:i}=ae(e,t,n.startTickIndex);return{nextTick:s,tickArrayAddress:i,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,s,i){let o=O.getTickArrayStartIndexByTick(r,s),u=Math.floor((r-o)/s),l=n[o];if(l==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:o};let c;if(i)for(;u>=0;){let p=l.ticks[u];if(p.liquidityGross.gtn(0)){c=p;break}u=u-1}else for(u=u+1;u<Ie;){let p=l.ticks[u];if(p.liquidityGross.gtn(0)){c=p;break}u=u+1}let{publicKey:m}=ae(e,t,o);return{initializedTick:c,tickArrayAddress:m,tickArrayStartTickIndex:l.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(O.checkIsOutOfBoundary(e)){if(e>Ee)return!1;let n=O.getTickArrayStartIndexByTick(Ve,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Ie*e}};var Ir=14,pt=class{static maxTickInTickarrayBitmap(e){return e*Ie*Vt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let s=n*r;return e<0?{minValue:-s,maxValue:-s+n}:{minValue:s,maxValue:s+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!re.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let s=this.maxTickInTickarrayBitmap(n),i=r?t-re.tickCount(n):t+re.tickCount(n);if(i<-s||i>=s)return{isInit:!1,tickIndex:t};let o=n*Ie,u=i/o+512;i<0&&i%o!=0&&u--;let l=Math.abs(u);if(r){let c=e.shln(1024-l-1),m=Ji(1024,c);if(m!==null){let p=(l-m-512)*o;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-s}}else{let c=e.shrn(l),m=$i(1024,c);if(m!==null){let p=(l+m-512)*o;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:s-re.tickCount(n)}}}},Pn=class{static getBitmapOffset(e,t){if(!re.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=pt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=pt.maxTickInTickarrayBitmap(e),n=-t;if(Ee<=t)throw Error(`extensionTickBoundary check error: ${Ee}, ${t}`);if(n<=Ve)throw Error(`extensionTickBoundary check error: ${n}, ${Ve}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),s=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:O.mergeTickArrayBitmap(r).testn(s),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let s=re.tickCount(t),i=n?e-s:e+s,{tickarrayBitmap:o}=this.getBitmap(i,t,r);return this.nextInitializedTickArrayInBitmap(o,i,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:s,maxValue:i}=pt.getBitmapTickBoundary(t,n),o=this.tickArrayOffsetInBitmap(t,n);if(r){let u=O.mergeTickArrayBitmap(e).shln(Vt-1-o),l=gn(512,u)?null:hr(512,u);if(l!==null){let c=t-l*re.tickCount(n);return{isInit:!0,tickIndex:c}}else return{isInit:!1,tickIndex:s}}else{let u=O.mergeTickArrayBitmap(e).shrn(o),l=gn(512,u)?null:Tr(512,u);if(l!==null){let c=t+l*re.tickCount(n);return{isInit:!0,tickIndex:c}}else return{isInit:!1,tickIndex:i-re.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%pt.maxTickInTickarrayBitmap(t),r=Math.floor(n/re.tickCount(t));return e<0&&n!=0&&(r=Vt-r),r}};var Te=class{static getOutputAmountAndRemainAccounts(e,t,n,r,s,i=!1){let o=n.toBase58()===e.mintA.address,u=[],{isExist:l,startIndex:c,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,o);if(!l||c===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:p,amountCalculated:d,accounts:f,sqrtPriceX64:y,feeAmount:w}=vt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,s,i);return u.push(...f),{allTrade:p,expectedAmountOut:d.mul(dt),remainingAccounts:u,executionPrice:y,feeAmount:w}}static getInputAmountAndRemainAccounts(e,t,n,r,s){let i=n.toBase58()===e.mintB.address,o=[],{isExist:u,startIndex:l,nextAccountMeta:c}=this.getFirstInitializedTickArray(e,i);if(!u||l===void 0||!c)throw new Error("Invalid tick array");try{let y=this.preInitializedTickArrayStartIndex(e,i);if(y.isExist){let{publicKey:w}=ae(e.programId,e.id,y.nextStartIndex);o.push(w)}}catch{}o.push(c);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:f}=vt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,i,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(dt),l,s);return o.push(...p),{expectedAmountIn:m,remainingAccounts:o,executionPrice:d,feeAmount:f}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Te.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Pn.checkTickArrayIsInit(re.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):O.checkTickArrayIsInitialized(O.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:o}=ae(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:o}}let{isExist:s,nextStartIndex:i}=this.nextInitializedTickArrayStartIndex(e,re.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(s){let{publicKey:o}=ae(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:o}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/re.tickCount(e.tickSpacing)),r=t?O.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):O.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=re.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:s}=pt.nextInitializedTickArrayStartIndex(O.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:s};t=s;let{isInit:i,tickIndex:o}=Pn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(i)return{isExist:!0,nextStartIndex:o};if(t=o,t<Ve||t>Ee)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:s}){var o,u,l;let i=[];for(let c=0;c<s.length;c++){let m=s[c],p=(l=(o=t.rewardDefaultInfos[c])==null?void 0:o.mint.programId)!=null?l:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d=j(F({},m),{perSecond:H.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Fe.PublicKey(p)});if(d.tokenMint.equals(Fe.PublicKey.default))continue;if(n<=d.openTime.toNumber()||r.eq(ye)){i.push(d);continue}let f=new pe.default(Math.min(d.endTime.toNumber(),n)),y=f.sub(d.lastUpdateTime),w=H.mulDivFloor(y,d.emissionsPerSecondX64,r),g=d.rewardGrowthGlobalX64.add(w),P=H.mulDivFloor(y,d.emissionsPerSecondX64,Ge),T=d.rewardTotalEmissioned.add(P);i.push(j(F({},d),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:T,lastUpdateTime:f}))}return i}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let s of t){let i=O.getTickArrayStartIndexByTick(s,e);if(i>=n||i<r)return!0}return!1}static tickRange(e){let t=pt.maxTickInTickarrayBitmap(e),n=-t;return t>Ee&&(t=re.getArrayStartIndex(Ee,e)+re.tickCount(e)),n<Ve&&(n=re.getArrayStartIndex(Ve,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!re.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/re.tickCount(t)*Vt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Lt(e,t.map(i=>({pubkey:i})),{batchRequest:n}),s={};for(let i of r)i.accountInfo!==null&&(s[i.pubkey.toString()]=uo.decode(i.accountInfo.data));return s}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},s=[];for(let u of t){let l=O.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),c=O.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,l,7);for(let m of c){let{publicKey:p}=ae(u.programId,u.id,m);s.push({pubkey:p}),r[p.toString()]=u.id}}let i=await Lt(e,s,{batchRequest:n}),o={};for(let u of i){if(!u.accountInfo)continue;let l=r[u.pubkey.toString()];if(!l)continue;o[l.toString()]===void 0&&(o[l.toString()]={});let c=An.decode(u.accountInfo.data);o[l.toString()][c.startTickIndex]=j(F({},c),{address:u.pubkey})}return o}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:s=!0}){var o;let i=[];for(let u=0;u<e.length;u++){let l=e[u];l!==null&&(i.find(c=>c.equals(l.state.programId))||i.push(l.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),l=[];for(let p of u)for(let d of i)l.push(Ue(d,p).publicKey);let c=await mt(t,l,{batchRequest:r}),m={};for(let p of c){if(p===null)continue;let d=ao.decode(p.data),f=d.poolId.toString(),y=e.find(x=>x.state.id.toBase58()===f);if(y===void 0)continue;let w=y.state,g=O._getTickPriceLegacy({poolInfo:w,tick:d.tickLower,baseIn:!0}),P=O._getTickPriceLegacy({poolInfo:w,tick:d.tickUpper,baseIn:!0}),{amountA:T,amountB:h}=ie.getAmountsFromLiquidity(w.sqrtPriceX64,g.tickSqrtPriceX64,P.tickSqrtPriceX64,d.liquidity,!1),A=1/(1-Math.sqrt(Math.sqrt(g.price.div(P.price).toNumber())));y.positionAccount=[...(o=y.positionAccount)!=null?o:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:g.price,priceUpper:P.price,amountA:T,amountB:h,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(x=>j(F({},x),{pendingReward:new pe.default(0)})),leverage:A,tokenFeeAmountA:new pe.default(0),tokenFeeAmountB:new pe.default(0)}];let k=await O.getTickArrayAddressByTick(y.state.programId,d.poolId,d.tickLower,y.state.tickSpacing),S=await O.getTickArrayAddressByTick(y.state.programId,d.poolId,d.tickUpper,y.state.tickSpacing);m[`${y.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=k,m[`${y.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=S}if(s){let p=Object.values(m),d=await mt(t,p,{batchRequest:r}),f={};for(let y=0;y<p.length;y++){let w=d[y];if(w===null)continue;let g=p[y].toString();f[g]=An.decode(w.data)}for(let{state:y,positionAccount:w}of e)if(!!w)for(let g of w){let P=`${y.programId.toString()}-${y.id.toString()}-${g.tickLower}`,T=`${y.programId.toString()}-${y.id.toString()}-${g.tickUpper}`,h=f[m[P].toString()],A=f[m[T].toString()],k=h.ticks[O.getTickOffsetInArray(g.tickLower,y.tickSpacing)],S=A.ticks[O.getTickOffsetInArray(g.tickUpper,y.tickSpacing)],{tokenFeeAmountA:x,tokenFeeAmountB:L}=await kn.GetPositionFees(y,g,k,S),I=await kn.GetPositionRewards(y,g,k,S);g.tokenFeeAmountA=x.gte(new pe.default(0))?x:new pe.default(0),g.tokenFeeAmountB=L.gte(new pe.default(0))?L:new pe.default(0);for(let N=0;N<I.length;N++)g.rewardInfos[N].pendingReward=I[N].gte(new pe.default(0))?I[N]:new pe.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:s,slippage:i,priceLimit:o=new ne.default(0),catchLiquidityInsufficient:u=!1}){var M;let l,c=n.toBase58()===e.mintA.address,[m,p]=c?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];o.equals(new ne.default(0))?l=c?Mt.add(new pe.default(1)):_t.sub(new pe.default(1)):l=Q.priceToSqrtPriceX64(o,e.mintA.decimals,e.mintB.decimals);let d=Pe(s,m,r,!1),{allTrade:f,expectedAmountOut:y,remainingAccounts:w,executionPrice:g,feeAmount:P}=Te.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((M=d.fee)!=null?M:ye),l,u),T=Pe(y,p,r,!1),h=Q.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),A=c?h:new ne.default(1).div(h),k=y.mul(new pe.default(Math.floor((1-i)*1e10))).div(new pe.default(1e10)),S=Pe(k,p,r,!1),x=c?e.currentPrice:new ne.default(1).div(e.currentPrice),L=new ne.default(A).sub(x).abs(),I=x,N=new He(new ne.default(L).mul(10**15).toFixed(0),new ne.default(I).mul(10**15).toFixed(0));return{allTrade:f,realAmountIn:d,amountOut:T,minAmountOut:S,expirationTime:wt(d.expirationTime,T.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:N,fee:P,remainingAccounts:w,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:s,epochInfo:i,catchLiquidityInsufficient:o=!1}){let u=r.address===e.mintB.address,[l,c]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,p]=[new Ne(j(F({},l),{mint:l.address,isToken2022:l.programId===Kr.TOKEN_2022_PROGRAM_ID.toBase58()})),new Ne(j(F({},c),{mint:c.address,isToken2022:c.programId===Kr.TOKEN_2022_PROGRAM_ID.toBase58()}))],{allTrade:d,realAmountIn:f,amountOut:y,minAmountOut:w,expirationTime:g,currentPrice:P,executionPrice:T,priceImpact:h,fee:A,remainingAccounts:k,executionPriceX64:S}=Te.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Fe.PublicKey(l.address),amountIn:n,slippage:s,epochInfo:i,catchLiquidityInsufficient:o}),x=j(F({},f),{amount:new Ae(m,f.amount),fee:f.fee===void 0?void 0:new Ae(m,f.fee)}),L=j(F({},y),{amount:new Ae(p,y.amount),fee:y.fee===void 0?void 0:new Ae(p,y.fee)}),I=j(F({},w),{amount:new Ae(p,w.amount),fee:w.fee===void 0?void 0:new Ae(p,w.fee)}),N=new Ye({baseToken:m,denominator:new pe.default(10).pow(new pe.default(20+m.decimals)),quoteToken:p,numerator:P.mul(new ne.default(10**(20+p.decimals))).toFixed(0)}),M=new Ye({baseToken:m,denominator:new pe.default(10).pow(new pe.default(20+m.decimals)),quoteToken:p,numerator:T.mul(new ne.default(10**(20+p.decimals))).toFixed(0)}),C=new Ae(m,A);return{allTrade:d,realAmountIn:x,amountOut:L,minAmountOut:I,expirationTime:g,currentPrice:N,executionPrice:M,priceImpact:h,fee:C,remainingAccounts:k,executionPriceX64:S}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:s,slippage:i,priceLimit:o=new ne.default(0)}){var I;let u=n.toBase58()===e.mintA.address,l={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},c;o.equals(new ne.default(0))?c=u?_t.sub(new pe.default(1)):Mt.add(new pe.default(1)):c=Q.priceToSqrtPriceX64(o,e.mintA.decimals,e.mintB.decimals);let m=Pe(s,l[n.toString()],r,!0),{expectedAmountIn:p,remainingAccounts:d,executionPrice:f,feeAmount:y}=Te.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((I=m.fee)!=null?I:ye),c),w=u?e.mintB.address:e.mintA.address,g=Pe(p,l[w],r,!1),P=Q.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),T=u?P:new ne.default(1).div(P),h=p.mul(new pe.default(Math.floor((1+i)*1e10))).div(new pe.default(1e10)),A=Pe(h,l[w],r,!0),k=u?e.currentPrice:new ne.default(1).div(e.currentPrice),S=new ne.default(T).sub(k).abs(),x=k,L=new He(new ne.default(S).mul(10**15).toFixed(0),new ne.default(x).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:A,realAmountOut:m,expirationTime:wt(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:T,priceImpact:L,fee:y,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var f,y,w;let s=e[t],i=O.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),o=O.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(i,s.priceMin),c=Math.min(o,s.priceMax)-u,m=o-i,p=s.priceMax-s.priceMin,d;return c<=0?d=0:m===c?d=p/c:p===c?d=c/m:d=c/p*(c/m),{feeApr:s.feeApr*d,rewardsApr:[((f=s.rewardApr[0])!=null?f:0)*d,((y=s.rewardApr[1])!=null?y:0)*d,((w=s.rewardApr[2])!=null?w:0)*d],apr:s.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:s,positionTickLowerIndex:i,positionTickUpperIndex:o,chainTime:u}){let l=n==="day"?1:n==="week"?7:n==="month"?30:0,c=e[n],m=r[Xt(e.mintA.address).toString()],p=r[Xt(e.mintB.address).toString()],d=e.mintA.decimals,f=e.mintB.decimals;if(!c||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let y=Q.priceToSqrtPriceX64(new ne.default(e.price),e.mintA.decimals,e.mintB.decimals),w=Q.getSqrtPriceX64FromTick(i),g=Q.getSqrtPriceX64FromTick(o),{amountSlippageA:P,amountSlippageB:T}=ie.getAmountsFromLiquidityWithSlippage(y,w,g,t,!1,!1,0),{amountSlippageA:h,amountSlippageB:A}=ie.getAmountsFromLiquidityWithSlippage(y,w,g,s,!1,!1,0),k=new ne.default(P.toString()).div(new ne.default(10).pow(d)).mul(m.value).add(new ne.default(T.toString()).div(new ne.default(10).pow(f)).mul(p.value)),S=new ne.default(h.toString()).div(new ne.default(10).pow(d)).mul(m.value).add(new ne.default(A.toString()).div(new ne.default(10).pow(f)).mul(p.value)),x=new ne.default(1).div(k.add(S)),I=new ne.default(c.volumeFee).mul(365).div(l).mul(x).mul(100).toNumber(),N=3600*24*365,M=e.rewardDefaultInfos.map(C=>{var Z,$;let v=C.mint.decimals,J=r[C.mint.address];return u<((Z=C.startTime)!=null?Z:0)||u>(($=C.endTime)!=null?$:0)||!C.perSecond||!J||v===void 0?0:new ne.default(J.value).mul(new ne.default(C.perSecond).mul(N)).div(new ne.default(10).pow(v)).mul(x).mul(100).toNumber()});return{feeApr:I,rewardsApr:M,apr:I+M.reduce((C,v)=>C+v,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:s,slippage:i,add:o,epochInfo:u,amountHasFee:l}){var g,P;let c=Q.priceToSqrtPriceX64(new ne.default(e.price),e.mintA.decimals,e.mintB.decimals),m=Q.getSqrtPriceX64FromTick(n),p=Q.getSqrtPriceX64FromTick(r),d=Pe(s,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!l),f=new pe.default(new ne.default(d.amount.sub((P=d.fee)!=null?P:ye).toString()).toFixed(0)),y;if(c.lte(m))y=t?ie.getLiquidityFromTokenAmountA(m,p,f,!o):new pe.default(0);else if(c.lte(p)){let T=ie.getLiquidityFromTokenAmountA(c,p,f,!o),h=ie.getLiquidityFromTokenAmountB(m,c,f);y=t?T:h}else y=t?new pe.default(0):ie.getLiquidityFromTokenAmountB(m,p,f);let w=await Te.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:i,add:o});return{liquidity:y,amountA:t?d:w.amountA,amountB:t?w.amountB:d,amountSlippageA:t?d:w.amountSlippageA,amountSlippageB:t?w.amountSlippageB:d,expirationTime:w.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:s,slippage:i,add:o}){var w,g,P,T;let u=Q.getSqrtPriceX64FromTick(n),l=Q.getSqrtPriceX64FromTick(r),c=o?1+i:1-i,m=ie.getAmountsFromLiquidity(Q.priceToSqrtPriceX64(new ne.default(t.price),t.mintA.decimals,t.mintB.decimals),u,l,s,o),[p,d]=[Pe(m.amountA,(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),Pe(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[f,y]=[Pe(m.amountA.muln(c),(P=t.mintA.extensions)==null?void 0:P.feeConfig,e,!0),Pe(m.amountB.muln(c),(T=t.mintB.extensions)==null?void 0:T.feeConfig,e,!0)];return{liquidity:s,amountA:p,amountB:d,amountSlippageA:f,amountSlippageB:y,expirationTime:wt(p.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Fe.PublicKey(u.id));(await mt(e,r)).forEach((u,l)=>{!u||(n[r[l].toBase58()]=so.decode(u.data))});let i=t.map(u=>Le(new Fe.PublicKey(u.programId),new Fe.PublicKey(u.id)).publicKey),o=await Te.fetchExBitmaps({connection:e,exBitmapAddress:i,batchRequest:!1});return t.reduce((u,l)=>j(F({},u),{[l.id]:j(F({},n[l.id]),{id:new Fe.PublicKey(l.id),version:6,programId:new Fe.PublicKey(l.programId),mintA:l.mintA,mintB:l.mintB,ammConfig:j(F({},l.config),{id:new Fe.PublicKey(l.config.id),fundOwner:""}),currentPrice:new ne.default(l.price),exBitmapAccount:Le(new Fe.PublicKey(l.programId),new Fe.PublicKey(l.id)).publicKey,exBitmapInfo:o[Le(new Fe.PublicKey(l.programId),new Fe.PublicKey(l.id)).publicKey.toBase58()],startTime:n[l.id].startTime.toNumber(),rewardInfos:n[l.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var H=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),s=r.div(n);return r.mod(n).eq(ye)||(s=s.add(st)),s}static mulDivFloor(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).add(n.sub(st)).div(n)}static x64ToDecimal(e,t){return new tt.default(e.toString()).div(tt.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new z.default(e.mul(tt.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(On).sub(t).mod(On)}};function Ke(a,e){return Lr(a.mul(e),64,256)}function Ds(a,e,t){let n=a.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Lr(a,e,t){let n=a.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var Q=class{static sqrtPriceX64ToPrice(e,t,n){return H.x64ToDecimal(e).pow(2).mul(tt.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return H.decimalToX64(e.mul(tt.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ye))return e;let s=t.shln(yn);if(r){let i=s,o=s.add(n.mul(e));return o.gte(i)?H.mulDivCeil(i,e,o):H.mulDivRoundingUp(i,st,i.div(e).add(n))}else{let i=n.mul(e);if(!s.gt(i))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let o=s.sub(i);return H.mulDivCeil(s,e,o)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let s=n.shln(yn);if(r)return e.add(s.div(t));{let i=H.mulDivRoundingUp(s,st,t);if(!e.gt(i))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(i)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ve||e>Ee)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new z.default("18445821805675395072"):new z.default("18446744073709551616");return(t&2)!=0&&(n=Ke(n,new z.default("18444899583751176192"))),(t&4)!=0&&(n=Ke(n,new z.default("18443055278223355904"))),(t&8)!=0&&(n=Ke(n,new z.default("18439367220385607680"))),(t&16)!=0&&(n=Ke(n,new z.default("18431993317065453568"))),(t&32)!=0&&(n=Ke(n,new z.default("18417254355718170624"))),(t&64)!=0&&(n=Ke(n,new z.default("18387811781193609216"))),(t&128)!=0&&(n=Ke(n,new z.default("18329067761203558400"))),(t&256)!=0&&(n=Ke(n,new z.default("18212142134806163456"))),(t&512)!=0&&(n=Ke(n,new z.default("17980523815641700352"))),(t&1024)!=0&&(n=Ke(n,new z.default("17526086738831433728"))),(t&2048)!=0&&(n=Ke(n,new z.default("16651378430235570176"))),(t&4096)!=0&&(n=Ke(n,new z.default("15030750278694412288"))),(t&8192)!=0&&(n=Ke(n,new z.default("12247334978884435968"))),(t&16384)!=0&&(n=Ke(n,new z.default("8131365268886854656"))),(t&32768)!=0&&(n=Ke(n,new z.default("3584323654725218816"))),(t&65536)!=0&&(n=Ke(n,new z.default("696457651848324352"))),(t&131072)!=0&&(n=Ke(n,new z.default("26294789957507116"))),(t&262144)!=0&&(n=Ke(n,new z.default("37481735321082"))),e>0&&(n=zi.div(n)),n}static getTickFromPrice(e,t,n){return Q.getTickFromSqrtPriceX64(Q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(_t)||e.lt(Mt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new z.default(t-64),r=Ds(n,32,128),s=new z.default("8000000000000000","hex"),i=0,o=new z.default(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;s.gt(new z.default(0))&&i<ji;){u=u.mul(u);let f=u.shrn(127);u=u.shrn(63+f.toNumber()),o=o.add(s.mul(f)),s=s.shrn(1),i+=1}let l=o.shrn(32),m=r.add(l).mul(new z.default(Hi)),p=Lr(m.sub(new z.default(Yi)),64,128).toNumber(),d=Lr(m.add(new z.default(Zi)),64,128).toNumber();return p==d?p:Q.getSqrtPriceX64FromTick(d).lte(e)?d:p}},Et=class{static getTickWithPriceAndTickspacing(e,t,n,r){let i=Q.getTickFromSqrtPriceX64(Q.priceToSqrtPriceX64(e,n,r))/t;return i<0?i=Math.floor(i):i=Math.ceil(i),i*t}static roundPriceWithTickspacing(e,t,n,r){let s=Et.getTickWithPriceAndTickspacing(e,t,n,r),i=Q.getSqrtPriceX64FromTick(s);return Q.sqrtPriceX64ToPrice(i,n,r)}},ie=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");let s=n.ushln(yn),i=t.sub(e);return r?H.mulDivRoundingUp(H.mulDivCeil(s,i,t),st,e):H.mulDivFloor(s,i,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");return r?H.mulDivCeil(n,t.sub(e),Ge):H.mulDivFloor(n,t.sub(e),Ge)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let s=n.mul(e).mul(t),i=t.sub(e),o=s.div(i);return r?H.mulDivRoundingUp(o,st,Pr):o.shrn(yn)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),H.mulDivFloor(n,Pr,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ie.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let i=ie.getLiquidityFromTokenAmountA(e,n,r,!1),o=ie.getLiquidityFromTokenAmountB(t,e,s);return i.lt(o)?i:o}else return ie.getLiquidityFromTokenAmountB(t,n,s)}static getAmountsFromLiquidity(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ie.getTokenAmountAFromLiquidity(t,n,r,s),amountB:new z.default(0)};if(e.lt(n)){let i=ie.getTokenAmountAFromLiquidity(e,n,r,s),o=ie.getTokenAmountBFromLiquidity(t,e,r,s);return{amountA:i,amountB:o}}else return{amountA:new z.default(0),amountB:ie.getTokenAmountBFromLiquidity(t,n,r,s)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,s,i,o){let{amountA:u,amountB:l}=ie.getAmountsFromLiquidity(e,t,n,r,i),c=s?1+o:1-o,m=new z.default(new tt.default(u.toString()).mul(c).toFixed(0)),p=new z.default(new tt.default(l.toString()).mul(c).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:s,add:i,epochInfo:o,amountAddFee:u}){var P,T,h,A;let l=Q.priceToSqrtPriceX64(new tt.default(e.price),e.mintA.decimals,e.mintB.decimals),c=Q.getSqrtPriceX64FromTick(t),m=Q.getSqrtPriceX64FromTick(n),p=i?1+s:1-s,d=ie.getAmountsFromLiquidity(l,c,m,r,i),[f,y]=[Pe(d.amountA,(P=e.mintA.extensions)==null?void 0:P.feeConfig,o,u),Pe(d.amountB,(T=e.mintB.extensions)==null?void 0:T.feeConfig,o,u)],[w,g]=[Pe(new z.default(new tt.default(d.amountA.toString()).mul(p).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,o,u),Pe(new z.default(new tt.default(d.amountB.toString()).mul(p).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,o,u)];return{liquidity:r,amountA:f,amountB:y,amountSlippageA:w,amountSlippageB:g,expirationTime:wt(f.expirationTime,y.expirationTime)}}},vt=class{static swapCompute(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y=!1){if(p.eq(ye))throw new Error("amountSpecified must not be 0");if(f||(f=i?Mt.add(st):_t.sub(st)),i){if(f.lt(Mt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(f.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(f.gt(_t))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(f.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let w=p.gt(ye),g={amountSpecifiedRemaining:p,amountCalculated:ye,sqrtPriceX64:m,tick:l>d?Math.min(d+re.tickCount(c)-1,l):d,accounts:[],liquidity:u,feeAmount:new z.default(0)},P=d,T=n[d],h=0,A=!i&&T.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ye)&&!g.sqrtPriceX64.eq(f);){h>10;let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let S=O.nextInitTick(T,g.tick,c,i,A),x=S||null,L=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let N=Te.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:c,tickArrayBitmap:r,exBitmapInfo:s},P,i);if(!N.isExist){if(y)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}P=N.nextStartIndex;let{publicKey:M}=ae(e,t,P);L=M,T=n[P];try{x=O.firstInitializedTick(T,i)}catch{throw Error("not found next tick info")}}k.tickNext=x.tick,k.initialized=x.liquidityGross.gtn(0),d!==P&&L&&(g.accounts.push(L),d=P),k.tickNext<Ve?k.tickNext=Ve:k.tickNext>Ee&&(k.tickNext=Ee),k.sqrtPriceNextX64=Q.getSqrtPriceX64FromTick(k.tickNext);let I;if(i&&k.sqrtPriceNextX64.lt(f)||!i&&k.sqrtPriceNextX64.gt(f)?I=f:I=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=vt.swapStepCompute(g.sqrtPriceX64,I,g.liquidity,g.amountSpecifiedRemaining,o,i),g.feeAmount=g.feeAmount.add(k.feeAmount),w?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let N=x.liquidityNet;i&&(N=N.mul(dt)),g.liquidity=ie.addDelta(g.liquidity,N)}A=k.tickNext!=g.tick&&!i&&T.startTickIndex===k.tickNext,g.tick=i?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let N=Q.getTickFromSqrtPriceX64(g.sqrtPriceX64);A=N!=g.tick&&!i&&T.startTickIndex===N,g.tick=N}++h}try{let{nextStartIndex:k,isExist:S}=re.nextInitializedTickArray(g.tick,c,i,r,s);S&&d!==k&&(g.accounts.push(ae(e,t,k).publicKey),d=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ye,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,s,i){let o={sqrtPriceX64Next:new z.default(0),amountIn:new z.default(0),amountOut:new z.default(0),feeAmount:new z.default(0)},u=r.gte(ye);if(u){let c=H.mulDivFloor(r,Fn.sub(new z.default(s.toString())),Fn);o.amountIn=i?ie.getTokenAmountAFromLiquidity(t,e,n,!0):ie.getTokenAmountBFromLiquidity(e,t,n,!0),c.gte(o.amountIn)?o.sqrtPriceX64Next=t:o.sqrtPriceX64Next=Q.getNextSqrtPriceX64FromInput(e,n,c,i)}else o.amountOut=i?ie.getTokenAmountBFromLiquidity(t,e,n,!1):ie.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(dt).gte(o.amountOut)?o.sqrtPriceX64Next=t:o.sqrtPriceX64Next=Q.getNextSqrtPriceX64FromOutput(e,n,r.mul(dt),i);let l=t.eq(o.sqrtPriceX64Next);return i?(l&&u||(o.amountIn=ie.getTokenAmountAFromLiquidity(o.sqrtPriceX64Next,e,n,!0)),l&&!u||(o.amountOut=ie.getTokenAmountBFromLiquidity(o.sqrtPriceX64Next,e,n,!1))):(o.amountIn=l&&u?o.amountIn:ie.getTokenAmountBFromLiquidity(e,o.sqrtPriceX64Next,n,!0),o.amountOut=l&&!u?o.amountOut:ie.getTokenAmountAFromLiquidity(e,o.sqrtPriceX64Next,n,!1)),!u&&o.amountOut.gt(r.mul(dt))&&(o.amountOut=r.mul(dt)),u&&!o.sqrtPriceX64Next.eq(t)?o.feeAmount=r.sub(o.amountIn):o.feeAmount=H.mulDivCeil(o.amountIn,new z.default(s),Fn.sub(new z.default(s))),[o.sqrtPriceX64Next,o.amountIn,o.amountOut,o.feeAmount]}};var Ie=60,Vt=512,O=class{static getTickArrayAddressByTick(e,t,n,r){let s=O.getTickArrayStartIndexByTick(n,r),{publicKey:i}=ae(e,t,s);return i}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=O.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Ie)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=re.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*re.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Ie,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Ie,s=Math.floor(t/r)+512,i=Math.abs(s);return{isInitialized:e.testn(i),startIndex:(i-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Ie:e+t*Ie}static mergeTickArrayBitmap(e){let t=new co.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,s){let i=Math.floor(r/(n*Ie));return[...O.searchLowBitFromStart(e,t,i-1,s,n),...O.searchHightBitFromStart(e,t,i,s,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return O.searchHightBitFromStart(e,t,-7680,Vt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,s){let i=[],o=O.getAllInitializedTickArrayStartIndex(n,r,s);for(let u of o){let{publicKey:l}=ae(e,t,u);i.push({tickArrayStartIndex:u,tickArrayAddress:l})}return i}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,s){let i=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>O.mergeTickArrayBitmap(l)),o=[];for(;n>=-7680;){let l=Math.floor((n+7680)/512),c=(n+7680)%512;if(i[l].testn(c)&&o.push(n),n--,o.length===r)break}let u=re.tickCount(s);return o.map(l=>l*u)}static searchHightBitFromStart(e,t,n,r,s){let i=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(l=>O.mergeTickArrayBitmap(l)),o=[];for(;n<7680;){let l=Math.floor((n+7680)/512),c=(n+7680)%512;if(i[l].testn(c)&&o.push(n),n++,o.length===r)break}let u=re.tickCount(s);return o.map(l=>l*u)}static checkIsOutOfBoundary(e){return e<Ve||e>Ee}static nextInitTick(e,t,n,r,s){if(re.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let o=Math.floor((t-e.startTickIndex)/n);if(r)for(;o>=0;){if(e.ticks[o].liquidityGross.gtn(0))return e.ticks[o];o=o-1}else for(s||(o=o+1);o<Ie;){if(e.ticks[o].liquidityGross.gtn(0))return e.ticks[o];o=o+1}return null}static firstInitializedTick(e,t){if(t){let n=Ie-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Ie;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=Q.getSqrtPriceX64FromTick(t),s=Q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new Wt.default(1).div(s),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new Wt.default(1).div(t),s=Et.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),i=Q.getSqrtPriceX64FromTick(s),o=Q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:o}:{tick:s,price:new Wt.default(1).div(o)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=Q.getSqrtPriceX64FromTick(t),s=Q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new Wt.default(1).div(s),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new Wt.default(1).div(t),s=Et.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),i=Q.getSqrtPriceX64FromTick(s),o=Q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:o}:{tick:s,price:new Wt.default(1).div(o)}}};var Zd=_([Se(8),E("bump"),Rt("index"),R(""),_e("protocolFeeRate"),_e("tradeFeeRate"),Rt("tickSpacing"),U(b(),8,"")]),qs=_([_e("blockTimestamp"),jt("tickCumulative"),U(b(),4)]),lo=_([Se(8),Be("initialized"),b("recentEpoch"),Rt("observationIndex"),R("poolId"),U(qs,100,"observations"),U(b(),4)]),Gs=_([E("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),G("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),R("tokenMint"),R("tokenVault"),R("creator"),G("rewardGrowthGlobalX64")]),so=_([Se(8),E("bump"),R("ammConfig"),R("creator"),R("mintA"),R("mintB"),R("vaultA"),R("vaultB"),R("observationId"),E("mintDecimalsA"),E("mintDecimalsB"),Rt("tickSpacing"),G("liquidity"),G("sqrtPriceX64"),be("tickCurrent"),_e(),G("feeGrowthGlobalX64A"),G("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),G("swapInAmountTokenA"),G("swapOutAmountTokenB"),G("swapInAmountTokenB"),G("swapOutAmountTokenA"),E("status"),U(E(),7,""),U(Gs,3,"rewardInfos"),U(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),U(b(),15*4-3,"padding")]),Us=_([G("growthInsideLastX64"),b("rewardAmountOwed")]),ao=_([Se(8),E("bump"),R("nftMint"),R("poolId"),be("tickLower"),be("tickUpper"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),U(Us,3,"rewardInfos"),U(b(),8,"")]),Jd=_([Se(8),E("bump"),R("poolId"),be("tickLowerIndex"),be("tickUpperIndex"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),U(G(),3,"rewardGrowthInside"),U(b(),8,"")]),Xs=_([be("tick"),Wi("liquidityNet"),G("liquidityGross"),G("feeGrowthOutsideX64A"),G("feeGrowthOutsideX64B"),U(G(),3,"rewardGrowthsOutsideX64"),U(_e(),13,"")]),An=_([Se(8),R("poolId"),be("startTickIndex"),U(Xs,Ie,"ticks"),E("initializedTickCount"),U(E(),115,"")]),$d=_([Se(329),U(R(),100,"whitelistMints")]),uo=_([Se(8),R("poolId"),U(U(b(),8),Ir,"positiveTickArrayBitmap"),U(U(b(),8),Ir,"negativeTickArrayBitmap")]),ep=_([b(),E("bump"),R("owner"),R("poolId"),R("positionId"),R("nftAccount"),U(b(),8)]),tp=_([Se(8),E("bump"),R("lockOwner"),R("poolId"),R("positionId"),R("nftAccount"),R("lockNftMint"),b("recentEpoch"),U(b(),8)]);lo.span;var mo=ue("Raydium_Clmm"),Xe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},po=[188,37,179,131,82,150,84,73],fo=[16,72,250,198,14,162,212,19],Zt=class{static createPoolInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,f){let y=_([G("sqrtPriceX64"),b("zero")]),w=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1},...(f==null?void 0:f.map(T=>({pubkey:T,isSigner:!1,isWritable:!1})))||[]],g=Buffer.alloc(y.span);y.encode({sqrtPriceX64:d,zero:ye},g);let P=Buffer.from([...Xe.createPool,...g]);return new B.TransactionInstruction({keys:w,programId:e,data:P})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:s,ammConfigId:i,initialPriceX64:o,extendMintAccount:u}=e,[l,c]=[new B.PublicKey(r.address),new B.PublicKey(s.address)],{publicKey:m}=to(t,i,l,c),{publicKey:p}=ro(t,m),{publicKey:d}=xr(t,m,l),{publicKey:f}=xr(t,m,c),y=Le(t,m).publicKey,w=[this.createPoolInstruction(t,m,n,i,p,l,d,new B.PublicKey(r.programId||W.TOKEN_PROGRAM_ID),c,f,new B.PublicKey(s.programId||W.TOKEN_PROGRAM_ID),y,o,u)];return{signers:[],instructions:w,instructionTypes:[X.CreateAccount,X.ClmmCreatePool],address:{poolId:m,observationId:p,exBitmapAccount:y,mintAVault:d,mintBVault:f},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g,P,T,h,A,k,S,x,L,I){let N=_([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Be("withMetadata"),E("optionBaseFlag"),Be("baseFlag")]),M=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],C=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...M],v=Buffer.alloc(N.span);N.encode({tickLowerIndex:P,tickUpperIndex:T,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:A,liquidity:k,amountMaxA:S,amountMaxB:x,withMetadata:L==="create",baseFlag:!1,optionBaseFlag:0},v);let J=Buffer.from([...Xe.openPosition,...v]);return new B.TransactionInstruction({keys:C,programId:e,data:J})}static openPositionFromLiquidityInstruction22(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g,P,T,h,A,k,S,x,L){let I=_([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Be("withMetadata"),E("optionBaseFlag"),Be("baseFlag")]),N=[...L?[{pubkey:L,isSigner:!1,isWritable:!0}]:[]],M=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...N],C=Buffer.alloc(I.span);I.encode({tickLowerIndex:g,tickUpperIndex:P,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:h,liquidity:A,amountMaxA:k,amountMaxB:S,withMetadata:x==="create",baseFlag:!1,optionBaseFlag:0},C);let v=Buffer.from([...Xe.openPositionWithTokenEx,...C]);return new B.TransactionInstruction({keys:M,programId:e,data:v})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:s,liquidity:i,amountMaxA:o,amountMaxB:u,withMetadata:l,getEphemeralSigners:c,nft2022:m}){let p=[],[d,f]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],y;if(c)y=new B.PublicKey((await c(1))[0]);else{let L=B.Keypair.generate();p.push(L),y=L.publicKey}let w=O.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=O.getTickArrayStartIndexByTick(s,e.config.tickSpacing),{publicKey:P}=ae(d,f,w),{publicKey:T}=ae(d,f,g),{publicKey:h}=m?de(n.wallet,y,W.TOKEN_2022_PROGRAM_ID):de(n.wallet,y,W.TOKEN_PROGRAM_ID),{publicKey:A}=wn(y),{publicKey:k}=Ue(d,y),{publicKey:S}=kt(d,f,r,s),x=m?this.openPositionFromLiquidityInstruction22(d,n.feePayer,f,n.wallet,y,h,S,P,T,k,n.tokenAccountA,n.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address),r,s,w,g,i,o,u,l,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(d,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,y,h,A,S,P,T,k,n.tokenAccountA,n.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address),r,s,w,g,i,o,u,l,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(d,f).publicKey:void 0);return{signers:p,instructions:[x],instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:h,metadataAccount:A,personalPosition:k,protocolPosition:S}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:s,base:i,baseAmount:o,otherAmountMax:u,withMetadata:l,getEphemeralSigners:c,nft2022:m}){let p=[],[d,f]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],y;if(c)y=new B.PublicKey((await c(1))[0]);else{let L=B.Keypair.generate();p.push(L),y=L.publicKey}let w=O.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=O.getTickArrayStartIndexByTick(s,e.config.tickSpacing),{publicKey:P}=ae(d,f,w),{publicKey:T}=ae(d,f,g),{publicKey:h}=m?de(n.wallet,y,W.TOKEN_2022_PROGRAM_ID):de(n.wallet,y,W.TOKEN_PROGRAM_ID),{publicKey:A}=wn(y),{publicKey:k}=Ue(d,y),{publicKey:S}=kt(d,f,r,s),x=m?this.openPositionFromBaseInstruction22(d,n.feePayer,f,n.wallet,y,h,S,P,T,k,n.tokenAccountA,n.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address),r,s,w,g,l,i,o,u,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(d,f).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,y,h,A,S,P,T,k,n.tokenAccountA,n.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address),r,s,w,g,l,i,o,u,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(d,f).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:h,metadataAccount:A,personalPosition:k,protocolPosition:S},instructions:[x],signers:p,instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g,P,T,h,A,k,S,x,L,I){let N=_([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Be("withMetadata"),E("optionBaseFlag"),Be("baseFlag")]),M=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[]],C=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...M],v=Buffer.alloc(N.span);N.encode({tickLowerIndex:P,tickUpperIndex:T,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:A,liquidity:new Gn.default(0),amountMaxA:S==="MintA"?x:L,amountMaxB:S==="MintA"?L:x,withMetadata:k==="create",baseFlag:S==="MintA",optionBaseFlag:1},v);let J=Buffer.from([...Xe.openPosition,...v]);return new B.TransactionInstruction({keys:C,programId:e,data:J})}static openPositionFromBaseInstruction22(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g,P,T,h,A,k,S,x,L){let I=_([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Be("withMetadata"),E("optionBaseFlag"),Be("baseFlag")]),N=[...L?[{pubkey:L,isSigner:!1,isWritable:!0}]:[]],M=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...N],C=Buffer.alloc(I.span);I.encode({tickLowerIndex:g,tickUpperIndex:P,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:h,liquidity:new Gn.default(0),amountMaxA:k==="MintA"?S:x,amountMaxB:k==="MintA"?x:S,withMetadata:A==="create",baseFlag:k==="MintA",optionBaseFlag:1},C);let v=Buffer.from([...Xe.openPositionWithTokenEx,...C]);return new B.TransactionInstruction({keys:M,programId:e,data:v})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:s,liquidity:i,amountMaxA:o,amountMaxB:u,withMetadata:l,getEphemeralSigners:c,nft2022:m}){let p,d=[];if(c)p=new B.PublicKey((await c(1))[0]);else{let L=B.Keypair.generate();d.push(L),p=L.publicKey}let[f,y]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],w=O.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=O.getTickArrayStartIndexByTick(s,e.config.tickSpacing),{publicKey:P}=ae(f,y,w),{publicKey:T}=ae(f,y,g),{publicKey:h}=m?de(n.wallet,p,W.TOKEN_2022_PROGRAM_ID):de(n.wallet,p,W.TOKEN_PROGRAM_ID),{publicKey:A}=wn(p),{publicKey:k}=Ue(f,p),{publicKey:S}=kt(f,y,r,s),x=m?this.openPositionFromLiquidityInstruction22(f,n.wallet,y,n.wallet,p,h,S,P,T,k,n.tokenAccountA,n.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(t.mintA.address),new B.PublicKey(t.mintB.address),r,s,w,g,i,o,u,l,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(f,y).publicKey:void 0):this.openPositionFromLiquidityInstruction(f,n.wallet,y,n.wallet,p,h,A,S,P,T,k,n.tokenAccountA,n.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(t.mintA.address),new B.PublicKey(t.mintB.address),r,s,w,g,i,o,u,l,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(f,y).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:h,metadataAccount:A,personalPosition:k,protocolPosition:S},instructions:[x],signers:d,instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,s,i){let o=_([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:i?W.TOKEN_2022_PROGRAM_ID:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],l=Buffer.alloc(o.span);o.encode({},l);let c=Buffer.from([...Xe.closePosition,...l]);return new B.TransactionInstruction({keys:u,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:s}){let i=new B.PublicKey(e.programId),o=s?de(n.wallet,r.nftMint,W.TOKEN_2022_PROGRAM_ID).publicKey:de(n.wallet,r.nftMint,W.TOKEN_PROGRAM_ID).publicKey,{publicKey:u}=Ue(i,r.nftMint),l=[];return l.push(this.closePositionInstruction(i,n.wallet,r.nftMint,o,u,s)),{address:{positionNftAccount:o,personalPosition:u},signers:[],instructions:l,instructionTypes:[X.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g,P){let T=_([G("liquidity"),b("amountMaxA"),b("amountMaxB"),E("optionBaseFlag"),Be("baseFlag")]),h=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(T.span);T.encode({liquidity:y,amountMaxA:w,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},k);let S=Buffer.from([...Xe.increaseLiquidity,...k]);return new B.TransactionInstruction({keys:A,programId:e,data:S})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:s,amountMaxA:i,amountMaxB:o,nft2022:u}){let[l,c]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],m=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=ae(l,c,m),{publicKey:f}=ae(l,c,p),{publicKey:y}=u?de(r.wallet,n.nftMint,W.TOKEN_2022_PROGRAM_ID):de(r.wallet,n.nftMint,W.TOKEN_PROGRAM_ID),{publicKey:w}=Ue(l,n.nftMint),{publicKey:g}=kt(l,c,n.tickLower,n.tickUpper),P=this.increasePositionFromLiquidityInstruction(l,r.wallet,y,w,c,g,d,f,r.tokenAccountA,r.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address),s,i,o,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Le(l,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:y,personalPosition:w,protocolPosition:g},signers:[],instructions:[P],instructionTypes:[X.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:s,baseAmount:i,otherAmountMax:o,nft2022:u}){let[l,c]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],m=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=ae(l,c,m),{publicKey:f}=ae(l,c,p),{publicKey:y}=u?de(r.wallet,n.nftMint,W.TOKEN_2022_PROGRAM_ID):de(r.wallet,n.nftMint,W.TOKEN_PROGRAM_ID),{publicKey:w}=Ue(l,n.nftMint),{publicKey:g}=kt(l,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:y,personalPosition:w,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(l,r.wallet,y,w,c,g,d,f,r.tokenAccountA,r.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address),s,i,o,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Le(l,c).publicKey:void 0)],signers:[],instructionTypes:[X.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g,P){let T=_([G("liquidity"),b("amountMaxA"),b("amountMaxB"),E("optionBaseFlag"),Be("baseFlag")]),h=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(T.span);T.encode({liquidity:new Gn.default(0),amountMaxA:y==="MintA"?w:g,amountMaxB:y==="MintA"?g:w,baseFlag:y==="MintA",optionBaseFlag:1},k);let S=Buffer.from([...Xe.increaseLiquidity,...k]);return new B.TransactionInstruction({keys:A,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g,P,T){let h=_([G("liquidity"),b("amountMinA"),b("amountMinB")]),A=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[],...y.map(L=>[{pubkey:L.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...A],S=Buffer.alloc(h.span);h.encode({liquidity:w,amountMinA:g,amountMinB:P},S);let x=Buffer.from([...Xe.decreaseLiquidity,...S]);return new B.TransactionInstruction({keys:k,programId:e,data:x})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:s,amountMinA:i,amountMinB:o,programId:u,nft2022:l}){let[c,m]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],p=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=ae(c,m,p),{publicKey:y}=ae(c,m,d),{publicKey:w}=l?de(r.wallet,n.nftMint,W.TOKEN_2022_PROGRAM_ID):de(r.wallet,n.nftMint,u),{publicKey:g}=Ue(c,n.nftMint),{publicKey:P}=kt(c,m,n.tickLower,n.tickUpper),T=[];for(let k=0;k<e.rewardDefaultInfos.length;k++)T.push({poolRewardVault:new B.PublicKey(t.rewardInfos[k].vault),ownerRewardVault:r.rewardAccounts[k],rewardMint:new B.PublicKey(e.rewardDefaultInfos[k].mint.address)});let h=[],A=this.decreaseLiquidityInstruction(c,r.wallet,w,g,m,P,f,y,r.tokenAccountA,r.tokenAccountB,new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B),new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address),T,s,i,o,Te.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,d])?Le(c,m).publicKey:void 0);return h.push(A),{address:{tickArrayLower:f,tickArrayUpper:y,positionNftAccount:w,personalPosition:g,protocolPosition:P},signers:[],instructions:h,instructionTypes:[X.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,s,i,o,u,l,c,m,p,d,f,y,w,g){let P=_([b("amount"),b("otherAmountThreshold"),G("sqrtPriceLimitX64"),Be("isBaseInput")]),T=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(S=>({pubkey:S,isSigner:!1,isWritable:!0}))],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...T],A=Buffer.alloc(P.span);P.encode({amount:d,otherAmountThreshold:f,sqrtPriceLimitX64:y,isBaseInput:w},A);let k=Buffer.from([...Xe.swap,...A]);return new B.TransactionInstruction({keys:h,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:s,amountIn:i,amountOutMin:o,sqrtPriceLimitX64:u,remainingAccounts:l}){let[c,m]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],[p,d]=[new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B)],[f,y]=[new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address)],w=e.mintA.address===s.toString(),g=[this.swapInstruction(c,r.wallet,m,new B.PublicKey(e.config.id),w?r.tokenAccountA:r.tokenAccountB,w?r.tokenAccountB:r.tokenAccountA,w?p:d,w?d:p,w?f:y,w?y:f,l,n,i,o,u,!0,Le(c,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[X.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:s,amountOut:i,amountInMax:o,sqrtPriceLimitX64:u,remainingAccounts:l}){let[c,m]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],[p,d]=[new B.PublicKey(t.vault.A),new B.PublicKey(t.vault.B)],[f,y]=[new B.PublicKey(e.mintA.address),new B.PublicKey(e.mintB.address)],w=e.mintA.address===s.toBase58(),g=[this.swapInstruction(c,r.wallet,m,new B.PublicKey(e.config.id),w?r.tokenAccountB:r.tokenAccountA,w?r.tokenAccountA:r.tokenAccountB,w?d:p,w?p:d,w?y:f,w?f:y,l,n,i,o,u,!1,Le(c,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[X.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,s,i,o,u,l,c,m,p){let d=_([b("openTime"),b("endTime"),G("emissionsPerSecondX64")]),f=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1}],y=Buffer.alloc(d.span);d.encode({openTime:te(c),endTime:te(m),emissionsPerSecondX64:p},y);let w=Buffer.from([...Xe.initReward,...y]);return new B.TransactionInstruction({keys:f,programId:e,data:w})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[s,i]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],o=no(s,i,r.mint).publicKey,u=Sr(s).publicKey,l=[this.initRewardInstruction(s,n.wallet,i,u,new B.PublicKey(e.config.id),n.tokenAccount,r.programId,r.mint,o,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:o,operationId:u},signers:[],instructions:l,instructionTypes:[X.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,s,i,o,u,l,c,m,p){let d=_([E("rewardIndex"),G("emissionsPerSecondX64"),b("openTime"),b("endTime")]),f=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],y=Buffer.alloc(d.span);d.encode({rewardIndex:l,emissionsPerSecondX64:p,openTime:te(c),endTime:te(m)},y);let w=Buffer.from([...Xe.setRewardEmissions,...y]);return new B.TransactionInstruction({keys:f,programId:e,data:w})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[s,i]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],o,u,l;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===r.mint.toString()&&(o=p,u=new B.PublicKey(t.rewardInfos[p].vault),l=new B.PublicKey(t.rewardInfos[p].mint.address));(o===void 0||u===void 0)&&mo.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=Sr(s).publicKey,m=[this.setRewardInstruction(s,n.wallet,i,c,new B.PublicKey(e.config.id),n.tokenAccount,u,l,o,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:c},signers:[],instructions:m,instructionTypes:[X.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,s,i,o){let u=_([E("rewardIndex")]),l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1}],c=Buffer.alloc(u.span);u.encode({rewardIndex:o},c);let m=Buffer.from([...Xe.collectReward,...c]);return new B.TransactionInstruction({keys:l,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[s,i]=[new B.PublicKey(e.programId),new B.PublicKey(e.id)],o,u;for(let c=0;c<e.rewardDefaultInfos.length;c++)e.rewardDefaultInfos[c].mint.address===r.toString()&&(o=c,u=new B.PublicKey(t.rewardInfos[c].vault));(o===void 0||u===void 0)&&mo.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=[this.collectRewardInstruction(s,n.wallet,i,n.tokenAccount,u,r,o)];return{address:{rewardVault:u},signers:[],instructions:l,instructionTypes:[X.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:s,nftMint:i,nft2022:o,getEphemeralSigners:u}){let l=[],c;if(u)c=new B.PublicKey((await u(1))[0]);else{let g=B.Keypair.generate();l.push(g),c=g.publicKey}let m=o?de(s,i,W.TOKEN_2022_PROGRAM_ID).publicKey:de(s,i,W.TOKEN_PROGRAM_ID).publicKey,{publicKey:p}=Ue(n,i),d=oo(e,c).publicKey,f=de(s,c,W.TOKEN_PROGRAM_ID).publicKey,y=wn(c).publicKey,w=Zt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:s,lockOwner:s,positionNftAccount:m,positionId:p,lockPositionId:d,lockNftMint:c,lockNftAccount:f,metadataAccount:y,withMetadata:!0,nft2022:o,positionNftMint:i,authPositionNftAccount:de(t,i,o?W.TOKEN_2022_PROGRAM_ID:W.TOKEN_PROGRAM_ID).publicKey,positionNftProgram:o?W.TOKEN_2022_PROGRAM_ID:W.TOKEN_PROGRAM_ID});return{address:{positionId:p,lockPositionId:d,lockNftAccount:f,lockNftMint:c,positionNftAccount:m,metadataAccount:y},instructions:[w],signers:l,instructionTypes:[X.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:s,positionNftAccount:i,positionId:o,positionNftMint:u,authPositionNftAccount:l,positionNftProgram:c,lockPositionId:m,lockNftMint:p,lockNftAccount:d,metadataAccount:f,withMetadata:y}){let w=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:W.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1}],g=_([Be("withMetadata")]),P=Buffer.alloc(g.span);g.encode({withMetadata:y},P);let T=Buffer.from([...po,...P]);return new B.TransactionInstruction({keys:w,programId:e,data:T})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:s}){let{publicKey:i}=de(r,s,W.TOKEN_PROGRAM_ID),{publicKey:o}=Ue(n,s),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:Br(e,o).publicKey,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:B.SystemProgram.programId,isSigner:!1,isWritable:!1}];return new B.TransactionInstruction({keys:u,programId:e,data:Buffer.from(po)})}static harvestLockPositionInstruction(e){let[t,n]=[new B.PublicKey(e.poolKeys.programId),new B.PublicKey(e.poolKeys.id)],r=O.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),s=O.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:i}=ae(t,n,r),{publicKey:o}=ae(t,n,s),{publicKey:u}=de(e.owner,e.ownerPosition.nftMint,W.TOKEN_PROGRAM_ID),{publicKey:l}=Ue(t,e.ownerPosition.nftMint),{publicKey:c}=kt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let f=0;f<e.poolKeys.rewardInfos.length;f++)m.push({poolRewardVault:new B.PublicKey(e.poolKeys.rewardInfos[f].vault),ownerRewardVault:e.ownerRewardAccounts[f],rewardMint:new B.PublicKey(e.poolKeys.rewardInfos[f].mint.address)});let p=[...m.map(f=>[{pubkey:f.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:f.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:f.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Br(e.programId,l).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:new B.PublicKey(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new B.PublicKey(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ur,isSigner:!1,isWritable:!1},{pubkey:new B.PublicKey(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new B.PublicKey(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...p];return new B.TransactionInstruction({keys:d,programId:e.programId,data:Buffer.from(fo)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:s,lockNftMint:i,lockNftAccount:o,positionNftAccount:u,positionId:l,poolId:c,protocolPosition:m,vaultA:p,vaultB:d,tickArrayLower:f,tickArrayUpper:y,userVaultA:w,userVaultB:g,mintA:P,mintB:T,rewardAccounts:h,exTickArrayBitmap:A}){let k=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...h.map(x=>[{pubkey:x.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:x.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:x.rewardMint,isSigner:!1,isWritable:!1}]).flat()],S=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:W.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:W.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:ur,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},...k];return new B.TransactionInstruction({keys:S,programId:e,data:Buffer.from(fo)})}};var Rr=(...a)=>a.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Jt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ue(t)}createTxBuilder(e){return this.scope.checkOwner(),new bn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new ot(e);return new bn({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Rr(e))}logInfo(...e){this.logger.info(Rr(e))}logAndCreateError(...e){let t=Rr(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Qs=_([_e("mintAuthorityOption"),R("mintAuthority"),b("supply"),E("decimals"),E("isInitialized"),_e("freezeAuthorityOption"),R("freezeAuthority")]);var zs=require("@solana/web3.js"),bo=require("@solana/spl-token");var yo=a=>new Ne({mint:a.address,decimals:a.decimals,symbol:a.symbol,name:a.name});var Un=r=>{var s=r,{address:a,programId:e,decimals:t}=s,n=De(s,["address","programId","decimals"]);return F({chainId:101,address:Xt(a).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};var Cr=ee(require("bn.js")),Nr=new Cr.default(25),Xn=new Cr.default(1e4);var xe=require("@solana/web3.js"),At=require("@solana/spl-token");var Mr=_([E("instruction"),b("amountIn"),b("minAmountOut")]),_r=_([E("instruction"),b("maxAmountIn"),b("amountOut")]),Ep=_([E("instruction"),E("nonce")]),js=_([E("instruction"),E("nonce"),b("startTime")]),Vr=_([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),b("swapBase2QuoteFee"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("withdrawQueue"),R("lpVault"),R("owner"),b("lpReserve"),U(b(),3,"padding")]),Wp=_([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("modelDataAccount"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("owner"),U(b(),64,"padding")]),vr=_([E("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide"),b("otherAmountMin")]),Er=_([E("instruction"),b("lpAmount"),b("baseAmountMin"),b("quoteAmountMin")]);var go=_([b("fee")]);var wo=ue("Raydium_liquidity_instruction");function ko(a){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:r,quoteAmountIn:s,fixedSide:i,otherAmountMin:o,modelDataPubKey:u=It}=a,l=Buffer.alloc(vr.span);vr.encode({instruction:3,baseAmountIn:te(r),quoteAmountIn:te(s),otherAmountMin:te(o),fixedSide:i==="base"?yt:yi},l);let c=[K({pubkey:At.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:new xe.PublicKey(e.id)}),K({pubkey:new xe.PublicKey(t.authority),isWritable:!1}),K({pubkey:new xe.PublicKey(t.openOrders),isWritable:!1}),K({pubkey:new xe.PublicKey(t.targetOrders)}),K({pubkey:new xe.PublicKey(e.lpMint.address)}),K({pubkey:new xe.PublicKey(t.vault.A)}),K({pubkey:new xe.PublicKey(t.vault.B)})];return e.pooltype.includes("StablePool")&&c.push(K({pubkey:u})),c.push(K({pubkey:new xe.PublicKey(e.marketId),isWritable:!1}),K({pubkey:n.baseTokenAccount}),K({pubkey:n.quoteTokenAccount}),K({pubkey:n.lpTokenAccount}),K({pubkey:n.owner,isWritable:!1,isSigner:!0}),K({pubkey:new xe.PublicKey(t.marketEventQueue),isWritable:!1})),new xe.TransactionInstruction({programId:new xe.PublicKey(e.programId),keys:c,data:l})}function Wr(a){let{poolInfo:e,poolKeys:t,userKeys:n,lpAmount:r,baseAmountMin:s,quoteAmountMin:i,modelDataPubKey:o=It}=a,u=St(t),l=4;if(e.pooltype.includes("StablePool")&&(l=5),l===4||l===5){let c=Buffer.alloc(Er.span);Er.encode({instruction:4,lpAmount:te(r),baseAmountMin:te(s),quoteAmountMin:te(i)},c);let m=[K({pubkey:At.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:u.id}),K({pubkey:u.authority,isWritable:!1}),K({pubkey:u.openOrders}),K({pubkey:u.targetOrders}),K({pubkey:u.mintLp.address}),K({pubkey:u.vault.A}),K({pubkey:u.vault.B})];return l===5?m.push(K({pubkey:o})):(m.push(K({pubkey:u.id})),m.push(K({pubkey:u.id}))),m.push(K({pubkey:u.marketProgramId,isWritable:!1}),K({pubkey:u.marketId}),K({pubkey:u.marketBaseVault}),K({pubkey:u.marketQuoteVault}),K({pubkey:u.marketAuthority,isWritable:!1}),K({pubkey:n.lpTokenAccount}),K({pubkey:n.baseTokenAccount}),K({pubkey:n.quoteTokenAccount}),K({pubkey:n.owner,isWritable:!1,isSigner:!0}),K({pubkey:u.marketEventQueue}),K({pubkey:u.marketBids}),K({pubkey:u.marketAsks})),new xe.TransactionInstruction({programId:u.programId,keys:m,data:c})}return new xe.TransactionInstruction({programId:u.programId,keys:[]})}function Or({programId:a,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:r,coinMint:s,pcMint:i,coinVault:o,pcVault:u,withdrawQueue:l,ammTargetOrders:c,poolTempLp:m,marketProgramId:p,marketId:d,userWallet:f,userCoinVault:y,userPcVault:w,userLpVault:g,nonce:P,openTime:T,coinAmount:h,pcAmount:A,ammConfigId:k,feeDestinationId:S}){let x=_([E("instruction"),E("nonce"),b("openTime"),b("pcAmount"),b("coinAmount")]),L=[{pubkey:At.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:At.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:xe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!1},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!0,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],I=Buffer.alloc(x.span);return x.encode({instruction:1,nonce:P,openTime:T,coinAmount:h,pcAmount:A},I),{instruction:new xe.TransactionInstruction({keys:L,programId:a,data:I}),instructionType:X.AmmV4CreatePool}}function Hs({poolKeys:a,userKeys:e,amountIn:t,minAmountOut:n,modelDataPubKey:r=It},s){let i=St(a),o=Buffer.alloc(Mr.span);Mr.encode({instruction:9,amountIn:te(t),minAmountOut:te(n)},o);let u=[K({pubkey:At.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:i.id}),K({pubkey:i.authority,isWritable:!1}),K({pubkey:i.openOrders})];return s===4&&u.push(K({pubkey:i.targetOrders})),u.push(K({pubkey:i.vault.A}),K({pubkey:i.vault.B})),s===5&&u.push(K({pubkey:r})),u.push(K({pubkey:i.marketProgramId,isWritable:!1}),K({pubkey:i.marketId}),K({pubkey:i.marketBids}),K({pubkey:i.marketAsks}),K({pubkey:i.marketEventQueue}),K({pubkey:i.marketBaseVault}),K({pubkey:i.marketQuoteVault}),K({pubkey:i.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1,isSigner:!0})),new xe.TransactionInstruction({programId:i.programId,keys:u,data:o})}function Ys({poolKeys:a,userKeys:e,maxAmountIn:t,amountOut:n,modelDataPubKey:r=It},s){let i=St(a),o=Buffer.alloc(_r.span);_r.encode({instruction:11,maxAmountIn:te(t),amountOut:te(n)},o);let u=[K({pubkey:At.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:i.id}),K({pubkey:i.authority,isWritable:!1}),K({pubkey:i.openOrders}),K({pubkey:i.targetOrders}),K({pubkey:i.vault.A}),K({pubkey:i.vault.B})];return s===5&&u.push(K({pubkey:r})),u.push(K({pubkey:i.marketProgramId,isWritable:!1}),K({pubkey:i.marketId}),K({pubkey:i.marketBids}),K({pubkey:i.marketAsks}),K({pubkey:i.marketEventQueue}),K({pubkey:i.marketBaseVault}),K({pubkey:i.marketQuoteVault}),K({pubkey:i.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1,isSigner:!0})),new xe.TransactionInstruction({programId:i.programId,keys:u,data:o})}function Ao(a){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:s,fixedSide:i}=a;if(t===4||t===5){let o={poolKeys:e,userKeys:n};if(i==="in")return Hs(j(F({},o),{amountIn:r,minAmountOut:s}),t);if(i==="out")return Ys(j(F({},o),{maxAmountIn:r,amountOut:s}),t);wo.logWithError("invalid params","params",a)}throw wo.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var Ft=5e4,Zs=_([b("x"),b("y"),b("price")]),Js=_([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),U(Zs,Ft,"DataElement")]);function $s(a,e){return[0,Ft-2]}function ea(a){return[0,Ft-2]}function ta(a){return[0,Ft-2]}function na(a,e,t){let[n,r]=$s(e,t),s=n,i=r,o=0,u=e*a.multiplier/t;for(;s<=i;){if(o=Math.floor((i+s)/2),o===0||o>=Ft-2)return[o,o,!1];let l=a.DataElement[o].x*a.multiplier/a.DataElement[o].y,c=a.DataElement[o-1].x*a.multiplier/a.DataElement[o-1].y,m=a.DataElement[o+1].x*a.multiplier/a.DataElement[o+1].y;if(u===l)return[o,o,!0];if(u===c)return[o-1,o-1,!0];if(u===m)return[o+1,o+1,!0];if(u<c)i=o-1;else{if(u>c&&u<l)return[o-1,o,!0];if(u>l&&u<m)return[o,o+1,!0];s=o+1}}return[o,o,!1]}function Fr(a,e,t){let[n,r,s]=na(a,e,t);if(!s)return 0;if(n===r){let i=a.DataElement[n].x;return e*a.multiplier/i}else{let i=a.DataElement[n].x,o=a.DataElement[n].y,u=a.DataElement[r].x,l=a.DataElement[r].y,c=t*(u*o-i*l),m=i*c,p=(u-i)*(e*o-i*t)*l,d=m+p;return e*a.multiplier*c/d}}function Ot(a,e,t){return e*a.multiplier/t}function Po(a,e,t){return e*t/a.multiplier}function ra(a,e){let[t,n]=ea(e),r=t,s=n,i=0,o=e;for(;r<s;){if(i=Math.floor((s+r)/2),i<=0||i>Ft-2)return[i,i,!1];let u=a.DataElement[i].x,l=a.DataElement[i-1].x,c=a.DataElement[i+1].x;if(o===u)return[i,i,!0];if(o===l)return[i-1,i-1,!0];if(o===c)return[i+1,i+1,!0];if(o<l)s=i-1;else{if(o>l&&o<u)return[i-1,i,!0];if(o>u&&o<c)return[i,i+1,!0];r=i+1}}return[i,i,!1]}function ia(a,e){let[t,n]=ta(e),r=t,s=n,i=0,o=e;for(;r<=s;){if(i=Math.floor((s+r)/2),i<=0||i>=Ft-2)return[i,i,!1];let u=a.DataElement[i].y,l=a.DataElement[i-1].y,c=a.DataElement[i+1].y;if(o===u)return[i,i,!0];if(o===l)return[i-1,i-1,!0];if(o===c)return[i+1,i+1,!0];if(o<c)r=i+1;else{if(o<l&&o>u)return[i-1,i,!0];if(o<u&&o>c)return[i,i+1,!0];s=i-1}}return[i,i,!1]}function ho(a,e,t,n){let r=n?e+t:e-t,[s,i,o]=ra(a,r);if(!o)return[0,0,!1,o];if(s===i)return[a.DataElement[i].price,a.DataElement[i].y,!1,o];{let u=a.DataElement[s].x,l=a.DataElement[i].x,c=a.DataElement[s].price,m=a.DataElement[i].price,p=a.DataElement[s].y,d=a.DataElement[i].y;if(e>=u&&e<=l)return n?[m,d,!0,o]:[c,p,!0,o];{let f,y;return n?(f=c+(m-c)*(e-u)/(l-u),y=p-(r-u)*a.multiplier/m):(f=c+(m-c)*(e-u)/(l-u),y=d+(l-r)*a.multiplier/c),[f,y,!1,o]}}}function oa(a,e,t,n){let r=n?e-t:e+t,[s,i,o]=ia(a,r);if(!o)return[0,0,!1,o];if(s===i)return[a.DataElement[i].price,a.DataElement[i].x,!1,o];{let u=a.DataElement[s].x,l=a.DataElement[i].x,c=a.DataElement[s].price,m=a.DataElement[i].price,p=a.DataElement[s].y,d=a.DataElement[i].y;if(e>=d&&e<=p)return n?[m,l,!0,o]:[c,u,!0,o];{let f,y;return n?(f=c+(m-c)*(p-e)/(p-d),y=u+m*(p-r)/a.multiplier):(f=c+(m-c)*(p-e)/(p-d),y=l-c*(r-d)/a.multiplier),[f,y,!1,o]}}}function sa(a,e){let t=ho(a,e,0,!1);return t[3]?t[0]:0}function To(a,e,t,n){let r=Fr(a,e,t),s=Ot(a,e,r),i=Ot(a,t,r),o=Ot(a,n,r),u=!0,[l,c,m,p]=ho(a,s,o,u);if(!p)return 0;if(m)return n*a.multiplier/l;{let d=i-c;return Po(a,d,r)}}function xo(a,e,t,n){let r=Fr(a,e,t),s=Ot(a,e,r),i=Ot(a,t,r),o=Ot(a,n,r),u=!1,[l,c,m,p]=oa(a,i,o,u);if(!p)return 0;if(m)return n*l/a.multiplier;{let d=s-c;return Po(a,d,r)}}function aa(a){let e=Js.decode(a);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function So(a,e,t,n){let r=sa(a,Ot(a,e,Fr(a,e,t)))/a.multiplier;return n?r:1/r}var hn=class{constructor({connection:e,modelDataPubKey:t=It}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e,this.modelDataPubKey=t}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(this.modelDataPubKey);e&&(this._layoutData=aa(e==null?void 0:e.data))}}};var Vo=require("@solana/web3.js"),ya=ee(require("bn.js")),Tn=ee(require("decimal.js")),vo=require("@solana/spl-token");var Bo=require("@solana/web3.js");var ua=ue("Raydium_liquidity_serum");function Io({programId:a,marketId:e}){let t=[e.toBuffer()],n=0,r;for(;n<100;){try{let s=t.concat(Buffer.from([n]),Buffer.alloc(7));r=Bo.PublicKey.createProgramAddressSync(s,a)}catch(s){if(s instanceof TypeError)throw s;n++;continue}return{publicKey:r,nonce:n}}throw ua.logWithError("unable to find a viable program address nonce","params",{programId:a,marketId:e}),new Error("unable to find a viable program address nonce")}var Hn=require("@solana/web3.js"),pa=ee(require("bn.js"));var Mo=require("@solana/spl-token");function ca(a){return a instanceof Uint8Array||a!=null&&typeof a=="object"&&a.constructor.name==="Uint8Array"}function Dr(a,...e){if(!ca(a))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(a.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${a.length}`)}function qr(a,e=!0){if(a.destroyed)throw new Error("Hash instance has been destroyed");if(e&&a.finished)throw new Error("Hash#digest() has already been called")}function Ko(a,e){Dr(a);let t=e.outputLen;if(a.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var zn=a=>new DataView(a.buffer,a.byteOffset,a.byteLength),nt=(a,e)=>a<<32-e|a>>>e;var rf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function la(a){if(typeof a!="string")throw new Error(`utf8ToBytes expected string, got ${typeof a}`);return new Uint8Array(new TextEncoder().encode(a))}function Gr(a){return typeof a=="string"&&(a=la(a)),Dr(a),a}var Qn=class{clone(){return this._cloneInto()}},of={}.toString;function Lo(a){let e=n=>a().update(Gr(n)).digest(),t=a();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>a(),e}function ma(a,e,t,n){if(typeof a.setBigUint64=="function")return a.setBigUint64(e,t,n);let r=BigInt(32),s=BigInt(4294967295),i=Number(t>>r&s),o=Number(t&s),u=n?4:0,l=n?0:4;a.setUint32(e+u,i,n),a.setUint32(e+l,o,n)}var Ro=(a,e,t)=>a&e^~a&t,Co=(a,e,t)=>a&e^a&t^e&t,jn=class extends Qn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zn(this.buffer)}update(e){qr(this);let{view:t,buffer:n,blockLen:r}=this;e=Gr(e);let s=e.length;for(let i=0;i<s;){let o=Math.min(r-this.pos,s-i);if(o===r){let u=zn(e);for(;r<=s-i;i+=r)this.process(u,i);continue}n.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){qr(this),Ko(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:s}=this,{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let m=i;m<r;m++)t[m]=0;ma(n,r-8,BigInt(this.length*8),s),this.process(n,0);let o=zn(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=u/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<l;m++)o.setUint32(4*m,c[m],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:s,destroyed:i,pos:o}=this;return e.length=r,e.pos=o,e.finished=s,e.destroyed=i,r%t&&e.buffer.set(n),e}};var da=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ht=new Uint32Array(64),Ur=class extends jn{constructor(){super(64,32,8,!1),this.A=Pt[0]|0,this.B=Pt[1]|0,this.C=Pt[2]|0,this.D=Pt[3]|0,this.E=Pt[4]|0,this.F=Pt[5]|0,this.G=Pt[6]|0,this.H=Pt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:s,F:i,G:o,H:u}=this;return[e,t,n,r,s,i,o,u]}set(e,t,n,r,s,i,o,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=s|0,this.F=i|0,this.G=o|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)ht[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let p=ht[m-15],d=ht[m-2],f=nt(p,7)^nt(p,18)^p>>>3,y=nt(d,17)^nt(d,19)^d>>>10;ht[m]=y+ht[m-7]+f+ht[m-16]|0}let{A:n,B:r,C:s,D:i,E:o,F:u,G:l,H:c}=this;for(let m=0;m<64;m++){let p=nt(o,6)^nt(o,11)^nt(o,25),d=c+p+Ro(o,u,l)+da[m]+ht[m]|0,y=(nt(n,2)^nt(n,13)^nt(n,22))+Co(n,r,s)|0;c=l,l=u,u=o,o=i+d|0,i=s,s=r,r=n,n=d+y|0}n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,u=u+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,s,i,o,u,l,c)}roundClean(){ht.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var No=Lo(()=>new Ur);var kf=ue("Raydium_Util");function at({fromPublicKey:a,programId:e=Mo.TOKEN_PROGRAM_ID,assignSeed:t}){let n=t?btoa(t).slice(0,32):Hn.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:fa(a,n,e),seed:n}}function fa(a,e,t){let n=Buffer.concat([a.toBuffer(),Buffer.from(e),t.toBuffer()]),r=No(n);return new Hn.PublicKey(r)}var _o=require("@solana/web3.js"),ba=ee(require("bn.js"));var Yn=require("@solana/spl-token");function Zn({programId:a}){let{publicKey:e}=ke([Buffer.from("amm_config_account_seed","utf-8")],a);return e}function Dt({name:a,programId:e,marketId:t}){let{publicKey:n}=ke([e.toBuffer(),t.toBuffer(),Buffer.from(a,"utf-8")],e);return n}function ga({programId:a,marketId:e}){let{publicKey:t}=ke([a.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],a);return t}function wa({programId:a}){return ke([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],a)}function Qr({version:a,marketVersion:e,marketId:t,baseMint:n,quoteMint:r,baseDecimals:s,quoteDecimals:i,programId:o,marketProgramId:u}){let l=Dt({name:"amm_associated_seed",programId:o,marketId:t}),c=Dt({name:"lp_mint_associated_seed",programId:o,marketId:t}),{publicKey:m,nonce:p}=wa({programId:o}),d=Dt({name:"coin_vault_associated_seed",programId:o,marketId:t}),f=Dt({name:"pc_vault_associated_seed",programId:o,marketId:t}),y=Dt({name:"temp_lp_token_associated_seed",programId:o,marketId:t}),w=ga({programId:o,marketId:t}),g=Dt({name:"target_associated_seed",programId:o,marketId:t}),P=Dt({name:"withdraw_associated_seed",programId:o,marketId:t}),{publicKey:T}=Io({programId:u,marketId:t});return{id:l,baseMint:n,quoteMint:r,lpMint:c,baseDecimals:s,quoteDecimals:i,lpDecimals:s,version:a,programId:o,authority:m,nonce:p,baseVault:d,quoteVault:f,lpVault:y,openOrders:w,targetOrders:g,withdrawQueue:P,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:T,lookupTableAccount:Vo.PublicKey.default,configId:Zn({programId:o})}}var Xr={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},Eo=a=>{let e={},t=vo.TOKEN_PROGRAM_ID.toBase58();return Object.keys(a).map(n=>{let r=a[n],[s,i]=[r.baseMint.toBase58(),r.quoteMint.toBase58()];e[n]={id:n,version:4,status:r.status.toNumber(),programId:r.programId.toBase58(),mintA:Un({address:s,programId:t,decimals:r.baseDecimal.toNumber()}),mintB:Un({address:i,programId:t,decimals:r.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:r.poolPrice.toNumber(),mintAmountA:new Tn.default(r.mintAAmount.toString()).div(10**r.baseDecimal.toNumber()).toNumber(),mintAmountB:new Tn.default(r.mintBAmount.toString()).div(10**r.quoteDecimal.toNumber()).toNumber(),baseReserve:r.baseReserve,quoteReserve:r.quoteReserve,feeRate:new Tn.default(r.tradeFeeNumerator.toString()).div(r.tradeFeeDenominator.toString()).toNumber(),openTime:r.poolOpenTime.toString(),tvl:0,day:Xr,week:Xr,month:Xr,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:r.marketId.toBase58(),configId:Zn({programId:r.programId}).toBase58(),lpPrice:0,lpAmount:new Tn.default(r.lpReserve.toString()).div(10**Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())).toNumber(),lpMint:Un({address:r.lpMint.toBase58(),programId:t,decimals:Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())}),burnPercent:0}}),e};var ge=ee(require("bn.js")),le=ee(require("decimal.js"));var Pa=require("@solana/web3.js"),ha=ee(require("bn.js")),Ta=require("@solana/spl-token");var We=require("@solana/web3.js"),$t=require("@solana/spl-token");function ka(a="accountFlags"){let e=new _n(a);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var zr=_([Se(5),ka("accountFlags"),R("ownAddress"),b("vaultSignerNonce"),R("baseMint"),R("quoteMint"),R("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),R("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),R("requestQueue"),R("eventQueue"),R("bids"),R("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),Se(7)]);function Aa({programId:a,marketInfo:e}){let t=_([E("version"),_e("instruction"),b("baseLotSize"),b("quoteLotSize"),Rt("feeRateBps"),b("vaultSignerNonce"),b("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:We.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),r=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},r),new We.TransactionInstruction({keys:n,programId:a,data:r})}async function jr({connection:a,wallet:e,marketInfo:t}){var i,o,u,l,c,m,p,d;let n=new We.Transaction,r=await a.getMinimumBalanceForRentExemption(165);n.add(We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:r,space:165,programId:$t.TOKEN_PROGRAM_ID}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:r,space:165,programId:$t.TOKEN_PROGRAM_ID}),(0,$t.createInitializeAccountInstruction)(t.baseVault.publicKey,t.baseMint,t.vaultOwner),(0,$t.createInitializeAccountInstruction)(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await a.getMinimumBalanceForRentExemption(zr.span),space:zr.span,programId:t.programId}));let s=new We.Transaction;return s.add(We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:t.lowestFeeMarket?6208320:await a.getMinimumBalanceForRentExemption((i=t.requestQueueSpace)!=null?i:5120+12),space:t.lowestFeeMarket?764:(o=t.requestQueueSpace)!=null?o:5120+12,programId:t.programId}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:t.lowestFeeMarket?79594560:await a.getMinimumBalanceForRentExemption((u=t.eventQueueSpace)!=null?u:262144+12),space:t.lowestFeeMarket?11308:(l=t.eventQueueSpace)!=null?l:262144+12,programId:t.programId}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:t.lowestFeeMarket?101977920:await a.getMinimumBalanceForRentExemption((c=t.orderbookQueueSpace)!=null?c:65536+12),space:t.lowestFeeMarket?14524:(m=t.orderbookQueueSpace)!=null?m:65536+12,programId:t.programId}),We.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:t.lowestFeeMarket?101977920:await a.getMinimumBalanceForRentExemption((p=t.orderbookQueueSpace)!=null?p:65536+12),space:t.lowestFeeMarket?14524:(d=t.orderbookQueueSpace)!=null?d:65536+12,programId:t.programId}),Aa({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[X.CreateAccount,X.CreateAccount,X.InitAccount,X.InitAccount]},{transaction:s,signer:[],instructionTypes:[X.CreateAccount,X.CreateAccount,X.CreateAccount,X.CreateAccount,X.CreateAccount,X.InitMarket]}]}var Jn=class extends Jt{constructor(t){super(t);this.stableLayout=new hn({connection:this.scope.connection,modelDataPubKey:this.scope.cluster==="mainnet"?void 0:Kt.MODEL_DATA_PUBKEY})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:r,baseIn:s}){let i=new ge.default(new le.default(n).mul(10**t[s?"mintA":"mintB"].decimals).toFixed(0)),o=yo(t[s?"mintB":"mintA"]),[u,l]=[new ge.default(new le.default(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new ge.default(new le.default(t.mintAmountB).mul(10**t.mintB.decimals).toString())],c=new ge.default(new le.default(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,le.default.ROUND_DOWN));this.logDebug("baseReserve:",u.toString(),"quoteReserve:",l.toString()),this.logDebug("tokenIn:",s?t.mintA.symbol:t.mintB.symbol,"amountIn:",i.toString(),"anotherToken:",s?t.mintB.symbol:t.mintA.symbol,"slippage:",`${r.toSignificant()}%`,"baseReserve",u.toString(),"quoteReserve",l.toString());let m=s?"base":"quote";this.logDebug("input side:",m);let p=yt;i.isZero()||(p=m==="base"?Ln(i.mul(l),u):Ln(i.mul(u),l)),this.logDebug("amountRaw:",p.toString(),"lpAmount:",c.toString());let d=Ln(i.mul(c),m==="base"?u:l);this.logDebug("liquidity:",d.toString());let f=new He(new ge.default(1)).add(r),y=new He(new ge.default(1)).sub(r),w=f.mul(p).quotient,g=y.mul(p).quotient,P=new Ae(o,p),T=new Ae(o,w),h=new Ae(o,g);return this.logDebug("anotherAmount:",P.toFixed(),"maxAnotherAmount:",T.toFixed()),{anotherAmount:P,maxAnotherAmount:T,minAnotherAmount:h,liquidity:d}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,poolKeys:r,amountInA:s,amountInB:i,otherAmountMin:o,fixedSide:u,config:l,txVersion:c,computeBudgetConfig:m,txTipConfig:p,feePayer:d}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",s,"amountInB:",i),(s.isZero()||i.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:s.toFixed(),amountInB:i.toFixed()});let{account:f}=this.scope,{bypassAssociatedCheck:y,checkCreateATAOwner:w}=F({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},l),[g,P]=[s.token,i.token],T=await f.getCreatedTokenAccount({mint:g.mint,associatedOnly:!1}),h=await f.getCreatedTokenAccount({mint:P.mint,associatedOnly:!1});!T&&!h&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",f.tokenAccounts);let A=await f.getCreatedTokenAccount({mint:new he.PublicKey(n.lpMint.address)}),k=[g,P],S=[T,h],x=[s.raw,i.raw],L=s.token.mint.toBase58()===n.mintA.address?"base":"quote",I="base";["quote","base"].includes(L)||this.logAndCreateError("invalid fixedSide","fixedSide",u),L==="quote"?(k.reverse(),S.reverse(),x.reverse(),I=u==="a"?"quote":"base"):L==="base"&&(I=u==="a"?"base":"quote");let[N,M]=k,[C,v]=S,[J,Z]=x,$=r!=null?r:await this.getAmmPoolKeys(n.id),me=this.createTxBuilder(d),ut=await f.handleTokenAccount({side:"in",amount:J,mint:N.mint,tokenAccount:C,bypassAssociatedCheck:y,checkCreateATAOwner:w}),{tokenAccount:Re}=ut,Qe=De(ut,["tokenAccount"]);me.addInstruction(Qe);let je=await f.handleTokenAccount({side:"in",amount:Z,mint:M.mint,tokenAccount:v,bypassAssociatedCheck:y,checkCreateATAOwner:w}),{tokenAccount:we}=je,fe=De(je,["tokenAccount"]);me.addInstruction(fe);let Oe=await f.handleTokenAccount({side:"out",amount:0,mint:new he.PublicKey(n.lpMint.address),tokenAccount:A,bypassAssociatedCheck:y,checkCreateATAOwner:w}),{tokenAccount:ze}=Oe,ft=De(Oe,["tokenAccount"]);return me.addInstruction(ft),me.addInstruction({instructions:[ko({poolInfo:n,poolKeys:$,userKeys:{baseTokenAccount:Re,quoteTokenAccount:we,lpTokenAccount:ze,owner:this.scope.ownerPubKey},baseAmountIn:J,quoteAmountIn:Z,otherAmountMin:o.raw,fixedSide:I})],instructionTypes:[n.pooltype.includes("StablePool")?X.AmmV5AddLiquidity:X.AmmV4AddLiquidity],lookupTableAddress:$.lookupTableAccount?[$.lookupTableAccount]:[]}),me.addCustomComputeBudget(m),me.addTipInstruction(p),c===0?await me.buildV0():me.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,poolKeys:r,lpAmount:s,baseAmountMin:i,quoteAmountMin:o,config:u,txVersion:l,computeBudgetConfig:c,txTipConfig:m,feePayer:p}=t,d=r!=null?r:await this.getAmmPoolKeys(n.id),[f,y,w]=[new he.PublicKey(n.mintA.address),new he.PublicKey(n.mintB.address),new he.PublicKey(n.lpMint.address)];this.logDebug("lpAmount:",s),this.logDebug("baseAmountMin:",i),this.logDebug("quoteAmountMin:",o),s.isZero()&&this.logAndCreateError("amount must greater than zero","lpAmount",s.toString());let{account:g}=this.scope,P=await g.getCreatedTokenAccount({mint:w,associatedOnly:!1});P||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",g.tokenAccounts);let T=await g.getCreatedTokenAccount({mint:f}),h=await g.getCreatedTokenAccount({mint:y}),A=this.createTxBuilder(p),{bypassAssociatedCheck:k,checkCreateATAOwner:S}=F({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),M=await g.handleTokenAccount({side:"out",amount:0,mint:f,tokenAccount:T,bypassAssociatedCheck:k,checkCreateATAOwner:S}),{tokenAccount:x}=M,L=De(M,["tokenAccount"]);A.addInstruction(L);let C=await g.handleTokenAccount({side:"out",amount:0,mint:y,tokenAccount:h,bypassAssociatedCheck:k,checkCreateATAOwner:S}),{tokenAccount:I}=C,N=De(C,["tokenAccount"]);return A.addInstruction(N),A.addInstruction({instructions:[Wr({poolInfo:n,poolKeys:d,userKeys:{lpTokenAccount:P,baseTokenAccount:x,quoteTokenAccount:I,owner:this.scope.ownerPubKey},lpAmount:s,baseAmountMin:i,quoteAmountMin:o})],lookupTableAddress:d.lookupTableAccount?[d.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?X.AmmV5RemoveLiquidity:X.AmmV4RemoveLiquidity]}),A.addCustomComputeBudget(c),A.addTipInstruction(m),l===0?await A.buildV0():A.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:r,createPositionInfo:s,farmInfo:i,userFarmLpAmount:o,base:u,computeBudgetConfig:l,payer:c,userAuxiliaryLedgers:m,tokenProgram:p=ve.TOKEN_PROGRAM_ID,checkCreateATAOwner:d=!0,getEphemeralSigners:f,txVersion:y,feePayer:w}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let g=this.createTxBuilder(w),P={};for(let $ of this.scope.account.tokenAccountRawInfos)(P[$.accountInfo.mint.toString()]===void 0||de(this.scope.ownerPubKey,$.accountInfo.mint,ve.TOKEN_PROGRAM_ID).publicKey.equals($.pubkey))&&(P[$.accountInfo.mint.toString()]=$.pubkey);let T=P[t.lpMint.address];if(T===void 0)throw Error("find lp account error in trade accounts");let h=r.add(o!=null?o:new ge.default(0)),A=t.mintA.address===Ne.WSOL.mint.toString(),k=t.mintB.address===Ne.WSOL.mint.toString(),{account:S,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:ve.TOKEN_PROGRAM_ID,mint:new he.PublicKey(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!0,checkCreateATAOwner:d});if(g.addInstruction(x||{}),S===void 0)throw new Error("base token account not found");let{account:L,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:ve.TOKEN_PROGRAM_ID,mint:new he.PublicKey(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:k?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!0,checkCreateATAOwner:d});if(g.addInstruction(I||{}),L===void 0)throw new Error("quote token account not found");if(P[t.mintA.address]=S,P[t.mintB.address]=L,i!==void 0&&!(o!=null&&o.isZero())){let $=wr[i.programId],me=Ht({programId:new he.PublicKey(i.programId),poolId:new he.PublicKey(i.id),owner:this.scope.ownerPubKey,version:$}),Re,Qe=await this.scope.connection.getAccountInfo(me);if(Qe&&(Re=qi($).decode(Qe.data)),$!==6&&!Re){let{instruction:Oe,instructionType:bt}=Gi({id:new he.PublicKey(i.id),programId:new he.PublicKey(i.programId),version:$,ledger:me,owner:this.scope.ownerPubKey});g.addInstruction({instructions:[Oe],instructionTypes:[bt]})}let we=[];for(let Oe of i.rewardInfos){let bt=Oe.mint.address===Ne.WSOL.mint.toString();if(P[Oe.mint.address])we.push(P[Oe.mint.address]);else{let{account:en,instructionParams:Tt}=await this.scope.account.getOrCreateTokenAccount({mint:new he.PublicKey(Oe.mint.address),tokenProgram:p,owner:this.scope.ownerPubKey,skipCloseAccount:!bt,createInfo:{payer:c||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:d});en||this.logAndCreateError("farm reward account not found:",Oe.mint.address),Tt&&g.addInstruction(Tt),we.push(en)}}let fe=(await this.scope.api.fetchFarmKeysById({ids:i.id}))[0],ze={userAuxiliaryLedgers:m,amount:o,owner:this.scope.ownerPubKey,farmInfo:i,farmKeys:fe,lpAccount:T,rewardAccounts:we},ft=wr[i.programId],ut=ft===6?Ui(ze):ft===5?Xi(ze):Qi(ze),je={3:X.FarmV3Withdraw,5:X.FarmV5Withdraw,6:X.FarmV6Withdraw};g.addInstruction({instructions:[ut],instructionTypes:[je[ft]]})}let N=await this.getAmmPoolKeys(t.id),M=Wr({poolInfo:t,poolKeys:N,userKeys:{lpTokenAccount:T,baseTokenAccount:S,quoteTokenAccount:L,owner:this.scope.ownerPubKey},lpAmount:h,baseAmountMin:0,quoteAmountMin:0});g.addInstruction({instructions:[M],instructionTypes:[t.pooltype.includes("StablePool")?X.AmmV5RemoveLiquidity:X.AmmV4RemoveLiquidity],lookupTableAddress:N.lookupTableAccount?[N.lookupTableAccount]:[]});let[C,v]=t.mintA.address===n.mintA.address?[S,L]:[L,S],J=await this.scope.clmm.getClmmPoolKeys(n.id),Z=await Zt.openPositionFromBaseInstructions(j(F({poolInfo:n,poolKeys:J,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:C,tokenAccountB:v},withMetadata:"create"},s),{base:u,getEphemeralSigners:f}));return g.addInstruction({instructions:[...Z.instructions],signers:Z.signers,instructionTypes:[...Z.instructionTypes],lookupTableAddress:J.lookupTableAccount?[J.lookupTableAccount]:[]}),y===0?g.sizeCheckBuildV0({computeBudgetConfig:l}):g.sizeCheckBuild({computeBudgetConfig:l})}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:r,quoteMintInfo:s,baseAmount:i,quoteAmount:o,startTime:u,ownerInfo:l,associatedOnly:c=!1,checkCreateATAOwner:m=!1,tokenProgram:p,txVersion:d,feeDestinationId:f,computeBudgetConfig:y,txTipConfig:w,feePayer:g}){var v;let P=l.feePayer||((v=this.scope.owner)==null?void 0:v.publicKey),T=l.useSOLBalance&&r.mint.equals(ve.NATIVE_MINT),h=l.useSOLBalance&&s.mint.equals(ve.NATIVE_MINT),A=this.createTxBuilder(g),{account:k,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({mint:r.mint,owner:this.scope.ownerPubKey,createInfo:T?{payer:P,amount:i}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:c,checkCreateATAOwner:m});A.addInstruction(S||{});let{account:x,instructionParams:L}=await this.scope.account.getOrCreateTokenAccount({mint:s.mint,owner:this.scope.ownerPubKey,createInfo:h?{payer:P,amount:o}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:c,checkCreateATAOwner:m});if(A.addInstruction(L||{}),k===void 0||x===void 0)throw Error("you don't has some token account");let I=Qr({version:4,marketVersion:3,marketId:n.marketId,baseMint:r.mint,quoteMint:s.mint,baseDecimals:r.decimals,quoteDecimals:s.decimals,programId:t,marketProgramId:n.programId}),N={programId:t,ammId:I.id,ammAuthority:I.authority,ammOpenOrders:I.openOrders,lpMint:I.lpMint,coinMint:I.baseMint,pcMint:I.quoteMint,coinVault:I.baseVault,pcVault:I.quoteVault,withdrawQueue:I.withdrawQueue,ammTargetOrders:I.targetOrders,poolTempLp:I.lpVault,marketProgramId:I.marketProgramId,marketId:I.marketId,ammConfigId:I.configId,feeDestinationId:f},{instruction:M,instructionType:C}=Or(j(F({},N),{userWallet:this.scope.ownerPubKey,userCoinVault:k,userPcVault:x,userLpVault:de(this.scope.ownerPubKey,I.lpMint,p).publicKey,nonce:I.nonce,openTime:u,coinAmount:i,pcAmount:o}));return A.addInstruction({instructions:[M],instructionTypes:[C]}),A.addCustomComputeBudget(y),A.addTipInstruction(w),A.versionBuild({txVersion:d,extInfo:{address:N}})}async createMarketAndPoolV4({programId:t=Ii,marketProgram:n=Bi,feeDestinationId:r=Ki,tokenProgram:s,baseMintInfo:i,quoteMintInfo:o,baseAmount:u,quoteAmount:l,startTime:c,ownerInfo:m,lowestFeeMarket:p,assignSeed:d,associatedOnly:f=!1,checkCreateATAOwner:y=!1,lotSize:w=1,tickSize:g=.01,txVersion:P,computeBudgetConfig:T,txTipConfig:h,feePayer:A}){var Yr,Zr,Jr;let k=this.scope.ownerPubKey,S=m.feePayer||((Yr=this.scope.owner)==null?void 0:Yr.publicKey),x=m.useSOLBalance&&i.mint.equals(ve.NATIVE_MINT),L=m.useSOLBalance&&o.mint.equals(ve.NATIVE_MINT),I=d?`${i.mint.toBase58().slice(0,7)}-${o.mint.toBase58().slice(0,7)}-${d}`:void 0,N=at({fromPublicKey:k,programId:n,assignSeed:I&&`${I}-market`}),M=at({fromPublicKey:k,programId:n,assignSeed:I&&`${I}-request`}),C=at({fromPublicKey:k,programId:n,assignSeed:I&&`${I}-event`}),v=at({fromPublicKey:k,programId:n,assignSeed:I&&`${I}-bids`}),J=at({fromPublicKey:k,programId:n,assignSeed:I&&`${I}-asks`}),Z=at({fromPublicKey:k,programId:ve.TOKEN_PROGRAM_ID,assignSeed:I&&`${I}-baseVault`}),$=at({fromPublicKey:k,programId:ve.TOKEN_PROGRAM_ID,assignSeed:I&&`${I}-quoteVault`}),me=0,Re=new ge.default(100);function Qe(){let rt=new ge.default(0);for(;;)try{return{vaultOwner:he.PublicKey.createProgramAddressSync([N.publicKey.toBuffer(),rt.toArrayLike(Buffer,"le",8)],n),vaultSignerNonce:rt}}catch{if(rt.iaddn(1),rt.gt(new ge.default(25555)))throw Error("find vault owner error")}}let{vaultOwner:we,vaultSignerNonce:fe}=Qe(),ze=new ge.default(Math.round(10**i.decimals*w)),ft=new ge.default(Math.round(w*10**o.decimals*g));if(ze.eq(yt))throw Error("lot size is too small");if(ft.eq(yt))throw Error("tick size or lot size is too small");let ut=await jr({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:n,vaultOwner:we,baseMint:i.mint,quoteMint:o.mint,id:N,baseVault:Z,quoteVault:$,requestQueue:M,eventQueue:C,bids:v,asks:J,feeRateBps:me,quoteDustThreshold:Re,vaultSignerNonce:fe,baseLotSize:ze,quoteLotSize:ft,lowestFeeMarket:p}}),je=this.createTxBuilder(A);je.addInstruction({instructions:ut[0].transaction.instructions,signers:ut[0].signer});for await(let rt of ut.slice(1,ut.length))je.addInstruction({instructions:rt.transaction.instructions,signers:rt.signer,instructionTypes:rt.instructionTypes});let{account:Oe,instructionParams:bt}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:x?{payer:S,amount:u}:void 0,notUseTokenAccount:x,skipCloseAccount:!x,associatedOnly:x?!1:f,checkCreateATAOwner:y,assignSeed:x&&I?`${I}-wsol`:void 0});je.addInstruction(bt||{});let{account:en,instructionParams:Tt}=await this.scope.account.getOrCreateTokenAccount({mint:o.mint,owner:this.scope.ownerPubKey,createInfo:L?{payer:S,amount:l}:void 0,notUseTokenAccount:L,skipCloseAccount:!L,associatedOnly:L?!1:f,checkCreateATAOwner:y,assignSeed:L&&I?`${I}-wsol`:void 0});if(je.addInstruction(Tt||{}),Oe===void 0)throw Error("you don't has base token account");if(en===void 0)throw Error("you don't has quote token account");let Ce=Qr({version:4,marketVersion:3,marketId:N.publicKey,baseMint:i.mint,quoteMint:o.mint,baseDecimals:i.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n}),$n={programId:t,ammId:Ce.id,ammAuthority:Ce.authority,ammOpenOrders:Ce.openOrders,lpMint:Ce.lpMint,coinMint:Ce.baseMint,pcMint:Ce.quoteMint,coinVault:Ce.baseVault,pcVault:Ce.quoteVault,withdrawQueue:Ce.withdrawQueue,ammTargetOrders:Ce.targetOrders,poolTempLp:Ce.lpVault,marketProgramId:Ce.marketProgramId,marketId:Ce.marketId,ammConfigId:Ce.configId,feeDestinationId:r},{instruction:Wo,instructionType:Oo}=Or(j(F({},$n),{userWallet:this.scope.ownerPubKey,userCoinVault:Oe,userPcVault:en,userLpVault:de(this.scope.ownerPubKey,Ce.lpMint,s).publicKey,nonce:Ce.nonce,openTime:c,coinAmount:u,pcAmount:l}));je.addInstruction({instructions:[Wo],instructionTypes:[Oo]});let Hr=x||L?[((Zr=bt==null?void 0:bt.instructions)==null?void 0:Zr[0])||((Jr=Tt==null?void 0:Tt.instructions)==null?void 0:Jr[0])].filter(rt=>!!rt):void 0;return P===0?je.sizeCheckBuildV0({computeBudgetConfig:T,splitIns:Hr,address:F({requestQueue:M.publicKey,eventQueue:C.publicKey,bids:v.publicKey,asks:J.publicKey,baseVault:Z.publicKey,quoteVault:$.publicKey,baseMint:new he.PublicKey(i.mint),quoteMint:new he.PublicKey(o.mint)},$n)}):je.sizeCheckBuild({computeBudgetConfig:T,splitIns:Hr,address:F({requestQueue:M.publicKey,eventQueue:C.publicKey,bids:v.publicKey,asks:J.publicKey,baseVault:Z.publicKey,quoteVault:$.publicKey,baseMint:new he.PublicKey(i.mint),quoteMint:new he.PublicKey(o.mint)},$n)})}async getCreatePoolFee({programId:t}){let n=Zn({programId:t}),r=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(r===null)throw Error("get config account error");return go.decode(r.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:r,mintOut:s,slippage:i}){let[o,u]=[r.toString(),s.toString()];if(o!==t.mintA.address&&o!==t.mintB.address)throw new Error("toke not match");if(u!==t.mintA.address&&u!==t.mintB.address)throw new Error("toke not match");let{baseReserve:l,quoteReserve:c}=t,m=[l,c],p=[t.mintA.decimals,t.mintB.decimals],d=o==t.mintA.address?"base":"quote";d==="quote"&&(m.reverse(),p.reverse());let[f,y]=m,[w,g]=p,P=t.version===4,T;if(P)T=new le.default(y.toString()).div(10**g).div(new le.default(f.toString()).div(10**w));else{let C=So(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),!1);d==="quote"?T=new le.default(1e6).div(C*1e6):T=new le.default(C*1e6).div(1e6)}let h=n,A=new ge.default(0),k=new ge.default(0);if(!h.isZero())if(P){k=dn(h.mul(Nr),Xn);let C=h.sub(k),v=f.add(C);A=y.mul(C).div(v)}else{k=h.mul(new ge.default(2)).div(new ge.default(1e4));let C=h.sub(k);d==="quote"?A=new ge.default(To(this.stableLayout.stableModelData,c.toNumber(),l.toNumber(),C.toNumber())):A=new ge.default(xo(this.stableLayout.stableModelData,c.toNumber(),l.toNumber(),C.toNumber()))}let S=new ge.default(new le.default(A.toString()).mul(1-i).toFixed(0)),x=A,L=S,I=new le.default(A.toString()).div(new le.default(h.sub(k).toString()).toFixed(0));!h.isZero()&&!A.isZero()&&(I=new le.default(A.toString()).div(10**g).div(new le.default(h.sub(k).toString()).div(10**w)));let N=T.sub(I).div(T).mul(100);return{amountOut:x,minAmountOut:L,currentPrice:T,executionPrice:I,priceImpact:N,fee:k}}computeAmountIn({poolInfo:t,amountOut:n,mintIn:r,mintOut:s,slippage:i}){let{baseReserve:o,quoteReserve:u}=t;r.toString()!==t.mintA.address&&r.toString()!==t.mintB.address&&this.logAndCreateError("mintIn does not match pool"),s.toString()!==t.mintA.address&&s.toString()!==t.mintB.address&&this.logAndCreateError("mintOut does not match pool"),this.logDebug("baseReserve:",o.toString()),this.logDebug("quoteReserve:",u.toString());let l=r.toString()===t.mintA.address,[c,m]=l?[t.mintA,t.mintB]:[t.mintB,t.mintA];this.logDebug("currencyOut:",m.symbol||m.address),this.logDebug("amountOut:",new le.default(n.toString()).div(10**m.decimals).toDecimalPlaces(m.decimals).toString(),c.symbol||c.address),this.logDebug("slippage:",`${i*100}%`);let p=[o,u],d=l?"quote":"base";d==="base"&&p.reverse(),this.logDebug("output side:",d);let[f,y]=p,w=new le.default(y.toString()).div(10**t[l?"mintB":"mintA"].decimals).div(new le.default(f.toString()).div(10**t[l?"mintA":"mintB"].decimals));this.logDebug("currentPrice:",`1 ${c.symbol||c.address} \u2248 ${w.toString()} ${m.symbol||m.address}`),this.logDebug("currentPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new le.default(1).div(w).toString()} ${c.symbol||c.address}`);let g=new ge.default(0),P=n;if(!P.isZero()){P.gt(y)&&(P=y.sub(new ge.default(1)));let L=y.sub(P);g=f.mul(P).div(L).mul(Xn).div(Xn.sub(Nr))}let T=new ge.default(new le.default(g.toString()).mul(1+i).toFixed(0)),h=g,A=T;this.logDebug("amountIn:",new le.default(h.toString()).div(10**c.decimals).toDecimalPlaces(c.decimals).toString()),this.logDebug("maxAmountIn:",new le.default(A.toString()).div(10**c.decimals).toDecimalPlaces(c.decimals).toString());let k=null;!g.isZero()&&!P.isZero()&&(k=new le.default(P.toString()).div(10**m.decimals).div(new le.default(g.toString()).div(10**c.decimals)),this.logDebug("executionPrice:",`1 ${m.symbol||m.address} \u2248 ${k.toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${c.symbol||c.address}`),this.logDebug("executionPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new le.default(1).div(k).toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${c.symbol||c.address}`));let S=w.mul(h.toString()),x=S.sub(n.toString()).abs().div(S);return this.logDebug("priceImpact:",`${x.toString()}%`),{amountIn:h,maxAmountIn:A,currentPrice:w,executionPrice:k,priceImpact:x}}async swap({poolInfo:t,poolKeys:n,amountIn:r,amountOut:s,inputMint:i,fixedSide:o,txVersion:u,config:l,computeBudgetConfig:c,txTipConfig:m,feePayer:p}){let d=this.createTxBuilder(p),{associatedOnly:f=!0,inputUseSolBalance:y=!0,outputUseSolBalance:w=!0}=l||{},[g,P]=i===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],T=y&&g.address===Gt.toBase58(),h=w&&P.address===Gt.toBase58(),{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:ve.TOKEN_PROGRAM_ID,mint:new he.PublicKey(g.address),owner:this.scope.ownerPubKey,createInfo:T?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!T,notUseTokenAccount:T,associatedOnly:f});d.addInstruction(k||{}),A||this.logAndCreateError("input token account not found",{token:g.symbol||g.address,tokenAccountIn:A,inputTokenUseSolBalance:T,associatedOnly:f});let{account:S,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:ve.TOKEN_PROGRAM_ID,mint:new he.PublicKey(P.address),owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:f});d.addInstruction(x||{}),S===void 0&&this.logAndCreateError("output token account not found",{token:P.symbol||P.address,tokenAccountOut:S,outputTokenUseSolBalance:h,associatedOnly:f});let L=n||await this.getAmmPoolKeys(t.id),I=4;return t.pooltype.includes("StablePool")&&(I=5),d.addInstruction({instructions:[Ao({version:I,poolKeys:L,userKeys:{tokenAccountIn:A,tokenAccountOut:S,owner:this.scope.ownerPubKey},amountIn:r,amountOut:s,fixedSide:o})],instructionTypes:[I===4?X.AmmV4SwapBaseIn:X.AmmV5SwapBaseIn]}),d.addCustomComputeBudget(c),d.addTipInstruction(m),d.versionBuild({txVersion:u})}async getRpcPoolInfo(t){return(await this.getRpcPoolInfos([t]))[t]}async getRpcPoolInfos(t,n){let r=await Lt(this.scope.connection,t.map(c=>({pubkey:new he.PublicKey(c)})),n),s={},i=[];for(let c=0;c<t.length;c++){let m=r[c];if(m===null||!m.accountInfo)throw Error("fetch pool info error: "+String(t[c]));let p=Vr.decode(m.accountInfo.data);s[String(t[c])]=j(F({},p),{programId:m.accountInfo.owner}),i.push(p.baseVault,p.quoteVault)}let o={},u=await Lt(this.scope.connection,i.map(c=>({pubkey:new he.PublicKey(c)})),n);for(let c=0;c<i.length;c++){let m=u[c].accountInfo;if(m===null)throw Error("fetch vault info error: "+i[c]);o[String(i[c])]=new ge.default(ve.AccountLayout.decode(m.data).amount.toString())}let l={};for(let[c,m]of Object.entries(s)){let p=o[m.baseVault.toString()].sub(m.baseNeedTakePnl),d=o[m.quoteVault.toString()].sub(m.quoteNeedTakePnl);l[c]=j(F({},m),{baseReserve:p,mintAAmount:o[m.baseVault.toString()],mintBAmount:o[m.quoteVault.toString()],quoteReserve:d,poolPrice:new le.default(d.toString()).div(new le.default(10).pow(m.quoteDecimal.toString())).div(new le.default(p.toString()).div(new le.default(10).pow(m.baseDecimal.toString())))})}return l}async getPoolInfoFromRpc({poolId:t}){let n=await this.getRpcPoolInfo(t),r=Eo({[t]:n}),s=r[t],i=await this.scope.tradeV2.computePoolToPoolKeys({pools:[r[t]],ammRpcData:{[t]:n}});return{poolRpcData:n,poolInfo:s,poolKeys:i[0]}}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=liquidity.js.map