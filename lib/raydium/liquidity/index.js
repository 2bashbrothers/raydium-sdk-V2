var tn=Object.create;var oe=Object.defineProperty,nn=Object.defineProperties,rn=Object.getOwnPropertyDescriptor,on=Object.getOwnPropertyDescriptors,sn=Object.getOwnPropertyNames,he=Object.getOwnPropertySymbols,an=Object.getPrototypeOf,Re=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var st=(e,t,n)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,K=(e,t)=>{for(var n in t||(t={}))Re.call(t,n)&&st(e,n,t[n]);if(he)for(var n of he(t))at.call(t,n)&&st(e,n,t[n]);return e},R=(e,t)=>nn(e,on(t));var Me=(e,t)=>{var n={};for(var r in e)Re.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&he)for(var r of he(e))t.indexOf(r)<0&&at.call(e,r)&&(n[r]=e[r]);return n};var un=(e,t)=>{for(var n in t)oe(e,n,{get:t[n],enumerable:!0})},ut=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of sn(t))!Re.call(e,i)&&i!==n&&oe(e,i,{get:()=>t[i],enumerable:!(r=rn(t,i))||r.enumerable});return e};var I=(e,t,n)=>(n=e!=null?tn(an(e)):{},ut(t||!e||!e.__esModule?oe(n,"default",{value:e,enumerable:!0}):n,e)),cn=e=>ut(oe({},"__esModule",{value:!0}),e);var ir={};un(ir,{DataElement:()=>vt,LIQUIDITY_FEES_DENOMINATOR:()=>mn,LIQUIDITY_FEES_NUMERATOR:()=>ln,LIQUIDITY_VERSION_TO_SERUM_VERSION:()=>ct,LIQUIDITY_VERSION_TO_STATE_LAYOUT:()=>dn,StableLayout:()=>fe,addLiquidityLayout:()=>ke,createPoolFeeLayout:()=>fn,createPoolV4InstructionV2:()=>En,createPoolV4Layout:()=>pn,fetchMultipleInfo:()=>rr,fixedSwapInLayout:()=>xe,fixedSwapOutLayout:()=>Pe,formatLayout:()=>Ut,getAssociatedConfigId:()=>rt,getAssociatedOpenOrders:()=>Qt,getAssociatedPoolKeys:()=>nr,getDxByDyBaseIn:()=>Zn,getDyByDxBaseIn:()=>Xn,getLiquidityAssociatedAuthority:()=>Yt,getLiquidityAssociatedId:()=>q,getStablePrice:()=>Jn,initPoolLayout:()=>we,liquidityStateV4Layout:()=>Ae,liquidityStateV5Layout:()=>dt,makeAMMSwapInstruction:()=>vn,makeAddLiquidityInstruction:()=>_n,makeInitPoolInstructionV4:()=>Fn,makeSimulatePoolInfoInstruction:()=>$e,makeSwapFixedInInstruction:()=>_t,makeSwapFixedOutInstruction:()=>Ot,modelDataInfoLayout:()=>Ft,removeLiquidityInstruction:()=>On,removeLiquidityLayout:()=>Se,simulatePoolInfoInstruction:()=>Vn,toAmmComputePoolInfo:()=>or});module.exports=cn(ir);var De=I(require("bn.js")),ln=new De.default(25),mn=new De.default(1e4),ct={4:3,5:3};var pt=require("@solana/web3.js"),Y=I(require("bn.js"));var f=require("@solana/buffer-layout"),_e=f.Layout,lt=f.Structure;var Oe=f.UInt;var mt=f.seq;var Ee=f.blob;var Te=class extends _e{constructor(n,r,i){super(n,i);this.blob=Ee(n),this.signed=r}decode(n,r=0){let i=new Y.default(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new Y.default(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}};function k(e){return new Oe(1,e)}function U(e){return new Oe(4,e)}function u(e){return new Te(8,!1,e)}function _(e){return new Te(16,!1,e)}var Ve=class extends _e{constructor(n,r,i,l){super(n.span,l);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function h(e){return new Ve(Ee(32),t=>new pt.PublicKey(t),t=>t.toBuffer(),e)}var ve=class extends lt{decode(t,n){return super.decode(t,n)}};function S(e,t,n){return new ve(e,t,n)}function ie(e,t,n){let r,i=typeof t=="number"?t:(0,Y.isBN)(t)?t.toNumber():new Proxy(t,{get(l,o){if(!r){let a=Reflect.get(l,"count");r=(0,Y.isBN)(a)?a.toNumber():a,Reflect.set(l,"count",r)}return Reflect.get(l,o)},set(l,o,a){return o==="count"&&(r=a),Reflect.set(l,o,a)}});return mt(e,i,n)}var xe=S([k("instruction"),u("amountIn"),u("minAmountOut")]),Pe=S([k("instruction"),u("maxAmountIn"),u("amountOut")]),pn=S([k("instruction"),k("nonce")]),we=S([k("instruction"),k("nonce"),u("startTime")]),Ae=S([u("status"),u("nonce"),u("maxOrder"),u("depth"),u("baseDecimal"),u("quoteDecimal"),u("state"),u("resetFlag"),u("minSize"),u("volMaxCutRatio"),u("amountWaveRatio"),u("baseLotSize"),u("quoteLotSize"),u("minPriceMultiplier"),u("maxPriceMultiplier"),u("systemDecimalValue"),u("minSeparateNumerator"),u("minSeparateDenominator"),u("tradeFeeNumerator"),u("tradeFeeDenominator"),u("pnlNumerator"),u("pnlDenominator"),u("swapFeeNumerator"),u("swapFeeDenominator"),u("baseNeedTakePnl"),u("quoteNeedTakePnl"),u("quoteTotalPnl"),u("baseTotalPnl"),u("poolOpenTime"),u("punishPcAmount"),u("punishCoinAmount"),u("orderbookToInitTime"),_("swapBaseInAmount"),_("swapQuoteOutAmount"),u("swapBase2QuoteFee"),_("swapQuoteInAmount"),_("swapBaseOutAmount"),u("swapQuote2BaseFee"),h("baseVault"),h("quoteVault"),h("baseMint"),h("quoteMint"),h("lpMint"),h("openOrders"),h("marketId"),h("marketProgramId"),h("targetOrders"),h("withdrawQueue"),h("lpVault"),h("owner"),u("lpReserve"),ie(u(),3,"padding")]),dt=S([u("accountType"),u("status"),u("nonce"),u("maxOrder"),u("depth"),u("baseDecimal"),u("quoteDecimal"),u("state"),u("resetFlag"),u("minSize"),u("volMaxCutRatio"),u("amountWaveRatio"),u("baseLotSize"),u("quoteLotSize"),u("minPriceMultiplier"),u("maxPriceMultiplier"),u("systemDecimalsValue"),u("abortTradeFactor"),u("priceTickMultiplier"),u("priceTick"),u("minSeparateNumerator"),u("minSeparateDenominator"),u("tradeFeeNumerator"),u("tradeFeeDenominator"),u("pnlNumerator"),u("pnlDenominator"),u("swapFeeNumerator"),u("swapFeeDenominator"),u("baseNeedTakePnl"),u("quoteNeedTakePnl"),u("quoteTotalPnl"),u("baseTotalPnl"),u("poolOpenTime"),u("punishPcAmount"),u("punishCoinAmount"),u("orderbookToInitTime"),_("swapBaseInAmount"),_("swapQuoteOutAmount"),_("swapQuoteInAmount"),_("swapBaseOutAmount"),u("swapQuote2BaseFee"),u("swapBase2QuoteFee"),h("baseVault"),h("quoteVault"),h("baseMint"),h("quoteMint"),h("lpMint"),h("modelDataAccount"),h("openOrders"),h("marketId"),h("marketProgramId"),h("targetOrders"),h("owner"),ie(u(),64,"padding")]),ke=S([k("instruction"),u("baseAmountIn"),u("quoteAmountIn"),u("fixedSide"),u("otherAmountMin")]),Se=S([k("instruction"),u("lpAmount"),u("baseAmountMin"),u("quoteAmountMin")]),dn={4:Ae,5:dt},fn=S([u("fee")]);var te=require("@solana/web3.js"),ee=I(require("bn.js")),ye=I(require("decimal.js")),zt=require("@solana/spl-token");var N=require("@solana/web3.js");var se=require("lodash");var Fe=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},ft={},bn={};function B(e){let t=(0,se.get)(ft,e);if(!t){let n=(0,se.get)(bn,e);t=new Fe({name:e,logLevel:n}),(0,se.set)(ft,e,t)}return t}var ae={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var yn=require("@solana/spl-token"),O=B("Raydium_txUtil"),gn=1644;function hn(e,t){e.length<1&&O.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&O.logWithError(`no signers provided:, ${t.toString()}`);let n=new N.Transaction;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<gn}catch{return!1}}async function bt(e,t,n,r=!0){let i=new N.PublicKey("RaydiumSimuLateTransaction11111111111111111"),l=[],o=new N.Transaction;o.feePayer=i;for(let m of t)hn([...o.instructions,m],[i])||(l.push(o),o=new N.Transaction,o.feePayer=i),o.add(m);o.instructions.length>0&&l.push(o);let a=[];try{if(a=await Tn(e,l,r),a.find(m=>m.err!==null))throw Error("rpc simulateTransaction error")}catch(m){m instanceof Error&&O.logWithError("failed to simulate for instructions","RPC_ERROR",{message:m.message})}let c=[];for(let m of a)if(O.debug("simulate result:",m),m.logs){let p=m.logs.filter(g=>g&&g.includes(n));O.debug("filteredLog:",c),p.length||O.logWithError("simulate log not match keyword","keyword",n),c.push(...p)}return c}function yt(e,t){let n=e.match(/{["\w:,]+}/g);return!n||n.length!==1?O.logWithError(`simulate log fail to match json, keyword: ${t}`):n[0]}function E(e,t){let r=new RegExp(`"${t}":(\\d+)`,"g").exec(e);return!r||r.length!==2?O.logWithError(`simulate log fail to match key", key: ${t}`):r[1]}function X(e,t){let[n,r]=N.PublicKey.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}async function Tn(e,t,n){let r=[];if(n){let i=await e.getLatestBlockhash(),l=[];for(let m of t){m.recentBlockhash=i.blockhash,m.lastValidBlockHeight=i.lastValidBlockHeight;let g=m._compile().serialize(),w=m._serialize(g).toString("base64");l.push(w)}let o=l.map(m=>{let p=e._buildArgs([m],void 0,"base64");return{methodName:"simulateTransaction",args:p}}),a=[],c=20;for(let m=0;m<Math.ceil(o.length/c);m++)a.push(o.slice(m*c,(m+1)*c));r=await(await Promise.all(a.map(async m=>(await e._rpcBatchRequest(m)).map(p=>p.result.value)))).flat()}else try{r=await Promise.all(t.map(async i=>await(await e.simulateTransaction(i)).value))}catch(i){i instanceof Error&&O.logWithError("failed to get info for multiple accounts","RPC_ERROR",{message:i.message})}return r}var Dn=require("@solana/web3.js"),Mt=require("@solana/spl-token");var Rt=I(require("big.js")),de=I(require("bn.js"));var D=I(require("bn.js")),Sn=I(require("decimal.js"));var gt=require("@solana/web3.js"),We=require("@solana/spl-token"),qe={chainId:101,address:gt.PublicKey.default.toBase58(),programId:We.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},V={chainId:101,address:"So11111111111111111111111111111111111111112",programId:We.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Ie=require("@solana/web3.js");var x=require("@solana/web3.js"),ht=require("@solana/spl-token");function s({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var Dr=[s({pubkey:ht.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:x.SystemProgram.programId,isWritable:!1}),s({pubkey:x.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Ge({publicKey:e,transformSol:t}){let n=He(e.toString());if(n instanceof x.PublicKey)return t&&n.equals(ue)?Ue:n;if(t&&n.toString()===ue.toBase58())return Ue;if(typeof n=="string"){if(n===x.PublicKey.default.toBase58())return x.PublicKey.default;try{return new x.PublicKey(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function He(e){try{return new x.PublicKey(e)}catch{return e}}var _r=new x.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Or=new x.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Tt=new x.PublicKey("SysvarRent111111111111111111111111111111111"),Er=new x.PublicKey("SysvarC1ock11111111111111111111111111111111"),Vr=new x.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),vr=new x.PublicKey("Sysvar1nstructions1111111111111111111111111"),Fr=x.SystemProgram.programId,Wr=new x.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),qr=new x.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ur=new x.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Gr=new x.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Hr=new x.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),jr=new x.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),zr=new x.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Qr=new x.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Yr=new x.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Xr=new x.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Zr=new x.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ue=new x.PublicKey("So11111111111111111111111111111111111111112"),ue=x.PublicKey.default;function je(e){return Ge({publicKey:e,transformSol:!0})}var ze=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:l=!1,isToken2022:o=!1}){if(t===ue.toBase58()||t instanceof Ie.PublicKey&&ue.equals(t)){this.decimals=V.decimals,this.symbol=V.symbol,this.name=V.name,this.mint=new Ie.PublicKey(V.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=l?Ie.PublicKey.default:Ge({publicKey:t}),this.isToken2022=o}equals(t){return this===t?!0:this.mint.equals(t.mint)}},W=ze;W.WSOL=new ze(R(K({},V),{mint:V.address}));var Qe=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},Be=Qe;Be.SOL=new Qe(qe);var le=I(require("big.js")),wt=I(require("bn.js")),At=I(require("decimal.js-light"));var Z=I(require("bn.js"));var xt=9007199254740991;function P(e){let t=B("Raydium_parseBigNumberish");if(e instanceof Z.default)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Z.default(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=xt||e<=-xt)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Z.default(String(e))):typeof e=="bigint"?new Z.default(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Z.default(0))}var Pt=I(require("toformat")),xn=Pt.default,ce=xn;var Le=B("module/fraction"),Ye=ce(le.default),me=ce(At.default),wn={[0]:me.ROUND_DOWN,[1]:me.ROUND_HALF_UP,[2]:me.ROUND_UP},An={[0]:le.default.roundDown,[1]:le.default.roundHalfUp,[2]:le.default.roundUp},T=class{constructor(t,n=new wt.default(1)){this.numerator=P(t),this.denominator=P(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new T(this.denominator,this.numerator)}add(t){let n=t instanceof T?t:new T(P(t));return this.denominator.eq(n.denominator)?new T(this.numerator.add(n.numerator),this.denominator):new T(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof T?t:new T(P(t));return this.denominator.eq(n.denominator)?new T(this.numerator.sub(n.numerator),this.denominator):new T(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof T?t:new T(P(t));return new T(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof T?t:new T(P(t));return new T(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Le.logWithError(`${t} is not an integer.`),t<=0&&Le.logWithError(`${t} is not positive.`),me.set({precision:t+1,rounding:wn[r]});let i=new me(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Le.logWithError(`${t} is not an integer.`),t<0&&Le.logWithError(`${t} is negative.`),Ye.DP=t,Ye.RM=An[r]||1,new Ye(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var St=I(require("bn.js"));var kt=new T(new St.default(100)),J=class extends T{toSignificant(t=5,n,r){return this.mul(kt).toSignificant(t,n,r)}toFixed(t=2,n,r){return this.mul(kt).toFixed(t,n,r)}};var kn=B("Raydium_price"),v=class extends T{constructor(n){let{baseToken:r,quoteToken:i,numerator:l,denominator:o}=n;super(l,o);this.baseToken=r,this.quoteToken=i,this.scalar=new T(Xe(r.decimals),Xe(i.decimals))}get raw(){return new T(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new v({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(n){this.quoteToken!==n.baseToken&&kn.logWithError("mul token not equals");let r=super.mul(n);return new v({baseToken:this.baseToken,quoteToken:n.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(n=this.quoteToken.decimals,r,i){return this.adjusted.toSignificant(n,r,i)}toFixed(n=this.quoteToken.decimals,r,i){return this.adjusted.toFixed(n,r,i)}};var It=require("@solana/web3.js"),Bt=I(require("bn.js"));function Lt(e){return typeof e=="object"&&e!==null&&![W,M,It.PublicKey,T,Bt.default,v,J].some(t=>typeof t=="object"&&e instanceof t)}function G(e){return typeof e=="string"?He(e):Array.isArray(e)?e.map(t=>G(t)):Lt(e)?Object.fromEntries(Object.entries(e).map(([t,n])=>[t,G(n)])):e}var Ze=new D.default(0),Ct=new D.default(1),Fo=new D.default(2),Wo=new D.default(3),qo=new D.default(5),Je=new D.default(10),Uo=new D.default(100),Go=new D.default(1e3),Ho=new D.default(1e4);function Xe(e){return Je.pow(P(e))}var In=require("@solana/web3.js");var Ce=require("@solana/spl-token"),$o=B("Raydium_accountInfo_util");var Bn=require("@solana/web3.js"),Ln=require("@solana/spl-token");var d=require("@solana/web3.js"),ai=new d.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ui=new d.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ci=new d.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),li=new d.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),mi=new d.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pi=new d.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),di=new d.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),fi=new d.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),bi=new d.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),yi=new d.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),gi=new d.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),hi=new d.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ti=new d.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),H=new d.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),xi=new d.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Pi=new d.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),wi=new d.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ai=new d.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ki=new d.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Si=new d.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ii=new d.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Bi=new d.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Li=new d.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ci=new d.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ki=new d.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ni=new d.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ri=new d.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Mi=new d.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Di=new d.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),_i=new d.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Oi=new d.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ei={OPEN_BOOK_PROGRAM:new d.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new d.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new d.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new d.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new d.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new d.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new d.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new d.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new d.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new d.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new d.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new d.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:d.PublicKey.default,Router:new d.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new d.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new d.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new d.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new d.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new d.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new d.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new d.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new d.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new d.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new d.PublicKey("Ray1111111111111111111111111111111111111111")};var Cn=I(require("bn.js"));var pe=require("@solana/web3.js");var Kn={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new pe.AddressLookupTableAccount({key:new pe.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:pe.AddressLookupTableAccount.deserialize(Buffer.from("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","base64"))})};var $=require("@solana/web3.js"),Nn=I(require("axios"));var Kt=I(require("bn.js")),cs=new Kt.default(1e6);var Rn=B("Raydium_amount"),Nt=ce(Rt.default);function Mn(e,t){let n="0",r="0";if(e.includes(".")){let i=e.split(".");i.length===2?([n,r]=i,r=r.padEnd(t,"0")):Rn.logWithError(`invalid number string, num: ${e}`)}else n=e;return[n,r.slice(0,t)||r]}var M=class extends T{constructor(n,r,i=!0,l){let o=new de.default(0),a=Je.pow(new de.default(n.decimals));if(i)o=P(r);else{let c=new de.default(0),m=new de.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[p,g]=Mn(r.toString(),n.decimals);c=P(p),m=P(g)}c=c.mul(a),o=c.add(m)}super(o,a);this.logger=B(l||"TokenAmount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new M(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new M(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,r,i=0){return super.toSignificant(n,r,i)}toFixed(n=this.token.decimals,r,i=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,r,i)}toExact(n={groupSeparator:""}){return Nt.DP=this.token.decimals,new Nt(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};var Ke=i=>{var l=i,{address:e,programId:t,decimals:n}=l,r=Me(l,["address","programId","decimals"]);return K({chainId:101,address:je(e).toBase58(),programId:t,logoURI:"",symbol:"",name:"",decimals:n,tags:[],extensions:r.extensions||{}},r)};var y=require("@solana/web3.js"),F=require("@solana/spl-token");var Dt=B("Raydium_liquidity_instruction");function _n(e){let{poolInfo:t,poolKeys:n,userKeys:r,baseAmountIn:i,quoteAmountIn:l,fixedSide:o,otherAmountMin:a,modelDataPubKey:c=H}=e,m=Buffer.alloc(ke.span);ke.encode({instruction:3,baseAmountIn:P(i),quoteAmountIn:P(l),otherAmountMin:P(a),fixedSide:o==="base"?Ze:Ct},m);let p=[s({pubkey:F.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:new y.PublicKey(t.id)}),s({pubkey:new y.PublicKey(n.authority),isWritable:!1}),s({pubkey:new y.PublicKey(n.openOrders),isWritable:!1}),s({pubkey:new y.PublicKey(n.targetOrders)}),s({pubkey:new y.PublicKey(t.lpMint.address)}),s({pubkey:new y.PublicKey(n.vault.A)}),s({pubkey:new y.PublicKey(n.vault.B)})];return t.pooltype.includes("StablePool")&&p.push(s({pubkey:c})),p.push(s({pubkey:new y.PublicKey(t.marketId),isWritable:!1}),s({pubkey:r.baseTokenAccount}),s({pubkey:r.quoteTokenAccount}),s({pubkey:r.lpTokenAccount}),s({pubkey:r.owner,isWritable:!1,isSigner:!0}),s({pubkey:new y.PublicKey(n.marketEventQueue),isWritable:!1})),new y.TransactionInstruction({programId:new y.PublicKey(t.programId),keys:p,data:m})}function On(e){let{poolInfo:t,poolKeys:n,userKeys:r,lpAmount:i,baseAmountMin:l,quoteAmountMin:o,modelDataPubKey:a=H}=e,c=G(n),m=4;if(t.pooltype.includes("StablePool")&&(m=5),m===4||m===5){let p=Buffer.alloc(Se.span);Se.encode({instruction:4,lpAmount:P(i),baseAmountMin:P(l),quoteAmountMin:P(o)},p);let g=[s({pubkey:F.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:c.id}),s({pubkey:c.authority,isWritable:!1}),s({pubkey:c.openOrders}),s({pubkey:c.targetOrders}),s({pubkey:c.mintLp.address}),s({pubkey:c.vault.A}),s({pubkey:c.vault.B})];return m===5?g.push(s({pubkey:a})):(g.push(s({pubkey:c.id})),g.push(s({pubkey:c.id}))),g.push(s({pubkey:c.marketProgramId,isWritable:!1}),s({pubkey:c.marketId}),s({pubkey:c.marketBaseVault}),s({pubkey:c.marketQuoteVault}),s({pubkey:c.marketAuthority,isWritable:!1}),s({pubkey:r.lpTokenAccount}),s({pubkey:r.baseTokenAccount}),s({pubkey:r.quoteTokenAccount}),s({pubkey:r.owner,isWritable:!1,isSigner:!0}),s({pubkey:c.marketEventQueue}),s({pubkey:c.marketBids}),s({pubkey:c.marketAsks})),new y.TransactionInstruction({programId:c.programId,keys:g,data:p})}return new y.TransactionInstruction({programId:c.programId,keys:[]})}function En({programId:e,ammId:t,ammAuthority:n,ammOpenOrders:r,lpMint:i,coinMint:l,pcMint:o,coinVault:a,pcVault:c,withdrawQueue:m,ammTargetOrders:p,poolTempLp:g,marketProgramId:A,marketId:w,userWallet:L,userCoinVault:C,userPcVault:ne,userLpVault:re,nonce:Q,openTime:ge,coinAmount:Xt,pcAmount:Zt,ammConfigId:Jt,feeDestinationId:$t}){let ot=S([k("instruction"),k("nonce"),u("openTime"),u("pcAmount"),u("coinAmount")]),en=[{pubkey:F.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:F.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:$t,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:L,isSigner:!0,isWritable:!0},{pubkey:C,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!0},{pubkey:re,isSigner:!1,isWritable:!0}],it=Buffer.alloc(ot.span);return ot.encode({instruction:1,nonce:Q,openTime:ge,coinAmount:Xt,pcAmount:Zt},it),{instruction:new y.TransactionInstruction({keys:en,programId:e,data:it}),instructionType:ae.AmmV4CreatePool}}function Vn(e){let t=S([k("instruction"),k("simulateType")]),n=Buffer.alloc(t.span);t.encode({instruction:12,simulateType:0},n);let r=[s({pubkey:new y.PublicKey(e.id),isWritable:!1}),s({pubkey:new y.PublicKey(e.authority),isWritable:!1}),s({pubkey:new y.PublicKey(e.openOrders),isWritable:!1}),s({pubkey:new y.PublicKey(e.vault.A),isWritable:!1}),s({pubkey:new y.PublicKey(e.vault.B),isWritable:!1}),s({pubkey:new y.PublicKey(e.mintLp.address),isWritable:!1}),s({pubkey:new y.PublicKey(e.marketId),isWritable:!1}),s({pubkey:new y.PublicKey(e.marketEventQueue),isWritable:!1})];return new y.TransactionInstruction({programId:new y.PublicKey(e.programId),keys:r,data:n})}function _t({poolKeys:e,userKeys:t,amountIn:n,minAmountOut:r,modelDataPubKey:i=H},l){let o=G(e),a=Buffer.alloc(xe.span);xe.encode({instruction:9,amountIn:P(n),minAmountOut:P(r)},a);let c=[s({pubkey:F.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:o.id}),s({pubkey:o.authority,isWritable:!1}),s({pubkey:o.openOrders})];return l===4&&c.push(s({pubkey:o.targetOrders})),c.push(s({pubkey:o.vault.A}),s({pubkey:o.vault.B})),l===5&&c.push(s({pubkey:i})),c.push(s({pubkey:o.marketProgramId,isWritable:!1}),s({pubkey:o.marketId}),s({pubkey:o.marketBids}),s({pubkey:o.marketAsks}),s({pubkey:o.marketEventQueue}),s({pubkey:o.marketBaseVault}),s({pubkey:o.marketQuoteVault}),s({pubkey:o.marketAuthority,isWritable:!1}),s({pubkey:t.tokenAccountIn}),s({pubkey:t.tokenAccountOut}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})),new y.TransactionInstruction({programId:o.programId,keys:c,data:a})}function Ot({poolKeys:e,userKeys:t,maxAmountIn:n,amountOut:r,modelDataPubKey:i=H},l){let o=G(e),a=Buffer.alloc(Pe.span);Pe.encode({instruction:11,maxAmountIn:P(n),amountOut:P(r)},a);let c=[s({pubkey:F.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:o.id}),s({pubkey:o.authority,isWritable:!1}),s({pubkey:o.openOrders}),s({pubkey:o.targetOrders}),s({pubkey:o.vault.A}),s({pubkey:o.vault.B})];return l===5&&c.push(s({pubkey:i})),c.push(s({pubkey:o.marketProgramId,isWritable:!1}),s({pubkey:o.marketId}),s({pubkey:o.marketBids}),s({pubkey:o.marketAsks}),s({pubkey:o.marketEventQueue}),s({pubkey:o.marketBaseVault}),s({pubkey:o.marketQuoteVault}),s({pubkey:o.marketAuthority,isWritable:!1}),s({pubkey:t.tokenAccountIn}),s({pubkey:t.tokenAccountOut}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})),new y.TransactionInstruction({programId:o.programId,keys:c,data:a})}function vn(e){let{poolKeys:t,version:n,userKeys:r,amountIn:i,amountOut:l,fixedSide:o}=e;if(n===4||n===5){let a={poolKeys:t,userKeys:r};if(o==="in")return _t(R(K({},a),{amountIn:i,minAmountOut:l}),n);if(o==="out")return Ot(R(K({},a),{maxAmountIn:i,amountOut:l}),n);Dt.logWithError("invalid params","params",e)}throw Dt.logWithError("invalid version","poolKeys.version",n),new Error("invalid version")}function Fn({poolKeys:e,userKeys:t,startTime:n}){let r=Buffer.alloc(we.span);we.encode({instruction:0,nonce:5,startTime:P(n)},r);let i=G(e),l=[s({pubkey:F.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:y.SystemProgram.programId,isWritable:!1}),s({pubkey:y.SYSVAR_RENT_PUBKEY,isWritable:!1}),s({pubkey:i.id}),s({pubkey:i.authority,isWritable:!1}),s({pubkey:i.openOrders}),s({pubkey:i.mintLp.address}),s({pubkey:i.mintA.address,isWritable:!1}),s({pubkey:i.mintB.address,isWritable:!1}),s({pubkey:i.vault.A,isWritable:!1}),s({pubkey:i.vault.B,isWritable:!1}),s({pubkey:i.id}),s({pubkey:i.targetOrders}),s({pubkey:t.lpTokenAccount}),s({pubkey:i.id,isWritable:!1}),s({pubkey:i.marketProgramId,isWritable:!1}),s({pubkey:i.marketId,isWritable:!1}),s({pubkey:t.payer,isSigner:!0})];return new y.TransactionInstruction({programId:i.programId,keys:l,data:r})}function $e({poolKeys:e}){let t=S([k("instruction"),k("simulateType")]),n=Buffer.alloc(t.span);t.encode({instruction:12,simulateType:0},n);let r=[s({pubkey:new y.PublicKey(e.id),isWritable:!1}),s({pubkey:new y.PublicKey(e.authority),isWritable:!1}),s({pubkey:new y.PublicKey(e.openOrders),isWritable:!1}),s({pubkey:new y.PublicKey(e.vault.A),isWritable:!1}),s({pubkey:new y.PublicKey(e.vault.B),isWritable:!1}),s({pubkey:new y.PublicKey(e.mintLp.address),isWritable:!1}),s({pubkey:new y.PublicKey(e.marketId),isWritable:!1}),s({pubkey:new y.PublicKey(e.marketEventQueue),isWritable:!1})];return{instruction:new y.TransactionInstruction({programId:new y.PublicKey(e.programId),keys:r,data:n})}}var Et=require("@solana/web3.js");var Wn=B("Raydium_liquidity_serum");function Vt({programId:e,marketId:t}){let n=[t.toBuffer()],r=0,i;for(;r<100;){try{let l=n.concat(Buffer.from([r]),Buffer.alloc(7));i=Et.PublicKey.createProgramAddressSync(l,e)}catch(l){if(l instanceof TypeError)throw l;r++;continue}return{publicKey:i,nonce:r}}throw Wn.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),new Error("unable to find a viable program address nonce")}var z=5e4,vt=S([u("x"),u("y"),u("price")]),Ft=S([u("accountType"),u("status"),u("multiplier"),u("validDataCount"),ie(vt,z,"DataElement")]);function qn(e,t){return[0,z-2]}function Un(e){return[0,z-2]}function Gn(e){return[0,z-2]}function Hn(e,t,n){let[r,i]=qn(t,n),l=r,o=i,a=0,c=t*e.multiplier/n;for(;l<=o;){if(a=Math.floor((o+l)/2),a===0||a>=z-2)return[a,a,!1];let m=e.DataElement[a].x*e.multiplier/e.DataElement[a].y,p=e.DataElement[a-1].x*e.multiplier/e.DataElement[a-1].y,g=e.DataElement[a+1].x*e.multiplier/e.DataElement[a+1].y;if(c===m)return[a,a,!0];if(c===p)return[a-1,a-1,!0];if(c===g)return[a+1,a+1,!0];if(c<p)o=a-1;else{if(c>p&&c<m)return[a-1,a,!0];if(c>m&&c<g)return[a,a+1,!0];l=a+1}}return[a,a,!1]}function et(e,t,n){let[r,i,l]=Hn(e,t,n);if(!l)return 0;if(r===i){let o=e.DataElement[r].x;return t*e.multiplier/o}else{let o=e.DataElement[r].x,a=e.DataElement[r].y,c=e.DataElement[i].x,m=e.DataElement[i].y,p=n*(c*a-o*m),g=o*p,A=(c-o)*(t*a-o*n)*m,w=g+A;return t*e.multiplier*p/w}}function j(e,t,n){return t*e.multiplier/n}function Wt(e,t,n){return t*n/e.multiplier}function jn(e,t){let[n,r]=Un(t),i=n,l=r,o=0,a=t;for(;i<l;){if(o=Math.floor((l+i)/2),o<=0||o>z-2)return[o,o,!1];let c=e.DataElement[o].x,m=e.DataElement[o-1].x,p=e.DataElement[o+1].x;if(a===c)return[o,o,!0];if(a===m)return[o-1,o-1,!0];if(a===p)return[o+1,o+1,!0];if(a<m)l=o-1;else{if(a>m&&a<c)return[o-1,o,!0];if(a>c&&a<p)return[o,o+1,!0];i=o+1}}return[o,o,!1]}function zn(e,t){let[n,r]=Gn(t),i=n,l=r,o=0,a=t;for(;i<=l;){if(o=Math.floor((l+i)/2),o<=0||o>=z-2)return[o,o,!1];let c=e.DataElement[o].y,m=e.DataElement[o-1].y,p=e.DataElement[o+1].y;if(a===c)return[o,o,!0];if(a===m)return[o-1,o-1,!0];if(a===p)return[o+1,o+1,!0];if(a<p)i=o+1;else{if(a<m&&a>c)return[o-1,o,!0];if(a<c&&a>p)return[o,o+1,!0];l=o-1}}return[o,o,!1]}function qt(e,t,n,r){let i=r?t+n:t-n,[l,o,a]=jn(e,i);if(!a)return[0,0,!1,a];if(l===o)return[e.DataElement[o].price,e.DataElement[o].y,!1,a];{let c=e.DataElement[l].x,m=e.DataElement[o].x,p=e.DataElement[l].price,g=e.DataElement[o].price,A=e.DataElement[l].y,w=e.DataElement[o].y;if(t>=c&&t<=m)return r?[g,w,!0,a]:[p,A,!0,a];{let L,C;return r?(L=p+(g-p)*(t-c)/(m-c),C=A-(i-c)*e.multiplier/g):(L=p+(g-p)*(t-c)/(m-c),C=w+(m-i)*e.multiplier/p),[L,C,!1,a]}}}function Qn(e,t,n,r){let i=r?t-n:t+n,[l,o,a]=zn(e,i);if(!a)return[0,0,!1,a];if(l===o)return[e.DataElement[o].price,e.DataElement[o].x,!1,a];{let c=e.DataElement[l].x,m=e.DataElement[o].x,p=e.DataElement[l].price,g=e.DataElement[o].price,A=e.DataElement[l].y,w=e.DataElement[o].y;if(t>=w&&t<=A)return r?[g,m,!0,a]:[p,c,!0,a];{let L,C;return r?(L=p+(g-p)*(A-t)/(A-w),C=c+g*(A-i)/e.multiplier):(L=p+(g-p)*(A-t)/(A-w),C=m-p*(i-w)/e.multiplier),[L,C,!1,a]}}}function Yn(e,t){let n=qt(e,t,0,!1);return n[3]?n[0]:0}function Xn(e,t,n,r){let i=et(e,t,n),l=j(e,t,i),o=j(e,n,i),a=j(e,r,i),c=!0,[m,p,g,A]=qt(e,l,a,c);if(!A)return 0;if(g)return r*e.multiplier/m;{let w=o-p;return Wt(e,w,i)}}function Zn(e,t,n,r){let i=et(e,t,n),l=j(e,t,i),o=j(e,n,i),a=j(e,r,i),c=!1,[m,p,g,A]=Qn(e,o,a,c);if(!A)return 0;if(g)return r*m/e.multiplier;{let w=l-p;return Wt(e,w,i)}}function Ut(e){let t=Ft.decode(e);return{accountType:t.accountType.toNumber(),status:t.status.toNumber(),multiplier:t.multiplier.toNumber(),validDataCount:t.validDataCount.toNumber(),DataElement:t.DataElement.map(n=>({x:n.x.toNumber(),y:n.y.toNumber(),price:n.price.toNumber()}))}}function Jn(e,t,n,r){let i=Yn(e,j(e,t,et(e,t,n)))/e.multiplier;return r?i:1/i}var fe=class{constructor({connection:t,modelDataPubKey:n=H}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=t,this.modelDataPubKey=n}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let t=await this.connection.getAccountInfo(this.modelDataPubKey);t&&(this._layoutData=Ut(t==null?void 0:t.data))}}};var be=S([h("mint"),h("owner"),u("amount"),U("delegateOption"),h("delegate"),k("state"),U("isNativeOption"),u("isNative"),u("delegatedAmount"),U("closeAuthorityOption"),h("closeAuthority")]);var Gt=require("@solana/web3.js"),$n=I(require("bn.js"));var er=require("@solana/spl-token");var wa=B("Raydium_Util");var Ht=require("@solana/web3.js"),tr=I(require("bn.js"));var Ne=require("@solana/spl-token");var jt=S([U("mintAuthorityOption"),h("mintAuthority"),u("supply"),k("decimals"),k("isInitialized"),U("freezeAuthorityOption"),h("freezeAuthority")]);function rt({programId:e}){let{publicKey:t}=X([Buffer.from("amm_config_account_seed","utf-8")],e);return t}function q({name:e,programId:t,marketId:n}){let{publicKey:r}=X([t.toBuffer(),n.toBuffer(),Buffer.from(e,"utf-8")],t);return r}function Qt({programId:e,marketId:t}){let{publicKey:n}=X([e.toBuffer(),t.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],e);return n}function Yt({programId:e}){return X([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],e)}function nr({version:e,marketVersion:t,marketId:n,baseMint:r,quoteMint:i,baseDecimals:l,quoteDecimals:o,programId:a,marketProgramId:c}){let m=q({name:"amm_associated_seed",programId:a,marketId:n}),p=q({name:"lp_mint_associated_seed",programId:a,marketId:n}),{publicKey:g,nonce:A}=Yt({programId:a}),w=q({name:"coin_vault_associated_seed",programId:a,marketId:n}),L=q({name:"pc_vault_associated_seed",programId:a,marketId:n}),C=q({name:"temp_lp_token_associated_seed",programId:a,marketId:n}),ne=Qt({programId:a,marketId:n}),re=q({name:"target_associated_seed",programId:a,marketId:n}),Q=q({name:"withdraw_associated_seed",programId:a,marketId:n}),{publicKey:ge}=Vt({programId:c,marketId:n});return{id:m,baseMint:r,quoteMint:i,lpMint:p,baseDecimals:l,quoteDecimals:o,lpDecimals:l,version:e,programId:a,authority:g,nonce:A,baseVault:w,quoteVault:L,lpVault:C,openOrders:ne,targetOrders:re,withdrawQueue:Q,marketVersion:t,marketProgramId:c,marketId:n,marketAuthority:ge,lookupTableAccount:te.PublicKey.default,configId:rt({programId:a})}}var tt;async function rr({connection:e,poolKeysList:t,config:n,modelDataPubKey:r}){return t.find(l=>l.modelDataAccount)&&(tt||(tt=new fe({connection:e,modelDataPubKey:r}),await tt.initStableModelLayout())),await Promise.all(t.map(async l=>{if(l.modelDataAccount){let o=$e({poolKeys:l});return(await bt(e,[o.instruction],"GetPoolData")).map(m=>{let p=yt(m,"GetPoolData"),g=new ee.default(E(p,"status")),A=Number(E(p,"coin_decimals")),w=Number(E(p,"pc_decimals")),L=Number(E(p,"lp_decimals")),C=new ee.default(E(p,"pool_coin_amount")),ne=new ee.default(E(p,"pool_pc_amount")),re=new ee.default(E(p,"pool_lp_supply")),Q="0";try{Q=E(p,"pool_open_time")}catch{}return{status:g,baseDecimals:A,quoteDecimals:w,lpDecimals:L,baseReserve:C,quoteReserve:ne,lpSupply:re,startTime:new ee.default(Q)}})[0]}else{let[o,a,c,m]=await e.getMultipleAccountsInfo([new te.PublicKey(l.id),new te.PublicKey(l.vault.A),new te.PublicKey(l.vault.B),new te.PublicKey(l.mintLp.address)]);if(o===null)throw Error("fetch pool error");if(a===null)throw Error("fetch vaultAccA error");if(c===null)throw Error("fetch vaultAccB error");if(m===null)throw Error("fetch mintAccLp error");let p=Ae.decode(o.data),g=be.decode(a.data),A=be.decode(c.data),w=jt.decode(m.data);return{status:p.status,baseDecimals:p.baseDecimal.toNumber(),quoteDecimals:p.quoteDecimal.toNumber(),lpDecimals:w.decimals,baseReserve:g.amount.sub(p.baseNeedTakePnl),quoteReserve:A.amount.sub(p.quoteNeedTakePnl),lpSupply:p.lpReserve,startTime:p.poolOpenTime}}}))}var nt={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},or=e=>{let t={},n=zt.TOKEN_PROGRAM_ID.toBase58();return Object.keys(e).map(r=>{let i=e[r],[l,o]=[i.baseMint.toBase58(),i.quoteMint.toBase58()];t[r]={id:r,version:4,status:i.status.toNumber(),programId:i.programId.toBase58(),mintA:Ke({address:l,programId:n,decimals:i.baseDecimal.toNumber()}),mintB:Ke({address:o,programId:n,decimals:i.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:i.poolPrice.toNumber(),mintAmountA:new ye.default(i.mintAAmount.toString()).div(10**i.baseDecimal.toNumber()).toNumber(),mintAmountB:new ye.default(i.mintBAmount.toString()).div(10**i.quoteDecimal.toNumber()).toNumber(),baseReserve:i.baseReserve,quoteReserve:i.quoteReserve,feeRate:new ye.default(i.tradeFeeNumerator.toString()).div(i.tradeFeeDenominator.toString()).toNumber(),openTime:i.poolOpenTime.toString(),tvl:0,day:nt,week:nt,month:nt,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:i.marketId.toBase58(),configId:rt({programId:i.programId}).toBase58(),lpPrice:0,lpAmount:new ye.default(i.lpReserve.toString()).div(10**Math.min(i.baseDecimal.toNumber(),i.quoteDecimal.toNumber())).toNumber(),lpMint:Ke({address:i.lpMint.toBase58(),programId:n,decimals:Math.min(i.baseDecimal.toNumber(),i.quoteDecimal.toNumber())}),burnPercent:0}}),t};0&&(module.exports={DataElement,LIQUIDITY_FEES_DENOMINATOR,LIQUIDITY_FEES_NUMERATOR,LIQUIDITY_VERSION_TO_SERUM_VERSION,LIQUIDITY_VERSION_TO_STATE_LAYOUT,StableLayout,addLiquidityLayout,createPoolFeeLayout,createPoolV4InstructionV2,createPoolV4Layout,fetchMultipleInfo,fixedSwapInLayout,fixedSwapOutLayout,formatLayout,getAssociatedConfigId,getAssociatedOpenOrders,getAssociatedPoolKeys,getDxByDyBaseIn,getDyByDxBaseIn,getLiquidityAssociatedAuthority,getLiquidityAssociatedId,getStablePrice,initPoolLayout,liquidityStateV4Layout,liquidityStateV5Layout,makeAMMSwapInstruction,makeAddLiquidityInstruction,makeInitPoolInstructionV4,makeSimulatePoolInfoInstruction,makeSwapFixedInInstruction,makeSwapFixedOutInstruction,modelDataInfoLayout,removeLiquidityInstruction,removeLiquidityLayout,simulatePoolInfoInstruction,toAmmComputePoolInfo});
//# sourceMappingURL=index.js.map