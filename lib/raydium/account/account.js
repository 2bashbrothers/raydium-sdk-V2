var cn=Object.create;var he=Object.defineProperty,un=Object.defineProperties,ln=Object.getOwnPropertyDescriptor,pn=Object.getOwnPropertyDescriptors,mn=Object.getOwnPropertyNames,Me=Object.getOwnPropertySymbols,dn=Object.getPrototypeOf,Qe=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable;var xt=(n,e,t)=>e in n?he(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,F=(n,e)=>{for(var t in e||(e={}))Qe.call(e,t)&&xt(n,t,e[t]);if(Me)for(var t of Me(e))Tt.call(e,t)&&xt(n,t,e[t]);return n},ne=(n,e)=>un(n,pn(e));var se=(n,e)=>{var t={};for(var r in n)Qe.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Me)for(var r of Me(n))e.indexOf(r)<0&&Tt.call(n,r)&&(t[r]=n[r]);return t};var fn=(n,e)=>{for(var t in e)he(n,t,{get:e[t],enumerable:!0})},wt=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of mn(e))!Qe.call(n,o)&&o!==t&&he(n,o,{get:()=>e[o],enumerable:!(r=ln(e,o))||r.enumerable});return n};var q=(n,e,t)=>(t=n!=null?cn(dn(n)):{},wt(e||!n||!n.__esModule?he(t,"default",{value:n,enumerable:!0}):t,n)),gn=n=>wt(he({},"__esModule",{value:!0}),n);var En={};fn(En,{default:()=>Ze});module.exports=gn(En);var pe=require("@solana/web3.js");var At=require("@solana/web3.js");var ye=require("lodash");var Ye=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Pt={},hn={};function G(n){let e=(0,ye.get)(Pt,n);if(!e){let t=(0,ye.get)(hn,n);e=new Ye({name:n,logLevel:t}),(0,ye.set)(Pt,n,e)}return e}var Ke=require("@solana/spl-token"),$e=G("Raydium_accountInfo_util");async function kt(n,e,t){let{batchRequest:r,commitment:o="confirmed",chunkCount:a=100}=F({batchRequest:!1},t),i=et(e,a),s=new Array(i.length).fill([]);if(r){let f=i.map(l=>{let h=n._buildArgs([l.map(y=>y.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:h}}),p=et(f,10);s=(await(await Promise.all(p.map(async l=>await n._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&$e.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(h=>{if(h){let{data:y,executable:c,lamports:x,owner:g,rentEpoch:R}=h;return y.length!==2&&y[1]!=="base64"&&$e.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(y[0],"base64"),executable:c,lamports:x,owner:new At.PublicKey(g),rentEpoch:R}}return null})))}else try{s=await Promise.all(i.map(f=>n.getMultipleAccountsInfo(f,o)))}catch(f){f instanceof Error&&$e.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return s.flat()}var $=q(require("bn.js")),In=q(require("decimal.js"));var Ct=q(require("big.js")),wn=q(require("bn.js"));var St=q(require("toformat")),yn=St.default,be=yn;var xe=q(require("big.js")),Bt=q(require("bn.js")),Lt=q(require("decimal.js-light"));var me=q(require("bn.js"));var It=9007199254740991;function X(n){let e=G("Raydium_parseBigNumberish");if(n instanceof me.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new me.default(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=It||n<=-It)&&e.logWithError(`BigNumberish number overflow: ${n}`),new me.default(String(n))):typeof n=="bigint"?new me.default(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new me.default(0))}var Ee=G("module/fraction"),tt=be(xe.default),Te=be(Lt.default),xn={[0]:Te.ROUND_DOWN,[1]:Te.ROUND_HALF_UP,[2]:Te.ROUND_UP},Tn={[0]:xe.default.roundDown,[1]:xe.default.roundHalfUp,[2]:xe.default.roundUp},O=class{constructor(e,t=new Bt.default(1)){this.numerator=X(e),this.denominator=X(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new O(this.denominator,this.numerator)}add(e){let t=e instanceof O?e:new O(X(e));return this.denominator.eq(t.denominator)?new O(this.numerator.add(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof O?e:new O(X(e));return this.denominator.eq(t.denominator)?new O(this.numerator.sub(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof O?e:new O(X(e));return new O(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof O?e:new O(X(e));return new O(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||Ee.logWithError(`${e} is not an integer.`),e<=0&&Ee.logWithError(`${e} is not positive.`),Te.set({precision:e+1,rounding:xn[r]});let o=new Te(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||Ee.logWithError(`${e} is not an integer.`),e<0&&Ee.logWithError(`${e} is negative.`),tt.DP=e,tt.RM=Tn[r]||1,new tt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var cr=G("Raydium_amount"),ur=be(Ct.default);var Rt=require("@solana/web3.js"),nt=require("@solana/spl-token"),_t={chainId:101,address:Rt.PublicKey.default.toBase58(),programId:nt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},re={chainId:101,address:"So11111111111111111111111111111111111111112",programId:nt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Oe=require("@solana/web3.js");var K=require("@solana/web3.js"),Dt=require("@solana/spl-token");function rt({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var dr=[rt({pubkey:Dt.TOKEN_PROGRAM_ID,isWritable:!1}),rt({pubkey:K.SystemProgram.programId,isWritable:!1}),rt({pubkey:K.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Nt({publicKey:n,transformSol:e}){let t=Mt(n.toString());if(t instanceof K.PublicKey)return e&&t.equals(we)?ie:t;if(e&&t.toString()===we.toBase58())return ie;if(typeof t=="string"){if(t===K.PublicKey.default.toBase58())return K.PublicKey.default;try{return new K.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Mt(n){try{return new K.PublicKey(n)}catch{return n}}var fr=new K.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),gr=new K.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),hr=new K.PublicKey("SysvarRent111111111111111111111111111111111"),yr=new K.PublicKey("SysvarC1ock11111111111111111111111111111111"),br=new K.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),xr=new K.PublicKey("Sysvar1nstructions1111111111111111111111111"),Tr=K.SystemProgram.programId,wr=new K.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Pr=new K.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ar=new K.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),kr=new K.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Sr=new K.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ir=new K.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Br=new K.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Lr=new K.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Cr=new K.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Rr=new K.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),_r=new K.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ie=new K.PublicKey("So11111111111111111111111111111111111111112"),we=K.PublicKey.default;var ot=class{constructor({mint:e,decimals:t,symbol:r,name:o,skipMint:a=!1,isToken2022:i=!1}){if(e===we.toBase58()||e instanceof Oe.PublicKey&&we.equals(e)){this.decimals=re.decimals,this.symbol=re.symbol,this.name=re.name,this.mint=new Oe.PublicKey(re.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=a?Oe.PublicKey.default:Nt({publicKey:e}),this.isToken2022=i}equals(e){return this===e?!0:this.mint.equals(e.mint)}},de=ot;de.WSOL=new ot(ne(F({},re),{mint:re.address}));var st=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Fe=st;Fe.SOL=new st(_t);var Kt=q(require("bn.js"));var Wr=new O(new Kt.default(100));var zr=G("Raydium_price");var kn=require("@solana/web3.js"),Sn=q(require("bn.js"));var An=new $.default(0),So=new $.default(1),Io=new $.default(2),Bo=new $.default(3),Lo=new $.default(5),Pn=new $.default(10),Co=new $.default(100),Ro=new $.default(1e3),_o=new $.default(1e4);function et(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var ee=class{constructor(e){this._owner=e}get publicKey(){return ee.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return ee.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return ee.isKeyPair(this._owner)}get isPublicKey(){return ee.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!ee.isKeyPair(e)}};var qt=require("@solana/web3.js"),Gt=require("@solana/spl-token");var H=require("@solana/web3.js");var V={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Vt=require("@solana/spl-token"),vt=G("Raydium_txUtil"),Wt=1644;function Pe(n){let e=[],t=[];return n.microLamports&&(e.push(H.ComputeBudgetProgram.setComputeUnitPrice({microLamports:n.microLamports})),t.push(V.SetComputeUnitPrice)),n.units&&(e.push(H.ComputeBudgetProgram.setComputeUnitLimit({units:n.units})),t.push(V.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function le(n,e){var r,o;let t=e!=null?e:"confirmed";return(o=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:o.blockhash}async function Ae(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let o=setTimeout(r,6e4);n.onSignature(e,a=>{if(clearTimeout(o),!a.err){t("");return}r(Object.assign(a.err,{txId:e}))},"confirmed")})}function Bn(n,e){n.length<1&&vt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&vt.logWithError(`no signers provided:, ${e.toString()}`);let t=new H.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Wt}catch{return!1}}function Ut(n,e){let[t,r]=H.PublicKey.findProgramAddressSync(n,e);return{publicKey:t,nonce:r}}function ke({instructions:n,payer:e,signers:t}){return Bn(n,[e,...t])}function oe({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=H.Keypair.generate().publicKey.toString()}){let a=new H.TransactionMessage({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new H.VersionedTransaction(a).serialize()).toString("base64").length<Wt}catch{return!1}}var Ln=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Cn=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof H.VersionedTransaction&&(e=Ln(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ae(n){let e=[];return n.forEach(t=>{t instanceof H.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Vt.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=H.Keypair.generate().publicKey)),e.push(Cn(t))}),console.log("simulate tx string:",e),e}function Se(n,e,t){return Ut([n.toBuffer(),(t!=null?t:Gt.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new qt.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var w=require("@solana/web3.js"),zo=new w.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Jo=new w.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Zo=new w.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Xo=new w.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Qo=new w.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Yo=new w.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),$o=new w.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),es=new w.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ts=new w.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ns=new w.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),rs=new w.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),os=new w.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ss=new w.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),is=new w.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),as=new w.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),cs=new w.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),us=new w.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ls=new w.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ps=new w.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ms=new w.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ds=new w.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),fs=new w.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),gs=new w.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),hs=new w.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ys=new w.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),bs=new w.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),xs=new w.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ts=new w.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),ws=new w.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ps=new w.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),As=new w.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ks={OPEN_BOOK_PROGRAM:new w.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new w.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new w.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new w.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new w.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new w.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new w.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new w.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new w.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new w.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new w.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new w.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:w.PublicKey.default,Router:new w.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new w.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new w.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new w.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new w.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new w.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new w.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new w.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new w.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new w.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new w.PublicKey("Ray1111111111111111111111111111111111111111")};var Rn=q(require("bn.js"));var Q=require("@solana/web3.js");async function ve({connection:n,address:e,cluster:t="mainnet"}){let r=await kt(n,[...new Set(e.map(a=>a.toString()))].map(a=>new Q.PublicKey(a))),o={};for(let a=0;a<e.length;a++){let i=r[a],s=e[a];if(!i)continue;let f=new Q.AddressLookupTableAccount({key:s,state:Q.AddressLookupTableAccount.deserialize(i.data)});o[s.toString()]=f,t==="devnet"?fe[s.toString()]=f:Ie[s.toString()]=f}return o}var Ie={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Q.AddressLookupTableAccount({key:new Q.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Q.AddressLookupTableAccount.deserialize(Buffer.from("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","base64"))})},fe={},Ve=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(fe[e])return fe;let t=new Q.PublicKey(e),r=await n.getAccountInfo(t);return r&&(fe[e]=new Q.AddressLookupTableAccount({key:t,state:Q.AddressLookupTableAccount.deserialize(r.data)})),fe};var C=require("@solana/web3.js"),Ht=q(require("axios"));var Be=2e3,Le=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await Ht.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Pe(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(C.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new C.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(V.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:o=[],endInstructionTypes:a=[],lookupTableAddress:i=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...o),this.endInstructionTypes.push(...a),this.lookupTableAddress.push(...i.filter(s=>s!==C.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(F({},t||{})):this.build(t)}build(e){var r;let t=new C.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var b;let{recentBlockHash:a,skipPreflight:i=!0,sendAndConfirm:s,notSendToRpc:f}=o||{},p=a!=null?a:await le(this.connection,this.blockhashCommitment);if(t.recentBlockhash=p,this.signers.length&&t.sign(...this.signers),ae([t]),(b=this.owner)!=null&&b.isKeyPair)return{txId:s?await(0,C.sendAndConfirmTransaction)(this.connection,t,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:i}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:i}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);if(this.signers.length)for(let h of l)try{h.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:i}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var p;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:o}=this.build(r),a=t.filter(b=>b.transaction.instructions.length>0),i=[o,...a.map(b=>b.transaction)],s=[this.signers,...a.map(b=>b.signers)],f=[...this.instructionTypes,...a.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&s.forEach(b=>{b.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:i,signers:s,instructionTypes:f,execute:async b=>{var R;let{sequentially:l,onTxUpdate:h,skipTxCount:y=0,recentBlockHash:c,skipPreflight:x=!0}=b||{},g=c!=null?c:await le(this.connection,this.blockhashCommitment);if((R=this.owner)!=null&&R.isKeyPair){if(l){let k=[],S=0;for(let m of i){if(++S,S<=y)continue;let u=await(0,C.sendAndConfirmTransaction)(this.connection,m,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});k.push(u)}return{txIds:k,signedTxs:i}}return{txIds:await await Promise.all(i.map(async k=>(k.recentBlockhash=g,await this.connection.sendRawTransaction(k.serialize(),{skipPreflight:x})))),signedTxs:i}}if(this.signAllTransactions){let k=i.map((m,u)=>(m.recentBlockhash=g,s[u].length&&m.sign(...s[u]),m));ae(k);let S=await this.signAllTransactions(k);if(l){let m=0,u=[],d=async()=>{if(!S[m])return;let P=await this.connection.sendRawTransaction(S[m].serialize(),{skipPreflight:x});u.push({txId:P,status:"sent",signedTx:S[m]}),h==null||h([...u]),m++;let T=!1,B=null,M=null,N=I=>{B!==null&&clearInterval(B),M!==null&&this.connection.removeSignatureListener(M);let L=u.findIndex(_=>_.txId===P);if(L>-1){if(u[L].status==="error"||u[L].status==="success")return;u[L].status=I.err?"error":"success"}h==null||h([...u]),I.err||d()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var I;if(T){clearInterval(B);return}try{let L=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(T=!0,clearInterval(B),N({err:((I=L.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",P))}catch(L){T=!0,clearInterval(B),console.error("getTransaction timeout:",L,P)}},Be)),M=this.connection.onSignature(P,I=>{if(T){this.connection.removeSignatureListener(M);return}T=!0,N(I)},"confirmed"),this.connection.getSignatureStatus(P)};return await d(),{txIds:u.map(P=>P.txId),signedTxs:S}}else{let m=[];for(let u=0;u<S.length;u+=1){let d=await this.connection.sendRawTransaction(S[u].serialize(),{skipPreflight:x});m.push(d)}return{txIds:m,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var x;let c=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:o,recentBlockhash:a}=c,i=se(c,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),s=F(F({},this.cluster==="devnet"?await Ve(this.connection):Ie),t),f=Array.from(new Set([...r,...this.lookupTableAddress])),p=[];for(let g of f)s[g]===void 0&&p.push(new C.PublicKey(g));let b=await ve({connection:this.connection,address:p});for(let[g,R]of Object.entries(b))s[g]=R;let l=o?C.PublicKey.default.toBase58():a!=null?a:await le(this.connection,this.blockhashCommitment),h=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s));((x=this.owner)==null?void 0:x.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let y=new C.VersionedTransaction(h);return y.sign(this.signers),{builder:this,transaction:y,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var m;let{skipPreflight:R=!0,sendAndConfirm:k,notSendToRpc:S}=g||{};if(ae([y]),(m=this.owner)!=null&&m.isKeyPair){let u=await this.connection.sendTransaction(y,{skipPreflight:R});return k&&await Ae(this.connection,u),{txId:u,signedTx:y}}if(this.signAllTransactions){let u=await this.signAllTransactions([y]);if(this.signers.length)for(let d of u)try{d.sign(this.signers)}catch{}return{txId:S?"":await this.connection.sendTransaction(u[0],{skipPreflight:R}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildV0MultiTx(e){var p;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:o}=await this.buildV0(r),a=t.filter(b=>b.builder.instructions.length>0),i=[o,...a.map(b=>b.transaction)],s=[this.signers,...a.map(b=>b.signers)],f=[...this.instructionTypes,...a.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&s.forEach(b=>{b.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),i.forEach(async(b,l)=>{b.sign(s[l])}),{builder:this,transactions:i,signers:s,instructionTypes:f,buildProps:r,execute:async b=>{var x;let{sequentially:l,onTxUpdate:h,recentBlockHash:y,skipPreflight:c=!0}=b||{};if(y&&i.forEach(g=>g.message.recentBlockhash=y),ae(i),(x=this.owner)!=null&&x.isKeyPair){if(l){let g=[];for(let R of i){let k=await this.connection.sendTransaction(R,{skipPreflight:c});await Ae(this.connection,k),g.push(k)}return{txIds:g,signedTxs:i}}return{txIds:await Promise.all(i.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:c}))),signedTxs:i}}if(this.signAllTransactions){let g=await this.signAllTransactions(i);if(l){let R=0,k=[],S=async()=>{if(!g[R])return;let m=await this.connection.sendTransaction(g[R],{skipPreflight:c});k.push({txId:m,status:"sent",signedTx:g[R]}),h==null||h([...k]),R++;let u=!1,d=null,P=null,T=B=>{d!==null&&clearInterval(d),P!==null&&this.connection.removeSignatureListener(P);let M=k.findIndex(N=>N.txId===m);if(M>-1){if(k[M].status==="error"||k[M].status==="success")return;k[M].status=B.err?"error":"success"}h==null||h([...k]),B.err||S()};this.loopMultiTxStatus&&(d=setInterval(async()=>{var B;if(u){clearInterval(d);return}try{let M=await this.connection.getTransaction(m,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(u=!0,clearInterval(d),T({err:((B=M.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",m))}catch(M){u=!0,clearInterval(d),console.error("getTransaction timeout:",M,m)}},Be)),P=this.connection.onSignature(m,B=>{if(u){this.connection.removeSignatureListener(P);return}u=!0,T(B)},"confirmed"),this.connection.getSignatureStatus(m)};return S(),{txIds:[],signedTxs:g}}else{let R=[];for(let k=0;k<g.length;k+=1){let S=await this.connection.sendTransaction(g[k],{skipPreflight:c});R.push(S)}return{txIds:R,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var h;let l=e||{},{splitIns:t=[],computeBudgetConfig:r}=l,o=se(l,["splitIns","computeBudgetConfig"]),a=r?Pe(r):{instructions:[],instructionTypes:[]},i=this.signers.reduce((y,c)=>ne(F({},y),{[c.publicKey.toBase58()]:c}),{}),s=[],f=[],p=[],b=0;if(this.allInstructions.forEach(y=>{let c=[...p,y],x=r?[...a.instructions,...c]:c,R=[...new Set(c.map(k=>k.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(k=>new C.PublicKey(k));if(y!==t[b]&&p.length<12&&(ke({instructions:x,payer:this.feePayer,signers:R})||ke({instructions:c,payer:this.feePayer,signers:R})))p.push(y);else{if(p.length===0)throw Error("item ins too big");b+=y===t[b]?1:0,ke({instructions:r?[...a.instructions,...p]:[...p],payer:this.feePayer,signers:R})?s.push(new C.Transaction().add(...a.instructions,...p)):s.push(new C.Transaction().add(...p)),f.push(Array.from(new Set(p.map(k=>k.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(k=>i[k]).filter(k=>k!==void 0)),p=[y]}}),p.length>0){let c=[...new Set(p.map(x=>x.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(x=>i[x]).filter(x=>x!==void 0);ke({instructions:r?[...a.instructions,...p]:[...p],payer:this.feePayer,signers:c.map(x=>x.publicKey)})?s.push(new C.Transaction().add(...a.instructions,...p)):s.push(new C.Transaction().add(...p)),f.push(c)}return s.forEach(y=>y.feePayer=this.feePayer),(h=this.owner)!=null&&h.signer&&f.forEach(y=>{y.some(c=>c.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:s,signers:f,instructionTypes:this.instructionTypes,execute:async y=>{var m;let{sequentially:c,onTxUpdate:x,skipTxCount:g=0,recentBlockHash:R,skipPreflight:k=!0}=y||{},S=R!=null?R:await le(this.connection,this.blockhashCommitment);if(s.forEach(async(u,d)=>{u.recentBlockhash=S,f[d].length&&u.sign(...f[d])}),ae(s),(m=this.owner)!=null&&m.isKeyPair){if(c){let u=0,d=[];for(let P of s){if(++u,u<=g){d.push("tx skipped");continue}let T=await(0,C.sendAndConfirmTransaction)(this.connection,P,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:k});d.push(T)}return{txIds:d,signedTxs:s}}return{txIds:await Promise.all(s.map(async u=>await this.connection.sendRawTransaction(u.serialize(),{skipPreflight:k}))),signedTxs:s}}if(this.signAllTransactions){let u=await this.signAllTransactions(s.slice(g,s.length)),d=[...s.slice(0,g),...u];if(c){let P=0,T=[],B=async()=>{if(!d[P])return;P<g&&(T.push({txId:"",status:"success",signedTx:d[P]}),x==null||x([...T]),P++,B());let M=await this.connection.sendRawTransaction(d[P].serialize(),{skipPreflight:k});T.push({txId:M,status:"sent",signedTx:d[P]}),x==null||x([...T]),P++;let N=!1,I=null,L=null,_=W=>{I!==null&&clearInterval(I),L!==null&&this.connection.removeSignatureListener(L);let E=T.findIndex(z=>z.txId===M);if(E>-1){if(T[E].status==="error"||T[E].status==="success")return;T[E].status=W.err?"error":"success"}x==null||x([...T]),W.err||B()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var W;if(N){clearInterval(I);return}try{let E=await this.connection.getTransaction(M,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(N=!0,clearInterval(I),_({err:((W=E.meta)==null?void 0:W.err)||null}),console.log("tx status from getTransaction:",M))}catch(E){N=!0,clearInterval(I),console.error("getTransaction timeout:",E,M)}},Be)),L=this.connection.onSignature(M,W=>{if(N){this.connection.removeSignatureListener(L);return}N=!0,_(W)},"confirmed"),this.connection.getSignatureStatus(M)};return await B(),{txIds:T.map(M=>M.txId),signedTxs:d}}else{let P=[];for(let T=0;T<d.length;T+=1){let B=await this.connection.sendRawTransaction(d[T].serialize(),{skipPreflight:k});P.push(B)}return{txIds:P,signedTxs:d}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var S;let k=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:o={},lookupTableAddress:a=[]}=k,i=se(k,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),s=F(F({},this.cluster==="devnet"?await Ve(this.connection):Ie),o),f=Array.from(new Set([...this.lookupTableAddress,...a])),p=[];for(let m of f)s[m]===void 0&&p.push(new C.PublicKey(m));let b=await ve({connection:this.connection,address:p});for(let[m,u]of Object.entries(b))s[m]=u;let l=t?Pe(t):{instructions:[],instructionTypes:[]},h=await le(this.connection,this.blockhashCommitment),y=this.signers.reduce((m,u)=>ne(F({},m),{[u.publicKey.toBase58()]:u}),{}),c=[],x=[],g=[],R=0;if(this.allInstructions.forEach(m=>{let u=[...g,m],d=t?[...l.instructions,...u]:u;if(m!==r[R]&&g.length<12&&(oe({instructions:d,payer:this.feePayer,lookupTableAddressAccount:s})||oe({instructions:u,payer:this.feePayer,lookupTableAddressAccount:s})))g.push(m);else{if(g.length===0)throw Error("item ins too big");R+=m===r[R]?1:0;let P={};for(let T of[...new Set(f)])s[T]!==void 0&&(P[T]=s[T]);if(t&&oe({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:h})){let T=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(T))}else{let T=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(T))}x.push(Array.from(new Set(g.map(T=>T.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(T=>y[T]).filter(T=>T!==void 0)),g=[m]}}),g.length>0){let u=[...new Set(g.map(d=>d.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(d=>y[d]).filter(d=>d!==void 0);if(t&&oe({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:h})){let d=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(d))}else{let d=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(d))}x.push(u)}return(S=this.owner)!=null&&S.signer&&x.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),c.forEach((m,u)=>{m.sign(x[u])}),{builder:this,transactions:c,buildProps:e,signers:x,blockHash:h,instructionTypes:this.instructionTypes,execute:async m=>{var M;let{sequentially:u,onTxUpdate:d,skipTxCount:P=0,recentBlockHash:T,skipPreflight:B=!0}=m||{};if(c.map(async(N,I)=>{x[I].length&&N.sign(x[I]),T&&(N.message.recentBlockhash=T)}),ae(c),(M=this.owner)!=null&&M.isKeyPair){if(u){let N=0,I=[];for(let L of c){if(++N,N<=P){console.log("skip tx: ",N),I.push("tx skipped");continue}let _=await this.connection.sendTransaction(L,{skipPreflight:B});await Ae(this.connection,_),I.push(_)}return{txIds:I,signedTxs:c}}return{txIds:await Promise.all(c.map(async N=>await this.connection.sendTransaction(N,{skipPreflight:B}))),signedTxs:c}}if(this.signAllTransactions){let N=await this.signAllTransactions(c.slice(P,c.length)),I=[...c.slice(0,P),...N];if(u){let L=0,_=[],W=async()=>{if(!I[L])return;if(L<P){_.push({txId:"",status:"success",signedTx:I[L]}),d==null||d([..._]),L++,W();return}let E=await this.connection.sendTransaction(I[L],{skipPreflight:B});_.push({txId:E,status:"sent",signedTx:I[L]}),d==null||d([..._]),L++;let z=!1,J=null,te=null,ge=j=>{J!==null&&clearInterval(J),te!==null&&this.connection.removeSignatureListener(te);let U=_.findIndex(Xe=>Xe.txId===E);if(U>-1){if(_[U].status==="error"||_[U].status==="success")return;_[U].status=j.err?"error":"success"}d==null||d([..._]),j.err||W()};this.loopMultiTxStatus&&(J=setInterval(async()=>{var j;if(z){clearInterval(J);return}try{let U=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});U&&(z=!0,clearInterval(J),ge({err:((j=U.meta)==null?void 0:j.err)||null}),console.log("tx status from getTransaction:",E))}catch(U){z=!0,clearInterval(J),console.error("getTransaction timeout:",U,E)}},Be)),te=this.connection.onSignature(E,j=>{if(z){this.connection.removeSignatureListener(te);return}z=!0,ge(j)},"confirmed"),this.connection.getSignatureStatus(E)};return W(),{txIds:[],signedTxs:I}}else{let L=[];for(let _=0;_<I.length;_+=1){let W=await this.connection.sendTransaction(I[_],{skipPreflight:B});L.push(W)}return{txIds:L,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildSniperTransaction(e){var S;let k=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:o={},lookupTableAddress:a=[]}=k,i=se(k,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),s=F(F({},this.cluster==="devnet"?await Ve(this.connection):Ie),o),f=Array.from(new Set([...this.lookupTableAddress,...a])),p=[];for(let m of f)s[m]===void 0&&p.push(new C.PublicKey(m));let b=await ve({connection:this.connection,address:p});for(let[m,u]of Object.entries(b))s[m]=u;let l=t?Pe(t):{instructions:[],instructionTypes:[]},h=await le(this.connection,this.blockhashCommitment),y=this.signers.reduce((m,u)=>ne(F({},m),{[u.publicKey.toBase58()]:u}),{}),c=[],x=[],g=[],R=0;if(this.allInstructions.forEach(m=>{let u=[...g,m],d=t?[...l.instructions,...u]:u;if(m!==r[R]&&g.length<12&&(oe({instructions:d,payer:this.feePayer,lookupTableAddressAccount:s})||oe({instructions:u,payer:this.feePayer,lookupTableAddressAccount:s})))g.push(m);else{if(g.length===0)throw Error("item ins too big");R+=m===r[R]?1:0;let P={};for(let T of[...new Set(f)])s[T]!==void 0&&(P[T]=s[T]);if(t&&oe({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:h})){let T=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(T))}else{let T=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(T))}x.push(Array.from(new Set(g.map(T=>T.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(T=>y[T]).filter(T=>T!==void 0)),g=[m]}}),g.length>0){let u=[...new Set(g.map(d=>d.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(d=>y[d]).filter(d=>d!==void 0);if(t&&oe({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:h})){let d=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(d))}else{let d=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(s));c.push(new C.VersionedTransaction(d))}x.push(u)}return(S=this.owner)!=null&&S.signer&&x.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),c.forEach((m,u)=>{m.sign(x[u])}),{builder:this,transactions:c,buildProps:e,signers:x,instructionTypes:this.instructionTypes,execute:async m=>{var M;let{sequentially:u,onTxUpdate:d,skipTxCount:P=0,recentBlockHash:T,skipPreflight:B=!0}=m||{};if(c.map(async(N,I)=>{x[I].length&&N.sign(x[I]),T&&(N.message.recentBlockhash=T)}),ae(c),(M=this.owner)!=null&&M.isKeyPair){if(u){let N=0,I=[];for(let L of c){if(++N,N<=P){console.log("skip tx: ",N),I.push("tx skipped");continue}let _=await this.connection.sendTransaction(L,{skipPreflight:B});await Ae(this.connection,_),I.push(_)}return{txIds:I,signedTxs:c}}return{txIds:await Promise.all(c.map(async N=>await this.connection.sendTransaction(N,{skipPreflight:B}))),signedTxs:c}}if(this.signAllTransactions){let N=await this.signAllTransactions(c.slice(P,c.length)),I=[...c.slice(0,P),...N];if(u){let L=0,_=[],W=async()=>{if(!I[L])return;if(L<P){_.push({txId:"",status:"success",signedTx:I[L]}),d==null||d([..._]),L++,W();return}let E=await this.connection.sendTransaction(I[L],{skipPreflight:B});_.push({txId:E,status:"sent",signedTx:I[L]}),d==null||d([..._]),L++;let z=!1,J=null,te=null,ge=j=>{J!==null&&clearInterval(J),te!==null&&this.connection.removeSignatureListener(te);let U=_.findIndex(Xe=>Xe.txId===E);if(U>-1){if(_[U].status==="error"||_[U].status==="success")return;_[U].status=j.err?"error":"success"}d==null||d([..._]),j.err||W()};this.loopMultiTxStatus&&(J=setInterval(async()=>{var j;if(z){clearInterval(J);return}try{let U=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});U&&(z=!0,clearInterval(J),ge({err:((j=U.meta)==null?void 0:j.err)||null}),console.log("tx status from getTransaction:",E))}catch(U){z=!0,clearInterval(J),console.error("getTransaction timeout:",U,E)}},Be)),te=this.connection.onSignature(E,j=>{if(z){this.connection.removeSignatureListener(te);return}z=!0,ge(j)},"confirmed"),this.connection.getSignatureStatus(E)};return W(),{txIds:[],signedTxs:I}}else{let L=[];for(let _=0;_<I.length;_+=1){let W=await this.connection.sendTransaction(I[_],{skipPreflight:B});L.push(W)}return{txIds:L,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};var jt=q(require("bn.js")),Ws=new jt.default(1e6);var v=require("@solana/spl-token");var it=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ce=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=G(t)}createTxBuilder(e){return this.scope.checkOwner(),new Le({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let r=new ee(e);return new Le({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:r,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(it(e))}logInfo(...e){this.logger.info(it(e))}logAndCreateError(...e){let t=it(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Je=require("@solana/web3.js"),sn=q(require("bn.js"));var Z=require("@solana/spl-token");var De=require("@solana/web3.js"),nn=q(require("bn.js"));var rn=require("@solana/spl-token");function _n(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function at(n,...e){if(!_n(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}function ct(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function zt(n,e){at(n);let t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Ue=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),Y=(n,e)=>n<<32-e|n>>>e;var gi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Dn(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function ut(n){return typeof n=="string"&&(n=Dn(n)),at(n),n}var We=class{clone(){return this._cloneInto()}},hi={}.toString;function Jt(n){let e=r=>n().update(ut(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Nn(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);let o=BigInt(32),a=BigInt(4294967295),i=Number(t>>o&a),s=Number(t&a),f=r?4:0,p=r?0:4;n.setUint32(e+f,i,r),n.setUint32(e+p,s,r)}var Zt=(n,e,t)=>n&e^~n&t,Xt=(n,e,t)=>n&e^n&t^e&t,qe=class extends We{constructor(e,t,r,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ue(this.buffer)}update(e){ct(this);let{view:t,buffer:r,blockLen:o}=this;e=ut(e);let a=e.length;for(let i=0;i<a;){let s=Math.min(o-this.pos,a-i);if(s===o){let f=Ue(e);for(;o<=a-i;i+=o)this.process(f,i);continue}r.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ct(this),zt(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:o,isLE:a}=this,{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)t[l]=0;Nn(r,o-8,BigInt(this.length*8),a),this.process(r,0);let s=Ue(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let p=f/4,b=this.get();if(p>b.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<p;l++)s.setUint32(4*l,b[l],a)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:o,finished:a,destroyed:i,pos:s}=this;return e.length=o,e.pos=s,e.finished=a,e.destroyed=i,o%t&&e.buffer.set(r),e}};var Mn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ce=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ue=new Uint32Array(64),lt=class extends qe{constructor(){super(64,32,8,!1),this.A=ce[0]|0,this.B=ce[1]|0,this.C=ce[2]|0,this.D=ce[3]|0,this.E=ce[4]|0,this.F=ce[5]|0,this.G=ce[6]|0,this.H=ce[7]|0}get(){let{A:e,B:t,C:r,D:o,E:a,F:i,G:s,H:f}=this;return[e,t,r,o,a,i,s,f]}set(e,t,r,o,a,i,s,f){this.A=e|0,this.B=t|0,this.C=r|0,this.D=o|0,this.E=a|0,this.F=i|0,this.G=s|0,this.H=f|0}process(e,t){for(let l=0;l<16;l++,t+=4)ue[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let h=ue[l-15],y=ue[l-2],c=Y(h,7)^Y(h,18)^h>>>3,x=Y(y,17)^Y(y,19)^y>>>10;ue[l]=x+ue[l-7]+c+ue[l-16]|0}let{A:r,B:o,C:a,D:i,E:s,F:f,G:p,H:b}=this;for(let l=0;l<64;l++){let h=Y(s,6)^Y(s,11)^Y(s,25),y=b+h+Zt(s,f,p)+Mn[l]+ue[l]|0,x=(Y(r,2)^Y(r,13)^Y(r,22))+Xt(r,o,a)|0;b=p,p=f,f=s,s=i+y|0,i=a,a=o,o=r,r=y+x|0}r=r+this.A|0,o=o+this.B|0,a=a+this.C|0,i=i+this.D|0,s=s+this.E|0,f=f+this.F|0,p=p+this.G|0,b=b+this.H|0,this.set(r,o,a,i,s,f,p,b)}roundClean(){ue.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Qt=Jt(()=>new lt);var $t=require("@solana/web3.js"),Ge=q(require("bn.js"));var A=require("@solana/buffer-layout"),pt=A.Layout,Yt=A.Structure;var mt=A.UInt;var dt=A.blob;var ft=class extends pt{constructor(t,r,o){super(t,o);this.blob=dt(t),this.signed=r}decode(t,r=0){let o=new Ge.default(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new Ge.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}};function en(n){return new mt(1,n)}function He(n){return new mt(4,n)}function je(n){return new ft(8,!1,n)}var gt=class extends pt{constructor(t,r,o,a){super(t.span,a);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function Re(n){return new gt(dt(32),e=>new $t.PublicKey(e),e=>e.toBuffer(),n)}var ht=class extends Yt{decode(e,t){return super.decode(e,t)}};function tn(n,e,t){return new ht(n,e,t)}var _e=tn([Re("mint"),Re("owner"),je("amount"),He("delegateOption"),Re("delegate"),en("state"),He("isNativeOption"),je("isNative"),je("delegatedAmount"),He("closeAuthorityOption"),Re("closeAuthority")]);var Gi=G("Raydium_Util");function on({owner:n,solAccountResp:e,tokenAccountResp:t}){let r=[],o=[];for(let{pubkey:a,account:i}of t.value){let s=_e.decode(i.data),{mint:f,amount:p}=s;r.push({publicKey:a,mint:f,amount:p,isAssociated:Se(n,f,i.owner).publicKey.equals(a),isNative:!1,programId:i.owner}),o.push({pubkey:a,accountInfo:s,programId:i.owner})}return e&&r.push({mint:De.PublicKey.default,amount:new nn.default(String(e.lamports)),isNative:!0,programId:e.owner}),{tokenAccounts:r,tokenAccountRawInfos:o}}function ze({fromPublicKey:n,programId:e=rn.TOKEN_PROGRAM_ID,assignSeed:t}){let r=t?btoa(t).slice(0,32):De.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:Kn(n,r,e),seed:r}}function Kn(n,e,t){let r=Buffer.concat([n.toBuffer(),Buffer.from(e),t.toBuffer()]),o=Qt(r);return new De.PublicKey(o)}function yt(n){let{mint:e,tokenAccount:t,owner:r,programId:o=Z.TOKEN_PROGRAM_ID}=n;return(0,Z.createInitializeAccountInstruction)(t,e,r,o)}function Ne(n){let{tokenAccount:e,payer:t,multiSigners:r=[],owner:o,programId:a=Z.TOKEN_PROGRAM_ID}=n;return(0,Z.createCloseAccountInstruction)(e,t,o,r,a)}async function bt(n){let{connection:e,amount:t,commitment:r,payer:o,owner:a,skipCloseAccount:i}=n,s=await e.getMinimumBalanceForRentExemption(_e.span,r),f=X(t).add(new sn.default(s)),p=ze({fromPublicKey:o,programId:Z.TOKEN_PROGRAM_ID});return{addresses:{newAccount:p.publicKey},signers:[],instructions:[Je.SystemProgram.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:p.seed,newAccountPubkey:p.publicKey,lamports:f.toNumber(),space:_e.span,programId:Z.TOKEN_PROGRAM_ID}),yt({mint:new Je.PublicKey(re.address),tokenAccount:p.publicKey,owner:a,programId:Z.TOKEN_PROGRAM_ID})],instructionTypes:[V.CreateAccount,V.InitAccount],endInstructionTypes:i?[]:[V.CloseAccount],endInstructions:i?[]:[Ne({tokenAccount:p.publicKey,payer:o,owner:a})]}}function an({source:n,destination:e,owner:t,amount:r,multiSigners:o=[],tokenProgram:a=Z.TOKEN_PROGRAM_ID}){return(0,Z.createTransferInstruction)(n,e,t,BigInt(String(r)),o,a)}var Ze=class extends Ce{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;this._notSubscribeAccountChange=!1;this._accountFetchTime=0;let{tokenAccounts:r,tokenAccountRawInfos:o,notSubscribeAccountChange:a}=t;this._tokenAccounts=r||[],this._tokenAccountRawInfos=o||[],this._notSubscribeAccountChange=a!=null?a:!0,this._clientOwnedToken=!!(r||o)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}set notSubscribeAccountChange(t){this._notSubscribeAccountChange=t}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:r}){return t&&(this._tokenAccounts=t),r&&(this._tokenAccountRawInfos=r),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(r=>r!==t),this}getAssociatedTokenAccount(t,r){return Se(this.scope.ownerPubKey,t,r).publicKey}getAssociatedTokenAccountByOwner(t,r,o){return Se(t,r,o).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<(this._notSubscribeAccountChange?1e3*5:1e3*60*3))return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let o=F(F({},{}),t),[a,i,s]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:v.TOKEN_PROGRAM_ID},o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:v.TOKEN_2022_PROGRAM_ID},o.commitment)]),{tokenAccounts:f,tokenAccountRawInfos:p}=on({owner:this.scope.ownerPubKey,solAccountResp:a,tokenAccountResp:{context:i.context,value:[...i.value,...s.value]}});return this._tokenAccounts=f,this._tokenAccountRawInfos=p,this._accountFetchTime=Date.now(),this._notSubscribeAccountChange||(this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>{this.fetchWalletTokenAccounts({forceUpdate:!0}),this._accountListener.forEach(b=>b({tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos}))},{commitment:t==null?void 0:t.commitment})),{tokenAccounts:f,tokenAccountRawInfos:p}}clearAccountChangeCkb(){this._accountChangeListenerId!==void 0&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId)}async getCreatedTokenAccount({mint:t,programId:r=v.TOKEN_PROGRAM_ID,associatedOnly:o=!0}){await this.fetchWalletTokenAccounts();let a=this._tokenAccounts.filter(({mint:s})=>s==null?void 0:s.equals(t)).sort((s,f)=>s.amount.lt(f.amount)?1:-1),i=this.getAssociatedTokenAccount(t,r);for(let s of a){let{publicKey:f}=s;if(f&&(!o||o&&i.equals(f)))return f}}async getOrCreateTokenAccount(t){var x,g,R,k;await this.fetchWalletTokenAccounts();let{mint:r,createInfo:o,associatedOnly:a,owner:i,notUseTokenAccount:s=!1,skipCloseAccount:f=!1,checkCreateATAOwner:p=!1,assignSeed:b}=t;console.log("******************associatedOnly: ",a);let l=new pe.PublicKey(t.tokenProgram||v.TOKEN_PROGRAM_ID),h=this.getAssociatedTokenAccount(r,new pe.PublicKey(l)),y=(s?[]:this.tokenAccountRawInfos).filter(S=>S.accountInfo.mint.equals(r)&&(!a||S.pubkey.equals(h))).sort((S,m)=>S.accountInfo.amount.lt(m.accountInfo.amount)?1:-1);if(o===void 0||y.length>0)return y.length>0?{account:y[0].pubkey}:{};let c={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(a){let S=(0,v.createAssociatedTokenAccountIdempotentInstruction)(i,h,i,r,l),m=this.tokenAccountRawInfos.find(u=>u.pubkey.equals(h));if(p){console.log("******************checkCreateATAOwner: ",p);let u=await this.scope.connection.getAccountInfo(h);if(u===null)console.log("******************ataInfo == null: ",p),(x=c.instructions)==null||x.push(S),c.instructionTypes.push(V.CreateATA);else if(u.owner.equals(l)&&v.AccountLayout.decode(u.data).mint.equals(r)&&v.AccountLayout.decode(u.data).owner.equals(i))console.log("******************else empty: ");else throw Error(`create ata check error -> mint: ${r.toString()}, ata: ${h.toString()}`)}else m===void 0&&(console.log("******************_ataInTokenAcc undefined"),c.instructions.push(S),c.instructionTypes.push(V.CreateATA));if(r.equals(ie)&&o.amount){console.log("createWSolAccountInstructions*********************************");let u=await bt({connection:this.scope.connection,owner:i||this.scope.ownerPubKey,payer:o.payer||this.scope.ownerPubKey,amount:(g=o.amount)!=null?g:0,skipCloseAccount:f});c.instructions.push(...u.instructions||[]),c.endInstructions.push(...u.endInstructions||[]),c.instructionTypes.push(...u.instructionTypes||[]),c.endInstructionTypes.push(...u.endInstructionTypes||[]),o.amount&&(console.log("******************createInfo.amount"),c.instructions.push(an({source:u.addresses.newAccount,destination:h,owner:i||this.scope.ownerPubKey,amount:o.amount,tokenProgram:v.TOKEN_PROGRAM_ID})),c.instructionTypes.push(V.TransferAmount))}return!f&&m===void 0&&(console.log("******************skipCloseAccount"),c.endInstructions.push(Ne({owner:i,payer:o.payer||i,tokenAccount:h,programId:l})),c.endInstructionTypes.push(V.CloseAccount)),{account:h,instructionParams:c}}else{console.log("******************newTokenAccount");let S=ze({fromPublicKey:i,programId:l,assignSeed:b}),m=await this.scope.connection.getMinimumBalanceForRentExemption(v.AccountLayout.span),u=pe.SystemProgram.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:S.seed,newAccountPubkey:S.publicKey,lamports:m+Number((k=(R=o.amount)==null?void 0:R.toString())!=null?k:0),space:v.AccountLayout.span,programId:l});return c.instructions.push(u,yt({mint:r,tokenAccount:S.publicKey,owner:this.scope.ownerPubKey,programId:l})),c.instructionTypes.push(V.CreateAccount),c.instructionTypes.push(V.InitAccount),f||(c.endInstructions.push(Ne({owner:i,payer:o.payer||i,tokenAccount:S.publicKey,programId:l})),c.endInstructionTypes.push(V.CloseAccount)),{account:S.publicKey,instructionParams:c}}}async checkOrCreateAta({mint:t,programId:r=v.TOKEN_PROGRAM_ID,autoUnwrapWSOLToSOL:o}){var f;await this.fetchWalletTokenAccounts();let a=(f=this.scope.account.tokenAccounts.find(({mint:p})=>(p==null?void 0:p.toBase58())===t.toBase58()))==null?void 0:f.publicKey,i=this.scope.ownerPubKey,s={};if(!a){let p=this.getAssociatedTokenAccount(t,r),b=await(0,v.createAssociatedTokenAccountIdempotentInstruction)(i,p,i,t,r);s.instructions=[b],s.instructionTypes=[V.CreateATA],a=p}return o&&ie.toBase58()===t.toBase58()&&(s.endInstructions=[Ne({owner:i,payer:i,tokenAccount:a,programId:r})],s.endInstructionTypes=[V.CloseAccount]),{pubKey:a,newInstructions:s}}async handleTokenAccount(t){let{side:r,amount:o,mint:a,programId:i=v.TOKEN_PROGRAM_ID,tokenAccount:s,payer:f=this.scope.ownerPubKey,bypassAssociatedCheck:p,skipCloseAccount:b,checkCreateATAOwner:l}=t,h=this.getAssociatedTokenAccount(a,i);if(new pe.PublicKey(ie).equals(a)){let y=await bt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:f,amount:o,skipCloseAccount:b});return F({tokenAccount:y.addresses.newAccount},y)}else if(!s||r==="out"&&!h.equals(s)&&!p){let y=[],c=(0,v.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,h,this.scope.ownerPubKey,a,i);if(l){let x=await this.scope.connection.getAccountInfo(h);if(x===null)y.push(c);else if(!(x.owner.equals(v.TOKEN_PROGRAM_ID)&&v.AccountLayout.decode(x.data).mint.equals(a)&&v.AccountLayout.decode(x.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${a.toString()}, ata: ${h.toString()}`)}else y.push(c);return{tokenAccount:h,instructions:y,instructionTypes:[V.CreateATA]}}return{tokenAccount:s}}async processTokenAccount(t){let{mint:r,programId:o=v.TOKEN_PROGRAM_ID,amount:a,useSOLBalance:i,handleTokenAccount:s,feePayer:f}=t,p,b=this.createTxBuilder(f);if(r.equals(new pe.PublicKey(ie))&&i){let l=await this.handleTokenAccount({side:"in",amount:a||0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:y}=l,c=se(l,["tokenAccount"]);p=y,b.addInstruction(c)}else if(p=await this.getCreatedTokenAccount({mint:r,associatedOnly:!1,programId:o}),!p&&s){let h=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:y}=h,c=se(h,["tokenAccount"]);p=y,b.addInstruction(c)}return F({tokenAccount:p},b.AllTxData)}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.js.map