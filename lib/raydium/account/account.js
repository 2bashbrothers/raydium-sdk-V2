var an=Object.create;var me=Object.defineProperty,cn=Object.defineProperties,un=Object.getOwnPropertyDescriptor,ln=Object.getOwnPropertyDescriptors,pn=Object.getOwnPropertyNames,Be=Object.getOwnPropertySymbols,mn=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable;var yt=(n,e,t)=>e in n?me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,O=(n,e)=>{for(var t in e||(e={}))je.call(e,t)&&yt(n,t,e[t]);if(Be)for(var t of Be(e))bt.call(e,t)&&yt(n,t,e[t]);return n},Q=(n,e)=>cn(n,ln(e));var oe=(n,e)=>{var t={};for(var r in n)je.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Be)for(var r of Be(n))e.indexOf(r)<0&&bt.call(n,r)&&(t[r]=n[r]);return t};var dn=(n,e)=>{for(var t in e)me(n,t,{get:e[t],enumerable:!0})},xt=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of pn(e))!je.call(n,o)&&o!==t&&me(n,o,{get:()=>e[o],enumerable:!(r=un(e,o))||r.enumerable});return n};var W=(n,e,t)=>(t=n!=null?an(mn(n)):{},xt(e||!n||!n.__esModule?me(t,"default",{value:n,enumerable:!0}):t,n)),fn=n=>xt(me({},"__esModule",{value:!0}),n);var En={};dn(En,{default:()=>He});module.exports=fn(En);var se=require("@solana/web3.js");var wt=require("@solana/web3.js");var de=require("lodash");var ze=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Tt={},gn={};function U(n){let e=(0,de.get)(Tt,n);if(!e){let t=(0,de.get)(gn,n);e=new ze({name:n,logLevel:t}),(0,de.set)(Tt,n,e)}return e}var Ie=require("@solana/spl-token"),Ze=U("Raydium_accountInfo_util");async function Pt(n,e,t){let{batchRequest:r,commitment:o="confirmed",chunkCount:s=100}=O({batchRequest:!1},t),a=Je(e,s),i=new Array(a.length).fill([]);if(r){let m=a.map(c=>{let g=n._buildArgs([c.map(d=>d.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:g}}),p=Je(m,10);i=(await(await Promise.all(p.map(async c=>await n._rpcBatchRequest(c)))).flat()).map(c=>(c.error&&Ze.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.error.message}`),c.result.value.map(g=>{if(g){let{data:d,executable:u,lamports:T,owner:h,rentEpoch:I}=g;return d.length!==2&&d[1]!=="base64"&&Ze.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:u,lamports:T,owner:new wt.PublicKey(h),rentEpoch:I}}return null})))}else try{i=await Promise.all(a.map(m=>n.getMultipleAccountsInfo(m,o)))}catch(m){m instanceof Error&&Ze.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.message}`)}return i.flat()}var J=W(require("bn.js")),Sn=W(require("decimal.js"));var It=W(require("big.js")),Tn=W(require("bn.js"));var At=W(require("toformat")),hn=At.default,fe=hn;var ge=W(require("big.js")),St=W(require("bn.js")),Bt=W(require("decimal.js-light"));var ce=W(require("bn.js"));var kt=9007199254740991;function j(n){let e=U("Raydium_parseBigNumberish");if(n instanceof ce.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new ce.default(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=kt||n<=-kt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new ce.default(String(n))):typeof n=="bigint"?new ce.default(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new ce.default(0))}var Le=U("module/fraction"),Xe=fe(ge.default),he=fe(Bt.default),bn={[0]:he.ROUND_DOWN,[1]:he.ROUND_HALF_UP,[2]:he.ROUND_UP},xn={[0]:ge.default.roundDown,[1]:ge.default.roundHalfUp,[2]:ge.default.roundUp},M=class{constructor(e,t=new St.default(1)){this.numerator=j(e),this.denominator=j(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new M(this.denominator,this.numerator)}add(e){let t=e instanceof M?e:new M(j(e));return this.denominator.eq(t.denominator)?new M(this.numerator.add(t.numerator),this.denominator):new M(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof M?e:new M(j(e));return this.denominator.eq(t.denominator)?new M(this.numerator.sub(t.numerator),this.denominator):new M(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof M?e:new M(j(e));return new M(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof M?e:new M(j(e));return new M(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||Le.logWithError(`${e} is not an integer.`),e<=0&&Le.logWithError(`${e} is not positive.`),he.set({precision:e+1,rounding:bn[r]});let o=new he(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||Le.logWithError(`${e} is not an integer.`),e<0&&Le.logWithError(`${e} is negative.`),Xe.DP=e,Xe.RM=xn[r]||1,new Xe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ar=U("Raydium_amount"),cr=fe(It.default);var Lt=require("@solana/web3.js"),Ye=require("@solana/spl-token"),Ct={chainId:101,address:Lt.PublicKey.default.toBase58(),programId:Ye.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Y={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ye.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Ce=require("@solana/web3.js");var _=require("@solana/web3.js"),Rt=require("@solana/spl-token");function Qe({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var mr=[Qe({pubkey:Rt.TOKEN_PROGRAM_ID,isWritable:!1}),Qe({pubkey:_.SystemProgram.programId,isWritable:!1}),Qe({pubkey:_.SYSVAR_RENT_PUBKEY,isWritable:!1})];function _t({publicKey:n,transformSol:e}){let t=Dt(n.toString());if(t instanceof _.PublicKey)return e&&t.equals(ye)?$:t;if(e&&t.toString()===ye.toBase58())return $;if(typeof t=="string"){if(t===_.PublicKey.default.toBase58())return _.PublicKey.default;try{return new _.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Dt(n){try{return new _.PublicKey(n)}catch{return n}}var dr=new _.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),fr=new _.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),gr=new _.PublicKey("SysvarRent111111111111111111111111111111111"),hr=new _.PublicKey("SysvarC1ock11111111111111111111111111111111"),yr=new _.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),br=new _.PublicKey("Sysvar1nstructions1111111111111111111111111"),xr=_.SystemProgram.programId,Tr=new _.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),wr=new _.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Pr=new _.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ar=new _.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),kr=new _.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Sr=new _.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Br=new _.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ir=new _.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Lr=new _.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Cr=new _.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Rr=new _.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),$=new _.PublicKey("So11111111111111111111111111111111111111112"),ye=_.PublicKey.default;var $e=class{constructor({mint:e,decimals:t,symbol:r,name:o,skipMint:s=!1,isToken2022:a=!1}){if(e===ye.toBase58()||e instanceof Ce.PublicKey&&ye.equals(e)){this.decimals=Y.decimals,this.symbol=Y.symbol,this.name=Y.name,this.mint=new Ce.PublicKey(Y.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?Ce.PublicKey.default:_t({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ue=$e;ue.WSOL=new $e(Q(O({},Y),{mint:Y.address}));var et=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Re=et;Re.SOL=new et(Ct);var Nt=W(require("bn.js"));var Vr=new M(new Nt.default(100));var jr=U("Raydium_price");var An=require("@solana/web3.js"),kn=W(require("bn.js"));var Pn=new J.default(0),ko=new J.default(1),So=new J.default(2),Bo=new J.default(3),Io=new J.default(5),wn=new J.default(10),Lo=new J.default(100),Co=new J.default(1e3),Ro=new J.default(1e4);function Je(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var Wt=require("@solana/web3.js"),Ut=require("@solana/spl-token");var q=require("@solana/web3.js");var v={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Ot=require("@solana/spl-token"),Ft=U("Raydium_txUtil"),vt=1644;function _e(n){let e=[],t=[];return n.microLamports&&(e.push(q.ComputeBudgetProgram.setComputeUnitPrice({microLamports:n.microLamports})),t.push(v.SetComputeUnitPrice)),n.units&&(e.push(q.ComputeBudgetProgram.setComputeUnitLimit({units:n.units})),t.push(v.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function le(n,e){var r,o;let t=e!=null?e:"confirmed";return(o=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:o.blockhash}async function De(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let o=setTimeout(r,6e4);n.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}r(Object.assign(s.err,{txId:e}))},"confirmed")})}function Bn(n,e){n.length<1&&Ft.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Ft.logWithError(`no signers provided:, ${e.toString()}`);let t=new q.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<vt}catch{return!1}}function Vt(n,e){let[t,r]=q.PublicKey.findProgramAddressSync(n,e);return{publicKey:t,nonce:r}}function be({instructions:n,payer:e,signers:t}){return Bn(n,[e,...t])}function xe({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=q.Keypair.generate().publicKey.toString()}){let s=new q.TransactionMessage({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new q.VersionedTransaction(s).serialize()).toString("base64").length<vt}catch{return!1}}var In=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Ln=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof q.VersionedTransaction&&(e=In(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ie(n){let e=[];return n.forEach(t=>{t instanceof q.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Ot.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=q.Keypair.generate().publicKey)),e.push(Ln(t))}),console.log("simulate tx string:",e),e}function Ne(n,e,t){return Vt([n.toBuffer(),(t!=null?t:Ut.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new Wt.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var y=require("@solana/web3.js"),jo=new y.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),zo=new y.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Zo=new y.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Jo=new y.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Xo=new y.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Yo=new y.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Qo=new y.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),$o=new y.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ei=new y.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ti=new y.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ni=new y.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ri=new y.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),oi=new y.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ii=new y.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),si=new y.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ai=new y.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ci=new y.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ui=new y.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),li=new y.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),pi=new y.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),mi=new y.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),di=new y.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),fi=new y.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),gi=new y.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),hi=new y.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),yi=new y.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),bi=new y.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),xi=new y.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ti=new y.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),wi=new y.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Pi=new y.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ai={OPEN_BOOK_PROGRAM:new y.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new y.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new y.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new y.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new y.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new y.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new y.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new y.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new y.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new y.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new y.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new y.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:y.PublicKey.default,Router:new y.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new y.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new y.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new y.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new y.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new y.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new y.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new y.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new y.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new y.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new y.PublicKey("Ray1111111111111111111111111111111111111111")};var Cn=W(require("bn.js"));var z=require("@solana/web3.js");async function tt({connection:n,address:e,cluster:t="mainnet"}){let r=await Pt(n,[...new Set(e.map(s=>s.toString()))].map(s=>new z.PublicKey(s))),o={};for(let s=0;s<e.length;s++){let a=r[s],i=e[s];if(!a)continue;let m=new z.AddressLookupTableAccount({key:i,state:z.AddressLookupTableAccount.deserialize(a.data)});o[i.toString()]=m,t==="devnet"?pe[i.toString()]=m:Me[i.toString()]=m}return o}var Me={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new z.AddressLookupTableAccount({key:new z.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:z.AddressLookupTableAccount.deserialize(Buffer.from("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","base64"))})},pe={},nt=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(pe[e])return pe;let t=new z.PublicKey(e),r=await n.getAccountInfo(t);return r&&(pe[e]=new z.AddressLookupTableAccount({key:t,state:z.AddressLookupTableAccount.deserialize(r.data)})),pe};var C=require("@solana/web3.js"),qt=W(require("axios"));var Ee=2e3,Ke=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await qt.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=_e(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(C.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new C.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(v.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:a=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...a.filter(i=>i!==C.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(O({},t||{})):this.build(t)}build(e){var r;let t=new C.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var f;let{recentBlockHash:s,skipPreflight:a=!0,sendAndConfirm:i,notSendToRpc:m}=o||{},p=s!=null?s:await le(this.connection,this.blockhashCommitment);if(t.recentBlockhash=p,this.signers.length&&t.sign(...this.signers),ie([t]),(f=this.owner)!=null&&f.isKeyPair)return{txId:i?await(0,C.sendAndConfirmTransaction)(this.connection,t,this.signers.find(g=>g.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:a}),signedTx:t};if(this.signAllTransactions){let c=await this.signAllTransactions([t]);if(this.signers.length)for(let g of c)try{g.sign(...this.signers)}catch{}return{txId:m?"":await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:a}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var p;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:o}=this.build(r),s=t.filter(f=>f.transaction.instructions.length>0),a=[o,...s.map(f=>f.transaction)],i=[this.signers,...s.map(f=>f.signers)],m=[...this.instructionTypes,...s.map(f=>f.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&i.forEach(f=>{f.some(c=>c.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:i,instructionTypes:m,execute:async f=>{var I;let{sequentially:c,onTxUpdate:g,skipTxCount:d=0,recentBlockHash:u,skipPreflight:T=!0}=f||{},h=u!=null?u:await le(this.connection,this.blockhashCommitment);if((I=this.owner)!=null&&I.isKeyPair){if(c){let P=[],A=0;for(let b of a){if(++A,A<=d)continue;let l=await(0,C.sendAndConfirmTransaction)(this.connection,b,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});P.push(l)}return{txIds:P,signedTxs:a}}return{txIds:await await Promise.all(a.map(async P=>(P.recentBlockhash=h,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:T})))),signedTxs:a}}if(this.signAllTransactions){let P=a.map((b,l)=>(b.recentBlockhash=h,i[l].length&&b.sign(...i[l]),b));ie(P);let A=await this.signAllTransactions(P);if(c){let b=0,l=[],x=async()=>{if(!A[b])return;let S=await this.connection.sendRawTransaction(A[b].serialize(),{skipPreflight:T});l.push({txId:S,status:"sent",signedTx:A[b]}),g==null||g([...l]),b++;let k=!1,L=null,D=null,K=R=>{L!==null&&clearInterval(L),D!==null&&this.connection.removeSignatureListener(D);let N=l.findIndex(F=>F.txId===S);if(N>-1){if(l[N].status==="error"||l[N].status==="success")return;l[N].status=R.err?"error":"success"}g==null||g([...l]),R.err||x()};this.loopMultiTxStatus&&(L=setInterval(async()=>{var R;if(k){clearInterval(L);return}try{let N=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(k=!0,clearInterval(L),K({err:((R=N.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",S))}catch(N){k=!0,clearInterval(L),console.error("getTransaction timeout:",N,S)}},Ee)),D=this.connection.onSignature(S,R=>{if(k){this.connection.removeSignatureListener(D);return}k=!0,K(R)},"confirmed"),this.connection.getSignatureStatus(S)};return await x(),{txIds:l.map(S=>S.txId),signedTxs:A}}else{let b=[];for(let l=0;l<A.length;l+=1){let x=await this.connection.sendRawTransaction(A[l].serialize(),{skipPreflight:T});b.push(x)}return{txIds:b,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var T;let u=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:o,recentBlockhash:s}=u,a=oe(u,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=O(O({},this.cluster==="devnet"?await nt(this.connection):Me),t),m=Array.from(new Set([...r,...this.lookupTableAddress])),p=[];for(let h of m)i[h]===void 0&&p.push(new C.PublicKey(h));let f=await tt({connection:this.connection,address:p});for(let[h,I]of Object.entries(f))i[h]=I;let c=o?C.PublicKey.default.toBase58():s!=null?s:await le(this.connection,this.blockhashCommitment),g=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:c,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((T=this.owner)==null?void 0:T.signer)&&!this.signers.some(h=>h.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new C.VersionedTransaction(g);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async h=>{var b;let{skipPreflight:I=!0,sendAndConfirm:P,notSendToRpc:A}=h||{};if(ie([d]),(b=this.owner)!=null&&b.isKeyPair){let l=await this.connection.sendTransaction(d,{skipPreflight:I});return P&&await De(this.connection,l),{txId:l,signedTx:d}}if(this.signAllTransactions){let l=await this.signAllTransactions([d]);if(this.signers.length)for(let x of l)try{x.sign(this.signers)}catch{}return{txId:A?"":await this.connection.sendTransaction(l[0],{skipPreflight:I}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){var p;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:o}=await this.buildV0(r),s=t.filter(f=>f.builder.instructions.length>0),a=[o,...s.map(f=>f.transaction)],i=[this.signers,...s.map(f=>f.signers)],m=[...this.instructionTypes,...s.map(f=>f.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&i.forEach(f=>{f.some(c=>c.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(f,c)=>{f.sign(i[c])}),{builder:this,transactions:a,signers:i,instructionTypes:m,buildProps:r,execute:async f=>{var T;let{sequentially:c,onTxUpdate:g,recentBlockHash:d,skipPreflight:u=!0}=f||{};if(d&&a.forEach(h=>h.message.recentBlockhash=d),ie(a),(T=this.owner)!=null&&T.isKeyPair){if(c){let h=[];for(let I of a){let P=await this.connection.sendTransaction(I,{skipPreflight:u});await De(this.connection,P),h.push(P)}return{txIds:h,signedTxs:a}}return{txIds:await Promise.all(a.map(async h=>await this.connection.sendTransaction(h,{skipPreflight:u}))),signedTxs:a}}if(this.signAllTransactions){let h=await this.signAllTransactions(a);if(c){let I=0,P=[],A=async()=>{if(!h[I])return;let b=await this.connection.sendTransaction(h[I],{skipPreflight:u});P.push({txId:b,status:"sent",signedTx:h[I]}),g==null||g([...P]),I++;let l=!1,x=null,S=null,k=L=>{x!==null&&clearInterval(x),S!==null&&this.connection.removeSignatureListener(S);let D=P.findIndex(K=>K.txId===b);if(D>-1){if(P[D].status==="error"||P[D].status==="success")return;P[D].status=L.err?"error":"success"}g==null||g([...P]),L.err||A()};this.loopMultiTxStatus&&(x=setInterval(async()=>{var L;if(l){clearInterval(x);return}try{let D=await this.connection.getTransaction(b,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(l=!0,clearInterval(x),k({err:((L=D.meta)==null?void 0:L.err)||null}),console.log("tx status from getTransaction:",b))}catch(D){l=!0,clearInterval(x),console.error("getTransaction timeout:",D,b)}},Ee)),S=this.connection.onSignature(b,L=>{if(l){this.connection.removeSignatureListener(S);return}l=!0,k(L)},"confirmed"),this.connection.getSignatureStatus(b)};return A(),{txIds:[],signedTxs:h}}else{let I=[];for(let P=0;P<h.length;P+=1){let A=await this.connection.sendTransaction(h[P],{skipPreflight:u});I.push(A)}return{txIds:I,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var g;let c=e||{},{splitIns:t=[],computeBudgetConfig:r}=c,o=oe(c,["splitIns","computeBudgetConfig"]),s=r?_e(r):{instructions:[],instructionTypes:[]},a=this.signers.reduce((d,u)=>Q(O({},d),{[u.publicKey.toBase58()]:u}),{}),i=[],m=[],p=[],f=0;if(this.allInstructions.forEach(d=>{let u=[...p,d],T=r?[...s.instructions,...u]:u,I=[...new Set(u.map(P=>P.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(P=>new C.PublicKey(P));if(d!==t[f]&&p.length<12&&(be({instructions:T,payer:this.feePayer,signers:I})||be({instructions:u,payer:this.feePayer,signers:I})))p.push(d);else{if(p.length===0)throw Error("item ins too big");f+=d===t[f]?1:0,be({instructions:r?[...s.instructions,...p]:[...p],payer:this.feePayer,signers:I})?i.push(new C.Transaction().add(...s.instructions,...p)):i.push(new C.Transaction().add(...p)),m.push(Array.from(new Set(p.map(P=>P.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat())).map(P=>a[P]).filter(P=>P!==void 0)),p=[d]}}),p.length>0){let u=[...new Set(p.map(T=>T.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(T=>a[T]).filter(T=>T!==void 0);be({instructions:r?[...s.instructions,...p]:[...p],payer:this.feePayer,signers:u.map(T=>T.publicKey)})?i.push(new C.Transaction().add(...s.instructions,...p)):i.push(new C.Transaction().add(...p)),m.push(u)}return i.forEach(d=>d.feePayer=this.feePayer),(g=this.owner)!=null&&g.signer&&m.forEach(d=>{d.some(u=>u.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:i,signers:m,instructionTypes:this.instructionTypes,execute:async d=>{var b;let{sequentially:u,onTxUpdate:T,skipTxCount:h=0,recentBlockHash:I,skipPreflight:P=!0}=d||{},A=I!=null?I:await le(this.connection,this.blockhashCommitment);if(i.forEach(async(l,x)=>{l.recentBlockhash=A,m[x].length&&l.sign(...m[x])}),ie(i),(b=this.owner)!=null&&b.isKeyPair){if(u){let l=0,x=[];for(let S of i){if(++l,l<=h){x.push("tx skipped");continue}let k=await(0,C.sendAndConfirmTransaction)(this.connection,S,this.signers.find(L=>L.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:P});x.push(k)}return{txIds:x,signedTxs:i}}return{txIds:await Promise.all(i.map(async l=>await this.connection.sendRawTransaction(l.serialize(),{skipPreflight:P}))),signedTxs:i}}if(this.signAllTransactions){let l=await this.signAllTransactions(i.slice(h,i.length)),x=[...i.slice(0,h),...l];if(u){let S=0,k=[],L=async()=>{if(!x[S])return;S<h&&(k.push({txId:"",status:"success",signedTx:x[S]}),T==null||T([...k]),S++,L());let D=await this.connection.sendRawTransaction(x[S].serialize(),{skipPreflight:P});k.push({txId:D,status:"sent",signedTx:x[S]}),T==null||T([...k]),S++;let K=!1,R=null,N=null,F=G=>{R!==null&&clearInterval(R),N!==null&&this.connection.removeSignatureListener(N);let V=k.findIndex(ne=>ne.txId===D);if(V>-1){if(k[V].status==="error"||k[V].status==="success")return;k[V].status=G.err?"error":"success"}T==null||T([...k]),G.err||L()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var G;if(K){clearInterval(R);return}try{let V=await this.connection.getTransaction(D,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(K=!0,clearInterval(R),F({err:((G=V.meta)==null?void 0:G.err)||null}),console.log("tx status from getTransaction:",D))}catch(V){K=!0,clearInterval(R),console.error("getTransaction timeout:",V,D)}},Ee)),N=this.connection.onSignature(D,G=>{if(K){this.connection.removeSignatureListener(N);return}K=!0,F(G)},"confirmed"),this.connection.getSignatureStatus(D)};return await L(),{txIds:k.map(D=>D.txId),signedTxs:x}}else{let S=[];for(let k=0;k<x.length;k+=1){let L=await this.connection.sendRawTransaction(x[k].serialize(),{skipPreflight:P});S.push(L)}return{txIds:S,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var A;let P=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:o={},lookupTableAddress:s=[]}=P,a=oe(P,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=O(O({},this.cluster==="devnet"?await nt(this.connection):Me),o),m=Array.from(new Set([...this.lookupTableAddress,...s])),p=[];for(let b of m)i[b]===void 0&&p.push(new C.PublicKey(b));let f=await tt({connection:this.connection,address:p});for(let[b,l]of Object.entries(f))i[b]=l;let c=t?_e(t):{instructions:[],instructionTypes:[]},g=await le(this.connection,this.blockhashCommitment),d=this.signers.reduce((b,l)=>Q(O({},b),{[l.publicKey.toBase58()]:l}),{}),u=[],T=[],h=[],I=0;if(this.allInstructions.forEach(b=>{let l=[...h,b],x=t?[...c.instructions,...l]:l;if(b!==r[I]&&h.length<12&&(xe({instructions:x,payer:this.feePayer,lookupTableAddressAccount:i})||xe({instructions:l,payer:this.feePayer,lookupTableAddressAccount:i})))h.push(b);else{if(h.length===0)throw Error("item ins too big");I+=b===r[I]?1:0;let S={};for(let k of[...new Set(m)])i[k]!==void 0&&(S[k]=i[k]);if(t&&xe({instructions:[...c.instructions,...h],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:g})){let k=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:g,instructions:[...c.instructions,...h]}).compileToV0Message(Object.values(i));u.push(new C.VersionedTransaction(k))}else{let k=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:g,instructions:[...h]}).compileToV0Message(Object.values(i));u.push(new C.VersionedTransaction(k))}T.push(Array.from(new Set(h.map(k=>k.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(k=>d[k]).filter(k=>k!==void 0)),h=[b]}}),h.length>0){let l=[...new Set(h.map(x=>x.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(x=>d[x]).filter(x=>x!==void 0);if(t&&xe({instructions:[...c.instructions,...h],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:g})){let x=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:g,instructions:[...c.instructions,...h]}).compileToV0Message(Object.values(i));u.push(new C.VersionedTransaction(x))}else{let x=new C.TransactionMessage({payerKey:this.feePayer,recentBlockhash:g,instructions:[...h]}).compileToV0Message(Object.values(i));u.push(new C.VersionedTransaction(x))}T.push(l)}return(A=this.owner)!=null&&A.signer&&T.forEach(b=>{b.some(l=>l.publicKey.equals(this.owner.publicKey))||b.push(this.owner.signer)}),u.forEach((b,l)=>{b.sign(T[l])}),{builder:this,transactions:u,buildProps:e,signers:T,instructionTypes:this.instructionTypes,execute:async b=>{var D;let{sequentially:l,onTxUpdate:x,skipTxCount:S=0,recentBlockHash:k,skipPreflight:L=!0}=b||{};if(u.map(async(K,R)=>{T[R].length&&K.sign(T[R]),k&&(K.message.recentBlockhash=k)}),ie(u),(D=this.owner)!=null&&D.isKeyPair){if(l){let K=0,R=[];for(let N of u){if(++K,K<=S){console.log("skip tx: ",K),R.push("tx skipped");continue}let F=await this.connection.sendTransaction(N,{skipPreflight:L});await De(this.connection,F),R.push(F)}return{txIds:R,signedTxs:u}}return{txIds:await Promise.all(u.map(async K=>await this.connection.sendTransaction(K,{skipPreflight:L}))),signedTxs:u}}if(this.signAllTransactions){let K=await this.signAllTransactions(u.slice(S,u.length)),R=[...u.slice(0,S),...K];if(l){let N=0,F=[],G=async()=>{if(!R[N])return;if(N<S){F.push({txId:"",status:"success",signedTx:R[N]}),x==null||x([...F]),N++,G();return}let V=await this.connection.sendTransaction(R[N],{skipPreflight:L});F.push({txId:V,status:"sent",signedTx:R[N]}),x==null||x([...F]),N++;let ne=!1,ae=null,Se=null,ht=re=>{ae!==null&&clearInterval(ae),Se!==null&&this.connection.removeSignatureListener(Se);let X=F.findIndex(sn=>sn.txId===V);if(X>-1){if(F[X].status==="error"||F[X].status==="success")return;F[X].status=re.err?"error":"success"}x==null||x([...F]),re.err||G()};this.loopMultiTxStatus&&(ae=setInterval(async()=>{var re;if(ne){clearInterval(ae);return}try{let X=await this.connection.getTransaction(V,{commitment:"confirmed",maxSupportedTransactionVersion:0});X&&(ne=!0,clearInterval(ae),ht({err:((re=X.meta)==null?void 0:re.err)||null}),console.log("tx status from getTransaction:",V))}catch(X){ne=!0,clearInterval(ae),console.error("getTransaction timeout:",X,V)}},Ee)),Se=this.connection.onSignature(V,re=>{if(ne){this.connection.removeSignatureListener(Se);return}ne=!0,ht(re)},"confirmed"),this.connection.getSignatureStatus(V)};return G(),{txIds:[],signedTxs:R}}else{let N=[];for(let F=0;F<R.length;F+=1){let G=await this.connection.sendTransaction(R[F],{skipPreflight:L});N.push(G)}return{txIds:N,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};var Gt=W(require("bn.js")),Vi=new Gt.default(1e6);var E=require("@solana/spl-token");var rt=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Te=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=U(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ke({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(rt(e))}logInfo(...e){this.logger.info(rt(e))}logAndCreateError(...e){let t=rt(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Ge=require("@solana/web3.js"),rn=W(require("bn.js"));var H=require("@solana/spl-token");var Ae=require("@solana/web3.js"),en=W(require("bn.js"));var tn=require("@solana/spl-token");function Rn(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function ot(n,...e){if(!Rn(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}function it(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Ht(n,e){ot(n);let t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Oe=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),Z=(n,e)=>n<<32-e|n>>>e;var ds=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function _n(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function st(n){return typeof n=="string"&&(n=_n(n)),ot(n),n}var Fe=class{clone(){return this._cloneInto()}},fs={}.toString;function jt(n){let e=r=>n().update(st(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Dn(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);let o=BigInt(32),s=BigInt(4294967295),a=Number(t>>o&s),i=Number(t&s),m=r?4:0,p=r?0:4;n.setUint32(e+m,a,r),n.setUint32(e+p,i,r)}var zt=(n,e,t)=>n&e^~n&t,Zt=(n,e,t)=>n&e^n&t^e&t,ve=class extends Fe{constructor(e,t,r,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Oe(this.buffer)}update(e){it(this);let{view:t,buffer:r,blockLen:o}=this;e=st(e);let s=e.length;for(let a=0;a<s;){let i=Math.min(o-this.pos,s-a);if(i===o){let m=Oe(e);for(;o<=s-a;a+=o)this.process(m,a);continue}r.set(e.subarray(a,a+i),this.pos),this.pos+=i,a+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){it(this),Ht(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(r,0),a=0);for(let c=a;c<o;c++)t[c]=0;Dn(r,o-8,BigInt(this.length*8),s),this.process(r,0);let i=Oe(e),m=this.outputLen;if(m%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let p=m/4,f=this.get();if(p>f.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<p;c++)i.setUint32(4*c,f[c],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:o,finished:s,destroyed:a,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=a,o%t&&e.buffer.set(r),e}};var Nn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ee=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),te=new Uint32Array(64),at=class extends ve{constructor(){super(64,32,8,!1),this.A=ee[0]|0,this.B=ee[1]|0,this.C=ee[2]|0,this.D=ee[3]|0,this.E=ee[4]|0,this.F=ee[5]|0,this.G=ee[6]|0,this.H=ee[7]|0}get(){let{A:e,B:t,C:r,D:o,E:s,F:a,G:i,H:m}=this;return[e,t,r,o,s,a,i,m]}set(e,t,r,o,s,a,i,m){this.A=e|0,this.B=t|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=i|0,this.H=m|0}process(e,t){for(let c=0;c<16;c++,t+=4)te[c]=e.getUint32(t,!1);for(let c=16;c<64;c++){let g=te[c-15],d=te[c-2],u=Z(g,7)^Z(g,18)^g>>>3,T=Z(d,17)^Z(d,19)^d>>>10;te[c]=T+te[c-7]+u+te[c-16]|0}let{A:r,B:o,C:s,D:a,E:i,F:m,G:p,H:f}=this;for(let c=0;c<64;c++){let g=Z(i,6)^Z(i,11)^Z(i,25),d=f+g+zt(i,m,p)+Nn[c]+te[c]|0,T=(Z(r,2)^Z(r,13)^Z(r,22))+Zt(r,o,s)|0;f=p,p=m,m=i,i=a+d|0,a=s,s=o,o=r,r=d+T|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,i=i+this.E|0,m=m+this.F|0,p=p+this.G|0,f=f+this.H|0,this.set(r,o,s,a,i,m,p,f)}roundClean(){te.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Jt=jt(()=>new at);var Yt=require("@solana/web3.js"),Ve=W(require("bn.js"));var w=require("@solana/buffer-layout"),ct=w.Layout,Xt=w.Structure;var ut=w.UInt;var lt=w.blob;var pt=class extends ct{constructor(t,r,o){super(t,o);this.blob=lt(t),this.signed=r}decode(t,r=0){let o=new Ve.default(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new Ve.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}};function Qt(n){return new ut(1,n)}function We(n){return new ut(4,n)}function Ue(n){return new pt(8,!1,n)}var mt=class extends ct{constructor(t,r,o,s){super(t.span,s);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function we(n){return new mt(lt(32),e=>new Yt.PublicKey(e),e=>e.toBuffer(),n)}var dt=class extends Xt{decode(e,t){return super.decode(e,t)}};function $t(n,e,t){return new dt(n,e,t)}var Pe=$t([we("mint"),we("owner"),Ue("amount"),We("delegateOption"),we("delegate"),Qt("state"),We("isNativeOption"),Ue("isNative"),Ue("delegatedAmount"),We("closeAuthorityOption"),we("closeAuthority")]);var Us=U("Raydium_Util");function nn({owner:n,solAccountResp:e,tokenAccountResp:t}){let r=[],o=[];for(let{pubkey:s,account:a}of t.value){let i=Pe.decode(a.data),{mint:m,amount:p}=i;r.push({publicKey:s,mint:m,amount:p,isAssociated:Ne(n,m,a.owner).publicKey.equals(s),isNative:!1,programId:a.owner}),o.push({pubkey:s,accountInfo:i,programId:a.owner})}return e&&r.push({mint:Ae.PublicKey.default,amount:new en.default(String(e.lamports)),isNative:!0,programId:e.owner}),{tokenAccounts:r,tokenAccountRawInfos:o}}function qe({fromPublicKey:n,programId:e=tn.TOKEN_PROGRAM_ID,assignSeed:t}){let r=t?btoa(t).slice(0,32):Ae.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:Mn(n,r,e),seed:r}}function Mn(n,e,t){let r=Buffer.concat([n.toBuffer(),Buffer.from(e),t.toBuffer()]),o=Jt(r);return new Ae.PublicKey(o)}function ft(n){let{mint:e,tokenAccount:t,owner:r,programId:o=H.TOKEN_PROGRAM_ID}=n;return(0,H.createInitializeAccountInstruction)(t,e,r,o)}function ke(n){let{tokenAccount:e,payer:t,multiSigners:r=[],owner:o,programId:s=H.TOKEN_PROGRAM_ID}=n;return(0,H.createCloseAccountInstruction)(e,t,o,r,s)}async function gt(n){let{connection:e,amount:t,commitment:r,payer:o,owner:s,skipCloseAccount:a}=n,i=await e.getMinimumBalanceForRentExemption(Pe.span,r),m=j(t).add(new rn.default(i)),p=qe({fromPublicKey:o,programId:H.TOKEN_PROGRAM_ID});return{addresses:{newAccount:p.publicKey},signers:[],instructions:[Ge.SystemProgram.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:p.seed,newAccountPubkey:p.publicKey,lamports:m.toNumber(),space:Pe.span,programId:H.TOKEN_PROGRAM_ID}),ft({mint:new Ge.PublicKey(Y.address),tokenAccount:p.publicKey,owner:s,programId:H.TOKEN_PROGRAM_ID})],instructionTypes:[v.CreateAccount,v.InitAccount],endInstructionTypes:a?[]:[v.CloseAccount],endInstructions:a?[]:[ke({tokenAccount:p.publicKey,payer:o,owner:s})]}}function on({source:n,destination:e,owner:t,amount:r,multiSigners:o=[],tokenProgram:s=H.TOKEN_PROGRAM_ID}){return(0,H.createTransferInstruction)(n,e,t,BigInt(String(r)),o,s)}var He=class extends Te{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;this._notSubscribeAccountChange=!1;this._accountFetchTime=0;let{tokenAccounts:r,tokenAccountRawInfos:o,notSubscribeAccountChange:s}=t;this._tokenAccounts=r||[],this._tokenAccountRawInfos=o||[],this._notSubscribeAccountChange=s!=null?s:!0,this._clientOwnedToken=!!(r||o)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}set notSubscribeAccountChange(t){this._notSubscribeAccountChange=t}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:r}){return t&&(this._tokenAccounts=t),r&&(this._tokenAccountRawInfos=r),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(r=>r!==t),this}getAssociatedTokenAccount(t,r){return Ne(this.scope.ownerPubKey,t,r).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<(this._notSubscribeAccountChange?1e3*5:1e3*60*3))return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let o=O(O({},{}),t),[s,a,i]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:E.TOKEN_PROGRAM_ID},o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:E.TOKEN_2022_PROGRAM_ID},o.commitment)]),{tokenAccounts:m,tokenAccountRawInfos:p}=nn({owner:this.scope.ownerPubKey,solAccountResp:s,tokenAccountResp:{context:a.context,value:[...a.value,...i.value]}});return this._tokenAccounts=m,this._tokenAccountRawInfos=p,this._accountFetchTime=Date.now(),this._notSubscribeAccountChange||(this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>{this.fetchWalletTokenAccounts({forceUpdate:!0}),this._accountListener.forEach(f=>f({tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos}))},{commitment:t==null?void 0:t.commitment})),{tokenAccounts:m,tokenAccountRawInfos:p}}clearAccountChangeCkb(){this._accountChangeListenerId!==void 0&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId)}async getCreatedTokenAccount({mint:t,programId:r=E.TOKEN_PROGRAM_ID,associatedOnly:o=!0}){await this.fetchWalletTokenAccounts();let s=this._tokenAccounts.filter(({mint:i})=>i==null?void 0:i.equals(t)).sort((i,m)=>i.amount.lt(m.amount)?1:-1),a=this.getAssociatedTokenAccount(t,r);for(let i of s){let{publicKey:m}=i;if(m&&(!o||o&&a.equals(m)))return m}}async getOrCreateTokenAccount(t){var T,h,I,P;await this.fetchWalletTokenAccounts();let{mint:r,createInfo:o,associatedOnly:s,owner:a,notUseTokenAccount:i=!1,skipCloseAccount:m=!1,checkCreateATAOwner:p=!1,assignSeed:f}=t,c=new se.PublicKey(t.tokenProgram||E.TOKEN_PROGRAM_ID),g=this.getAssociatedTokenAccount(r,new se.PublicKey(c)),d=(i?[]:this.tokenAccountRawInfos).filter(A=>A.accountInfo.mint.equals(r)&&(!s||A.pubkey.equals(g))).sort((A,b)=>A.accountInfo.amount.lt(b.accountInfo.amount)?1:-1);if(o===void 0||d.length>0)return d.length>0?{account:d[0].pubkey}:{};let u={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(s){let A=(0,E.createAssociatedTokenAccountIdempotentInstruction)(a,g,a,r,c),b=this.tokenAccountRawInfos.find(l=>l.pubkey.equals(g));if(p){let l=await this.scope.connection.getAccountInfo(g);if(l===null)(T=u.instructions)==null||T.push(A),u.instructionTypes.push(v.CreateATA);else if(!(l.owner.equals(c)&&E.AccountLayout.decode(l.data).mint.equals(r)&&E.AccountLayout.decode(l.data).owner.equals(a)))throw Error(`create ata check error -> mint: ${r.toString()}, ata: ${g.toString()}`)}else b===void 0&&(u.instructions.push(A),u.instructionTypes.push(v.CreateATA));if(r.equals($)&&o.amount){let l=await gt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:o.payer||this.scope.ownerPubKey,amount:(h=o.amount)!=null?h:0,skipCloseAccount:m});u.instructions.push(...l.instructions||[]),u.endInstructions.push(...l.endInstructions||[]),u.instructionTypes.push(...l.instructionTypes||[]),u.endInstructionTypes.push(...l.endInstructionTypes||[]),o.amount&&(u.instructions.push(on({source:l.addresses.newAccount,destination:g,owner:this.scope.ownerPubKey,amount:o.amount,tokenProgram:E.TOKEN_PROGRAM_ID})),u.instructionTypes.push(v.TransferAmount))}return!m&&b===void 0&&(u.endInstructions.push(ke({owner:a,payer:o.payer||a,tokenAccount:g,programId:c})),u.endInstructionTypes.push(v.CloseAccount)),{account:g,instructionParams:u}}else{let A=qe({fromPublicKey:a,programId:c,assignSeed:f}),b=await this.scope.connection.getMinimumBalanceForRentExemption(E.AccountLayout.span),l=se.SystemProgram.createAccountWithSeed({fromPubkey:a,basePubkey:a,seed:A.seed,newAccountPubkey:A.publicKey,lamports:b+Number((P=(I=o.amount)==null?void 0:I.toString())!=null?P:0),space:E.AccountLayout.span,programId:c});return u.instructions.push(l,ft({mint:r,tokenAccount:A.publicKey,owner:this.scope.ownerPubKey,programId:c})),u.instructionTypes.push(v.CreateAccount),u.instructionTypes.push(v.InitAccount),m||(u.endInstructions.push(ke({owner:a,payer:o.payer||a,tokenAccount:A.publicKey,programId:c})),u.endInstructionTypes.push(v.CloseAccount)),{account:A.publicKey,instructionParams:u}}}async checkOrCreateAta({mint:t,programId:r=E.TOKEN_PROGRAM_ID,autoUnwrapWSOLToSOL:o}){var m;await this.fetchWalletTokenAccounts();let s=(m=this.scope.account.tokenAccounts.find(({mint:p})=>(p==null?void 0:p.toBase58())===t.toBase58()))==null?void 0:m.publicKey,a=this.scope.ownerPubKey,i={};if(!s){let p=this.getAssociatedTokenAccount(t,r),f=await(0,E.createAssociatedTokenAccountIdempotentInstruction)(a,p,a,t,r);i.instructions=[f],i.instructionTypes=[v.CreateATA],s=p}return o&&$.toBase58()===t.toBase58()&&(i.endInstructions=[ke({owner:a,payer:a,tokenAccount:s,programId:r})],i.endInstructionTypes=[v.CloseAccount]),{pubKey:s,newInstructions:i}}async handleTokenAccount(t){let{side:r,amount:o,mint:s,programId:a=E.TOKEN_PROGRAM_ID,tokenAccount:i,payer:m=this.scope.ownerPubKey,bypassAssociatedCheck:p,skipCloseAccount:f,checkCreateATAOwner:c}=t,g=this.getAssociatedTokenAccount(s,a);if(new se.PublicKey($).equals(s)){let d=await gt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:m,amount:o,skipCloseAccount:f});return O({tokenAccount:d.addresses.newAccount},d)}else if(!i||r==="out"&&!g.equals(i)&&!p){let d=[],u=(0,E.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,g,this.scope.ownerPubKey,s,a);if(c){let T=await this.scope.connection.getAccountInfo(g);if(T===null)d.push(u);else if(!(T.owner.equals(E.TOKEN_PROGRAM_ID)&&E.AccountLayout.decode(T.data).mint.equals(s)&&E.AccountLayout.decode(T.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${s.toString()}, ata: ${g.toString()}`)}else d.push(u);return{tokenAccount:g,instructions:d,instructionTypes:[v.CreateATA]}}return{tokenAccount:i}}async processTokenAccount(t){let{mint:r,programId:o=E.TOKEN_PROGRAM_ID,amount:s,useSOLBalance:a,handleTokenAccount:i,feePayer:m}=t,p,f=this.createTxBuilder(m);if(r.equals(new se.PublicKey($))&&a){let c=await this.handleTokenAccount({side:"in",amount:s||0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:d}=c,u=oe(c,["tokenAccount"]);p=d,f.addInstruction(u)}else if(p=await this.getCreatedTokenAccount({mint:r,associatedOnly:!1,programId:o}),!p&&i){let g=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:d}=g,u=oe(g,["tokenAccount"]);p=d,f.addInstruction(u)}return O({tokenAccount:p},f.AllTxData)}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.js.map