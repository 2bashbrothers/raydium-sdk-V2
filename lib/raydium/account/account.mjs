var Jt=Object.defineProperty,Xt=Object.defineProperties;var Yt=Object.getOwnPropertyDescriptors;var Ae=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var ft=(n,e,t)=>e in n?Jt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,K=(n,e)=>{for(var t in e||(e={}))gt.call(e,t)&&ft(n,t,e[t]);if(Ae)for(var t of Ae(e))ht.call(e,t)&&ft(n,t,e[t]);return n},j=(n,e)=>Xt(n,Yt(e));var $=(n,e)=>{var t={};for(var r in n)gt.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Ae)for(var r of Ae(n))e.indexOf(r)<0&&ht.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as ve,SystemProgram as jn}from"@solana/web3.js";import{PublicKey as en}from"@solana/web3.js";import{get as yt,set as Qt}from"lodash";var Ve=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},bt={},$t={};function v(n){let e=yt(bt,n);if(!e){let t=yt($t,n);e=new Ve({name:n,logLevel:t}),Qt(bt,n,e)}return e}import{MINT_SIZE as or,TOKEN_PROGRAM_ID as ir,getTransferFeeConfig as sr,unpackMint as ar}from"@solana/spl-token";var We=v("Raydium_accountInfo_util");async function xt(n,e,t){let{batchRequest:r,commitment:o="confirmed",chunkCount:s=100}=K({batchRequest:!1},t),a=Ue(e,s),i=new Array(a.length).fill([]);if(r){let m=a.map(c=>{let g=n._buildArgs([c.map(d=>d.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:g}}),p=Ue(m,10);i=(await(await Promise.all(p.map(async c=>await n._rpcBatchRequest(c)))).flat()).map(c=>(c.error&&We.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.error.message}`),c.result.value.map(g=>{if(g){let{data:d,executable:u,lamports:T,owner:h,rentEpoch:I}=g;return d.length!==2&&d[1]!=="base64"&&We.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:u,lamports:T,owner:new en(h),rentEpoch:I}}return null})))}else try{i=await Promise.all(a.map(m=>n.getMultipleAccountsInfo(m,o)))}catch(m){m instanceof Error&&We.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.message}`)}return i.flat()}import H from"bn.js";import ei from"decimal.js";import un from"big.js";import Sr from"bn.js";import tn from"toformat";var nn=tn,ue=nn;import Se from"big.js";import on from"bn.js";import sn from"decimal.js-light";import le from"bn.js";var Tt=9007199254740991;function W(n){let e=v("Raydium_parseBigNumberish");if(n instanceof le)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new le(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=Tt||n<=-Tt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new le(String(n))):typeof n=="bigint"?new le(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new le(0))}var ke=v("module/fraction"),qe=ue(Se),pe=ue(sn),an={[0]:pe.ROUND_DOWN,[1]:pe.ROUND_HALF_UP,[2]:pe.ROUND_UP},cn={[0]:Se.roundDown,[1]:Se.roundHalfUp,[2]:Se.roundUp},D=class{constructor(e,t=new on(1)){this.numerator=W(e),this.denominator=W(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new D(this.denominator,this.numerator)}add(e){let t=e instanceof D?e:new D(W(e));return this.denominator.eq(t.denominator)?new D(this.numerator.add(t.numerator),this.denominator):new D(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof D?e:new D(W(e));return this.denominator.eq(t.denominator)?new D(this.numerator.sub(t.numerator),this.denominator):new D(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof D?e:new D(W(e));return new D(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof D?e:new D(W(e));return new D(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||ke.logWithError(`${e} is not an integer.`),e<=0&&ke.logWithError(`${e} is not positive.`),pe.set({precision:e+1,rounding:an[r]});let o=new pe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||ke.logWithError(`${e} is not an integer.`),e<0&&ke.logWithError(`${e} is negative.`),qe.DP=e,qe.RM=cn[r]||1,new qe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Mr=v("Raydium_amount"),Er=ue(un);import{PublicKey as pn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wt}from"@solana/spl-token";var Pt={chainId:101,address:pn.default.toBase58(),programId:wt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},G={chainId:101,address:"So11111111111111111111111111111111111111112",programId:wt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as He}from"@solana/web3.js";import{PublicKey as N,SystemProgram as At,SYSVAR_RENT_PUBKEY as mn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as dn}from"@solana/spl-token";function Ge({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var qr=[Ge({pubkey:dn,isWritable:!1}),Ge({pubkey:At.programId,isWritable:!1}),Ge({pubkey:mn,isWritable:!1})];function kt({publicKey:n,transformSol:e}){let t=St(n.toString());if(t instanceof N)return e&&t.equals(me)?z:t;if(e&&t.toString()===me.toBase58())return z;if(typeof t=="string"){if(t===N.default.toBase58())return N.default;try{return new N(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function St(n){try{return new N(n)}catch{return n}}var Gr=new N("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Hr=new N("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),jr=new N("SysvarRent111111111111111111111111111111111"),zr=new N("SysvarC1ock11111111111111111111111111111111"),Zr=new N("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Jr=new N("Sysvar1nstructions1111111111111111111111111"),Xr=At.programId,Yr=new N("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Qr=new N("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),$r=new N("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),eo=new N("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),to=new N("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),no=new N("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ro=new N("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),oo=new N("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),io=new N("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),so=new N("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ao=new N("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),z=new N("So11111111111111111111111111111111111111112"),me=N.default;var je=class{constructor({mint:e,decimals:t,symbol:r,name:o,skipMint:s=!1,isToken2022:a=!1}){if(e===me.toBase58()||e instanceof He&&me.equals(e)){this.decimals=G.decimals,this.symbol=G.symbol,this.name=G.name,this.mint=new He(G.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?He.default:kt({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ne=je;ne.WSOL=new je(j(K({},G),{mint:G.address}));var ze=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Be=ze;Be.SOL=new ze(Pt);import fn from"bn.js";var To=new D(new fn(100));var Bo=v("Raydium_price");import{PublicKey as qo}from"@solana/web3.js";import Ho from"bn.js";var gn=new H(0),li=new H(1),pi=new H(2),mi=new H(3),di=new H(5),ln=new H(10),fi=new H(100),gi=new H(1e3),hi=new H(1e4);function Ue(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}import{PublicKey as Pn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as An}from"@solana/spl-token";import{ComputeBudgetProgram as Ct,Keypair as _t,PublicKey as hn,Transaction as Dt,TransactionMessage as yn,VersionedTransaction as Nt}from"@solana/web3.js";var F={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as bn}from"@solana/spl-token";var Rt=v("Raydium_txUtil"),Mt=1644;function Ie(n){let e=[],t=[];return n.microLamports&&(e.push(Ct.setComputeUnitPrice({microLamports:n.microLamports})),t.push(F.SetComputeUnitPrice)),n.units&&(e.push(Ct.setComputeUnitLimit({units:n.units})),t.push(F.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function re(n,e){var r,o;let t=e!=null?e:"confirmed";return(o=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:o.blockhash}async function Le(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let o=setTimeout(r,6e4);n.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}r(Object.assign(s.err,{txId:e}))},"confirmed")})}function xn(n,e){n.length<1&&Rt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Rt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Dt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Mt}catch{return!1}}function Et(n,e){let[t,r]=hn.findProgramAddressSync(n,e);return{publicKey:t,nonce:r}}function de({instructions:n,payer:e,signers:t}){return xn(n,[e,...t])}function fe({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=_t.generate().publicKey.toString()}){let s=new yn({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Nt(s).serialize()).toString("base64").length<Mt}catch{return!1}}var Tn=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),wn=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Nt&&(e=Tn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ee(n){let e=[];return n.forEach(t=>{t instanceof Dt&&(t.recentBlockhash||(t.recentBlockhash=bn.toBase58()),t.feePayer||(t.feePayer=_t.generate().publicKey)),e.push(wn(t))}),console.log("simulate tx string:",e),e}function Ce(n,e,t){return Et([n.toBuffer(),(t!=null?t:An).toBuffer(),e.toBuffer()],new Pn("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as b}from"@solana/web3.js";var Fi=new b("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Oi=new b("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),vi=new b("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Vi=new b("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Wi=new b("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ui=new b("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),qi=new b("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Gi=new b("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Hi=new b("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ji=new b("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),zi=new b("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Zi=new b("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ji=new b("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Xi=new b("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Yi=new b("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Qi=new b("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),$i=new b("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),es=new b("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ts=new b("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ns=new b("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),rs=new b("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),os=new b("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),is=new b("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ss=new b("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),as=new b("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),cs=new b("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),us=new b("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ls=new b("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),ps=new b("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),ms=new b("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),ds=new b("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var fs={OPEN_BOOK_PROGRAM:new b("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new b("Ray1111111111111111111111111111111111111111"),AMM_V4:new b("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new b("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new b("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new b("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new b("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new b("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new b("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new b("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new b("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new b("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:b.default,Router:new b("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new b("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new b("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new b("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new b("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new b("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new b("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new b("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new b("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new b("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new b("Ray1111111111111111111111111111111111111111")};import ys from"bn.js";import{PublicKey as Ze,AddressLookupTableAccount as ie}from"@solana/web3.js";async function Je({connection:n,address:e,cluster:t="mainnet"}){let r=await xt(n,[...new Set(e.map(s=>s.toString()))].map(s=>new Ze(s))),o={};for(let s=0;s<e.length;s++){let a=r[s],i=e[s];if(!a)continue;let m=new ie({key:i,state:ie.deserialize(a.data)});o[i.toString()]=m,t==="devnet"?oe[i.toString()]=m:Re[i.toString()]=m}return o}var Re={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ie({key:new Ze("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ie.deserialize(Buffer.from("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","base64"))})},oe={},Xe=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(oe[e])return oe;let t=new Ze(e),r=await n.getAccountInfo(t);return r&&(oe[e]=new ie({key:t,state:ie.deserialize(r.data)})),oe};import{PublicKey as se,sendAndConfirmTransaction as Ye,SystemProgram as kn,Transaction as ge,TransactionMessage as he,VersionedTransaction as ye}from"@solana/web3.js";import Sn from"axios";var _e=2e3,De=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await Sn.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Ie(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(kn.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new se(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(F.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:a=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...a.filter(i=>i!==se.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(K({},t||{})):this.build(t)}build(e){var r;let t=new ge;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var f;let{recentBlockHash:s,skipPreflight:a=!0,sendAndConfirm:i,notSendToRpc:m}=o||{},p=s!=null?s:await re(this.connection,this.blockhashCommitment);if(t.recentBlockhash=p,this.signers.length&&t.sign(...this.signers),ee([t]),(f=this.owner)!=null&&f.isKeyPair)return{txId:i?await Ye(this.connection,t,this.signers.find(g=>g.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:a}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:a}),signedTx:t};if(this.signAllTransactions){let c=await this.signAllTransactions([t]);if(this.signers.length)for(let g of c)try{g.sign(...this.signers)}catch{}return{txId:m?"":await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:a}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var p;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:o}=this.build(r),s=t.filter(f=>f.transaction.instructions.length>0),a=[o,...s.map(f=>f.transaction)],i=[this.signers,...s.map(f=>f.signers)],m=[...this.instructionTypes,...s.map(f=>f.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&i.forEach(f=>{f.some(c=>c.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:i,instructionTypes:m,execute:async f=>{var I;let{sequentially:c,onTxUpdate:g,skipTxCount:d=0,recentBlockHash:u,skipPreflight:T=!0}=f||{},h=u!=null?u:await re(this.connection,this.blockhashCommitment);if((I=this.owner)!=null&&I.isKeyPair){if(c){let w=[],P=0;for(let y of a){if(++P,P<=d)continue;let l=await Ye(this.connection,y,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});w.push(l)}return{txIds:w,signedTxs:a}}return{txIds:await await Promise.all(a.map(async w=>(w.recentBlockhash=h,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:T})))),signedTxs:a}}if(this.signAllTransactions){let w=a.map((y,l)=>(y.recentBlockhash=h,i[l].length&&y.sign(...i[l]),y));ee(w);let P=await this.signAllTransactions(w);if(c){let y=0,l=[],x=async()=>{if(!P[y])return;let k=await this.connection.sendRawTransaction(P[y].serialize(),{skipPreflight:T});l.push({txId:k,status:"sent",signedTx:P[y]}),g==null||g([...l]),y++;let A=!1,L=null,R=null,M=C=>{L!==null&&clearInterval(L),R!==null&&this.connection.removeSignatureListener(R);let _=l.findIndex(E=>E.txId===k);if(_>-1){if(l[_].status==="error"||l[_].status==="success")return;l[_].status=C.err?"error":"success"}g==null||g([...l]),C.err||x()};this.loopMultiTxStatus&&(L=setInterval(async()=>{var C;if(A){clearInterval(L);return}try{let _=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(A=!0,clearInterval(L),M({err:((C=_.meta)==null?void 0:C.err)||null}),console.log("tx status from getTransaction:",k))}catch(_){A=!0,clearInterval(L),console.error("getTransaction timeout:",_,k)}},_e)),R=this.connection.onSignature(k,C=>{if(A){this.connection.removeSignatureListener(R);return}A=!0,M(C)},"confirmed"),this.connection.getSignatureStatus(k)};return await x(),{txIds:l.map(k=>k.txId),signedTxs:P}}else{let y=[];for(let l=0;l<P.length;l+=1){let x=await this.connection.sendRawTransaction(P[l].serialize(),{skipPreflight:T});y.push(x)}return{txIds:y,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var T;let u=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:o,recentBlockhash:s}=u,a=$(u,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=K(K({},this.cluster==="devnet"?await Xe(this.connection):Re),t),m=Array.from(new Set([...r,...this.lookupTableAddress])),p=[];for(let h of m)i[h]===void 0&&p.push(new se(h));let f=await Je({connection:this.connection,address:p});for(let[h,I]of Object.entries(f))i[h]=I;let c=o?se.default.toBase58():s!=null?s:await re(this.connection,this.blockhashCommitment),g=new he({payerKey:this.feePayer,recentBlockhash:c,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((T=this.owner)==null?void 0:T.signer)&&!this.signers.some(h=>h.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new ye(g);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async h=>{var y;let{skipPreflight:I=!0,sendAndConfirm:w,notSendToRpc:P}=h||{};if(ee([d]),(y=this.owner)!=null&&y.isKeyPair){let l=await this.connection.sendTransaction(d,{skipPreflight:I});return w&&await Le(this.connection,l),{txId:l,signedTx:d}}if(this.signAllTransactions){let l=await this.signAllTransactions([d]);if(this.signers.length)for(let x of l)try{x.sign(this.signers)}catch{}return{txId:P?"":await this.connection.sendTransaction(l[0],{skipPreflight:I}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){var p;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:o}=await this.buildV0(r),s=t.filter(f=>f.builder.instructions.length>0),a=[o,...s.map(f=>f.transaction)],i=[this.signers,...s.map(f=>f.signers)],m=[...this.instructionTypes,...s.map(f=>f.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&i.forEach(f=>{f.some(c=>c.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),a.forEach(async(f,c)=>{f.sign(i[c])}),{builder:this,transactions:a,signers:i,instructionTypes:m,buildProps:r,execute:async f=>{var T;let{sequentially:c,onTxUpdate:g,recentBlockHash:d,skipPreflight:u=!0}=f||{};if(d&&a.forEach(h=>h.message.recentBlockhash=d),ee(a),(T=this.owner)!=null&&T.isKeyPair){if(c){let h=[];for(let I of a){let w=await this.connection.sendTransaction(I,{skipPreflight:u});await Le(this.connection,w),h.push(w)}return{txIds:h,signedTxs:a}}return{txIds:await Promise.all(a.map(async h=>await this.connection.sendTransaction(h,{skipPreflight:u}))),signedTxs:a}}if(this.signAllTransactions){let h=await this.signAllTransactions(a);if(c){let I=0,w=[],P=async()=>{if(!h[I])return;let y=await this.connection.sendTransaction(h[I],{skipPreflight:u});w.push({txId:y,status:"sent",signedTx:h[I]}),g==null||g([...w]),I++;let l=!1,x=null,k=null,A=L=>{x!==null&&clearInterval(x),k!==null&&this.connection.removeSignatureListener(k);let R=w.findIndex(M=>M.txId===y);if(R>-1){if(w[R].status==="error"||w[R].status==="success")return;w[R].status=L.err?"error":"success"}g==null||g([...w]),L.err||P()};this.loopMultiTxStatus&&(x=setInterval(async()=>{var L;if(l){clearInterval(x);return}try{let R=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(l=!0,clearInterval(x),A({err:((L=R.meta)==null?void 0:L.err)||null}),console.log("tx status from getTransaction:",y))}catch(R){l=!0,clearInterval(x),console.error("getTransaction timeout:",R,y)}},_e)),k=this.connection.onSignature(y,L=>{if(l){this.connection.removeSignatureListener(k);return}l=!0,A(L)},"confirmed"),this.connection.getSignatureStatus(y)};return P(),{txIds:[],signedTxs:h}}else{let I=[];for(let w=0;w<h.length;w+=1){let P=await this.connection.sendTransaction(h[w],{skipPreflight:u});I.push(P)}return{txIds:I,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var g;let c=e||{},{splitIns:t=[],computeBudgetConfig:r}=c,o=$(c,["splitIns","computeBudgetConfig"]),s=r?Ie(r):{instructions:[],instructionTypes:[]},a=this.signers.reduce((d,u)=>j(K({},d),{[u.publicKey.toBase58()]:u}),{}),i=[],m=[],p=[],f=0;if(this.allInstructions.forEach(d=>{let u=[...p,d],T=r?[...s.instructions,...u]:u,I=[...new Set(u.map(w=>w.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(w=>new se(w));if(d!==t[f]&&p.length<12&&(de({instructions:T,payer:this.feePayer,signers:I})||de({instructions:u,payer:this.feePayer,signers:I})))p.push(d);else{if(p.length===0)throw Error("item ins too big");f+=d===t[f]?1:0,de({instructions:r?[...s.instructions,...p]:[...p],payer:this.feePayer,signers:I})?i.push(new ge().add(...s.instructions,...p)):i.push(new ge().add(...p)),m.push(Array.from(new Set(p.map(w=>w.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat())).map(w=>a[w]).filter(w=>w!==void 0)),p=[d]}}),p.length>0){let u=[...new Set(p.map(T=>T.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(T=>a[T]).filter(T=>T!==void 0);de({instructions:r?[...s.instructions,...p]:[...p],payer:this.feePayer,signers:u.map(T=>T.publicKey)})?i.push(new ge().add(...s.instructions,...p)):i.push(new ge().add(...p)),m.push(u)}return i.forEach(d=>d.feePayer=this.feePayer),(g=this.owner)!=null&&g.signer&&m.forEach(d=>{d.some(u=>u.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:i,signers:m,instructionTypes:this.instructionTypes,execute:async d=>{var y;let{sequentially:u,onTxUpdate:T,skipTxCount:h=0,recentBlockHash:I,skipPreflight:w=!0}=d||{},P=I!=null?I:await re(this.connection,this.blockhashCommitment);if(i.forEach(async(l,x)=>{l.recentBlockhash=P,m[x].length&&l.sign(...m[x])}),ee(i),(y=this.owner)!=null&&y.isKeyPair){if(u){let l=0,x=[];for(let k of i){if(++l,l<=h){x.push("tx skipped");continue}let A=await Ye(this.connection,k,this.signers.find(L=>L.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});x.push(A)}return{txIds:x,signedTxs:i}}return{txIds:await Promise.all(i.map(async l=>await this.connection.sendRawTransaction(l.serialize(),{skipPreflight:w}))),signedTxs:i}}if(this.signAllTransactions){let l=await this.signAllTransactions(i.slice(h,i.length)),x=[...i.slice(0,h),...l];if(u){let k=0,A=[],L=async()=>{if(!x[k])return;k<h&&(A.push({txId:"",status:"success",signedTx:x[k]}),T==null||T([...A]),k++,L());let R=await this.connection.sendRawTransaction(x[k].serialize(),{skipPreflight:w});A.push({txId:R,status:"sent",signedTx:x[k]}),T==null||T([...A]),k++;let M=!1,C=null,_=null,E=V=>{C!==null&&clearInterval(C),_!==null&&this.connection.removeSignatureListener(_);let O=A.findIndex(Y=>Y.txId===R);if(O>-1){if(A[O].status==="error"||A[O].status==="success")return;A[O].status=V.err?"error":"success"}T==null||T([...A]),V.err||L()};this.loopMultiTxStatus&&(C=setInterval(async()=>{var V;if(M){clearInterval(C);return}try{let O=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(M=!0,clearInterval(C),E({err:((V=O.meta)==null?void 0:V.err)||null}),console.log("tx status from getTransaction:",R))}catch(O){M=!0,clearInterval(C),console.error("getTransaction timeout:",O,R)}},_e)),_=this.connection.onSignature(R,V=>{if(M){this.connection.removeSignatureListener(_);return}M=!0,E(V)},"confirmed"),this.connection.getSignatureStatus(R)};return await L(),{txIds:A.map(R=>R.txId),signedTxs:x}}else{let k=[];for(let A=0;A<x.length;A+=1){let L=await this.connection.sendRawTransaction(x[A].serialize(),{skipPreflight:w});k.push(L)}return{txIds:k,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var P;let w=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:o={},lookupTableAddress:s=[]}=w,a=$(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=K(K({},this.cluster==="devnet"?await Xe(this.connection):Re),o),m=Array.from(new Set([...this.lookupTableAddress,...s])),p=[];for(let y of m)i[y]===void 0&&p.push(new se(y));let f=await Je({connection:this.connection,address:p});for(let[y,l]of Object.entries(f))i[y]=l;let c=t?Ie(t):{instructions:[],instructionTypes:[]},g=await re(this.connection,this.blockhashCommitment),d=this.signers.reduce((y,l)=>j(K({},y),{[l.publicKey.toBase58()]:l}),{}),u=[],T=[],h=[],I=0;if(this.allInstructions.forEach(y=>{let l=[...h,y],x=t?[...c.instructions,...l]:l;if(y!==r[I]&&h.length<12&&(fe({instructions:x,payer:this.feePayer,lookupTableAddressAccount:i})||fe({instructions:l,payer:this.feePayer,lookupTableAddressAccount:i})))h.push(y);else{if(h.length===0)throw Error("item ins too big");I+=y===r[I]?1:0;let k={};for(let A of[...new Set(m)])i[A]!==void 0&&(k[A]=i[A]);if(t&&fe({instructions:[...c.instructions,...h],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:g})){let A=new he({payerKey:this.feePayer,recentBlockhash:g,instructions:[...c.instructions,...h]}).compileToV0Message(Object.values(i));u.push(new ye(A))}else{let A=new he({payerKey:this.feePayer,recentBlockhash:g,instructions:[...h]}).compileToV0Message(Object.values(i));u.push(new ye(A))}T.push(Array.from(new Set(h.map(A=>A.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(A=>d[A]).filter(A=>A!==void 0)),h=[y]}}),h.length>0){let l=[...new Set(h.map(x=>x.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(x=>d[x]).filter(x=>x!==void 0);if(t&&fe({instructions:[...c.instructions,...h],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:g})){let x=new he({payerKey:this.feePayer,recentBlockhash:g,instructions:[...c.instructions,...h]}).compileToV0Message(Object.values(i));u.push(new ye(x))}else{let x=new he({payerKey:this.feePayer,recentBlockhash:g,instructions:[...h]}).compileToV0Message(Object.values(i));u.push(new ye(x))}T.push(l)}return(P=this.owner)!=null&&P.signer&&T.forEach(y=>{y.some(l=>l.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),u.forEach((y,l)=>{y.sign(T[l])}),{builder:this,transactions:u,buildProps:e,signers:T,instructionTypes:this.instructionTypes,execute:async y=>{var R;let{sequentially:l,onTxUpdate:x,skipTxCount:k=0,recentBlockHash:A,skipPreflight:L=!0}=y||{};if(u.map(async(M,C)=>{T[C].length&&M.sign(T[C]),A&&(M.message.recentBlockhash=A)}),ee(u),(R=this.owner)!=null&&R.isKeyPair){if(l){let M=0,C=[];for(let _ of u){if(++M,M<=k){console.log("skip tx: ",M),C.push("tx skipped");continue}let E=await this.connection.sendTransaction(_,{skipPreflight:L});await Le(this.connection,E),C.push(E)}return{txIds:C,signedTxs:u}}return{txIds:await Promise.all(u.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:L}))),signedTxs:u}}if(this.signAllTransactions){let M=await this.signAllTransactions(u.slice(k,u.length)),C=[...u.slice(0,k),...M];if(l){let _=0,E=[],V=async()=>{if(!C[_])return;if(_<k){E.push({txId:"",status:"success",signedTx:C[_]}),x==null||x([...E]),_++,V();return}let O=await this.connection.sendTransaction(C[_],{skipPreflight:L});E.push({txId:O,status:"sent",signedTx:C[_]}),x==null||x([...E]),_++;let Y=!1,te=null,Pe=null,dt=Q=>{te!==null&&clearInterval(te),Pe!==null&&this.connection.removeSignatureListener(Pe);let q=E.findIndex(Zt=>Zt.txId===O);if(q>-1){if(E[q].status==="error"||E[q].status==="success")return;E[q].status=Q.err?"error":"success"}x==null||x([...E]),Q.err||V()};this.loopMultiTxStatus&&(te=setInterval(async()=>{var Q;if(Y){clearInterval(te);return}try{let q=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});q&&(Y=!0,clearInterval(te),dt({err:((Q=q.meta)==null?void 0:Q.err)||null}),console.log("tx status from getTransaction:",O))}catch(q){Y=!0,clearInterval(te),console.error("getTransaction timeout:",q,O)}},_e)),Pe=this.connection.onSignature(O,Q=>{if(Y){this.connection.removeSignatureListener(Pe);return}Y=!0,dt(Q)},"confirmed"),this.connection.getSignatureStatus(O)};return V(),{txIds:[],signedTxs:C}}else{let _=[];for(let E=0;E<C.length;E+=1){let V=await this.connection.sendTransaction(C[E],{skipPreflight:L});_.push(V)}return{txIds:_,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}};import Bn from"bn.js";var Fs=new Bn(1e6);import{AccountLayout as ce,createAssociatedTokenAccountIdempotentInstruction as pt,TOKEN_PROGRAM_ID as X,TOKEN_2022_PROGRAM_ID as zn}from"@solana/spl-token";var Qe=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),be=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=v(t)}createTxBuilder(e){return this.scope.checkOwner(),new De({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Qe(e))}logInfo(...e){this.logger.info(Qe(e))}logAndCreateError(...e){let t=Qe(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Vn,SystemProgram as Wn}from"@solana/web3.js";import Un from"bn.js";import{createCloseAccountInstruction as qn,createInitializeAccountInstruction as Gn,createTransferInstruction as Hn,TOKEN_PROGRAM_ID as ae}from"@solana/spl-token";import{Keypair as Kn,PublicKey as Ht}from"@solana/web3.js";import Fn from"bn.js";import{TOKEN_PROGRAM_ID as On}from"@solana/spl-token";function In(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function $e(n,...e){if(!In(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}function et(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Kt(n,e){$e(n);let t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Me=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),U=(n,e)=>n<<32-e|n>>>e;var la=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ln(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function tt(n){return typeof n=="string"&&(n=Ln(n)),$e(n),n}var Ne=class{clone(){return this._cloneInto()}},pa={}.toString;function Ft(n){let e=r=>n().update(tt(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Cn(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);let o=BigInt(32),s=BigInt(4294967295),a=Number(t>>o&s),i=Number(t&s),m=r?4:0,p=r?0:4;n.setUint32(e+m,a,r),n.setUint32(e+p,i,r)}var Ot=(n,e,t)=>n&e^~n&t,vt=(n,e,t)=>n&e^n&t^e&t,Ee=class extends Ne{constructor(e,t,r,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Me(this.buffer)}update(e){et(this);let{view:t,buffer:r,blockLen:o}=this;e=tt(e);let s=e.length;for(let a=0;a<s;){let i=Math.min(o-this.pos,s-a);if(i===o){let m=Me(e);for(;o<=s-a;a+=o)this.process(m,a);continue}r.set(e.subarray(a,a+i),this.pos),this.pos+=i,a+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){et(this),Kt(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(r,0),a=0);for(let c=a;c<o;c++)t[c]=0;Cn(r,o-8,BigInt(this.length*8),s),this.process(r,0);let i=Me(e),m=this.outputLen;if(m%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let p=m/4,f=this.get();if(p>f.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<p;c++)i.setUint32(4*c,f[c],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:o,finished:s,destroyed:a,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=a,o%t&&e.buffer.set(r),e}};var Rn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Z=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),J=new Uint32Array(64),nt=class extends Ee{constructor(){super(64,32,8,!1),this.A=Z[0]|0,this.B=Z[1]|0,this.C=Z[2]|0,this.D=Z[3]|0,this.E=Z[4]|0,this.F=Z[5]|0,this.G=Z[6]|0,this.H=Z[7]|0}get(){let{A:e,B:t,C:r,D:o,E:s,F:a,G:i,H:m}=this;return[e,t,r,o,s,a,i,m]}set(e,t,r,o,s,a,i,m){this.A=e|0,this.B=t|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=i|0,this.H=m|0}process(e,t){for(let c=0;c<16;c++,t+=4)J[c]=e.getUint32(t,!1);for(let c=16;c<64;c++){let g=J[c-15],d=J[c-2],u=U(g,7)^U(g,18)^g>>>3,T=U(d,17)^U(d,19)^d>>>10;J[c]=T+J[c-7]+u+J[c-16]|0}let{A:r,B:o,C:s,D:a,E:i,F:m,G:p,H:f}=this;for(let c=0;c<64;c++){let g=U(i,6)^U(i,11)^U(i,25),d=f+g+Ot(i,m,p)+Rn[c]+J[c]|0,T=(U(r,2)^U(r,13)^U(r,22))+vt(r,o,s)|0;f=p,p=m,m=i,i=a+d|0,a=s,s=o,o=r,r=d+T|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,i=i+this.E|0,m=m+this.F|0,p=p+this.G|0,f=f+this.H|0,this.set(r,o,s,a,i,m,p,f)}roundClean(){J.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Vt=Ft(()=>new nt);import{PublicKey as En}from"@solana/web3.js";import Ut,{isBN as xc}from"bn.js";import{bits as Ta,BitStructure as wa,blob as _n,Blob as Pa,cstr as Aa,f32 as ka,f32be as Sa,f64 as Ba,f64be as Ia,greedy as La,Layout as Dn,ns64 as Ca,ns64be as Ra,nu64 as _a,nu64be as Da,offset as Na,s16 as Ma,s16be as Ea,s24 as Ka,s24be as Fa,s32 as Oa,s32be as va,s40 as Va,s40be as Wa,s48 as Ua,s48be as qa,s8 as Ga,seq as Ha,struct as ja,Structure as Nn,u16 as za,u16be as Za,u24 as Ja,u24be as Xa,u32 as Ya,u32be as Qa,u40 as $a,u40be as ec,u48 as tc,u48be as nc,u8 as rc,UInt as Mn,union as oc,Union as ic,unionLayoutDiscriminator as sc,utf8 as ac}from"@solana/buffer-layout";var rt=Dn,Wt=Nn;var ot=Mn;var it=_n;var st=class extends rt{constructor(t,r,o){super(t,o);this.blob=it(t),this.signed=r}decode(t,r=0){let o=new Ut(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new Ut(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}};function qt(n){return new ot(1,n)}function Ke(n){return new ot(4,n)}function Fe(n){return new st(8,!1,n)}var at=class extends rt{constructor(t,r,o,s){super(t.span,s);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function xe(n){return new at(it(32),e=>new En(e),e=>e.toBuffer(),n)}var ct=class extends Wt{decode(e,t){return super.decode(e,t)}};function Gt(n,e,t){return new ct(n,e,t)}var Te=Gt([xe("mint"),xe("owner"),Fe("amount"),Ke("delegateOption"),xe("delegate"),qt("state"),Ke("isNativeOption"),Fe("isNative"),Fe("delegatedAmount"),Ke("closeAuthorityOption"),xe("closeAuthority")]);var Mc=v("Raydium_Util");function jt({owner:n,solAccountResp:e,tokenAccountResp:t}){let r=[],o=[];for(let{pubkey:s,account:a}of t.value){let i=Te.decode(a.data),{mint:m,amount:p}=i;r.push({publicKey:s,mint:m,amount:p,isAssociated:Ce(n,m,a.owner).publicKey.equals(s),isNative:!1,programId:a.owner}),o.push({pubkey:s,accountInfo:i,programId:a.owner})}return e&&r.push({mint:Ht.default,amount:new Fn(String(e.lamports)),isNative:!0,programId:e.owner}),{tokenAccounts:r,tokenAccountRawInfos:o}}function Oe({fromPublicKey:n,programId:e=On,assignSeed:t}){let r=t?btoa(t).slice(0,32):Kn.generate().publicKey.toBase58().slice(0,32);return{publicKey:vn(n,r,e),seed:r}}function vn(n,e,t){let r=Buffer.concat([n.toBuffer(),Buffer.from(e),t.toBuffer()]),o=Vt(r);return new Ht(o)}function ut(n){let{mint:e,tokenAccount:t,owner:r,programId:o=ae}=n;return Gn(t,e,r,o)}function we(n){let{tokenAccount:e,payer:t,multiSigners:r=[],owner:o,programId:s=ae}=n;return qn(e,t,o,r,s)}async function lt(n){let{connection:e,amount:t,commitment:r,payer:o,owner:s,skipCloseAccount:a}=n,i=await e.getMinimumBalanceForRentExemption(Te.span,r),m=W(t).add(new Un(i)),p=Oe({fromPublicKey:o,programId:ae});return{addresses:{newAccount:p.publicKey},signers:[],instructions:[Wn.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:p.seed,newAccountPubkey:p.publicKey,lamports:m.toNumber(),space:Te.span,programId:ae}),ut({mint:new Vn(G.address),tokenAccount:p.publicKey,owner:s,programId:ae})],instructionTypes:[F.CreateAccount,F.InitAccount],endInstructionTypes:a?[]:[F.CloseAccount],endInstructions:a?[]:[we({tokenAccount:p.publicKey,payer:o,owner:s})]}}function zt({source:n,destination:e,owner:t,amount:r,multiSigners:o=[],tokenProgram:s=ae}){return Hn(n,e,t,BigInt(String(r)),o,s)}var mt=class extends be{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;this._notSubscribeAccountChange=!1;this._accountFetchTime=0;let{tokenAccounts:r,tokenAccountRawInfos:o,notSubscribeAccountChange:s}=t;this._tokenAccounts=r||[],this._tokenAccountRawInfos=o||[],this._notSubscribeAccountChange=s!=null?s:!0,this._clientOwnedToken=!!(r||o)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}set notSubscribeAccountChange(t){this._notSubscribeAccountChange=t}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:r}){return t&&(this._tokenAccounts=t),r&&(this._tokenAccountRawInfos=r),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(r=>r!==t),this}getAssociatedTokenAccount(t,r){return Ce(this.scope.ownerPubKey,t,r).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<(this._notSubscribeAccountChange?1e3*5:1e3*60*3))return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let o=K(K({},{}),t),[s,a,i]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:X},o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:zn},o.commitment)]),{tokenAccounts:m,tokenAccountRawInfos:p}=jt({owner:this.scope.ownerPubKey,solAccountResp:s,tokenAccountResp:{context:a.context,value:[...a.value,...i.value]}});return this._tokenAccounts=m,this._tokenAccountRawInfos=p,this._accountFetchTime=Date.now(),this._notSubscribeAccountChange||(this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>{this.fetchWalletTokenAccounts({forceUpdate:!0}),this._accountListener.forEach(f=>f({tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos}))},{commitment:t==null?void 0:t.commitment})),{tokenAccounts:m,tokenAccountRawInfos:p}}clearAccountChangeCkb(){this._accountChangeListenerId!==void 0&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId)}async getCreatedTokenAccount({mint:t,programId:r=X,associatedOnly:o=!0}){await this.fetchWalletTokenAccounts();let s=this._tokenAccounts.filter(({mint:i})=>i==null?void 0:i.equals(t)).sort((i,m)=>i.amount.lt(m.amount)?1:-1),a=this.getAssociatedTokenAccount(t,r);for(let i of s){let{publicKey:m}=i;if(m&&(!o||o&&a.equals(m)))return m}}async getOrCreateTokenAccount(t){var T,h,I,w;await this.fetchWalletTokenAccounts();let{mint:r,createInfo:o,associatedOnly:s,owner:a,notUseTokenAccount:i=!1,skipCloseAccount:m=!1,checkCreateATAOwner:p=!1,assignSeed:f}=t,c=new ve(t.tokenProgram||X),g=this.getAssociatedTokenAccount(r,new ve(c)),d=(i?[]:this.tokenAccountRawInfos).filter(P=>P.accountInfo.mint.equals(r)&&(!s||P.pubkey.equals(g))).sort((P,y)=>P.accountInfo.amount.lt(y.accountInfo.amount)?1:-1);if(o===void 0||d.length>0)return d.length>0?{account:d[0].pubkey}:{};let u={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(s){let P=pt(a,g,a,r,c),y=this.tokenAccountRawInfos.find(l=>l.pubkey.equals(g));if(p){let l=await this.scope.connection.getAccountInfo(g);if(l===null)(T=u.instructions)==null||T.push(P),u.instructionTypes.push(F.CreateATA);else if(!(l.owner.equals(c)&&ce.decode(l.data).mint.equals(r)&&ce.decode(l.data).owner.equals(a)))throw Error(`create ata check error -> mint: ${r.toString()}, ata: ${g.toString()}`)}else y===void 0&&(u.instructions.push(P),u.instructionTypes.push(F.CreateATA));if(r.equals(z)&&o.amount){let l=await lt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:o.payer||this.scope.ownerPubKey,amount:(h=o.amount)!=null?h:0,skipCloseAccount:m});u.instructions.push(...l.instructions||[]),u.endInstructions.push(...l.endInstructions||[]),u.instructionTypes.push(...l.instructionTypes||[]),u.endInstructionTypes.push(...l.endInstructionTypes||[]),o.amount&&(u.instructions.push(zt({source:l.addresses.newAccount,destination:g,owner:this.scope.ownerPubKey,amount:o.amount,tokenProgram:X})),u.instructionTypes.push(F.TransferAmount))}return!m&&y===void 0&&(u.endInstructions.push(we({owner:a,payer:o.payer||a,tokenAccount:g,programId:c})),u.endInstructionTypes.push(F.CloseAccount)),{account:g,instructionParams:u}}else{let P=Oe({fromPublicKey:a,programId:c,assignSeed:f}),y=await this.scope.connection.getMinimumBalanceForRentExemption(ce.span),l=jn.createAccountWithSeed({fromPubkey:a,basePubkey:a,seed:P.seed,newAccountPubkey:P.publicKey,lamports:y+Number((w=(I=o.amount)==null?void 0:I.toString())!=null?w:0),space:ce.span,programId:c});return u.instructions.push(l,ut({mint:r,tokenAccount:P.publicKey,owner:this.scope.ownerPubKey,programId:c})),u.instructionTypes.push(F.CreateAccount),u.instructionTypes.push(F.InitAccount),m||(u.endInstructions.push(we({owner:a,payer:o.payer||a,tokenAccount:P.publicKey,programId:c})),u.endInstructionTypes.push(F.CloseAccount)),{account:P.publicKey,instructionParams:u}}}async checkOrCreateAta({mint:t,programId:r=X,autoUnwrapWSOLToSOL:o}){var m;await this.fetchWalletTokenAccounts();let s=(m=this.scope.account.tokenAccounts.find(({mint:p})=>(p==null?void 0:p.toBase58())===t.toBase58()))==null?void 0:m.publicKey,a=this.scope.ownerPubKey,i={};if(!s){let p=this.getAssociatedTokenAccount(t,r),f=await pt(a,p,a,t,r);i.instructions=[f],i.instructionTypes=[F.CreateATA],s=p}return o&&z.toBase58()===t.toBase58()&&(i.endInstructions=[we({owner:a,payer:a,tokenAccount:s,programId:r})],i.endInstructionTypes=[F.CloseAccount]),{pubKey:s,newInstructions:i}}async handleTokenAccount(t){let{side:r,amount:o,mint:s,programId:a=X,tokenAccount:i,payer:m=this.scope.ownerPubKey,bypassAssociatedCheck:p,skipCloseAccount:f,checkCreateATAOwner:c}=t,g=this.getAssociatedTokenAccount(s,a);if(new ve(z).equals(s)){let d=await lt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:m,amount:o,skipCloseAccount:f});return K({tokenAccount:d.addresses.newAccount},d)}else if(!i||r==="out"&&!g.equals(i)&&!p){let d=[],u=pt(this.scope.ownerPubKey,g,this.scope.ownerPubKey,s,a);if(c){let T=await this.scope.connection.getAccountInfo(g);if(T===null)d.push(u);else if(!(T.owner.equals(X)&&ce.decode(T.data).mint.equals(s)&&ce.decode(T.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${s.toString()}, ata: ${g.toString()}`)}else d.push(u);return{tokenAccount:g,instructions:d,instructionTypes:[F.CreateATA]}}return{tokenAccount:i}}async processTokenAccount(t){let{mint:r,programId:o=X,amount:s,useSOLBalance:a,handleTokenAccount:i,feePayer:m}=t,p,f=this.createTxBuilder(m);if(r.equals(new ve(z))&&a){let c=await this.handleTokenAccount({side:"in",amount:s||0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:d}=c,u=$(c,["tokenAccount"]);p=d,f.addInstruction(u)}else if(p=await this.getCreatedTokenAccount({mint:r,associatedOnly:!1,programId:o}),!p&&i){let g=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:d}=g,u=$(g,["tokenAccount"]);p=d,f.addInstruction(u)}return K({tokenAccount:p},f.AllTxData)}};export{mt as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.mjs.map