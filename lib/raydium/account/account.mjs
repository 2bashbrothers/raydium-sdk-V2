var Xt=Object.defineProperty,Qt=Object.defineProperties;var Yt=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable;var ht=(r,e,t)=>e in r?Xt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,O=(r,e)=>{for(var t in e||(e={}))yt.call(e,t)&&ht(r,t,e[t]);if(_e)for(var t of _e(e))bt.call(e,t)&&ht(r,t,e[t]);return r},Z=(r,e)=>Qt(r,Yt(e));var te=(r,e)=>{var t={};for(var n in r)yt.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&_e)for(var n of _e(r))e.indexOf(n)<0&&bt.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as qe,SystemProgram as zn}from"@solana/web3.js";import{PublicKey as tn}from"@solana/web3.js";import{get as xt,set as $t}from"lodash";var He=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Tt={},en={};function W(r){let e=xt(Tt,r);if(!e){let t=xt(en,r);e=new He({name:r,logLevel:t}),$t(Tt,r,e)}return e}import{MINT_SIZE as sr,TOKEN_PROGRAM_ID as ir,getTransferFeeConfig as ar,unpackMint as cr}from"@solana/spl-token";var je=W("Raydium_accountInfo_util");async function wt(r,e,t){let{batchRequest:n,commitment:s="confirmed",chunkCount:a=100}=O({batchRequest:!1},t),i=ze(e,a),o=new Array(i.length).fill([]);if(n){let f=i.map(l=>{let h=r._buildArgs([l.map(y=>y.toBase58())],s,"base64");return{methodName:"getMultipleAccounts",args:h}}),m=ze(f,10);o=(await(await Promise.all(m.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&je.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(h=>{if(h){let{data:y,executable:c,lamports:x,owner:g,rentEpoch:L}=h;return y.length!==2&&y[1]!=="base64"&&je.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(y[0],"base64"),executable:c,lamports:x,owner:new tn(g),rentEpoch:L}}return null})))}else try{o=await Promise.all(i.map(f=>r.getMultipleAccountsInfo(f,s)))}catch(f){f instanceof Error&&je.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return o.flat()}import Q from"bn.js";import ts from"decimal.js";import ln from"big.js";import Ir from"bn.js";import nn from"toformat";var rn=nn,ge=rn;import Ne from"big.js";import sn from"bn.js";import an from"decimal.js-light";import he from"bn.js";var Pt=9007199254740991;function H(r){let e=W("Raydium_parseBigNumberish");if(r instanceof he)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new he(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Pt||r<=-Pt)&&e.logWithError(`BigNumberish number overflow: ${r}`),new he(String(r))):typeof r=="bigint"?new he(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new he(0))}var De=W("module/fraction"),Je=ge(Ne),ye=ge(an),cn={[0]:ye.ROUND_DOWN,[1]:ye.ROUND_HALF_UP,[2]:ye.ROUND_UP},un={[0]:Ne.roundDown,[1]:Ne.roundHalfUp,[2]:Ne.roundUp},K=class{constructor(e,t=new sn(1)){this.numerator=H(e),this.denominator=H(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new K(this.denominator,this.numerator)}add(e){let t=e instanceof K?e:new K(H(e));return this.denominator.eq(t.denominator)?new K(this.numerator.add(t.numerator),this.denominator):new K(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof K?e:new K(H(e));return this.denominator.eq(t.denominator)?new K(this.numerator.sub(t.numerator),this.denominator):new K(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof K?e:new K(H(e));return new K(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof K?e:new K(H(e));return new K(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||De.logWithError(`${e} is not an integer.`),e<=0&&De.logWithError(`${e} is not positive.`),ye.set({precision:e+1,rounding:cn[n]});let s=new ye(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return s.toFormat(s.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||De.logWithError(`${e} is not an integer.`),e<0&&De.logWithError(`${e} is negative.`),Je.DP=e,Je.RM=un[n]||1,new Je(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Kr=W("Raydium_amount"),Er=ge(ln);import{PublicKey as mn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as At}from"@solana/spl-token";var kt={chainId:101,address:mn.default.toBase58(),programId:At.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},X={chainId:101,address:"So11111111111111111111111111111111111111112",programId:At.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Xe}from"@solana/web3.js";import{PublicKey as E,SystemProgram as St,SYSVAR_RENT_PUBKEY as dn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fn}from"@solana/spl-token";function Ze({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Gr=[Ze({pubkey:fn,isWritable:!1}),Ze({pubkey:St.programId,isWritable:!1}),Ze({pubkey:dn,isWritable:!1})];function It({publicKey:r,transformSol:e}){let t=Bt(r.toString());if(t instanceof E)return e&&t.equals(be)?ne:t;if(e&&t.toString()===be.toBase58())return ne;if(typeof t=="string"){if(t===E.default.toBase58())return E.default;try{return new E(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Bt(r){try{return new E(r)}catch{return r}}var Hr=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),jr=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),zr=new E("SysvarRent111111111111111111111111111111111"),Jr=new E("SysvarC1ock11111111111111111111111111111111"),Zr=new E("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Xr=new E("Sysvar1nstructions1111111111111111111111111"),Qr=St.programId,Yr=new E("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),$r=new E("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),eo=new E("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),to=new E("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),no=new E("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ro=new E("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),oo=new E("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),so=new E("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),io=new E("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ao=new E("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),co=new E("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ne=new E("So11111111111111111111111111111111111111112"),be=E.default;var Qe=class{constructor({mint:e,decimals:t,symbol:n,name:s,skipMint:a=!1,isToken2022:i=!1}){if(e===be.toBase58()||e instanceof Xe&&be.equals(e)){this.decimals=X.decimals,this.symbol=X.symbol,this.name=X.name,this.mint=new Xe(X.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=s||e.toString().substring(0,6),this.mint=a?Xe.default:It({publicKey:e}),this.isToken2022=i}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ue=Qe;ue.WSOL=new Qe(Z(O({},X),{mint:X.address}));var Ye=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Me=Ye;Me.SOL=new Ye(kt);import gn from"bn.js";var wo=new K(new gn(100));var Bo=W("Raydium_price");import{PublicKey as Go}from"@solana/web3.js";import jo from"bn.js";var hn=new Q(0),ps=new Q(1),ms=new Q(2),ds=new Q(3),fs=new Q(5),pn=new Q(10),gs=new Q(100),hs=new Q(1e3),ys=new Q(1e4);function ze(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var z=class{constructor(e){this._owner=e}get publicKey(){return z.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return z.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return z.isKeyPair(this._owner)}get isPublicKey(){return z.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!z.isKeyPair(e)}};import{PublicKey as An}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as kn}from"@solana/spl-token";import{ComputeBudgetProgram as _t,Keypair as Nt,PublicKey as yn,Transaction as Mt,TransactionMessage as bn,VersionedTransaction as Kt}from"@solana/web3.js";var F={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as xn}from"@solana/spl-token";var Dt=W("Raydium_txUtil"),Et=1644;function xe(r){let e=[],t=[];return r.microLamports&&(e.push(_t.setComputeUnitPrice({microLamports:r.microLamports})),t.push(F.SetComputeUnitPrice)),r.units&&(e.push(_t.setComputeUnitLimit({units:r.units})),t.push(F.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ae(r,e){var n,s;let t=e!=null?e:"confirmed";return(s=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:s.blockhash}async function Te(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let s=setTimeout(n,6e4);r.onSignature(e,a=>{if(clearTimeout(s),!a.err){t("");return}n(Object.assign(a.err,{txId:e}))},"confirmed")})}function Tn(r,e){r.length<1&&Dt.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Dt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Mt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Et}catch{return!1}}function Ot(r,e){let[t,n]=yn.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function we({instructions:r,payer:e,signers:t}){return Tn(r,[e,...t])}function Y({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Nt.generate().publicKey.toString()}){let a=new bn({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Kt(a).serialize()).toString("base64").length<Et}catch{return!1}}var wn=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Pn=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Kt&&(e=wn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function re(r){let e=[];return r.forEach(t=>{t instanceof Mt&&(t.recentBlockhash||(t.recentBlockhash=xn.toBase58()),t.feePayer||(t.feePayer=Nt.generate().publicKey)),e.push(Pn(t))}),console.log("simulate tx string:",e),e}function Pe(r,e,t){return Ot([r.toBuffer(),(t!=null?t:kn).toBuffer(),e.toBuffer()],new An("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as w}from"@solana/web3.js";var Fs=new w("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),vs=new w("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Vs=new w("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ws=new w("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Us=new w("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),qs=new w("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Gs=new w("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Hs=new w("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),js=new w("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),zs=new w("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Js=new w("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Zs=new w("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Xs=new w("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Qs=new w("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ys=new w("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$s=new w("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ei=new w("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ti=new w("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ni=new w("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ri=new w("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),oi=new w("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),si=new w("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ii=new w("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ai=new w("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ci=new w("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ui=new w("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),li=new w("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),pi=new w("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),mi=new w("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),di=new w("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),fi=new w("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var gi={OPEN_BOOK_PROGRAM:new w("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new w("Ray1111111111111111111111111111111111111111"),AMM_V4:new w("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new w("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new w("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new w("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new w("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new w("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new w("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new w("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new w("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new w("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:w.default,Router:new w("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new w("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new w("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new w("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new w("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new w("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new w("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new w("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new w("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new w("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new w("Ray1111111111111111111111111111111111111111")};import bi from"bn.js";import{PublicKey as $e,AddressLookupTableAccount as pe}from"@solana/web3.js";async function Ke({connection:r,address:e,cluster:t="mainnet"}){let n=await wt(r,[...new Set(e.map(a=>a.toString()))].map(a=>new $e(a))),s={};for(let a=0;a<e.length;a++){let i=n[a],o=e[a];if(!i)continue;let f=new pe({key:o,state:pe.deserialize(i.data)});s[o.toString()]=f,t==="devnet"?le[o.toString()]=f:Ae[o.toString()]=f}return s}var Ae={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new pe({key:new $e("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:pe.deserialize(Buffer.from("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","base64"))})},le={},Ee=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(le[e])return le;let t=new $e(e),n=await r.getAccountInfo(t);return n&&(le[e]=new pe({key:t,state:pe.deserialize(n.data)})),le};import{PublicKey as ce,sendAndConfirmTransaction as et,SystemProgram as Sn,Transaction as ke,TransactionMessage as $,VersionedTransaction as ee}from"@solana/web3.js";import In from"axios";var Se=2e3,Ie=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await In.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=xe(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Sn.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ce(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(F.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:s=[],endInstructionTypes:a=[],lookupTableAddress:i=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...s),this.endInstructionTypes.push(...a),this.lookupTableAddress.push(...i.filter(o=>o!==ce.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(O({},t||{})):this.build(t)}build(e){var n;let t=new ke;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(s=>s.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async s=>{var b;let{recentBlockHash:a,skipPreflight:i=!0,sendAndConfirm:o,notSendToRpc:f}=s||{},m=a!=null?a:await ae(this.connection,this.blockhashCommitment);if(t.recentBlockhash=m,this.signers.length&&t.sign(...this.signers),re([t]),(b=this.owner)!=null&&b.isKeyPair)return{txId:o?await et(this.connection,t,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:i}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:i}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);if(this.signers.length)for(let h of l)try{h.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:i}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var m;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:s}=this.build(n),a=t.filter(b=>b.transaction.instructions.length>0),i=[s,...a.map(b=>b.transaction)],o=[this.signers,...a.map(b=>b.signers)],f=[...this.instructionTypes,...a.map(b=>b.instructionTypes).flat()];return(m=this.owner)!=null&&m.signer&&o.forEach(b=>{b.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:i,signers:o,instructionTypes:f,execute:async b=>{var L;let{sequentially:l,onTxUpdate:h,skipTxCount:y=0,recentBlockHash:c,skipPreflight:x=!0}=b||{},g=c!=null?c:await ae(this.connection,this.blockhashCommitment);if((L=this.owner)!=null&&L.isKeyPair){if(l){let A=[],k=0;for(let p of i){if(++k,k<=y)continue;let u=await et(this.connection,p,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});A.push(u)}return{txIds:A,signedTxs:i}}return{txIds:await await Promise.all(i.map(async A=>(A.recentBlockhash=g,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:x})))),signedTxs:i}}if(this.signAllTransactions){let A=i.map((p,u)=>(p.recentBlockhash=g,o[u].length&&p.sign(...o[u]),p));re(A);let k=await this.signAllTransactions(A);if(l){let p=0,u=[],d=async()=>{if(!k[p])return;let P=await this.connection.sendRawTransaction(k[p].serialize(),{skipPreflight:x});u.push({txId:P,status:"sent",signedTx:k[p]}),h==null||h([...u]),p++;let T=!1,I=null,N=null,D=S=>{I!==null&&clearInterval(I),N!==null&&this.connection.removeSignatureListener(N);let B=u.findIndex(C=>C.txId===P);if(B>-1){if(u[B].status==="error"||u[B].status==="success")return;u[B].status=S.err?"error":"success"}h==null||h([...u]),S.err||d()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var S;if(T){clearInterval(I);return}try{let B=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(T=!0,clearInterval(I),D({err:((S=B.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",P))}catch(B){T=!0,clearInterval(I),console.error("getTransaction timeout:",B,P)}},Se)),N=this.connection.onSignature(P,S=>{if(T){this.connection.removeSignatureListener(N);return}T=!0,D(S)},"confirmed"),this.connection.getSignatureStatus(P)};return await d(),{txIds:u.map(P=>P.txId),signedTxs:k}}else{let p=[];for(let u=0;u<k.length;u+=1){let d=await this.connection.sendRawTransaction(k[u].serialize(),{skipPreflight:x});p.push(d)}return{txIds:p,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var x;let c=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:s,recentBlockhash:a}=c,i=te(c,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=O(O({},this.cluster==="devnet"?await Ee(this.connection):Ae),t),f=Array.from(new Set([...n,...this.lookupTableAddress])),m=[];for(let g of f)o[g]===void 0&&m.push(new ce(g));let b=await Ke({connection:this.connection,address:m});for(let[g,L]of Object.entries(b))o[g]=L;let l=s?ce.default.toBase58():a!=null?a:await ae(this.connection,this.blockhashCommitment),h=new $({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((x=this.owner)==null?void 0:x.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let y=new ee(h);return y.sign(this.signers),{builder:this,transaction:y,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var p;let{skipPreflight:L=!0,sendAndConfirm:A,notSendToRpc:k}=g||{};if(re([y]),(p=this.owner)!=null&&p.isKeyPair){let u=await this.connection.sendTransaction(y,{skipPreflight:L});return A&&await Te(this.connection,u),{txId:u,signedTx:y}}if(this.signAllTransactions){let u=await this.signAllTransactions([y]);if(this.signers.length)for(let d of u)try{d.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(u[0],{skipPreflight:L}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildV0MultiTx(e){var m;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:s}=await this.buildV0(n),a=t.filter(b=>b.builder.instructions.length>0),i=[s,...a.map(b=>b.transaction)],o=[this.signers,...a.map(b=>b.signers)],f=[...this.instructionTypes,...a.map(b=>b.instructionTypes).flat()];return(m=this.owner)!=null&&m.signer&&o.forEach(b=>{b.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),i.forEach(async(b,l)=>{b.sign(o[l])}),{builder:this,transactions:i,signers:o,instructionTypes:f,buildProps:n,execute:async b=>{var x;let{sequentially:l,onTxUpdate:h,recentBlockHash:y,skipPreflight:c=!0}=b||{};if(y&&i.forEach(g=>g.message.recentBlockhash=y),re(i),(x=this.owner)!=null&&x.isKeyPair){if(l){let g=[];for(let L of i){let A=await this.connection.sendTransaction(L,{skipPreflight:c});await Te(this.connection,A),g.push(A)}return{txIds:g,signedTxs:i}}return{txIds:await Promise.all(i.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:c}))),signedTxs:i}}if(this.signAllTransactions){let g=await this.signAllTransactions(i);if(l){let L=0,A=[],k=async()=>{if(!g[L])return;let p=await this.connection.sendTransaction(g[L],{skipPreflight:c});A.push({txId:p,status:"sent",signedTx:g[L]}),h==null||h([...A]),L++;let u=!1,d=null,P=null,T=I=>{d!==null&&clearInterval(d),P!==null&&this.connection.removeSignatureListener(P);let N=A.findIndex(D=>D.txId===p);if(N>-1){if(A[N].status==="error"||A[N].status==="success")return;A[N].status=I.err?"error":"success"}h==null||h([...A]),I.err||k()};this.loopMultiTxStatus&&(d=setInterval(async()=>{var I;if(u){clearInterval(d);return}try{let N=await this.connection.getTransaction(p,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(u=!0,clearInterval(d),T({err:((I=N.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",p))}catch(N){u=!0,clearInterval(d),console.error("getTransaction timeout:",N,p)}},Se)),P=this.connection.onSignature(p,I=>{if(u){this.connection.removeSignatureListener(P);return}u=!0,T(I)},"confirmed"),this.connection.getSignatureStatus(p)};return k(),{txIds:[],signedTxs:g}}else{let L=[];for(let A=0;A<g.length;A+=1){let k=await this.connection.sendTransaction(g[A],{skipPreflight:c});L.push(k)}return{txIds:L,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var h;let l=e||{},{splitIns:t=[],computeBudgetConfig:n}=l,s=te(l,["splitIns","computeBudgetConfig"]),a=n?xe(n):{instructions:[],instructionTypes:[]},i=this.signers.reduce((y,c)=>Z(O({},y),{[c.publicKey.toBase58()]:c}),{}),o=[],f=[],m=[],b=0;if(this.allInstructions.forEach(y=>{let c=[...m,y],x=n?[...a.instructions,...c]:c,L=[...new Set(c.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(A=>new ce(A));if(y!==t[b]&&m.length<12&&(we({instructions:x,payer:this.feePayer,signers:L})||we({instructions:c,payer:this.feePayer,signers:L})))m.push(y);else{if(m.length===0)throw Error("item ins too big");b+=y===t[b]?1:0,we({instructions:n?[...a.instructions,...m]:[...m],payer:this.feePayer,signers:L})?o.push(new ke().add(...a.instructions,...m)):o.push(new ke().add(...m)),f.push(Array.from(new Set(m.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(A=>i[A]).filter(A=>A!==void 0)),m=[y]}}),m.length>0){let c=[...new Set(m.map(x=>x.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(x=>i[x]).filter(x=>x!==void 0);we({instructions:n?[...a.instructions,...m]:[...m],payer:this.feePayer,signers:c.map(x=>x.publicKey)})?o.push(new ke().add(...a.instructions,...m)):o.push(new ke().add(...m)),f.push(c)}return o.forEach(y=>y.feePayer=this.feePayer),(h=this.owner)!=null&&h.signer&&f.forEach(y=>{y.some(c=>c.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:o,signers:f,instructionTypes:this.instructionTypes,execute:async y=>{var p;let{sequentially:c,onTxUpdate:x,skipTxCount:g=0,recentBlockHash:L,skipPreflight:A=!0}=y||{},k=L!=null?L:await ae(this.connection,this.blockhashCommitment);if(o.forEach(async(u,d)=>{u.recentBlockhash=k,f[d].length&&u.sign(...f[d])}),re(o),(p=this.owner)!=null&&p.isKeyPair){if(c){let u=0,d=[];for(let P of o){if(++u,u<=g){d.push("tx skipped");continue}let T=await et(this.connection,P,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});d.push(T)}return{txIds:d,signedTxs:o}}return{txIds:await Promise.all(o.map(async u=>await this.connection.sendRawTransaction(u.serialize(),{skipPreflight:A}))),signedTxs:o}}if(this.signAllTransactions){let u=await this.signAllTransactions(o.slice(g,o.length)),d=[...o.slice(0,g),...u];if(c){let P=0,T=[],I=async()=>{if(!d[P])return;P<g&&(T.push({txId:"",status:"success",signedTx:d[P]}),x==null||x([...T]),P++,I());let N=await this.connection.sendRawTransaction(d[P].serialize(),{skipPreflight:A});T.push({txId:N,status:"sent",signedTx:d[P]}),x==null||x([...T]),P++;let D=!1,S=null,B=null,C=v=>{S!==null&&clearInterval(S),B!==null&&this.connection.removeSignatureListener(B);let M=T.findIndex(q=>q.txId===N);if(M>-1){if(T[M].status==="error"||T[M].status==="success")return;T[M].status=v.err?"error":"success"}x==null||x([...T]),v.err||I()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var v;if(D){clearInterval(S);return}try{let M=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(D=!0,clearInterval(S),C({err:((v=M.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",N))}catch(M){D=!0,clearInterval(S),console.error("getTransaction timeout:",M,N)}},Se)),B=this.connection.onSignature(N,v=>{if(D){this.connection.removeSignatureListener(B);return}D=!0,C(v)},"confirmed"),this.connection.getSignatureStatus(N)};return await I(),{txIds:T.map(N=>N.txId),signedTxs:d}}else{let P=[];for(let T=0;T<d.length;T+=1){let I=await this.connection.sendRawTransaction(d[T].serialize(),{skipPreflight:A});P.push(I)}return{txIds:P,signedTxs:d}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async sizeCheckBuildV0(e){var k;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:s={},lookupTableAddress:a=[]}=A,i=te(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=O(O({},this.cluster==="devnet"?await Ee(this.connection):Ae),s),f=Array.from(new Set([...this.lookupTableAddress,...a])),m=[];for(let p of f)o[p]===void 0&&m.push(new ce(p));let b=await Ke({connection:this.connection,address:m});for(let[p,u]of Object.entries(b))o[p]=u;let l=t?xe(t):{instructions:[],instructionTypes:[]},h=await ae(this.connection,this.blockhashCommitment),y=this.signers.reduce((p,u)=>Z(O({},p),{[u.publicKey.toBase58()]:u}),{}),c=[],x=[],g=[],L=0;if(this.allInstructions.forEach(p=>{let u=[...g,p],d=t?[...l.instructions,...u]:u;if(p!==n[L]&&g.length<12&&(Y({instructions:d,payer:this.feePayer,lookupTableAddressAccount:o})||Y({instructions:u,payer:this.feePayer,lookupTableAddressAccount:o})))g.push(p);else{if(g.length===0)throw Error("item ins too big");L+=p===n[L]?1:0;let P={};for(let T of[...new Set(f)])o[T]!==void 0&&(P[T]=o[T]);if(t&&Y({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}else{let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}x.push(Array.from(new Set(g.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(T=>y[T]).filter(T=>T!==void 0)),g=[p]}}),g.length>0){let u=[...new Set(g.map(d=>d.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(d=>y[d]).filter(d=>d!==void 0);if(t&&Y({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}else{let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}x.push(u)}return(k=this.owner)!=null&&k.signer&&x.forEach(p=>{p.some(u=>u.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),c.forEach((p,u)=>{p.sign(x[u])}),{builder:this,transactions:c,buildProps:e,signers:x,blockHash:h,instructionTypes:this.instructionTypes,execute:async p=>{var N;let{sequentially:u,onTxUpdate:d,skipTxCount:P=0,recentBlockHash:T,skipPreflight:I=!0}=p||{};if(c.map(async(D,S)=>{x[S].length&&D.sign(x[S]),T&&(D.message.recentBlockhash=T)}),re(c),(N=this.owner)!=null&&N.isKeyPair){if(u){let D=0,S=[];for(let B of c){if(++D,D<=P){console.log("skip tx: ",D),S.push("tx skipped");continue}let C=await this.connection.sendTransaction(B,{skipPreflight:I});await Te(this.connection,C),S.push(C)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(P,c.length)),S=[...c.slice(0,P),...D];if(u){let B=0,C=[],v=async()=>{if(!S[B])return;if(B<P){C.push({txId:"",status:"success",signedTx:S[B]}),d==null||d([...C]),B++,v();return}let M=await this.connection.sendTransaction(S[B],{skipPreflight:I});C.push({txId:M,status:"sent",signedTx:S[B]}),d==null||d([...C]),B++;let q=!1,G=null,J=null,fe=U=>{G!==null&&clearInterval(G),J!==null&&this.connection.removeSignatureListener(J);let V=C.findIndex(Ge=>Ge.txId===M);if(V>-1){if(C[V].status==="error"||C[V].status==="success")return;C[V].status=U.err?"error":"success"}d==null||d([...C]),U.err||v()};this.loopMultiTxStatus&&(G=setInterval(async()=>{var U;if(q){clearInterval(G);return}try{let V=await this.connection.getTransaction(M,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(q=!0,clearInterval(G),fe({err:((U=V.meta)==null?void 0:U.err)||null}),console.log("tx status from getTransaction:",M))}catch(V){q=!0,clearInterval(G),console.error("getTransaction timeout:",V,M)}},Se)),J=this.connection.onSignature(M,U=>{if(q){this.connection.removeSignatureListener(J);return}q=!0,fe(U)},"confirmed"),this.connection.getSignatureStatus(M)};return v(),{txIds:[],signedTxs:S}}else{let B=[];for(let C=0;C<S.length;C+=1){let v=await this.connection.sendTransaction(S[C],{skipPreflight:I});B.push(v)}return{txIds:B,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildSniperTransaction(e){var k;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:s={},lookupTableAddress:a=[]}=A,i=te(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=O(O({},this.cluster==="devnet"?await Ee(this.connection):Ae),s),f=Array.from(new Set([...this.lookupTableAddress,...a])),m=[];for(let p of f)o[p]===void 0&&m.push(new ce(p));let b=await Ke({connection:this.connection,address:m});for(let[p,u]of Object.entries(b))o[p]=u;let l=t?xe(t):{instructions:[],instructionTypes:[]},h=await ae(this.connection,this.blockhashCommitment),y=this.signers.reduce((p,u)=>Z(O({},p),{[u.publicKey.toBase58()]:u}),{}),c=[],x=[],g=[],L=0;if(this.allInstructions.forEach(p=>{let u=[...g,p],d=t?[...l.instructions,...u]:u;if(p!==n[L]&&g.length<12&&(Y({instructions:d,payer:this.feePayer,lookupTableAddressAccount:o})||Y({instructions:u,payer:this.feePayer,lookupTableAddressAccount:o})))g.push(p);else{if(g.length===0)throw Error("item ins too big");L+=p===n[L]?1:0;let P={};for(let T of[...new Set(f)])o[T]!==void 0&&(P[T]=o[T]);if(t&&Y({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}else{let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}x.push(Array.from(new Set(g.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(T=>y[T]).filter(T=>T!==void 0)),g=[p]}}),g.length>0){let u=[...new Set(g.map(d=>d.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(d=>y[d]).filter(d=>d!==void 0);if(t&&Y({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}else{let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}x.push(u)}return(k=this.owner)!=null&&k.signer&&x.forEach(p=>{p.some(u=>u.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),c.forEach((p,u)=>{p.sign(x[u])}),{builder:this,transactions:c,buildProps:e,signers:x,instructionTypes:this.instructionTypes,execute:async p=>{var N;let{sequentially:u,onTxUpdate:d,skipTxCount:P=0,recentBlockHash:T,skipPreflight:I=!0}=p||{};if(c.map(async(D,S)=>{x[S].length&&D.sign(x[S]),T&&(D.message.recentBlockhash=T)}),re(c),(N=this.owner)!=null&&N.isKeyPair){if(u){let D=0,S=[];for(let B of c){if(++D,D<=P){console.log("skip tx: ",D),S.push("tx skipped");continue}let C=await this.connection.sendTransaction(B,{skipPreflight:I});await Te(this.connection,C),S.push(C)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(P,c.length)),S=[...c.slice(0,P),...D];if(u){let B=0,C=[],v=async()=>{if(!S[B])return;if(B<P){C.push({txId:"",status:"success",signedTx:S[B]}),d==null||d([...C]),B++,v();return}let M=await this.connection.sendTransaction(S[B],{skipPreflight:I});C.push({txId:M,status:"sent",signedTx:S[B]}),d==null||d([...C]),B++;let q=!1,G=null,J=null,fe=U=>{G!==null&&clearInterval(G),J!==null&&this.connection.removeSignatureListener(J);let V=C.findIndex(Ge=>Ge.txId===M);if(V>-1){if(C[V].status==="error"||C[V].status==="success")return;C[V].status=U.err?"error":"success"}d==null||d([...C]),U.err||v()};this.loopMultiTxStatus&&(G=setInterval(async()=>{var U;if(q){clearInterval(G);return}try{let V=await this.connection.getTransaction(M,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(q=!0,clearInterval(G),fe({err:((U=V.meta)==null?void 0:U.err)||null}),console.log("tx status from getTransaction:",M))}catch(V){q=!0,clearInterval(G),console.error("getTransaction timeout:",V,M)}},Se)),J=this.connection.onSignature(M,U=>{if(q){this.connection.removeSignatureListener(J);return}q=!0,fe(U)},"confirmed"),this.connection.getSignatureStatus(M)};return v(),{txIds:[],signedTxs:S}}else{let B=[];for(let C=0;C<S.length;C+=1){let v=await this.connection.sendTransaction(S[C],{skipPreflight:I});B.push(v)}return{txIds:B,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};import Bn from"bn.js";var Fi=new Bn(1e6);import{AccountLayout as de,createAssociatedTokenAccountIdempotentInstruction as ft,TOKEN_PROGRAM_ID as ie,TOKEN_2022_PROGRAM_ID as Jn}from"@solana/spl-token";var tt=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Be=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ie({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new z(e);return new Ie({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(tt(e))}logInfo(...e){this.logger.info(tt(e))}logAndCreateError(...e){let t=tt(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Wn,SystemProgram as Un}from"@solana/web3.js";import qn from"bn.js";import{createCloseAccountInstruction as Gn,createInitializeAccountInstruction as Hn,createTransferInstruction as jn,TOKEN_PROGRAM_ID as me}from"@solana/spl-token";import{Keypair as On,PublicKey as zt}from"@solana/web3.js";import Fn from"bn.js";import{TOKEN_PROGRAM_ID as vn}from"@solana/spl-token";function Ln(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function nt(r,...e){if(!Ln(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function rt(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Ft(r,e){nt(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Fe=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),j=(r,e)=>r<<32-e|r>>>e;var ma=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Cn(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function ot(r){return typeof r=="string"&&(r=Cn(r)),nt(r),r}var Oe=class{clone(){return this._cloneInto()}},da={}.toString;function vt(r){let e=n=>r().update(ot(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Rn(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let s=BigInt(32),a=BigInt(4294967295),i=Number(t>>s&a),o=Number(t&a),f=n?4:0,m=n?0:4;r.setUint32(e+f,i,n),r.setUint32(e+m,o,n)}var Vt=(r,e,t)=>r&e^~r&t,Wt=(r,e,t)=>r&e^r&t^e&t,ve=class extends Oe{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Fe(this.buffer)}update(e){rt(this);let{view:t,buffer:n,blockLen:s}=this;e=ot(e);let a=e.length;for(let i=0;i<a;){let o=Math.min(s-this.pos,a-i);if(o===s){let f=Fe(e);for(;s<=a-i;i+=s)this.process(f,i);continue}n.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){rt(this),Ft(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:s,isLE:a}=this,{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>s-i&&(this.process(n,0),i=0);for(let l=i;l<s;l++)t[l]=0;Rn(n,s-8,BigInt(this.length*8),a),this.process(n,0);let o=Fe(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let m=f/4,b=this.get();if(m>b.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<m;l++)o.setUint32(4*l,b[l],a)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:s,finished:a,destroyed:i,pos:o}=this;return e.length=s,e.pos=o,e.finished=a,e.destroyed=i,s%t&&e.buffer.set(n),e}};var _n=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),oe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),se=new Uint32Array(64),st=class extends ve{constructor(){super(64,32,8,!1),this.A=oe[0]|0,this.B=oe[1]|0,this.C=oe[2]|0,this.D=oe[3]|0,this.E=oe[4]|0,this.F=oe[5]|0,this.G=oe[6]|0,this.H=oe[7]|0}get(){let{A:e,B:t,C:n,D:s,E:a,F:i,G:o,H:f}=this;return[e,t,n,s,a,i,o,f]}set(e,t,n,s,a,i,o,f){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=a|0,this.F=i|0,this.G=o|0,this.H=f|0}process(e,t){for(let l=0;l<16;l++,t+=4)se[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let h=se[l-15],y=se[l-2],c=j(h,7)^j(h,18)^h>>>3,x=j(y,17)^j(y,19)^y>>>10;se[l]=x+se[l-7]+c+se[l-16]|0}let{A:n,B:s,C:a,D:i,E:o,F:f,G:m,H:b}=this;for(let l=0;l<64;l++){let h=j(o,6)^j(o,11)^j(o,25),y=b+h+Vt(o,f,m)+_n[l]+se[l]|0,x=(j(n,2)^j(n,13)^j(n,22))+Wt(n,s,a)|0;b=m,m=f,f=o,o=i+y|0,i=a,a=s,s=n,n=y+x|0}n=n+this.A|0,s=s+this.B|0,a=a+this.C|0,i=i+this.D|0,o=o+this.E|0,f=f+this.F|0,m=m+this.G|0,b=b+this.H|0,this.set(n,s,a,i,o,f,m,b)}roundClean(){se.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ut=vt(()=>new st);import{PublicKey as En}from"@solana/web3.js";import Gt,{isBN as wc}from"bn.js";import{bits as Pa,BitStructure as Aa,blob as Dn,Blob as ka,cstr as Sa,f32 as Ia,f32be as Ba,f64 as La,f64be as Ca,greedy as Ra,Layout as Nn,ns64 as _a,ns64be as Da,nu64 as Na,nu64be as Ma,offset as Ka,s16 as Ea,s16be as Oa,s24 as Fa,s24be as va,s32 as Va,s32be as Wa,s40 as Ua,s40be as qa,s48 as Ga,s48be as Ha,s8 as ja,seq as za,struct as Ja,Structure as Mn,u16 as Za,u16be as Xa,u24 as Qa,u24be as Ya,u32 as $a,u32be as ec,u40 as tc,u40be as nc,u48 as rc,u48be as oc,u8 as sc,UInt as Kn,union as ic,Union as ac,unionLayoutDiscriminator as cc,utf8 as uc}from"@solana/buffer-layout";var it=Nn,qt=Mn;var at=Kn;var ct=Dn;var ut=class extends it{constructor(t,n,s){super(t,s);this.blob=ct(t),this.signed=n}decode(t,n=0){let s=new Gt(this.blob.decode(t,n),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(t,n,s=0){return typeof t=="number"&&(t=new Gt(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,s)}};function Ht(r){return new at(1,r)}function Ve(r){return new at(4,r)}function We(r){return new ut(8,!1,r)}var lt=class extends it{constructor(t,n,s,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=s}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,s){return this.layout.encode(this.encoder(t),n,s)}getSpan(t,n){return this.layout.getSpan(t,n)}};function Le(r){return new lt(ct(32),e=>new En(e),e=>e.toBuffer(),r)}var pt=class extends qt{decode(e,t){return super.decode(e,t)}};function jt(r,e,t){return new pt(r,e,t)}var Ce=jt([Le("mint"),Le("owner"),We("amount"),Ve("delegateOption"),Le("delegate"),Ht("state"),Ve("isNativeOption"),We("isNative"),We("delegatedAmount"),Ve("closeAuthorityOption"),Le("closeAuthority")]);var Ec=W("Raydium_Util");function Jt({owner:r,solAccountResp:e,tokenAccountResp:t}){let n=[],s=[];for(let{pubkey:a,account:i}of t.value){let o=Ce.decode(i.data),{mint:f,amount:m}=o;n.push({publicKey:a,mint:f,amount:m,isAssociated:Pe(r,f,i.owner).publicKey.equals(a),isNative:!1,programId:i.owner}),s.push({pubkey:a,accountInfo:o,programId:i.owner})}return e&&n.push({mint:zt.default,amount:new Fn(String(e.lamports)),isNative:!0,programId:e.owner}),{tokenAccounts:n,tokenAccountRawInfos:s}}function Ue({fromPublicKey:r,programId:e=vn,assignSeed:t}){let n=t?btoa(t).slice(0,32):On.generate().publicKey.toBase58().slice(0,32);return{publicKey:Vn(r,n,e),seed:n}}function Vn(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),s=Ut(n);return new zt(s)}function mt(r){let{mint:e,tokenAccount:t,owner:n,programId:s=me}=r;return Hn(t,e,n,s)}function Re(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:s,programId:a=me}=r;return Gn(e,t,s,n,a)}async function dt(r){let{connection:e,amount:t,commitment:n,payer:s,owner:a,skipCloseAccount:i}=r,o=await e.getMinimumBalanceForRentExemption(Ce.span,n),f=H(t).add(new qn(o)),m=Ue({fromPublicKey:s,programId:me});return{addresses:{newAccount:m.publicKey},signers:[],instructions:[Un.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:m.seed,newAccountPubkey:m.publicKey,lamports:f.toNumber(),space:Ce.span,programId:me}),mt({mint:new Wn(X.address),tokenAccount:m.publicKey,owner:a,programId:me})],instructionTypes:[F.CreateAccount,F.InitAccount],endInstructionTypes:i?[]:[F.CloseAccount],endInstructions:i?[]:[Re({tokenAccount:m.publicKey,payer:s,owner:a})]}}function Zt({source:r,destination:e,owner:t,amount:n,multiSigners:s=[],tokenProgram:a=me}){return jn(r,e,t,BigInt(String(n)),s,a)}var gt=class extends Be{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;this._notSubscribeAccountChange=!1;this._accountFetchTime=0;let{tokenAccounts:n,tokenAccountRawInfos:s,notSubscribeAccountChange:a}=t;this._tokenAccounts=n||[],this._tokenAccountRawInfos=s||[],this._notSubscribeAccountChange=a!=null?a:!0,this._clientOwnedToken=!!(n||s)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}set notSubscribeAccountChange(t){this._notSubscribeAccountChange=t}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:n}){return t&&(this._tokenAccounts=t),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(n=>n!==t),this}getAssociatedTokenAccount(t,n){return Pe(this.scope.ownerPubKey,t,n).publicKey}getAssociatedTokenAccountByOwner(t,n,s){return Pe(t,n,s).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<(this._notSubscribeAccountChange?1e3*5:1e3*60*3))return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let s=O(O({},{}),t),[a,i,o]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,s.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:ie},s.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:Jn},s.commitment)]),{tokenAccounts:f,tokenAccountRawInfos:m}=Jt({owner:this.scope.ownerPubKey,solAccountResp:a,tokenAccountResp:{context:i.context,value:[...i.value,...o.value]}});return this._tokenAccounts=f,this._tokenAccountRawInfos=m,this._accountFetchTime=Date.now(),this._notSubscribeAccountChange||(this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>{this.fetchWalletTokenAccounts({forceUpdate:!0}),this._accountListener.forEach(b=>b({tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos}))},{commitment:t==null?void 0:t.commitment})),{tokenAccounts:f,tokenAccountRawInfos:m}}clearAccountChangeCkb(){this._accountChangeListenerId!==void 0&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId)}async getCreatedTokenAccount({mint:t,programId:n=ie,associatedOnly:s=!0}){await this.fetchWalletTokenAccounts();let a=this._tokenAccounts.filter(({mint:o})=>o==null?void 0:o.equals(t)).sort((o,f)=>o.amount.lt(f.amount)?1:-1),i=this.getAssociatedTokenAccount(t,n);for(let o of a){let{publicKey:f}=o;if(f&&(!s||s&&i.equals(f)))return f}}async getOrCreateTokenAccount(t){var x,g,L,A;await this.fetchWalletTokenAccounts();let{mint:n,createInfo:s,associatedOnly:a,owner:i,notUseTokenAccount:o=!1,skipCloseAccount:f=!1,checkCreateATAOwner:m=!1,assignSeed:b}=t,l=new qe(t.tokenProgram||ie),h=this.getAssociatedTokenAccount(n,new qe(l)),y=(o?[]:this.tokenAccountRawInfos).filter(k=>k.accountInfo.mint.equals(n)&&(!a||k.pubkey.equals(h))).sort((k,p)=>k.accountInfo.amount.lt(p.accountInfo.amount)?1:-1);if(s===void 0||y.length>0)return y.length>0?{account:y[0].pubkey}:{};let c={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(a){let k=ft(i,h,i,n,l),p=this.tokenAccountRawInfos.find(u=>u.pubkey.equals(h));if(m){let u=await this.scope.connection.getAccountInfo(h);if(u===null)(x=c.instructions)==null||x.push(k),c.instructionTypes.push(F.CreateATA);else if(!(u.owner.equals(l)&&de.decode(u.data).mint.equals(n)&&de.decode(u.data).owner.equals(i)))throw Error(`create ata check error -> mint: ${n.toString()}, ata: ${h.toString()}`)}else p===void 0&&(c.instructions.push(k),c.instructionTypes.push(F.CreateATA));if(n.equals(ne)&&s.amount){let u=await dt({connection:this.scope.connection,owner:i||this.scope.ownerPubKey,payer:s.payer||this.scope.ownerPubKey,amount:(g=s.amount)!=null?g:0,skipCloseAccount:f});c.instructions.push(...u.instructions||[]),c.endInstructions.push(...u.endInstructions||[]),c.instructionTypes.push(...u.instructionTypes||[]),c.endInstructionTypes.push(...u.endInstructionTypes||[]),s.amount&&(c.instructions.push(Zt({source:u.addresses.newAccount,destination:h,owner:i||this.scope.ownerPubKey,amount:s.amount,tokenProgram:ie})),c.instructionTypes.push(F.TransferAmount))}return!f&&p===void 0&&(c.endInstructions.push(Re({owner:i,payer:s.payer||i,tokenAccount:h,programId:l})),c.endInstructionTypes.push(F.CloseAccount)),{account:h,instructionParams:c}}else{let k=Ue({fromPublicKey:i,programId:l,assignSeed:b}),p=await this.scope.connection.getMinimumBalanceForRentExemption(de.span),u=zn.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:k.seed,newAccountPubkey:k.publicKey,lamports:p+Number((A=(L=s.amount)==null?void 0:L.toString())!=null?A:0),space:de.span,programId:l});return c.instructions.push(u,mt({mint:n,tokenAccount:k.publicKey,owner:this.scope.ownerPubKey,programId:l})),c.instructionTypes.push(F.CreateAccount),c.instructionTypes.push(F.InitAccount),f||(c.endInstructions.push(Re({owner:i,payer:s.payer||i,tokenAccount:k.publicKey,programId:l})),c.endInstructionTypes.push(F.CloseAccount)),{account:k.publicKey,instructionParams:c}}}async checkOrCreateAta({mint:t,programId:n=ie,autoUnwrapWSOLToSOL:s}){var f;await this.fetchWalletTokenAccounts();let a=(f=this.scope.account.tokenAccounts.find(({mint:m})=>(m==null?void 0:m.toBase58())===t.toBase58()))==null?void 0:f.publicKey,i=this.scope.ownerPubKey,o={};if(!a){let m=this.getAssociatedTokenAccount(t,n),b=await ft(i,m,i,t,n);o.instructions=[b],o.instructionTypes=[F.CreateATA],a=m}return s&&ne.toBase58()===t.toBase58()&&(o.endInstructions=[Re({owner:i,payer:i,tokenAccount:a,programId:n})],o.endInstructionTypes=[F.CloseAccount]),{pubKey:a,newInstructions:o}}async handleTokenAccount(t){let{side:n,amount:s,mint:a,programId:i=ie,tokenAccount:o,payer:f=this.scope.ownerPubKey,bypassAssociatedCheck:m,skipCloseAccount:b,checkCreateATAOwner:l}=t,h=this.getAssociatedTokenAccount(a,i);if(new qe(ne).equals(a)){let y=await dt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:f,amount:s,skipCloseAccount:b});return O({tokenAccount:y.addresses.newAccount},y)}else if(!o||n==="out"&&!h.equals(o)&&!m){let y=[],c=ft(this.scope.ownerPubKey,h,this.scope.ownerPubKey,a,i);if(l){let x=await this.scope.connection.getAccountInfo(h);if(x===null)y.push(c);else if(!(x.owner.equals(ie)&&de.decode(x.data).mint.equals(a)&&de.decode(x.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${a.toString()}, ata: ${h.toString()}`)}else y.push(c);return{tokenAccount:h,instructions:y,instructionTypes:[F.CreateATA]}}return{tokenAccount:o}}async processTokenAccount(t){let{mint:n,programId:s=ie,amount:a,useSOLBalance:i,handleTokenAccount:o,feePayer:f}=t,m,b=this.createTxBuilder(f);if(n.equals(new qe(ne))&&i){let l=await this.handleTokenAccount({side:"in",amount:a||0,mint:n,bypassAssociatedCheck:!0,programId:s}),{tokenAccount:y}=l,c=te(l,["tokenAccount"]);m=y,b.addInstruction(c)}else if(m=await this.getCreatedTokenAccount({mint:n,associatedOnly:!1,programId:s}),!m&&o){let h=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:n,bypassAssociatedCheck:!0,programId:s}),{tokenAccount:y}=h,c=te(h,["tokenAccount"]);m=y,b.addInstruction(c)}return O({tokenAccount:m},b.AllTxData)}};export{gt as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.mjs.map