var Zt=Object.defineProperty,Qt=Object.defineProperties;var $t=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var yt=(r,e,t)=>e in r?Zt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,O=(r,e)=>{for(var t in e||(e={}))bt.call(e,t)&&yt(r,t,e[t]);if(Re)for(var t of Re(e))xt.call(e,t)&&yt(r,t,e[t]);return r},J=(r,e)=>Qt(r,$t(e));var te=(r,e)=>{var t={};for(var n in r)bt.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Re)for(var n of Re(r))e.indexOf(n)<0&&xt.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as qe,SystemProgram as Yn}from"@solana/web3.js";import{PublicKey as nn}from"@solana/web3.js";import{get as Tt,set as en}from"lodash";var He=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},wt={},tn={};function W(r){let e=Tt(wt,r);if(!e){let t=Tt(tn,r);e=new He({name:r,logLevel:t}),en(wt,r,e)}return e}import{MINT_SIZE as ir,TOKEN_PROGRAM_ID as ar,getTransferFeeConfig as cr,unpackMint as ur}from"@solana/spl-token";var je=W("Raydium_accountInfo_util");async function Pt(r,e,t){let{batchRequest:n,commitment:s="confirmed",chunkCount:a=100}=O({batchRequest:!1},t),i=ze(e,a),o=new Array(i.length).fill([]);if(n){let f=i.map(l=>{let h=r._buildArgs([l.map(y=>y.toBase58())],s,"base64");return{methodName:"getMultipleAccounts",args:h}}),p=ze(f,10);o=(await(await Promise.all(p.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&je.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(h=>{if(h){let{data:y,executable:c,lamports:x,owner:g,rentEpoch:L}=h;return y.length!==2&&y[1]!=="base64"&&je.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(y[0],"base64"),executable:c,lamports:x,owner:new nn(g),rentEpoch:L}}return null})))}else try{o=await Promise.all(i.map(f=>r.getMultipleAccountsInfo(f,s)))}catch(f){f instanceof Error&&je.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.message}`)}return o.flat()}import Z from"bn.js";import Yo from"decimal.js";import pn from"big.js";import Br from"bn.js";import rn from"toformat";var on=rn,he=on;import Ne from"big.js";import an from"bn.js";import cn from"decimal.js-light";import ye from"bn.js";var At=9007199254740991;function H(r){let e=W("Raydium_parseBigNumberish");if(r instanceof ye)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new ye(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=At||r<=-At)&&e.logWithError(`BigNumberish number overflow: ${r}`),new ye(String(r))):typeof r=="bigint"?new ye(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new ye(0))}var De=W("module/fraction"),Ye=he(Ne),be=he(cn),un={[0]:be.ROUND_DOWN,[1]:be.ROUND_HALF_UP,[2]:be.ROUND_UP},ln={[0]:Ne.roundDown,[1]:Ne.roundHalfUp,[2]:Ne.roundUp},K=class{constructor(e,t=new an(1)){this.numerator=H(e),this.denominator=H(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new K(this.denominator,this.numerator)}add(e){let t=e instanceof K?e:new K(H(e));return this.denominator.eq(t.denominator)?new K(this.numerator.add(t.numerator),this.denominator):new K(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof K?e:new K(H(e));return this.denominator.eq(t.denominator)?new K(this.numerator.sub(t.numerator),this.denominator):new K(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof K?e:new K(H(e));return new K(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof K?e:new K(H(e));return new K(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||De.logWithError(`${e} is not an integer.`),e<=0&&De.logWithError(`${e} is not positive.`),be.set({precision:e+1,rounding:un[n]});let s=new be(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return s.toFormat(s.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||De.logWithError(`${e} is not an integer.`),e<0&&De.logWithError(`${e} is negative.`),Ye.DP=e,Ye.RM=ln[n]||1,new Ye(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Er=W("Raydium_amount"),Or=he(pn);import{PublicKey as dn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as kt}from"@solana/spl-token";var St={chainId:101,address:dn.default.toBase58(),programId:kt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},X={chainId:101,address:"So11111111111111111111111111111111111111112",programId:kt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Xe}from"@solana/web3.js";import{PublicKey as E,SystemProgram as It,SYSVAR_RENT_PUBKEY as fn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as gn}from"@solana/spl-token";function Je({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Hr=[Je({pubkey:gn,isWritable:!1}),Je({pubkey:It.programId,isWritable:!1}),Je({pubkey:fn,isWritable:!1})];function Bt({publicKey:r,transformSol:e}){let t=Lt(r.toString());if(t instanceof E)return e&&t.equals(xe)?ne:t;if(e&&t.toString()===xe.toBase58())return ne;if(typeof t=="string"){if(t===E.default.toBase58())return E.default;try{return new E(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Lt(r){try{return new E(r)}catch{return r}}var jr=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),zr=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Yr=new E("SysvarRent111111111111111111111111111111111"),Jr=new E("SysvarC1ock11111111111111111111111111111111"),Xr=new E("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Zr=new E("Sysvar1nstructions1111111111111111111111111"),Qr=It.programId,$r=new E("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),eo=new E("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),to=new E("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),no=new E("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ro=new E("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),oo=new E("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),so=new E("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),io=new E("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ao=new E("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),co=new E("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),uo=new E("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ne=new E("So11111111111111111111111111111111111111112"),xe=E.default;var Ze=class{constructor({mint:e,decimals:t,symbol:n,name:s,skipMint:a=!1,isToken2022:i=!1}){if(e===xe.toBase58()||e instanceof Xe&&xe.equals(e)){this.decimals=X.decimals,this.symbol=X.symbol,this.name=X.name,this.mint=new Xe(X.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=s||e.toString().substring(0,6),this.mint=a?Xe.default:Bt({publicKey:e}),this.isToken2022=i}equals(e){return this===e?!0:this.mint.equals(e.mint)}},le=Ze;le.WSOL=new Ze(J(O({},X),{mint:X.address}));var Qe=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Me=Qe;Me.SOL=new Qe(St);import hn from"bn.js";var Po=new K(new hn(100));var Lo=W("Raydium_price");var yn=new Z(0),rs=new Z(1),os=new Z(2),ss=new Z(3),is=new Z(5),mn=new Z(10),as=new Z(100),cs=new Z(1e3),us=new Z(1e4);function ze(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var z=class{constructor(e){this._owner=e}get publicKey(){return z.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return z.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return z.isKeyPair(this._owner)}get isPublicKey(){return z.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!z.isKeyPair(e)}};import{PublicKey as kn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Sn}from"@solana/spl-token";import{ComputeBudgetProgram as Dt,Keypair as Mt,PublicKey as bn,Transaction as Kt,TransactionMessage as xn,VersionedTransaction as Et}from"@solana/web3.js";var F={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Tn}from"@solana/spl-token";var Nt=W("Raydium_txUtil"),Ot=1644;function Te(r){let e=[],t=[];return r.microLamports&&(e.push(Dt.setComputeUnitPrice({microLamports:r.microLamports})),t.push(F.SetComputeUnitPrice)),r.units&&(e.push(Dt.setComputeUnitLimit({units:r.units})),t.push(F.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ce(r,e){var n,s;let t=e!=null?e:"confirmed";return(s=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:s.blockhash}async function we(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let s=setTimeout(n,6e4);r.onSignature(e,a=>{if(clearTimeout(s),!a.err){t("");return}n(Object.assign(a.err,{txId:e}))},"confirmed")})}function wn(r,e){r.length<1&&Nt.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Nt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Kt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ot}catch{return!1}}function Ft(r,e){let[t,n]=bn.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Pe({instructions:r,payer:e,signers:t}){return wn(r,[e,...t])}function Q({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Mt.generate().publicKey.toString()}){let a=new xn({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Et(a).serialize()).toString("base64").length<Ot}catch{return!1}}var Pn=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),An=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Et&&(e=Pn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function re(r){let e=[];return r.forEach(t=>{t instanceof Kt&&(t.recentBlockhash||(t.recentBlockhash=Tn.toBase58()),t.feePayer||(t.feePayer=Mt.generate().publicKey)),e.push(An(t))}),console.log("simulate tx string:",e),e}function Ae(r,e,t){return Ft([r.toBuffer(),(t!=null?t:Sn).toBuffer(),e.toBuffer()],new kn("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as w}from"@solana/web3.js";var _s=new w("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Rs=new w("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ds=new w("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ns=new w("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ms=new w("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ks=new w("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Es=new w("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Os=new w("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Fs=new w("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),vs=new w("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Vs=new w("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ws=new w("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Us=new w("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),qs=new w("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Gs=new w("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Hs=new w("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),js=new w("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),zs=new w("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ys=new w("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Js=new w("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Xs=new w("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Zs=new w("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Qs=new w("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),$s=new w("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ei=new w("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ti=new w("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),ni=new w("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ri=new w("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),oi=new w("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),si=new w("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),ii=new w("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ai={OPEN_BOOK_PROGRAM:new w("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new w("Ray1111111111111111111111111111111111111111"),AMM_V4:new w("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new w("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new w("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new w("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new w("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new w("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new w("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new w("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new w("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new w("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:w.default,Router:new w("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new w("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new w("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new w("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new w("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new w("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new w("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new w("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new w("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new w("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new w("Ray1111111111111111111111111111111111111111")};import li from"bn.js";import{PublicKey as $e,AddressLookupTableAccount as me}from"@solana/web3.js";async function Ke({connection:r,address:e,cluster:t="mainnet"}){let n=await Pt(r,[...new Set(e.map(a=>a.toString()))].map(a=>new $e(a))),s={};for(let a=0;a<e.length;a++){let i=n[a],o=e[a];if(!i)continue;let f=new me({key:o,state:me.deserialize(i.data)});s[o.toString()]=f,t==="devnet"?pe[o.toString()]=f:oe[o.toString()]=f}return s}var oe={},et=async r=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(oe[e])return oe;let t=new $e(e),n=await r.getAccountInfo(t);return n&&(oe[e]=new me({key:t,state:me.deserialize(n.data)})),oe},pe={},Ee=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(pe[e])return pe;let t=new $e(e),n=await r.getAccountInfo(t);return n&&(pe[e]=new me({key:t,state:me.deserialize(n.data)})),pe};import{PublicKey as ue,sendAndConfirmTransaction as tt,SystemProgram as In,Transaction as ke,TransactionMessage as $,VersionedTransaction as ee}from"@solana/web3.js";import Bn from"axios";var Se=2e3,Ie=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Bn.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Te(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(In.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ue(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(F.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:s=[],endInstructionTypes:a=[],lookupTableAddress:i=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...s),this.endInstructionTypes.push(...a),this.lookupTableAddress.push(...i.filter(o=>o!==ue.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(O({},t||{})):this.build(t)}build(e){var n;let t=new ke;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(s=>s.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async s=>{var b;let{recentBlockHash:a,skipPreflight:i=!0,sendAndConfirm:o,notSendToRpc:f}=s||{},p=a!=null?a:await ce(this.connection,this.blockhashCommitment);if(t.recentBlockhash=p,this.signers.length&&t.sign(...this.signers),re([t]),(b=this.owner)!=null&&b.isKeyPair)return{txId:o?await tt(this.connection,t,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:i}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:i}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);if(this.signers.length)for(let h of l)try{h.sign(...this.signers)}catch{}return{txId:f?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:i}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var p;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:s}=this.build(n),a=t.filter(b=>b.transaction.instructions.length>0),i=[s,...a.map(b=>b.transaction)],o=[this.signers,...a.map(b=>b.signers)],f=[...this.instructionTypes,...a.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&o.forEach(b=>{b.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:i,signers:o,instructionTypes:f,execute:async b=>{var L;let{sequentially:l,onTxUpdate:h,skipTxCount:y=0,recentBlockHash:c,skipPreflight:x=!0}=b||{},g=c!=null?c:await ce(this.connection,this.blockhashCommitment);if((L=this.owner)!=null&&L.isKeyPair){if(l){let A=[],k=0;for(let m of i){if(++k,k<=y)continue;let u=await tt(this.connection,m,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});A.push(u)}return{txIds:A,signedTxs:i}}return{txIds:await await Promise.all(i.map(async A=>(A.recentBlockhash=g,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:x})))),signedTxs:i}}if(this.signAllTransactions){let A=i.map((m,u)=>(m.recentBlockhash=g,o[u].length&&m.sign(...o[u]),m));re(A);let k=await this.signAllTransactions(A);if(l){let m=0,u=[],d=async()=>{if(!k[m])return;let P=await this.connection.sendRawTransaction(k[m].serialize(),{skipPreflight:x});u.push({txId:P,status:"sent",signedTx:k[m]}),h==null||h([...u]),m++;let T=!1,I=null,N=null,D=S=>{I!==null&&clearInterval(I),N!==null&&this.connection.removeSignatureListener(N);let B=u.findIndex(C=>C.txId===P);if(B>-1){if(u[B].status==="error"||u[B].status==="success")return;u[B].status=S.err?"error":"success"}h==null||h([...u]),S.err||d()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var S;if(T){clearInterval(I);return}try{let B=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(T=!0,clearInterval(I),D({err:((S=B.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",P))}catch(B){T=!0,clearInterval(I),console.error("getTransaction timeout:",B,P)}},Se)),N=this.connection.onSignature(P,S=>{if(T){this.connection.removeSignatureListener(N);return}T=!0,D(S)},"confirmed"),this.connection.getSignatureStatus(P)};return await d(),{txIds:u.map(P=>P.txId),signedTxs:k}}else{let m=[];for(let u=0;u<k.length;u+=1){let d=await this.connection.sendRawTransaction(k[u].serialize(),{skipPreflight:x});m.push(d)}return{txIds:m,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var x;let c=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:s,recentBlockhash:a}=c,i=te(c,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=O(O({},this.cluster==="devnet"?await Ee(this.connection):await et(this.connection)),t),f=Array.from(new Set([...n,...this.lookupTableAddress])),p=[];for(let g of f)o[g]===void 0&&p.push(new ue(g));let b=await Ke({connection:this.connection,address:p});for(let[g,L]of Object.entries(b))o[g]=L;let l=s?ue.default.toBase58():a!=null?a:await ce(this.connection,this.blockhashCommitment),h=new $({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((x=this.owner)==null?void 0:x.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let y=new ee(h);return y.sign(this.signers),{builder:this,transaction:y,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var m;let{skipPreflight:L=!0,sendAndConfirm:A,notSendToRpc:k}=g||{};if(re([y]),(m=this.owner)!=null&&m.isKeyPair){let u=await this.connection.sendTransaction(y,{skipPreflight:L});return A&&await we(this.connection,u),{txId:u,signedTx:y}}if(this.signAllTransactions){let u=await this.signAllTransactions([y]);if(this.signers.length)for(let d of u)try{d.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(u[0],{skipPreflight:L}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildV0MultiTx(e){var p;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:s}=await this.buildV0(n),a=t.filter(b=>b.builder.instructions.length>0),i=[s,...a.map(b=>b.transaction)],o=[this.signers,...a.map(b=>b.signers)],f=[...this.instructionTypes,...a.map(b=>b.instructionTypes).flat()];return(p=this.owner)!=null&&p.signer&&o.forEach(b=>{b.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),i.forEach(async(b,l)=>{b.sign(o[l])}),{builder:this,transactions:i,signers:o,instructionTypes:f,buildProps:n,execute:async b=>{var x;let{sequentially:l,onTxUpdate:h,recentBlockHash:y,skipPreflight:c=!0}=b||{};if(y&&i.forEach(g=>g.message.recentBlockhash=y),re(i),(x=this.owner)!=null&&x.isKeyPair){if(l){let g=[];for(let L of i){let A=await this.connection.sendTransaction(L,{skipPreflight:c});await we(this.connection,A),g.push(A)}return{txIds:g,signedTxs:i}}return{txIds:await Promise.all(i.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:c}))),signedTxs:i}}if(this.signAllTransactions){let g=await this.signAllTransactions(i);if(l){let L=0,A=[],k=async()=>{if(!g[L])return;let m=await this.connection.sendTransaction(g[L],{skipPreflight:c});A.push({txId:m,status:"sent",signedTx:g[L]}),h==null||h([...A]),L++;let u=!1,d=null,P=null,T=I=>{d!==null&&clearInterval(d),P!==null&&this.connection.removeSignatureListener(P);let N=A.findIndex(D=>D.txId===m);if(N>-1){if(A[N].status==="error"||A[N].status==="success")return;A[N].status=I.err?"error":"success"}h==null||h([...A]),I.err||k()};this.loopMultiTxStatus&&(d=setInterval(async()=>{var I;if(u){clearInterval(d);return}try{let N=await this.connection.getTransaction(m,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(u=!0,clearInterval(d),T({err:((I=N.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",m))}catch(N){u=!0,clearInterval(d),console.error("getTransaction timeout:",N,m)}},Se)),P=this.connection.onSignature(m,I=>{if(u){this.connection.removeSignatureListener(P);return}u=!0,T(I)},"confirmed"),this.connection.getSignatureStatus(m)};return k(),{txIds:[],signedTxs:g}}else{let L=[];for(let A=0;A<g.length;A+=1){let k=await this.connection.sendTransaction(g[A],{skipPreflight:c});L.push(k)}return{txIds:L,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var h;let l=e||{},{splitIns:t=[],computeBudgetConfig:n}=l,s=te(l,["splitIns","computeBudgetConfig"]),a=n?Te(n):{instructions:[],instructionTypes:[]},i=this.signers.reduce((y,c)=>J(O({},y),{[c.publicKey.toBase58()]:c}),{}),o=[],f=[],p=[],b=0;if(this.allInstructions.forEach(y=>{let c=[...p,y],x=n?[...a.instructions,...c]:c,L=[...new Set(c.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(A=>new ue(A));if(y!==t[b]&&p.length<12&&(Pe({instructions:x,payer:this.feePayer,signers:L})||Pe({instructions:c,payer:this.feePayer,signers:L})))p.push(y);else{if(p.length===0)throw Error("item ins too big");b+=y===t[b]?1:0,Pe({instructions:n?[...a.instructions,...p]:[...p],payer:this.feePayer,signers:L})?o.push(new ke().add(...a.instructions,...p)):o.push(new ke().add(...p)),f.push(Array.from(new Set(p.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(A=>i[A]).filter(A=>A!==void 0)),p=[y]}}),p.length>0){let c=[...new Set(p.map(x=>x.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(x=>i[x]).filter(x=>x!==void 0);Pe({instructions:n?[...a.instructions,...p]:[...p],payer:this.feePayer,signers:c.map(x=>x.publicKey)})?o.push(new ke().add(...a.instructions,...p)):o.push(new ke().add(...p)),f.push(c)}return o.forEach(y=>y.feePayer=this.feePayer),(h=this.owner)!=null&&h.signer&&f.forEach(y=>{y.some(c=>c.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:o,signers:f,instructionTypes:this.instructionTypes,execute:async y=>{var m;let{sequentially:c,onTxUpdate:x,skipTxCount:g=0,recentBlockHash:L,skipPreflight:A=!0}=y||{},k=L!=null?L:await ce(this.connection,this.blockhashCommitment);if(o.forEach(async(u,d)=>{u.recentBlockhash=k,f[d].length&&u.sign(...f[d])}),re(o),(m=this.owner)!=null&&m.isKeyPair){if(c){let u=0,d=[];for(let P of o){if(++u,u<=g){d.push("tx skipped");continue}let T=await tt(this.connection,P,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});d.push(T)}return{txIds:d,signedTxs:o}}return{txIds:await Promise.all(o.map(async u=>await this.connection.sendRawTransaction(u.serialize(),{skipPreflight:A}))),signedTxs:o}}if(this.signAllTransactions){let u=await this.signAllTransactions(o.slice(g,o.length)),d=[...o.slice(0,g),...u];if(c){let P=0,T=[],I=async()=>{if(!d[P])return;P<g&&(T.push({txId:"",status:"success",signedTx:d[P]}),x==null||x([...T]),P++,I());let N=await this.connection.sendRawTransaction(d[P].serialize(),{skipPreflight:A});T.push({txId:N,status:"sent",signedTx:d[P]}),x==null||x([...T]),P++;let D=!1,S=null,B=null,C=v=>{S!==null&&clearInterval(S),B!==null&&this.connection.removeSignatureListener(B);let M=T.findIndex(q=>q.txId===N);if(M>-1){if(T[M].status==="error"||T[M].status==="success")return;T[M].status=v.err?"error":"success"}x==null||x([...T]),v.err||I()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var v;if(D){clearInterval(S);return}try{let M=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(D=!0,clearInterval(S),C({err:((v=M.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",N))}catch(M){D=!0,clearInterval(S),console.error("getTransaction timeout:",M,N)}},Se)),B=this.connection.onSignature(N,v=>{if(D){this.connection.removeSignatureListener(B);return}D=!0,C(v)},"confirmed"),this.connection.getSignatureStatus(N)};return await I(),{txIds:T.map(N=>N.txId),signedTxs:d}}else{let P=[];for(let T=0;T<d.length;T+=1){let I=await this.connection.sendRawTransaction(d[T].serialize(),{skipPreflight:A});P.push(I)}return{txIds:P,signedTxs:d}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async sizeCheckBuildV0(e){var k;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:s={},lookupTableAddress:a=[]}=A,i=te(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=O(O({},this.cluster==="devnet"?await Ee(this.connection):oe),s),f=Array.from(new Set([...this.lookupTableAddress,...a])),p=[];for(let m of f)o[m]===void 0&&p.push(new ue(m));let b=await Ke({connection:this.connection,address:p});for(let[m,u]of Object.entries(b))o[m]=u;let l=t?Te(t):{instructions:[],instructionTypes:[]},h=await ce(this.connection,this.blockhashCommitment),y=this.signers.reduce((m,u)=>J(O({},m),{[u.publicKey.toBase58()]:u}),{}),c=[],x=[],g=[],L=0;if(this.allInstructions.forEach(m=>{let u=[...g,m],d=t?[...l.instructions,...u]:u;if(m!==n[L]&&g.length<12&&(Q({instructions:d,payer:this.feePayer,lookupTableAddressAccount:o})||Q({instructions:u,payer:this.feePayer,lookupTableAddressAccount:o})))g.push(m);else{if(g.length===0)throw Error("item ins too big");L+=m===n[L]?1:0;let P={};for(let T of[...new Set(f)])o[T]!==void 0&&(P[T]=o[T]);if(t&&Q({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}else{let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}x.push(Array.from(new Set(g.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(T=>y[T]).filter(T=>T!==void 0)),g=[m]}}),g.length>0){let u=[...new Set(g.map(d=>d.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(d=>y[d]).filter(d=>d!==void 0);if(t&&Q({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}else{let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}x.push(u)}return(k=this.owner)!=null&&k.signer&&x.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),c.forEach((m,u)=>{m.sign(x[u])}),{builder:this,transactions:c,buildProps:e,signers:x,blockHash:h,instructionTypes:this.instructionTypes,execute:async m=>{var N;let{sequentially:u,onTxUpdate:d,skipTxCount:P=0,recentBlockHash:T,skipPreflight:I=!0}=m||{};if(c.map(async(D,S)=>{x[S].length&&D.sign(x[S]),T&&(D.message.recentBlockhash=T)}),re(c),(N=this.owner)!=null&&N.isKeyPair){if(u){let D=0,S=[];for(let B of c){if(++D,D<=P){console.log("skip tx: ",D),S.push("tx skipped");continue}let C=await this.connection.sendTransaction(B,{skipPreflight:I});await we(this.connection,C),S.push(C)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(P,c.length)),S=[...c.slice(0,P),...D];if(u){let B=0,C=[],v=async()=>{if(!S[B])return;if(B<P){C.push({txId:"",status:"success",signedTx:S[B]}),d==null||d([...C]),B++,v();return}let M=await this.connection.sendTransaction(S[B],{skipPreflight:I});C.push({txId:M,status:"sent",signedTx:S[B]}),d==null||d([...C]),B++;let q=!1,G=null,Y=null,ge=U=>{G!==null&&clearInterval(G),Y!==null&&this.connection.removeSignatureListener(Y);let V=C.findIndex(Ge=>Ge.txId===M);if(V>-1){if(C[V].status==="error"||C[V].status==="success")return;C[V].status=U.err?"error":"success"}d==null||d([...C]),U.err||v()};this.loopMultiTxStatus&&(G=setInterval(async()=>{var U;if(q){clearInterval(G);return}try{let V=await this.connection.getTransaction(M,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(q=!0,clearInterval(G),ge({err:((U=V.meta)==null?void 0:U.err)||null}),console.log("tx status from getTransaction:",M))}catch(V){q=!0,clearInterval(G),console.error("getTransaction timeout:",V,M)}},Se)),Y=this.connection.onSignature(M,U=>{if(q){this.connection.removeSignatureListener(Y);return}q=!0,ge(U)},"confirmed"),this.connection.getSignatureStatus(M)};return v(),{txIds:[],signedTxs:S}}else{let B=[];for(let C=0;C<S.length;C+=1){let v=await this.connection.sendTransaction(S[C],{skipPreflight:I});B.push(v)}return{txIds:B,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildSniperTransaction(e){var k;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:s={},lookupTableAddress:a=[]}=A,i=te(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=O(O({},this.cluster==="devnet"?await Ee(this.connection):await et(this.connection)),s),f=Array.from(new Set([...this.lookupTableAddress,...a])),p=[];for(let m of f)o[m]===void 0&&p.push(new ue(m));let b=await Ke({connection:this.connection,address:p});for(let[m,u]of Object.entries(b))o[m]=u;let l=t?Te(t):{instructions:[],instructionTypes:[]},h=await ce(this.connection,this.blockhashCommitment),y=this.signers.reduce((m,u)=>J(O({},m),{[u.publicKey.toBase58()]:u}),{}),c=[],x=[],g=[],L=0;if(this.allInstructions.forEach(m=>{let u=[...g,m],d=t?[...l.instructions,...u]:u;if(m!==n[L]&&g.length<12&&(Q({instructions:d,payer:this.feePayer,lookupTableAddressAccount:o})||Q({instructions:u,payer:this.feePayer,lookupTableAddressAccount:o})))g.push(m);else{if(g.length===0)throw Error("item ins too big");L+=m===n[L]?1:0;let P={};for(let T of[...new Set(f)])o[T]!==void 0&&(P[T]=o[T]);if(t&&Q({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}else{let T=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(T))}x.push(Array.from(new Set(g.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(T=>y[T]).filter(T=>T!==void 0)),g=[m]}}),g.length>0){let u=[...new Set(g.map(d=>d.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(d=>y[d]).filter(d=>d!==void 0);if(t&&Q({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:h})){let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}else{let d=new $({payerKey:this.feePayer,recentBlockhash:h,instructions:[...g]}).compileToV0Message(Object.values(o));c.push(new ee(d))}x.push(u)}return(k=this.owner)!=null&&k.signer&&x.forEach(m=>{m.some(u=>u.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),c.forEach((m,u)=>{m.sign(x[u])}),{builder:this,transactions:c,buildProps:e,signers:x,instructionTypes:this.instructionTypes,execute:async m=>{var N;let{sequentially:u,onTxUpdate:d,skipTxCount:P=0,recentBlockHash:T,skipPreflight:I=!0}=m||{};if(c.map(async(D,S)=>{x[S].length&&D.sign(x[S]),T&&(D.message.recentBlockhash=T)}),re(c),(N=this.owner)!=null&&N.isKeyPair){if(u){let D=0,S=[];for(let B of c){if(++D,D<=P){console.log("skip tx: ",D),S.push("tx skipped");continue}let C=await this.connection.sendTransaction(B,{skipPreflight:I});await we(this.connection,C),S.push(C)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(P,c.length)),S=[...c.slice(0,P),...D];if(u){let B=0,C=[],v=async()=>{if(!S[B])return;if(B<P){C.push({txId:"",status:"success",signedTx:S[B]}),d==null||d([...C]),B++,v();return}let M=await this.connection.sendTransaction(S[B],{skipPreflight:I});C.push({txId:M,status:"sent",signedTx:S[B]}),d==null||d([...C]),B++;let q=!1,G=null,Y=null,ge=U=>{G!==null&&clearInterval(G),Y!==null&&this.connection.removeSignatureListener(Y);let V=C.findIndex(Ge=>Ge.txId===M);if(V>-1){if(C[V].status==="error"||C[V].status==="success")return;C[V].status=U.err?"error":"success"}d==null||d([...C]),U.err||v()};this.loopMultiTxStatus&&(G=setInterval(async()=>{var U;if(q){clearInterval(G);return}try{let V=await this.connection.getTransaction(M,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(q=!0,clearInterval(G),ge({err:((U=V.meta)==null?void 0:U.err)||null}),console.log("tx status from getTransaction:",M))}catch(V){q=!0,clearInterval(G),console.error("getTransaction timeout:",V,M)}},Se)),Y=this.connection.onSignature(M,U=>{if(q){this.connection.removeSignatureListener(Y);return}q=!0,ge(U)},"confirmed"),this.connection.getSignatureStatus(M)};return v(),{txIds:[],signedTxs:S}}else{let B=[];for(let C=0;C<S.length;C+=1){let v=await this.connection.sendTransaction(S[C],{skipPreflight:I});B.push(v)}return{txIds:B,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};import{PublicKey as Ri}from"@solana/web3.js";import Ni from"bn.js";import Ln from"bn.js";var Fi=new Ln(1e6);import{AccountLayout as fe,createAssociatedTokenAccountIdempotentInstruction as gt,TOKEN_PROGRAM_ID as ae,TOKEN_2022_PROGRAM_ID as Jn}from"@solana/spl-token";var nt=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Be=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ie({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new z(e);return new Ie({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(nt(e))}logInfo(...e){this.logger.info(nt(e))}logAndCreateError(...e){let t=nt(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Un,SystemProgram as qn}from"@solana/web3.js";import Gn from"bn.js";import{createCloseAccountInstruction as Hn,createInitializeAccountInstruction as jn,createTransferInstruction as zn,TOKEN_PROGRAM_ID as de}from"@solana/spl-token";import{Keypair as Fn,PublicKey as Yt}from"@solana/web3.js";import vn from"bn.js";import{TOKEN_PROGRAM_ID as Vn}from"@solana/spl-token";function Cn(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function rt(r,...e){if(!Cn(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function ot(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function vt(r,e){rt(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Fe=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),j=(r,e)=>r<<32-e|r>>>e;var ma=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function _n(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function st(r){return typeof r=="string"&&(r=_n(r)),rt(r),r}var Oe=class{clone(){return this._cloneInto()}},da={}.toString;function Vt(r){let e=n=>r().update(st(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Rn(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let s=BigInt(32),a=BigInt(4294967295),i=Number(t>>s&a),o=Number(t&a),f=n?4:0,p=n?0:4;r.setUint32(e+f,i,n),r.setUint32(e+p,o,n)}var Wt=(r,e,t)=>r&e^~r&t,Ut=(r,e,t)=>r&e^r&t^e&t,ve=class extends Oe{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Fe(this.buffer)}update(e){ot(this);let{view:t,buffer:n,blockLen:s}=this;e=st(e);let a=e.length;for(let i=0;i<a;){let o=Math.min(s-this.pos,a-i);if(o===s){let f=Fe(e);for(;s<=a-i;i+=s)this.process(f,i);continue}n.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ot(this),vt(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:s,isLE:a}=this,{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>s-i&&(this.process(n,0),i=0);for(let l=i;l<s;l++)t[l]=0;Rn(n,s-8,BigInt(this.length*8),a),this.process(n,0);let o=Fe(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let p=f/4,b=this.get();if(p>b.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<p;l++)o.setUint32(4*l,b[l],a)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:s,finished:a,destroyed:i,pos:o}=this;return e.length=s,e.pos=o,e.finished=a,e.destroyed=i,s%t&&e.buffer.set(n),e}};var Dn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),se=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ie=new Uint32Array(64),it=class extends ve{constructor(){super(64,32,8,!1),this.A=se[0]|0,this.B=se[1]|0,this.C=se[2]|0,this.D=se[3]|0,this.E=se[4]|0,this.F=se[5]|0,this.G=se[6]|0,this.H=se[7]|0}get(){let{A:e,B:t,C:n,D:s,E:a,F:i,G:o,H:f}=this;return[e,t,n,s,a,i,o,f]}set(e,t,n,s,a,i,o,f){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=a|0,this.F=i|0,this.G=o|0,this.H=f|0}process(e,t){for(let l=0;l<16;l++,t+=4)ie[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let h=ie[l-15],y=ie[l-2],c=j(h,7)^j(h,18)^h>>>3,x=j(y,17)^j(y,19)^y>>>10;ie[l]=x+ie[l-7]+c+ie[l-16]|0}let{A:n,B:s,C:a,D:i,E:o,F:f,G:p,H:b}=this;for(let l=0;l<64;l++){let h=j(o,6)^j(o,11)^j(o,25),y=b+h+Wt(o,f,p)+Dn[l]+ie[l]|0,x=(j(n,2)^j(n,13)^j(n,22))+Ut(n,s,a)|0;b=p,p=f,f=o,o=i+y|0,i=a,a=s,s=n,n=y+x|0}n=n+this.A|0,s=s+this.B|0,a=a+this.C|0,i=i+this.D|0,o=o+this.E|0,f=f+this.F|0,p=p+this.G|0,b=b+this.H|0,this.set(n,s,a,i,o,f,p,b)}roundClean(){ie.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var qt=Vt(()=>new it);import{PublicKey as On}from"@solana/web3.js";import Ht,{isBN as wc}from"bn.js";import{bits as Pa,BitStructure as Aa,blob as Nn,Blob as ka,cstr as Sa,f32 as Ia,f32be as Ba,f64 as La,f64be as Ca,greedy as _a,Layout as Mn,ns64 as Ra,ns64be as Da,nu64 as Na,nu64be as Ma,offset as Ka,s16 as Ea,s16be as Oa,s24 as Fa,s24be as va,s32 as Va,s32be as Wa,s40 as Ua,s40be as qa,s48 as Ga,s48be as Ha,s8 as ja,seq as za,struct as Ya,Structure as Kn,u16 as Ja,u16be as Xa,u24 as Za,u24be as Qa,u32 as $a,u32be as ec,u40 as tc,u40be as nc,u48 as rc,u48be as oc,u8 as sc,UInt as En,union as ic,Union as ac,unionLayoutDiscriminator as cc,utf8 as uc}from"@solana/buffer-layout";var at=Mn,Gt=Kn;var ct=En;var ut=Nn;var lt=class extends at{constructor(t,n,s){super(t,s);this.blob=ut(t),this.signed=n}decode(t,n=0){let s=new Ht(this.blob.decode(t,n),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(t,n,s=0){return typeof t=="number"&&(t=new Ht(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,s)}};function jt(r){return new ct(1,r)}function Ve(r){return new ct(4,r)}function We(r){return new lt(8,!1,r)}var pt=class extends at{constructor(t,n,s,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=s}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,s){return this.layout.encode(this.encoder(t),n,s)}getSpan(t,n){return this.layout.getSpan(t,n)}};function Le(r){return new pt(ut(32),e=>new On(e),e=>e.toBuffer(),r)}var mt=class extends Gt{decode(e,t){return super.decode(e,t)}};function zt(r,e,t){return new mt(r,e,t)}var Ce=zt([Le("mint"),Le("owner"),We("amount"),Ve("delegateOption"),Le("delegate"),jt("state"),Ve("isNativeOption"),We("isNative"),We("delegatedAmount"),Ve("closeAuthorityOption"),Le("closeAuthority")]);var Ec=W("Raydium_Util");function Jt({owner:r,solAccountResp:e,tokenAccountResp:t}){let n=[],s=[];for(let{pubkey:a,account:i}of t.value){let o=Ce.decode(i.data),{mint:f,amount:p}=o;n.push({publicKey:a,mint:f,amount:p,isAssociated:Ae(r,f,i.owner).publicKey.equals(a),isNative:!1,programId:i.owner}),s.push({pubkey:a,accountInfo:o,programId:i.owner})}return e&&n.push({mint:Yt.default,amount:new vn(String(e.lamports)),isNative:!0,programId:e.owner}),{tokenAccounts:n,tokenAccountRawInfos:s}}function Ue({fromPublicKey:r,programId:e=Vn,assignSeed:t}){let n=t?btoa(t).slice(0,32):Fn.generate().publicKey.toBase58().slice(0,32);return{publicKey:Wn(r,n,e),seed:n}}function Wn(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),s=qt(n);return new Yt(s)}function dt(r){let{mint:e,tokenAccount:t,owner:n,programId:s=de}=r;return jn(t,e,n,s)}function _e(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:s,programId:a=de}=r;return Hn(e,t,s,n,a)}async function ft(r){let{connection:e,amount:t,commitment:n,payer:s,owner:a,skipCloseAccount:i}=r,o=await e.getMinimumBalanceForRentExemption(Ce.span,n),f=H(t).add(new Gn(o)),p=Ue({fromPublicKey:s,programId:de});return{addresses:{newAccount:p.publicKey},signers:[],instructions:[qn.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:p.seed,newAccountPubkey:p.publicKey,lamports:f.toNumber(),space:Ce.span,programId:de}),dt({mint:new Un(X.address),tokenAccount:p.publicKey,owner:a,programId:de})],instructionTypes:[F.CreateAccount,F.InitAccount],endInstructionTypes:i?[]:[F.CloseAccount],endInstructions:i?[]:[_e({tokenAccount:p.publicKey,payer:s,owner:a})]}}function Xt({source:r,destination:e,owner:t,amount:n,multiSigners:s=[],tokenProgram:a=de}){return zn(r,e,t,BigInt(String(n)),s,a)}var ht=class extends Be{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;this._notSubscribeAccountChange=!1;this._accountFetchTime=0;let{tokenAccounts:n,tokenAccountRawInfos:s,notSubscribeAccountChange:a}=t;this._tokenAccounts=n||[],this._tokenAccountRawInfos=s||[],this._notSubscribeAccountChange=a!=null?a:!0,this._clientOwnedToken=!!(n||s)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}set notSubscribeAccountChange(t){this._notSubscribeAccountChange=t}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:n}){return t&&(this._tokenAccounts=t),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(n=>n!==t),this}getAssociatedTokenAccount(t,n){return Ae(this.scope.ownerPubKey,t,n).publicKey}getAssociatedTokenAccountByOwner(t,n,s){return Ae(t,n,s).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<(this._notSubscribeAccountChange?1e3*5:1e3*60*3))return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let s=O(O({},{}),t),[a,i,o]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,s.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:ae},s.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:Jn},s.commitment)]),{tokenAccounts:f,tokenAccountRawInfos:p}=Jt({owner:this.scope.ownerPubKey,solAccountResp:a,tokenAccountResp:{context:i.context,value:[...i.value,...o.value]}});return this._tokenAccounts=f,this._tokenAccountRawInfos=p,this._accountFetchTime=Date.now(),this._notSubscribeAccountChange||(this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>{this.fetchWalletTokenAccounts({forceUpdate:!0}),this._accountListener.forEach(b=>b({tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos}))},{commitment:t==null?void 0:t.commitment})),{tokenAccounts:f,tokenAccountRawInfos:p}}clearAccountChangeCkb(){this._accountChangeListenerId!==void 0&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId)}async getCreatedTokenAccount({mint:t,programId:n=ae,associatedOnly:s=!0}){await this.fetchWalletTokenAccounts();let a=this._tokenAccounts.filter(({mint:o})=>o==null?void 0:o.equals(t)).sort((o,f)=>o.amount.lt(f.amount)?1:-1),i=this.getAssociatedTokenAccount(t,n);for(let o of a){let{publicKey:f}=o;if(f&&(!s||s&&i.equals(f)))return f}}async getOrCreateTokenAccount(t){var x,g,L,A;await this.fetchWalletTokenAccounts();let{mint:n,createInfo:s,associatedOnly:a,owner:i,notUseTokenAccount:o=!1,skipCloseAccount:f=!1,checkCreateATAOwner:p=!1,assignSeed:b}=t;console.log("******************associatedOnly: ",a);let l=new qe(t.tokenProgram||ae),h=this.getAssociatedTokenAccount(n,new qe(l)),y=(o?[]:this.tokenAccountRawInfos).filter(k=>k.accountInfo.mint.equals(n)&&(!a||k.pubkey.equals(h))).sort((k,m)=>k.accountInfo.amount.lt(m.accountInfo.amount)?1:-1);if(s===void 0||y.length>0)return y.length>0?{account:y[0].pubkey}:{};let c={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(a){let k=gt(i,h,i,n,l),m=this.tokenAccountRawInfos.find(u=>u.pubkey.equals(h));if(p){console.log("******************checkCreateATAOwner: ",p);let u=await this.scope.connection.getAccountInfo(h);if(u===null)console.log("******************ataInfo == null: ",p),(x=c.instructions)==null||x.push(k),c.instructionTypes.push(F.CreateATA);else if(u.owner.equals(l)&&fe.decode(u.data).mint.equals(n)&&fe.decode(u.data).owner.equals(i))console.log("******************else empty: ");else throw Error(`create ata check error -> mint: ${n.toString()}, ata: ${h.toString()}`)}else m===void 0&&(console.log("******************_ataInTokenAcc undefined"),c.instructions.push(k),c.instructionTypes.push(F.CreateATA));if(n.equals(ne)&&s.amount){console.log("createWSolAccountInstructions*********************************");let u=await ft({connection:this.scope.connection,owner:i||this.scope.ownerPubKey,payer:s.payer||this.scope.ownerPubKey,amount:(g=s.amount)!=null?g:0,skipCloseAccount:f});c.instructions.push(...u.instructions||[]),c.endInstructions.push(...u.endInstructions||[]),c.instructionTypes.push(...u.instructionTypes||[]),c.endInstructionTypes.push(...u.endInstructionTypes||[]),s.amount&&(console.log("******************createInfo.amount"),c.instructions.push(Xt({source:u.addresses.newAccount,destination:h,owner:i||this.scope.ownerPubKey,amount:s.amount,tokenProgram:ae})),c.instructionTypes.push(F.TransferAmount))}return!f&&m===void 0&&(console.log("******************skipCloseAccount"),c.endInstructions.push(_e({owner:i,payer:s.payer||i,tokenAccount:h,programId:l})),c.endInstructionTypes.push(F.CloseAccount)),{account:h,instructionParams:c}}else{console.log("******************newTokenAccount");let k=Ue({fromPublicKey:i,programId:l,assignSeed:b}),m=await this.scope.connection.getMinimumBalanceForRentExemption(fe.span),u=Yn.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:k.seed,newAccountPubkey:k.publicKey,lamports:m+Number((A=(L=s.amount)==null?void 0:L.toString())!=null?A:0),space:fe.span,programId:l});return c.instructions.push(u,dt({mint:n,tokenAccount:k.publicKey,owner:i||this.scope.ownerPubKey,programId:l})),c.instructionTypes.push(F.CreateAccount),c.instructionTypes.push(F.InitAccount),f||(c.endInstructions.push(_e({owner:i,payer:s.payer||i,tokenAccount:k.publicKey,programId:l})),c.endInstructionTypes.push(F.CloseAccount)),{account:k.publicKey,instructionParams:c}}}async checkOrCreateAta({mint:t,programId:n=ae,autoUnwrapWSOLToSOL:s}){var f;await this.fetchWalletTokenAccounts();let a=(f=this.scope.account.tokenAccounts.find(({mint:p})=>(p==null?void 0:p.toBase58())===t.toBase58()))==null?void 0:f.publicKey,i=this.scope.ownerPubKey,o={};if(!a){let p=this.getAssociatedTokenAccount(t,n),b=await gt(i,p,i,t,n);o.instructions=[b],o.instructionTypes=[F.CreateATA],a=p}return s&&ne.toBase58()===t.toBase58()&&(o.endInstructions=[_e({owner:i,payer:i,tokenAccount:a,programId:n})],o.endInstructionTypes=[F.CloseAccount]),{pubKey:a,newInstructions:o}}async handleTokenAccount(t){let{side:n,amount:s,mint:a,programId:i=ae,tokenAccount:o,payer:f=this.scope.ownerPubKey,bypassAssociatedCheck:p,skipCloseAccount:b,checkCreateATAOwner:l}=t,h=this.getAssociatedTokenAccount(a,i);if(new qe(ne).equals(a)){let y=await ft({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:f,amount:s,skipCloseAccount:b});return O({tokenAccount:y.addresses.newAccount},y)}else if(!o||n==="out"&&!h.equals(o)&&!p){let y=[],c=gt(this.scope.ownerPubKey,h,this.scope.ownerPubKey,a,i);if(l){let x=await this.scope.connection.getAccountInfo(h);if(x===null)y.push(c);else if(!(x.owner.equals(ae)&&fe.decode(x.data).mint.equals(a)&&fe.decode(x.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${a.toString()}, ata: ${h.toString()}`)}else y.push(c);return{tokenAccount:h,instructions:y,instructionTypes:[F.CreateATA]}}return{tokenAccount:o}}async processTokenAccount(t){let{mint:n,programId:s=ae,amount:a,useSOLBalance:i,handleTokenAccount:o,feePayer:f}=t,p,b=this.createTxBuilder(f);if(n.equals(new qe(ne))&&i){let l=await this.handleTokenAccount({side:"in",amount:a||0,mint:n,bypassAssociatedCheck:!0,programId:s}),{tokenAccount:y}=l,c=te(l,["tokenAccount"]);p=y,b.addInstruction(c)}else if(p=await this.getCreatedTokenAccount({mint:n,associatedOnly:!1,programId:s}),!p&&o){let h=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:n,bypassAssociatedCheck:!0,programId:s}),{tokenAccount:y}=h,c=te(h,["tokenAccount"]);p=y,b.addInstruction(c)}return O({tokenAccount:p},b.AllTxData)}};export{ht as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.mjs.map