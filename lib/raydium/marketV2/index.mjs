var Zt=Object.defineProperty,Jt=Object.defineProperties;var Xt=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable;var ft=(n,e,t)=>e in n?Zt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,V=(n,e)=>{for(var t in e||(e={}))gt.call(e,t)&&ft(n,t,e[t]);if(Se)for(var t of Se(e))bt.call(e,t)&&ft(n,t,e[t]);return n},Z=(n,e)=>Jt(n,Xt(e));var Be=(n,e)=>{var t={};for(var r in n)gt.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Se)for(var r of Se(n))e.indexOf(r)<0&&bt.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as we}from"@solana/web3.js";import Pe from"bn.js";import{TOKEN_PROGRAM_ID as jt}from"@solana/spl-token";import j from"bn.js";import vs from"decimal.js";import Pn from"big.js";import As from"bn.js";import{get as yt,set as Yt}from"lodash";var Ue=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ht={},$t={};function W(n){let e=yt(ht,n);if(!e){let t=yt($t,n);e=new Ue({name:n,logLevel:t}),Yt(ht,n,e)}return e}import{PublicKey as en}from"@solana/web3.js";import{MINT_SIZE as tr,TOKEN_PROGRAM_ID as nr,getTransferFeeConfig as rr,unpackMint as or}from"@solana/spl-token";var qe=W("Raydium_accountInfo_util");async function xt(n,e,t){let{batchRequest:r,commitment:o="confirmed",chunkCount:s=100}=V({batchRequest:!1},t),u=Ge(e,s),i=new Array(u.length).fill([]);if(r){let b=u.map(c=>{let w=n._buildArgs([c.map(x=>x.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:w}}),h=Ge(b,10);i=(await(await Promise.all(h.map(async c=>await n._rpcBatchRequest(c)))).flat()).map(c=>(c.error&&qe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.error.message}`),c.result.value.map(w=>{if(w){let{data:x,executable:y,lamports:f,owner:a,rentEpoch:L}=w;return x.length!==2&&x[1]!=="base64"&&qe.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(x[0],"base64"),executable:y,lamports:f,owner:new en(a),rentEpoch:L}}return null})))}else try{i=await Promise.all(u.map(b=>n.getMultipleAccountsInfo(b,o)))}catch(b){b instanceof Error&&qe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.message}`)}return i.flat()}import pe from"bn.js";var Tt=9007199254740991;function z(n){let e=W("Raydium_parseBigNumberish");if(n instanceof pe)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new pe(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=Tt||n<=-Tt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new pe(String(n))):typeof n=="bigint"?new pe(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new pe(0))}import{PublicKey as tn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wt}from"@solana/spl-token";var Pt={chainId:101,address:tn.default.toBase58(),programId:wt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ee={chainId:101,address:"So11111111111111111111111111111111111111112",programId:wt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as je}from"@solana/web3.js";import{PublicKey as I,SystemProgram as At,SYSVAR_RENT_PUBKEY as nn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as rn}from"@solana/spl-token";function ze({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var yr=[ze({pubkey:rn,isWritable:!1}),ze({pubkey:At.programId,isWritable:!1}),ze({pubkey:nn,isWritable:!1})];function St({publicKey:n,transformSol:e}){let t=Bt(n.toString());if(t instanceof I)return e&&t.equals(me)?He:t;if(e&&t.toString()===me.toBase58())return He;if(typeof t=="string"){if(t===I.default.toBase58())return I.default;try{return new I(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Bt(n){try{return new I(n)}catch{return n}}var hr=new I("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xr=new I("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Tr=new I("SysvarRent111111111111111111111111111111111"),wr=new I("SysvarC1ock11111111111111111111111111111111"),Pr=new I("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ar=new I("Sysvar1nstructions1111111111111111111111111"),Sr=At.programId,Br=new I("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Lr=new I("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),kr=new I("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Cr=new I("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Mr=new I("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Rr=new I("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Dr=new I("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Nr=new I("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Kr=new I("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ir=new I("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Er=new I("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),He=new I("So11111111111111111111111111111111111111112"),me=I.default;var Qe=class{constructor({mint:e,decimals:t,symbol:r,name:o,skipMint:s=!1,isToken2022:u=!1}){if(e===me.toBase58()||e instanceof je&&me.equals(e)){this.decimals=ee.decimals,this.symbol=ee.symbol,this.name=ee.name,this.mint=new je(ee.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=s?je.default:St({publicKey:e}),this.isToken2022=u}equals(e){return this===e?!0:this.mint.equals(e.mint)}},re=Qe;re.WSOL=new Qe(Z(V({},ee),{mint:ee.address}));var Ze=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Le=Ze;Le.SOL=new Ze(Pt);import on from"toformat";var sn=on,de=sn;import Ce from"big.js";import un from"bn.js";import cn from"decimal.js-light";var ke=W("module/fraction"),Je=de(Ce),fe=de(cn),ln={[0]:fe.ROUND_DOWN,[1]:fe.ROUND_HALF_UP,[2]:fe.ROUND_UP},pn={[0]:Ce.roundDown,[1]:Ce.roundHalfUp,[2]:Ce.roundUp},N=class{constructor(e,t=new un(1)){this.numerator=z(e),this.denominator=z(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(e){let t=e instanceof N?e:new N(z(e));return this.denominator.eq(t.denominator)?new N(this.numerator.add(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof N?e:new N(z(e));return this.denominator.eq(t.denominator)?new N(this.numerator.sub(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof N?e:new N(z(e));return new N(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof N?e:new N(z(e));return new N(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||ke.logWithError(`${e} is not an integer.`),e<=0&&ke.logWithError(`${e} is not positive.`),fe.set({precision:e+1,rounding:ln[r]});let o=new fe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||ke.logWithError(`${e} is not an integer.`),e<0&&ke.logWithError(`${e} is negative.`),Je.DP=e,Je.RM=pn[r]||1,new Je(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import mn from"bn.js";var ro=new N(new mn(100));var co=W("Raydium_price");function Ge(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}import{PublicKey as Uo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Go}from"@solana/spl-token";import{ComputeBudgetProgram as Mt,Keypair as Dt,PublicKey as Ko,Transaction as Nt,TransactionMessage as dn,VersionedTransaction as Kt}from"@solana/web3.js";var U={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as fn}from"@solana/spl-token";var Rt=W("Raydium_txUtil"),It=1644;function Re(n){let e=[],t=[];return n.microLamports&&(e.push(Mt.setComputeUnitPrice({microLamports:n.microLamports})),t.push(U.SetComputeUnitPrice)),n.units&&(e.push(Mt.setComputeUnitLimit({units:n.units})),t.push(U.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function oe(n,e){var r,o;let t=e!=null?e:"confirmed";return(o=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:o.blockhash}async function De(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let o=setTimeout(r,6e4);n.onSignature(e,s=>{if(clearTimeout(o),!s.err){t("");return}r(Object.assign(s.err,{txId:e}))},"confirmed")})}function gn(n,e){n.length<1&&Rt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Rt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Nt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<It}catch{return!1}}function ge({instructions:n,payer:e,signers:t}){return gn(n,[e,...t])}function be({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=Dt.generate().publicKey.toString()}){let s=new dn({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Kt(s).serialize()).toString("base64").length<It}catch{return!1}}var bn=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),yn=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Kt&&(e=bn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function te(n){let e=[];return n.forEach(t=>{t instanceof Nt&&(t.recentBlockhash||(t.recentBlockhash=fn.toBase58()),t.feePayer||(t.feePayer=Dt.generate().publicKey)),e.push(yn(t))}),console.log("simulate tx string:",e),e}import{PublicKey as m}from"@solana/web3.js";var Qo=new m("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Zo=new m("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Jo=new m("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Xo=new m("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Yo=new m("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),$o=new m("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ei=new m("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ti=new m("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ni=new m("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ri=new m("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),oi=new m("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ii=new m("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),si=new m("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ai=new m("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ui=new m("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ci=new m("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),li=new m("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),pi=new m("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),mi=new m("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),di=new m("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),fi=new m("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),gi=new m("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),bi=new m("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),yi=new m("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),hi=new m("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),xi=new m("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ti=new m("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),wi=new m("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Pi=new m("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ai=new m("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Si=new m("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Bi={OPEN_BOOK_PROGRAM:new m("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new m("Ray1111111111111111111111111111111111111111"),AMM_V4:new m("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new m("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new m("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new m("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new m("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new m("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new m("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new m("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new m("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new m("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:m.default,Router:new m("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new m("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new m("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new m("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new m("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new m("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new m("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new m("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new m("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new m("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new m("Ray1111111111111111111111111111111111111111")};import Ci from"bn.js";import{PublicKey as Xe,AddressLookupTableAccount as se}from"@solana/web3.js";async function Ye({connection:n,address:e,cluster:t="mainnet"}){let r=await xt(n,[...new Set(e.map(s=>s.toString()))].map(s=>new Xe(s))),o={};for(let s=0;s<e.length;s++){let u=r[s],i=e[s];if(!u)continue;let b=new se({key:i,state:se.deserialize(u.data)});o[i.toString()]=b,t==="devnet"?ie[i.toString()]=b:Ne[i.toString()]=b}return o}var Ne={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new se({key:new Xe("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:se.deserialize(Buffer.from("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","base64"))})},ie={},$e=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ie[e])return ie;let t=new Xe(e),r=await n.getAccountInfo(t);return r&&(ie[e]=new se({key:t,state:se.deserialize(r.data)})),ie};import{PublicKey as ae,sendAndConfirmTransaction as et,SystemProgram as xn,Transaction as ye,TransactionMessage as he,VersionedTransaction as xe}from"@solana/web3.js";import Tn from"axios";var Ke=2e3,Ie=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await Tn.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Re(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(xn.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ae(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(U.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:o=[],endInstructionTypes:s=[],lookupTableAddress:u=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...o),this.endInstructionTypes.push(...s),this.lookupTableAddress.push(...u.filter(i=>i!==ae.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(V({},t||{})):this.build(t)}build(e){var r;let t=new ye;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var d;let{recentBlockHash:s,skipPreflight:u=!0,sendAndConfirm:i,notSendToRpc:b}=o||{},h=s!=null?s:await oe(this.connection,this.blockhashCommitment);if(t.recentBlockhash=h,this.signers.length&&t.sign(...this.signers),te([t]),(d=this.owner)!=null&&d.isKeyPair)return{txId:i?await et(this.connection,t,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:u}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:u}),signedTx:t};if(this.signAllTransactions){let c=await this.signAllTransactions([t]);if(this.signers.length)for(let w of c)try{w.sign(...this.signers)}catch{}return{txId:b?"":await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:u}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var h;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:o}=this.build(r),s=t.filter(d=>d.transaction.instructions.length>0),u=[o,...s.map(d=>d.transaction)],i=[this.signers,...s.map(d=>d.signers)],b=[...this.instructionTypes,...s.map(d=>d.instructionTypes).flat()];return(h=this.owner)!=null&&h.signer&&i.forEach(d=>{d.some(c=>c.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:u,signers:i,instructionTypes:b,execute:async d=>{var L;let{sequentially:c,onTxUpdate:w,skipTxCount:x=0,recentBlockHash:y,skipPreflight:f=!0}=d||{},a=y!=null?y:await oe(this.connection,this.blockhashCommitment);if((L=this.owner)!=null&&L.isKeyPair){if(c){let T=[],k=0;for(let g of u){if(++k,k<=x)continue;let l=await et(this.connection,g,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});T.push(l)}return{txIds:T,signedTxs:u}}return{txIds:await await Promise.all(u.map(async T=>(T.recentBlockhash=a,await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:f})))),signedTxs:u}}if(this.signAllTransactions){let T=u.map((g,l)=>(g.recentBlockhash=a,i[l].length&&g.sign(...i[l]),g));te(T);let k=await this.signAllTransactions(T);if(c){let g=0,l=[],p=async()=>{if(!k[g])return;let A=await this.connection.sendRawTransaction(k[g].serialize(),{skipPreflight:f});l.push({txId:A,status:"sent",signedTx:k[g]}),w==null||w([...l]),g++;let P=!1,C=null,D=null,E=M=>{C!==null&&clearInterval(C),D!==null&&this.connection.removeSignatureListener(D);let R=l.findIndex(K=>K.txId===A);if(R>-1){if(l[R].status==="error"||l[R].status==="success")return;l[R].status=M.err?"error":"success"}w==null||w([...l]),M.err||p()};this.loopMultiTxStatus&&(C=setInterval(async()=>{var M;if(P){clearInterval(C);return}try{let R=await this.connection.getTransaction(A,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(P=!0,clearInterval(C),E({err:((M=R.meta)==null?void 0:M.err)||null}),console.log("tx status from getTransaction:",A))}catch(R){P=!0,clearInterval(C),console.error("getTransaction timeout:",R,A)}},Ke)),D=this.connection.onSignature(A,M=>{if(P){this.connection.removeSignatureListener(D);return}P=!0,E(M)},"confirmed"),this.connection.getSignatureStatus(A)};return await p(),{txIds:l.map(A=>A.txId),signedTxs:k}}else{let g=[];for(let l=0;l<k.length;l+=1){let p=await this.connection.sendRawTransaction(k[l].serialize(),{skipPreflight:f});g.push(p)}return{txIds:g,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:o,recentBlockhash:s}=y,u=Be(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),i=V(V({},this.cluster==="devnet"?await $e(this.connection):Ne),t),b=Array.from(new Set([...r,...this.lookupTableAddress])),h=[];for(let a of b)i[a]===void 0&&h.push(new ae(a));let d=await Ye({connection:this.connection,address:h});for(let[a,L]of Object.entries(d))i[a]=L;let c=o?ae.default.toBase58():s!=null?s:await oe(this.connection,this.blockhashCommitment),w=new he({payerKey:this.feePayer,recentBlockhash:c,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(i));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let x=new xe(w);return x.sign(this.signers),{builder:this,transaction:x,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var g;let{skipPreflight:L=!0,sendAndConfirm:T,notSendToRpc:k}=a||{};if(te([x]),(g=this.owner)!=null&&g.isKeyPair){let l=await this.connection.sendTransaction(x,{skipPreflight:L});return T&&await De(this.connection,l),{txId:l,signedTx:x}}if(this.signAllTransactions){let l=await this.signAllTransactions([x]);if(this.signers.length)for(let p of l)try{p.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(l[0],{skipPreflight:L}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:u||{}}}async buildV0MultiTx(e){var h;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:o}=await this.buildV0(r),s=t.filter(d=>d.builder.instructions.length>0),u=[o,...s.map(d=>d.transaction)],i=[this.signers,...s.map(d=>d.signers)],b=[...this.instructionTypes,...s.map(d=>d.instructionTypes).flat()];return(h=this.owner)!=null&&h.signer&&i.forEach(d=>{d.some(c=>c.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),u.forEach(async(d,c)=>{d.sign(i[c])}),{builder:this,transactions:u,signers:i,instructionTypes:b,buildProps:r,execute:async d=>{var f;let{sequentially:c,onTxUpdate:w,recentBlockHash:x,skipPreflight:y=!0}=d||{};if(x&&u.forEach(a=>a.message.recentBlockhash=x),te(u),(f=this.owner)!=null&&f.isKeyPair){if(c){let a=[];for(let L of u){let T=await this.connection.sendTransaction(L,{skipPreflight:y});await De(this.connection,T),a.push(T)}return{txIds:a,signedTxs:u}}return{txIds:await Promise.all(u.map(async a=>await this.connection.sendTransaction(a,{skipPreflight:y}))),signedTxs:u}}if(this.signAllTransactions){let a=await this.signAllTransactions(u);if(c){let L=0,T=[],k=async()=>{if(!a[L])return;let g=await this.connection.sendTransaction(a[L],{skipPreflight:y});T.push({txId:g,status:"sent",signedTx:a[L]}),w==null||w([...T]),L++;let l=!1,p=null,A=null,P=C=>{p!==null&&clearInterval(p),A!==null&&this.connection.removeSignatureListener(A);let D=T.findIndex(E=>E.txId===g);if(D>-1){if(T[D].status==="error"||T[D].status==="success")return;T[D].status=C.err?"error":"success"}w==null||w([...T]),C.err||k()};this.loopMultiTxStatus&&(p=setInterval(async()=>{var C;if(l){clearInterval(p);return}try{let D=await this.connection.getTransaction(g,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(l=!0,clearInterval(p),P({err:((C=D.meta)==null?void 0:C.err)||null}),console.log("tx status from getTransaction:",g))}catch(D){l=!0,clearInterval(p),console.error("getTransaction timeout:",D,g)}},Ke)),A=this.connection.onSignature(g,C=>{if(l){this.connection.removeSignatureListener(A);return}l=!0,P(C)},"confirmed"),this.connection.getSignatureStatus(g)};return k(),{txIds:[],signedTxs:a}}else{let L=[];for(let T=0;T<a.length;T+=1){let k=await this.connection.sendTransaction(a[T],{skipPreflight:y});L.push(k)}return{txIds:L,signedTxs:a}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var w;let c=e||{},{splitIns:t=[],computeBudgetConfig:r}=c,o=Be(c,["splitIns","computeBudgetConfig"]),s=r?Re(r):{instructions:[],instructionTypes:[]},u=this.signers.reduce((x,y)=>Z(V({},x),{[y.publicKey.toBase58()]:y}),{}),i=[],b=[],h=[],d=0;if(this.allInstructions.forEach(x=>{let y=[...h,x],f=r?[...s.instructions,...y]:y,L=[...new Set(y.map(T=>T.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(T=>new ae(T));if(x!==t[d]&&h.length<12&&(ge({instructions:f,payer:this.feePayer,signers:L})||ge({instructions:y,payer:this.feePayer,signers:L})))h.push(x);else{if(h.length===0)throw Error("item ins too big");d+=x===t[d]?1:0,ge({instructions:r?[...s.instructions,...h]:[...h],payer:this.feePayer,signers:L})?i.push(new ye().add(...s.instructions,...h)):i.push(new ye().add(...h)),b.push(Array.from(new Set(h.map(T=>T.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(T=>u[T]).filter(T=>T!==void 0)),h=[x]}}),h.length>0){let y=[...new Set(h.map(f=>f.keys.filter(a=>a.isSigner).map(a=>a.pubkey.toString())).flat()).values()].map(f=>u[f]).filter(f=>f!==void 0);ge({instructions:r?[...s.instructions,...h]:[...h],payer:this.feePayer,signers:y.map(f=>f.publicKey)})?i.push(new ye().add(...s.instructions,...h)):i.push(new ye().add(...h)),b.push(y)}return i.forEach(x=>x.feePayer=this.feePayer),(w=this.owner)!=null&&w.signer&&b.forEach(x=>{x.some(y=>y.publicKey.equals(this.owner.publicKey))||x.push(this.owner.signer)}),{builder:this,transactions:i,signers:b,instructionTypes:this.instructionTypes,execute:async x=>{var g;let{sequentially:y,onTxUpdate:f,skipTxCount:a=0,recentBlockHash:L,skipPreflight:T=!0}=x||{},k=L!=null?L:await oe(this.connection,this.blockhashCommitment);if(i.forEach(async(l,p)=>{l.recentBlockhash=k,b[p].length&&l.sign(...b[p])}),te(i),(g=this.owner)!=null&&g.isKeyPair){if(y){let l=0,p=[];for(let A of i){if(++l,l<=a){p.push("tx skipped");continue}let P=await et(this.connection,A,this.signers.find(C=>C.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});p.push(P)}return{txIds:p,signedTxs:i}}return{txIds:await Promise.all(i.map(async l=>await this.connection.sendRawTransaction(l.serialize(),{skipPreflight:T}))),signedTxs:i}}if(this.signAllTransactions){let l=await this.signAllTransactions(i.slice(a,i.length)),p=[...i.slice(0,a),...l];if(y){let A=0,P=[],C=async()=>{if(!p[A])return;A<a&&(P.push({txId:"",status:"success",signedTx:p[A]}),f==null||f([...P]),A++,C());let D=await this.connection.sendRawTransaction(p[A].serialize(),{skipPreflight:T});P.push({txId:D,status:"sent",signedTx:p[A]}),f==null||f([...P]),A++;let E=!1,M=null,R=null,K=O=>{M!==null&&clearInterval(M),R!==null&&this.connection.removeSignatureListener(R);let _=P.findIndex(v=>v.txId===D);if(_>-1){if(P[_].status==="error"||P[_].status==="success")return;P[_].status=O.err?"error":"success"}f==null||f([...P]),O.err||C()};this.loopMultiTxStatus&&(M=setInterval(async()=>{var O;if(E){clearInterval(M);return}try{let _=await this.connection.getTransaction(D,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(E=!0,clearInterval(M),K({err:((O=_.meta)==null?void 0:O.err)||null}),console.log("tx status from getTransaction:",D))}catch(_){E=!0,clearInterval(M),console.error("getTransaction timeout:",_,D)}},Ke)),R=this.connection.onSignature(D,O=>{if(E){this.connection.removeSignatureListener(R);return}E=!0,K(O)},"confirmed"),this.connection.getSignatureStatus(D)};return await C(),{txIds:P.map(D=>D.txId),signedTxs:p}}else{let A=[];for(let P=0;P<p.length;P+=1){let C=await this.connection.sendRawTransaction(p[P].serialize(),{skipPreflight:T});A.push(C)}return{txIds:A,signedTxs:p}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var k;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:o={},lookupTableAddress:s=[]}=T,u=Be(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),i=V(V({},this.cluster==="devnet"?await $e(this.connection):Ne),o),b=Array.from(new Set([...this.lookupTableAddress,...s])),h=[];for(let g of b)i[g]===void 0&&h.push(new ae(g));let d=await Ye({connection:this.connection,address:h});for(let[g,l]of Object.entries(d))i[g]=l;let c=t?Re(t):{instructions:[],instructionTypes:[]},w=await oe(this.connection,this.blockhashCommitment),x=this.signers.reduce((g,l)=>Z(V({},g),{[l.publicKey.toBase58()]:l}),{}),y=[],f=[],a=[],L=0;if(this.allInstructions.forEach(g=>{let l=[...a,g],p=t?[...c.instructions,...l]:l;if(g!==r[L]&&a.length<12&&(be({instructions:p,payer:this.feePayer,lookupTableAddressAccount:i})||be({instructions:l,payer:this.feePayer,lookupTableAddressAccount:i})))a.push(g);else{if(a.length===0)throw Error("item ins too big");L+=g===r[L]?1:0;let A={};for(let P of[...new Set(b)])i[P]!==void 0&&(A[P]=i[P]);if(t&&be({instructions:[...c.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:w})){let P=new he({payerKey:this.feePayer,recentBlockhash:w,instructions:[...c.instructions,...a]}).compileToV0Message(Object.values(i));y.push(new xe(P))}else{let P=new he({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(i));y.push(new xe(P))}f.push(Array.from(new Set(a.map(P=>P.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(P=>x[P]).filter(P=>P!==void 0)),a=[g]}}),a.length>0){let l=[...new Set(a.map(p=>p.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(p=>x[p]).filter(p=>p!==void 0);if(t&&be({instructions:[...c.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:i,recentBlockhash:w})){let p=new he({payerKey:this.feePayer,recentBlockhash:w,instructions:[...c.instructions,...a]}).compileToV0Message(Object.values(i));y.push(new xe(p))}else{let p=new he({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(i));y.push(new xe(p))}f.push(l)}return(k=this.owner)!=null&&k.signer&&f.forEach(g=>{g.some(l=>l.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),y.forEach((g,l)=>{g.sign(f[l])}),{builder:this,transactions:y,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async g=>{var D;let{sequentially:l,onTxUpdate:p,skipTxCount:A=0,recentBlockHash:P,skipPreflight:C=!0}=g||{};if(y.map(async(E,M)=>{f[M].length&&E.sign(f[M]),P&&(E.message.recentBlockhash=P)}),te(y),(D=this.owner)!=null&&D.isKeyPair){if(l){let E=0,M=[];for(let R of y){if(++E,E<=A){console.log("skip tx: ",E),M.push("tx skipped");continue}let K=await this.connection.sendTransaction(R,{skipPreflight:C});await De(this.connection,K),M.push(K)}return{txIds:M,signedTxs:y}}return{txIds:await Promise.all(y.map(async E=>await this.connection.sendTransaction(E,{skipPreflight:C}))),signedTxs:y}}if(this.signAllTransactions){let E=await this.signAllTransactions(y.slice(A,y.length)),M=[...y.slice(0,A),...E];if(l){let R=0,K=[],O=async()=>{if(!M[R])return;if(R<A){K.push({txId:"",status:"success",signedTx:M[R]}),p==null||p([...K]),R++,O();return}let _=await this.connection.sendTransaction(M[R],{skipPreflight:C});K.push({txId:_,status:"sent",signedTx:M[R]}),p==null||p([...K]),R++;let v=!1,Q=null,Ae=null,dt=$=>{Q!==null&&clearInterval(Q),Ae!==null&&this.connection.removeSignatureListener(Ae);let H=K.findIndex(Qt=>Qt.txId===_);if(H>-1){if(K[H].status==="error"||K[H].status==="success")return;K[H].status=$.err?"error":"success"}p==null||p([...K]),$.err||O()};this.loopMultiTxStatus&&(Q=setInterval(async()=>{var $;if(v){clearInterval(Q);return}try{let H=await this.connection.getTransaction(_,{commitment:"confirmed",maxSupportedTransactionVersion:0});H&&(v=!0,clearInterval(Q),dt({err:(($=H.meta)==null?void 0:$.err)||null}),console.log("tx status from getTransaction:",_))}catch(H){v=!0,clearInterval(Q),console.error("getTransaction timeout:",H,_)}},Ke)),Ae=this.connection.onSignature(_,$=>{if(v){this.connection.removeSignatureListener(Ae);return}v=!0,dt($)},"confirmed"),this.connection.getSignatureStatus(_)};return O(),{txIds:[],signedTxs:M}}else{let R=[];for(let K=0;K<M.length;K+=1){let O=await this.connection.sendTransaction(M[K],{skipPreflight:C});R.push(O)}return{txIds:R,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:u||{}}}};import{PublicKey as ji}from"@solana/web3.js";import Zi from"bn.js";import wn from"bn.js";var es=new wn(1e6);var Ns=W("Raydium_amount"),Ks=de(Pn);var Me=new j(0),Js=new j(1),Xs=new j(2),Ys=new j(3),$s=new j(5),An=new j(10),ea=new j(100),ta=new j(1e3),na=new j(1e4);import{Keypair as Fn,PublicKey as On}from"@solana/web3.js";import Pu from"bn.js";import{TOKEN_PROGRAM_ID as Vn}from"@solana/spl-token";function Sn(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function tt(n,...e){if(!Sn(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}function nt(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Et(n,e){tt(n);let t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var _e=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),G=(n,e)=>n<<32-e|n>>>e;var sa=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Bn(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function rt(n){return typeof n=="string"&&(n=Bn(n)),tt(n),n}var Ee=class{clone(){return this._cloneInto()}},aa={}.toString;function _t(n){let e=r=>n().update(rt(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Ln(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);let o=BigInt(32),s=BigInt(4294967295),u=Number(t>>o&s),i=Number(t&s),b=r?4:0,h=r?0:4;n.setUint32(e+b,u,r),n.setUint32(e+h,i,r)}var Ft=(n,e,t)=>n&e^~n&t,Ot=(n,e,t)=>n&e^n&t^e&t,Fe=class extends Ee{constructor(e,t,r,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=_e(this.buffer)}update(e){nt(this);let{view:t,buffer:r,blockLen:o}=this;e=rt(e);let s=e.length;for(let u=0;u<s;){let i=Math.min(o-this.pos,s-u);if(i===o){let b=_e(e);for(;o<=s-u;u+=o)this.process(b,u);continue}r.set(e.subarray(u,u+i),this.pos),this.pos+=i,u+=i,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){nt(this),Et(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:o,isLE:s}=this,{pos:u}=this;t[u++]=128,this.buffer.subarray(u).fill(0),this.padOffset>o-u&&(this.process(r,0),u=0);for(let c=u;c<o;c++)t[c]=0;Ln(r,o-8,BigInt(this.length*8),s),this.process(r,0);let i=_e(e),b=this.outputLen;if(b%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let h=b/4,d=this.get();if(h>d.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<h;c++)i.setUint32(4*c,d[c],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:o,finished:s,destroyed:u,pos:i}=this;return e.length=o,e.pos=i,e.finished=s,e.destroyed=u,o%t&&e.buffer.set(r),e}};var kn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),J=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),X=new Uint32Array(64),ot=class extends Fe{constructor(){super(64,32,8,!1),this.A=J[0]|0,this.B=J[1]|0,this.C=J[2]|0,this.D=J[3]|0,this.E=J[4]|0,this.F=J[5]|0,this.G=J[6]|0,this.H=J[7]|0}get(){let{A:e,B:t,C:r,D:o,E:s,F:u,G:i,H:b}=this;return[e,t,r,o,s,u,i,b]}set(e,t,r,o,s,u,i,b){this.A=e|0,this.B=t|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=u|0,this.G=i|0,this.H=b|0}process(e,t){for(let c=0;c<16;c++,t+=4)X[c]=e.getUint32(t,!1);for(let c=16;c<64;c++){let w=X[c-15],x=X[c-2],y=G(w,7)^G(w,18)^w>>>3,f=G(x,17)^G(x,19)^x>>>10;X[c]=f+X[c-7]+y+X[c-16]|0}let{A:r,B:o,C:s,D:u,E:i,F:b,G:h,H:d}=this;for(let c=0;c<64;c++){let w=G(i,6)^G(i,11)^G(i,25),x=d+w+Ft(i,b,h)+kn[c]+X[c]|0,f=(G(r,2)^G(r,13)^G(r,22))+Ot(r,o,s)|0;d=h,h=b,b=i,i=u+x|0,u=s,s=o,o=r,r=x+f|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,u=u+this.D|0,i=i+this.E|0,b=b+this.F|0,h=h+this.G|0,d=d+this.H|0,this.set(r,o,s,u,i,b,h,d)}roundClean(){X.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Vt=_t(()=>new ot);import{PublicKey as En}from"@solana/web3.js";import Ut,{isBN as lu}from"bn.js";import{bits as Cn,BitStructure as ba,blob as Mn,Blob as ya,cstr as ha,f32 as xa,f32be as Ta,f64 as wa,f64be as Pa,greedy as Aa,Layout as Rn,ns64 as Sa,ns64be as Ba,nu64 as La,nu64be as ka,offset as Ca,s16 as Ma,s16be as Ra,s24 as Da,s24be as Na,s32 as Ka,s32be as Ia,s40 as Ea,s40be as _a,s48 as Fa,s48be as Oa,s8 as Va,seq as va,struct as Wa,Structure as Dn,u16 as Nn,u16be as Ua,u24 as qa,u24be as Ga,u32 as Kn,u32be as Ha,u40 as za,u40be as ja,u48 as Qa,u48be as Za,u8 as Ja,UInt as In,union as Xa,Union as Ya,unionLayoutDiscriminator as $a,utf8 as eu}from"@solana/buffer-layout";var Oe=Rn,vt=Dn;var it=In;var Wt=Nn;var st=Kn;var ue=Mn;var at=Cn;var ut=class extends Oe{constructor(t,r,o){super(t,o);this.blob=ue(t),this.signed=r}decode(t,r=0){let o=new Ut(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new Ut(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}},Ve=class extends Oe{constructor(t){super(8,t);this._lower=at(st(),!1),this._upper=at(st(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,r=0){let o=this._lower.decode(t,r),s=this._upper.decode(t,r+this._lower.span);return V(V({},o),s)}encode(t,r,o=0){return this._lower.encode(t,r,o)+this._upper.encode(t,r,o+this._lower.span)}};function ve(n){return new it(1,n)}function ce(n){return new it(4,n)}function F(n){return new ut(8,!1,n)}var ct=class extends Oe{constructor(t,r,o,s){super(t.span,s);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function q(n){return new ct(ue(32),e=>new En(e),e=>e.toBuffer(),n)}var lt=class extends vt{decode(e,t){return super.decode(e,t)}};function le(n,e,t){return new lt(n,e,t)}var _n=le([q("mint"),q("owner"),F("amount"),ce("delegateOption"),q("delegate"),ve("state"),ce("isNativeOption"),F("isNative"),F("delegatedAmount"),ce("closeAuthorityOption"),q("closeAuthority")]);var ku=W("Raydium_Util");function Y({fromPublicKey:n,programId:e=Vn,assignSeed:t}){let r=t?btoa(t).slice(0,32):Fn.generate().publicKey.toBase58().slice(0,32);return{publicKey:vn(n,r,e),seed:r}}function vn(n,e,t){let r=Buffer.concat([n.toBuffer(),Buffer.from(e),t.toBuffer()]),o=Vt(r);return new On(o)}var pt=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Te=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ie({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(pt(e))}logInfo(...e){this.logger.info(pt(e))}logAndCreateError(...e){let t=pt(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SystemProgram as ne,SYSVAR_RENT_PUBKEY as Un,Transaction as qt,TransactionInstruction as qn}from"@solana/web3.js";import{createInitializeAccountInstruction as Gt,TOKEN_PROGRAM_ID as Ht}from"@solana/spl-token";function Wn(n="accountFlags"){let e=new Ve(n);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var mt=le([ue(5),Wn("accountFlags"),q("ownAddress"),F("vaultSignerNonce"),q("baseMint"),q("quoteMint"),q("baseVault"),F("baseDepositsTotal"),F("baseFeesAccrued"),q("quoteVault"),F("quoteDepositsTotal"),F("quoteFeesAccrued"),F("quoteDustThreshold"),q("requestQueue"),q("eventQueue"),q("bids"),q("asks"),F("baseLotSize"),F("quoteLotSize"),F("feeRateBps"),F("referrerRebatesAccrued"),ue(7)]);function Gn({programId:n,marketInfo:e}){let t=le([ve("version"),ce("instruction"),F("baseLotSize"),F("quoteLotSize"),Wt("feeRateBps"),F("vaultSignerNonce"),F("quoteDustThreshold")]),r=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:Un,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),o=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},o),new qn({keys:r,programId:n,data:o})}async function zt({connection:n,wallet:e,marketInfo:t}){var u,i,b,h,d,c,w,x;let r=new qt,o=await n.getMinimumBalanceForRentExemption(165);r.add(ne.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:o,space:165,programId:Ht}),ne.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:o,space:165,programId:Ht}),Gt(t.baseVault.publicKey,t.baseMint,t.vaultOwner),Gt(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner),ne.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await n.getMinimumBalanceForRentExemption(mt.span),space:mt.span,programId:t.programId}));let s=new qt;return s.add(ne.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:t.lowestFeeMarket?6208320:await n.getMinimumBalanceForRentExemption((u=t.requestQueueSpace)!=null?u:5120+12),space:t.lowestFeeMarket?764:(i=t.requestQueueSpace)!=null?i:5120+12,programId:t.programId}),ne.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:t.lowestFeeMarket?79594560:await n.getMinimumBalanceForRentExemption((b=t.eventQueueSpace)!=null?b:262144+12),space:t.lowestFeeMarket?11308:(h=t.eventQueueSpace)!=null?h:262144+12,programId:t.programId}),ne.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:t.lowestFeeMarket?101977920:await n.getMinimumBalanceForRentExemption((d=t.orderbookQueueSpace)!=null?d:65536+12),space:t.lowestFeeMarket?14524:(c=t.orderbookQueueSpace)!=null?c:65536+12,programId:t.programId}),ne.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:t.lowestFeeMarket?101977920:await n.getMinimumBalanceForRentExemption((w=t.orderbookQueueSpace)!=null?w:65536+12),space:t.lowestFeeMarket?14524:(x=t.orderbookQueueSpace)!=null?x:65536+12,programId:t.programId}),Gn({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:r,signer:[],instructionTypes:[U.CreateAccount,U.CreateAccount,U.InitAccount,U.InitAccount]},{transaction:s,signer:[],instructionTypes:[U.CreateAccount,U.CreateAccount,U.CreateAccount,U.CreateAccount,U.CreateAccount,U.InitMarket]}]}var We=class extends Te{async create({baseInfo:e,quoteInfo:t,lotSize:r,tickSize:o,dexProgramId:s,requestQueueSpace:u,eventQueueSpace:i,orderbookQueueSpace:b,lowestFeeMarket:h,assignSeed:d,txVersion:c,computeBudgetConfig:w,txTipConfig:x,feePayer:y}){let f=this.scope.ownerPubKey,a=d?`${e.mint.toBase58().slice(0,10)}-${t.mint.toBase58().slice(0,10)}-${d}`:void 0,L=Y({fromPublicKey:f,programId:s,assignSeed:a&&`${a}-market`}),T=Y({fromPublicKey:f,programId:s,assignSeed:a&&`${a}-request`}),k=Y({fromPublicKey:f,programId:s,assignSeed:a&&`${a}-event`}),g=Y({fromPublicKey:f,programId:s,assignSeed:a&&`${a}-bids`}),l=Y({fromPublicKey:f,programId:s,assignSeed:a&&`${a}-asks`}),p=Y({fromPublicKey:f,programId:jt,assignSeed:a&&`${a}-baseVault`}),A=Y({fromPublicKey:f,programId:jt,assignSeed:a&&`${a}-quoteVault`}),P=0,C=new Pe(100);function D(){let v=new Pe(0);for(;;)try{return{vaultOwner:we.createProgramAddressSync([L.publicKey.toBuffer(),v.toArrayLike(Buffer,"le",8)],s),vaultSignerNonce:v}}catch{if(v.iaddn(1),v.gt(new Pe(25555)))throw Error("find vault owner error")}}let{vaultOwner:E,vaultSignerNonce:M}=D(),R=new Pe(Math.round(10**e.decimals*r)),K=new Pe(Math.round(r*10**t.decimals*o));if(R.eq(Me))throw Error("lot size is too small");if(K.eq(Me))throw Error("tick size or lot size is too small");let O=await zt({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:s,id:L,baseMint:e.mint,quoteMint:t.mint,baseVault:p,quoteVault:A,vaultOwner:E,requestQueue:T,eventQueue:k,bids:g,asks:l,feeRateBps:P,quoteDustThreshold:C,vaultSignerNonce:M,baseLotSize:R,quoteLotSize:K,requestQueueSpace:u,eventQueueSpace:i,orderbookQueueSpace:b,lowestFeeMarket:h}}),_=this.createTxBuilder(y);_.addInstruction({instructions:O[0].transaction.instructions,signers:O[0].signer});for await(let v of O.slice(1,O.length))_.addInstruction({instructions:v.transaction.instructions,signers:v.signer,instructionTypes:v.instructionTypes});return c===0?_.sizeCheckBuildV0({computeBudgetConfig:w,address:{marketId:L.publicKey,requestQueue:T.publicKey,eventQueue:k.publicKey,bids:g.publicKey,asks:l.publicKey,baseVault:p.publicKey,quoteVault:A.publicKey,baseMint:new we(e.mint),quoteMint:new we(t.mint)}}):_.sizeCheckBuild({computeBudgetConfig:w,address:{marketId:L.publicKey,requestQueue:T.publicKey,eventQueue:k.publicKey,bids:g.publicKey,asks:l.publicKey,baseVault:p.publicKey,quoteVault:A.publicKey,baseMint:new we(e.mint),quoteMint:new we(t.mint)}})}};export{mt as MARKET_STATE_LAYOUT_V2,We as default,Gn as initializeMarket,zt as makeCreateMarketInstruction};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map