var Qn=Object.create;var $e=Object.defineProperty,$n=Object.defineProperties,ei=Object.getOwnPropertyDescriptor,ti=Object.getOwnPropertyDescriptors,ni=Object.getOwnPropertyNames,nn=Object.getOwnPropertySymbols,ii=Object.getPrototypeOf,on=Object.prototype.hasOwnProperty,ri=Object.prototype.propertyIsEnumerable;var rn=(m,e,t)=>e in m?$e(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t,j=(m,e)=>{for(var t in e||(e={}))on.call(e,t)&&rn(m,t,e[t]);if(nn)for(var t of nn(e))ri.call(e,t)&&rn(m,t,e[t]);return m},$=(m,e)=>$n(m,ti(e));var oi=(m,e)=>{for(var t in e)$e(m,t,{get:e[t],enumerable:!0})},sn=(m,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ni(e))!on.call(m,i)&&i!==t&&$e(m,i,{get:()=>e[i],enumerable:!(n=ei(e,i))||n.enumerable});return m};var Y=(m,e,t)=>(t=m!=null?Qn(ii(m)):{},sn(e||!m||!m.__esModule?$e(t,"default",{value:m,enumerable:!0}):t,m)),si=m=>sn($e({},"__esModule",{value:!0}),m);var Ei={};oi(Ei,{ClmmInstrument:()=>ft});module.exports=si(Ei);var g=require("@solana/web3.js"),St=Y(require("bn.js"));var un=require("@solana/web3.js");var et=require("lodash");var It=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},an={},ai={};function pe(m){let e=(0,et.get)(an,m);if(!e){let t=(0,et.get)(ai,m);e=new It({name:m,logLevel:t}),(0,et.set)(an,m,e)}return e}var bt=require("@solana/spl-token"),Kt=pe("Raydium_accountInfo_util");async function Me(m,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=j({batchRequest:!1},t),s=Nt(e,o),r=new Array(s.length).fill([]);if(n){let a=s.map(p=>{let d=m._buildArgs([p.map(l=>l.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=Nt(a,10);r=(await(await Promise.all(u.map(async p=>await m._rpcBatchRequest(p)))).flat()).map(p=>(p.error&&Kt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${p.error.message}`),p.result.value.map(d=>{if(d){let{data:l,executable:b,lamports:y,owner:k,rentEpoch:f}=d;return l.length!==2&&l[1]!=="base64"&&Kt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(l[0],"base64"),executable:b,lamports:y,owner:new un.PublicKey(k),rentEpoch:f}}return null})))}else try{r=await Promise.all(s.map(a=>m.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&Kt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return r.flat()}async function Ct(m,e,t){let n=await Me(m,e.map(i=>i.pubkey),t);return e.map((i,o)=>$(j({},i),{accountInfo:n[o]}))}var Ke=Y(require("bn.js")),yi=Y(require("decimal.js"));var fn=Y(require("big.js")),rt=Y(require("bn.js"));var cn=Y(require("toformat")),ui=cn.default,tt=ui;var nt=Y(require("big.js")),mn=Y(require("bn.js")),dn=Y(require("decimal.js-light"));var je=Y(require("bn.js"));var ln=9007199254740991;function se(m){let e=pe("Raydium_parseBigNumberish");if(m instanceof je.default)return m;if(typeof m=="string"){if(m.match(/^-?[0-9]+$/))return new je.default(m);e.logWithError(`invalid BigNumberish string: ${m}`)}return typeof m=="number"?(m%1&&e.logWithError(`BigNumberish number underflow: ${m}`),(m>=ln||m<=-ln)&&e.logWithError(`BigNumberish number overflow: ${m}`),new je.default(String(m))):typeof m=="bigint"?new je.default(m.toString()):(e.error(`invalid BigNumberish value: ${m}`),new je.default(0))}var gt=pe("module/fraction"),Rt=tt(nt.default),it=tt(dn.default),li={[0]:it.ROUND_DOWN,[1]:it.ROUND_HALF_UP,[2]:it.ROUND_UP},mi={[0]:nt.default.roundDown,[1]:nt.default.roundHalfUp,[2]:nt.default.roundUp},V=class{constructor(e,t=new mn.default(1)){this.numerator=se(e),this.denominator=se(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new V(this.denominator,this.numerator)}add(e){let t=e instanceof V?e:new V(se(e));return this.denominator.eq(t.denominator)?new V(this.numerator.add(t.numerator),this.denominator):new V(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof V?e:new V(se(e));return this.denominator.eq(t.denominator)?new V(this.numerator.sub(t.numerator),this.denominator):new V(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof V?e:new V(se(e));return new V(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof V?e:new V(se(e));return new V(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||gt.logWithError(`${e} is not an integer.`),e<=0&&gt.logWithError(`${e} is not positive.`),it.set({precision:e+1,rounding:li[n]});let i=new it(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||gt.logWithError(`${e} is not an integer.`),e<0&&gt.logWithError(`${e} is negative.`),Rt.DP=e,Rt.RM=mi[n]||1,new Rt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var di=pe("Raydium_amount"),pn=tt(fn.default);function pi(m,e){let t="0",n="0";if(m.includes(".")){let i=m.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):di.logWithError(`invalid number string, num: ${m}`)}else t=m;return[t,n.slice(0,e)||n]}var me=class extends V{constructor(t,n,i=!0,o){let s=new rt.default(0),r=Mt.pow(new rt.default(t.decimals));if(i)s=se(n);else{let a=new rt.default(0),u=new rt.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[c,p]=pi(n.toString(),t.decimals);a=se(c),u=se(p)}a=a.mul(r),s=a.add(u)}super(s,r);this.logger=pe(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new me(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new me(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return pn.DP=this.token.decimals,new pn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var bn=require("@solana/web3.js"),_t=require("@solana/spl-token"),yn={chainId:101,address:bn.PublicKey.default.toBase58(),programId:_t.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},De={chainId:101,address:"So11111111111111111111111111111111111111112",programId:_t.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var wt=require("@solana/web3.js");var q=require("@solana/web3.js"),gn=require("@solana/spl-token");function Ft({pubkey:m,isSigner:e=!1,isWritable:t=!0}){return{pubkey:m,isWritable:t,isSigner:e}}var lr=[Ft({pubkey:gn.TOKEN_PROGRAM_ID,isWritable:!1}),Ft({pubkey:q.SystemProgram.programId,isWritable:!1}),Ft({pubkey:q.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Et({publicKey:m,transformSol:e}){let t=kn(m.toString());if(t instanceof q.PublicKey)return e&&t.equals(ot)?Lt:t;if(e&&t.toString()===ot.toBase58())return Lt;if(typeof t=="string"){if(t===q.PublicKey.default.toBase58())return q.PublicKey.default;try{return new q.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function kn(m){try{return new q.PublicKey(m)}catch{return m}}var kt=new q.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Wt=new q.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),_e=new q.PublicKey("SysvarRent111111111111111111111111111111111"),mr=new q.PublicKey("SysvarC1ock11111111111111111111111111111111"),Oe=new q.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),dr=new q.PublicKey("Sysvar1nstructions1111111111111111111111111"),pr=q.SystemProgram.programId,fr=new q.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),br=new q.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),yr=new q.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),gr=new q.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),kr=new q.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),wr=new q.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Pr=new q.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Tr=new q.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),hr=new q.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ar=new q.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),xr=new q.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Lt=new q.PublicKey("So11111111111111111111111111111111111111112"),ot=q.PublicKey.default;function yt(m){return Et({publicKey:m,transformSol:!0})}var Dt=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===ot.toBase58()||e instanceof wt.PublicKey&&ot.equals(e)){this.decimals=De.decimals,this.symbol=De.symbol,this.name=De.name,this.mint=new wt.PublicKey(De.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?wt.PublicKey.default:Et({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ce=Dt;Ce.WSOL=new Dt($(j({},De),{mint:De.address}));var Ot=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Pt=Ot;Pt.SOL=new Ot(yn);var Pn=Y(require("bn.js"));var wn=new V(new Pn.default(100)),Fe=class extends V{toSignificant(e=5,t,n){return this.mul(wn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(wn).toFixed(e,t,n)}};var fi=pe("Raydium_price"),Be=class extends V{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new V(vt(n.decimals),vt(i.decimals))}get raw(){return new V(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Be({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&fi.logWithError("mul token not equals");let n=super.mul(t);return new Be({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var bi=new Ke.default(0),co=new Ke.default(1),lo=new Ke.default(2),mo=new Ke.default(3),po=new Ke.default(5),Mt=new Ke.default(10),fo=new Ke.default(100),bo=new Ke.default(1e3),yo=new Ke.default(1e4);function vt(m){return Mt.pow(se(m))}function Nt(m,e=1,t=[]){let n=[...m];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Tn=require("@solana/web3.js"),hn=require("@solana/spl-token");var ve=require("@solana/web3.js");var ae={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var gi=require("@solana/spl-token"),No=pe("Raydium_txUtil");function fe(m,e){let[t,n]=ve.PublicKey.findProgramAddressSync(m,e);return{publicKey:t,nonce:n}}function ie(m,e,t){return fe([m.toBuffer(),(t!=null?t:hn.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new Tn.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var x=require("@solana/web3.js"),Mo=new x.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),_o=new x.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Fo=new x.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Eo=new x.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Wo=new x.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Do=new x.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Oo=new x.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),vo=new x.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Vo=new x.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),qo=new x.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Go=new x.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Uo=new x.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Xo=new x.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),zo=new x.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ho=new x.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),jo=new x.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Yo=new x.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Zo=new x.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Jo=new x.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Qo=new x.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),$o=new x.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),es=new x.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ts=new x.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ns=new x.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),is=new x.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),rs=new x.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),os=new x.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ss=new x.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),as=new x.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),us=new x.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),cs=new x.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ls={OPEN_BOOK_PROGRAM:new x.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new x.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new x.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new x.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new x.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new x.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new x.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new x.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new x.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new x.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new x.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new x.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:x.PublicKey.default,Router:new x.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new x.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new x.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new x.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new x.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new x.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new x.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new x.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new x.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new x.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new x.PublicKey("Ray1111111111111111111111111111111111111111")};var xe=Y(require("bn.js")),st=1e4;function te(m,e,t,n){if(e===void 0)return{amount:m,fee:void 0,expirationTime:void 0};let i=$(j({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new xe.default(o.maximumFee.toString()),r=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===st){let a=new xe.default(o.maximumFee.toString());return{amount:m.add(a),fee:a,expirationTime:r}}else{let a=Vt(m.mul(new xe.default(st)),new xe.default(st-o.transferFeeBasisPoints)),u=new xe.default(o.maximumFee.toString()),c=a.sub(m).gt(u)?m.add(u):a,p=Vt(c.mul(new xe.default(o.transferFeeBasisPoints)),new xe.default(st)),d=p.gt(s)?s:p;return{amount:c,fee:d,expirationTime:r}}else{let a=Vt(m.mul(new xe.default(o.transferFeeBasisPoints)),new xe.default(st)),u=a.gt(s)?s:a;return{amount:m,fee:u,expirationTime:r}}}function Ee(m,e){return m===void 0?e:e===void 0?m:Math.min(m,e)}function Vt(m,e){let{div:t,mod:n}=m.divmod(e);return n.gt(new xe.default(0))?t.add(new xe.default(1)):t}var An=require("@solana/web3.js");var Ye=require("@solana/web3.js"),ki=Y(require("axios"));var wi=require("@solana/web3.js"),Pi=Y(require("bn.js"));var xn=Y(require("bn.js")),qs=new xn.default(1e6);var h=require("@solana/spl-token");var Kn=require("@solana/web3.js"),Ze=Y(require("bn.js"));var I=require("@solana/buffer-layout"),qt=I.Layout,Bn=I.Structure;var Gt=I.UInt;var Sn=I.u8,at=I.u16;var Z=I.s32;var In=I.seq;var we=I.blob;var Je=class extends qt{constructor(t,n,i){super(t,i);this.blob=we(t),this.signed=n}decode(t,n=0){let i=new Ze.default(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Ze.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function ee(m){return new Gt(1,m)}function Qe(m){return new Gt(4,m)}function B(m){return new Je(8,!1,m)}function E(m){return new Je(16,!1,m)}function Nn(m){return new Je(8,!0,m)}function Cn(m){return new Je(16,!0,m)}var Tt=class extends qt{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function z(m){return new Tt(we(32),e=>new Kn.PublicKey(e),e=>e.toBuffer(),m)}function be(m){return new Tt(Sn(),Ti,hi,m)}function Ti(m){if(m===0)return!1;if(m===1)return!0;throw new Error("Invalid bool: "+m)}function hi(m){return m?1:0}var Ut=class extends Bn{decode(e,t){return super.decode(e,t)}};function G(m,e,t){return new Ut(m,e,t)}function J(m,e,t){let n,i=typeof e=="number"?e:(0,Ze.isBN)(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let r=Reflect.get(o,"count");n=(0,Ze.isBN)(r)?r.toNumber():r,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,r){return s==="count"&&(n=r),Reflect.set(o,s,r)}});return In(m,i,t)}var Hn=Y(require("bn.js")),ze=Y(require("decimal.js"));var Pe=Y(require("bn.js")),Q=new Pe.default(0),Ne=new Pe.default(1),Le=new Pe.default(-1),Te=new Pe.default(1).shln(64),ht=new Pe.default(1).shln(128),Xt=Te.sub(Ne),ut=64,Ln=ht.subn(1),de=-443636,ye=-de,Ve=new Pe.default("4295048016"),qe=new Pe.default("79226673521066979257578248091"),wa=new Pe.default("4295048017"),Pa=new Pe.default("79226673521066979257578248090"),Rn=16,Mn="59543866431248",_n="184467440737095516",Fn="15793534762490258745",At=new Pe.default(10).pow(new Pe.default(6));var Ta=new Pe.default("18446744073700000000");var R=Y(require("bn.js")),Ie=Y(require("decimal.js"));function xt(m){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,m,!1),new Uint8Array(e)}function zt(m,e){let t=0;for(let n=m-1;n>=0&&!e.testn(n);n--)t++;return t}function Ht(m,e){let t=0;for(let n=0;n<m&&!e.testn(n);n++)t++;return t}function ct(m,e){for(let t=0;t<m;t++)if(e.testn(t))return!1;return!0}function En(m,e){return ct(m,e)?null:zt(m,e)}function Wn(m,e){return ct(m,e)?null:Ht(m,e)}var Ia=Buffer.from("amm_config","utf8"),Ai=Buffer.from("pool","utf8"),xi=Buffer.from("pool_vault","utf8"),Bi=Buffer.from("pool_reward_vault","utf8"),Dn=Buffer.from("position","utf8"),Si=Buffer.from("tick_array","utf8"),Ii=Buffer.from("operation","utf8"),Ki=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ni=Buffer.from("observation","utf8");function On(m,e,t,n){return fe([Ai,e.toBuffer(),t.toBuffer(),n.toBuffer()],m)}function jt(m,e,t){return fe([xi,e.toBuffer(),t.toBuffer()],m)}function vn(m,e,t){return fe([Bi,e.toBuffer(),t.toBuffer()],m)}function U(m,e,t){return fe([Si,e.toBuffer(),xt(t)],m)}function We(m,e,t,n){return fe([Dn,e.toBuffer(),xt(t),xt(n)],m)}function he(m,e){return fe([Dn,e.toBuffer()],m)}function lt(m){return fe([Buffer.from("metadata","utf8"),Oe.toBuffer(),m.toBuffer()],Oe)}function Yt(m){return fe([Ii],m)}function le(m,e){return fe([Ki,e.toBuffer()],m)}function Vn(m,e){return fe([Ni,e.toBuffer()],m)}var qn=Buffer.from("locked_position","utf8");function Zt(m,e){return fe([qn,e.toBuffer()],m)}function Gn(m,e){return fe([qn,e.toBuffer()],m)}var Ka=Buffer.from("support_mint","utf8");var ke=require("@solana/web3.js"),Qt=require("@solana/spl-token"),H=Y(require("bn.js")),W=Y(require("decimal.js"));var Se=Y(require("bn.js")),Bt=Y(require("decimal.js"));var mt=class{static getfeeGrowthInside(e,t,n){let i=new Se.default(0),o=new Se.default(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Se.default(0),r=new Se.default(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,r=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),r=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let a=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),u=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64B,o),r);return{feeGrowthInsideX64A:a,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),r=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Te),a=t.tokenFeesOwedA.add(r),u=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Te),c=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:a,tokenFeeAmountB:c}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),r=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Te),a=t.tokenFeesOwedA.add(r),u=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Te),c=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:a,tokenFeeAmountB:c}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<s.length;r++){let a=s[r],u=t.rewardInfos[r],c=M.wrappingSubU128(a,u.growthInsideLastX64),p=M.mulDivFloor(c,t.liquidity,Te),d=u.rewardAmountOwed.add(p);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let r=0;r<s.length;r++){let a=s[r],u=t.rewardInfos[r],c=M.wrappingSubU128(a,u.growthInsideLastX64),p=M.mulDivFloor(c,t.liquidity,Te),d=u.rewardAmountOwed.add(p);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let r=new Se.default(0);t.liquidityGross.eqn(0)?r=i[s].rewardGrowthGlobalX64:e<t.tick?r=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):r=t.rewardGrowthsOutsideX64[s];let a=new Se.default(0);n.liquidityGross.eqn(0)||(e<n.tick?a=n.rewardGrowthsOutsideX64[s]:a=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(i[s].rewardGrowthGlobalX64,r),a))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let r=new Se.default(0);t.liquidityGross.eqn(0)?r=i[s].rewardGrowthGlobalX64:e<t.tick?r=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):r=t.rewardGrowthsOutsideX64[s];let a=new Se.default(0);n.liquidityGross.eqn(0)||(e<n.tick?a=n.rewardGrowthsOutsideX64[s]:a=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(i[s].rewardGrowthGlobalX64,r),a))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var k,f,P,T;let r=L.priceToSqrtPriceX64(new Bt.default(e.price),e.mintA.decimals,e.mintB.decimals),a=L.getSqrtPriceX64FromTick(t.tickLower),u=L.getSqrtPriceX64FromTick(t.tickUpper),c=o?1+i:1-i,p=O.getAmountsFromLiquidity(r,a,u,n,o),[d,l]=[te(p.amountA,(k=e.mintA.extensions)==null?void 0:k.feeConfig,s,!0),te(p.amountB,(f=e.mintB.extensions)==null?void 0:f.feeConfig,s,!0)],[b,y]=[te(new Se.default(new Bt.default(p.amountA.toString()).mul(c).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,s,!0),te(new Se.default(new Bt.default(p.amountB.toString()).mul(c).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:l,amountSlippageA:b,amountSlippageB:y,expirationTime:Ee(d.expirationTime,l.expirationTime)}}};var Ci=15,D=class{static async getTickArrays(e,t,n,i,o,s,r){let a=[],u=A.getTickArrayStartIndexByTick(i,o),c=A.getInitializedTickArrayInRange(s,r,o,u,Math.floor(Ci/2));for(let l=0;l<c.length;l++){let{publicKey:b}=U(t,n,c[l]);a.push(b)}let p=(await Me(e,a)).map(l=>l!==null?dt.decode(l.data):null),d={};for(let l=0;l<a.length;l++){let b=p[l];b!==null&&(d[b.startTickIndex]=$(j({},b),{address:a[l]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:r,tickArrayAddress:a,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;r==null||r.liquidityGross.lten(0);){if(u=A.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let c=n[u];if(c===void 0)continue;let{nextTick:p,tickArrayAddress:d,tickArrayStartTickIndex:l}=this.firstInitializedTickInOneArray(e,t,c,s);[r,a,u]=[p,d,l]}if(r==null)throw new Error("No invaild tickArray cache");return{nextTick:r,tickArrayAddress:a,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/D.tickCount(t)),r=n?A.searchLowBitFromStart(i,o,s-1,1,t):A.searchHightBitFromStart(i,o,s+1,1,t);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let r=oe-1;for(;r>=0;){let a=n.ticks[r];if(a.liquidityGross.gtn(0)){o=a;break}r=r-1}}else{let r=0;for(;r<oe;){let a=n.ticks[r];if(a.liquidityGross.gtn(0)){o=a;break}r=r+1}}let{publicKey:s}=U(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let r=A.getTickArrayStartIndexByTick(i,o),a=Math.floor((i-r)/o),u=n[r];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:r};let c;if(s)for(;a>=0;){let d=u.ticks[a];if(d.liquidityGross.gtn(0)){c=d;break}a=a-1}else for(a=a+1;a<oe;){let d=u.ticks[a];if(d.liquidityGross.gtn(0)){c=d;break}a=a+1}let{publicKey:p}=U(e,t,r);return{initializedTick:c,tickArrayAddress:p,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(A.checkIsOutOfBoundary(e)){if(e>ye)return!1;let n=A.getTickArrayStartIndexByTick(de,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return oe*e}};var Jt=14,Re=class{static maxTickInTickarrayBitmap(e){return e*oe*Ge}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!D.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-D.tickCount(n):t+D.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let r=n*oe,a=s/r+512;s<0&&s%r!=0&&a--;let u=Math.abs(a);if(i){let c=e.shln(1024-u-1),p=En(1024,c);if(p!==null){let d=(u-p-512)*r;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let c=e.shrn(u),p=Wn(1024,c);if(p!==null){let d=(u+p-512)*r;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-D.tickCount(n)}}}},pt=class{static getBitmapOffset(e,t){if(!D.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Re.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Re.maxTickInTickarrayBitmap(e),n=-t;if(ye<=t)throw Error(`extensionTickBoundary check error: ${ye}, ${t}`);if(n<=de)throw Error(`extensionTickBoundary check error: ${n}, ${de}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:A.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=D.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:r}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(r,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=Re.getBitmapTickBoundary(t,n),r=this.tickArrayOffsetInBitmap(t,n);if(i){let a=A.mergeTickArrayBitmap(e).shln(Ge-1-r),u=ct(512,a)?null:zt(512,a);if(u!==null){let c=t-u*D.tickCount(n);return{isInit:!0,tickIndex:c}}else return{isInit:!1,tickIndex:o}}else{let a=A.mergeTickArrayBitmap(e).shrn(r),u=ct(512,a)?null:Ht(512,a);if(u!==null){let c=t+u*D.tickCount(n);return{isInit:!0,tickIndex:c}}else return{isInit:!1,tickIndex:s-D.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Re.maxTickInTickarrayBitmap(t),i=Math.floor(n/D.tickCount(t));return e<0&&n!=0&&(i=Ge-i),i}};var re=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,s=!1){let r=n.toBase58()===e.mintA.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,r);if(!u||c===void 0||!p)throw new Error("Invalid tick array");a.push(p);let{allTrade:d,amountCalculated:l,accounts:b,sqrtPriceX64:y,feeAmount:k}=Ue.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,r,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o,s);return a.push(...b),{allTrade:d,expectedAmountOut:l.mul(Le),remainingAccounts:a,executionPrice:y,feeAmount:k}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,r=[],{isExist:a,startIndex:u,nextAccountMeta:c}=this.getFirstInitializedTickArray(e,s);if(!a||u===void 0||!c)throw new Error("Invalid tick array");try{let y=this.preInitializedTickArrayStartIndex(e,s);if(y.isExist){let{publicKey:k}=U(e.programId,e.id,y.nextStartIndex);r.push(k)}}catch{}r.push(c);let{amountCalculated:p,accounts:d,sqrtPriceX64:l,feeAmount:b}=Ue.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Le),u,o);return r.push(...d),{expectedAmountIn:p,remainingAccounts:r,executionPrice:l,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=re.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?pt.checkTickArrayIsInit(D.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):A.checkTickArrayIsInitialized(A.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:r}=U(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:r}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,D.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:r}=U(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:r}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/D.tickCount(e.tickSpacing)),i=t?A.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):A.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=D.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=Re.nextInitializedTickArrayStartIndex(A.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:r}=pt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:r};if(t=r,t<de||t>ye)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var r,a,u;let s=[];for(let c=0;c<o.length;c++){let p=o[c],d=(u=(r=t.rewardDefaultInfos[c])==null?void 0:r.mint.programId)!=null?u:(a=await e.getAccountInfo(p.tokenMint))==null?void 0:a.owner;if(d===void 0)throw Error("get new reward mint info error");let l=$(j({},p),{perSecond:M.x64ToDecimal(p.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new ke.PublicKey(d)});if(l.tokenMint.equals(ke.PublicKey.default))continue;if(n<=l.openTime.toNumber()||i.eq(Q)){s.push(l);continue}let b=new H.default(Math.min(l.endTime.toNumber(),n)),y=b.sub(l.lastUpdateTime),k=M.mulDivFloor(y,l.emissionsPerSecondX64,i),f=l.rewardGrowthGlobalX64.add(k),P=M.mulDivFloor(y,l.emissionsPerSecondX64,Te),T=l.rewardTotalEmissioned.add(P);s.push($(j({},l),{rewardGrowthGlobalX64:f,rewardTotalEmissioned:T,lastUpdateTime:b}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=A.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=Re.maxTickInTickarrayBitmap(e),n=-t;return t>ye&&(t=D.getArrayStartIndex(ye,e)+D.tickCount(e)),n<de&&(n=D.getArrayStartIndex(de,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!D.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/D.tickCount(t)*Ge}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Ct(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=zn.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let a of t){let u=A.getTickArrayStartIndexByTick(a.tickCurrent,a.tickSpacing),c=A.getInitializedTickArrayInRange(a.tickArrayBitmap,a.exBitmapInfo,a.tickSpacing,u,7);for(let p of c){let{publicKey:d}=U(a.programId,a.id,p);o.push({pubkey:d}),i[d.toString()]=a.id}}let s=await Ct(e,o,{batchRequest:n}),r={};for(let a of s){if(!a.accountInfo)continue;let u=i[a.pubkey.toString()];if(!u)continue;r[u.toString()]===void 0&&(r[u.toString()]={});let c=dt.decode(a.accountInfo.data);r[u.toString()][c.startTickIndex]=$(j({},c),{address:a.pubkey})}return r}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var r;let s=[];for(let a=0;a<e.length;a++){let u=e[a];u!==null&&(s.find(c=>c.equals(u.state.programId))||s.push(u.state.programId))}if(n){let a=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of a)for(let l of s)u.push(he(l,d).publicKey);let c=await Me(t,u,{batchRequest:i}),p={};for(let d of c){if(d===null)continue;let l=Xn.decode(d.data),b=l.poolId.toString(),y=e.find(C=>C.state.id.toBase58()===b);if(y===void 0)continue;let k=y.state,f=A._getTickPriceLegacy({poolInfo:k,tick:l.tickLower,baseIn:!0}),P=A._getTickPriceLegacy({poolInfo:k,tick:l.tickUpper,baseIn:!0}),{amountA:T,amountB:S}=O.getAmountsFromLiquidity(k.sqrtPriceX64,f.tickSqrtPriceX64,P.tickSqrtPriceX64,l.liquidity,!1),N=1/(1-Math.sqrt(Math.sqrt(f.price.div(P.price).toNumber())));y.positionAccount=[...(r=y.positionAccount)!=null?r:[],{poolId:l.poolId,nftMint:l.nftMint,priceLower:f.price,priceUpper:P.price,amountA:T,amountB:S,tickLower:l.tickLower,tickUpper:l.tickUpper,liquidity:l.liquidity,feeGrowthInsideLastX64A:l.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:l.feeGrowthInsideLastX64B,tokenFeesOwedA:l.tokenFeesOwedA,tokenFeesOwedB:l.tokenFeesOwedB,rewardInfos:l.rewardInfos.map(C=>$(j({},C),{pendingReward:new H.default(0)})),leverage:N,tokenFeeAmountA:new H.default(0),tokenFeeAmountB:new H.default(0)}];let w=await A.getTickArrayAddressByTick(y.state.programId,l.poolId,l.tickLower,y.state.tickSpacing),K=await A.getTickArrayAddressByTick(y.state.programId,l.poolId,l.tickUpper,y.state.tickSpacing);p[`${y.state.programId.toString()}-${l.poolId.toString()}-${l.tickLower}`]=w,p[`${y.state.programId.toString()}-${l.poolId.toString()}-${l.tickUpper}`]=K}if(o){let d=Object.values(p),l=await Me(t,d,{batchRequest:i}),b={};for(let y=0;y<d.length;y++){let k=l[y];if(k===null)continue;let f=d[y].toString();b[f]=dt.decode(k.data)}for(let{state:y,positionAccount:k}of e)if(!!k)for(let f of k){let P=`${y.programId.toString()}-${y.id.toString()}-${f.tickLower}`,T=`${y.programId.toString()}-${y.id.toString()}-${f.tickUpper}`,S=b[p[P].toString()],N=b[p[T].toString()],w=S.ticks[A.getTickOffsetInArray(f.tickLower,y.tickSpacing)],K=N.ticks[A.getTickOffsetInArray(f.tickUpper,y.tickSpacing)],{tokenFeeAmountA:C,tokenFeeAmountB:F}=await mt.GetPositionFees(y,f,w,K),X=await mt.GetPositionRewards(y,f,w,K);f.tokenFeeAmountA=C.gte(new H.default(0))?C:new H.default(0),f.tokenFeeAmountB=F.gte(new H.default(0))?F:new H.default(0);for(let v=0;v<X.length;v++)f.rewardInfos[v].pendingReward=X[v].gte(new H.default(0))?X[v]:new H.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:r=new W.default(0),catchLiquidityInsufficient:a=!1}){var ce;let u,c=n.toBase58()===e.mintA.address,[p,d]=c?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];r.equals(new W.default(0))?u=c?Ve.add(new H.default(1)):qe.sub(new H.default(1)):u=L.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let l=te(o,p,i,!1),{allTrade:b,expectedAmountOut:y,remainingAccounts:k,executionPrice:f,feeAmount:P}=re.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((ce=l.fee)!=null?ce:Q),u,a),T=te(y,d,i,!1),S=L.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),N=c?S:new W.default(1).div(S),w=y.mul(new H.default(Math.floor((1-s)*1e10))).div(new H.default(1e10)),K=te(w,d,i,!1),C=c?e.currentPrice:new W.default(1).div(e.currentPrice),F=new W.default(N).sub(C).abs(),X=C,v=new Fe(new W.default(F).mul(10**15).toFixed(0),new W.default(X).mul(10**15).toFixed(0));return{allTrade:b,realAmountIn:l,amountOut:T,minAmountOut:K,expirationTime:Ee(l.expirationTime,T.expirationTime),currentPrice:e.currentPrice,executionPrice:N,priceImpact:v,fee:P,remainingAccounts:k,executionPriceX64:f}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s,catchLiquidityInsufficient:r=!1}){let a=i.address===e.mintB.address,[u,c]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[p,d]=[new Ce($(j({},u),{mint:u.address,isToken2022:u.programId===Qt.TOKEN_2022_PROGRAM_ID.toBase58()})),new Ce($(j({},c),{mint:c.address,isToken2022:c.programId===Qt.TOKEN_2022_PROGRAM_ID.toBase58()}))],{allTrade:l,realAmountIn:b,amountOut:y,minAmountOut:k,expirationTime:f,currentPrice:P,executionPrice:T,priceImpact:S,fee:N,remainingAccounts:w,executionPriceX64:K}=re.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new ke.PublicKey(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:r}),C=$(j({},b),{amount:new me(p,b.amount),fee:b.fee===void 0?void 0:new me(p,b.fee)}),F=$(j({},y),{amount:new me(d,y.amount),fee:y.fee===void 0?void 0:new me(d,y.fee)}),X=$(j({},k),{amount:new me(d,k.amount),fee:k.fee===void 0?void 0:new me(d,k.fee)}),v=new Be({baseToken:p,denominator:new H.default(10).pow(new H.default(20+p.decimals)),quoteToken:d,numerator:P.mul(new W.default(10**(20+d.decimals))).toFixed(0)}),ce=new Be({baseToken:p,denominator:new H.default(10).pow(new H.default(20+p.decimals)),quoteToken:d,numerator:T.mul(new W.default(10**(20+d.decimals))).toFixed(0)}),ne=new me(p,N);return{allTrade:l,realAmountIn:C,amountOut:F,minAmountOut:X,expirationTime:f,currentPrice:v,executionPrice:ce,priceImpact:S,fee:ne,remainingAccounts:w,executionPriceX64:K}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:o,slippage:s,priceLimit:r=new W.default(0)}){var X;let a=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},c;r.equals(new W.default(0))?c=a?qe.sub(new H.default(1)):Ve.add(new H.default(1)):c=L.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals);let p=te(o,u[n.toString()],i,!0),{expectedAmountIn:d,remainingAccounts:l,executionPrice:b,feeAmount:y}=re.getInputAmountAndRemainAccounts(e,t,n,p.amount.sub((X=p.fee)!=null?X:Q),c),k=a?e.mintB.address:e.mintA.address,f=te(d,u[k],i,!1),P=L.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),T=a?P:new W.default(1).div(P),S=d.mul(new H.default(Math.floor((1+s)*1e10))).div(new H.default(1e10)),N=te(S,u[k],i,!0),w=a?e.currentPrice:new W.default(1).div(e.currentPrice),K=new W.default(T).sub(w).abs(),C=w,F=new Fe(new W.default(K).mul(10**15).toFixed(0),new W.default(C).mul(10**15).toFixed(0));return{amountIn:f,maxAmountIn:N,realAmountOut:p,expirationTime:Ee(f.expirationTime,p.expirationTime),currentPrice:e.currentPrice,executionPrice:T,priceImpact:F,fee:y,remainingAccounts:l}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var b,y,k;let o=e[t],s=A.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),r=A.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),a=Math.max(s,o.priceMin),c=Math.min(r,o.priceMax)-a,p=r-s,d=o.priceMax-o.priceMin,l;return c<=0?l=0:p===c?l=d/c:d===c?l=c/p:l=c/d*(c/p),{feeApr:o.feeApr*l,rewardsApr:[((b=o.rewardApr[0])!=null?b:0)*l,((y=o.rewardApr[1])!=null?y:0)*l,((k=o.rewardApr[2])!=null?k:0)*l],apr:o.apr*l}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:r,chainTime:a}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,c=e[n],p=i[yt(e.mintA.address).toString()],d=i[yt(e.mintB.address).toString()],l=e.mintA.decimals,b=e.mintB.decimals;if(!c||!p||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let y=L.priceToSqrtPriceX64(new W.default(e.price),e.mintA.decimals,e.mintB.decimals),k=L.getSqrtPriceX64FromTick(s),f=L.getSqrtPriceX64FromTick(r),{amountSlippageA:P,amountSlippageB:T}=O.getAmountsFromLiquidityWithSlippage(y,k,f,t,!1,!1,0),{amountSlippageA:S,amountSlippageB:N}=O.getAmountsFromLiquidityWithSlippage(y,k,f,o,!1,!1,0),w=new W.default(P.toString()).div(new W.default(10).pow(l)).mul(p.value).add(new W.default(T.toString()).div(new W.default(10).pow(b)).mul(d.value)),K=new W.default(S.toString()).div(new W.default(10).pow(l)).mul(p.value).add(new W.default(N.toString()).div(new W.default(10).pow(b)).mul(d.value)),C=new W.default(1).div(w.add(K)),X=new W.default(c.volumeFee).mul(365).div(u).mul(C).mul(100).toNumber(),v=3600*24*365,ce=e.rewardDefaultInfos.map(ne=>{var en,tn;let ge=ne.mint.decimals,He=i[ne.mint.address];return a<((en=ne.startTime)!=null?en:0)||a>((tn=ne.endTime)!=null?tn:0)||!ne.perSecond||!He||ge===void 0?0:new W.default(He.value).mul(new W.default(ne.perSecond).mul(v)).div(new W.default(10).pow(ge)).mul(C).mul(100).toNumber()});return{feeApr:X,rewardsApr:ce,apr:X+ce.reduce((ne,ge)=>ne+ge,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:r,epochInfo:a,amountHasFee:u}){var f,P;let c=L.priceToSqrtPriceX64(new W.default(e.price),e.mintA.decimals,e.mintB.decimals),p=L.getSqrtPriceX64FromTick(n),d=L.getSqrtPriceX64FromTick(i),l=te(o,(f=e[t?"mintA":"mintB"].extensions)==null?void 0:f.feeConfig,a,!u),b=new H.default(new W.default(l.amount.sub((P=l.fee)!=null?P:Q).toString()).toFixed(0)),y;if(c.lte(p))y=t?O.getLiquidityFromTokenAmountA(p,d,b,!r):new H.default(0);else if(c.lte(d)){let T=O.getLiquidityFromTokenAmountA(c,d,b,!r),S=O.getLiquidityFromTokenAmountB(p,c,b);y=t?T:S}else y=t?new H.default(0):O.getLiquidityFromTokenAmountB(p,d,b);let k=await re.getAmountsFromLiquidity({epochInfo:a,poolInfo:e,tickLower:n,tickUpper:i,liquidity:y,slippage:s,add:r});return{liquidity:y,amountA:t?l:k.amountA,amountB:t?k.amountB:l,amountSlippageA:t?l:k.amountSlippageA,amountSlippageB:t?k.amountSlippageB:l,expirationTime:k.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:r}){var k,f,P,T;let a=L.getSqrtPriceX64FromTick(n),u=L.getSqrtPriceX64FromTick(i),c=r?1+s:1-s,p=O.getAmountsFromLiquidity(L.priceToSqrtPriceX64(new W.default(t.price),t.mintA.decimals,t.mintB.decimals),a,u,o,r),[d,l]=[te(p.amountA,(k=t.mintA.extensions)==null?void 0:k.feeConfig,e,!0),te(p.amountB,(f=t.mintB.extensions)==null?void 0:f.feeConfig,e,!0)],[b,y]=[te(p.amountA.muln(c),(P=t.mintA.extensions)==null?void 0:P.feeConfig,e,!0),te(p.amountB.muln(c),(T=t.mintB.extensions)==null?void 0:T.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:l,amountSlippageA:b,amountSlippageB:y,expirationTime:Ee(d.expirationTime,l.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(a=>!n[a.id]).map(a=>new ke.PublicKey(a.id));(await Me(e,i)).forEach((a,u)=>{!a||(n[i[u].toBase58()]=Un.decode(a.data))});let s=t.map(a=>le(new ke.PublicKey(a.programId),new ke.PublicKey(a.id)).publicKey),r=await re.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((a,u)=>$(j({},a),{[u.id]:$(j({},n[u.id]),{id:new ke.PublicKey(u.id),version:6,programId:new ke.PublicKey(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:$(j({},u.config),{id:new ke.PublicKey(u.config.id),fundOwner:""}),currentPrice:new W.default(u.price),exBitmapAccount:le(new ke.PublicKey(u.programId),new ke.PublicKey(u.id)).publicKey,exBitmapInfo:r[le(new ke.PublicKey(u.programId),new ke.PublicKey(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var M=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(Q)||(o=o.add(Ne)),o}static mulDivFloor(e,t,n){if(n.eq(Q))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(Q))throw new Error("division by 0");return e.mul(t).add(n.sub(Ne)).div(n)}static x64ToDecimal(e,t){return new Ie.default(e.toString()).div(Ie.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new R.default(e.mul(Ie.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(ht).sub(t).mod(ht)}};function ue(m,e){return $t(m.mul(e),64,256)}function Li(m,e,t){let n=m.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function $t(m,e,t){let n=m.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var L=class{static sqrtPriceX64ToPrice(e,t,n){return M.x64ToDecimal(e).pow(2).mul(Ie.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return M.decimalToX64(e.mul(Ie.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(Q))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Q))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(Q))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Q))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(Q))return e;let o=t.shln(ut);if(i){let s=o,r=o.add(n.mul(e));return r.gte(s)?M.mulDivCeil(s,e,r):M.mulDivRoundingUp(s,Ne,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let r=o.sub(s);return M.mulDivCeil(o,e,r)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(ut);if(i)return e.add(o.div(t));{let s=M.mulDivRoundingUp(o,Ne,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<de||e>ye)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new R.default("18445821805675395072"):new R.default("18446744073709551616");return(t&2)!=0&&(n=ue(n,new R.default("18444899583751176192"))),(t&4)!=0&&(n=ue(n,new R.default("18443055278223355904"))),(t&8)!=0&&(n=ue(n,new R.default("18439367220385607680"))),(t&16)!=0&&(n=ue(n,new R.default("18431993317065453568"))),(t&32)!=0&&(n=ue(n,new R.default("18417254355718170624"))),(t&64)!=0&&(n=ue(n,new R.default("18387811781193609216"))),(t&128)!=0&&(n=ue(n,new R.default("18329067761203558400"))),(t&256)!=0&&(n=ue(n,new R.default("18212142134806163456"))),(t&512)!=0&&(n=ue(n,new R.default("17980523815641700352"))),(t&1024)!=0&&(n=ue(n,new R.default("17526086738831433728"))),(t&2048)!=0&&(n=ue(n,new R.default("16651378430235570176"))),(t&4096)!=0&&(n=ue(n,new R.default("15030750278694412288"))),(t&8192)!=0&&(n=ue(n,new R.default("12247334978884435968"))),(t&16384)!=0&&(n=ue(n,new R.default("8131365268886854656"))),(t&32768)!=0&&(n=ue(n,new R.default("3584323654725218816"))),(t&65536)!=0&&(n=ue(n,new R.default("696457651848324352"))),(t&131072)!=0&&(n=ue(n,new R.default("26294789957507116"))),(t&262144)!=0&&(n=ue(n,new R.default("37481735321082"))),e>0&&(n=Ln.div(n)),n}static getTickFromPrice(e,t,n){return L.getTickFromSqrtPriceX64(L.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(qe)||e.lt(Ve))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new R.default(t-64),i=Li(n,32,128),o=new R.default("8000000000000000","hex"),s=0,r=new R.default(0),a=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new R.default(0))&&s<Rn;){a=a.mul(a);let b=a.shrn(127);a=a.shrn(63+b.toNumber()),r=r.add(o.mul(b)),o=o.shrn(1),s+=1}let u=r.shrn(32),p=i.add(u).mul(new R.default(Mn)),d=$t(p.sub(new R.default(_n)),64,128).toNumber(),l=$t(p.add(new R.default(Fn)),64,128).toNumber();return d==l?d:L.getSqrtPriceX64FromTick(l).lte(e)?l:d}},Xe=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=L.getTickFromSqrtPriceX64(L.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=Xe.getTickWithPriceAndTickspacing(e,t,n,i),s=L.getSqrtPriceX64FromTick(o);return L.sqrtPriceX64ToPrice(s,n,i)}},O=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Q))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(ut),s=t.sub(e);return i?M.mulDivRoundingUp(M.mulDivCeil(o,s,t),Ne,e):M.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Q))throw new Error("sqrtPriceX64A must greater than 0");return i?M.mulDivCeil(n,t.sub(e),Te):M.mulDivFloor(n,t.sub(e),Te)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),r=o.div(s);return i?M.mulDivRoundingUp(r,Ne,Xt):r.shrn(ut)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),M.mulDivFloor(n,Xt,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return O.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=O.getLiquidityFromTokenAmountA(e,n,i,!1),r=O.getLiquidityFromTokenAmountB(t,e,o);return s.lt(r)?s:r}else return O.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:O.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new R.default(0)};if(e.lt(n)){let s=O.getTokenAmountAFromLiquidity(e,n,i,o),r=O.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:r}}else return{amountA:new R.default(0),amountB:O.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,r){let{amountA:a,amountB:u}=O.getAmountsFromLiquidity(e,t,n,i,s),c=o?1+r:1-r,p=new R.default(new Ie.default(a.toString()).mul(c).toFixed(0)),d=new R.default(new Ie.default(u.toString()).mul(c).toFixed(0));return{amountSlippageA:p,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:r,amountAddFee:a}){var P,T,S,N;let u=L.priceToSqrtPriceX64(new Ie.default(e.price),e.mintA.decimals,e.mintB.decimals),c=L.getSqrtPriceX64FromTick(t),p=L.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,l=O.getAmountsFromLiquidity(u,c,p,i,s),[b,y]=[te(l.amountA,(P=e.mintA.extensions)==null?void 0:P.feeConfig,r,a),te(l.amountB,(T=e.mintB.extensions)==null?void 0:T.feeConfig,r,a)],[k,f]=[te(new R.default(new Ie.default(l.amountA.toString()).mul(d).toFixed(0)),(S=e.mintA.extensions)==null?void 0:S.feeConfig,r,a),te(new R.default(new Ie.default(l.amountB.toString()).mul(d).toFixed(0)),(N=e.mintB.extensions)==null?void 0:N.feeConfig,r,a)];return{liquidity:i,amountA:b,amountB:y,amountSlippageA:k,amountSlippageB:f,expirationTime:Ee(b.expirationTime,y.expirationTime)}}},Ue=class{static swapCompute(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y=!1){if(d.eq(Q))throw new Error("amountSpecified must not be 0");if(b||(b=s?Ve.add(Ne):qe.sub(Ne)),s){if(b.lt(Ve))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(p))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(qe))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(p))throw new Error("sqrtPriceX64 must greater than current")}let k=d.gt(Q),f={amountSpecifiedRemaining:d,amountCalculated:Q,sqrtPriceX64:p,tick:u>l?Math.min(l+D.tickCount(c)-1,u):l,accounts:[],liquidity:a,feeAmount:new R.default(0)},P=l,T=n[l],S=0,N=!s&&T.startTickIndex===f.tick;for(;!f.amountSpecifiedRemaining.eq(Q)&&!f.sqrtPriceX64.eq(b);){S>10;let w={};w.sqrtPriceStartX64=f.sqrtPriceX64;let K=A.nextInitTick(T,f.tick,c,s,N),C=K||null,F=null;if(!(C!=null&&C.liquidityGross.gtn(0))){let v=re.nextInitializedTickArrayStartIndex({tickCurrent:f.tick,tickSpacing:c,tickArrayBitmap:i,exBitmapInfo:o},P,s);if(!v.isExist){if(y)return{allTrade:!1,amountSpecifiedRemaining:f.amountSpecifiedRemaining,amountCalculated:f.amountCalculated,feeAmount:f.feeAmount,sqrtPriceX64:f.sqrtPriceX64,liquidity:f.liquidity,tickCurrent:f.tick,accounts:f.accounts};throw Error("swapCompute LiquidityInsufficient")}P=v.nextStartIndex;let{publicKey:ce}=U(e,t,P);F=ce,T=n[P];try{C=A.firstInitializedTick(T,s)}catch{throw Error("not found next tick info")}}w.tickNext=C.tick,w.initialized=C.liquidityGross.gtn(0),l!==P&&F&&(f.accounts.push(F),l=P),w.tickNext<de?w.tickNext=de:w.tickNext>ye&&(w.tickNext=ye),w.sqrtPriceNextX64=L.getSqrtPriceX64FromTick(w.tickNext);let X;if(s&&w.sqrtPriceNextX64.lt(b)||!s&&w.sqrtPriceNextX64.gt(b)?X=b:X=w.sqrtPriceNextX64,[f.sqrtPriceX64,w.amountIn,w.amountOut,w.feeAmount]=Ue.swapStepCompute(f.sqrtPriceX64,X,f.liquidity,f.amountSpecifiedRemaining,r,s),f.feeAmount=f.feeAmount.add(w.feeAmount),k?(f.amountSpecifiedRemaining=f.amountSpecifiedRemaining.sub(w.amountIn.add(w.feeAmount)),f.amountCalculated=f.amountCalculated.sub(w.amountOut)):(f.amountSpecifiedRemaining=f.amountSpecifiedRemaining.add(w.amountOut),f.amountCalculated=f.amountCalculated.add(w.amountIn.add(w.feeAmount))),f.sqrtPriceX64.eq(w.sqrtPriceNextX64)){if(w.initialized){let v=C.liquidityNet;s&&(v=v.mul(Le)),f.liquidity=O.addDelta(f.liquidity,v)}N=w.tickNext!=f.tick&&!s&&T.startTickIndex===w.tickNext,f.tick=s?w.tickNext-1:w.tickNext}else if(f.sqrtPriceX64!=w.sqrtPriceStartX64){let v=L.getTickFromSqrtPriceX64(f.sqrtPriceX64);N=v!=f.tick&&!s&&T.startTickIndex===v,f.tick=v}++S}try{let{nextStartIndex:w,isExist:K}=D.nextInitializedTickArray(f.tick,c,s,i,o);K&&l!==w&&(f.accounts.push(U(e,t,w).publicKey),l=w)}catch{}return{allTrade:!0,amountSpecifiedRemaining:Q,amountCalculated:f.amountCalculated,feeAmount:f.feeAmount,sqrtPriceX64:f.sqrtPriceX64,liquidity:f.liquidity,tickCurrent:f.tick,accounts:f.accounts}}static swapStepCompute(e,t,n,i,o,s){let r={sqrtPriceX64Next:new R.default(0),amountIn:new R.default(0),amountOut:new R.default(0),feeAmount:new R.default(0)},a=i.gte(Q);if(a){let c=M.mulDivFloor(i,At.sub(new R.default(o.toString())),At);r.amountIn=s?O.getTokenAmountAFromLiquidity(t,e,n,!0):O.getTokenAmountBFromLiquidity(e,t,n,!0),c.gte(r.amountIn)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=L.getNextSqrtPriceX64FromInput(e,n,c,s)}else r.amountOut=s?O.getTokenAmountBFromLiquidity(t,e,n,!1):O.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Le).gte(r.amountOut)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=L.getNextSqrtPriceX64FromOutput(e,n,i.mul(Le),s);let u=t.eq(r.sqrtPriceX64Next);return s?(u&&a||(r.amountIn=O.getTokenAmountAFromLiquidity(r.sqrtPriceX64Next,e,n,!0)),u&&!a||(r.amountOut=O.getTokenAmountBFromLiquidity(r.sqrtPriceX64Next,e,n,!1))):(r.amountIn=u&&a?r.amountIn:O.getTokenAmountBFromLiquidity(e,r.sqrtPriceX64Next,n,!0),r.amountOut=u&&!a?r.amountOut:O.getTokenAmountAFromLiquidity(e,r.sqrtPriceX64Next,n,!1)),!a&&r.amountOut.gt(i.mul(Le))&&(r.amountOut=i.mul(Le)),a&&!r.sqrtPriceX64Next.eq(t)?r.feeAmount=i.sub(r.amountIn):r.feeAmount=M.mulDivCeil(r.amountIn,new R.default(o),At.sub(new R.default(o))),[r.sqrtPriceX64Next,r.amountIn,r.amountOut,r.feeAmount]}};var oe=60,Ge=512,A=class{static getTickArrayAddressByTick(e,t,n,i){let o=A.getTickArrayStartIndexByTick(n,i),{publicKey:s}=U(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=A.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=oe)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=D.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*D.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*oe,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*oe,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*oe:e+t*oe}static mergeTickArrayBitmap(e){let t=new Hn.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*oe));return[...A.searchLowBitFromStart(e,t,s-1,o,n),...A.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return A.searchHightBitFromStart(e,t,-7680,Ge,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],r=A.getAllInitializedTickArrayStartIndex(n,i,o);for(let a of r){let{publicKey:u}=U(e,t,a);s.push({tickArrayStartIndex:a,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>A.mergeTickArrayBitmap(u)),r=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),c=(n+7680)%512;if(s[u].testn(c)&&r.push(n),n--,r.length===i)break}let a=D.tickCount(o);return r.map(u=>u*a)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>A.mergeTickArrayBitmap(u)),r=[];for(;n<7680;){let u=Math.floor((n+7680)/512),c=(n+7680)%512;if(s[u].testn(c)&&r.push(n),n++,r.length===i)break}let a=D.tickCount(o);return r.map(u=>u*a)}static checkIsOutOfBoundary(e){return e<de||e>ye}static nextInitTick(e,t,n,i,o){if(D.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let r=Math.floor((t-e.startTickIndex)/n);if(i)for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r-1}else for(o||(r=r+1);r<oe;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r+1}return null}static firstInitializedTick(e,t){if(t){let n=oe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<oe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=L.getSqrtPriceX64FromTick(t),o=L.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new ze.default(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new ze.default(1).div(t),o=Xe.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=L.getSqrtPriceX64FromTick(o),r=L.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:r}:{tick:o,price:new ze.default(1).div(r)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=L.getSqrtPriceX64FromTick(t),o=L.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new ze.default(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new ze.default(1).div(t),o=Xe.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=L.getSqrtPriceX64FromTick(o),r=L.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:r}:{tick:o,price:new ze.default(1).div(r)}}};var Iu=G([we(8),ee("bump"),at("index"),z(""),Qe("protocolFeeRate"),Qe("tradeFeeRate"),at("tickSpacing"),J(B(),8,"")]),Ri=G([Qe("blockTimestamp"),Nn("tickCumulative"),J(B(),4)]),jn=G([we(8),be("initialized"),B("recentEpoch"),at("observationIndex"),z("poolId"),J(Ri,100,"observations"),J(B(),4)]),Mi=G([ee("rewardState"),B("openTime"),B("endTime"),B("lastUpdateTime"),E("emissionsPerSecondX64"),B("rewardTotalEmissioned"),B("rewardClaimed"),z("tokenMint"),z("tokenVault"),z("creator"),E("rewardGrowthGlobalX64")]),Un=G([we(8),ee("bump"),z("ammConfig"),z("creator"),z("mintA"),z("mintB"),z("vaultA"),z("vaultB"),z("observationId"),ee("mintDecimalsA"),ee("mintDecimalsB"),at("tickSpacing"),E("liquidity"),E("sqrtPriceX64"),Z("tickCurrent"),Qe(),E("feeGrowthGlobalX64A"),E("feeGrowthGlobalX64B"),B("protocolFeesTokenA"),B("protocolFeesTokenB"),E("swapInAmountTokenA"),E("swapOutAmountTokenB"),E("swapInAmountTokenB"),E("swapOutAmountTokenA"),ee("status"),J(ee(),7,""),J(Mi,3,"rewardInfos"),J(B(),16,"tickArrayBitmap"),B("totalFeesTokenA"),B("totalFeesClaimedTokenA"),B("totalFeesTokenB"),B("totalFeesClaimedTokenB"),B("fundFeesTokenA"),B("fundFeesTokenB"),B("startTime"),J(B(),15*4-3,"padding")]),_i=G([E("growthInsideLastX64"),B("rewardAmountOwed")]),Xn=G([we(8),ee("bump"),z("nftMint"),z("poolId"),Z("tickLower"),Z("tickUpper"),E("liquidity"),E("feeGrowthInsideLastX64A"),E("feeGrowthInsideLastX64B"),B("tokenFeesOwedA"),B("tokenFeesOwedB"),J(_i,3,"rewardInfos"),J(B(),8,"")]),Ku=G([we(8),ee("bump"),z("poolId"),Z("tickLowerIndex"),Z("tickUpperIndex"),E("liquidity"),E("feeGrowthInsideLastX64A"),E("feeGrowthInsideLastX64B"),B("tokenFeesOwedA"),B("tokenFeesOwedB"),J(E(),3,"rewardGrowthInside"),J(B(),8,"")]),Fi=G([Z("tick"),Cn("liquidityNet"),E("liquidityGross"),E("feeGrowthOutsideX64A"),E("feeGrowthOutsideX64B"),J(E(),3,"rewardGrowthsOutsideX64"),J(Qe(),13,"")]),dt=G([we(8),z("poolId"),Z("startTickIndex"),J(Fi,oe,"ticks"),ee("initializedTickCount"),J(ee(),115,"")]),Nu=G([we(329),J(z(),100,"whitelistMints")]),zn=G([we(8),z("poolId"),J(J(B(),8),Jt,"positiveTickArrayBitmap"),J(J(B(),8),Jt,"negativeTickArrayBitmap")]),Cu=G([B(),ee("bump"),z("owner"),z("poolId"),z("positionId"),z("nftAccount"),J(B(),8)]),Lu=G([we(8),ee("bump"),z("lockOwner"),z("poolId"),z("positionId"),z("nftAccount"),z("lockNftMint"),B("recentEpoch"),J(B(),8)]);jn.span;var Yn=pe("Raydium_Clmm"),Ae={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Zn=[188,37,179,131,82,150,84,73],Jn=[16,72,250,198,14,162,212,19],ft=class{static createPoolInstruction(e,t,n,i,o,s,r,a,u,c,p,d,l,b){let y=G([E("sqrtPriceX64"),B("zero")]),k=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:_e,isSigner:!1,isWritable:!1},...(b==null?void 0:b.map(T=>({pubkey:T,isSigner:!1,isWritable:!1})))||[]],f=Buffer.alloc(y.span);y.encode({sqrtPriceX64:l,zero:Q},f);let P=Buffer.from([...Ae.createPool,...f]);return new g.TransactionInstruction({keys:k,programId:e,data:P})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:o,ammConfigId:s,initialPriceX64:r,extendMintAccount:a}=e,[u,c]=[new g.PublicKey(i.address),new g.PublicKey(o.address)],{publicKey:p}=On(t,s,u,c),{publicKey:d}=Vn(t,p),{publicKey:l}=jt(t,p,u),{publicKey:b}=jt(t,p,c),y=le(t,p).publicKey,k=[this.createPoolInstruction(t,p,n,s,d,u,l,new g.PublicKey(i.programId||h.TOKEN_PROGRAM_ID),c,b,new g.PublicKey(o.programId||h.TOKEN_PROGRAM_ID),y,r,a)];return{signers:[],instructions:k,instructionTypes:[ae.CreateAccount,ae.ClmmCreatePool],address:{poolId:p,observationId:d,exBitmapAccount:y,mintAVault:l,mintBVault:b},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f,P,T,S,N,w,K,C,F,X){let v=G([Z("tickLowerIndex"),Z("tickUpperIndex"),Z("tickArrayLowerStartIndex"),Z("tickArrayUpperStartIndex"),E("liquidity"),B("amountMaxA"),B("amountMaxB"),be("withMetadata"),ee("optionBaseFlag"),be("baseFlag")]),ce=[...X?[{pubkey:X,isSigner:!1,isWritable:!0}]:[]],ne=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:_e,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...ce],ge=Buffer.alloc(v.span);v.encode({tickLowerIndex:P,tickUpperIndex:T,tickArrayLowerStartIndex:S,tickArrayUpperStartIndex:N,liquidity:w,amountMaxA:K,amountMaxB:C,withMetadata:F==="create",baseFlag:!1,optionBaseFlag:0},ge);let He=Buffer.from([...Ae.openPosition,...ge]);return new g.TransactionInstruction({keys:ne,programId:e,data:He})}static openPositionFromLiquidityInstruction22(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f,P,T,S,N,w,K,C,F){let X=G([Z("tickLowerIndex"),Z("tickUpperIndex"),Z("tickArrayLowerStartIndex"),Z("tickArrayUpperStartIndex"),E("liquidity"),B("amountMaxA"),B("amountMaxB"),be("withMetadata"),ee("optionBaseFlag"),be("baseFlag")]),v=[...F?[{pubkey:F,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:_e,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...v],ne=Buffer.alloc(X.span);X.encode({tickLowerIndex:f,tickUpperIndex:P,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:S,liquidity:N,amountMaxA:w,amountMaxB:K,withMetadata:C==="create",baseFlag:!1,optionBaseFlag:0},ne);let ge=Buffer.from([...Ae.openPositionWithTokenEx,...ne]);return new g.TransactionInstruction({keys:ce,programId:e,data:ge})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:r,amountMaxB:a,withMetadata:u,getEphemeralSigners:c,nft2022:p}){let d=[],[l,b]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],y;if(c)y=new g.PublicKey((await c(1))[0]);else{let F=g.Keypair.generate();d.push(F),y=F.publicKey}let k=A.getTickArrayStartIndexByTick(i,e.config.tickSpacing),f=A.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:P}=U(l,b,k),{publicKey:T}=U(l,b,f),{publicKey:S}=p?ie(n.wallet,y,h.TOKEN_2022_PROGRAM_ID):ie(n.wallet,y,h.TOKEN_PROGRAM_ID),{publicKey:N}=lt(y),{publicKey:w}=he(l,y),{publicKey:K}=We(l,b,i,o),C=p?this.openPositionFromLiquidityInstruction22(l,n.feePayer,b,n.wallet,y,S,K,P,T,w,n.tokenAccountA,n.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address),i,o,k,f,s,r,a,u,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[k,f])?le(l,b).publicKey:void 0):this.openPositionFromLiquidityInstruction(l,n.feePayer,b,n.wallet,y,S,N,K,P,T,w,n.tokenAccountA,n.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address),i,o,k,f,s,r,a,u,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[k,f])?le(l,b).publicKey:void 0);return{signers:d,instructions:[C],instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:S,metadataAccount:N,personalPosition:w,protocolPosition:K}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:r,otherAmountMax:a,withMetadata:u,getEphemeralSigners:c,nft2022:p}){let d=[],[l,b]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],y;if(c)y=new g.PublicKey((await c(1))[0]);else{let F=g.Keypair.generate();d.push(F),y=F.publicKey}let k=A.getTickArrayStartIndexByTick(i,e.config.tickSpacing),f=A.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:P}=U(l,b,k),{publicKey:T}=U(l,b,f),{publicKey:S}=p?ie(n.wallet,y,h.TOKEN_2022_PROGRAM_ID):ie(n.wallet,y,h.TOKEN_PROGRAM_ID),{publicKey:N}=lt(y),{publicKey:w}=he(l,y),{publicKey:K}=We(l,b,i,o),C=p?this.openPositionFromBaseInstruction22(l,n.feePayer,b,n.wallet,y,S,K,P,T,w,n.tokenAccountA,n.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address),i,o,k,f,u,s,r,a,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[k,f])?le(l,b).publicKey:void 0):this.openPositionFromBaseInstruction(l,n.feePayer,b,n.wallet,y,S,N,K,P,T,w,n.tokenAccountA,n.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address),i,o,k,f,u,s,r,a,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[k,f])?le(l,b).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:S,metadataAccount:N,personalPosition:w,protocolPosition:K},instructions:[C],signers:d,instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f,P,T,S,N,w,K,C,F,X){let v=G([Z("tickLowerIndex"),Z("tickUpperIndex"),Z("tickArrayLowerStartIndex"),Z("tickArrayUpperStartIndex"),E("liquidity"),B("amountMaxA"),B("amountMaxB"),be("withMetadata"),ee("optionBaseFlag"),be("baseFlag")]),ce=[...X?[{pubkey:X,isSigner:!1,isWritable:!0}]:[]],ne=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:_e,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...ce],ge=Buffer.alloc(v.span);v.encode({tickLowerIndex:P,tickUpperIndex:T,tickArrayLowerStartIndex:S,tickArrayUpperStartIndex:N,liquidity:new St.default(0),amountMaxA:K==="MintA"?C:F,amountMaxB:K==="MintA"?F:C,withMetadata:w==="create",baseFlag:K==="MintA",optionBaseFlag:1},ge);let He=Buffer.from([...Ae.openPosition,...ge]);return new g.TransactionInstruction({keys:ne,programId:e,data:He})}static openPositionFromBaseInstruction22(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f,P,T,S,N,w,K,C,F){let X=G([Z("tickLowerIndex"),Z("tickUpperIndex"),Z("tickArrayLowerStartIndex"),Z("tickArrayUpperStartIndex"),E("liquidity"),B("amountMaxA"),B("amountMaxB"),be("withMetadata"),ee("optionBaseFlag"),be("baseFlag")]),v=[...F?[{pubkey:F,isSigner:!1,isWritable:!0}]:[]],ce=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:_e,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...v],ne=Buffer.alloc(X.span);X.encode({tickLowerIndex:f,tickUpperIndex:P,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:S,liquidity:new St.default(0),amountMaxA:w==="MintA"?K:C,amountMaxB:w==="MintA"?C:K,withMetadata:N==="create",baseFlag:w==="MintA",optionBaseFlag:1},ne);let ge=Buffer.from([...Ae.openPositionWithTokenEx,...ne]);return new g.TransactionInstruction({keys:ce,programId:e,data:ge})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:r,amountMaxB:a,withMetadata:u,getEphemeralSigners:c,nft2022:p}){let d,l=[];if(c)d=new g.PublicKey((await c(1))[0]);else{let F=g.Keypair.generate();l.push(F),d=F.publicKey}let[b,y]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],k=A.getTickArrayStartIndexByTick(i,e.config.tickSpacing),f=A.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:P}=U(b,y,k),{publicKey:T}=U(b,y,f),{publicKey:S}=p?ie(n.wallet,d,h.TOKEN_2022_PROGRAM_ID):ie(n.wallet,d,h.TOKEN_PROGRAM_ID),{publicKey:N}=lt(d),{publicKey:w}=he(b,d),{publicKey:K}=We(b,y,i,o),C=p?this.openPositionFromLiquidityInstruction22(b,n.wallet,y,n.wallet,d,S,K,P,T,w,n.tokenAccountA,n.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(t.mintA.address),new g.PublicKey(t.mintB.address),i,o,k,f,s,r,a,u,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[k,f])?le(b,y).publicKey:void 0):this.openPositionFromLiquidityInstruction(b,n.wallet,y,n.wallet,d,S,N,K,P,T,w,n.tokenAccountA,n.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(t.mintA.address),new g.PublicKey(t.mintB.address),i,o,k,f,s,r,a,u,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[k,f])?le(b,y).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:S,metadataAccount:N,personalPosition:w,protocolPosition:K},instructions:[C],signers:l,instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o,s){let r=G([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:s?h.TOKEN_2022_PROGRAM_ID:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],u=Buffer.alloc(r.span);r.encode({},u);let c=Buffer.from([...Ae.closePosition,...u]);return new g.TransactionInstruction({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:o}){let s=new g.PublicKey(e.programId),r=o?ie(n.wallet,i.nftMint,h.TOKEN_2022_PROGRAM_ID).publicKey:ie(n.wallet,i.nftMint,h.TOKEN_PROGRAM_ID).publicKey,{publicKey:a}=he(s,i.nftMint),u=[];return u.push(this.closePositionInstruction(s,n.wallet,i.nftMint,r,a,o)),{address:{positionNftAccount:r,personalPosition:a},signers:[],instructions:u,instructionTypes:[ae.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f,P){let T=G([E("liquidity"),B("amountMaxA"),B("amountMaxB"),ee("optionBaseFlag"),be("baseFlag")]),S=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],N=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...S],w=Buffer.alloc(T.span);T.encode({liquidity:y,amountMaxA:k,amountMaxB:f,optionBaseFlag:0,baseFlag:!1},w);let K=Buffer.from([...Ae.increaseLiquidity,...w]);return new g.TransactionInstruction({keys:N,programId:e,data:K})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:r,nft2022:a}){let[u,c]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],p=A.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=A.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:l}=U(u,c,p),{publicKey:b}=U(u,c,d),{publicKey:y}=a?ie(i.wallet,n.nftMint,h.TOKEN_2022_PROGRAM_ID):ie(i.wallet,n.nftMint,h.TOKEN_PROGRAM_ID),{publicKey:k}=he(u,n.nftMint),{publicKey:f}=We(u,c,n.tickLower,n.tickUpper),P=this.increasePositionFromLiquidityInstruction(u,i.wallet,y,k,c,f,l,b,i.tokenAccountA,i.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address),o,s,r,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,d])?le(u,c).publicKey:void 0);return{address:{tickArrayLower:l,tickArrayUpper:b,positionNftAccount:y,personalPosition:k,protocolPosition:f},signers:[],instructions:[P],instructionTypes:[ae.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:r,nft2022:a}){let[u,c]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],p=A.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=A.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:l}=U(u,c,p),{publicKey:b}=U(u,c,d),{publicKey:y}=a?ie(i.wallet,n.nftMint,h.TOKEN_2022_PROGRAM_ID):ie(i.wallet,n.nftMint,h.TOKEN_PROGRAM_ID),{publicKey:k}=he(u,n.nftMint),{publicKey:f}=We(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:l,tickArrayUpper:b,positionNftAccount:y,personalPosition:k,protocolPosition:f},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,y,k,c,f,l,b,i.tokenAccountA,i.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address),o,s,r,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,d])?le(u,c).publicKey:void 0)],signers:[],instructionTypes:[ae.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f,P){let T=G([E("liquidity"),B("amountMaxA"),B("amountMaxB"),ee("optionBaseFlag"),be("baseFlag")]),S=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],N=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...S],w=Buffer.alloc(T.span);T.encode({liquidity:new St.default(0),amountMaxA:y==="MintA"?k:f,amountMaxB:y==="MintA"?f:k,baseFlag:y==="MintA",optionBaseFlag:1},w);let K=Buffer.from([...Ae.increaseLiquidity,...w]);return new g.TransactionInstruction({keys:N,programId:e,data:K})}static decreaseLiquidityInstruction(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f,P,T){let S=G([E("liquidity"),B("amountMinA"),B("amountMinB")]),N=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[],...y.map(F=>[{pubkey:F.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:F.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:F.rewardMint,isSigner:!1,isWritable:!1}]).flat()],w=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...N],K=Buffer.alloc(S.span);S.encode({liquidity:k,amountMinA:f,amountMinB:P},K);let C=Buffer.from([...Ae.decreaseLiquidity,...K]);return new g.TransactionInstruction({keys:w,programId:e,data:C})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:r,programId:a,nft2022:u}){let[c,p]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],d=A.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=A.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:b}=U(c,p,d),{publicKey:y}=U(c,p,l),{publicKey:k}=u?ie(i.wallet,n.nftMint,h.TOKEN_2022_PROGRAM_ID):ie(i.wallet,n.nftMint,a),{publicKey:f}=he(c,n.nftMint),{publicKey:P}=We(c,p,n.tickLower,n.tickUpper),T=[];for(let w=0;w<e.rewardDefaultInfos.length;w++)T.push({poolRewardVault:new g.PublicKey(t.rewardInfos[w].vault),ownerRewardVault:i.rewardAccounts[w],rewardMint:new g.PublicKey(e.rewardDefaultInfos[w].mint.address)});let S=[],N=this.decreaseLiquidityInstruction(c,i.wallet,k,f,p,P,b,y,i.tokenAccountA,i.tokenAccountB,new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B),new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address),T,o,s,r,re.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,l])?le(c,p).publicKey:void 0);return S.push(N),{address:{tickArrayLower:b,tickArrayUpper:y,positionNftAccount:k,personalPosition:f,protocolPosition:P},signers:[],instructions:S,instructionTypes:[ae.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,r,a,u,c,p,d,l,b,y,k,f){let P=G([B("amount"),B("otherAmountThreshold"),E("sqrtPriceLimitX64"),be("isBaseInput")]),T=[...f?[{pubkey:f,isSigner:!1,isWritable:!0}]:[],...p.map(K=>({pubkey:K,isSigner:!1,isWritable:!0}))],S=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...T],N=Buffer.alloc(P.span);P.encode({amount:l,otherAmountThreshold:b,sqrtPriceLimitX64:y,isBaseInput:k},N);let w=Buffer.from([...Ae.swap,...N]);return new g.TransactionInstruction({keys:S,programId:e,data:w})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:o,amountIn:s,amountOutMin:r,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,p]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],[d,l]=[new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B)],[b,y]=[new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address)],k=e.mintA.address===o.toString(),f=[this.swapInstruction(c,i.wallet,p,new g.PublicKey(e.config.id),k?i.tokenAccountA:i.tokenAccountB,k?i.tokenAccountB:i.tokenAccountA,k?d:l,k?l:d,k?b:y,k?y:b,u,n,s,r,a,!0,le(c,p).publicKey)];return{signers:[],instructions:f,instructionTypes:[ae.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:o,amountOut:s,amountInMax:r,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,p]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],[d,l]=[new g.PublicKey(t.vault.A),new g.PublicKey(t.vault.B)],[b,y]=[new g.PublicKey(e.mintA.address),new g.PublicKey(e.mintB.address)],k=e.mintA.address===o.toBase58(),f=[this.swapInstruction(c,i.wallet,p,new g.PublicKey(e.config.id),k?i.tokenAccountB:i.tokenAccountA,k?i.tokenAccountA:i.tokenAccountB,k?l:d,k?d:l,k?y:b,k?b:y,u,n,s,r,a,!1,le(c,p).publicKey)];return{signers:[],instructions:f,instructionTypes:[ae.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,r,a,u,c,p,d){let l=G([B("openTime"),B("endTime"),E("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:_e,isSigner:!1,isWritable:!1}],y=Buffer.alloc(l.span);l.encode({openTime:se(c),endTime:se(p),emissionsPerSecondX64:d},y);let k=Buffer.from([...Ae.initReward,...y]);return new g.TransactionInstruction({keys:b,programId:e,data:k})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],r=vn(o,s,i.mint).publicKey,a=Yt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,a,new g.PublicKey(e.config.id),n.tokenAccount,i.programId,i.mint,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:r,operationId:a},signers:[],instructions:u,instructionTypes:[ae.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,r,a,u,c,p,d){let l=G([ee("rewardIndex"),E("emissionsPerSecondX64"),B("openTime"),B("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0}],y=Buffer.alloc(l.span);l.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:se(c),endTime:se(p)},y);let k=Buffer.from([...Ae.setRewardEmissions,...y]);return new g.TransactionInstruction({keys:b,programId:e,data:k})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],r,a,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(r=d,a=new g.PublicKey(t.rewardInfos[d].vault),u=new g.PublicKey(t.rewardInfos[d].mint.address));(r===void 0||a===void 0)&&Yn.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=Yt(o).publicKey,p=[this.setRewardInstruction(o,n.wallet,s,c,new g.PublicKey(e.config.id),n.tokenAccount,a,u,r,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:a,operationId:c},signers:[],instructions:p,instructionTypes:[ae.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,r){let a=G([ee("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1}],c=Buffer.alloc(a.span);a.encode({rewardIndex:r},c);let p=Buffer.from([...Ae.collectReward,...c]);return new g.TransactionInstruction({keys:u,programId:e,data:p})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new g.PublicKey(e.programId),new g.PublicKey(e.id)],r,a;for(let c=0;c<e.rewardDefaultInfos.length;c++)e.rewardDefaultInfos[c].mint.address===i.toString()&&(r=c,a=new g.PublicKey(t.rewardInfos[c].vault));(r===void 0||a===void 0)&&Yn.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,a,i,r)];return{address:{rewardVault:a},signers:[],instructions:u,instructionTypes:[ae.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:o,nftMint:s,nft2022:r,getEphemeralSigners:a}){let u=[],c;if(a)c=new g.PublicKey((await a(1))[0]);else{let f=g.Keypair.generate();u.push(f),c=f.publicKey}let p=r?ie(o,s,h.TOKEN_2022_PROGRAM_ID).publicKey:ie(o,s,h.TOKEN_PROGRAM_ID).publicKey,{publicKey:d}=he(n,s),l=Gn(e,c).publicKey,b=ie(o,c,h.TOKEN_PROGRAM_ID).publicKey,y=lt(c).publicKey,k=ft.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:o,lockOwner:o,positionNftAccount:p,positionId:d,lockPositionId:l,lockNftMint:c,lockNftAccount:b,metadataAccount:y,withMetadata:!0,nft2022:r,positionNftMint:s,authPositionNftAccount:ie(t,s,r?h.TOKEN_2022_PROGRAM_ID:h.TOKEN_PROGRAM_ID).publicKey,positionNftProgram:r?h.TOKEN_2022_PROGRAM_ID:h.TOKEN_PROGRAM_ID});return{address:{positionId:d,lockPositionId:l,lockNftAccount:b,lockNftMint:c,positionNftAccount:p,metadataAccount:y},instructions:[k],signers:u,instructionTypes:[ae.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:o,positionNftAccount:s,positionId:r,positionNftMint:a,authPositionNftAccount:u,positionNftProgram:c,lockPositionId:p,lockNftMint:d,lockNftAccount:l,metadataAccount:b,withMetadata:y}){let k=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Oe,isSigner:!1,isWritable:!1},{pubkey:h.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_e,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1}],f=G([be("withMetadata")]),P=Buffer.alloc(f.span);f.encode({withMetadata:y},P);let T=Buffer.from([...Zn,...P]);return new g.TransactionInstruction({keys:k,programId:e,data:T})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:o}){let{publicKey:s}=ie(i,o,h.TOKEN_PROGRAM_ID),{publicKey:r}=he(n,o),a=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:Zt(e,r).publicKey,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:g.SystemProgram.programId,isSigner:!1,isWritable:!1}];return new g.TransactionInstruction({keys:a,programId:e,data:Buffer.from(Zn)})}static harvestLockPositionInstruction(e){let[t,n]=[new g.PublicKey(e.poolKeys.programId),new g.PublicKey(e.poolKeys.id)],i=A.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=A.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=U(t,n,i),{publicKey:r}=U(t,n,o),{publicKey:a}=ie(e.owner,e.ownerPosition.nftMint,h.TOKEN_PROGRAM_ID),{publicKey:u}=he(t,e.ownerPosition.nftMint),{publicKey:c}=We(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),p=[];for(let b=0;b<e.poolKeys.rewardInfos.length;b++)p.push({poolRewardVault:new g.PublicKey(e.poolKeys.rewardInfos[b].vault),ownerRewardVault:e.ownerRewardAccounts[b],rewardMint:new g.PublicKey(e.poolKeys.rewardInfos[b].mint.address)});let d=[...p.map(b=>[{pubkey:b.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:b.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:b.rewardMint,isSigner:!1,isWritable:!1}]).flat()],l=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Zt(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:new g.PublicKey(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new g.PublicKey(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:new g.PublicKey(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new g.PublicKey(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new g.TransactionInstruction({keys:l,programId:e.programId,data:Buffer.from(Jn)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:o,lockNftMint:s,lockNftAccount:r,positionNftAccount:a,positionId:u,poolId:c,protocolPosition:p,vaultA:d,vaultB:l,tickArrayLower:b,tickArrayUpper:y,userVaultA:k,userVaultB:f,mintA:P,mintB:T,rewardAccounts:S,exTickArrayBitmap:N}){let w=[...N?[{pubkey:N,isSigner:!1,isWritable:!0}]:[],...S.map(C=>[{pubkey:C.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.rewardMint,isSigner:!1,isWritable:!1}]).flat()],K=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:h.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:h.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},...w];return new g.TransactionInstruction({keys:K,programId:e,data:Buffer.from(Jn)})}};0&&(module.exports={ClmmInstrument});
//# sourceMappingURL=instrument.js.map