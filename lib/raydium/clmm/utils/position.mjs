var gt=Object.defineProperty,yt=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var Ue=Object.getOwnPropertySymbols;var ht=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable;var We=(r,e,t)=>e in r?gt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,D=(r,e)=>{for(var t in e||(e={}))ht.call(e,t)&&We(r,t,e[t]);if(Ue)for(var t of Ue(e))Tt.call(e,t)&&We(r,t,e[t]);return r},G=(r,e)=>yt(r,bt(e));import v from"bn.js";import Ge from"decimal.js";import{PublicKey as yn}from"@solana/web3.js";import{get as Xe,set as xt}from"lodash";var be=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},He={},wt={};function L(r){let e=Xe(He,r);if(!e){let t=Xe(wt,r);e=new be({name:r,logLevel:t}),xt(He,r,e)}return e}import{MINT_SIZE as xn,TOKEN_PROGRAM_ID as wn,getTransferFeeConfig as An,unpackMint as Pn}from"@solana/spl-token";var kn=L("Raydium_accountInfo_util");import V from"bn.js";import ai from"decimal.js";import Lt from"big.js";import Vn from"bn.js";import Pt from"toformat";var kt=Pt,ee=kt;import de from"big.js";import It from"bn.js";import St from"decimal.js-light";import te from"bn.js";var ze=9007199254740991;function q(r){let e=L("Raydium_parseBigNumberish");if(r instanceof te)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new te(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=ze||r<=-ze)&&e.logWithError(`BigNumberish number overflow: ${r}`),new te(String(r))):typeof r=="bigint"?new te(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new te(0))}var le=L("module/fraction"),Te=ee(de),ne=ee(St),Ct={[0]:ne.ROUND_DOWN,[1]:ne.ROUND_HALF_UP,[2]:ne.ROUND_UP},Nt={[0]:de.roundDown,[1]:de.roundHalfUp,[2]:de.roundUp},y=class{constructor(e,t=new It(1)){this.numerator=q(e),this.denominator=q(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new y(this.denominator,this.numerator)}add(e){let t=e instanceof y?e:new y(q(e));return this.denominator.eq(t.denominator)?new y(this.numerator.add(t.numerator),this.denominator):new y(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof y?e:new y(q(e));return this.denominator.eq(t.denominator)?new y(this.numerator.sub(t.numerator),this.denominator):new y(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof y?e:new y(q(e));return new y(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof y?e:new y(q(e));return new y(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||le.logWithError(`${e} is not an integer.`),e<=0&&le.logWithError(`${e} is not positive.`),ne.set({precision:e+1,rounding:Ct[n]});let i=new ne(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||le.logWithError(`${e} is not an integer.`),e<0&&le.logWithError(`${e} is negative.`),Te.DP=e,Te.RM=Nt[n]||1,new Te(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Jn=L("Raydium_amount"),Qn=ee(Lt);import{PublicKey as _t}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as je}from"@solana/spl-token";var Ye={chainId:101,address:_t.default.toBase58(),programId:je.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},H={chainId:101,address:"So11111111111111111111111111111111111111112",programId:je.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as we}from"@solana/web3.js";import{PublicKey as h,SystemProgram as Ze,SYSVAR_RENT_PUBKEY as Et}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ft}from"@solana/spl-token";function xe({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var sr=[xe({pubkey:Ft,isWritable:!1}),xe({pubkey:Ze.programId,isWritable:!1}),xe({pubkey:Et,isWritable:!1})];function Je({publicKey:r,transformSol:e}){let t=Qe(r.toString());if(t instanceof h)return e&&t.equals(re)?he:t;if(e&&t.toString()===re.toBase58())return he;if(typeof t=="string"){if(t===h.default.toBase58())return h.default;try{return new h(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Qe(r){try{return new h(r)}catch{return r}}var ar=new h("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ur=new h("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),cr=new h("SysvarRent111111111111111111111111111111111"),mr=new h("SysvarC1ock11111111111111111111111111111111"),Mt=new h("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),lr=new h("Sysvar1nstructions1111111111111111111111111"),dr=Ze.programId,pr=new h("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),fr=new h("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),gr=new h("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),yr=new h("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),br=new h("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),hr=new h("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Tr=new h("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),xr=new h("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),wr=new h("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ar=new h("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Pr=new h("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),he=new h("So11111111111111111111111111111111111111112"),re=h.default;var Ae=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:s=!1,isToken2022:o=!1}){if(e===re.toBase58()||e instanceof we&&re.equals(e)){this.decimals=H.decimals,this.symbol=H.symbol,this.name=H.name,this.mint=new we(H.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=s?we.default:Je({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},z=Ae;z.WSOL=new Ae(G(D({},H),{mint:H.address}));var Pe=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},pe=Pe;pe.SOL=new Pe(Ye);import Ot from"bn.js";var Mr=new y(new Ot(100));var qr=L("Raydium_price");var Dt=new V(0),yi=new V(1),bi=new V(2),hi=new V(3),Ti=new V(5),Rt=new V(10),xi=new V(100),wi=new V(1e3),Ai=new V(1e4);import{PublicKey as zi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yi}from"@solana/spl-token";import{ComputeBudgetProgram as Li,Keypair as Ei,PublicKey as Fi,Transaction as Oi,TransactionMessage as Ki,VersionedTransaction as vi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ui}from"@solana/spl-token";var Wi=L("Raydium_txUtil");import{PublicKey as u}from"@solana/web3.js";var $i=new u("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),eo=new u("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),to=new u("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),no=new u("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ro=new u("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),io=new u("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),oo=new u("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),so=new u("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ao=new u("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),uo=new u("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),co=new u("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),mo=new u("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),lo=new u("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),po=new u("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),fo=new u("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),go=new u("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),yo=new u("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),bo=new u("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ho=new u("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),To=new u("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),xo=new u("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),wo=new u("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ao=new u("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Po=new u("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ko=new u("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Bo=new u("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Io=new u("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),So=new u("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Co=new u("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),No=new u("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Lo=new u("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Ro={OPEN_BOOK_PROGRAM:new u("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new u("Ray1111111111111111111111111111111111111111"),AMM_V4:new u("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new u("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new u("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new u("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new u("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new u("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new u("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new u("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new u("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new u("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:u.default,Router:new u("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new u("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new u("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new u("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new u("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new u("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new u("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new u("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new u("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new u("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new u("Ray1111111111111111111111111111111111111111")};import M from"bn.js";var ie=1e4;function O(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=G(D({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),s=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,o=new M(s.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(s.transferFeeBasisPoints===ie){let c=new M(s.maximumFee.toString());return{amount:r.add(c),fee:c,expirationTime:a}}else{let c=Se(r.mul(new M(ie)),new M(ie-s.transferFeeBasisPoints)),b=new M(s.maximumFee.toString()),w=c.sub(r).gt(b)?r.add(b):c,A=Se(w.mul(new M(s.transferFeeBasisPoints)),new M(ie)),k=A.gt(o)?o:A;return{amount:w,fee:k,expirationTime:a}}else{let c=Se(r.mul(new M(s.transferFeeBasisPoints)),new M(ie)),b=c.gt(o)?o:c;return{amount:r,fee:b,expirationTime:a}}}function oe(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function Se(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new M(0))?t.add(new M(1)):t}import{PublicKey as Do,AddressLookupTableAccount as Ko}from"@solana/web3.js";import{PublicKey as ns,sendAndConfirmTransaction as rs,SystemProgram as ss,Transaction as as,TransactionMessage as cs,VersionedTransaction as ms}from"@solana/web3.js";import ds from"axios";import{PublicKey as xs}from"@solana/web3.js";import As from"bn.js";import Gt from"bn.js";var Ss=new Gt(1e6);import R from"bn.js";var _=new R(0),W=new R(1),et=new R(-1),E=new R(1).shln(64),fe=new R(1).shln(128),Ce=E.sub(W),se=64,tt=fe.subn(1),j=-443636,Y=-j,Ne=new R("4295048016"),Le=new R("79226673521066979257578248091"),Ys=new R("4295048017"),Zs=new R("79226673521066979257578248090"),nt=16,rt="59543866431248",it="184467440737095516",ot="15793534762490258745",qt=new R(10).pow(new R(6));var Js=new R("18446744073700000000");import f from"bn.js";import K from"decimal.js";var ia=Buffer.from("amm_config","utf8"),oa=Buffer.from("pool","utf8"),sa=Buffer.from("pool_vault","utf8"),aa=Buffer.from("pool_reward_vault","utf8"),ua=Buffer.from("position","utf8"),ca=Buffer.from("tick_array","utf8"),ma=Buffer.from("operation","utf8"),la=Buffer.from("pool_tick_array_bitmap_extension","utf8"),da=Buffer.from("observation","utf8");var pa=Buffer.from("locked_position","utf8");var fa=Buffer.from("support_mint","utf8");import{PublicKey as oc}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as ac}from"@solana/spl-token";import cc from"bn.js";import lc from"decimal.js";import{PublicKey as Zt}from"@solana/web3.js";import ct,{isBN as mt}from"bn.js";import{bits as ba,BitStructure as ha,blob as Vt,Blob as Ta,cstr as xa,f32 as wa,f32be as Aa,f64 as Pa,f64be as ka,greedy as Ba,Layout as Ut,ns64 as Ia,ns64be as Sa,nu64 as Ca,nu64be as Na,offset as La,s16 as Ra,s16be as _a,s24 as Ea,s24be as Fa,s32 as Wt,s32be as Ma,s40 as Oa,s40be as Da,s48 as Ka,s48be as va,s8 as Ga,seq as Xt,struct as qa,Structure as Ht,u16 as zt,u16be as Va,u24 as Ua,u24be as Wa,u32 as Xa,u32be as Ha,u40 as za,u40be as ja,u48 as Ya,u48be as Za,u8 as jt,UInt as Yt,union as Ja,Union as Qa,unionLayoutDiscriminator as $a,utf8 as eu}from"@solana/buffer-layout";var Re=Ut,st=Ht;var _e=Yt;var at=jt,ae=zt;var X=Wt;var ut=Xt;var N=Vt;var Z=class extends Re{constructor(t,n,i){super(t,i);this.blob=N(t),this.signed=n}decode(t,n=0){let i=new ct(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new ct(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function C(r){return new _e(1,r)}function J(r){return new _e(4,r)}function p(r){return new Z(8,!1,r)}function x(r){return new Z(16,!1,r)}function lt(r){return new Z(8,!0,r)}function dt(r){return new Z(16,!0,r)}var ge=class extends Re{constructor(t,n,i,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function g(r){return new ge(N(32),e=>new Zt(e),e=>e.toBuffer(),r)}function pt(r){return new ge(at(),Jt,Qt,r)}function Jt(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Qt(r){return r?1:0}var Ee=class extends st{decode(e,t){return super.decode(e,t)}};function I(r,e,t){return new Ee(r,e,t)}function T(r,e,t){let n,i=typeof e=="number"?e:mt(e)?e.toNumber():new Proxy(e,{get(s,o){if(!n){let a=Reflect.get(s,"count");n=mt(a)?a.toNumber():a,Reflect.set(s,"count",n)}return Reflect.get(s,o)},set(s,o,a){return o==="count"&&(n=a),Reflect.set(s,o,a)}});return ut(r,i,t)}import Au from"bn.js";import ku from"decimal.js";var ye=60;var De=14;var Wu=I([N(8),C("bump"),ae("index"),g(""),J("protocolFeeRate"),J("tradeFeeRate"),ae("tickSpacing"),T(p(),8,"")]),en=I([J("blockTimestamp"),lt("tickCumulative"),T(p(),4)]),Xu=I([N(8),pt("initialized"),p("recentEpoch"),ae("observationIndex"),g("poolId"),T(en,100,"observations"),T(p(),4)]),tn=I([C("rewardState"),p("openTime"),p("endTime"),p("lastUpdateTime"),x("emissionsPerSecondX64"),p("rewardTotalEmissioned"),p("rewardClaimed"),g("tokenMint"),g("tokenVault"),g("creator"),x("rewardGrowthGlobalX64")]),nn=I([N(8),C("bump"),g("ammConfig"),g("creator"),g("mintA"),g("mintB"),g("vaultA"),g("vaultB"),g("observationId"),C("mintDecimalsA"),C("mintDecimalsB"),ae("tickSpacing"),x("liquidity"),x("sqrtPriceX64"),X("tickCurrent"),J(),x("feeGrowthGlobalX64A"),x("feeGrowthGlobalX64B"),p("protocolFeesTokenA"),p("protocolFeesTokenB"),x("swapInAmountTokenA"),x("swapOutAmountTokenB"),x("swapInAmountTokenB"),x("swapOutAmountTokenA"),C("status"),T(C(),7,""),T(tn,3,"rewardInfos"),T(p(),16,"tickArrayBitmap"),p("totalFeesTokenA"),p("totalFeesClaimedTokenA"),p("totalFeesTokenB"),p("totalFeesClaimedTokenB"),p("fundFeesTokenA"),p("fundFeesTokenB"),p("startTime"),T(p(),15*4-3,"padding")]),rn=I([x("growthInsideLastX64"),p("rewardAmountOwed")]),on=I([N(8),C("bump"),g("nftMint"),g("poolId"),X("tickLower"),X("tickUpper"),x("liquidity"),x("feeGrowthInsideLastX64A"),x("feeGrowthInsideLastX64B"),p("tokenFeesOwedA"),p("tokenFeesOwedB"),T(rn,3,"rewardInfos"),T(p(),8,"")]),Hu=I([N(8),C("bump"),g("poolId"),X("tickLowerIndex"),X("tickUpperIndex"),x("liquidity"),x("feeGrowthInsideLastX64A"),x("feeGrowthInsideLastX64B"),p("tokenFeesOwedA"),p("tokenFeesOwedB"),T(x(),3,"rewardGrowthInside"),T(p(),8,"")]),sn=I([X("tick"),dt("liquidityNet"),x("liquidityGross"),x("feeGrowthOutsideX64A"),x("feeGrowthOutsideX64B"),T(x(),3,"rewardGrowthsOutsideX64"),T(J(),13,"")]),ft=I([N(8),g("poolId"),X("startTickIndex"),T(sn,ye,"ticks"),C("initializedTickCount"),T(C(),115,"")]),zu=I([N(329),T(g(),100,"whitelistMints")]),an=I([N(8),g("poolId"),T(T(p(),8),De,"positiveTickArrayBitmap"),T(T(p(),8),De,"negativeTickArrayBitmap")]),ju=I([p(),C("bump"),g("owner"),g("poolId"),g("positionId"),g("nftAccount"),T(p(),8)]),Yu=I([N(8),C("bump"),g("lockOwner"),g("poolId"),g("positionId"),g("nftAccount"),g("lockNftMint"),p("recentEpoch"),T(p(),8)]);var d=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),s=i.div(n);return i.mod(n).eq(_)||(s=s.add(W)),s}static mulDivFloor(e,t,n){if(n.eq(_))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(_))throw new Error("division by 0");return e.mul(t).add(n.sub(W)).div(n)}static x64ToDecimal(e,t){return new K(e.toString()).div(K.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new f(e.mul(K.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(fe).sub(t).mod(fe)}};function P(r,e){return ve(r.mul(e),64,256)}function un(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function ve(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var S=class{static sqrtPriceX64ToPrice(e,t,n){return d.x64ToDecimal(e).pow(2).mul(K.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return d.decimalToX64(e.mul(K.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(_))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(_))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(_))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(_))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(_))return e;let s=t.shln(se);if(i){let o=s,a=s.add(n.mul(e));return a.gte(o)?d.mulDivCeil(o,e,a):d.mulDivRoundingUp(o,W,o.div(e).add(n))}else{let o=n.mul(e);if(!s.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=s.sub(o);return d.mulDivCeil(s,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let s=n.shln(se);if(i)return e.add(s.div(t));{let o=d.mulDivRoundingUp(s,W,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<j||e>Y)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new f("18445821805675395072"):new f("18446744073709551616");return(t&2)!=0&&(n=P(n,new f("18444899583751176192"))),(t&4)!=0&&(n=P(n,new f("18443055278223355904"))),(t&8)!=0&&(n=P(n,new f("18439367220385607680"))),(t&16)!=0&&(n=P(n,new f("18431993317065453568"))),(t&32)!=0&&(n=P(n,new f("18417254355718170624"))),(t&64)!=0&&(n=P(n,new f("18387811781193609216"))),(t&128)!=0&&(n=P(n,new f("18329067761203558400"))),(t&256)!=0&&(n=P(n,new f("18212142134806163456"))),(t&512)!=0&&(n=P(n,new f("17980523815641700352"))),(t&1024)!=0&&(n=P(n,new f("17526086738831433728"))),(t&2048)!=0&&(n=P(n,new f("16651378430235570176"))),(t&4096)!=0&&(n=P(n,new f("15030750278694412288"))),(t&8192)!=0&&(n=P(n,new f("12247334978884435968"))),(t&16384)!=0&&(n=P(n,new f("8131365268886854656"))),(t&32768)!=0&&(n=P(n,new f("3584323654725218816"))),(t&65536)!=0&&(n=P(n,new f("696457651848324352"))),(t&131072)!=0&&(n=P(n,new f("26294789957507116"))),(t&262144)!=0&&(n=P(n,new f("37481735321082"))),e>0&&(n=tt.div(n)),n}static getTickFromPrice(e,t,n){return S.getTickFromSqrtPriceX64(S.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Le)||e.lt(Ne))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new f(t-64),i=un(n,32,128),s=new f("8000000000000000","hex"),o=0,a=new f(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;s.gt(new f(0))&&o<nt;){c=c.mul(c);let U=c.shrn(127);c=c.shrn(63+U.toNumber()),a=a.add(s.mul(U)),s=s.shrn(1),o+=1}let b=a.shrn(32),A=i.add(b).mul(new f(rt)),k=ve(A.sub(new f(it)),64,128).toNumber(),F=ve(A.add(new f(ot)),64,128).toNumber();return k==F?k:S.getSqrtPriceX64FromTick(F).lte(e)?F:k}};var B=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(_))throw new Error("sqrtPriceX64A must greater than 0");let s=n.ushln(se),o=t.sub(e);return i?d.mulDivRoundingUp(d.mulDivCeil(s,o,t),W,e):d.mulDivFloor(s,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(_))throw new Error("sqrtPriceX64A must greater than 0");return i?d.mulDivCeil(n,t.sub(e),E):d.mulDivFloor(n,t.sub(e),E)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let s=n.mul(e).mul(t),o=t.sub(e),a=s.div(o);return i?d.mulDivRoundingUp(a,W,Ce):a.shrn(se)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),d.mulDivFloor(n,Ce,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return B.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let o=B.getLiquidityFromTokenAmountA(e,n,i,!1),a=B.getLiquidityFromTokenAmountB(t,e,s);return o.lt(a)?o:a}else return B.getLiquidityFromTokenAmountB(t,n,s)}static getAmountsFromLiquidity(e,t,n,i,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:B.getTokenAmountAFromLiquidity(t,n,i,s),amountB:new f(0)};if(e.lt(n)){let o=B.getTokenAmountAFromLiquidity(e,n,i,s),a=B.getTokenAmountBFromLiquidity(t,e,i,s);return{amountA:o,amountB:a}}else return{amountA:new f(0),amountB:B.getTokenAmountBFromLiquidity(t,n,i,s)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,s,o,a){let{amountA:c,amountB:b}=B.getAmountsFromLiquidity(e,t,n,i,o),w=s?1+a:1-a,A=new f(new K(c.toString()).mul(w).toFixed(0)),k=new f(new K(b.toString()).mul(w).toFixed(0));return{amountSlippageA:A,amountSlippageB:k}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:s,add:o,epochInfo:a,amountAddFee:c}){var Q,$,qe,Ve;let b=S.priceToSqrtPriceX64(new K(e.price),e.mintA.decimals,e.mintB.decimals),w=S.getSqrtPriceX64FromTick(t),A=S.getSqrtPriceX64FromTick(n),k=o?1+s:1-s,F=B.getAmountsFromLiquidity(b,w,A,i,o),[U,ue]=[O(F.amountA,(Q=e.mintA.extensions)==null?void 0:Q.feeConfig,a,c),O(F.amountB,($=e.mintB.extensions)==null?void 0:$.feeConfig,a,c)],[ce,me]=[O(new f(new K(F.amountA.toString()).mul(k).toFixed(0)),(qe=e.mintA.extensions)==null?void 0:qe.feeConfig,a,c),O(new f(new K(F.amountB.toString()).mul(k).toFixed(0)),(Ve=e.mintB.extensions)==null?void 0:Ve.feeConfig,a,c)];return{liquidity:i,amountA:U,amountB:ue,amountSlippageA:ce,amountSlippageB:me,expirationTime:oe(U.expirationTime,ue.expirationTime)}}};var Ke=class{static getfeeGrowthInside(e,t,n){let i=new v(0),s=new v(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,s=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new v(0),a=new v(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=d.wrappingSubU128(d.wrappingSubU128(e.feeGrowthGlobalX64A,i),o),b=d.wrappingSubU128(d.wrappingSubU128(e.feeGrowthGlobalX64B,s),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:b}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),a=d.mulDivFloor(d.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,E),c=t.tokenFeesOwedA.add(a),b=d.mulDivFloor(d.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,E),w=t.tokenFeesOwedB.add(b);return{tokenFeeAmountA:c,tokenFeeAmountB:w}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),a=d.mulDivFloor(d.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,E),c=t.tokenFeesOwedA.add(a),b=d.mulDivFloor(d.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,E),w=t.tokenFeesOwedB.add(b);return{tokenFeeAmountA:c,tokenFeeAmountB:w}}static GetPositionRewardsV2(e,t,n,i){let s=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<o.length;a++){let c=o[a],b=t.rewardInfos[a],w=d.wrappingSubU128(c,b.growthInsideLastX64),A=d.mulDivFloor(w,t.liquidity,E),k=b.rewardAmountOwed.add(A);s.push(k)}return s}static GetPositionRewards(e,t,n,i){let s=[],o=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<o.length;a++){let c=o[a],b=t.rewardInfos[a],w=d.wrappingSubU128(c,b.growthInsideLastX64),A=d.mulDivFloor(w,t.liquidity,E),k=b.rewardAmountOwed.add(A);s.push(k)}return s}static getRewardGrowthInside(e,t,n,i){let s=[];for(let o=0;o<i.length;o++){let a=new v(0);t.liquidityGross.eqn(0)?a=i[o].rewardGrowthGlobalX64:e<t.tick?a=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):a=t.rewardGrowthsOutsideX64[o];let c=new v(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[o]:c=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(d.wrappingSubU128(d.wrappingSubU128(i[o].rewardGrowthGlobalX64,a),c))}return s}static getRewardGrowthInsideV2(e,t,n,i){let s=[];for(let o=0;o<i.length;o++){let a=new v(0);t.liquidityGross.eqn(0)?a=i[o].rewardGrowthGlobalX64:e<t.tick?a=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):a=t.rewardGrowthsOutsideX64[o];let c=new v(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[o]:c=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(d.wrappingSubU128(d.wrappingSubU128(i[o].rewardGrowthGlobalX64,a),c))}return s}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:s,epochInfo:o}){var ce,me,Q,$;let a=S.priceToSqrtPriceX64(new Ge(e.price),e.mintA.decimals,e.mintB.decimals),c=S.getSqrtPriceX64FromTick(t.tickLower),b=S.getSqrtPriceX64FromTick(t.tickUpper),w=s?1+i:1-i,A=B.getAmountsFromLiquidity(a,c,b,n,s),[k,F]=[O(A.amountA,(ce=e.mintA.extensions)==null?void 0:ce.feeConfig,o,!0),O(A.amountB,(me=e.mintB.extensions)==null?void 0:me.feeConfig,o,!0)],[U,ue]=[O(new v(new Ge(A.amountA.toString()).mul(w).toFixed(0)),(Q=e.mintA.extensions)==null?void 0:Q.feeConfig,o,!0),O(new v(new Ge(A.amountB.toString()).mul(w).toFixed(0)),($=e.mintB.extensions)==null?void 0:$.feeConfig,o,!0)];return{liquidity:n,amountA:k,amountB:F,amountSlippageA:U,amountSlippageB:ue,expirationTime:oe(k.expirationTime,F.expirationTime)}}};export{Ke as PositionUtils};
//# sourceMappingURL=position.mjs.map