var Bn=Object.create;var ve=Object.defineProperty,In=Object.defineProperties,Sn=Object.getOwnPropertyDescriptor,Cn=Object.getOwnPropertyDescriptors,Nn=Object.getOwnPropertyNames,vt=Object.getOwnPropertySymbols,Ln=Object.getPrototypeOf,qt=Object.prototype.hasOwnProperty,Rn=Object.prototype.propertyIsEnumerable;var Gt=(u,e,t)=>e in u?ve(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,M=(u,e)=>{for(var t in e||(e={}))qt.call(e,t)&&Gt(u,t,e[t]);if(vt)for(var t of vt(e))Rn.call(e,t)&&Gt(u,t,e[t]);return u},O=(u,e)=>In(u,Cn(e));var En=(u,e)=>{for(var t in e)ve(u,t,{get:e[t],enumerable:!0})},Vt=(u,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Nn(e))!qt.call(u,r)&&r!==t&&ve(u,r,{get:()=>e[r],enumerable:!(n=Sn(e,r))||n.enumerable});return u};var v=(u,e,t)=>(t=u!=null?Bn(Ln(u)):{},Vt(e||!u||!u.__esModule?ve(t,"default",{value:u,enumerable:!0}):t,u)),Fn=u=>Vt(ve({},"__esModule",{value:!0}),u);var dr={};En(dr,{PoolUtils:()=>le,clmmComputeInfoToApiInfo:()=>lr,getLiquidityFromAmounts:()=>mr});module.exports=Fn(dr);var re=require("@solana/web3.js"),Mt=require("@solana/spl-token"),D=v(require("bn.js")),C=v(require("decimal.js"));var Wt=require("@solana/web3.js");var Ge=require("lodash");var dt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ut={},_n={};function oe(u){let e=(0,Ge.get)(Ut,u);if(!e){let t=(0,Ge.get)(_n,u);e=new dt({name:u,logLevel:t}),(0,Ge.set)(Ut,u,e)}return e}var nt=require("@solana/spl-token"),pt=oe("Raydium_accountInfo_util");async function Ae(u,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:s=100}=M({batchRequest:!1},t),o=ft(e,s),i=new Array(o.length).fill([]);if(n){let a=o.map(d=>{let p=u._buildArgs([d.map(m=>m.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:p}}),c=ft(a,10);i=(await(await Promise.all(c.map(async d=>await u._rpcBatchRequest(d)))).flat()).map(d=>(d.error&&pt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.error.message}`),d.result.value.map(p=>{if(p){let{data:m,executable:y,lamports:g,owner:T,rentEpoch:f}=p;return m.length!==2&&m[1]!=="base64"&&pt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:y,lamports:g,owner:new Wt.PublicKey(T),rentEpoch:f}}return null})))}else try{i=await Promise.all(o.map(a=>u.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&pt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return i.flat()}async function gt(u,e,t){let n=await Ae(u,e.map(r=>r.pubkey),t);return e.map((r,s)=>O(M({},r),{accountInfo:n[s]}))}var ye=v(require("bn.js")),Hn=v(require("decimal.js"));var Qt=v(require("big.js")),We=v(require("bn.js"));var Xt=v(require("toformat")),Mn=Xt.default,qe=Mn;var Ve=v(require("big.js")),zt=v(require("bn.js")),jt=v(require("decimal.js-light"));var _e=v(require("bn.js"));var Ht=9007199254740991;function se(u){let e=oe("Raydium_parseBigNumberish");if(u instanceof _e.default)return u;if(typeof u=="string"){if(u.match(/^-?[0-9]+$/))return new _e.default(u);e.logWithError(`invalid BigNumberish string: ${u}`)}return typeof u=="number"?(u%1&&e.logWithError(`BigNumberish number underflow: ${u}`),(u>=Ht||u<=-Ht)&&e.logWithError(`BigNumberish number overflow: ${u}`),new _e.default(String(u))):typeof u=="bigint"?new _e.default(u.toString()):(e.error(`invalid BigNumberish value: ${u}`),new _e.default(0))}var it=oe("module/fraction"),bt=qe(Ve.default),Ue=qe(jt.default),On={[0]:Ue.ROUND_DOWN,[1]:Ue.ROUND_HALF_UP,[2]:Ue.ROUND_UP},Kn={[0]:Ve.default.roundDown,[1]:Ve.default.roundHalfUp,[2]:Ve.default.roundUp},E=class{constructor(e,t=new zt.default(1)){this.numerator=se(e),this.denominator=se(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new E(this.denominator,this.numerator)}add(e){let t=e instanceof E?e:new E(se(e));return this.denominator.eq(t.denominator)?new E(this.numerator.add(t.numerator),this.denominator):new E(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof E?e:new E(se(e));return this.denominator.eq(t.denominator)?new E(this.numerator.sub(t.numerator),this.denominator):new E(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof E?e:new E(se(e));return new E(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof E?e:new E(se(e));return new E(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||it.logWithError(`${e} is not an integer.`),e<=0&&it.logWithError(`${e} is not positive.`),Ue.set({precision:e+1,rounding:On[n]});let r=new Ue(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||it.logWithError(`${e} is not an integer.`),e<0&&it.logWithError(`${e} is negative.`),bt.DP=e,bt.RM=Kn[n]||1,new bt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var vn=oe("Raydium_amount"),Zt=qe(Qt.default);function Gn(u,e){let t="0",n="0";if(u.includes(".")){let r=u.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):vn.logWithError(`invalid number string, num: ${u}`)}else t=u;return[t,n.slice(0,e)||n]}var Y=class extends E{constructor(t,n,r=!0,s){let o=new We.default(0),i=ht.pow(new We.default(t.decimals));if(r)o=se(n);else{let a=new We.default(0),c=new We.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=Gn(n.toString(),t.decimals);a=se(l),c=se(d)}a=a.mul(i),o=a.add(c)}super(o,i);this.logger=oe(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Y(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Y(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Zt.DP=this.token.decimals,new Zt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var Yt=require("@solana/web3.js"),Tt=require("@solana/spl-token"),Jt={chainId:101,address:Yt.PublicKey.default.toBase58(),programId:Tt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ie={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Tt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ot=require("@solana/web3.js");var F=require("@solana/web3.js"),$t=require("@solana/spl-token");function xt({pubkey:u,isSigner:e=!1,isWritable:t=!0}){return{pubkey:u,isWritable:t,isSigner:e}}var Gr=[xt({pubkey:$t.TOKEN_PROGRAM_ID,isWritable:!1}),xt({pubkey:F.SystemProgram.programId,isWritable:!1}),xt({pubkey:F.SYSVAR_RENT_PUBKEY,isWritable:!1})];function wt({publicKey:u,transformSol:e}){let t=en(u.toString());if(t instanceof F.PublicKey)return e&&t.equals(Xe)?yt:t;if(e&&t.toString()===Xe.toBase58())return yt;if(typeof t=="string"){if(t===F.PublicKey.default.toBase58())return F.PublicKey.default;try{return new F.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function en(u){try{return new F.PublicKey(u)}catch{return u}}var qr=new F.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Vr=new F.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ur=new F.PublicKey("SysvarRent111111111111111111111111111111111"),Wr=new F.PublicKey("SysvarC1ock11111111111111111111111111111111"),qn=new F.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Xr=new F.PublicKey("Sysvar1nstructions1111111111111111111111111"),Hr=F.SystemProgram.programId,zr=new F.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),jr=new F.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Zr=new F.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Qr=new F.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Yr=new F.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Jr=new F.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),$r=new F.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ei=new F.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ti=new F.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ni=new F.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ri=new F.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),yt=new F.PublicKey("So11111111111111111111111111111111111111112"),Xe=F.PublicKey.default;function rt(u){return wt({publicKey:u,transformSol:!0})}var At=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:s=!1,isToken2022:o=!1}){if(e===Xe.toBase58()||e instanceof ot.PublicKey&&Xe.equals(e)){this.decimals=Ie.decimals,this.symbol=Ie.symbol,this.name=Ie.name,this.mint=new ot.PublicKey(Ie.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=s?ot.PublicKey.default:wt({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Te=At;Te.WSOL=new At(O(M({},Ie),{mint:Ie.address}));var Pt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},st=Pt;st.SOL=new Pt(Jt);var nn=v(require("bn.js"));var tn=new E(new nn.default(100)),Pe=class extends E{toSignificant(e=5,t,n){return this.mul(tn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(tn).toFixed(e,t,n)}};var Vn=oe("Raydium_price"),pe=class extends E{constructor(t){let{baseToken:n,quoteToken:r,numerator:s,denominator:o}=t;super(s,o);this.baseToken=n,this.quoteToken=r,this.scalar=new E(kt(n.decimals),kt(r.decimals))}get raw(){return new E(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new pe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Vn.logWithError("mul token not equals");let n=super.mul(t);return new pe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Wn=require("@solana/web3.js"),Xn=v(require("bn.js"));var Un=new ye.default(0),zi=new ye.default(1),ji=new ye.default(2),Zi=new ye.default(3),Qi=new ye.default(5),ht=new ye.default(10),Yi=new ye.default(100),Ji=new ye.default(1e3),$i=new ye.default(1e4);function kt(u){return ht.pow(se(u))}function ft(u,e=1,t=[]){let n=[...u];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Zn=require("@solana/web3.js"),Qn=require("@solana/spl-token");var Se=require("@solana/web3.js");var jn=require("@solana/spl-token"),po=oe("Raydium_txUtil");function He(u,e){let[t,n]=Se.PublicKey.findProgramAddressSync(u,e);return{publicKey:t,nonce:n}}var b=require("@solana/web3.js"),bo=new b.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ho=new b.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),To=new b.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),xo=new b.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),wo=new b.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ao=new b.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Po=new b.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ko=new b.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Bo=new b.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Io=new b.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),So=new b.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Co=new b.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),No=new b.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Lo=new b.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ro=new b.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Eo=new b.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Fo=new b.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),_o=new b.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Mo=new b.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Do=new b.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Oo=new b.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ko=new b.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),vo=new b.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Go=new b.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),qo=new b.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Vo=new b.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Uo=new b.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Wo=new b.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Xo=new b.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Ho=new b.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),zo=new b.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var jo={OPEN_BOOK_PROGRAM:new b.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new b.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new b.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new b.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new b.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new b.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new b.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new b.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new b.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new b.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new b.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new b.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:b.PublicKey.default,Router:new b.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new b.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new b.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new b.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new b.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new b.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new b.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new b.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new b.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new b.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new b.PublicKey("Ray1111111111111111111111111111111111111111")};var me=v(require("bn.js")),ze=1e4;function G(u,e,t,n){if(e===void 0)return{amount:u,fee:void 0,expirationTime:void 0};let r=O(M({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),s=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,o=new me.default(s.maximumFee.toString()),i=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(s.transferFeeBasisPoints===ze){let a=new me.default(s.maximumFee.toString());return{amount:u.add(a),fee:a,expirationTime:i}}else{let a=Bt(u.mul(new me.default(ze)),new me.default(ze-s.transferFeeBasisPoints)),c=new me.default(s.maximumFee.toString()),l=a.sub(u).gt(c)?u.add(c):a,d=Bt(l.mul(new me.default(s.transferFeeBasisPoints)),new me.default(ze)),p=d.gt(o)?o:d;return{amount:l,fee:p,expirationTime:i}}else{let a=Bt(u.mul(new me.default(s.transferFeeBasisPoints)),new me.default(ze)),c=a.gt(o)?o:a;return{amount:u,fee:c,expirationTime:i}}}function ke(u,e){return u===void 0?e:e===void 0?u:Math.min(u,e)}function Bt(u,e){let{div:t,mod:n}=u.divmod(e);return n.gt(new me.default(0))?t.add(new me.default(1)):t}var je=require("@solana/web3.js");var Yn={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new je.AddressLookupTableAccount({key:new je.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:je.AddressLookupTableAccount.deserialize(Buffer.from("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","base64"))})};var Me=require("@solana/web3.js"),Jn=v(require("axios"));var rn=v(require("bn.js")),xs=new rn.default(1e6);var un=require("@solana/web3.js"),De=v(require("bn.js"));var h=require("@solana/buffer-layout"),It=h.Layout,on=h.Structure;var St=h.UInt;var sn=h.u8,Ze=h.u16;var Be=h.s32;var an=h.seq;var ae=h.blob;var Oe=class extends It{constructor(t,n,r){super(t,r);this.blob=ae(t),this.signed=n}decode(t,n=0){let r=new De.default(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new De.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function ne(u){return new St(1,u)}function Ke(u){return new St(4,u)}function L(u){return new Oe(8,!1,u)}function W(u){return new Oe(16,!1,u)}function cn(u){return new Oe(8,!0,u)}function mn(u){return new Oe(16,!0,u)}var at=class extends It{constructor(t,n,r,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function _(u){return new at(ae(32),e=>new un.PublicKey(e),e=>e.toBuffer(),u)}function ln(u){return new at(sn(),$n,er,u)}function $n(u){if(u===0)return!1;if(u===1)return!0;throw new Error("Invalid bool: "+u)}function er(u){return u?1:0}var Ct=class extends on{decode(e,t){return super.decode(e,t)}};function $(u,e,t){return new Ct(u,e,t)}function q(u,e,t){let n,r=typeof e=="number"?e:(0,De.isBN)(e)?e.toNumber():new Proxy(e,{get(s,o){if(!n){let i=Reflect.get(s,"count");n=(0,De.isBN)(i)?i.toNumber():i,Reflect.set(s,"count",n)}return Reflect.get(s,o)},set(s,o,i){return o==="count"&&(n=i),Reflect.set(s,o,i)}});return an(u,r,t)}var wn=v(require("bn.js")),Ee=v(require("decimal.js"));var ue=v(require("bn.js")),V=new ue.default(0),be=new ue.default(1),xe=new ue.default(-1),ce=new ue.default(1).shln(64),ut=new ue.default(1).shln(128),Nt=ce.sub(be),Qe=64,dn=ut.subn(1),J=-443636,ee=-J,Ce=new ue.default("4295048016"),Ne=new ue.default("79226673521066979257578248091"),Ys=new ue.default("4295048017"),Js=new ue.default("79226673521066979257578248090"),pn=16,fn="59543866431248",gn="184467440737095516",yn="15793534762490258745",ct=new ue.default(10).pow(new ue.default(6));var $s=new ue.default("18446744073700000000");var P=v(require("bn.js")),fe=v(require("decimal.js"));function bn(u){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,u,!1),new Uint8Array(e)}function Lt(u,e){let t=0;for(let n=u-1;n>=0&&!e.testn(n);n--)t++;return t}function Rt(u,e){let t=0;for(let n=0;n<u&&!e.testn(n);n++)t++;return t}function Ye(u,e){for(let t=0;t<u;t++)if(e.testn(t))return!1;return!0}function hn(u,e){return Ye(u,e)?null:Lt(u,e)}function Tn(u,e){return Ye(u,e)?null:Rt(u,e)}var oa=Buffer.from("amm_config","utf8"),sa=Buffer.from("pool","utf8"),aa=Buffer.from("pool_vault","utf8"),ua=Buffer.from("pool_reward_vault","utf8"),tr=Buffer.from("position","utf8"),nr=Buffer.from("tick_array","utf8"),ca=Buffer.from("operation","utf8"),rr=Buffer.from("pool_tick_array_bitmap_extension","utf8"),ma=Buffer.from("observation","utf8");function te(u,e,t){return He([nr,e.toBuffer(),bn(t)],u)}function xn(u,e){return He([tr,e.toBuffer()],u)}function mt(u,e){return He([rr,e.toBuffer()],u)}var la=Buffer.from("locked_position","utf8");var da=Buffer.from("support_mint","utf8");var ir=15,R=class{static async getTickArrays(e,t,n,r,s,o,i){let a=[],c=A.getTickArrayStartIndexByTick(r,s),l=A.getInitializedTickArrayInRange(o,i,s,c,Math.floor(ir/2));for(let m=0;m<l.length;m++){let{publicKey:y}=te(t,n,l[m]);a.push(y)}let d=(await Ae(e,a)).map(m=>m!==null?Je.decode(m.data):null),p={};for(let m=0;m<a.length;m++){let y=d[m];y!==null&&(p[y.startTickIndex]=O(M({},y),{address:a[m]}))}return p}static nextInitializedTick(e,t,n,r,s,o){let{initializedTick:i,tickArrayAddress:a,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,s,o);for(;i==null||i.liquidityGross.lten(0);){if(c=A.getNextTickArrayStartIndex(c,s,o),this.checkIsValidStartIndex(c,s))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:d,tickArrayAddress:p,tickArrayStartTickIndex:m}=this.firstInitializedTickInOneArray(e,t,l,o);[i,a,c]=[d,p,m]}if(i==null)throw new Error("No invaild tickArray cache");return{nextTick:i,tickArrayAddress:a,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,s){let o=Math.floor(e/R.tickCount(t)),i=n?A.searchLowBitFromStart(r,s,o-1,1,t):A.searchHightBitFromStart(r,s,o+1,1,t);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let s;if(r){let i=z-1;for(;i>=0;){let a=n.ticks[i];if(a.liquidityGross.gtn(0)){s=a;break}i=i-1}}else{let i=0;for(;i<z;){let a=n.ticks[i];if(a.liquidityGross.gtn(0)){s=a;break}i=i+1}}let{publicKey:o}=te(e,t,n.startTickIndex);return{nextTick:s,tickArrayAddress:o,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,s,o){let i=A.getTickArrayStartIndexByTick(r,s),a=Math.floor((r-i)/s),c=n[i];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:i};let l;if(o)for(;a>=0;){let p=c.ticks[a];if(p.liquidityGross.gtn(0)){l=p;break}a=a-1}else for(a=a+1;a<z;){let p=c.ticks[a];if(p.liquidityGross.gtn(0)){l=p;break}a=a+1}let{publicKey:d}=te(e,t,i);return{initializedTick:l,tickArrayAddress:d,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(A.checkIsOutOfBoundary(e)){if(e>ee)return!1;let n=A.getTickArrayStartIndexByTick(J,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return z*e}};var k=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),s=r.div(n);return r.mod(n).eq(V)||(s=s.add(be)),s}static mulDivFloor(e,t,n){if(n.eq(V))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(V))throw new Error("division by 0");return e.mul(t).add(n.sub(be)).div(n)}static x64ToDecimal(e,t){return new fe.default(e.toString()).div(fe.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new P.default(e.mul(fe.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(ut).sub(t).mod(ut)}};function j(u,e){return Et(u.mul(e),64,256)}function or(u,e,t){let n=u.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Et(u,e,t){let n=u.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var w=class{static sqrtPriceX64ToPrice(e,t,n){return k.x64ToDecimal(e).pow(2).mul(fe.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return k.decimalToX64(e.mul(fe.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(V))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(V))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(V))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(V))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(V))return e;let s=t.shln(Qe);if(r){let o=s,i=s.add(n.mul(e));return i.gte(o)?k.mulDivCeil(o,e,i):k.mulDivRoundingUp(o,be,o.div(e).add(n))}else{let o=n.mul(e);if(!s.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let i=s.sub(o);return k.mulDivCeil(s,e,i)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let s=n.shln(Qe);if(r)return e.add(s.div(t));{let o=k.mulDivRoundingUp(s,be,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<J||e>ee)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new P.default("18445821805675395072"):new P.default("18446744073709551616");return(t&2)!=0&&(n=j(n,new P.default("18444899583751176192"))),(t&4)!=0&&(n=j(n,new P.default("18443055278223355904"))),(t&8)!=0&&(n=j(n,new P.default("18439367220385607680"))),(t&16)!=0&&(n=j(n,new P.default("18431993317065453568"))),(t&32)!=0&&(n=j(n,new P.default("18417254355718170624"))),(t&64)!=0&&(n=j(n,new P.default("18387811781193609216"))),(t&128)!=0&&(n=j(n,new P.default("18329067761203558400"))),(t&256)!=0&&(n=j(n,new P.default("18212142134806163456"))),(t&512)!=0&&(n=j(n,new P.default("17980523815641700352"))),(t&1024)!=0&&(n=j(n,new P.default("17526086738831433728"))),(t&2048)!=0&&(n=j(n,new P.default("16651378430235570176"))),(t&4096)!=0&&(n=j(n,new P.default("15030750278694412288"))),(t&8192)!=0&&(n=j(n,new P.default("12247334978884435968"))),(t&16384)!=0&&(n=j(n,new P.default("8131365268886854656"))),(t&32768)!=0&&(n=j(n,new P.default("3584323654725218816"))),(t&65536)!=0&&(n=j(n,new P.default("696457651848324352"))),(t&131072)!=0&&(n=j(n,new P.default("26294789957507116"))),(t&262144)!=0&&(n=j(n,new P.default("37481735321082"))),e>0&&(n=dn.div(n)),n}static getTickFromPrice(e,t,n){return w.getTickFromSqrtPriceX64(w.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ne)||e.lt(Ce))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new P.default(t-64),r=or(n,32,128),s=new P.default("8000000000000000","hex"),o=0,i=new P.default(0),a=t>=64?e.shrn(t-63):e.shln(63-t);for(;s.gt(new P.default(0))&&o<pn;){a=a.mul(a);let y=a.shrn(127);a=a.shrn(63+y.toNumber()),i=i.add(s.mul(y)),s=s.shrn(1),o+=1}let c=i.shrn(32),d=r.add(c).mul(new P.default(fn)),p=Et(d.sub(new P.default(gn)),64,128).toNumber(),m=Et(d.add(new P.default(yn)),64,128).toNumber();return p==m?p:w.getSqrtPriceX64FromTick(m).lte(e)?m:p}},Le=class{static getTickWithPriceAndTickspacing(e,t,n,r){let o=w.getTickFromSqrtPriceX64(w.priceToSqrtPriceX64(e,n,r))/t;return o<0?o=Math.floor(o):o=Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,r){let s=Le.getTickWithPriceAndTickspacing(e,t,n,r),o=w.getSqrtPriceX64FromTick(s);return w.sqrtPriceX64ToPrice(o,n,r)}},N=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(V))throw new Error("sqrtPriceX64A must greater than 0");let s=n.ushln(Qe),o=t.sub(e);return r?k.mulDivRoundingUp(k.mulDivCeil(s,o,t),be,e):k.mulDivFloor(s,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(V))throw new Error("sqrtPriceX64A must greater than 0");return r?k.mulDivCeil(n,t.sub(e),ce):k.mulDivFloor(n,t.sub(e),ce)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let s=n.mul(e).mul(t),o=t.sub(e),i=s.div(o);return r?k.mulDivRoundingUp(i,be,Nt):i.shrn(Qe)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),k.mulDivFloor(n,Nt,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return N.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let o=N.getLiquidityFromTokenAmountA(e,n,r,!1),i=N.getLiquidityFromTokenAmountB(t,e,s);return o.lt(i)?o:i}else return N.getLiquidityFromTokenAmountB(t,n,s)}static getAmountsFromLiquidity(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:N.getTokenAmountAFromLiquidity(t,n,r,s),amountB:new P.default(0)};if(e.lt(n)){let o=N.getTokenAmountAFromLiquidity(e,n,r,s),i=N.getTokenAmountBFromLiquidity(t,e,r,s);return{amountA:o,amountB:i}}else return{amountA:new P.default(0),amountB:N.getTokenAmountBFromLiquidity(t,n,r,s)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,s,o,i){let{amountA:a,amountB:c}=N.getAmountsFromLiquidity(e,t,n,r,o),l=s?1+i:1-i,d=new P.default(new fe.default(a.toString()).mul(l).toFixed(0)),p=new P.default(new fe.default(c.toString()).mul(l).toFixed(0));return{amountSlippageA:d,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:s,add:o,epochInfo:i,amountAddFee:a}){var I,S,U,X;let c=w.priceToSqrtPriceX64(new fe.default(e.price),e.mintA.decimals,e.mintB.decimals),l=w.getSqrtPriceX64FromTick(t),d=w.getSqrtPriceX64FromTick(n),p=o?1+s:1-s,m=N.getAmountsFromLiquidity(c,l,d,r,o),[y,g]=[G(m.amountA,(I=e.mintA.extensions)==null?void 0:I.feeConfig,i,a),G(m.amountB,(S=e.mintB.extensions)==null?void 0:S.feeConfig,i,a)],[T,f]=[G(new P.default(new fe.default(m.amountA.toString()).mul(p).toFixed(0)),(U=e.mintA.extensions)==null?void 0:U.feeConfig,i,a),G(new P.default(new fe.default(m.amountB.toString()).mul(p).toFixed(0)),(X=e.mintB.extensions)==null?void 0:X.feeConfig,i,a)];return{liquidity:r,amountA:y,amountB:g,amountSlippageA:T,amountSlippageB:f,expirationTime:ke(y.expirationTime,g.expirationTime)}}},Re=class{static swapCompute(e,t,n,r,s,o,i,a,c,l,d,p,m,y,g=!1){if(p.eq(V))throw new Error("amountSpecified must not be 0");if(y||(y=o?Ce.add(be):Ne.sub(be)),o){if(y.lt(Ce))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(d))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(Ne))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(d))throw new Error("sqrtPriceX64 must greater than current")}let T=p.gt(V),f={amountSpecifiedRemaining:p,amountCalculated:V,sqrtPriceX64:d,tick:c>m?Math.min(m+R.tickCount(l)-1,c):m,accounts:[],liquidity:a,feeAmount:new P.default(0)},I=m,S=n[m],U=0,X=!o&&S.startTickIndex===f.tick;for(;!f.amountSpecifiedRemaining.eq(V)&&!f.sqrtPriceX64.eq(y);){U>10;let x={};x.sqrtPriceStartX64=f.sqrtPriceX64;let Z=A.nextInitTick(S,f.tick,l,o,X),K=Z||null,ie=null;if(!(K!=null&&K.liquidityGross.gtn(0))){let H=le.nextInitializedTickArrayStartIndex({tickCurrent:f.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:s},I,o);if(!H.isExist){if(g)return{allTrade:!1,amountSpecifiedRemaining:f.amountSpecifiedRemaining,amountCalculated:f.amountCalculated,feeAmount:f.feeAmount,sqrtPriceX64:f.sqrtPriceX64,liquidity:f.liquidity,tickCurrent:f.tick,accounts:f.accounts};throw Error("swapCompute LiquidityInsufficient")}I=H.nextStartIndex;let{publicKey:he}=te(e,t,I);ie=he,S=n[I];try{K=A.firstInitializedTick(S,o)}catch{throw Error("not found next tick info")}}x.tickNext=K.tick,x.initialized=K.liquidityGross.gtn(0),m!==I&&ie&&(f.accounts.push(ie),m=I),x.tickNext<J?x.tickNext=J:x.tickNext>ee&&(x.tickNext=ee),x.sqrtPriceNextX64=w.getSqrtPriceX64FromTick(x.tickNext);let Q;if(o&&x.sqrtPriceNextX64.lt(y)||!o&&x.sqrtPriceNextX64.gt(y)?Q=y:Q=x.sqrtPriceNextX64,[f.sqrtPriceX64,x.amountIn,x.amountOut,x.feeAmount]=Re.swapStepCompute(f.sqrtPriceX64,Q,f.liquidity,f.amountSpecifiedRemaining,i,o),f.feeAmount=f.feeAmount.add(x.feeAmount),T?(f.amountSpecifiedRemaining=f.amountSpecifiedRemaining.sub(x.amountIn.add(x.feeAmount)),f.amountCalculated=f.amountCalculated.sub(x.amountOut)):(f.amountSpecifiedRemaining=f.amountSpecifiedRemaining.add(x.amountOut),f.amountCalculated=f.amountCalculated.add(x.amountIn.add(x.feeAmount))),f.sqrtPriceX64.eq(x.sqrtPriceNextX64)){if(x.initialized){let H=K.liquidityNet;o&&(H=H.mul(xe)),f.liquidity=N.addDelta(f.liquidity,H)}X=x.tickNext!=f.tick&&!o&&S.startTickIndex===x.tickNext,f.tick=o?x.tickNext-1:x.tickNext}else if(f.sqrtPriceX64!=x.sqrtPriceStartX64){let H=w.getTickFromSqrtPriceX64(f.sqrtPriceX64);X=H!=f.tick&&!o&&S.startTickIndex===H,f.tick=H}++U}try{let{nextStartIndex:x,isExist:Z}=R.nextInitializedTickArray(f.tick,l,o,r,s);Z&&m!==x&&(f.accounts.push(te(e,t,x).publicKey),m=x)}catch{}return{allTrade:!0,amountSpecifiedRemaining:V,amountCalculated:f.amountCalculated,feeAmount:f.feeAmount,sqrtPriceX64:f.sqrtPriceX64,liquidity:f.liquidity,tickCurrent:f.tick,accounts:f.accounts}}static swapStepCompute(e,t,n,r,s,o){let i={sqrtPriceX64Next:new P.default(0),amountIn:new P.default(0),amountOut:new P.default(0),feeAmount:new P.default(0)},a=r.gte(V);if(a){let l=k.mulDivFloor(r,ct.sub(new P.default(s.toString())),ct);i.amountIn=o?N.getTokenAmountAFromLiquidity(t,e,n,!0):N.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(i.amountIn)?i.sqrtPriceX64Next=t:i.sqrtPriceX64Next=w.getNextSqrtPriceX64FromInput(e,n,l,o)}else i.amountOut=o?N.getTokenAmountBFromLiquidity(t,e,n,!1):N.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(xe).gte(i.amountOut)?i.sqrtPriceX64Next=t:i.sqrtPriceX64Next=w.getNextSqrtPriceX64FromOutput(e,n,r.mul(xe),o);let c=t.eq(i.sqrtPriceX64Next);return o?(c&&a||(i.amountIn=N.getTokenAmountAFromLiquidity(i.sqrtPriceX64Next,e,n,!0)),c&&!a||(i.amountOut=N.getTokenAmountBFromLiquidity(i.sqrtPriceX64Next,e,n,!1))):(i.amountIn=c&&a?i.amountIn:N.getTokenAmountBFromLiquidity(e,i.sqrtPriceX64Next,n,!0),i.amountOut=c&&!a?i.amountOut:N.getTokenAmountAFromLiquidity(e,i.sqrtPriceX64Next,n,!1)),!a&&i.amountOut.gt(r.mul(xe))&&(i.amountOut=r.mul(xe)),a&&!i.sqrtPriceX64Next.eq(t)?i.feeAmount=r.sub(i.amountIn):i.feeAmount=k.mulDivCeil(i.amountIn,new P.default(s),ct.sub(new P.default(s))),[i.sqrtPriceX64Next,i.amountIn,i.amountOut,i.feeAmount]}};var z=60,Fe=512,A=class{static getTickArrayAddressByTick(e,t,n,r){let s=A.getTickArrayStartIndexByTick(n,r),{publicKey:o}=te(e,t,s);return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=A.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=z)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=R.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*R.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*z,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*z,s=Math.floor(t/r)+512,o=Math.abs(s);return{isInitialized:e.testn(o),startIndex:(o-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*z:e+t*z}static mergeTickArrayBitmap(e){let t=new wn.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,s){let o=Math.floor(r/(n*z));return[...A.searchLowBitFromStart(e,t,o-1,s,n),...A.searchHightBitFromStart(e,t,o,s,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return A.searchHightBitFromStart(e,t,-7680,Fe,n)}static getAllInitializedTickArrayInfo(e,t,n,r,s){let o=[],i=A.getAllInitializedTickArrayStartIndex(n,r,s);for(let a of i){let{publicKey:c}=te(e,t,a);o.push({tickArrayStartIndex:a,tickArrayAddress:c})}return o}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,s){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>A.mergeTickArrayBitmap(c)),i=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(o[c].testn(l)&&i.push(n),n--,i.length===r)break}let a=R.tickCount(s);return i.map(c=>c*a)}static searchHightBitFromStart(e,t,n,r,s){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>A.mergeTickArrayBitmap(c)),i=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(o[c].testn(l)&&i.push(n),n++,i.length===r)break}let a=R.tickCount(s);return i.map(c=>c*a)}static checkIsOutOfBoundary(e){return e<J||e>ee}static nextInitTick(e,t,n,r,s){if(R.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let i=Math.floor((t-e.startTickIndex)/n);if(r)for(;i>=0;){if(e.ticks[i].liquidityGross.gtn(0))return e.ticks[i];i=i-1}else for(s||(i=i+1);i<z;){if(e.ticks[i].liquidityGross.gtn(0))return e.ticks[i];i=i+1}return null}static firstInitializedTick(e,t){if(t){let n=z-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<z;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=w.getSqrtPriceX64FromTick(t),s=w.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new Ee.default(1).div(s),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new Ee.default(1).div(t),s=Le.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=w.getSqrtPriceX64FromTick(s),i=w.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:i}:{tick:s,price:new Ee.default(1).div(i)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=w.getSqrtPriceX64FromTick(t),s=w.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new Ee.default(1).div(s),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new Ee.default(1).div(t),s=Le.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=w.getSqrtPriceX64FromTick(s),i=w.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:i}:{tick:s,price:new Ee.default(1).div(i)}}};var Ft=14,we=class{static maxTickInTickarrayBitmap(e){return e*z*Fe}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let s=n*r;return e<0?{minValue:-s,maxValue:-s+n}:{minValue:s,maxValue:s+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!R.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let s=this.maxTickInTickarrayBitmap(n),o=r?t-R.tickCount(n):t+R.tickCount(n);if(o<-s||o>=s)return{isInit:!1,tickIndex:t};let i=n*z,a=o/i+512;o<0&&o%i!=0&&a--;let c=Math.abs(a);if(r){let l=e.shln(1024-c-1),d=hn(1024,l);if(d!==null){let p=(c-d-512)*i;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-s}}else{let l=e.shrn(c),d=Tn(1024,l);if(d!==null){let p=(c+d-512)*i;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:s-R.tickCount(n)}}}},$e=class{static getBitmapOffset(e,t){if(!R.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=we.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=we.maxTickInTickarrayBitmap(e),n=-t;if(ee<=t)throw Error(`extensionTickBoundary check error: ${ee}, ${t}`);if(n<=J)throw Error(`extensionTickBoundary check error: ${n}, ${J}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),s=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:A.mergeTickArrayBitmap(r).testn(s),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let s=R.tickCount(t),o=n?e-s:e+s,{tickarrayBitmap:i}=this.getBitmap(o,t,r);return this.nextInitializedTickArrayInBitmap(i,o,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:s,maxValue:o}=we.getBitmapTickBoundary(t,n),i=this.tickArrayOffsetInBitmap(t,n);if(r){let a=A.mergeTickArrayBitmap(e).shln(Fe-1-i),c=Ye(512,a)?null:Lt(512,a);if(c!==null){let l=t-c*R.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s}}else{let a=A.mergeTickArrayBitmap(e).shrn(i),c=Ye(512,a)?null:Rt(512,a);if(c!==null){let l=t+c*R.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o-R.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%we.maxTickInTickarrayBitmap(t),r=Math.floor(n/R.tickCount(t));return e<0&&n!=0&&(r=Fe-r),r}};var Xa=$([ae(8),ne("bump"),Ze("index"),_(""),Ke("protocolFeeRate"),Ke("tradeFeeRate"),Ze("tickSpacing"),q(L(),8,"")]),sr=$([Ke("blockTimestamp"),cn("tickCumulative"),q(L(),4)]),Ha=$([ae(8),ln("initialized"),L("recentEpoch"),Ze("observationIndex"),_("poolId"),q(sr,100,"observations"),q(L(),4)]),ar=$([ne("rewardState"),L("openTime"),L("endTime"),L("lastUpdateTime"),W("emissionsPerSecondX64"),L("rewardTotalEmissioned"),L("rewardClaimed"),_("tokenMint"),_("tokenVault"),_("creator"),W("rewardGrowthGlobalX64")]),An=$([ae(8),ne("bump"),_("ammConfig"),_("creator"),_("mintA"),_("mintB"),_("vaultA"),_("vaultB"),_("observationId"),ne("mintDecimalsA"),ne("mintDecimalsB"),Ze("tickSpacing"),W("liquidity"),W("sqrtPriceX64"),Be("tickCurrent"),Ke(),W("feeGrowthGlobalX64A"),W("feeGrowthGlobalX64B"),L("protocolFeesTokenA"),L("protocolFeesTokenB"),W("swapInAmountTokenA"),W("swapOutAmountTokenB"),W("swapInAmountTokenB"),W("swapOutAmountTokenA"),ne("status"),q(ne(),7,""),q(ar,3,"rewardInfos"),q(L(),16,"tickArrayBitmap"),L("totalFeesTokenA"),L("totalFeesClaimedTokenA"),L("totalFeesTokenB"),L("totalFeesClaimedTokenB"),L("fundFeesTokenA"),L("fundFeesTokenB"),L("startTime"),q(L(),15*4-3,"padding")]),ur=$([W("growthInsideLastX64"),L("rewardAmountOwed")]),Pn=$([ae(8),ne("bump"),_("nftMint"),_("poolId"),Be("tickLower"),Be("tickUpper"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),L("tokenFeesOwedA"),L("tokenFeesOwedB"),q(ur,3,"rewardInfos"),q(L(),8,"")]),za=$([ae(8),ne("bump"),_("poolId"),Be("tickLowerIndex"),Be("tickUpperIndex"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),L("tokenFeesOwedA"),L("tokenFeesOwedB"),q(W(),3,"rewardGrowthInside"),q(L(),8,"")]),cr=$([Be("tick"),mn("liquidityNet"),W("liquidityGross"),W("feeGrowthOutsideX64A"),W("feeGrowthOutsideX64B"),q(W(),3,"rewardGrowthsOutsideX64"),q(Ke(),13,"")]),Je=$([ae(8),_("poolId"),Be("startTickIndex"),q(cr,z,"ticks"),ne("initializedTickCount"),q(ne(),115,"")]),ja=$([ae(329),q(_(),100,"whitelistMints")]),kn=$([ae(8),_("poolId"),q(q(L(),8),Ft,"positiveTickArrayBitmap"),q(q(L(),8),Ft,"negativeTickArrayBitmap")]),Za=$([L(),ne("bump"),_("owner"),_("poolId"),_("positionId"),_("nftAccount"),q(L(),8)]),Qa=$([ae(8),ne("bump"),_("lockOwner"),_("poolId"),_("positionId"),_("nftAccount"),_("lockNftMint"),L("recentEpoch"),q(L(),8)]);var ge=v(require("bn.js")),lt=v(require("decimal.js"));var et=class{static getfeeGrowthInside(e,t,n){let r=new ge.default(0),s=new ge.default(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,s=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new ge.default(0),i=new ge.default(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,i=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),i=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let a=k.wrappingSubU128(k.wrappingSubU128(e.feeGrowthGlobalX64A,r),o),c=k.wrappingSubU128(k.wrappingSubU128(e.feeGrowthGlobalX64B,s),i);return{feeGrowthInsideX64A:a,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,r),i=k.mulDivFloor(k.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,ce),a=t.tokenFeesOwedA.add(i),c=k.mulDivFloor(k.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:a,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,r),i=k.mulDivFloor(k.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,ce),a=t.tokenFeesOwedA.add(i),c=k.mulDivFloor(k.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:a,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let s=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let i=0;i<o.length;i++){let a=o[i],c=t.rewardInfos[i],l=k.wrappingSubU128(a,c.growthInsideLastX64),d=k.mulDivFloor(l,t.liquidity,ce),p=c.rewardAmountOwed.add(d);s.push(p)}return s}static GetPositionRewards(e,t,n,r){let s=[],o=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let i=0;i<o.length;i++){let a=o[i],c=t.rewardInfos[i],l=k.wrappingSubU128(a,c.growthInsideLastX64),d=k.mulDivFloor(l,t.liquidity,ce),p=c.rewardAmountOwed.add(d);s.push(p)}return s}static getRewardGrowthInside(e,t,n,r){let s=[];for(let o=0;o<r.length;o++){let i=new ge.default(0);t.liquidityGross.eqn(0)?i=r[o].rewardGrowthGlobalX64:e<t.tick?i=r[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):i=t.rewardGrowthsOutsideX64[o];let a=new ge.default(0);n.liquidityGross.eqn(0)||(e<n.tick?a=n.rewardGrowthsOutsideX64[o]:a=r[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(k.wrappingSubU128(k.wrappingSubU128(r[o].rewardGrowthGlobalX64,i),a))}return s}static getRewardGrowthInsideV2(e,t,n,r){let s=[];for(let o=0;o<r.length;o++){let i=new ge.default(0);t.liquidityGross.eqn(0)?i=r[o].rewardGrowthGlobalX64:e<t.tick?i=r[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):i=t.rewardGrowthsOutsideX64[o];let a=new ge.default(0);n.liquidityGross.eqn(0)||(e<n.tick?a=n.rewardGrowthsOutsideX64[o]:a=r[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(k.wrappingSubU128(k.wrappingSubU128(r[o].rewardGrowthGlobalX64,i),a))}return s}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:s,epochInfo:o}){var T,f,I,S;let i=w.priceToSqrtPriceX64(new lt.default(e.price),e.mintA.decimals,e.mintB.decimals),a=w.getSqrtPriceX64FromTick(t.tickLower),c=w.getSqrtPriceX64FromTick(t.tickUpper),l=s?1+r:1-r,d=N.getAmountsFromLiquidity(i,a,c,n,s),[p,m]=[G(d.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,o,!0),G(d.amountB,(f=e.mintB.extensions)==null?void 0:f.feeConfig,o,!0)],[y,g]=[G(new ge.default(new lt.default(d.amountA.toString()).mul(l).toFixed(0)),(I=e.mintA.extensions)==null?void 0:I.feeConfig,o,!0),G(new ge.default(new lt.default(d.amountB.toString()).mul(l).toFixed(0)),(S=e.mintB.extensions)==null?void 0:S.feeConfig,o,!0)];return{liquidity:n,amountA:p,amountB:m,amountSlippageA:y,amountSlippageB:g,expirationTime:ke(p.expirationTime,m.expirationTime)}}};var le=class{static getOutputAmountAndRemainAccounts(e,t,n,r,s,o=!1){let i=n.toBase58()===e.mintA.address,a=[],{isExist:c,startIndex:l,nextAccountMeta:d}=this.getFirstInitializedTickArray(e,i);if(!c||l===void 0||!d)throw new Error("Invalid tick array");a.push(d);let{allTrade:p,amountCalculated:m,accounts:y,sqrtPriceX64:g,feeAmount:T}=Re.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,i,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,s,o);return a.push(...y),{allTrade:p,expectedAmountOut:m.mul(xe),remainingAccounts:a,executionPrice:g,feeAmount:T}}static getInputAmountAndRemainAccounts(e,t,n,r,s){let o=n.toBase58()===e.mintB.address,i=[],{isExist:a,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,o);if(!a||c===void 0||!l)throw new Error("Invalid tick array");try{let g=this.preInitializedTickArrayStartIndex(e,o);if(g.isExist){let{publicKey:T}=te(e.programId,e.id,g.nextStartIndex);i.push(T)}}catch{}i.push(l);let{amountCalculated:d,accounts:p,sqrtPriceX64:m,feeAmount:y}=Re.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(xe),c,s);return i.push(...p),{expectedAmountIn:d,remainingAccounts:i,executionPrice:m,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=le.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?$e.checkTickArrayIsInit(R.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):A.checkTickArrayIsInitialized(A.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:i}=te(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:i}}let{isExist:s,nextStartIndex:o}=this.nextInitializedTickArrayStartIndex(e,R.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(s){let{publicKey:i}=te(e.programId,e.id,o);return{isExist:!0,startIndex:o,nextAccountMeta:i}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/R.tickCount(e.tickSpacing)),r=t?A.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):A.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=R.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:s}=we.nextInitializedTickArrayStartIndex(A.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:s};t=s;let{isInit:o,tickIndex:i}=$e.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(o)return{isExist:!0,nextStartIndex:i};if(t=i,t<J||t>ee)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:s}){var i,a,c;let o=[];for(let l=0;l<s.length;l++){let d=s[l],p=(c=(i=t.rewardDefaultInfos[l])==null?void 0:i.mint.programId)!=null?c:(a=await e.getAccountInfo(d.tokenMint))==null?void 0:a.owner;if(p===void 0)throw Error("get new reward mint info error");let m=O(M({},d),{perSecond:k.x64ToDecimal(d.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new re.PublicKey(p)});if(m.tokenMint.equals(re.PublicKey.default))continue;if(n<=m.openTime.toNumber()||r.eq(V)){o.push(m);continue}let y=new D.default(Math.min(m.endTime.toNumber(),n)),g=y.sub(m.lastUpdateTime),T=k.mulDivFloor(g,m.emissionsPerSecondX64,r),f=m.rewardGrowthGlobalX64.add(T),I=k.mulDivFloor(g,m.emissionsPerSecondX64,ce),S=m.rewardTotalEmissioned.add(I);o.push(O(M({},m),{rewardGrowthGlobalX64:f,rewardTotalEmissioned:S,lastUpdateTime:y}))}return o}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let s of t){let o=A.getTickArrayStartIndexByTick(s,e);if(o>=n||o<r)return!0}return!1}static tickRange(e){let t=we.maxTickInTickarrayBitmap(e),n=-t;return t>ee&&(t=R.getArrayStartIndex(ee,e)+R.tickCount(e)),n<J&&(n=R.getArrayStartIndex(J,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!R.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/R.tickCount(t)*Fe}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await gt(e,t.map(o=>({pubkey:o})),{batchRequest:n}),s={};for(let o of r)o.accountInfo!==null&&(s[o.pubkey.toString()]=kn.decode(o.accountInfo.data));return s}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},s=[];for(let a of t){let c=A.getTickArrayStartIndexByTick(a.tickCurrent,a.tickSpacing),l=A.getInitializedTickArrayInRange(a.tickArrayBitmap,a.exBitmapInfo,a.tickSpacing,c,7);for(let d of l){let{publicKey:p}=te(a.programId,a.id,d);s.push({pubkey:p}),r[p.toString()]=a.id}}let o=await gt(e,s,{batchRequest:n}),i={};for(let a of o){if(!a.accountInfo)continue;let c=r[a.pubkey.toString()];if(!c)continue;i[c.toString()]===void 0&&(i[c.toString()]={});let l=Je.decode(a.accountInfo.data);i[c.toString()][l.startTickIndex]=O(M({},l),{address:a.pubkey})}return i}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:s=!0}){var i;let o=[];for(let a=0;a<e.length;a++){let c=e[a];c!==null&&(o.find(l=>l.equals(c.state.programId))||o.push(c.state.programId))}if(n){let a=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of a)for(let m of o)c.push(xn(m,p).publicKey);let l=await Ae(t,c,{batchRequest:r}),d={};for(let p of l){if(p===null)continue;let m=Pn.decode(p.data),y=m.poolId.toString(),g=e.find(K=>K.state.id.toBase58()===y);if(g===void 0)continue;let T=g.state,f=A._getTickPriceLegacy({poolInfo:T,tick:m.tickLower,baseIn:!0}),I=A._getTickPriceLegacy({poolInfo:T,tick:m.tickUpper,baseIn:!0}),{amountA:S,amountB:U}=N.getAmountsFromLiquidity(T.sqrtPriceX64,f.tickSqrtPriceX64,I.tickSqrtPriceX64,m.liquidity,!1),X=1/(1-Math.sqrt(Math.sqrt(f.price.div(I.price).toNumber())));g.positionAccount=[...(i=g.positionAccount)!=null?i:[],{poolId:m.poolId,nftMint:m.nftMint,priceLower:f.price,priceUpper:I.price,amountA:S,amountB:U,tickLower:m.tickLower,tickUpper:m.tickUpper,liquidity:m.liquidity,feeGrowthInsideLastX64A:m.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:m.feeGrowthInsideLastX64B,tokenFeesOwedA:m.tokenFeesOwedA,tokenFeesOwedB:m.tokenFeesOwedB,rewardInfos:m.rewardInfos.map(K=>O(M({},K),{pendingReward:new D.default(0)})),leverage:X,tokenFeeAmountA:new D.default(0),tokenFeeAmountB:new D.default(0)}];let x=await A.getTickArrayAddressByTick(g.state.programId,m.poolId,m.tickLower,g.state.tickSpacing),Z=await A.getTickArrayAddressByTick(g.state.programId,m.poolId,m.tickUpper,g.state.tickSpacing);d[`${g.state.programId.toString()}-${m.poolId.toString()}-${m.tickLower}`]=x,d[`${g.state.programId.toString()}-${m.poolId.toString()}-${m.tickUpper}`]=Z}if(s){let p=Object.values(d),m=await Ae(t,p,{batchRequest:r}),y={};for(let g=0;g<p.length;g++){let T=m[g];if(T===null)continue;let f=p[g].toString();y[f]=Je.decode(T.data)}for(let{state:g,positionAccount:T}of e)if(!!T)for(let f of T){let I=`${g.programId.toString()}-${g.id.toString()}-${f.tickLower}`,S=`${g.programId.toString()}-${g.id.toString()}-${f.tickUpper}`,U=y[d[I].toString()],X=y[d[S].toString()],x=U.ticks[A.getTickOffsetInArray(f.tickLower,g.tickSpacing)],Z=X.ticks[A.getTickOffsetInArray(f.tickUpper,g.tickSpacing)],{tokenFeeAmountA:K,tokenFeeAmountB:ie}=await et.GetPositionFees(g,f,x,Z),Q=await et.GetPositionRewards(g,f,x,Z);f.tokenFeeAmountA=K.gte(new D.default(0))?K:new D.default(0),f.tokenFeeAmountB=ie.gte(new D.default(0))?ie:new D.default(0);for(let H=0;H<Q.length;H++)f.rewardInfos[H].pendingReward=Q[H].gte(new D.default(0))?Q[H]:new D.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:s,slippage:o,priceLimit:i=new C.default(0),catchLiquidityInsufficient:a=!1}){var he;let c,l=n.toBase58()===e.mintA.address,[d,p]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];i.equals(new C.default(0))?c=l?Ce.add(new D.default(1)):Ne.sub(new D.default(1)):c=w.priceToSqrtPriceX64(i,e.mintA.decimals,e.mintB.decimals);let m=G(s,d,r,!1),{allTrade:y,expectedAmountOut:g,remainingAccounts:T,executionPrice:f,feeAmount:I}=le.getOutputAmountAndRemainAccounts(e,t,n,m.amount.sub((he=m.fee)!=null?he:V),c,a),S=G(g,p,r,!1),U=w.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),X=l?U:new C.default(1).div(U),x=g.mul(new D.default(Math.floor((1-o)*1e10))).div(new D.default(1e10)),Z=G(x,p,r,!1),K=l?e.currentPrice:new C.default(1).div(e.currentPrice),ie=new C.default(X).sub(K).abs(),Q=K,H=new Pe(new C.default(ie).mul(10**15).toFixed(0),new C.default(Q).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:m,amountOut:S,minAmountOut:Z,expirationTime:ke(m.expirationTime,S.expirationTime),currentPrice:e.currentPrice,executionPrice:X,priceImpact:H,fee:I,remainingAccounts:T,executionPriceX64:f}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:s,epochInfo:o,catchLiquidityInsufficient:i=!1}){let a=r.address===e.mintB.address,[c,l]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[d,p]=[new Te(O(M({},c),{mint:c.address,isToken2022:c.programId===Mt.TOKEN_2022_PROGRAM_ID.toBase58()})),new Te(O(M({},l),{mint:l.address,isToken2022:l.programId===Mt.TOKEN_2022_PROGRAM_ID.toBase58()}))],{allTrade:m,realAmountIn:y,amountOut:g,minAmountOut:T,expirationTime:f,currentPrice:I,executionPrice:S,priceImpact:U,fee:X,remainingAccounts:x,executionPriceX64:Z}=le.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new re.PublicKey(c.address),amountIn:n,slippage:s,epochInfo:o,catchLiquidityInsufficient:i}),K=O(M({},y),{amount:new Y(d,y.amount),fee:y.fee===void 0?void 0:new Y(d,y.fee)}),ie=O(M({},g),{amount:new Y(p,g.amount),fee:g.fee===void 0?void 0:new Y(p,g.fee)}),Q=O(M({},T),{amount:new Y(p,T.amount),fee:T.fee===void 0?void 0:new Y(p,T.fee)}),H=new pe({baseToken:d,denominator:new D.default(10).pow(new D.default(20+d.decimals)),quoteToken:p,numerator:I.mul(new C.default(10**(20+p.decimals))).toFixed(0)}),he=new pe({baseToken:d,denominator:new D.default(10).pow(new D.default(20+d.decimals)),quoteToken:p,numerator:S.mul(new C.default(10**(20+p.decimals))).toFixed(0)}),de=new Y(d,X);return{allTrade:m,realAmountIn:K,amountOut:ie,minAmountOut:Q,expirationTime:f,currentPrice:H,executionPrice:he,priceImpact:U,fee:de,remainingAccounts:x,executionPriceX64:Z}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:s,slippage:o,priceLimit:i=new C.default(0)}){var Q;let a=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;i.equals(new C.default(0))?l=a?Ne.sub(new D.default(1)):Ce.add(new D.default(1)):l=w.priceToSqrtPriceX64(i,e.mintA.decimals,e.mintB.decimals);let d=G(s,c[n.toString()],r,!0),{expectedAmountIn:p,remainingAccounts:m,executionPrice:y,feeAmount:g}=le.getInputAmountAndRemainAccounts(e,t,n,d.amount.sub((Q=d.fee)!=null?Q:V),l),T=a?e.mintB.address:e.mintA.address,f=G(p,c[T],r,!1),I=w.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),S=a?I:new C.default(1).div(I),U=p.mul(new D.default(Math.floor((1+o)*1e10))).div(new D.default(1e10)),X=G(U,c[T],r,!0),x=a?e.currentPrice:new C.default(1).div(e.currentPrice),Z=new C.default(S).sub(x).abs(),K=x,ie=new Pe(new C.default(Z).mul(10**15).toFixed(0),new C.default(K).mul(10**15).toFixed(0));return{amountIn:f,maxAmountIn:X,realAmountOut:d,expirationTime:ke(f.expirationTime,d.expirationTime),currentPrice:e.currentPrice,executionPrice:S,priceImpact:ie,fee:g,remainingAccounts:m}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,g,T;let s=e[t],o=A.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),i=A.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),a=Math.max(o,s.priceMin),l=Math.min(i,s.priceMax)-a,d=i-o,p=s.priceMax-s.priceMin,m;return l<=0?m=0:d===l?m=p/l:p===l?m=l/d:m=l/p*(l/d),{feeApr:s.feeApr*m,rewardsApr:[((y=s.rewardApr[0])!=null?y:0)*m,((g=s.rewardApr[1])!=null?g:0)*m,((T=s.rewardApr[2])!=null?T:0)*m],apr:s.apr*m}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:s,positionTickLowerIndex:o,positionTickUpperIndex:i,chainTime:a}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],d=r[rt(e.mintA.address).toString()],p=r[rt(e.mintB.address).toString()],m=e.mintA.decimals,y=e.mintB.decimals;if(!l||!d||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let g=w.priceToSqrtPriceX64(new C.default(e.price),e.mintA.decimals,e.mintB.decimals),T=w.getSqrtPriceX64FromTick(o),f=w.getSqrtPriceX64FromTick(i),{amountSlippageA:I,amountSlippageB:S}=N.getAmountsFromLiquidityWithSlippage(g,T,f,t,!1,!1,0),{amountSlippageA:U,amountSlippageB:X}=N.getAmountsFromLiquidityWithSlippage(g,T,f,s,!1,!1,0),x=new C.default(I.toString()).div(new C.default(10).pow(m)).mul(d.value).add(new C.default(S.toString()).div(new C.default(10).pow(y)).mul(p.value)),Z=new C.default(U.toString()).div(new C.default(10).pow(m)).mul(d.value).add(new C.default(X.toString()).div(new C.default(10).pow(y)).mul(p.value)),K=new C.default(1).div(x.add(Z)),Q=new C.default(l.volumeFee).mul(365).div(c).mul(K).mul(100).toNumber(),H=3600*24*365,he=e.rewardDefaultInfos.map(de=>{var Ot,Kt;let tt=de.mint.decimals,Dt=r[de.mint.address];return a<((Ot=de.startTime)!=null?Ot:0)||a>((Kt=de.endTime)!=null?Kt:0)||!de.perSecond||!Dt||tt===void 0?0:new C.default(Dt.value).mul(new C.default(de.perSecond).mul(H)).div(new C.default(10).pow(tt)).mul(K).mul(100).toNumber()});return{feeApr:Q,rewardsApr:he,apr:Q+he.reduce((de,tt)=>de+tt,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:s,slippage:o,add:i,epochInfo:a,amountHasFee:c}){var f,I;let l=w.priceToSqrtPriceX64(new C.default(e.price),e.mintA.decimals,e.mintB.decimals),d=w.getSqrtPriceX64FromTick(n),p=w.getSqrtPriceX64FromTick(r),m=G(s,(f=e[t?"mintA":"mintB"].extensions)==null?void 0:f.feeConfig,a,!c),y=new D.default(new C.default(m.amount.sub((I=m.fee)!=null?I:V).toString()).toFixed(0)),g;if(l.lte(d))g=t?N.getLiquidityFromTokenAmountA(d,p,y,!i):new D.default(0);else if(l.lte(p)){let S=N.getLiquidityFromTokenAmountA(l,p,y,!i),U=N.getLiquidityFromTokenAmountB(d,l,y);g=t?S:U}else g=t?new D.default(0):N.getLiquidityFromTokenAmountB(d,p,y);let T=await le.getAmountsFromLiquidity({epochInfo:a,poolInfo:e,tickLower:n,tickUpper:r,liquidity:g,slippage:o,add:i});return{liquidity:g,amountA:t?m:T.amountA,amountB:t?T.amountB:m,amountSlippageA:t?m:T.amountSlippageA,amountSlippageB:t?T.amountSlippageB:m,expirationTime:T.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:s,slippage:o,add:i}){var T,f,I,S;let a=w.getSqrtPriceX64FromTick(n),c=w.getSqrtPriceX64FromTick(r),l=i?1+o:1-o,d=N.getAmountsFromLiquidity(w.priceToSqrtPriceX64(new C.default(t.price),t.mintA.decimals,t.mintB.decimals),a,c,s,i),[p,m]=[G(d.amountA,(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),G(d.amountB,(f=t.mintB.extensions)==null?void 0:f.feeConfig,e,!0)],[y,g]=[G(d.amountA.muln(l),(I=t.mintA.extensions)==null?void 0:I.feeConfig,e,!0),G(d.amountB.muln(l),(S=t.mintB.extensions)==null?void 0:S.feeConfig,e,!0)];return{liquidity:s,amountA:p,amountB:m,amountSlippageA:y,amountSlippageB:g,expirationTime:ke(p.expirationTime,m.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(a=>!n[a.id]).map(a=>new re.PublicKey(a.id));(await Ae(e,r)).forEach((a,c)=>{!a||(n[r[c].toBase58()]=An.decode(a.data))});let o=t.map(a=>mt(new re.PublicKey(a.programId),new re.PublicKey(a.id)).publicKey),i=await le.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((a,c)=>O(M({},a),{[c.id]:O(M({},n[c.id]),{id:new re.PublicKey(c.id),version:6,programId:new re.PublicKey(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:O(M({},c.config),{id:new re.PublicKey(c.config.id),fundOwner:""}),currentPrice:new C.default(c.price),exBitmapAccount:mt(new re.PublicKey(c.programId),new re.PublicKey(c.id)).publicKey,exBitmapInfo:i[mt(new re.PublicKey(c.programId),new re.PublicKey(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};function mr({poolInfo:u,tickLower:e,tickUpper:t,amountA:n,amountB:r,slippage:s,add:o,epochInfo:i,amountHasFee:a}){var S,U,X,x;let[c,l,d,p]=e<t?[e,t,n,r]:[t,e,r,n],m=w.priceToSqrtPriceX64(new C.default(u.price),u.mintA.decimals,u.mintB.decimals),y=w.getSqrtPriceX64FromTick(c),g=w.getSqrtPriceX64FromTick(l),[T,f]=[G(d,(S=u.mintA.extensions)==null?void 0:S.feeConfig,i,!a),G(p,(U=u.mintB.extensions)==null?void 0:U.feeConfig,i,!a)],I=N.getLiquidityFromTokenAmounts(m,y,g,T.amount.sub((X=T.fee)!=null?X:V),f.amount.sub((x=f.fee)!=null?x:V));return N.getAmountsOutFromLiquidity({poolInfo:u,tickLower:e,tickUpper:t,liquidity:I,slippage:s,add:o,epochInfo:i,amountAddFee:!a})}var _t={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function lr(u){return O(M({},u),{type:"Concentrated",programId:u.programId.toString(),id:u.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:u.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:u.ammConfig.tradeFeeRate,openTime:u.startTime.toString(),tvl:0,day:_t,week:_t,month:_t,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:O(M({},u.ammConfig),{id:u.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}0&&(module.exports={PoolUtils,clmmComputeInfoToApiInfo,getLiquidityFromAmounts});
//# sourceMappingURL=pool.js.map