var mt=Object.defineProperty,lt=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var pt=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable;var Me=(i,e,t)=>e in i?mt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,M=(i,e)=>{for(var t in e||(e={}))pt.call(e,t)&&Me(i,t,e[t]);if(Fe)for(var t of Fe(e))ft.call(e,t)&&Me(i,t,e[t]);return i},K=(i,e)=>lt(i,dt(e));import un from"bn.js";import J from"decimal.js";import _ from"bn.js";var O=new _(0),j=new _(1),Oe=new _(-1),ie=new _(1).shln(64),oe=new _(1).shln(128),gt=ie.sub(j),le=64,De=oe.subn(1),v=-443636,U=-v,de=new _("4295048016"),pe=new _("79226673521066979257578248091"),ln=new _("4295048017"),dn=new _("79226673521066979257578248090"),Ke=16,ve="59543866431248",Ge="184467440737095516",qe="15793534762490258745",yt=new _(10).pow(new _(6));var pn=new _("18446744073700000000");import g from"bn.js";import re from"decimal.js";import yn from"bn.js";import{PublicKey as Tt}from"@solana/web3.js";import{get as Ve,set as bt}from"lodash";var fe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ue={},ht={};function E(i){let e=Ve(Ue,i);if(!e){let t=Ve(ht,i);e=new fe({name:i,logLevel:t}),bt(Ue,i,e)}return e}import{MINT_SIZE as Sn,TOKEN_PROGRAM_ID as Cn,getTransferFeeConfig as Nn,unpackMint as Ln}from"@solana/spl-token";var ge=E("Raydium_accountInfo_util");async function se(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=M({batchRequest:!1},t),a=ye(e,o),s=new Array(a.length).fill([]);if(n){let c=a.map(I=>{let P=i._buildArgs([I.map(T=>T.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:P}}),p=ye(c,10);s=(await(await Promise.all(p.map(async I=>await i._rpcBatchRequest(I)))).flat()).map(I=>(I.error&&ge.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${I.error.message}`),I.result.value.map(P=>{if(P){let{data:T,executable:F,lamports:at,owner:ut,rentEpoch:ct}=P;return T.length!==2&&T[1]!=="base64"&&ge.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(T[0],"base64"),executable:F,lamports:at,owner:new Tt(ut),rentEpoch:ct}}return null})))}else try{s=await Promise.all(a.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&ge.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return s.flat()}import q from"bn.js";import di from"decimal.js";import Ct from"big.js";import zn from"bn.js";import wt from"toformat";var At=wt,Q=At;import ue from"big.js";import kt from"bn.js";import Bt from"decimal.js-light";import $ from"bn.js";var We=9007199254740991;function G(i){let e=E("Raydium_parseBigNumberish");if(i instanceof $)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new $(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=We||i<=-We)&&e.logWithError(`BigNumberish number overflow: ${i}`),new $(String(i))):typeof i=="bigint"?new $(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new $(0))}var ae=E("module/fraction"),he=Q(ue),ee=Q(Bt),It={[0]:ee.ROUND_DOWN,[1]:ee.ROUND_HALF_UP,[2]:ee.ROUND_UP},St={[0]:ue.roundDown,[1]:ue.roundHalfUp,[2]:ue.roundUp},y=class{constructor(e,t=new kt(1)){this.numerator=G(e),this.denominator=G(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new y(this.denominator,this.numerator)}add(e){let t=e instanceof y?e:new y(G(e));return this.denominator.eq(t.denominator)?new y(this.numerator.add(t.numerator),this.denominator):new y(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof y?e:new y(G(e));return this.denominator.eq(t.denominator)?new y(this.numerator.sub(t.numerator),this.denominator):new y(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof y?e:new y(G(e));return new y(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof y?e:new y(G(e));return new y(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||ae.logWithError(`${e} is not an integer.`),e<=0&&ae.logWithError(`${e} is not positive.`),ee.set({precision:e+1,rounding:It[n]});let r=new ee(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||ae.logWithError(`${e} is not an integer.`),e<0&&ae.logWithError(`${e} is negative.`),he.DP=e,he.RM=St[n]||1,new he(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var nr=E("Raydium_amount"),rr=Q(Ct);import{PublicKey as Lt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Xe}from"@solana/spl-token";var He={chainId:101,address:Lt.default.toBase58(),programId:Xe.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},X={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Xe.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as xe}from"@solana/web3.js";import{PublicKey as b,SystemProgram as ze,SYSVAR_RENT_PUBKEY as Rt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _t}from"@solana/spl-token";function Te({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var lr=[Te({pubkey:_t,isWritable:!1}),Te({pubkey:ze.programId,isWritable:!1}),Te({pubkey:Rt,isWritable:!1})];function je({publicKey:i,transformSol:e}){let t=Ye(i.toString());if(t instanceof b)return e&&t.equals(te)?be:t;if(e&&t.toString()===te.toBase58())return be;if(typeof t=="string"){if(t===b.default.toBase58())return b.default;try{return new b(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ye(i){try{return new b(i)}catch{return i}}var dr=new b("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),pr=new b("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),fr=new b("SysvarRent111111111111111111111111111111111"),gr=new b("SysvarC1ock11111111111111111111111111111111"),Et=new b("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),yr=new b("Sysvar1nstructions1111111111111111111111111"),br=ze.programId,hr=new b("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Tr=new b("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xr=new b("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),wr=new b("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ar=new b("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Pr=new b("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),kr=new b("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Br=new b("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ir=new b("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Sr=new b("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Cr=new b("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),be=new b("So11111111111111111111111111111111111111112"),te=b.default;var we=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:a=!1}){if(e===te.toBase58()||e instanceof xe&&te.equals(e)){this.decimals=X.decimals,this.symbol=X.symbol,this.name=X.name,this.mint=new xe(X.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?xe.default:je({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},H=we;H.WSOL=new we(K(M({},X),{mint:X.address}));var Ae=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},ce=Ae;ce.SOL=new Ae(He);import Ft from"bn.js";var Gr=new y(new Ft(100));var Hr=E("Raydium_price");var Mt=new q(0),wi=new q(1),Ai=new q(2),Pi=new q(3),ki=new q(5),Nt=new q(10),Bi=new q(100),Ii=new q(1e3),Si=new q(1e4);function ye(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ji}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as $i}from"@solana/spl-token";import{ComputeBudgetProgram as Mi,Keypair as Ki,PublicKey as Dt,Transaction as Gi,TransactionMessage as Vi,VersionedTransaction as Ui}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zi}from"@solana/spl-token";var ji=E("Raydium_txUtil");function Ie(i,e){let[t,n]=Dt.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as u}from"@solana/web3.js";var ro=new u("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),io=new u("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),oo=new u("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),so=new u("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ao=new u("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),uo=new u("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),co=new u("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),mo=new u("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),lo=new u("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),po=new u("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),fo=new u("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),go=new u("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),yo=new u("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),bo=new u("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ho=new u("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),To=new u("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),xo=new u("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),wo=new u("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ao=new u("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Po=new u("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ko=new u("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Bo=new u("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Io=new u("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),So=new u("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Co=new u("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),No=new u("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Lo=new u("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ro=new u("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),_o=new u("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Eo=new u("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Fo=new u("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Mo={OPEN_BOOK_PROGRAM:new u("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new u("Ray1111111111111111111111111111111111111111"),AMM_V4:new u("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new u("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new u("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new u("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new u("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new u("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new u("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new u("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new u("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new u("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:u.default,Router:new u("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new u("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new u("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new u("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new u("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new u("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new u("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new u("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new u("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new u("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new u("Ray1111111111111111111111111111111111111111")};import{PublicKey as vo,AddressLookupTableAccount as Go}from"@solana/web3.js";import{PublicKey as is,sendAndConfirmTransaction as os,SystemProgram as us,Transaction as cs,TransactionMessage as ls,VersionedTransaction as ds}from"@solana/web3.js";import fs from"axios";import{PublicKey as As}from"@solana/web3.js";import ks from"bn.js";import Kt from"bn.js";var Ns=new Kt(1e6);function Ze(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}var ea=Buffer.from("amm_config","utf8"),ta=Buffer.from("pool","utf8"),na=Buffer.from("pool_vault","utf8"),ra=Buffer.from("pool_reward_vault","utf8"),ia=Buffer.from("position","utf8"),vt=Buffer.from("tick_array","utf8"),oa=Buffer.from("operation","utf8"),sa=Buffer.from("pool_tick_array_bitmap_extension","utf8"),aa=Buffer.from("observation","utf8");function V(i,e,t){return Ie([vt,e.toBuffer(),Ze(t)],i)}var ua=Buffer.from("locked_position","utf8");var ca=Buffer.from("support_mint","utf8");import{PublicKey as $u}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as tc}from"@solana/spl-token";import rc from"bn.js";import oc from"decimal.js";import{PublicKey as jt}from"@solana/web3.js";import et,{isBN as tt}from"bn.js";import{bits as da,BitStructure as pa,blob as Gt,Blob as fa,cstr as ga,f32 as ya,f32be as ba,f64 as ha,f64be as Ta,greedy as xa,Layout as qt,ns64 as wa,ns64be as Aa,nu64 as Pa,nu64be as ka,offset as Ba,s16 as Ia,s16be as Sa,s24 as Ca,s24be as Na,s32 as Vt,s32be as La,s40 as Ra,s40be as _a,s48 as Ea,s48be as Fa,s8 as Ma,seq as Ut,struct as Oa,Structure as Wt,u16 as Xt,u16be as Da,u24 as Ka,u24be as va,u32 as Ga,u32be as qa,u40 as Va,u40be as Ua,u48 as Wa,u48be as Xa,u8 as Ht,UInt as zt,union as Ha,Union as za,unionLayoutDiscriminator as ja,utf8 as Ya}from"@solana/buffer-layout";var Se=qt,Je=Wt;var Ce=zt;var Qe=Ht,ne=Xt;var W=Vt;var $e=Ut;var L=Gt;var Y=class extends Se{constructor(t,n,r){super(t,r);this.blob=L(t),this.signed=n}decode(t,n=0){let r=new et(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new et(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function N(i){return new Ce(1,i)}function Z(i){return new Ce(4,i)}function d(i){return new Y(8,!1,i)}function x(i){return new Y(16,!1,i)}function nt(i){return new Y(8,!0,i)}function rt(i){return new Y(16,!0,i)}var me=class extends Se{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function f(i){return new me(L(32),e=>new jt(e),e=>e.toBuffer(),i)}function it(i){return new me(Qe(),Yt,Zt,i)}function Yt(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Zt(i){return i?1:0}var Ne=class extends Je{decode(e,t){return super.decode(e,t)}};function C(i,e,t){return new Ne(i,e,t)}function h(i,e,t){let n,r=typeof e=="number"?e:tt(e)?e.toNumber():new Proxy(e,{get(o,a){if(!n){let s=Reflect.get(o,"count");n=tt(s)?s.toNumber():s,Reflect.set(o,"count",n)}return Reflect.get(o,a)},set(o,a,s){return a==="count"&&(n=s),Reflect.set(o,a,s)}});return $e(i,r,t)}var Jt=15,R=class{static async getTickArrays(e,t,n,r,o,a,s){let c=[],p=w.getTickArrayStartIndexByTick(r,o),S=w.getInitializedTickArrayInRange(a,s,o,p,Math.floor(Jt/2));for(let T=0;T<S.length;T++){let{publicKey:F}=V(t,n,S[T]);c.push(F)}let I=(await se(e,c)).map(T=>T!==null?Le.decode(T.data):null),P={};for(let T=0;T<c.length;T++){let F=I[T];F!==null&&(P[F.startTickIndex]=K(M({},F),{address:c[T]}))}return P}static nextInitializedTick(e,t,n,r,o,a){let{initializedTick:s,tickArrayAddress:c,tickArrayStartTickIndex:p}=this.nextInitializedTickInOneArray(e,t,n,r,o,a);for(;s==null||s.liquidityGross.lten(0);){if(p=w.getNextTickArrayStartIndex(p,o,a),this.checkIsValidStartIndex(p,o))throw new Error("No enough initialized tickArray");let S=n[p];if(S===void 0)continue;let{nextTick:I,tickArrayAddress:P,tickArrayStartTickIndex:T}=this.firstInitializedTickInOneArray(e,t,S,a);[s,c,p]=[I,P,T]}if(s==null)throw new Error("No invaild tickArray cache");return{nextTick:s,tickArrayAddress:c,tickArrayStartTickIndex:p}}static nextInitializedTickArray(e,t,n,r,o){let a=Math.floor(e/R.tickCount(t)),s=n?w.searchLowBitFromStart(r,o,a-1,1,t):w.searchHightBitFromStart(r,o,a+1,1,t);return s.length>0?{isExist:!0,nextStartIndex:s[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let s=B-1;for(;s>=0;){let c=n.ticks[s];if(c.liquidityGross.gtn(0)){o=c;break}s=s-1}}else{let s=0;for(;s<B;){let c=n.ticks[s];if(c.liquidityGross.gtn(0)){o=c;break}s=s+1}}let{publicKey:a}=V(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:a,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,a){let s=w.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-s)/o),p=n[s];if(p==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:s};let S;if(a)for(;c>=0;){let P=p.ticks[c];if(P.liquidityGross.gtn(0)){S=P;break}c=c-1}else for(c=c+1;c<B;){let P=p.ticks[c];if(P.liquidityGross.gtn(0)){S=P;break}c=c+1}let{publicKey:I}=V(e,t,s);return{initializedTick:S,tickArrayAddress:I,tickArrayStartTickIndex:p.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(w.checkIsOutOfBoundary(e)){if(e>U)return!1;let n=w.getTickArrayStartIndexByTick(v,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return B*e}};var Re=14;var Nu=C([L(8),N("bump"),ne("index"),f(""),Z("protocolFeeRate"),Z("tradeFeeRate"),ne("tickSpacing"),h(d(),8,"")]),Qt=C([Z("blockTimestamp"),nt("tickCumulative"),h(d(),4)]),Lu=C([L(8),it("initialized"),d("recentEpoch"),ne("observationIndex"),f("poolId"),h(Qt,100,"observations"),h(d(),4)]),$t=C([N("rewardState"),d("openTime"),d("endTime"),d("lastUpdateTime"),x("emissionsPerSecondX64"),d("rewardTotalEmissioned"),d("rewardClaimed"),f("tokenMint"),f("tokenVault"),f("creator"),x("rewardGrowthGlobalX64")]),en=C([L(8),N("bump"),f("ammConfig"),f("creator"),f("mintA"),f("mintB"),f("vaultA"),f("vaultB"),f("observationId"),N("mintDecimalsA"),N("mintDecimalsB"),ne("tickSpacing"),x("liquidity"),x("sqrtPriceX64"),W("tickCurrent"),Z(),x("feeGrowthGlobalX64A"),x("feeGrowthGlobalX64B"),d("protocolFeesTokenA"),d("protocolFeesTokenB"),x("swapInAmountTokenA"),x("swapOutAmountTokenB"),x("swapInAmountTokenB"),x("swapOutAmountTokenA"),N("status"),h(N(),7,""),h($t,3,"rewardInfos"),h(d(),16,"tickArrayBitmap"),d("totalFeesTokenA"),d("totalFeesClaimedTokenA"),d("totalFeesTokenB"),d("totalFeesClaimedTokenB"),d("fundFeesTokenA"),d("fundFeesTokenB"),d("startTime"),h(d(),15*4-3,"padding")]),tn=C([x("growthInsideLastX64"),d("rewardAmountOwed")]),nn=C([L(8),N("bump"),f("nftMint"),f("poolId"),W("tickLower"),W("tickUpper"),x("liquidity"),x("feeGrowthInsideLastX64A"),x("feeGrowthInsideLastX64B"),d("tokenFeesOwedA"),d("tokenFeesOwedB"),h(tn,3,"rewardInfos"),h(d(),8,"")]),Ru=C([L(8),N("bump"),f("poolId"),W("tickLowerIndex"),W("tickUpperIndex"),x("liquidity"),x("feeGrowthInsideLastX64A"),x("feeGrowthInsideLastX64B"),d("tokenFeesOwedA"),d("tokenFeesOwedB"),h(x(),3,"rewardGrowthInside"),h(d(),8,"")]),rn=C([W("tick"),rt("liquidityNet"),x("liquidityGross"),x("feeGrowthOutsideX64A"),x("feeGrowthOutsideX64B"),h(x(),3,"rewardGrowthsOutsideX64"),h(Z(),13,"")]),Le=C([L(8),f("poolId"),W("startTickIndex"),h(rn,B,"ticks"),N("initializedTickCount"),h(N(),115,"")]),_u=C([L(329),h(f(),100,"whitelistMints")]),on=C([L(8),f("poolId"),h(h(d(),8),Re,"positiveTickArrayBitmap"),h(h(d(),8),Re,"negativeTickArrayBitmap")]),Eu=C([d(),N("bump"),f("owner"),f("poolId"),f("positionId"),f("nftAccount"),h(d(),8)]),Fu=C([L(8),N("bump"),f("lockOwner"),f("poolId"),f("positionId"),f("nftAccount"),f("lockNftMint"),d("recentEpoch"),h(d(),8)]);import Du from"bn.js";import vu from"decimal.js";var D=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(O)||(o=o.add(j)),o}static mulDivFloor(e,t,n){if(n.eq(O))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(O))throw new Error("division by 0");return e.mul(t).add(n.sub(j)).div(n)}static x64ToDecimal(e,t){return new re(e.toString()).div(re.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new g(e.mul(re.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(oe).sub(t).mod(oe)}};function k(i,e){return Ee(i.mul(e),64,256)}function an(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Ee(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var A=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(re.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(re.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(O))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(O))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(O))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(O))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(O))return e;let o=t.shln(le);if(r){let a=o,s=o.add(n.mul(e));return s.gte(a)?D.mulDivCeil(a,e,s):D.mulDivRoundingUp(a,j,a.div(e).add(n))}else{let a=n.mul(e);if(!o.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let s=o.sub(a);return D.mulDivCeil(o,e,s)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(le);if(r)return e.add(o.div(t));{let a=D.mulDivRoundingUp(o,j,t);if(!e.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(a)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<v||e>U)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new g("18445821805675395072"):new g("18446744073709551616");return(t&2)!=0&&(n=k(n,new g("18444899583751176192"))),(t&4)!=0&&(n=k(n,new g("18443055278223355904"))),(t&8)!=0&&(n=k(n,new g("18439367220385607680"))),(t&16)!=0&&(n=k(n,new g("18431993317065453568"))),(t&32)!=0&&(n=k(n,new g("18417254355718170624"))),(t&64)!=0&&(n=k(n,new g("18387811781193609216"))),(t&128)!=0&&(n=k(n,new g("18329067761203558400"))),(t&256)!=0&&(n=k(n,new g("18212142134806163456"))),(t&512)!=0&&(n=k(n,new g("17980523815641700352"))),(t&1024)!=0&&(n=k(n,new g("17526086738831433728"))),(t&2048)!=0&&(n=k(n,new g("16651378430235570176"))),(t&4096)!=0&&(n=k(n,new g("15030750278694412288"))),(t&8192)!=0&&(n=k(n,new g("12247334978884435968"))),(t&16384)!=0&&(n=k(n,new g("8131365268886854656"))),(t&32768)!=0&&(n=k(n,new g("3584323654725218816"))),(t&65536)!=0&&(n=k(n,new g("696457651848324352"))),(t&131072)!=0&&(n=k(n,new g("26294789957507116"))),(t&262144)!=0&&(n=k(n,new g("37481735321082"))),e>0&&(n=De.div(n)),n}static getTickFromPrice(e,t,n){return A.getTickFromSqrtPriceX64(A.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(pe)||e.lt(de))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new g(t-64),r=an(n,32,128),o=new g("8000000000000000","hex"),a=0,s=new g(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new g(0))&&a<Ke;){c=c.mul(c);let F=c.shrn(127);c=c.shrn(63+F.toNumber()),s=s.add(o.mul(F)),o=o.shrn(1),a+=1}let p=s.shrn(32),I=r.add(p).mul(new g(ve)),P=Ee(I.sub(new g(Ge)),64,128).toNumber(),T=Ee(I.add(new g(qe)),64,128).toNumber();return P==T?P:A.getSqrtPriceX64FromTick(T).lte(e)?T:P}},z=class{static getTickWithPriceAndTickspacing(e,t,n,r){let a=A.getTickFromSqrtPriceX64(A.priceToSqrtPriceX64(e,n,r))/t;return a<0?a=Math.floor(a):a=Math.ceil(a),a*t}static roundPriceWithTickspacing(e,t,n,r){let o=z.getTickWithPriceAndTickspacing(e,t,n,r),a=A.getSqrtPriceX64FromTick(o);return A.sqrtPriceX64ToPrice(a,n,r)}};var B=60,_e=512,w=class{static getTickArrayAddressByTick(e,t,n,r){let o=w.getTickArrayStartIndexByTick(n,r),{publicKey:a}=V(e,t,o);return a}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=w.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=B)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=R.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*R.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*B,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*B,o=Math.floor(t/r)+512,a=Math.abs(o);return{isInitialized:e.testn(a),startIndex:(a-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*B:e+t*B}static mergeTickArrayBitmap(e){let t=new un(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let a=Math.floor(r/(n*B));return[...w.searchLowBitFromStart(e,t,a-1,o,n),...w.searchHightBitFromStart(e,t,a,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return w.searchHightBitFromStart(e,t,-7680,_e,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let a=[],s=w.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of s){let{publicKey:p}=V(e,t,c);a.push({tickArrayStartIndex:c,tickArrayAddress:p})}return a}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(p=>w.mergeTickArrayBitmap(p)),s=[];for(;n>=-7680;){let p=Math.floor((n+7680)/512),S=(n+7680)%512;if(a[p].testn(S)&&s.push(n),n--,s.length===r)break}let c=R.tickCount(o);return s.map(p=>p*c)}static searchHightBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(p=>w.mergeTickArrayBitmap(p)),s=[];for(;n<7680;){let p=Math.floor((n+7680)/512),S=(n+7680)%512;if(a[p].testn(S)&&s.push(n),n++,s.length===r)break}let c=R.tickCount(o);return s.map(p=>p*c)}static checkIsOutOfBoundary(e){return e<v||e>U}static nextInitTick(e,t,n,r,o){if(R.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let s=Math.floor((t-e.startTickIndex)/n);if(r)for(;s>=0;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s-1}else for(o||(s=s+1);s<B;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s+1}return null}static firstInitializedTick(e,t){if(t){let n=B-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<B;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=A.getSqrtPriceX64FromTick(t),o=A.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new J(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new J(1).div(t),o=z.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=A.getSqrtPriceX64FromTick(o),s=A.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new J(1).div(s)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=A.getSqrtPriceX64FromTick(t),o=A.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new J(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new J(1).div(t),o=z.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=A.getSqrtPriceX64FromTick(o),s=A.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new J(1).div(s)}}};export{_e as TICK_ARRAY_BITMAP_SIZE,B as TICK_ARRAY_SIZE,w as TickUtils};
//# sourceMappingURL=tick.mjs.map