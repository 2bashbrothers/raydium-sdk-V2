var Lt=Object.create;var oe=Object.defineProperty,Rt=Object.defineProperties,_t=Object.getOwnPropertyDescriptor,Et=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertyNames,Je=Object.getOwnPropertySymbols,Mt=Object.getPrototypeOf,$e=Object.prototype.hasOwnProperty,Ot=Object.prototype.propertyIsEnumerable;var Qe=(r,e,t)=>e in r?oe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,G=(r,e)=>{for(var t in e||(e={}))$e.call(e,t)&&Qe(r,t,e[t]);if(Je)for(var t of Je(e))Ot.call(e,t)&&Qe(r,t,e[t]);return r},V=(r,e)=>Rt(r,Et(e));var Dt=(r,e)=>{for(var t in e)oe(r,t,{get:e[t],enumerable:!0})},et=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ft(e))!$e.call(r,i)&&i!==t&&oe(r,i,{get:()=>e[i],enumerable:!(n=_t(e,i))||n.enumerable});return r};var T=(r,e,t)=>(t=r!=null?Lt(Mt(r)):{},et(e||!r||!r.__esModule?oe(t,"default",{value:r,enumerable:!0}):t,r)),Kt=r=>et(oe({},"__esModule",{value:!0}),r);var kn={};Dt(kn,{PositionUtils:()=>Be});module.exports=Kt(kn);var v=T(require("bn.js")),Ie=T(require("decimal.js"));var Gt=require("@solana/web3.js");var se=require("lodash");var Se=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},tt={},vt={};function _(r){let e=(0,se.get)(tt,r);if(!e){let t=(0,se.get)(vt,r);e=new Se({name:r,logLevel:t}),(0,se.set)(tt,r,e)}return e}var he=require("@solana/spl-token"),_n=_("Raydium_accountInfo_util");var q=T(require("bn.js")),Zt=T(require("decimal.js"));var st=T(require("big.js")),Ht=T(require("bn.js"));var nt=T(require("toformat")),Vt=nt.default,ae=Vt;var ue=T(require("big.js")),it=T(require("bn.js")),ot=T(require("decimal.js-light"));var Z=T(require("bn.js"));var rt=9007199254740991;function U(r){let e=_("Raydium_parseBigNumberish");if(r instanceof Z.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Z.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=rt||r<=-rt)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Z.default(String(r))):typeof r=="bigint"?new Z.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Z.default(0))}var Te=_("module/fraction"),Ne=ae(ue.default),ce=ae(ot.default),Wt={[0]:ce.ROUND_DOWN,[1]:ce.ROUND_HALF_UP,[2]:ce.ROUND_UP},Xt={[0]:ue.default.roundDown,[1]:ue.default.roundHalfUp,[2]:ue.default.roundUp},b=class{constructor(e,t=new it.default(1)){this.numerator=U(e),this.denominator=U(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new b(this.denominator,this.numerator)}add(e){let t=e instanceof b?e:new b(U(e));return this.denominator.eq(t.denominator)?new b(this.numerator.add(t.numerator),this.denominator):new b(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof b?e:new b(U(e));return this.denominator.eq(t.denominator)?new b(this.numerator.sub(t.numerator),this.denominator):new b(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof b?e:new b(U(e));return new b(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof b?e:new b(U(e));return new b(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Te.logWithError(`${e} is not an integer.`),e<=0&&Te.logWithError(`${e} is not positive.`),ce.set({precision:e+1,rounding:Wt[n]});let i=new ce(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Te.logWithError(`${e} is not an integer.`),e<0&&Te.logWithError(`${e} is negative.`),Ne.DP=e,Ne.RM=Xt[n]||1,new Ne(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Jn=_("Raydium_amount"),Qn=ae(st.default);var at=require("@solana/web3.js"),Le=require("@solana/spl-token"),ut={chainId:101,address:at.PublicKey.default.toBase58(),programId:Le.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},z={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Le.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var xe=require("@solana/web3.js");var g=require("@solana/web3.js"),ct=require("@solana/spl-token");function Re({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var nr=[Re({pubkey:ct.TOKEN_PROGRAM_ID,isWritable:!1}),Re({pubkey:g.SystemProgram.programId,isWritable:!1}),Re({pubkey:g.SYSVAR_RENT_PUBKEY,isWritable:!1})];function mt({publicKey:r,transformSol:e}){let t=lt(r.toString());if(t instanceof g.PublicKey)return e&&t.equals(me)?Ce:t;if(e&&t.toString()===me.toBase58())return Ce;if(typeof t=="string"){if(t===g.PublicKey.default.toBase58())return g.PublicKey.default;try{return new g.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function lt(r){try{return new g.PublicKey(r)}catch{return r}}var rr=new g.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ir=new g.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),or=new g.PublicKey("SysvarRent111111111111111111111111111111111"),sr=new g.PublicKey("SysvarC1ock11111111111111111111111111111111"),jt=new g.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ar=new g.PublicKey("Sysvar1nstructions1111111111111111111111111"),ur=g.SystemProgram.programId,cr=new g.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),mr=new g.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),lr=new g.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),dr=new g.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),pr=new g.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),fr=new g.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),gr=new g.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),yr=new g.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),br=new g.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),hr=new g.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Tr=new g.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ce=new g.PublicKey("So11111111111111111111111111111111111111112"),me=g.PublicKey.default;var _e=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:s=!1,isToken2022:o=!1}){if(e===me.toBase58()||e instanceof xe.PublicKey&&me.equals(e)){this.decimals=z.decimals,this.symbol=z.symbol,this.name=z.name,this.mint=new xe.PublicKey(z.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=s?xe.PublicKey.default:mt({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},j=_e;j.WSOL=new _e(V(G({},z),{mint:z.address}));var Ee=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},we=Ee;we.SOL=new Ee(ut);var dt=T(require("bn.js"));var Nr=new b(new dt.default(100));var Mr=_("Raydium_price");var Yt=new q.default(0),ai=new q.default(1),ui=new q.default(2),ci=new q.default(3),mi=new q.default(5),zt=new q.default(10),li=new q.default(100),di=new q.default(1e3),pi=new q.default(1e4);var en=require("@solana/web3.js"),tn=require("@solana/spl-token");var J=require("@solana/web3.js");var Qt=require("@solana/spl-token"),Ii=_("Raydium_txUtil");var u=require("@solana/web3.js"),Li=new u.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ri=new u.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),_i=new u.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ei=new u.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Fi=new u.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Mi=new u.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Oi=new u.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Di=new u.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ki=new u.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),vi=new u.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Gi=new u.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),qi=new u.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Vi=new u.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ui=new u.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Wi=new u.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Xi=new u.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Hi=new u.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),zi=new u.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ji=new u.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Yi=new u.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Zi=new u.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ji=new u.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Qi=new u.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),$i=new u.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),eo=new u.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),to=new u.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),no=new u.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),ro=new u.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),io=new u.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),oo=new u.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),so=new u.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ao={OPEN_BOOK_PROGRAM:new u.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new u.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new u.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new u.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new u.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new u.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new u.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new u.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new u.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new u.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new u.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new u.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:u.PublicKey.default,Router:new u.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new u.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new u.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new u.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new u.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new u.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new u.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new u.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new u.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new u.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new u.PublicKey("Ray1111111111111111111111111111111111111111")};var E=T(require("bn.js")),le=1e4;function D(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=V(G({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),s=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,o=new E.default(s.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(s.transferFeeBasisPoints===le){let m=new E.default(s.maximumFee.toString());return{amount:r.add(m),fee:m,expirationTime:a}}else{let m=De(r.mul(new E.default(le)),new E.default(le-s.transferFeeBasisPoints)),h=new E.default(s.maximumFee.toString()),A=m.sub(r).gt(h)?r.add(h):m,P=De(A.mul(new E.default(s.transferFeeBasisPoints)),new E.default(le)),B=P.gt(o)?o:P;return{amount:A,fee:B,expirationTime:a}}else{let m=De(r.mul(new E.default(s.transferFeeBasisPoints)),new E.default(le)),h=m.gt(o)?o:m;return{amount:r,fee:h,expirationTime:a}}}function de(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function De(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new E.default(0))?t.add(new E.default(1)):t}var ft=require("@solana/web3.js");var Q=require("@solana/web3.js"),nn=T(require("axios"));var rn=require("@solana/web3.js"),on=T(require("bn.js"));var gt=T(require("bn.js")),Go=new gt.default(1e6);var L=T(require("bn.js")),F=new L.default(0),X=new L.default(1),yt=new L.default(-1),M=new L.default(1).shln(64),Ae=new L.default(1).shln(128),Ke=M.sub(X),pe=64,bt=Ae.subn(1),Y=-443636,$=-Y,ve=new L.default("4295048016"),Ge=new L.default("79226673521066979257578248091"),as=new L.default("4295048017"),us=new L.default("79226673521066979257578248090"),ht=16,Tt="59543866431248",xt="184467440737095516",wt="15793534762490258745",sn=new L.default(10).pow(new L.default(6));var cs=new L.default("18446744073700000000");var p=T(require("bn.js")),K=T(require("decimal.js"));var ys=Buffer.from("amm_config","utf8"),bs=Buffer.from("pool","utf8"),hs=Buffer.from("pool_vault","utf8"),Ts=Buffer.from("pool_reward_vault","utf8"),xs=Buffer.from("position","utf8"),ws=Buffer.from("tick_array","utf8"),As=Buffer.from("operation","utf8"),Ps=Buffer.from("pool_tick_array_bitmap_extension","utf8"),ks=Buffer.from("observation","utf8");var Bs=Buffer.from("locked_position","utf8");var Is=Buffer.from("support_mint","utf8");var Tn=require("@solana/web3.js"),xn=require("@solana/spl-token"),wn=T(require("bn.js")),An=T(require("decimal.js"));var Bt=require("@solana/web3.js"),ee=T(require("bn.js"));var c=require("@solana/buffer-layout"),qe=c.Layout,At=c.Structure;var Ve=c.UInt;var Pt=c.u8,fe=c.u16;var H=c.s32;var kt=c.seq;var R=c.blob;var te=class extends qe{constructor(t,n,i){super(t,i);this.blob=R(t),this.signed=n}decode(t,n=0){let i=new ee.default(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new ee.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function N(r){return new Ve(1,r)}function ne(r){return new Ve(4,r)}function f(r){return new te(8,!1,r)}function w(r){return new te(16,!1,r)}function It(r){return new te(8,!0,r)}function St(r){return new te(16,!0,r)}var Pe=class extends qe{constructor(t,n,i,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function y(r){return new Pe(R(32),e=>new Bt.PublicKey(e),e=>e.toBuffer(),r)}function Ct(r){return new Pe(Pt(),an,un,r)}function an(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function un(r){return r?1:0}var Ue=class extends At{decode(e,t){return super.decode(e,t)}};function S(r,e,t){return new Ue(r,e,t)}function x(r,e,t){let n,i=typeof e=="number"?e:(0,ee.isBN)(e)?e.toNumber():new Proxy(e,{get(s,o){if(!n){let a=Reflect.get(s,"count");n=(0,ee.isBN)(a)?a.toNumber():a,Reflect.set(s,"count",n)}return Reflect.get(s,o)},set(s,o,a){return o==="count"&&(n=a),Reflect.set(s,o,a)}});return kt(r,i,t)}var cn=T(require("bn.js")),mn=T(require("decimal.js"));var ke=60;var ze=14;var la=S([R(8),N("bump"),fe("index"),y(""),ne("protocolFeeRate"),ne("tradeFeeRate"),fe("tickSpacing"),x(f(),8,"")]),dn=S([ne("blockTimestamp"),It("tickCumulative"),x(f(),4)]),da=S([R(8),Ct("initialized"),f("recentEpoch"),fe("observationIndex"),y("poolId"),x(dn,100,"observations"),x(f(),4)]),pn=S([N("rewardState"),f("openTime"),f("endTime"),f("lastUpdateTime"),w("emissionsPerSecondX64"),f("rewardTotalEmissioned"),f("rewardClaimed"),y("tokenMint"),y("tokenVault"),y("creator"),w("rewardGrowthGlobalX64")]),fn=S([R(8),N("bump"),y("ammConfig"),y("creator"),y("mintA"),y("mintB"),y("vaultA"),y("vaultB"),y("observationId"),N("mintDecimalsA"),N("mintDecimalsB"),fe("tickSpacing"),w("liquidity"),w("sqrtPriceX64"),H("tickCurrent"),ne(),w("feeGrowthGlobalX64A"),w("feeGrowthGlobalX64B"),f("protocolFeesTokenA"),f("protocolFeesTokenB"),w("swapInAmountTokenA"),w("swapOutAmountTokenB"),w("swapInAmountTokenB"),w("swapOutAmountTokenA"),N("status"),x(N(),7,""),x(pn,3,"rewardInfos"),x(f(),16,"tickArrayBitmap"),f("totalFeesTokenA"),f("totalFeesClaimedTokenA"),f("totalFeesTokenB"),f("totalFeesClaimedTokenB"),f("fundFeesTokenA"),f("fundFeesTokenB"),f("startTime"),x(f(),15*4-3,"padding")]),gn=S([w("growthInsideLastX64"),f("rewardAmountOwed")]),yn=S([R(8),N("bump"),y("nftMint"),y("poolId"),H("tickLower"),H("tickUpper"),w("liquidity"),w("feeGrowthInsideLastX64A"),w("feeGrowthInsideLastX64B"),f("tokenFeesOwedA"),f("tokenFeesOwedB"),x(gn,3,"rewardInfos"),x(f(),8,"")]),pa=S([R(8),N("bump"),y("poolId"),H("tickLowerIndex"),H("tickUpperIndex"),w("liquidity"),w("feeGrowthInsideLastX64A"),w("feeGrowthInsideLastX64B"),f("tokenFeesOwedA"),f("tokenFeesOwedB"),x(w(),3,"rewardGrowthInside"),x(f(),8,"")]),bn=S([H("tick"),St("liquidityNet"),w("liquidityGross"),w("feeGrowthOutsideX64A"),w("feeGrowthOutsideX64B"),x(w(),3,"rewardGrowthsOutsideX64"),x(ne(),13,"")]),Nt=S([R(8),y("poolId"),H("startTickIndex"),x(bn,ke,"ticks"),N("initializedTickCount"),x(N(),115,"")]),fa=S([R(329),x(y(),100,"whitelistMints")]),hn=S([R(8),y("poolId"),x(x(f(),8),ze,"positiveTickArrayBitmap"),x(x(f(),8),ze,"negativeTickArrayBitmap")]),ga=S([f(),N("bump"),y("owner"),y("poolId"),y("positionId"),y("nftAccount"),x(f(),8)]),ya=S([R(8),N("bump"),y("lockOwner"),y("poolId"),y("positionId"),y("nftAccount"),y("lockNftMint"),f("recentEpoch"),x(f(),8)]);var d=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),s=i.div(n);return i.mod(n).eq(F)||(s=s.add(X)),s}static mulDivFloor(e,t,n){if(n.eq(F))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(F))throw new Error("division by 0");return e.mul(t).add(n.sub(X)).div(n)}static x64ToDecimal(e,t){return new K.default(e.toString()).div(K.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new p.default(e.mul(K.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Ae).sub(t).mod(Ae)}};function k(r,e){return je(r.mul(e),64,256)}function Pn(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function je(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var C=class{static sqrtPriceX64ToPrice(e,t,n){return d.x64ToDecimal(e).pow(2).mul(K.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return d.decimalToX64(e.mul(K.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(F))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(F))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(F))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(F))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(F))return e;let s=t.shln(pe);if(i){let o=s,a=s.add(n.mul(e));return a.gte(o)?d.mulDivCeil(o,e,a):d.mulDivRoundingUp(o,X,o.div(e).add(n))}else{let o=n.mul(e);if(!s.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=s.sub(o);return d.mulDivCeil(s,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let s=n.shln(pe);if(i)return e.add(s.div(t));{let o=d.mulDivRoundingUp(s,X,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Y||e>$)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new p.default("18445821805675395072"):new p.default("18446744073709551616");return(t&2)!=0&&(n=k(n,new p.default("18444899583751176192"))),(t&4)!=0&&(n=k(n,new p.default("18443055278223355904"))),(t&8)!=0&&(n=k(n,new p.default("18439367220385607680"))),(t&16)!=0&&(n=k(n,new p.default("18431993317065453568"))),(t&32)!=0&&(n=k(n,new p.default("18417254355718170624"))),(t&64)!=0&&(n=k(n,new p.default("18387811781193609216"))),(t&128)!=0&&(n=k(n,new p.default("18329067761203558400"))),(t&256)!=0&&(n=k(n,new p.default("18212142134806163456"))),(t&512)!=0&&(n=k(n,new p.default("17980523815641700352"))),(t&1024)!=0&&(n=k(n,new p.default("17526086738831433728"))),(t&2048)!=0&&(n=k(n,new p.default("16651378430235570176"))),(t&4096)!=0&&(n=k(n,new p.default("15030750278694412288"))),(t&8192)!=0&&(n=k(n,new p.default("12247334978884435968"))),(t&16384)!=0&&(n=k(n,new p.default("8131365268886854656"))),(t&32768)!=0&&(n=k(n,new p.default("3584323654725218816"))),(t&65536)!=0&&(n=k(n,new p.default("696457651848324352"))),(t&131072)!=0&&(n=k(n,new p.default("26294789957507116"))),(t&262144)!=0&&(n=k(n,new p.default("37481735321082"))),e>0&&(n=bt.div(n)),n}static getTickFromPrice(e,t,n){return C.getTickFromSqrtPriceX64(C.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ge)||e.lt(ve))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new p.default(t-64),i=Pn(n,32,128),s=new p.default("8000000000000000","hex"),o=0,a=new p.default(0),m=t>=64?e.shrn(t-63):e.shln(63-t);for(;s.gt(new p.default(0))&&o<ht;){m=m.mul(m);let W=m.shrn(127);m=m.shrn(63+W.toNumber()),a=a.add(s.mul(W)),s=s.shrn(1),o+=1}let h=a.shrn(32),P=i.add(h).mul(new p.default(Tt)),B=je(P.sub(new p.default(xt)),64,128).toNumber(),O=je(P.add(new p.default(wt)),64,128).toNumber();return B==O?B:C.getSqrtPriceX64FromTick(O).lte(e)?O:B}};var I=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(F))throw new Error("sqrtPriceX64A must greater than 0");let s=n.ushln(pe),o=t.sub(e);return i?d.mulDivRoundingUp(d.mulDivCeil(s,o,t),X,e):d.mulDivFloor(s,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(F))throw new Error("sqrtPriceX64A must greater than 0");return i?d.mulDivCeil(n,t.sub(e),M):d.mulDivFloor(n,t.sub(e),M)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let s=n.mul(e).mul(t),o=t.sub(e),a=s.div(o);return i?d.mulDivRoundingUp(a,X,Ke):a.shrn(pe)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),d.mulDivFloor(n,Ke,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return I.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let o=I.getLiquidityFromTokenAmountA(e,n,i,!1),a=I.getLiquidityFromTokenAmountB(t,e,s);return o.lt(a)?o:a}else return I.getLiquidityFromTokenAmountB(t,n,s)}static getAmountsFromLiquidity(e,t,n,i,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:I.getTokenAmountAFromLiquidity(t,n,i,s),amountB:new p.default(0)};if(e.lt(n)){let o=I.getTokenAmountAFromLiquidity(e,n,i,s),a=I.getTokenAmountBFromLiquidity(t,e,i,s);return{amountA:o,amountB:a}}else return{amountA:new p.default(0),amountB:I.getTokenAmountBFromLiquidity(t,n,i,s)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,s,o,a){let{amountA:m,amountB:h}=I.getAmountsFromLiquidity(e,t,n,i,o),A=s?1+a:1-a,P=new p.default(new K.default(m.toString()).mul(A).toFixed(0)),B=new p.default(new K.default(h.toString()).mul(A).toFixed(0));return{amountSlippageA:P,amountSlippageB:B}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:s,add:o,epochInfo:a,amountAddFee:m}){var re,ie,Ye,Ze;let h=C.priceToSqrtPriceX64(new K.default(e.price),e.mintA.decimals,e.mintB.decimals),A=C.getSqrtPriceX64FromTick(t),P=C.getSqrtPriceX64FromTick(n),B=o?1+s:1-s,O=I.getAmountsFromLiquidity(h,A,P,i,o),[W,ge]=[D(O.amountA,(re=e.mintA.extensions)==null?void 0:re.feeConfig,a,m),D(O.amountB,(ie=e.mintB.extensions)==null?void 0:ie.feeConfig,a,m)],[ye,be]=[D(new p.default(new K.default(O.amountA.toString()).mul(B).toFixed(0)),(Ye=e.mintA.extensions)==null?void 0:Ye.feeConfig,a,m),D(new p.default(new K.default(O.amountB.toString()).mul(B).toFixed(0)),(Ze=e.mintB.extensions)==null?void 0:Ze.feeConfig,a,m)];return{liquidity:i,amountA:W,amountB:ge,amountSlippageA:ye,amountSlippageB:be,expirationTime:de(W.expirationTime,ge.expirationTime)}}};var Be=class{static getfeeGrowthInside(e,t,n){let i=new v.default(0),s=new v.default(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,s=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new v.default(0),a=new v.default(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let m=d.wrappingSubU128(d.wrappingSubU128(e.feeGrowthGlobalX64A,i),o),h=d.wrappingSubU128(d.wrappingSubU128(e.feeGrowthGlobalX64B,s),a);return{feeGrowthInsideX64A:m,feeGrowthInsideBX64:h}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),a=d.mulDivFloor(d.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,M),m=t.tokenFeesOwedA.add(a),h=d.mulDivFloor(d.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,M),A=t.tokenFeesOwedB.add(h);return{tokenFeeAmountA:m,tokenFeeAmountB:A}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,i),a=d.mulDivFloor(d.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,M),m=t.tokenFeesOwedA.add(a),h=d.mulDivFloor(d.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,M),A=t.tokenFeesOwedB.add(h);return{tokenFeeAmountA:m,tokenFeeAmountB:A}}static GetPositionRewardsV2(e,t,n,i){let s=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<o.length;a++){let m=o[a],h=t.rewardInfos[a],A=d.wrappingSubU128(m,h.growthInsideLastX64),P=d.mulDivFloor(A,t.liquidity,M),B=h.rewardAmountOwed.add(P);s.push(B)}return s}static GetPositionRewards(e,t,n,i){let s=[],o=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<o.length;a++){let m=o[a],h=t.rewardInfos[a],A=d.wrappingSubU128(m,h.growthInsideLastX64),P=d.mulDivFloor(A,t.liquidity,M),B=h.rewardAmountOwed.add(P);s.push(B)}return s}static getRewardGrowthInside(e,t,n,i){let s=[];for(let o=0;o<i.length;o++){let a=new v.default(0);t.liquidityGross.eqn(0)?a=i[o].rewardGrowthGlobalX64:e<t.tick?a=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):a=t.rewardGrowthsOutsideX64[o];let m=new v.default(0);n.liquidityGross.eqn(0)||(e<n.tick?m=n.rewardGrowthsOutsideX64[o]:m=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(d.wrappingSubU128(d.wrappingSubU128(i[o].rewardGrowthGlobalX64,a),m))}return s}static getRewardGrowthInsideV2(e,t,n,i){let s=[];for(let o=0;o<i.length;o++){let a=new v.default(0);t.liquidityGross.eqn(0)?a=i[o].rewardGrowthGlobalX64:e<t.tick?a=i[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):a=t.rewardGrowthsOutsideX64[o];let m=new v.default(0);n.liquidityGross.eqn(0)||(e<n.tick?m=n.rewardGrowthsOutsideX64[o]:m=i[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(d.wrappingSubU128(d.wrappingSubU128(i[o].rewardGrowthGlobalX64,a),m))}return s}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:s,epochInfo:o}){var ye,be,re,ie;let a=C.priceToSqrtPriceX64(new Ie.default(e.price),e.mintA.decimals,e.mintB.decimals),m=C.getSqrtPriceX64FromTick(t.tickLower),h=C.getSqrtPriceX64FromTick(t.tickUpper),A=s?1+i:1-i,P=I.getAmountsFromLiquidity(a,m,h,n,s),[B,O]=[D(P.amountA,(ye=e.mintA.extensions)==null?void 0:ye.feeConfig,o,!0),D(P.amountB,(be=e.mintB.extensions)==null?void 0:be.feeConfig,o,!0)],[W,ge]=[D(new v.default(new Ie.default(P.amountA.toString()).mul(A).toFixed(0)),(re=e.mintA.extensions)==null?void 0:re.feeConfig,o,!0),D(new v.default(new Ie.default(P.amountB.toString()).mul(A).toFixed(0)),(ie=e.mintB.extensions)==null?void 0:ie.feeConfig,o,!0)];return{liquidity:n,amountA:B,amountB:O,amountSlippageA:W,amountSlippageB:ge,expirationTime:de(B.expirationTime,O.expirationTime)}}};0&&(module.exports={PositionUtils});
//# sourceMappingURL=position.js.map