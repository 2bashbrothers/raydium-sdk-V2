var kn=Object.create;var ve=Object.defineProperty,Bn=Object.defineProperties,In=Object.getOwnPropertyDescriptor,Sn=Object.getOwnPropertyDescriptors,Cn=Object.getOwnPropertyNames,Dt=Object.getOwnPropertySymbols,Nn=Object.getPrototypeOf,vt=Object.prototype.hasOwnProperty,Ln=Object.prototype.propertyIsEnumerable;var Kt=(u,e,t)=>e in u?ve(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,O=(u,e)=>{for(var t in e||(e={}))vt.call(e,t)&&Kt(u,t,e[t]);if(Dt)for(var t of Dt(e))Ln.call(e,t)&&Kt(u,t,e[t]);return u},G=(u,e)=>Bn(u,Sn(e));var Rn=(u,e)=>{for(var t in e)ve(u,t,{get:e[t],enumerable:!0})},Gt=(u,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Cn(e))!vt.call(u,r)&&r!==t&&ve(u,r,{get:()=>e[r],enumerable:!(n=In(e,r))||n.enumerable});return u};var K=(u,e,t)=>(t=u!=null?kn(Nn(u)):{},Gt(e||!u||!u.__esModule?ve(t,"default",{value:u,enumerable:!0}):t,u)),_n=u=>Gt(ve({},"__esModule",{value:!0}),u);var ur={};Rn(ur,{LiquidityMath:()=>L,MathUtil:()=>P,SqrtPriceMath:()=>w,SwapMath:()=>Se,TickMath:()=>Ie});module.exports=_n(ur);var k=K(require("bn.js")),ge=K(require("decimal.js"));var me=K(require("bn.js")),Ge=1e4;function U(u,e,t,n){if(e===void 0)return{amount:u,fee:void 0,expirationTime:void 0};let r=G(O({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),s=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,o=new me.default(s.maximumFee.toString()),i=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(s.transferFeeBasisPoints===Ge){let a=new me.default(s.maximumFee.toString());return{amount:u.add(a),fee:a,expirationTime:i}}else{let a=lt(u.mul(new me.default(Ge)),new me.default(Ge-s.transferFeeBasisPoints)),c=new me.default(s.maximumFee.toString()),l=a.sub(u).gt(c)?u.add(c):a,d=lt(l.mul(new me.default(s.transferFeeBasisPoints)),new me.default(Ge)),p=d.gt(o)?o:d;return{amount:l,fee:p,expirationTime:i}}else{let a=lt(u.mul(new me.default(s.transferFeeBasisPoints)),new me.default(Ge)),c=a.gt(o)?o:a;return{amount:u,fee:c,expirationTime:i}}}function Ae(u,e){return u===void 0?e:e===void 0?u:Math.min(u,e)}function lt(u,e){let{div:t,mod:n}=u.divmod(e);return n.gt(new me.default(0))?t.add(new me.default(1)):t}var oe=K(require("bn.js")),W=new oe.default(0),ye=new oe.default(1),Te=new oe.default(-1),se=new oe.default(1).shln(64),tt=new oe.default(1).shln(128),dt=se.sub(ye),qe=64,qt=tt.subn(1),J=-443636,$=-J,Ce=new oe.default("4295048016"),Ne=new oe.default("79226673521066979257578248091"),lr=new oe.default("4295048017"),dr=new oe.default("79226673521066979257578248090"),Vt=16,Ut="59543866431248",Wt="184467440737095516",Xt="15793534762490258745",nt=new oe.default(10).pow(new oe.default(6));var pr=new oe.default("18446744073700000000");var zt=require("@solana/web3.js");var Ve=require("lodash");var pt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ht={},En={};function ae(u){let e=(0,Ve.get)(Ht,u);if(!e){let t=(0,Ve.get)(En,u);e=new pt({name:u,logLevel:t}),(0,Ve.set)(Ht,u,e)}return e}var rt=require("@solana/spl-token"),ft=ae("Raydium_accountInfo_util");async function Pe(u,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:s=100}=O({batchRequest:!1},t),o=gt(e,s),i=new Array(o.length).fill([]);if(n){let a=o.map(d=>{let p=u._buildArgs([d.map(m=>m.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:p}}),c=gt(a,10);i=(await(await Promise.all(c.map(async d=>await u._rpcBatchRequest(d)))).flat()).map(d=>(d.error&&ft.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.error.message}`),d.result.value.map(p=>{if(p){let{data:m,executable:y,lamports:g,owner:T,rentEpoch:f}=p;return m.length!==2&&m[1]!=="base64"&&ft.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:y,lamports:g,owner:new zt.PublicKey(T),rentEpoch:f}}return null})))}else try{i=await Promise.all(o.map(a=>u.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&ft.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return i.flat()}async function yt(u,e,t){let n=await Pe(u,e.map(r=>r.pubkey),t);return e.map((r,s)=>G(O({},r),{accountInfo:n[s]}))}var be=K(require("bn.js")),Un=K(require("decimal.js"));var $t=K(require("big.js")),He=K(require("bn.js"));var jt=K(require("toformat")),Fn=jt.default,Ue=Fn;var We=K(require("big.js")),Zt=K(require("bn.js")),Jt=K(require("decimal.js-light"));var Fe=K(require("bn.js"));var Yt=9007199254740991;function ue(u){let e=ae("Raydium_parseBigNumberish");if(u instanceof Fe.default)return u;if(typeof u=="string"){if(u.match(/^-?[0-9]+$/))return new Fe.default(u);e.logWithError(`invalid BigNumberish string: ${u}`)}return typeof u=="number"?(u%1&&e.logWithError(`BigNumberish number underflow: ${u}`),(u>=Yt||u<=-Yt)&&e.logWithError(`BigNumberish number overflow: ${u}`),new Fe.default(String(u))):typeof u=="bigint"?new Fe.default(u.toString()):(e.error(`invalid BigNumberish value: ${u}`),new Fe.default(0))}var ot=ae("module/fraction"),ht=Ue(We.default),Xe=Ue(Jt.default),On={[0]:Xe.ROUND_DOWN,[1]:Xe.ROUND_HALF_UP,[2]:Xe.ROUND_UP},Dn={[0]:We.default.roundDown,[1]:We.default.roundHalfUp,[2]:We.default.roundUp},_=class{constructor(e,t=new Zt.default(1)){this.numerator=ue(e),this.denominator=ue(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new _(this.denominator,this.numerator)}add(e){let t=e instanceof _?e:new _(ue(e));return this.denominator.eq(t.denominator)?new _(this.numerator.add(t.numerator),this.denominator):new _(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof _?e:new _(ue(e));return this.denominator.eq(t.denominator)?new _(this.numerator.sub(t.numerator),this.denominator):new _(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof _?e:new _(ue(e));return new _(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof _?e:new _(ue(e));return new _(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||ot.logWithError(`${e} is not an integer.`),e<=0&&ot.logWithError(`${e} is not positive.`),Xe.set({precision:e+1,rounding:On[n]});let r=new Xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||ot.logWithError(`${e} is not an integer.`),e<0&&ot.logWithError(`${e} is negative.`),ht.DP=e,ht.RM=Dn[n]||1,new ht(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Kn=ae("Raydium_amount"),Qt=Ue($t.default);function vn(u,e){let t="0",n="0";if(u.includes(".")){let r=u.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Kn.logWithError(`invalid number string, num: ${u}`)}else t=u;return[t,n.slice(0,e)||n]}var Q=class extends _{constructor(t,n,r=!0,s){let o=new He.default(0),i=Tt.pow(new He.default(t.decimals));if(r)o=ue(n);else{let a=new He.default(0),c=new He.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=vn(n.toString(),t.decimals);a=ue(l),c=ue(d)}a=a.mul(i),o=a.add(c)}super(o,i);this.logger=ae(s||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Q(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Q(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Qt.DP=this.token.decimals,new Qt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var en=require("@solana/web3.js"),xt=require("@solana/spl-token"),tn={chainId:101,address:en.PublicKey.default.toBase58(),programId:xt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:xt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var st=require("@solana/web3.js");var E=require("@solana/web3.js"),nn=require("@solana/spl-token");function wt({pubkey:u,isSigner:e=!1,isWritable:t=!0}){return{pubkey:u,isWritable:t,isSigner:e}}var qr=[wt({pubkey:nn.TOKEN_PROGRAM_ID,isWritable:!1}),wt({pubkey:E.SystemProgram.programId,isWritable:!1}),wt({pubkey:E.SYSVAR_RENT_PUBKEY,isWritable:!1})];function At({publicKey:u,transformSol:e}){let t=rn(u.toString());if(t instanceof E.PublicKey)return e&&t.equals(ze)?bt:t;if(e&&t.toString()===ze.toBase58())return bt;if(typeof t=="string"){if(t===E.PublicKey.default.toBase58())return E.PublicKey.default;try{return new E.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function rn(u){try{return new E.PublicKey(u)}catch{return u}}var Vr=new E.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ur=new E.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Wr=new E.PublicKey("SysvarRent111111111111111111111111111111111"),Xr=new E.PublicKey("SysvarC1ock11111111111111111111111111111111"),Gn=new E.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Hr=new E.PublicKey("Sysvar1nstructions1111111111111111111111111"),zr=E.SystemProgram.programId,jr=new E.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Yr=new E.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Zr=new E.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Jr=new E.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Qr=new E.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),$r=new E.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ei=new E.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ti=new E.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ni=new E.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ri=new E.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ii=new E.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),bt=new E.PublicKey("So11111111111111111111111111111111111111112"),ze=E.PublicKey.default;function it(u){return At({publicKey:u,transformSol:!0})}var Pt=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:s=!1,isToken2022:o=!1}){if(e===ze.toBase58()||e instanceof st.PublicKey&&ze.equals(e)){this.decimals=Le.decimals,this.symbol=Le.symbol,this.name=Le.name,this.mint=new st.PublicKey(Le.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=s?st.PublicKey.default:At({publicKey:e}),this.isToken2022=o}equals(e){return this===e?!0:this.mint.equals(e.mint)}},xe=Pt;xe.WSOL=new Pt(G(O({},Le),{mint:Le.address}));var kt=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},at=kt;at.SOL=new kt(tn);var sn=K(require("bn.js"));var on=new _(new sn.default(100)),ke=class extends _{toSignificant(e=5,t,n){return this.mul(on).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(on).toFixed(e,t,n)}};var qn=ae("Raydium_price"),de=class extends _{constructor(t){let{baseToken:n,quoteToken:r,numerator:s,denominator:o}=t;super(s,o);this.baseToken=n,this.quoteToken=r,this.scalar=new _(Bt(n.decimals),Bt(r.decimals))}get raw(){return new _(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new de({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&qn.logWithError("mul token not equals");let n=super.mul(t);return new de({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Vn=new be.default(0),Ui=new be.default(1),Wi=new be.default(2),Xi=new be.default(3),Hi=new be.default(5),Tt=new be.default(10),zi=new be.default(100),ji=new be.default(1e3),Yi=new be.default(1e4);function Bt(u){return Tt.pow(ue(u))}function gt(u,e=1,t=[]){let n=[...u];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Hn=require("@solana/web3.js"),zn=require("@solana/spl-token");var Re=require("@solana/web3.js");var Xn=require("@solana/spl-token"),uo=ae("Raydium_txUtil");function je(u,e){let[t,n]=Re.PublicKey.findProgramAddressSync(u,e);return{publicKey:t,nonce:n}}var b=require("@solana/web3.js"),po=new b.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),fo=new b.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),go=new b.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),yo=new b.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),bo=new b.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ho=new b.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),To=new b.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),xo=new b.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),wo=new b.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ao=new b.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Po=new b.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ko=new b.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Bo=new b.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Io=new b.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),So=new b.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Co=new b.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),No=new b.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Lo=new b.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ro=new b.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),_o=new b.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Eo=new b.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Fo=new b.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Mo=new b.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Oo=new b.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Do=new b.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ko=new b.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),vo=new b.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Go=new b.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),qo=new b.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Vo=new b.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Uo=new b.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Wo={OPEN_BOOK_PROGRAM:new b.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new b.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new b.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new b.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new b.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new b.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new b.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new b.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new b.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new b.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new b.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new b.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:b.PublicKey.default,Router:new b.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new b.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new b.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new b.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new b.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new b.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new b.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new b.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new b.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new b.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new b.PublicKey("Ray1111111111111111111111111111111111111111")};var an=require("@solana/web3.js");var Me=require("@solana/web3.js"),jn=K(require("axios"));var Yn=require("@solana/web3.js"),Zn=K(require("bn.js"));var un=K(require("bn.js")),ws=new un.default(1e6);function cn(u){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,u,!1),new Uint8Array(e)}function It(u,e){let t=0;for(let n=u-1;n>=0&&!e.testn(n);n--)t++;return t}function St(u,e){let t=0;for(let n=0;n<u&&!e.testn(n);n++)t++;return t}function Ye(u,e){for(let t=0;t<u;t++)if(e.testn(t))return!1;return!0}function mn(u,e){return Ye(u,e)?null:It(u,e)}function ln(u,e){return Ye(u,e)?null:St(u,e)}var Hs=Buffer.from("amm_config","utf8"),zs=Buffer.from("pool","utf8"),js=Buffer.from("pool_vault","utf8"),Ys=Buffer.from("pool_reward_vault","utf8"),Jn=Buffer.from("position","utf8"),Qn=Buffer.from("tick_array","utf8"),Zs=Buffer.from("operation","utf8"),$n=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Js=Buffer.from("observation","utf8");function ee(u,e,t){return je([Qn,e.toBuffer(),cn(t)],u)}function dn(u,e){return je([Jn,e.toBuffer()],u)}function ut(u,e){return je([$n,e.toBuffer()],u)}var Qs=Buffer.from("locked_position","utf8");var $s=Buffer.from("support_mint","utf8");var re=require("@solana/web3.js"),_t=require("@solana/spl-token"),M=K(require("bn.js")),S=K(require("decimal.js"));var yn=require("@solana/web3.js"),Oe=K(require("bn.js"));var h=require("@solana/buffer-layout"),Ct=h.Layout,pn=h.Structure;var Nt=h.UInt;var fn=h.u8,Ze=h.u16;var Be=h.s32;var gn=h.seq;var ce=h.blob;var De=class extends Ct{constructor(t,n,r){super(t,r);this.blob=ce(t),this.signed=n}decode(t,n=0){let r=new Oe.default(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Oe.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function ne(u){return new Nt(1,u)}function Ke(u){return new Nt(4,u)}function C(u){return new De(8,!1,u)}function q(u){return new De(16,!1,u)}function bn(u){return new De(8,!0,u)}function hn(u){return new De(16,!0,u)}var ct=class extends Ct{constructor(t,n,r,s){super(t.span,s);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function F(u){return new ct(ce(32),e=>new yn.PublicKey(e),e=>e.toBuffer(),u)}function Tn(u){return new ct(fn(),er,tr,u)}function er(u){if(u===0)return!1;if(u===1)return!0;throw new Error("Invalid bool: "+u)}function tr(u){return u?1:0}var Lt=class extends pn{decode(e,t){return super.decode(e,t)}};function te(u,e,t){return new Lt(u,e,t)}function v(u,e,t){let n,r=typeof e=="number"?e:(0,Oe.isBN)(e)?e.toNumber():new Proxy(e,{get(s,o){if(!n){let i=Reflect.get(s,"count");n=(0,Oe.isBN)(i)?i.toNumber():i,Reflect.set(s,"count",n)}return Reflect.get(s,o)},set(s,o,i){return o==="count"&&(n=i),Reflect.set(s,o,i)}});return gn(u,r,t)}var xn=K(require("bn.js")),_e=K(require("decimal.js"));var nr=15,N=class{static async getTickArrays(e,t,n,r,s,o,i){let a=[],c=A.getTickArrayStartIndexByTick(r,s),l=A.getInitializedTickArrayInRange(o,i,s,c,Math.floor(nr/2));for(let m=0;m<l.length;m++){let{publicKey:y}=ee(t,n,l[m]);a.push(y)}let d=(await Pe(e,a)).map(m=>m!==null?Je.decode(m.data):null),p={};for(let m=0;m<a.length;m++){let y=d[m];y!==null&&(p[y.startTickIndex]=G(O({},y),{address:a[m]}))}return p}static nextInitializedTick(e,t,n,r,s,o){let{initializedTick:i,tickArrayAddress:a,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,s,o);for(;i==null||i.liquidityGross.lten(0);){if(c=A.getNextTickArrayStartIndex(c,s,o),this.checkIsValidStartIndex(c,s))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:d,tickArrayAddress:p,tickArrayStartTickIndex:m}=this.firstInitializedTickInOneArray(e,t,l,o);[i,a,c]=[d,p,m]}if(i==null)throw new Error("No invaild tickArray cache");return{nextTick:i,tickArrayAddress:a,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,s){let o=Math.floor(e/N.tickCount(t)),i=n?A.searchLowBitFromStart(r,s,o-1,1,t):A.searchHightBitFromStart(r,s,o+1,1,t);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let s;if(r){let i=z-1;for(;i>=0;){let a=n.ticks[i];if(a.liquidityGross.gtn(0)){s=a;break}i=i-1}}else{let i=0;for(;i<z;){let a=n.ticks[i];if(a.liquidityGross.gtn(0)){s=a;break}i=i+1}}let{publicKey:o}=ee(e,t,n.startTickIndex);return{nextTick:s,tickArrayAddress:o,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,s,o){let i=A.getTickArrayStartIndexByTick(r,s),a=Math.floor((r-i)/s),c=n[i];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:i};let l;if(o)for(;a>=0;){let p=c.ticks[a];if(p.liquidityGross.gtn(0)){l=p;break}a=a-1}else for(a=a+1;a<z;){let p=c.ticks[a];if(p.liquidityGross.gtn(0)){l=p;break}a=a+1}let{publicKey:d}=ee(e,t,i);return{initializedTick:l,tickArrayAddress:d,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(A.checkIsOutOfBoundary(e)){if(e>$)return!1;let n=A.getTickArrayStartIndexByTick(J,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return z*e}};var z=60,Ee=512,A=class{static getTickArrayAddressByTick(e,t,n,r){let s=A.getTickArrayStartIndexByTick(n,r),{publicKey:o}=ee(e,t,s);return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=A.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=z)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=N.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*N.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*z,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*z,s=Math.floor(t/r)+512,o=Math.abs(s);return{isInitialized:e.testn(o),startIndex:(o-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*z:e+t*z}static mergeTickArrayBitmap(e){let t=new xn.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,s){let o=Math.floor(r/(n*z));return[...A.searchLowBitFromStart(e,t,o-1,s,n),...A.searchHightBitFromStart(e,t,o,s,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return A.searchHightBitFromStart(e,t,-7680,Ee,n)}static getAllInitializedTickArrayInfo(e,t,n,r,s){let o=[],i=A.getAllInitializedTickArrayStartIndex(n,r,s);for(let a of i){let{publicKey:c}=ee(e,t,a);o.push({tickArrayStartIndex:a,tickArrayAddress:c})}return o}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,s){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>A.mergeTickArrayBitmap(c)),i=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(o[c].testn(l)&&i.push(n),n--,i.length===r)break}let a=N.tickCount(s);return i.map(c=>c*a)}static searchHightBitFromStart(e,t,n,r,s){let o=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>A.mergeTickArrayBitmap(c)),i=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(o[c].testn(l)&&i.push(n),n++,i.length===r)break}let a=N.tickCount(s);return i.map(c=>c*a)}static checkIsOutOfBoundary(e){return e<J||e>$}static nextInitTick(e,t,n,r,s){if(N.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let i=Math.floor((t-e.startTickIndex)/n);if(r)for(;i>=0;){if(e.ticks[i].liquidityGross.gtn(0))return e.ticks[i];i=i-1}else for(s||(i=i+1);i<z;){if(e.ticks[i].liquidityGross.gtn(0))return e.ticks[i];i=i+1}return null}static firstInitializedTick(e,t){if(t){let n=z-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<z;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=w.getSqrtPriceX64FromTick(t),s=w.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new _e.default(1).div(s),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new _e.default(1).div(t),s=Ie.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=w.getSqrtPriceX64FromTick(s),i=w.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:i}:{tick:s,price:new _e.default(1).div(i)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=w.getSqrtPriceX64FromTick(t),s=w.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:r}:{tick:t,price:new _e.default(1).div(s),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new _e.default(1).div(t),s=Ie.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),o=w.getSqrtPriceX64FromTick(s),i=w.sqrtPriceX64ToPrice(o,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:i}:{tick:s,price:new _e.default(1).div(i)}}};var Rt=14,we=class{static maxTickInTickarrayBitmap(e){return e*z*Ee}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let s=n*r;return e<0?{minValue:-s,maxValue:-s+n}:{minValue:s,maxValue:s+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!N.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let s=this.maxTickInTickarrayBitmap(n),o=r?t-N.tickCount(n):t+N.tickCount(n);if(o<-s||o>=s)return{isInit:!1,tickIndex:t};let i=n*z,a=o/i+512;o<0&&o%i!=0&&a--;let c=Math.abs(a);if(r){let l=e.shln(1024-c-1),d=mn(1024,l);if(d!==null){let p=(c-d-512)*i;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-s}}else{let l=e.shrn(c),d=ln(1024,l);if(d!==null){let p=(c+d-512)*i;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:s-N.tickCount(n)}}}},Qe=class{static getBitmapOffset(e,t){if(!N.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=we.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=we.maxTickInTickarrayBitmap(e),n=-t;if($<=t)throw Error(`extensionTickBoundary check error: ${$}, ${t}`);if(n<=J)throw Error(`extensionTickBoundary check error: ${n}, ${J}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),s=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:A.mergeTickArrayBitmap(r).testn(s),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let s=N.tickCount(t),o=n?e-s:e+s,{tickarrayBitmap:i}=this.getBitmap(o,t,r);return this.nextInitializedTickArrayInBitmap(i,o,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:s,maxValue:o}=we.getBitmapTickBoundary(t,n),i=this.tickArrayOffsetInBitmap(t,n);if(r){let a=A.mergeTickArrayBitmap(e).shln(Ee-1-i),c=Ye(512,a)?null:It(512,a);if(c!==null){let l=t-c*N.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s}}else{let a=A.mergeTickArrayBitmap(e).shrn(i),c=Ye(512,a)?null:St(512,a);if(c!==null){let l=t+c*N.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o-N.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%we.maxTickInTickarrayBitmap(t),r=Math.floor(n/N.tickCount(t));return e<0&&n!=0&&(r=Ee-r),r}};var _a=te([ce(8),ne("bump"),Ze("index"),F(""),Ke("protocolFeeRate"),Ke("tradeFeeRate"),Ze("tickSpacing"),v(C(),8,"")]),rr=te([Ke("blockTimestamp"),bn("tickCumulative"),v(C(),4)]),Ea=te([ce(8),Tn("initialized"),C("recentEpoch"),Ze("observationIndex"),F("poolId"),v(rr,100,"observations"),v(C(),4)]),ir=te([ne("rewardState"),C("openTime"),C("endTime"),C("lastUpdateTime"),q("emissionsPerSecondX64"),C("rewardTotalEmissioned"),C("rewardClaimed"),F("tokenMint"),F("tokenVault"),F("creator"),q("rewardGrowthGlobalX64")]),wn=te([ce(8),ne("bump"),F("ammConfig"),F("creator"),F("mintA"),F("mintB"),F("vaultA"),F("vaultB"),F("observationId"),ne("mintDecimalsA"),ne("mintDecimalsB"),Ze("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),Be("tickCurrent"),Ke(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),C("protocolFeesTokenA"),C("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),ne("status"),v(ne(),7,""),v(ir,3,"rewardInfos"),v(C(),16,"tickArrayBitmap"),C("totalFeesTokenA"),C("totalFeesClaimedTokenA"),C("totalFeesTokenB"),C("totalFeesClaimedTokenB"),C("fundFeesTokenA"),C("fundFeesTokenB"),C("startTime"),v(C(),15*4-3,"padding")]),or=te([q("growthInsideLastX64"),C("rewardAmountOwed")]),An=te([ce(8),ne("bump"),F("nftMint"),F("poolId"),Be("tickLower"),Be("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),C("tokenFeesOwedA"),C("tokenFeesOwedB"),v(or,3,"rewardInfos"),v(C(),8,"")]),Fa=te([ce(8),ne("bump"),F("poolId"),Be("tickLowerIndex"),Be("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),C("tokenFeesOwedA"),C("tokenFeesOwedB"),v(q(),3,"rewardGrowthInside"),v(C(),8,"")]),sr=te([Be("tick"),hn("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),v(q(),3,"rewardGrowthsOutsideX64"),v(Ke(),13,"")]),Je=te([ce(8),F("poolId"),Be("startTickIndex"),v(sr,z,"ticks"),ne("initializedTickCount"),v(ne(),115,"")]),Ma=te([ce(329),v(F(),100,"whitelistMints")]),Pn=te([ce(8),F("poolId"),v(v(C(),8),Rt,"positiveTickArrayBitmap"),v(v(C(),8),Rt,"negativeTickArrayBitmap")]),Oa=te([C(),ne("bump"),F("owner"),F("poolId"),F("positionId"),F("nftAccount"),v(C(),8)]),Da=te([ce(8),ne("bump"),F("lockOwner"),F("poolId"),F("positionId"),F("nftAccount"),F("lockNftMint"),C("recentEpoch"),v(C(),8)]);var pe=K(require("bn.js")),mt=K(require("decimal.js"));var $e=class{static getfeeGrowthInside(e,t,n){let r=new pe.default(0),s=new pe.default(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,s=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let o=new pe.default(0),i=new pe.default(0);e.tickCurrent<n.tick?(o=n.feeGrowthOutsideX64A,i=n.feeGrowthOutsideX64B):(o=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),i=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let a=P.wrappingSubU128(P.wrappingSubU128(e.feeGrowthGlobalX64A,r),o),c=P.wrappingSubU128(P.wrappingSubU128(e.feeGrowthGlobalX64B,s),i);return{feeGrowthInsideX64A:a,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,r),i=P.mulDivFloor(P.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,se),a=t.tokenFeesOwedA.add(i),c=P.mulDivFloor(P.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,se),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:a,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:s,feeGrowthInsideBX64:o}=this.getfeeGrowthInside(e,n,r),i=P.mulDivFloor(P.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,se),a=t.tokenFeesOwedA.add(i),c=P.mulDivFloor(P.wrappingSubU128(o,t.feeGrowthInsideLastX64B),t.liquidity,se),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:a,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let s=[],o=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let i=0;i<o.length;i++){let a=o[i],c=t.rewardInfos[i],l=P.wrappingSubU128(a,c.growthInsideLastX64),d=P.mulDivFloor(l,t.liquidity,se),p=c.rewardAmountOwed.add(d);s.push(p)}return s}static GetPositionRewards(e,t,n,r){let s=[],o=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let i=0;i<o.length;i++){let a=o[i],c=t.rewardInfos[i],l=P.wrappingSubU128(a,c.growthInsideLastX64),d=P.mulDivFloor(l,t.liquidity,se),p=c.rewardAmountOwed.add(d);s.push(p)}return s}static getRewardGrowthInside(e,t,n,r){let s=[];for(let o=0;o<r.length;o++){let i=new pe.default(0);t.liquidityGross.eqn(0)?i=r[o].rewardGrowthGlobalX64:e<t.tick?i=r[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):i=t.rewardGrowthsOutsideX64[o];let a=new pe.default(0);n.liquidityGross.eqn(0)||(e<n.tick?a=n.rewardGrowthsOutsideX64[o]:a=r[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(P.wrappingSubU128(P.wrappingSubU128(r[o].rewardGrowthGlobalX64,i),a))}return s}static getRewardGrowthInsideV2(e,t,n,r){let s=[];for(let o=0;o<r.length;o++){let i=new pe.default(0);t.liquidityGross.eqn(0)?i=r[o].rewardGrowthGlobalX64:e<t.tick?i=r[o].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[o]):i=t.rewardGrowthsOutsideX64[o];let a=new pe.default(0);n.liquidityGross.eqn(0)||(e<n.tick?a=n.rewardGrowthsOutsideX64[o]:a=r[o].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[o])),s.push(P.wrappingSubU128(P.wrappingSubU128(r[o].rewardGrowthGlobalX64,i),a))}return s}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:s,epochInfo:o}){var T,f,I,R;let i=w.priceToSqrtPriceX64(new mt.default(e.price),e.mintA.decimals,e.mintB.decimals),a=w.getSqrtPriceX64FromTick(t.tickLower),c=w.getSqrtPriceX64FromTick(t.tickUpper),l=s?1+r:1-r,d=L.getAmountsFromLiquidity(i,a,c,n,s),[p,m]=[U(d.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,o,!0),U(d.amountB,(f=e.mintB.extensions)==null?void 0:f.feeConfig,o,!0)],[y,g]=[U(new pe.default(new mt.default(d.amountA.toString()).mul(l).toFixed(0)),(I=e.mintA.extensions)==null?void 0:I.feeConfig,o,!0),U(new pe.default(new mt.default(d.amountB.toString()).mul(l).toFixed(0)),(R=e.mintB.extensions)==null?void 0:R.feeConfig,o,!0)];return{liquidity:n,amountA:p,amountB:m,amountSlippageA:y,amountSlippageB:g,expirationTime:Ae(p.expirationTime,m.expirationTime)}}};var fe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,s,o=!1){let i=n.toBase58()===e.mintA.address,a=[],{isExist:c,startIndex:l,nextAccountMeta:d}=this.getFirstInitializedTickArray(e,i);if(!c||l===void 0||!d)throw new Error("Invalid tick array");a.push(d);let{allTrade:p,amountCalculated:m,accounts:y,sqrtPriceX64:g,feeAmount:T}=Se.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,i,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,s,o);return a.push(...y),{allTrade:p,expectedAmountOut:m.mul(Te),remainingAccounts:a,executionPrice:g,feeAmount:T}}static getInputAmountAndRemainAccounts(e,t,n,r,s){let o=n.toBase58()===e.mintB.address,i=[],{isExist:a,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,o);if(!a||c===void 0||!l)throw new Error("Invalid tick array");try{let g=this.preInitializedTickArrayStartIndex(e,o);if(g.isExist){let{publicKey:T}=ee(e.programId,e.id,g.nextStartIndex);i.push(T)}}catch{}i.push(l);let{amountCalculated:d,accounts:p,sqrtPriceX64:m,feeAmount:y}=Se.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Te),c,s);return i.push(...p),{expectedAmountIn:d,remainingAccounts:i,executionPrice:m,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=fe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Qe.checkTickArrayIsInit(N.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):A.checkTickArrayIsInitialized(A.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:i}=ee(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:i}}let{isExist:s,nextStartIndex:o}=this.nextInitializedTickArrayStartIndex(e,N.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(s){let{publicKey:i}=ee(e.programId,e.id,o);return{isExist:!0,startIndex:o,nextAccountMeta:i}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/N.tickCount(e.tickSpacing)),r=t?A.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):A.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=N.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:s}=we.nextInitializedTickArrayStartIndex(A.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:s};t=s;let{isInit:o,tickIndex:i}=Qe.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(o)return{isExist:!0,nextStartIndex:i};if(t=i,t<J||t>$)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:s}){var i,a,c;let o=[];for(let l=0;l<s.length;l++){let d=s[l],p=(c=(i=t.rewardDefaultInfos[l])==null?void 0:i.mint.programId)!=null?c:(a=await e.getAccountInfo(d.tokenMint))==null?void 0:a.owner;if(p===void 0)throw Error("get new reward mint info error");let m=G(O({},d),{perSecond:P.x64ToDecimal(d.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new re.PublicKey(p)});if(m.tokenMint.equals(re.PublicKey.default))continue;if(n<=m.openTime.toNumber()||r.eq(W)){o.push(m);continue}let y=new M.default(Math.min(m.endTime.toNumber(),n)),g=y.sub(m.lastUpdateTime),T=P.mulDivFloor(g,m.emissionsPerSecondX64,r),f=m.rewardGrowthGlobalX64.add(T),I=P.mulDivFloor(g,m.emissionsPerSecondX64,se),R=m.rewardTotalEmissioned.add(I);o.push(G(O({},m),{rewardGrowthGlobalX64:f,rewardTotalEmissioned:R,lastUpdateTime:y}))}return o}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let s of t){let o=A.getTickArrayStartIndexByTick(s,e);if(o>=n||o<r)return!0}return!1}static tickRange(e){let t=we.maxTickInTickarrayBitmap(e),n=-t;return t>$&&(t=N.getArrayStartIndex($,e)+N.tickCount(e)),n<J&&(n=N.getArrayStartIndex(J,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!N.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/N.tickCount(t)*Ee}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await yt(e,t.map(o=>({pubkey:o})),{batchRequest:n}),s={};for(let o of r)o.accountInfo!==null&&(s[o.pubkey.toString()]=Pn.decode(o.accountInfo.data));return s}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},s=[];for(let a of t){let c=A.getTickArrayStartIndexByTick(a.tickCurrent,a.tickSpacing),l=A.getInitializedTickArrayInRange(a.tickArrayBitmap,a.exBitmapInfo,a.tickSpacing,c,7);for(let d of l){let{publicKey:p}=ee(a.programId,a.id,d);s.push({pubkey:p}),r[p.toString()]=a.id}}let o=await yt(e,s,{batchRequest:n}),i={};for(let a of o){if(!a.accountInfo)continue;let c=r[a.pubkey.toString()];if(!c)continue;i[c.toString()]===void 0&&(i[c.toString()]={});let l=Je.decode(a.accountInfo.data);i[c.toString()][l.startTickIndex]=G(O({},l),{address:a.pubkey})}return i}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:s=!0}){var i;let o=[];for(let a=0;a<e.length;a++){let c=e[a];c!==null&&(o.find(l=>l.equals(c.state.programId))||o.push(c.state.programId))}if(n){let a=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of a)for(let m of o)c.push(dn(m,p).publicKey);let l=await Pe(t,c,{batchRequest:r}),d={};for(let p of l){if(p===null)continue;let m=An.decode(p.data),y=m.poolId.toString(),g=e.find(D=>D.state.id.toBase58()===y);if(g===void 0)continue;let T=g.state,f=A._getTickPriceLegacy({poolInfo:T,tick:m.tickLower,baseIn:!0}),I=A._getTickPriceLegacy({poolInfo:T,tick:m.tickUpper,baseIn:!0}),{amountA:R,amountB:X}=L.getAmountsFromLiquidity(T.sqrtPriceX64,f.tickSqrtPriceX64,I.tickSqrtPriceX64,m.liquidity,!1),H=1/(1-Math.sqrt(Math.sqrt(f.price.div(I.price).toNumber())));g.positionAccount=[...(i=g.positionAccount)!=null?i:[],{poolId:m.poolId,nftMint:m.nftMint,priceLower:f.price,priceUpper:I.price,amountA:R,amountB:X,tickLower:m.tickLower,tickUpper:m.tickUpper,liquidity:m.liquidity,feeGrowthInsideLastX64A:m.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:m.feeGrowthInsideLastX64B,tokenFeesOwedA:m.tokenFeesOwedA,tokenFeesOwedB:m.tokenFeesOwedB,rewardInfos:m.rewardInfos.map(D=>G(O({},D),{pendingReward:new M.default(0)})),leverage:H,tokenFeeAmountA:new M.default(0),tokenFeeAmountB:new M.default(0)}];let x=await A.getTickArrayAddressByTick(g.state.programId,m.poolId,m.tickLower,g.state.tickSpacing),Y=await A.getTickArrayAddressByTick(g.state.programId,m.poolId,m.tickUpper,g.state.tickSpacing);d[`${g.state.programId.toString()}-${m.poolId.toString()}-${m.tickLower}`]=x,d[`${g.state.programId.toString()}-${m.poolId.toString()}-${m.tickUpper}`]=Y}if(s){let p=Object.values(d),m=await Pe(t,p,{batchRequest:r}),y={};for(let g=0;g<p.length;g++){let T=m[g];if(T===null)continue;let f=p[g].toString();y[f]=Je.decode(T.data)}for(let{state:g,positionAccount:T}of e)if(!!T)for(let f of T){let I=`${g.programId.toString()}-${g.id.toString()}-${f.tickLower}`,R=`${g.programId.toString()}-${g.id.toString()}-${f.tickUpper}`,X=y[d[I].toString()],H=y[d[R].toString()],x=X.ticks[A.getTickOffsetInArray(f.tickLower,g.tickSpacing)],Y=H.ticks[A.getTickOffsetInArray(f.tickUpper,g.tickSpacing)],{tokenFeeAmountA:D,tokenFeeAmountB:ie}=await $e.GetPositionFees(g,f,x,Y),Z=await $e.GetPositionRewards(g,f,x,Y);f.tokenFeeAmountA=D.gte(new M.default(0))?D:new M.default(0),f.tokenFeeAmountB=ie.gte(new M.default(0))?ie:new M.default(0);for(let V=0;V<Z.length;V++)f.rewardInfos[V].pendingReward=Z[V].gte(new M.default(0))?Z[V]:new M.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:s,slippage:o,priceLimit:i=new S.default(0),catchLiquidityInsufficient:a=!1}){var he;let c,l=n.toBase58()===e.mintA.address,[d,p]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];i.equals(new S.default(0))?c=l?Ce.add(new M.default(1)):Ne.sub(new M.default(1)):c=w.priceToSqrtPriceX64(i,e.mintA.decimals,e.mintB.decimals);let m=U(s,d,r,!1),{allTrade:y,expectedAmountOut:g,remainingAccounts:T,executionPrice:f,feeAmount:I}=fe.getOutputAmountAndRemainAccounts(e,t,n,m.amount.sub((he=m.fee)!=null?he:W),c,a),R=U(g,p,r,!1),X=w.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),H=l?X:new S.default(1).div(X),x=g.mul(new M.default(Math.floor((1-o)*1e10))).div(new M.default(1e10)),Y=U(x,p,r,!1),D=l?e.currentPrice:new S.default(1).div(e.currentPrice),ie=new S.default(H).sub(D).abs(),Z=D,V=new ke(new S.default(ie).mul(10**15).toFixed(0),new S.default(Z).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:m,amountOut:R,minAmountOut:Y,expirationTime:Ae(m.expirationTime,R.expirationTime),currentPrice:e.currentPrice,executionPrice:H,priceImpact:V,fee:I,remainingAccounts:T,executionPriceX64:f}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:s,epochInfo:o,catchLiquidityInsufficient:i=!1}){let a=r.address===e.mintB.address,[c,l]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[d,p]=[new xe(G(O({},c),{mint:c.address,isToken2022:c.programId===_t.TOKEN_2022_PROGRAM_ID.toBase58()})),new xe(G(O({},l),{mint:l.address,isToken2022:l.programId===_t.TOKEN_2022_PROGRAM_ID.toBase58()}))],{allTrade:m,realAmountIn:y,amountOut:g,minAmountOut:T,expirationTime:f,currentPrice:I,executionPrice:R,priceImpact:X,fee:H,remainingAccounts:x,executionPriceX64:Y}=fe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new re.PublicKey(c.address),amountIn:n,slippage:s,epochInfo:o,catchLiquidityInsufficient:i}),D=G(O({},y),{amount:new Q(d,y.amount),fee:y.fee===void 0?void 0:new Q(d,y.fee)}),ie=G(O({},g),{amount:new Q(p,g.amount),fee:g.fee===void 0?void 0:new Q(p,g.fee)}),Z=G(O({},T),{amount:new Q(p,T.amount),fee:T.fee===void 0?void 0:new Q(p,T.fee)}),V=new de({baseToken:d,denominator:new M.default(10).pow(new M.default(20+d.decimals)),quoteToken:p,numerator:I.mul(new S.default(10**(20+p.decimals))).toFixed(0)}),he=new de({baseToken:d,denominator:new M.default(10).pow(new M.default(20+d.decimals)),quoteToken:p,numerator:R.mul(new S.default(10**(20+p.decimals))).toFixed(0)}),le=new Q(d,H);return{allTrade:m,realAmountIn:D,amountOut:ie,minAmountOut:Z,expirationTime:f,currentPrice:V,executionPrice:he,priceImpact:X,fee:le,remainingAccounts:x,executionPriceX64:Y}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:s,slippage:o,priceLimit:i=new S.default(0)}){var Z;let a=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;i.equals(new S.default(0))?l=a?Ne.sub(new M.default(1)):Ce.add(new M.default(1)):l=w.priceToSqrtPriceX64(i,e.mintA.decimals,e.mintB.decimals);let d=U(s,c[n.toString()],r,!0),{expectedAmountIn:p,remainingAccounts:m,executionPrice:y,feeAmount:g}=fe.getInputAmountAndRemainAccounts(e,t,n,d.amount.sub((Z=d.fee)!=null?Z:W),l),T=a?e.mintB.address:e.mintA.address,f=U(p,c[T],r,!1),I=w.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),R=a?I:new S.default(1).div(I),X=p.mul(new M.default(Math.floor((1+o)*1e10))).div(new M.default(1e10)),H=U(X,c[T],r,!0),x=a?e.currentPrice:new S.default(1).div(e.currentPrice),Y=new S.default(R).sub(x).abs(),D=x,ie=new ke(new S.default(Y).mul(10**15).toFixed(0),new S.default(D).mul(10**15).toFixed(0));return{amountIn:f,maxAmountIn:H,realAmountOut:d,expirationTime:Ae(f.expirationTime,d.expirationTime),currentPrice:e.currentPrice,executionPrice:R,priceImpact:ie,fee:g,remainingAccounts:m}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,g,T;let s=e[t],o=A.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),i=A.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),a=Math.max(o,s.priceMin),l=Math.min(i,s.priceMax)-a,d=i-o,p=s.priceMax-s.priceMin,m;return l<=0?m=0:d===l?m=p/l:p===l?m=l/d:m=l/p*(l/d),{feeApr:s.feeApr*m,rewardsApr:[((y=s.rewardApr[0])!=null?y:0)*m,((g=s.rewardApr[1])!=null?g:0)*m,((T=s.rewardApr[2])!=null?T:0)*m],apr:s.apr*m}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:s,positionTickLowerIndex:o,positionTickUpperIndex:i,chainTime:a}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],d=r[it(e.mintA.address).toString()],p=r[it(e.mintB.address).toString()],m=e.mintA.decimals,y=e.mintB.decimals;if(!l||!d||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let g=w.priceToSqrtPriceX64(new S.default(e.price),e.mintA.decimals,e.mintB.decimals),T=w.getSqrtPriceX64FromTick(o),f=w.getSqrtPriceX64FromTick(i),{amountSlippageA:I,amountSlippageB:R}=L.getAmountsFromLiquidityWithSlippage(g,T,f,t,!1,!1,0),{amountSlippageA:X,amountSlippageB:H}=L.getAmountsFromLiquidityWithSlippage(g,T,f,s,!1,!1,0),x=new S.default(I.toString()).div(new S.default(10).pow(m)).mul(d.value).add(new S.default(R.toString()).div(new S.default(10).pow(y)).mul(p.value)),Y=new S.default(X.toString()).div(new S.default(10).pow(m)).mul(d.value).add(new S.default(H.toString()).div(new S.default(10).pow(y)).mul(p.value)),D=new S.default(1).div(x.add(Y)),Z=new S.default(l.volumeFee).mul(365).div(c).mul(D).mul(100).toNumber(),V=3600*24*365,he=e.rewardDefaultInfos.map(le=>{var Mt,Ot;let et=le.mint.decimals,Ft=r[le.mint.address];return a<((Mt=le.startTime)!=null?Mt:0)||a>((Ot=le.endTime)!=null?Ot:0)||!le.perSecond||!Ft||et===void 0?0:new S.default(Ft.value).mul(new S.default(le.perSecond).mul(V)).div(new S.default(10).pow(et)).mul(D).mul(100).toNumber()});return{feeApr:Z,rewardsApr:he,apr:Z+he.reduce((le,et)=>le+et,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:s,slippage:o,add:i,epochInfo:a,amountHasFee:c}){var f,I;let l=w.priceToSqrtPriceX64(new S.default(e.price),e.mintA.decimals,e.mintB.decimals),d=w.getSqrtPriceX64FromTick(n),p=w.getSqrtPriceX64FromTick(r),m=U(s,(f=e[t?"mintA":"mintB"].extensions)==null?void 0:f.feeConfig,a,!c),y=new M.default(new S.default(m.amount.sub((I=m.fee)!=null?I:W).toString()).toFixed(0)),g;if(l.lte(d))g=t?L.getLiquidityFromTokenAmountA(d,p,y,!i):new M.default(0);else if(l.lte(p)){let R=L.getLiquidityFromTokenAmountA(l,p,y,!i),X=L.getLiquidityFromTokenAmountB(d,l,y);g=t?R:X}else g=t?new M.default(0):L.getLiquidityFromTokenAmountB(d,p,y);let T=await fe.getAmountsFromLiquidity({epochInfo:a,poolInfo:e,tickLower:n,tickUpper:r,liquidity:g,slippage:o,add:i});return{liquidity:g,amountA:t?m:T.amountA,amountB:t?T.amountB:m,amountSlippageA:t?m:T.amountSlippageA,amountSlippageB:t?T.amountSlippageB:m,expirationTime:T.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:s,slippage:o,add:i}){var T,f,I,R;let a=w.getSqrtPriceX64FromTick(n),c=w.getSqrtPriceX64FromTick(r),l=i?1+o:1-o,d=L.getAmountsFromLiquidity(w.priceToSqrtPriceX64(new S.default(t.price),t.mintA.decimals,t.mintB.decimals),a,c,s,i),[p,m]=[U(d.amountA,(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),U(d.amountB,(f=t.mintB.extensions)==null?void 0:f.feeConfig,e,!0)],[y,g]=[U(d.amountA.muln(l),(I=t.mintA.extensions)==null?void 0:I.feeConfig,e,!0),U(d.amountB.muln(l),(R=t.mintB.extensions)==null?void 0:R.feeConfig,e,!0)];return{liquidity:s,amountA:p,amountB:m,amountSlippageA:y,amountSlippageB:g,expirationTime:Ae(p.expirationTime,m.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(a=>!n[a.id]).map(a=>new re.PublicKey(a.id));(await Pe(e,r)).forEach((a,c)=>{!a||(n[r[c].toBase58()]=wn.decode(a.data))});let o=t.map(a=>ut(new re.PublicKey(a.programId),new re.PublicKey(a.id)).publicKey),i=await fe.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((a,c)=>G(O({},a),{[c.id]:G(O({},n[c.id]),{id:new re.PublicKey(c.id),version:6,programId:new re.PublicKey(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:G(O({},c.config),{id:new re.PublicKey(c.config.id),fundOwner:""}),currentPrice:new S.default(c.price),exBitmapAccount:ut(new re.PublicKey(c.programId),new re.PublicKey(c.id)).publicKey,exBitmapInfo:i[ut(new re.PublicKey(c.programId),new re.PublicKey(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var P=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),s=r.div(n);return r.mod(n).eq(W)||(s=s.add(ye)),s}static mulDivFloor(e,t,n){if(n.eq(W))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(W))throw new Error("division by 0");return e.mul(t).add(n.sub(ye)).div(n)}static x64ToDecimal(e,t){return new ge.default(e.toString()).div(ge.default.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new k.default(e.mul(ge.default.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(tt).sub(t).mod(tt)}};function j(u,e){return Et(u.mul(e),64,256)}function ar(u,e,t){let n=u.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Et(u,e,t){let n=u.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var w=class{static sqrtPriceX64ToPrice(e,t,n){return P.x64ToDecimal(e).pow(2).mul(ge.default.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return P.decimalToX64(e.mul(ge.default.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(W))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(W))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(W))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(W))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(W))return e;let s=t.shln(qe);if(r){let o=s,i=s.add(n.mul(e));return i.gte(o)?P.mulDivCeil(o,e,i):P.mulDivRoundingUp(o,ye,o.div(e).add(n))}else{let o=n.mul(e);if(!s.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let i=s.sub(o);return P.mulDivCeil(s,e,i)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let s=n.shln(qe);if(r)return e.add(s.div(t));{let o=P.mulDivRoundingUp(s,ye,t);if(!e.gt(o))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(o)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<J||e>$)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new k.default("18445821805675395072"):new k.default("18446744073709551616");return(t&2)!=0&&(n=j(n,new k.default("18444899583751176192"))),(t&4)!=0&&(n=j(n,new k.default("18443055278223355904"))),(t&8)!=0&&(n=j(n,new k.default("18439367220385607680"))),(t&16)!=0&&(n=j(n,new k.default("18431993317065453568"))),(t&32)!=0&&(n=j(n,new k.default("18417254355718170624"))),(t&64)!=0&&(n=j(n,new k.default("18387811781193609216"))),(t&128)!=0&&(n=j(n,new k.default("18329067761203558400"))),(t&256)!=0&&(n=j(n,new k.default("18212142134806163456"))),(t&512)!=0&&(n=j(n,new k.default("17980523815641700352"))),(t&1024)!=0&&(n=j(n,new k.default("17526086738831433728"))),(t&2048)!=0&&(n=j(n,new k.default("16651378430235570176"))),(t&4096)!=0&&(n=j(n,new k.default("15030750278694412288"))),(t&8192)!=0&&(n=j(n,new k.default("12247334978884435968"))),(t&16384)!=0&&(n=j(n,new k.default("8131365268886854656"))),(t&32768)!=0&&(n=j(n,new k.default("3584323654725218816"))),(t&65536)!=0&&(n=j(n,new k.default("696457651848324352"))),(t&131072)!=0&&(n=j(n,new k.default("26294789957507116"))),(t&262144)!=0&&(n=j(n,new k.default("37481735321082"))),e>0&&(n=qt.div(n)),n}static getTickFromPrice(e,t,n){return w.getTickFromSqrtPriceX64(w.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ne)||e.lt(Ce))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new k.default(t-64),r=ar(n,32,128),s=new k.default("8000000000000000","hex"),o=0,i=new k.default(0),a=t>=64?e.shrn(t-63):e.shln(63-t);for(;s.gt(new k.default(0))&&o<Vt;){a=a.mul(a);let y=a.shrn(127);a=a.shrn(63+y.toNumber()),i=i.add(s.mul(y)),s=s.shrn(1),o+=1}let c=i.shrn(32),d=r.add(c).mul(new k.default(Ut)),p=Et(d.sub(new k.default(Wt)),64,128).toNumber(),m=Et(d.add(new k.default(Xt)),64,128).toNumber();return p==m?p:w.getSqrtPriceX64FromTick(m).lte(e)?m:p}},Ie=class{static getTickWithPriceAndTickspacing(e,t,n,r){let o=w.getTickFromSqrtPriceX64(w.priceToSqrtPriceX64(e,n,r))/t;return o<0?o=Math.floor(o):o=Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,r){let s=Ie.getTickWithPriceAndTickspacing(e,t,n,r),o=w.getSqrtPriceX64FromTick(s);return w.sqrtPriceX64ToPrice(o,n,r)}},L=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(W))throw new Error("sqrtPriceX64A must greater than 0");let s=n.ushln(qe),o=t.sub(e);return r?P.mulDivRoundingUp(P.mulDivCeil(s,o,t),ye,e):P.mulDivFloor(s,o,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(W))throw new Error("sqrtPriceX64A must greater than 0");return r?P.mulDivCeil(n,t.sub(e),se):P.mulDivFloor(n,t.sub(e),se)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let s=n.mul(e).mul(t),o=t.sub(e),i=s.div(o);return r?P.mulDivRoundingUp(i,ye,dt):i.shrn(qe)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),P.mulDivFloor(n,dt,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return L.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let o=L.getLiquidityFromTokenAmountA(e,n,r,!1),i=L.getLiquidityFromTokenAmountB(t,e,s);return o.lt(i)?o:i}else return L.getLiquidityFromTokenAmountB(t,n,s)}static getAmountsFromLiquidity(e,t,n,r,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:L.getTokenAmountAFromLiquidity(t,n,r,s),amountB:new k.default(0)};if(e.lt(n)){let o=L.getTokenAmountAFromLiquidity(e,n,r,s),i=L.getTokenAmountBFromLiquidity(t,e,r,s);return{amountA:o,amountB:i}}else return{amountA:new k.default(0),amountB:L.getTokenAmountBFromLiquidity(t,n,r,s)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,s,o,i){let{amountA:a,amountB:c}=L.getAmountsFromLiquidity(e,t,n,r,o),l=s?1+i:1-i,d=new k.default(new ge.default(a.toString()).mul(l).toFixed(0)),p=new k.default(new ge.default(c.toString()).mul(l).toFixed(0));return{amountSlippageA:d,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:s,add:o,epochInfo:i,amountAddFee:a}){var I,R,X,H;let c=w.priceToSqrtPriceX64(new ge.default(e.price),e.mintA.decimals,e.mintB.decimals),l=w.getSqrtPriceX64FromTick(t),d=w.getSqrtPriceX64FromTick(n),p=o?1+s:1-s,m=L.getAmountsFromLiquidity(c,l,d,r,o),[y,g]=[U(m.amountA,(I=e.mintA.extensions)==null?void 0:I.feeConfig,i,a),U(m.amountB,(R=e.mintB.extensions)==null?void 0:R.feeConfig,i,a)],[T,f]=[U(new k.default(new ge.default(m.amountA.toString()).mul(p).toFixed(0)),(X=e.mintA.extensions)==null?void 0:X.feeConfig,i,a),U(new k.default(new ge.default(m.amountB.toString()).mul(p).toFixed(0)),(H=e.mintB.extensions)==null?void 0:H.feeConfig,i,a)];return{liquidity:r,amountA:y,amountB:g,amountSlippageA:T,amountSlippageB:f,expirationTime:Ae(y.expirationTime,g.expirationTime)}}},Se=class{static swapCompute(e,t,n,r,s,o,i,a,c,l,d,p,m,y,g=!1){if(p.eq(W))throw new Error("amountSpecified must not be 0");if(y||(y=o?Ce.add(ye):Ne.sub(ye)),o){if(y.lt(Ce))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(d))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(Ne))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(d))throw new Error("sqrtPriceX64 must greater than current")}let T=p.gt(W),f={amountSpecifiedRemaining:p,amountCalculated:W,sqrtPriceX64:d,tick:c>m?Math.min(m+N.tickCount(l)-1,c):m,accounts:[],liquidity:a,feeAmount:new k.default(0)},I=m,R=n[m],X=0,H=!o&&R.startTickIndex===f.tick;for(;!f.amountSpecifiedRemaining.eq(W)&&!f.sqrtPriceX64.eq(y);){X>10;let x={};x.sqrtPriceStartX64=f.sqrtPriceX64;let Y=A.nextInitTick(R,f.tick,l,o,H),D=Y||null,ie=null;if(!(D!=null&&D.liquidityGross.gtn(0))){let V=fe.nextInitializedTickArrayStartIndex({tickCurrent:f.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:s},I,o);if(!V.isExist){if(g)return{allTrade:!1,amountSpecifiedRemaining:f.amountSpecifiedRemaining,amountCalculated:f.amountCalculated,feeAmount:f.feeAmount,sqrtPriceX64:f.sqrtPriceX64,liquidity:f.liquidity,tickCurrent:f.tick,accounts:f.accounts};throw Error("swapCompute LiquidityInsufficient")}I=V.nextStartIndex;let{publicKey:he}=ee(e,t,I);ie=he,R=n[I];try{D=A.firstInitializedTick(R,o)}catch{throw Error("not found next tick info")}}x.tickNext=D.tick,x.initialized=D.liquidityGross.gtn(0),m!==I&&ie&&(f.accounts.push(ie),m=I),x.tickNext<J?x.tickNext=J:x.tickNext>$&&(x.tickNext=$),x.sqrtPriceNextX64=w.getSqrtPriceX64FromTick(x.tickNext);let Z;if(o&&x.sqrtPriceNextX64.lt(y)||!o&&x.sqrtPriceNextX64.gt(y)?Z=y:Z=x.sqrtPriceNextX64,[f.sqrtPriceX64,x.amountIn,x.amountOut,x.feeAmount]=Se.swapStepCompute(f.sqrtPriceX64,Z,f.liquidity,f.amountSpecifiedRemaining,i,o),f.feeAmount=f.feeAmount.add(x.feeAmount),T?(f.amountSpecifiedRemaining=f.amountSpecifiedRemaining.sub(x.amountIn.add(x.feeAmount)),f.amountCalculated=f.amountCalculated.sub(x.amountOut)):(f.amountSpecifiedRemaining=f.amountSpecifiedRemaining.add(x.amountOut),f.amountCalculated=f.amountCalculated.add(x.amountIn.add(x.feeAmount))),f.sqrtPriceX64.eq(x.sqrtPriceNextX64)){if(x.initialized){let V=D.liquidityNet;o&&(V=V.mul(Te)),f.liquidity=L.addDelta(f.liquidity,V)}H=x.tickNext!=f.tick&&!o&&R.startTickIndex===x.tickNext,f.tick=o?x.tickNext-1:x.tickNext}else if(f.sqrtPriceX64!=x.sqrtPriceStartX64){let V=w.getTickFromSqrtPriceX64(f.sqrtPriceX64);H=V!=f.tick&&!o&&R.startTickIndex===V,f.tick=V}++X}try{let{nextStartIndex:x,isExist:Y}=N.nextInitializedTickArray(f.tick,l,o,r,s);Y&&m!==x&&(f.accounts.push(ee(e,t,x).publicKey),m=x)}catch{}return{allTrade:!0,amountSpecifiedRemaining:W,amountCalculated:f.amountCalculated,feeAmount:f.feeAmount,sqrtPriceX64:f.sqrtPriceX64,liquidity:f.liquidity,tickCurrent:f.tick,accounts:f.accounts}}static swapStepCompute(e,t,n,r,s,o){let i={sqrtPriceX64Next:new k.default(0),amountIn:new k.default(0),amountOut:new k.default(0),feeAmount:new k.default(0)},a=r.gte(W);if(a){let l=P.mulDivFloor(r,nt.sub(new k.default(s.toString())),nt);i.amountIn=o?L.getTokenAmountAFromLiquidity(t,e,n,!0):L.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(i.amountIn)?i.sqrtPriceX64Next=t:i.sqrtPriceX64Next=w.getNextSqrtPriceX64FromInput(e,n,l,o)}else i.amountOut=o?L.getTokenAmountBFromLiquidity(t,e,n,!1):L.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Te).gte(i.amountOut)?i.sqrtPriceX64Next=t:i.sqrtPriceX64Next=w.getNextSqrtPriceX64FromOutput(e,n,r.mul(Te),o);let c=t.eq(i.sqrtPriceX64Next);return o?(c&&a||(i.amountIn=L.getTokenAmountAFromLiquidity(i.sqrtPriceX64Next,e,n,!0)),c&&!a||(i.amountOut=L.getTokenAmountBFromLiquidity(i.sqrtPriceX64Next,e,n,!1))):(i.amountIn=c&&a?i.amountIn:L.getTokenAmountBFromLiquidity(e,i.sqrtPriceX64Next,n,!0),i.amountOut=c&&!a?i.amountOut:L.getTokenAmountAFromLiquidity(e,i.sqrtPriceX64Next,n,!1)),!a&&i.amountOut.gt(r.mul(Te))&&(i.amountOut=r.mul(Te)),a&&!i.sqrtPriceX64Next.eq(t)?i.feeAmount=r.sub(i.amountIn):i.feeAmount=P.mulDivCeil(i.amountIn,new k.default(s),nt.sub(new k.default(s))),[i.sqrtPriceX64Next,i.amountIn,i.amountOut,i.feeAmount]}};0&&(module.exports={LiquidityMath,MathUtil,SqrtPriceMath,SwapMath,TickMath});
//# sourceMappingURL=math.js.map