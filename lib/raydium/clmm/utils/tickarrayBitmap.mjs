var bt=Object.defineProperty,ht=Object.defineProperties;var Tt=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable;var Ge=(i,e,t)=>e in i?bt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,M=(i,e)=>{for(var t in e||(e={}))xt.call(e,t)&&Ge(i,t,e[t]);if(ve)for(var t of ve(e))wt.call(e,t)&&Ge(i,t,e[t]);return i},G=(i,e)=>ht(i,Tt(e));import _ from"bn.js";var D=new _(0),Y=new _(1),qe=new _(-1),ae=new _(1).shln(64),ue=new _(1).shln(128),At=ae.sub(Y),fe=64,Ve=ue.subn(1),O=-443636,K=-O,ge=new _("4295048016"),ye=new _("79226673521066979257578248091"),hn=new _("4295048017"),Tn=new _("79226673521066979257578248090"),Ue=16,We="59543866431248",Xe="184467440737095516",He="15793534762490258745",Pt=new _(10).pow(new _(6));var xn=new _("18446744073700000000");import gn from"bn.js";import $ from"decimal.js";import g from"bn.js";import se from"decimal.js";import Pn from"bn.js";import{PublicKey as It}from"@solana/web3.js";import{get as ze,set as kt}from"lodash";var be=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},je={},Bt={};function E(i){let e=ze(je,i);if(!e){let t=ze(Bt,i);e=new be({name:i,logLevel:t}),kt(je,i,e)}return e}import{MINT_SIZE as Fn,TOKEN_PROGRAM_ID as Mn,getTransferFeeConfig as On,unpackMint as Dn}from"@solana/spl-token";var he=E("Raydium_accountInfo_util");async function ce(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=M({batchRequest:!1},t),a=Te(e,o),s=new Array(a.length).fill([]);if(n){let c=a.map(B=>{let w=i._buildArgs([B.map(A=>A.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:w}}),m=Te(c,10);s=(await(await Promise.all(m.map(async B=>await i._rpcBatchRequest(B)))).flat()).map(B=>(B.error&&he.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${B.error.message}`),B.result.value.map(w=>{if(w){let{data:A,executable:F,lamports:ft,owner:gt,rentEpoch:yt}=w;return A.length!==2&&A[1]!=="base64"&&he.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(A[0],"base64"),executable:F,lamports:ft,owner:new It(gt),rentEpoch:yt}}return null})))}else try{s=await Promise.all(a.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&he.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return s.flat()}import V from"bn.js";import Ti from"decimal.js";import Mt from"big.js";import er from"bn.js";import Ct from"toformat";var Nt=Ct,ee=Nt;import le from"big.js";import Rt from"bn.js";import _t from"decimal.js-light";import te from"bn.js";var Ye=9007199254740991;function q(i){let e=E("Raydium_parseBigNumberish");if(i instanceof te)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new te(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Ye||i<=-Ye)&&e.logWithError(`BigNumberish number overflow: ${i}`),new te(String(i))):typeof i=="bigint"?new te(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new te(0))}var me=E("module/fraction"),we=ee(le),ne=ee(_t),Et={[0]:ne.ROUND_DOWN,[1]:ne.ROUND_HALF_UP,[2]:ne.ROUND_UP},Ft={[0]:le.roundDown,[1]:le.roundHalfUp,[2]:le.roundUp},b=class{constructor(e,t=new Rt(1)){this.numerator=q(e),this.denominator=q(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new b(this.denominator,this.numerator)}add(e){let t=e instanceof b?e:new b(q(e));return this.denominator.eq(t.denominator)?new b(this.numerator.add(t.numerator),this.denominator):new b(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof b?e:new b(q(e));return this.denominator.eq(t.denominator)?new b(this.numerator.sub(t.numerator),this.denominator):new b(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof b?e:new b(q(e));return new b(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof b?e:new b(q(e));return new b(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||me.logWithError(`${e} is not an integer.`),e<=0&&me.logWithError(`${e} is not positive.`),ne.set({precision:e+1,rounding:Et[n]});let r=new ne(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||me.logWithError(`${e} is not an integer.`),e<0&&me.logWithError(`${e} is negative.`),we.DP=e,we.RM=Ft[n]||1,new we(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var cr=E("Raydium_amount"),mr=ee(Mt);import{PublicKey as Dt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ze}from"@solana/spl-token";var Je={chainId:101,address:Dt.default.toBase58(),programId:Ze.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},X={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ze.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Pe}from"@solana/web3.js";import{PublicKey as h,SystemProgram as Qe,SYSVAR_RENT_PUBKEY as Kt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vt}from"@solana/spl-token";function Ae({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var hr=[Ae({pubkey:vt,isWritable:!1}),Ae({pubkey:Qe.programId,isWritable:!1}),Ae({pubkey:Kt,isWritable:!1})];function $e({publicKey:i,transformSol:e}){let t=et(i.toString());if(t instanceof h)return e&&t.equals(re)?xe:t;if(e&&t.toString()===re.toBase58())return xe;if(typeof t=="string"){if(t===h.default.toBase58())return h.default;try{return new h(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function et(i){try{return new h(i)}catch{return i}}var Tr=new h("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xr=new h("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),wr=new h("SysvarRent111111111111111111111111111111111"),Ar=new h("SysvarC1ock11111111111111111111111111111111"),Gt=new h("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Pr=new h("Sysvar1nstructions1111111111111111111111111"),kr=Qe.programId,Br=new h("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ir=new h("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Sr=new h("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Cr=new h("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Nr=new h("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Lr=new h("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Rr=new h("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),_r=new h("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Er=new h("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Fr=new h("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Mr=new h("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),xe=new h("So11111111111111111111111111111111111111112"),re=h.default;var ke=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:a=!1}){if(e===re.toBase58()||e instanceof Pe&&re.equals(e)){this.decimals=X.decimals,this.symbol=X.symbol,this.name=X.name,this.mint=new Pe(X.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Pe.default:$e({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},H=ke;H.WSOL=new ke(G(M({},X),{mint:X.address}));var Be=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},de=Be;de.SOL=new Be(Je);import qt from"bn.js";var zr=new b(new qt(100));var $r=E("Raydium_price");var Vt=new V(0),Ci=new V(1),Ni=new V(2),Li=new V(3),Ri=new V(5),Ot=new V(10),_i=new V(100),Ei=new V(1e3),Fi=new V(1e4);function Te(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as io}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as so}from"@solana/spl-token";import{ComputeBudgetProgram as Vi,Keypair as Xi,PublicKey as Wt,Transaction as zi,TransactionMessage as Yi,VersionedTransaction as Zi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as eo}from"@solana/spl-token";var to=E("Raydium_txUtil");function Ne(i,e){let[t,n]=Wt.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as u}from"@solana/web3.js";var mo=new u("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),lo=new u("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),po=new u("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),fo=new u("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),go=new u("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),yo=new u("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),bo=new u("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ho=new u("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),To=new u("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),xo=new u("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),wo=new u("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ao=new u("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Po=new u("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ko=new u("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Bo=new u("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Io=new u("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),So=new u("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Co=new u("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),No=new u("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Lo=new u("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ro=new u("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),_o=new u("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Eo=new u("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Fo=new u("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Mo=new u("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Oo=new u("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Do=new u("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ko=new u("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),vo=new u("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Go=new u("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),qo=new u("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Vo={OPEN_BOOK_PROGRAM:new u("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new u("Ray1111111111111111111111111111111111111111"),AMM_V4:new u("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new u("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new u("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new u("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new u("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new u("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new u("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new u("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new u("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new u("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:u.default,Router:new u("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new u("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new u("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new u("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new u("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new u("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new u("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new u("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new u("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new u("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new u("Ray1111111111111111111111111111111111111111")};import{PublicKey as Ho,AddressLookupTableAccount as zo}from"@solana/web3.js";import{PublicKey as ls,sendAndConfirmTransaction as ds,SystemProgram as gs,Transaction as ys,TransactionMessage as hs,VersionedTransaction as Ts}from"@solana/web3.js";import ws from"axios";import{PublicKey as Ns}from"@solana/web3.js";import Rs from"bn.js";import Xt from"bn.js";var Os=new Xt(1e6);function tt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Le(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Re(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function ie(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function nt(i,e){return ie(i,e)?null:Le(i,e)}function rt(i,e){return ie(i,e)?null:Re(i,e)}var aa=Buffer.from("amm_config","utf8"),ua=Buffer.from("pool","utf8"),ca=Buffer.from("pool_vault","utf8"),ma=Buffer.from("pool_reward_vault","utf8"),la=Buffer.from("position","utf8"),Ht=Buffer.from("tick_array","utf8"),da=Buffer.from("operation","utf8"),pa=Buffer.from("pool_tick_array_bitmap_extension","utf8"),fa=Buffer.from("observation","utf8");function U(i,e,t){return Ne([Ht,e.toBuffer(),tt(t)],i)}var ga=Buffer.from("locked_position","utf8");var ya=Buffer.from("support_mint","utf8");import{PublicKey as ju}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Zu}from"@solana/spl-token";import Qu from"bn.js";import ec from"decimal.js";import{PublicKey as tn}from"@solana/web3.js";import at,{isBN as ut}from"bn.js";import{bits as Ta,BitStructure as xa,blob as zt,Blob as wa,cstr as Aa,f32 as Pa,f32be as ka,f64 as Ba,f64be as Ia,greedy as Sa,Layout as jt,ns64 as Ca,ns64be as Na,nu64 as La,nu64be as Ra,offset as _a,s16 as Ea,s16be as Fa,s24 as Ma,s24be as Oa,s32 as Yt,s32be as Da,s40 as Ka,s40be as va,s48 as Ga,s48be as qa,s8 as Va,seq as Zt,struct as Ua,Structure as Jt,u16 as Qt,u16be as Wa,u24 as Xa,u24be as Ha,u32 as za,u32be as ja,u40 as Ya,u40be as Za,u48 as Ja,u48be as Qa,u8 as $t,UInt as en,union as $a,Union as eu,unionLayoutDiscriminator as tu,utf8 as nu}from"@solana/buffer-layout";var _e=jt,it=Jt;var Ee=en;var ot=$t,oe=Qt;var W=Yt;var st=Zt;var R=zt;var Z=class extends _e{constructor(t,n,r){super(t,r);this.blob=R(t),this.signed=n}decode(t,n=0){let r=new at(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new at(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function L(i){return new Ee(1,i)}function J(i){return new Ee(4,i)}function p(i){return new Z(8,!1,i)}function P(i){return new Z(16,!1,i)}function ct(i){return new Z(8,!0,i)}function mt(i){return new Z(16,!0,i)}var pe=class extends _e{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function f(i){return new pe(R(32),e=>new tn(e),e=>e.toBuffer(),i)}function lt(i){return new pe(ot(),nn,rn,i)}function nn(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function rn(i){return i?1:0}var Fe=class extends it{decode(e,t){return super.decode(e,t)}};function N(i,e,t){return new Fe(i,e,t)}function T(i,e,t){let n,r=typeof e=="number"?e:ut(e)?e.toNumber():new Proxy(e,{get(o,a){if(!n){let s=Reflect.get(o,"count");n=ut(s)?s.toNumber():s,Reflect.set(o,"count",n)}return Reflect.get(o,a)},set(o,a,s){return a==="count"&&(n=s),Reflect.set(o,a,s)}});return st(i,r,t)}var hu=N([R(8),L("bump"),oe("index"),f(""),J("protocolFeeRate"),J("tradeFeeRate"),oe("tickSpacing"),T(p(),8,"")]),on=N([J("blockTimestamp"),ct("tickCumulative"),T(p(),4)]),Tu=N([R(8),lt("initialized"),p("recentEpoch"),oe("observationIndex"),f("poolId"),T(on,100,"observations"),T(p(),4)]),sn=N([L("rewardState"),p("openTime"),p("endTime"),p("lastUpdateTime"),P("emissionsPerSecondX64"),p("rewardTotalEmissioned"),p("rewardClaimed"),f("tokenMint"),f("tokenVault"),f("creator"),P("rewardGrowthGlobalX64")]),an=N([R(8),L("bump"),f("ammConfig"),f("creator"),f("mintA"),f("mintB"),f("vaultA"),f("vaultB"),f("observationId"),L("mintDecimalsA"),L("mintDecimalsB"),oe("tickSpacing"),P("liquidity"),P("sqrtPriceX64"),W("tickCurrent"),J(),P("feeGrowthGlobalX64A"),P("feeGrowthGlobalX64B"),p("protocolFeesTokenA"),p("protocolFeesTokenB"),P("swapInAmountTokenA"),P("swapOutAmountTokenB"),P("swapInAmountTokenB"),P("swapOutAmountTokenA"),L("status"),T(L(),7,""),T(sn,3,"rewardInfos"),T(p(),16,"tickArrayBitmap"),p("totalFeesTokenA"),p("totalFeesClaimedTokenA"),p("totalFeesTokenB"),p("totalFeesClaimedTokenB"),p("fundFeesTokenA"),p("fundFeesTokenB"),p("startTime"),T(p(),15*4-3,"padding")]),un=N([P("growthInsideLastX64"),p("rewardAmountOwed")]),cn=N([R(8),L("bump"),f("nftMint"),f("poolId"),W("tickLower"),W("tickUpper"),P("liquidity"),P("feeGrowthInsideLastX64A"),P("feeGrowthInsideLastX64B"),p("tokenFeesOwedA"),p("tokenFeesOwedB"),T(un,3,"rewardInfos"),T(p(),8,"")]),xu=N([R(8),L("bump"),f("poolId"),W("tickLowerIndex"),W("tickUpperIndex"),P("liquidity"),P("feeGrowthInsideLastX64A"),P("feeGrowthInsideLastX64B"),p("tokenFeesOwedA"),p("tokenFeesOwedB"),T(P(),3,"rewardGrowthInside"),T(p(),8,"")]),mn=N([W("tick"),mt("liquidityNet"),P("liquidityGross"),P("feeGrowthOutsideX64A"),P("feeGrowthOutsideX64B"),T(P(),3,"rewardGrowthsOutsideX64"),T(J(),13,"")]),Oe=N([R(8),f("poolId"),W("startTickIndex"),T(mn,S,"ticks"),L("initializedTickCount"),T(L(),115,"")]),wu=N([R(329),T(f(),100,"whitelistMints")]),ln=N([R(8),f("poolId"),T(T(p(),8),Me,"positiveTickArrayBitmap"),T(T(p(),8),Me,"negativeTickArrayBitmap")]),Au=N([p(),L("bump"),f("owner"),f("poolId"),f("positionId"),f("nftAccount"),T(p(),8)]),Pu=N([R(8),L("bump"),f("lockOwner"),f("poolId"),f("positionId"),f("nftAccount"),f("lockNftMint"),p("recentEpoch"),T(p(),8)]);import Iu from"bn.js";import Cu from"decimal.js";var pn=15,k=class{static async getTickArrays(e,t,n,r,o,a,s){let c=[],m=y.getTickArrayStartIndexByTick(r,o),x=y.getInitializedTickArrayInRange(a,s,o,m,Math.floor(pn/2));for(let A=0;A<x.length;A++){let{publicKey:F}=U(t,n,x[A]);c.push(F)}let B=(await ce(e,c)).map(A=>A!==null?Oe.decode(A.data):null),w={};for(let A=0;A<c.length;A++){let F=B[A];F!==null&&(w[F.startTickIndex]=G(M({},F),{address:c[A]}))}return w}static nextInitializedTick(e,t,n,r,o,a){let{initializedTick:s,tickArrayAddress:c,tickArrayStartTickIndex:m}=this.nextInitializedTickInOneArray(e,t,n,r,o,a);for(;s==null||s.liquidityGross.lten(0);){if(m=y.getNextTickArrayStartIndex(m,o,a),this.checkIsValidStartIndex(m,o))throw new Error("No enough initialized tickArray");let x=n[m];if(x===void 0)continue;let{nextTick:B,tickArrayAddress:w,tickArrayStartTickIndex:A}=this.firstInitializedTickInOneArray(e,t,x,a);[s,c,m]=[B,w,A]}if(s==null)throw new Error("No invaild tickArray cache");return{nextTick:s,tickArrayAddress:c,tickArrayStartTickIndex:m}}static nextInitializedTickArray(e,t,n,r,o){let a=Math.floor(e/k.tickCount(t)),s=n?y.searchLowBitFromStart(r,o,a-1,1,t):y.searchHightBitFromStart(r,o,a+1,1,t);return s.length>0?{isExist:!0,nextStartIndex:s[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let s=S-1;for(;s>=0;){let c=n.ticks[s];if(c.liquidityGross.gtn(0)){o=c;break}s=s-1}}else{let s=0;for(;s<S;){let c=n.ticks[s];if(c.liquidityGross.gtn(0)){o=c;break}s=s+1}}let{publicKey:a}=U(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:a,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,a){let s=y.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-s)/o),m=n[s];if(m==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:s};let x;if(a)for(;c>=0;){let w=m.ticks[c];if(w.liquidityGross.gtn(0)){x=w;break}c=c-1}else for(c=c+1;c<S;){let w=m.ticks[c];if(w.liquidityGross.gtn(0)){x=w;break}c=c+1}let{publicKey:B}=U(e,t,s);return{initializedTick:x,tickArrayAddress:B,tickArrayStartTickIndex:m.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(y.checkIsOutOfBoundary(e)){if(e>K)return!1;let n=y.getTickArrayStartIndexByTick(O,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return S*e}};var v=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(D)||(o=o.add(Y)),o}static mulDivFloor(e,t,n){if(n.eq(D))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(D))throw new Error("division by 0");return e.mul(t).add(n.sub(Y)).div(n)}static x64ToDecimal(e,t){return new se(e.toString()).div(se.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new g(e.mul(se.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(ue).sub(t).mod(ue)}};function C(i,e){return Ke(i.mul(e),64,256)}function fn(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Ke(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var I=class{static sqrtPriceX64ToPrice(e,t,n){return v.x64ToDecimal(e).pow(2).mul(se.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return v.decimalToX64(e.mul(se.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(D))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(D))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(D))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(D))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(D))return e;let o=t.shln(fe);if(r){let a=o,s=o.add(n.mul(e));return s.gte(a)?v.mulDivCeil(a,e,s):v.mulDivRoundingUp(a,Y,a.div(e).add(n))}else{let a=n.mul(e);if(!o.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let s=o.sub(a);return v.mulDivCeil(o,e,s)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(fe);if(r)return e.add(o.div(t));{let a=v.mulDivRoundingUp(o,Y,t);if(!e.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(a)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<O||e>K)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new g("18445821805675395072"):new g("18446744073709551616");return(t&2)!=0&&(n=C(n,new g("18444899583751176192"))),(t&4)!=0&&(n=C(n,new g("18443055278223355904"))),(t&8)!=0&&(n=C(n,new g("18439367220385607680"))),(t&16)!=0&&(n=C(n,new g("18431993317065453568"))),(t&32)!=0&&(n=C(n,new g("18417254355718170624"))),(t&64)!=0&&(n=C(n,new g("18387811781193609216"))),(t&128)!=0&&(n=C(n,new g("18329067761203558400"))),(t&256)!=0&&(n=C(n,new g("18212142134806163456"))),(t&512)!=0&&(n=C(n,new g("17980523815641700352"))),(t&1024)!=0&&(n=C(n,new g("17526086738831433728"))),(t&2048)!=0&&(n=C(n,new g("16651378430235570176"))),(t&4096)!=0&&(n=C(n,new g("15030750278694412288"))),(t&8192)!=0&&(n=C(n,new g("12247334978884435968"))),(t&16384)!=0&&(n=C(n,new g("8131365268886854656"))),(t&32768)!=0&&(n=C(n,new g("3584323654725218816"))),(t&65536)!=0&&(n=C(n,new g("696457651848324352"))),(t&131072)!=0&&(n=C(n,new g("26294789957507116"))),(t&262144)!=0&&(n=C(n,new g("37481735321082"))),e>0&&(n=Ve.div(n)),n}static getTickFromPrice(e,t,n){return I.getTickFromSqrtPriceX64(I.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ye)||e.lt(ge))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new g(t-64),r=fn(n,32,128),o=new g("8000000000000000","hex"),a=0,s=new g(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new g(0))&&a<Ue;){c=c.mul(c);let F=c.shrn(127);c=c.shrn(63+F.toNumber()),s=s.add(o.mul(F)),o=o.shrn(1),a+=1}let m=s.shrn(32),B=r.add(m).mul(new g(We)),w=Ke(B.sub(new g(Xe)),64,128).toNumber(),A=Ke(B.add(new g(He)),64,128).toNumber();return w==A?w:I.getSqrtPriceX64FromTick(A).lte(e)?A:w}},j=class{static getTickWithPriceAndTickspacing(e,t,n,r){let a=I.getTickFromSqrtPriceX64(I.priceToSqrtPriceX64(e,n,r))/t;return a<0?a=Math.floor(a):a=Math.ceil(a),a*t}static roundPriceWithTickspacing(e,t,n,r){let o=j.getTickWithPriceAndTickspacing(e,t,n,r),a=I.getSqrtPriceX64FromTick(o);return I.sqrtPriceX64ToPrice(a,n,r)}};var S=60,Q=512,y=class{static getTickArrayAddressByTick(e,t,n,r){let o=y.getTickArrayStartIndexByTick(n,r),{publicKey:a}=U(e,t,o);return a}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=y.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=S)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=k.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*k.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*S,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*S,o=Math.floor(t/r)+512,a=Math.abs(o);return{isInitialized:e.testn(a),startIndex:(a-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*S:e+t*S}static mergeTickArrayBitmap(e){let t=new gn(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let a=Math.floor(r/(n*S));return[...y.searchLowBitFromStart(e,t,a-1,o,n),...y.searchHightBitFromStart(e,t,a,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return y.searchHightBitFromStart(e,t,-7680,Q,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let a=[],s=y.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of s){let{publicKey:m}=U(e,t,c);a.push({tickArrayStartIndex:c,tickArrayAddress:m})}return a}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(m=>y.mergeTickArrayBitmap(m)),s=[];for(;n>=-7680;){let m=Math.floor((n+7680)/512),x=(n+7680)%512;if(a[m].testn(x)&&s.push(n),n--,s.length===r)break}let c=k.tickCount(o);return s.map(m=>m*c)}static searchHightBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(m=>y.mergeTickArrayBitmap(m)),s=[];for(;n<7680;){let m=Math.floor((n+7680)/512),x=(n+7680)%512;if(a[m].testn(x)&&s.push(n),n++,s.length===r)break}let c=k.tickCount(o);return s.map(m=>m*c)}static checkIsOutOfBoundary(e){return e<O||e>K}static nextInitTick(e,t,n,r,o){if(k.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let s=Math.floor((t-e.startTickIndex)/n);if(r)for(;s>=0;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s-1}else for(o||(s=s+1);s<S;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s+1}return null}static firstInitializedTick(e,t){if(t){let n=S-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<S;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=I.getSqrtPriceX64FromTick(t),o=I.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new $(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new $(1).div(t),o=j.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=I.getSqrtPriceX64FromTick(o),s=I.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new $(1).div(s)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=I.getSqrtPriceX64FromTick(t),o=I.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new $(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new $(1).div(t),o=j.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=I.getSqrtPriceX64FromTick(o),s=I.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new $(1).div(s)}}};var Me=14,z=class{static maxTickInTickarrayBitmap(e){return e*S*Q}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!k.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),a=r?t-k.tickCount(n):t+k.tickCount(n);if(a<-o||a>=o)return{isInit:!1,tickIndex:t};let s=n*S,c=a/s+512;a<0&&a%s!=0&&c--;let m=Math.abs(c);if(r){let x=e.shln(1024-m-1),B=nt(1024,x);if(B!==null){let w=(m-B-512)*s;return{isInit:!0,tickIndex:w}}else return{isInit:!1,tickIndex:-o}}else{let x=e.shrn(m),B=rt(1024,x);if(B!==null){let w=(m+B-512)*s;return{isInit:!0,tickIndex:w}}else return{isInit:!1,tickIndex:o-k.tickCount(n)}}}},De=class{static getBitmapOffset(e,t){if(!k.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=z.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=z.maxTickInTickarrayBitmap(e),n=-t;if(K<=t)throw Error(`extensionTickBoundary check error: ${K}, ${t}`);if(n<=O)throw Error(`extensionTickBoundary check error: ${n}, ${O}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:y.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=k.tickCount(t),a=n?e-o:e+o,{tickarrayBitmap:s}=this.getBitmap(a,t,r);return this.nextInitializedTickArrayInBitmap(s,a,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:a}=z.getBitmapTickBoundary(t,n),s=this.tickArrayOffsetInBitmap(t,n);if(r){let c=y.mergeTickArrayBitmap(e).shln(Q-1-s),m=ie(512,c)?null:Le(512,c);if(m!==null){let x=t-m*k.tickCount(n);return{isInit:!0,tickIndex:x}}else return{isInit:!1,tickIndex:o}}else{let c=y.mergeTickArrayBitmap(e).shrn(s),m=ie(512,c)?null:Re(512,c);if(m!==null){let x=t+m*k.tickCount(n);return{isInit:!0,tickIndex:x}}else return{isInit:!1,tickIndex:a-k.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%z.maxTickInTickarrayBitmap(t),r=Math.floor(n/k.tickCount(t));return e<0&&n!=0&&(r=Q-r),r}};export{Me as EXTENSION_TICKARRAY_BITMAP_SIZE,z as TickArrayBitmap,De as TickArrayBitmapExtensionUtils};
//# sourceMappingURL=tickarrayBitmap.mjs.map