var Dt=Object.defineProperty,Mt=Object.defineProperties;var Nt=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var ut=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var at=(n,e,t)=>e in n?Dt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,K=(n,e)=>{for(var t in e||(e={}))ut.call(e,t)&&at(n,t,e[t]);if(Be)for(var t of Be(e))ct.call(e,t)&&at(n,t,e[t]);return n},H=(n,e)=>Mt(n,Nt(e));var me=(n,e)=>{var t={};for(var r in n)ut.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Be)for(var r of Be(n))e.indexOf(r)<0&&ct.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as ke}from"@solana/web3.js";import _t from"bn.js";import{PublicKey as g}from"@solana/web3.js";var Sn=new g("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),An=new g("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),In=new g("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),kn=new g("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Bn=new g("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ln=new g("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Cn=new g("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Rn=new g("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),_n=new g("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Dn=new g("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Mn=new g("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Nn=new g("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),En=new g("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),On=new g("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Kn=new g("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Fn=new g("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Et=new g("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ot=new g("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Kt=new g("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ft=new g("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Vn=new g("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),vn=new g("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Wn=new g("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Un=new g("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),qn=new g("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Gn=new g("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Hn=new g("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),jn=new g("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),zn=new g("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Yn=new g("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Jn=new g("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX"),pe={IDO_PROGRAM_ID_V1:Et,IDO_PROGRAM_ID_V2:Ot,IDO_PROGRAM_ID_V3:Kt,IDO_PROGRAM_ID_V4:Ft};var Zn={OPEN_BOOK_PROGRAM:new g("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new g("Ray1111111111111111111111111111111111111111"),AMM_V4:new g("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new g("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new g("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new g("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new g("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new g("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new g("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new g("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new g("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new g("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:g.default,Router:new g("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new g("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new g("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new g("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new g("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new g("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new g("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new g("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new g("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new g("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new g("Ray1111111111111111111111111111111111111111")};import{PublicKey as O,SystemProgram as lt,SYSVAR_RENT_PUBKEY as Vt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vt}from"@solana/spl-token";function Fe({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var tr=[Fe({pubkey:vt,isWritable:!1}),Fe({pubkey:lt.programId,isWritable:!1}),Fe({pubkey:Vt,isWritable:!1})];function mt({publicKey:n,transformSol:e}){let t=Ve(n.toString());if(t instanceof O)return e&&t.equals(de)?se:t;if(e&&t.toString()===de.toBase58())return se;if(typeof t=="string"){if(t===O.default.toBase58())return O.default;try{return new O(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ve(n){try{return new O(n)}catch{return n}}var nr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),rr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),pt=new O("SysvarRent111111111111111111111111111111111"),ve=new O("SysvarC1ock11111111111111111111111111111111"),or=new O("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ir=new O("Sysvar1nstructions1111111111111111111111111"),dt=lt.programId,sr=new O("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ar=new O("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ur=new O("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),cr=new O("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),lr=new O("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),mr=new O("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),pr=new O("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),dr=new O("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),fr=new O("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),gr=new O("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),hr=new O("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),se=new O("So11111111111111111111111111111111111111112"),de=O.default;import{PublicKey as dn}from"@solana/web3.js";import fn from"bn.js";import ln from"big.js";import Me from"bn.js";import Z from"bn.js";import so from"decimal.js";import{PublicKey as Wt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ft}from"@solana/spl-token";var gt={chainId:101,address:Wt.default.toBase58(),programId:ft.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ne={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ft.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as We}from"@solana/web3.js";var Ue=class{constructor({mint:e,decimals:t,symbol:r,name:m,skipMint:p=!1,isToken2022:f=!1}){if(e===de.toBase58()||e instanceof We&&de.equals(e)){this.decimals=ne.decimals,this.symbol=ne.symbol,this.name=ne.name,this.mint=new We(ne.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=m||e.toString().substring(0,6),this.mint=p?We.default:mt({publicKey:e}),this.isToken2022=f}equals(e){return this===e?!0:this.mint.equals(e.mint)}},re=Ue;re.WSOL=new Ue(H(K({},ne),{mint:ne.address}));var qe=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Le=qe;Le.SOL=new qe(gt);import Re from"big.js";import zt from"bn.js";import Yt from"decimal.js-light";import{get as ht,set as Ut}from"lodash";var Ge=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},yt={},qt={};function W(n){let e=ht(yt,n);if(!e){let t=ht(qt,n);e=new Ge({name:n,logLevel:t}),Ut(yt,n,e)}return e}import fe from"bn.js";var bt=9007199254740991;function G(n){let e=W("Raydium_parseBigNumberish");if(n instanceof fe)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new fe(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=bt||n<=-bt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new fe(String(n))):typeof n=="bigint"?new fe(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new fe(0))}import Gt from"toformat";var Ht=Gt,ge=Ht;var Ce=W("module/fraction"),He=ge(Re),he=ge(Yt),Jt={[0]:he.ROUND_DOWN,[1]:he.ROUND_HALF_UP,[2]:he.ROUND_UP},Zt={[0]:Re.roundDown,[1]:Re.roundHalfUp,[2]:Re.roundUp},M=class{constructor(e,t=new zt(1)){this.numerator=G(e),this.denominator=G(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new M(this.denominator,this.numerator)}add(e){let t=e instanceof M?e:new M(G(e));return this.denominator.eq(t.denominator)?new M(this.numerator.add(t.numerator),this.denominator):new M(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof M?e:new M(G(e));return this.denominator.eq(t.denominator)?new M(this.numerator.sub(t.numerator),this.denominator):new M(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof M?e:new M(G(e));return new M(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof M?e:new M(G(e));return new M(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||Ce.logWithError(`${e} is not an integer.`),e<=0&&Ce.logWithError(`${e} is not positive.`),he.set({precision:e+1,rounding:Jt[r]});let m=new he(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return m.toFormat(m.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||Ce.logWithError(`${e} is not an integer.`),e<0&&Ce.logWithError(`${e} is negative.`),He.DP=e,He.RM=Zt[r]||1,new He(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import Xt from"bn.js";var Tt=new M(new Xt(100)),ae=class extends M{toSignificant(e=5,t,r){return this.mul(Tt).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(Tt).toFixed(e,t,r)}};var Qt=W("Raydium_price"),Y=class extends M{constructor(t){let{baseToken:r,quoteToken:m,numerator:p,denominator:f}=t;super(p,f);this.baseToken=r,this.quoteToken=m,this.scalar=new M(je(r.decimals),je(m.decimals))}get raw(){return new M(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Y({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Qt.logWithError("mul token not equals");let r=super.mul(t);return new Y({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,m){return this.adjusted.toSignificant(t,r,m)}toFixed(t=this.quoteToken.decimals,r,m){return this.adjusted.toFixed(t,r,m)}};var $t=new Z(0),ho=new Z(1),yo=new Z(2),bo=new Z(3),To=new Z(5),ze=new Z(10),xo=new Z(100),Po=new Z(1e3),wo=new Z(1e4);function je(n){return ze.pow(G(n))}import{PublicKey as en}from"@solana/web3.js";import{MINT_SIZE as Mo,TOKEN_PROGRAM_ID as No,getTransferFeeConfig as Eo,unpackMint as Oo}from"@solana/spl-token";var Ye=W("Raydium_accountInfo_util");async function xt(n,e,t){let{batchRequest:r,commitment:m="confirmed",chunkCount:p=100}=K({batchRequest:!1},t),f=Je(e,p),o=new Array(f.length).fill([]);if(r){let A=f.map(b=>{let w=n._buildArgs([b.map(P=>P.toBase58())],m,"base64");return{methodName:"getMultipleAccounts",args:w}}),l=Je(A,10);o=(await(await Promise.all(l.map(async b=>await n._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&Ye.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(w=>{if(w){let{data:P,executable:c,lamports:h,owner:a,rentEpoch:B}=w;return P.length!==2&&P[1]!=="base64"&&Ye.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:c,lamports:h,owner:new en(a),rentEpoch:B}}return null})))}else try{o=await Promise.all(f.map(A=>n.getMultipleAccountsInfo(A,m)))}catch(A){A instanceof Error&&Ye.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${A.message}`)}return o.flat()}function Je(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var j=class{constructor(e){this._owner=e}get publicKey(){return j.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return j.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return j.isKeyPair(this._owner)}get isPublicKey(){return j.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!j.isKeyPair(e)}};import{PublicKey as ti}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ri}from"@solana/spl-token";import{ComputeBudgetProgram as Pt,Keypair as St,PublicKey as jo,Transaction as At,TransactionMessage as tn,VersionedTransaction as It}from"@solana/web3.js";var ye={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as nn}from"@solana/spl-token";var wt=W("Raydium_txUtil"),kt=1644;function be(n){let e=[],t=[];return n.microLamports&&(e.push(Pt.setComputeUnitPrice({microLamports:n.microLamports})),t.push(ye.SetComputeUnitPrice)),n.units&&(e.push(Pt.setComputeUnitLimit({units:n.units})),t.push(ye.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function oe(n,e){var r,m;let t=e!=null?e:"confirmed";return(m=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:m.blockhash}async function Te(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let m=setTimeout(r,6e4);n.onSignature(e,p=>{if(clearTimeout(m),!p.err){t("");return}r(Object.assign(p.err,{txId:e}))},"confirmed")})}function rn(n,e){n.length<1&&wt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&wt.logWithError(`no signers provided:, ${e.toString()}`);let t=new At;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<kt}catch{return!1}}function xe({instructions:n,payer:e,signers:t}){return rn(n,[e,...t])}function X({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=St.generate().publicKey.toString()}){let p=new tn({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new It(p).serialize()).toString("base64").length<kt}catch{return!1}}var on=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),sn=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof It&&(e=on(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ee(n){let e=[];return n.forEach(t=>{t instanceof At&&(t.recentBlockhash||(t.recentBlockhash=nn.toBase58()),t.feePayer||(t.feePayer=St.generate().publicKey)),e.push(sn(t))}),console.log("simulate tx string:",e),e}import ai from"bn.js";import{PublicKey as Ze,AddressLookupTableAccount as ce}from"@solana/web3.js";async function _e({connection:n,address:e,cluster:t="mainnet"}){let r=await xt(n,[...new Set(e.map(p=>p.toString()))].map(p=>new Ze(p))),m={};for(let p=0;p<e.length;p++){let f=r[p],o=e[p];if(!f)continue;let A=new ce({key:o,state:ce.deserialize(f.data)});m[o.toString()]=A,t==="devnet"?ue[o.toString()]=A:te[o.toString()]=A}return m}var te={},Xe=async n=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(te[e])return te;let t=new Ze(e),r=await n.getAccountInfo(t);return r&&(te[e]=new ce({key:t,state:ce.deserialize(r.data)})),te},ue={},De=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ue[e])return ue;let t=new Ze(e),r=await n.getAccountInfo(t);return r&&(ue[e]=new ce({key:t,state:ce.deserialize(r.data)})),ue};import{PublicKey as ie,sendAndConfirmTransaction as Qe,SystemProgram as an,Transaction as Pe,TransactionMessage as Q,VersionedTransaction as $}from"@solana/web3.js";import un from"axios";var we=2e3,Se=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await un.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=be(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(an.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ie(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(ye.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:m=[],endInstructionTypes:p=[],lookupTableAddress:f=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...m),this.endInstructionTypes.push(...p),this.lookupTableAddress.push(...f.filter(o=>o!==ie.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(K({},t||{})):this.build(t)}build(e){var r;let t=new Pe;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(m=>m.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async m=>{var x;let{recentBlockHash:p,skipPreflight:f=!0,sendAndConfirm:o,notSendToRpc:A}=m||{},l=p!=null?p:await oe(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),ee([t]),(x=this.owner)!=null&&x.isKeyPair)return{txId:o?await Qe(this.connection,t,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:f}),signedTx:t};if(this.signAllTransactions){let b=await this.signAllTransactions([t]);if(this.signers.length)for(let w of b)try{w.sign(...this.signers)}catch{}return{txId:A?"":await this.connection.sendRawTransaction(b[0].serialize(),{skipPreflight:f}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:m}=this.build(r),p=t.filter(x=>x.transaction.instructions.length>0),f=[m,...p.map(x=>x.transaction)],o=[this.signers,...p.map(x=>x.signers)],A=[...this.instructionTypes,...p.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:f,signers:o,instructionTypes:A,execute:async x=>{var B;let{sequentially:b,onTxUpdate:w,skipTxCount:P=0,recentBlockHash:c,skipPreflight:h=!0}=x||{},a=c!=null?c:await oe(this.connection,this.blockhashCommitment);if((B=this.owner)!=null&&B.isKeyPair){if(b){let T=[],_=0;for(let u of f){if(++_,_<=P)continue;let i=await Qe(this.connection,u,this.signers.find(s=>s.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:h});T.push(i)}return{txIds:T,signedTxs:f}}return{txIds:await await Promise.all(f.map(async T=>(T.recentBlockhash=a,await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:h})))),signedTxs:f}}if(this.signAllTransactions){let T=f.map((u,i)=>(u.recentBlockhash=a,o[i].length&&u.sign(...o[i]),u));ee(T);let _=await this.signAllTransactions(T);if(b){let u=0,i=[],s=async()=>{if(!_[u])return;let y=await this.connection.sendRawTransaction(_[u].serialize(),{skipPreflight:h});i.push({txId:y,status:"sent",signedTx:_[u]}),w==null||w([...i]),u++;let d=!1,I=null,N=null,D=S=>{I!==null&&clearInterval(I),N!==null&&this.connection.removeSignatureListener(N);let k=i.findIndex(L=>L.txId===y);if(k>-1){if(i[k].status==="error"||i[k].status==="success")return;i[k].status=S.err?"error":"success"}w==null||w([...i]),S.err||s()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var S;if(d){clearInterval(I);return}try{let k=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});k&&(d=!0,clearInterval(I),D({err:((S=k.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",y))}catch(k){d=!0,clearInterval(I),console.error("getTransaction timeout:",k,y)}},we)),N=this.connection.onSignature(y,S=>{if(d){this.connection.removeSignatureListener(N);return}d=!0,D(S)},"confirmed"),this.connection.getSignatureStatus(y)};return await s(),{txIds:i.map(y=>y.txId),signedTxs:_}}else{let u=[];for(let i=0;i<_.length;i+=1){let s=await this.connection.sendRawTransaction(_[i].serialize(),{skipPreflight:h});u.push(s)}return{txIds:u,signedTxs:_}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var h;let c=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:m,recentBlockhash:p}=c,f=me(c,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=K(K({},this.cluster==="devnet"?await De(this.connection):await Xe(this.connection)),t),A=Array.from(new Set([...r,...this.lookupTableAddress])),l=[];for(let a of A)o[a]===void 0&&l.push(new ie(a));let x=await _e({connection:this.connection,address:l});for(let[a,B]of Object.entries(x))o[a]=B;let b=m?ie.default.toBase58():p!=null?p:await oe(this.connection,this.blockhashCommitment),w=new Q({payerKey:this.feePayer,recentBlockhash:b,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((h=this.owner)==null?void 0:h.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new $(w);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var u;let{skipPreflight:B=!0,sendAndConfirm:T,notSendToRpc:_}=a||{};if(ee([P]),(u=this.owner)!=null&&u.isKeyPair){let i=await this.connection.sendTransaction(P,{skipPreflight:B});return T&&await Te(this.connection,i),{txId:i,signedTx:P}}if(this.signAllTransactions){let i=await this.signAllTransactions([P]);if(this.signers.length)for(let s of i)try{s.sign(this.signers)}catch{}return{txId:_?"":await this.connection.sendTransaction(i[0],{skipPreflight:B}),signedTx:i[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:m}=await this.buildV0(r),p=t.filter(x=>x.builder.instructions.length>0),f=[m,...p.map(x=>x.transaction)],o=[this.signers,...p.map(x=>x.signers)],A=[...this.instructionTypes,...p.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),f.forEach(async(x,b)=>{x.sign(o[b])}),{builder:this,transactions:f,signers:o,instructionTypes:A,buildProps:r,execute:async x=>{var h;let{sequentially:b,onTxUpdate:w,recentBlockHash:P,skipPreflight:c=!0}=x||{};if(P&&f.forEach(a=>a.message.recentBlockhash=P),ee(f),(h=this.owner)!=null&&h.isKeyPair){if(b){let a=[];for(let B of f){let T=await this.connection.sendTransaction(B,{skipPreflight:c});await Te(this.connection,T),a.push(T)}return{txIds:a,signedTxs:f}}return{txIds:await Promise.all(f.map(async a=>await this.connection.sendTransaction(a,{skipPreflight:c}))),signedTxs:f}}if(this.signAllTransactions){let a=await this.signAllTransactions(f);if(b){let B=0,T=[],_=async()=>{if(!a[B])return;let u=await this.connection.sendTransaction(a[B],{skipPreflight:c});T.push({txId:u,status:"sent",signedTx:a[B]}),w==null||w([...T]),B++;let i=!1,s=null,y=null,d=I=>{s!==null&&clearInterval(s),y!==null&&this.connection.removeSignatureListener(y);let N=T.findIndex(D=>D.txId===u);if(N>-1){if(T[N].status==="error"||T[N].status==="success")return;T[N].status=I.err?"error":"success"}w==null||w([...T]),I.err||_()};this.loopMultiTxStatus&&(s=setInterval(async()=>{var I;if(i){clearInterval(s);return}try{let N=await this.connection.getTransaction(u,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(i=!0,clearInterval(s),d({err:((I=N.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",u))}catch(N){i=!0,clearInterval(s),console.error("getTransaction timeout:",N,u)}},we)),y=this.connection.onSignature(u,I=>{if(i){this.connection.removeSignatureListener(y);return}i=!0,d(I)},"confirmed"),this.connection.getSignatureStatus(u)};return _(),{txIds:[],signedTxs:a}}else{let B=[];for(let T=0;T<a.length;T+=1){let _=await this.connection.sendTransaction(a[T],{skipPreflight:c});B.push(_)}return{txIds:B,signedTxs:a}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var w;let b=e||{},{splitIns:t=[],computeBudgetConfig:r}=b,m=me(b,["splitIns","computeBudgetConfig"]),p=r?be(r):{instructions:[],instructionTypes:[]},f=this.signers.reduce((P,c)=>H(K({},P),{[c.publicKey.toBase58()]:c}),{}),o=[],A=[],l=[],x=0;if(this.allInstructions.forEach(P=>{let c=[...l,P],h=r?[...p.instructions,...c]:c,B=[...new Set(c.map(T=>T.keys.filter(_=>_.isSigner).map(_=>_.pubkey.toString())).flat()).values()].map(T=>new ie(T));if(P!==t[x]&&l.length<12&&(xe({instructions:h,payer:this.feePayer,signers:B})||xe({instructions:c,payer:this.feePayer,signers:B})))l.push(P);else{if(l.length===0)throw Error("item ins too big");x+=P===t[x]?1:0,xe({instructions:r?[...p.instructions,...l]:[...l],payer:this.feePayer,signers:B})?o.push(new Pe().add(...p.instructions,...l)):o.push(new Pe().add(...l)),A.push(Array.from(new Set(l.map(T=>T.keys.filter(_=>_.isSigner).map(_=>_.pubkey.toString())).flat())).map(T=>f[T]).filter(T=>T!==void 0)),l=[P]}}),l.length>0){let c=[...new Set(l.map(h=>h.keys.filter(a=>a.isSigner).map(a=>a.pubkey.toString())).flat()).values()].map(h=>f[h]).filter(h=>h!==void 0);xe({instructions:r?[...p.instructions,...l]:[...l],payer:this.feePayer,signers:c.map(h=>h.publicKey)})?o.push(new Pe().add(...p.instructions,...l)):o.push(new Pe().add(...l)),A.push(c)}return o.forEach(P=>P.feePayer=this.feePayer),(w=this.owner)!=null&&w.signer&&A.forEach(P=>{P.some(c=>c.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:o,signers:A,instructionTypes:this.instructionTypes,execute:async P=>{var u;let{sequentially:c,onTxUpdate:h,skipTxCount:a=0,recentBlockHash:B,skipPreflight:T=!0}=P||{},_=B!=null?B:await oe(this.connection,this.blockhashCommitment);if(o.forEach(async(i,s)=>{i.recentBlockhash=_,A[s].length&&i.sign(...A[s])}),ee(o),(u=this.owner)!=null&&u.isKeyPair){if(c){let i=0,s=[];for(let y of o){if(++i,i<=a){s.push("tx skipped");continue}let d=await Qe(this.connection,y,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});s.push(d)}return{txIds:s,signedTxs:o}}return{txIds:await Promise.all(o.map(async i=>await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:T}))),signedTxs:o}}if(this.signAllTransactions){let i=await this.signAllTransactions(o.slice(a,o.length)),s=[...o.slice(0,a),...i];if(c){let y=0,d=[],I=async()=>{if(!s[y])return;y<a&&(d.push({txId:"",status:"success",signedTx:s[y]}),h==null||h([...d]),y++,I());let N=await this.connection.sendRawTransaction(s[y].serialize(),{skipPreflight:T});d.push({txId:N,status:"sent",signedTx:s[y]}),h==null||h([...d]),y++;let D=!1,S=null,k=null,L=F=>{S!==null&&clearInterval(S),k!==null&&this.connection.removeSignatureListener(k);let E=d.findIndex(U=>U.txId===N);if(E>-1){if(d[E].status==="error"||d[E].status==="success")return;d[E].status=F.err?"error":"success"}h==null||h([...d]),F.err||I()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var F;if(D){clearInterval(S);return}try{let E=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(D=!0,clearInterval(S),L({err:((F=E.meta)==null?void 0:F.err)||null}),console.log("tx status from getTransaction:",N))}catch(E){D=!0,clearInterval(S),console.error("getTransaction timeout:",E,N)}},we)),k=this.connection.onSignature(N,F=>{if(D){this.connection.removeSignatureListener(k);return}D=!0,L(F)},"confirmed"),this.connection.getSignatureStatus(N)};return await I(),{txIds:d.map(N=>N.txId),signedTxs:s}}else{let y=[];for(let d=0;d<s.length;d+=1){let I=await this.connection.sendRawTransaction(s[d].serialize(),{skipPreflight:T});y.push(I)}return{txIds:y,signedTxs:s}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:m||{}}}async sizeCheckBuildV0(e){var _;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:m={},lookupTableAddress:p=[]}=T,f=me(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=K(K({},this.cluster==="devnet"?await De(this.connection):te),m),A=Array.from(new Set([...this.lookupTableAddress,...p])),l=[];for(let u of A)o[u]===void 0&&l.push(new ie(u));let x=await _e({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?be(t):{instructions:[],instructionTypes:[]},w=await oe(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>H(K({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(X({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||X({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let d of[...new Set(A)])o[d]!==void 0&&(y[d]=o[d]);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let d=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}else{let d=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}h.push(Array.from(new Set(a.map(d=>d.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(d=>P[d]).filter(d=>d!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(_=this.owner)!=null&&_.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,blockHash:w,instructionTypes:this.instructionTypes,execute:async u=>{var N;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:d,skipPreflight:I=!0}=u||{};if(c.map(async(D,S)=>{h[S].length&&D.sign(h[S]),d&&(D.message.recentBlockhash=d)}),ee(c),(N=this.owner)!=null&&N.isKeyPair){if(i){let D=0,S=[];for(let k of c){if(++D,D<=y){console.log("skip tx: ",D),S.push("tx skipped");continue}let L=await this.connection.sendTransaction(k,{skipPreflight:I});await Te(this.connection,L),S.push(L)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(y,c.length)),S=[...c.slice(0,y),...D];if(i){let k=0,L=[],F=async()=>{if(!S[k])return;if(k<y){L.push({txId:"",status:"success",signedTx:S[k]}),s==null||s([...L]),k++,F();return}let E=await this.connection.sendTransaction(S[k],{skipPreflight:I});L.push({txId:E,status:"sent",signedTx:S[k]}),s==null||s([...L]),k++;let U=!1,q=null,z=null,le=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let V=L.findIndex(Ke=>Ke.txId===E);if(V>-1){if(L[V].status==="error"||L[V].status==="success")return;L[V].status=v.err?"error":"success"}s==null||s([...L]),v.err||F()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let V=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(U=!0,clearInterval(q),le({err:((v=V.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(V){U=!0,clearInterval(q),console.error("getTransaction timeout:",V,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,le(v)},"confirmed"),this.connection.getSignatureStatus(E)};return F(),{txIds:[],signedTxs:S}}else{let k=[];for(let L=0;L<S.length;L+=1){let F=await this.connection.sendTransaction(S[L],{skipPreflight:I});k.push(F)}return{txIds:k,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}async buildSniperTransaction(e){var _;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:m={},lookupTableAddress:p=[]}=T,f=me(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=K(K({},this.cluster==="devnet"?await De(this.connection):await Xe(this.connection)),m),A=Array.from(new Set([...this.lookupTableAddress,...p])),l=[];for(let u of A)o[u]===void 0&&l.push(new ie(u));let x=await _e({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?be(t):{instructions:[],instructionTypes:[]},w=await oe(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>H(K({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(X({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||X({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let d of[...new Set(A)])o[d]!==void 0&&(y[d]=o[d]);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let d=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}else{let d=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}h.push(Array.from(new Set(a.map(d=>d.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(d=>P[d]).filter(d=>d!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(_=this.owner)!=null&&_.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,instructionTypes:this.instructionTypes,execute:async u=>{var N;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:d,skipPreflight:I=!0}=u||{};if(c.map(async(D,S)=>{h[S].length&&D.sign(h[S]),d&&(D.message.recentBlockhash=d)}),ee(c),(N=this.owner)!=null&&N.isKeyPair){if(i){let D=0,S=[];for(let k of c){if(++D,D<=y){console.log("skip tx: ",D),S.push("tx skipped");continue}let L=await this.connection.sendTransaction(k,{skipPreflight:I});await Te(this.connection,L),S.push(L)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(y,c.length)),S=[...c.slice(0,y),...D];if(i){let k=0,L=[],F=async()=>{if(!S[k])return;if(k<y){L.push({txId:"",status:"success",signedTx:S[k]}),s==null||s([...L]),k++,F();return}let E=await this.connection.sendTransaction(S[k],{skipPreflight:I});L.push({txId:E,status:"sent",signedTx:S[k]}),s==null||s([...L]),k++;let U=!1,q=null,z=null,le=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let V=L.findIndex(Ke=>Ke.txId===E);if(V>-1){if(L[V].status==="error"||L[V].status==="success")return;L[V].status=v.err?"error":"success"}s==null||s([...L]),v.err||F()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let V=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(U=!0,clearInterval(q),le({err:((v=V.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(V){U=!0,clearInterval(q),console.error("getTransaction timeout:",V,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,le(v)},"confirmed"),this.connection.getSignatureStatus(E)};return F(),{txIds:[],signedTxs:S}}else{let k=[];for(let L=0;L<S.length;L+=1){let F=await this.connection.sendTransaction(S[L],{skipPreflight:I});k.push(F)}return{txIds:k,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}};import cn from"bn.js";var Li=new cn(1e6);var mn=W("Raydium_amount"),Bt=ge(ln);function pn(n,e){let t="0",r="0";if(n.includes(".")){let m=n.split(".");m.length===2?([t,r]=m,r=r.padEnd(e,"0")):mn.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var J=class extends M{constructor(t,r,m=!0,p){let f=new Me(0),o=ze.pow(new Me(t.decimals));if(m)f=G(r);else{let A=new Me(0),l=new Me(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[x,b]=pn(r.toString(),t.decimals);A=G(x),l=G(b)}A=A.mul(o),f=A.add(l)}super(f,o);this.logger=W(p||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new J(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new J(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,m=0){return super.toSignificant(t,r,m)}toFixed(t=this.token.decimals,r,m=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,m)}toExact(t={groupSeparator:""}){return Bt.DP=this.token.decimals,new Bt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function gn(n){return typeof n=="object"&&n!==null&&![re,J,dn,M,fn,Y,ae].some(e=>typeof e=="object"&&n instanceof e)}function Ne(n){return typeof n=="string"?Ve(n):Array.isArray(n)?n.map(e=>Ne(e)):gn(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,Ne(t)])):n}var $e=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ae=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new Se({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let r=new j(e);return new Se({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:r,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug($e(e))}logInfo(...e){this.logger.info($e(e))}logAndCreateError(...e){let t=$e(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as Tn,TransactionInstruction as ot}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as it}from"@solana/spl-token";import{PublicKey as ka}from"@solana/web3.js";import La,{isBN as Ca}from"bn.js";import{bits as Is,BitStructure as ks,blob as Bs,Blob as Ls,cstr as Cs,f32 as Rs,f32be as _s,f64 as Ds,f64be as Ms,greedy as Ns,Layout as Es,ns64 as Os,ns64be as Ks,nu64 as hn,nu64be as Fs,offset as Vs,s16 as vs,s16be as Ws,s24 as Us,s24be as qs,s32 as Gs,s32be as Hs,s40 as js,s40be as zs,s48 as Ys,s48be as Js,s8 as Zs,seq as Xs,struct as Qs,Structure as yn,u16 as $s,u16be as ea,u24 as ta,u24be as na,u32 as ra,u32be as oa,u40 as ia,u40be as sa,u48 as aa,u48be as ua,u8 as ca,UInt as bn,union as la,Union as ma,unionLayoutDiscriminator as pa,utf8 as da}from"@solana/buffer-layout";var Lt=yn;var Ct=bn;var Rt=hn;function tt(n){return new Ct(1,n)}var et=class extends Lt{decode(e,t){return super.decode(e,t)}};function nt(n,e,t){return new et(n,e,t)}var rt=nt([tt("instruction"),Rt("amount")]),Ie=nt([tt("instruction")]);function va({programId:n,amount:e,instructionKeys:t}){let r=[{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},...Object.entries(t).map(([p,f])=>({pubkey:f,isSigner:p==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(p)}))],m=Buffer.alloc(rt.span);return rt.encode({instruction:1,amount:Number(e)},m),new ot({keys:r,programId:n,data:m})}function Ee({programId:n},e){let t=[{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},...Object.entries(e).map(([m,p])=>({pubkey:p,isSigner:m==="userOwner",isWritable:!["authority","userOwner"].includes(m)}))],r=Buffer.alloc(Ie.span);return Ie.encode({instruction:2},r),new ot({keys:t,programId:n,data:r})}function st(n){let{poolConfig:e,userKeys:t,side:r}=n,m=r==="base"?t.baseTokenAccount:t.quoteTokenAccount,p=r==="base"?e.baseVault:e.quoteVault,f=Buffer.alloc(Ie.span);Ie.encode({instruction:2},f);let o=[{pubkey:it,isWritable:!1,isSigner:!1},{pubkey:Tn,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new ot({programId:e.programId,keys:o,data:f})}var xn={[pe.IDO_PROGRAM_ID_V1.toString()]:1,[pe.IDO_PROGRAM_ID_V2.toString()]:2,[pe.IDO_PROGRAM_ID_V3.toString()]:3,[pe.IDO_PROGRAM_ID_V4.toString()]:4},Oe=class extends Ae{async claim({ownerInfo:e,idoKeys:t,associatedOnly:r=!0,checkCreateATAOwner:m=!1,txVersion:p,feePayer:f}){let o=this.createTxBuilder(f),A=xn[t.programId];A||this.logAndCreateError("invalid version",A);let l=Ne(t),[x,b]=[!new _t(e.coin).isZero(),!new _t(e.pc).isZero()],w=l.projectInfo.mint.address.equals(se),{account:P,instructionParams:c}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.projectInfo.mint.programId,mint:l.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:r,checkCreateATAOwner:m});!P&&x&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),x&&c&&o.addInstruction(c);let h=l.buyInfo.mint.address.equals(se),{account:a,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.buyInfo.mint.programId,mint:l.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:r,checkCreateATAOwner:m});if(!P&&b&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),b&&B&&o.addInstruction(B),(!P||!a)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),A===3)return o.addInstruction({instructions:[...x?[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolTokenAccount:l.projectInfo.vault,userTokenAccount:P,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...b?[Ee({programId:new ke(t.programId)},{idoId:l.id,authority:l.authority,poolTokenAccount:l.buyInfo.vault,userTokenAccount:a,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:p});if(A<3)return!x&&!b&&this.logAndCreateError("no claimable rewards"),o.addInstruction({instructions:[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolQuoteTokenAccount:l.buyInfo.vault,poolBaseTokenAccount:l.projectInfo.vault,userQuoteTokenAccount:a,userBaseTokenAccount:P,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:p});let T={poolConfig:{id:l.id,programId:l.programId,authority:l.authority,baseVault:l.projectInfo.vault,quoteVault:l.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:P,quoteTokenAccount:a,ledgerAccount:new ke(e.userIdoInfo),owner:this.scope.ownerPubKey}};return o.addInstruction({instructions:[...x?[st(H(K({},T),{side:"base"}))]:[],...b?[st(H(K({},T),{side:"quote"}))]:[]]}).versionBuild({txVersion:p})}};export{Ie as claimLayout,Oe as default,Ee as makeClaimInstruction,st as makeClaimInstructionV4,va as makePurchaseInstruction,rt as purchaseLayout};
//# sourceMappingURL=index.mjs.map