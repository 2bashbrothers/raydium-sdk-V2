var Mt=Object.defineProperty,Nt=Object.defineProperties;var _t=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable;var st=(n,e,t)=>e in n?Mt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,K=(n,e)=>{for(var t in e||(e={}))at.call(e,t)&&st(n,t,e[t]);if(Be)for(var t of Be(e))ut.call(e,t)&&st(n,t,e[t]);return n},j=(n,e)=>Nt(n,_t(e));var le=(n,e)=>{var t={};for(var r in n)at.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Be)for(var r of Be(n))e.indexOf(r)<0&&ut.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as ke}from"@solana/web3.js";import Dt from"bn.js";import{PublicKey as g}from"@solana/web3.js";var wn=new g("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),An=new g("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Sn=new g("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),In=new g("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),kn=new g("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Bn=new g("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Cn=new g("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ln=new g("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Rn=new g("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Dn=new g("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Mn=new g("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Nn=new g("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),_n=new g("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),En=new g("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),On=new g("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Kn=new g("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Et=new g("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ot=new g("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Kt=new g("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ft=new g("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Fn=new g("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Vn=new g("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),vn=new g("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Wn=new g("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Un=new g("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),qn=new g("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Gn=new g("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),jn=new g("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Hn=new g("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),zn=new g("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Zn=new g("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX"),me={IDO_PROGRAM_ID_V1:Et,IDO_PROGRAM_ID_V2:Ot,IDO_PROGRAM_ID_V3:Kt,IDO_PROGRAM_ID_V4:Ft};var Jn={OPEN_BOOK_PROGRAM:new g("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new g("Ray1111111111111111111111111111111111111111"),AMM_V4:new g("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new g("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new g("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new g("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new g("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new g("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new g("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new g("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new g("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new g("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:g.default,Router:new g("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new g("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new g("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new g("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new g("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new g("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new g("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new g("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new g("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new g("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new g("Ray1111111111111111111111111111111111111111")};import{PublicKey as O,SystemProgram as ct,SYSVAR_RENT_PUBKEY as Vt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vt}from"@solana/spl-token";function Fe({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var er=[Fe({pubkey:vt,isWritable:!1}),Fe({pubkey:ct.programId,isWritable:!1}),Fe({pubkey:Vt,isWritable:!1})];function lt({publicKey:n,transformSol:e}){let t=Ve(n.toString());if(t instanceof O)return e&&t.equals(pe)?ie:t;if(e&&t.toString()===pe.toBase58())return ie;if(typeof t=="string"){if(t===O.default.toBase58())return O.default;try{return new O(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ve(n){try{return new O(n)}catch{return n}}var tr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),nr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),mt=new O("SysvarRent111111111111111111111111111111111"),ve=new O("SysvarC1ock11111111111111111111111111111111"),rr=new O("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),or=new O("Sysvar1nstructions1111111111111111111111111"),pt=ct.programId,ir=new O("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),sr=new O("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ar=new O("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ur=new O("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),cr=new O("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),lr=new O("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),mr=new O("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),pr=new O("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),dr=new O("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),fr=new O("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),gr=new O("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ie=new O("So11111111111111111111111111111111111111112"),pe=O.default;import{PublicKey as dn}from"@solana/web3.js";import fn from"bn.js";import ln from"big.js";import Ne from"bn.js";import Q from"bn.js";import io from"decimal.js";import{PublicKey as Wt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as dt}from"@solana/spl-token";var ft={chainId:101,address:Wt.default.toBase58(),programId:dt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},te={chainId:101,address:"So11111111111111111111111111111111111111112",programId:dt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as We}from"@solana/web3.js";var Ue=class{constructor({mint:e,decimals:t,symbol:r,name:m,skipMint:p=!1,isToken2022:f=!1}){if(e===pe.toBase58()||e instanceof We&&pe.equals(e)){this.decimals=te.decimals,this.symbol=te.symbol,this.name=te.name,this.mint=new We(te.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=m||e.toString().substring(0,6),this.mint=p?We.default:lt({publicKey:e}),this.isToken2022=f}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ne=Ue;ne.WSOL=new Ue(j(K({},te),{mint:te.address}));var qe=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Ce=qe;Ce.SOL=new qe(ft);import Re from"big.js";import zt from"bn.js";import Zt from"decimal.js-light";import{get as gt,set as Ut}from"lodash";var Ge=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ht={},qt={};function W(n){let e=gt(ht,n);if(!e){let t=gt(qt,n);e=new Ge({name:n,logLevel:t}),Ut(ht,n,e)}return e}import de from"bn.js";var yt=9007199254740991;function G(n){let e=W("Raydium_parseBigNumberish");if(n instanceof de)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new de(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=yt||n<=-yt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new de(String(n))):typeof n=="bigint"?new de(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new de(0))}import Gt from"toformat";var jt=Gt,fe=jt;var Le=W("module/fraction"),je=fe(Re),ge=fe(Zt),Jt={[0]:ge.ROUND_DOWN,[1]:ge.ROUND_HALF_UP,[2]:ge.ROUND_UP},Qt={[0]:Re.roundDown,[1]:Re.roundHalfUp,[2]:Re.roundUp},N=class{constructor(e,t=new zt(1)){this.numerator=G(e),this.denominator=G(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(e){let t=e instanceof N?e:new N(G(e));return this.denominator.eq(t.denominator)?new N(this.numerator.add(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof N?e:new N(G(e));return this.denominator.eq(t.denominator)?new N(this.numerator.sub(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof N?e:new N(G(e));return new N(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof N?e:new N(G(e));return new N(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||Le.logWithError(`${e} is not an integer.`),e<=0&&Le.logWithError(`${e} is not positive.`),ge.set({precision:e+1,rounding:Jt[r]});let m=new ge(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return m.toFormat(m.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||Le.logWithError(`${e} is not an integer.`),e<0&&Le.logWithError(`${e} is negative.`),je.DP=e,je.RM=Qt[r]||1,new je(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import Xt from"bn.js";var bt=new N(new Xt(100)),se=class extends N{toSignificant(e=5,t,r){return this.mul(bt).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(bt).toFixed(e,t,r)}};var Yt=W("Raydium_price"),Z=class extends N{constructor(t){let{baseToken:r,quoteToken:m,numerator:p,denominator:f}=t;super(p,f);this.baseToken=r,this.quoteToken=m,this.scalar=new N(He(r.decimals),He(m.decimals))}get raw(){return new N(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Z({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Yt.logWithError("mul token not equals");let r=super.mul(t);return new Z({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,m){return this.adjusted.toSignificant(t,r,m)}toFixed(t=this.quoteToken.decimals,r,m){return this.adjusted.toFixed(t,r,m)}};var $t=new Q(0),ho=new Q(1),yo=new Q(2),bo=new Q(3),To=new Q(5),ze=new Q(10),xo=new Q(100),Po=new Q(1e3),wo=new Q(1e4);function He(n){return ze.pow(G(n))}import{PublicKey as en}from"@solana/web3.js";import{MINT_SIZE as No,TOKEN_PROGRAM_ID as _o,getTransferFeeConfig as Eo,unpackMint as Oo}from"@solana/spl-token";var Ze=W("Raydium_accountInfo_util");async function xt(n,e,t){let{batchRequest:r,commitment:m="confirmed",chunkCount:p=100}=K({batchRequest:!1},t),f=Je(e,p),o=new Array(f.length).fill([]);if(r){let S=f.map(b=>{let A=n._buildArgs([b.map(P=>P.toBase58())],m,"base64");return{methodName:"getMultipleAccounts",args:A}}),l=Je(S,10);o=(await(await Promise.all(l.map(async b=>await n._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&Ze.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(A=>{if(A){let{data:P,executable:c,lamports:h,owner:a,rentEpoch:B}=A;return P.length!==2&&P[1]!=="base64"&&Ze.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:c,lamports:h,owner:new en(a),rentEpoch:B}}return null})))}else try{o=await Promise.all(f.map(S=>n.getMultipleAccountsInfo(S,m)))}catch(S){S instanceof Error&&Ze.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${S.message}`)}return o.flat()}function Je(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var H=class{constructor(e){this._owner=e}get publicKey(){return H.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return H.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return H.isKeyPair(this._owner)}get isPublicKey(){return H.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!H.isKeyPair(e)}};import{PublicKey as ti}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ri}from"@solana/spl-token";import{ComputeBudgetProgram as Pt,Keypair as At,PublicKey as Ho,Transaction as St,TransactionMessage as tn,VersionedTransaction as It}from"@solana/web3.js";var he={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as nn}from"@solana/spl-token";var wt=W("Raydium_txUtil"),kt=1644;function ye(n){let e=[],t=[];return n.microLamports&&(e.push(Pt.setComputeUnitPrice({microLamports:n.microLamports})),t.push(he.SetComputeUnitPrice)),n.units&&(e.push(Pt.setComputeUnitLimit({units:n.units})),t.push(he.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function re(n,e){var r,m;let t=e!=null?e:"confirmed";return(m=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:m.blockhash}async function be(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let m=setTimeout(r,6e4);n.onSignature(e,p=>{if(clearTimeout(m),!p.err){t("");return}r(Object.assign(p.err,{txId:e}))},"confirmed")})}function rn(n,e){n.length<1&&wt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&wt.logWithError(`no signers provided:, ${e.toString()}`);let t=new St;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<kt}catch{return!1}}function Te({instructions:n,payer:e,signers:t}){return rn(n,[e,...t])}function X({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=At.generate().publicKey.toString()}){let p=new tn({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new It(p).serialize()).toString("base64").length<kt}catch{return!1}}var on=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),sn=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof It&&(e=on(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ee(n){let e=[];return n.forEach(t=>{t instanceof St&&(t.recentBlockhash||(t.recentBlockhash=nn.toBase58()),t.feePayer||(t.feePayer=At.generate().publicKey)),e.push(sn(t))}),console.log("simulate tx string:",e),e}import ai from"bn.js";import{PublicKey as Qe,AddressLookupTableAccount as ue}from"@solana/web3.js";async function De({connection:n,address:e,cluster:t="mainnet"}){let r=await xt(n,[...new Set(e.map(p=>p.toString()))].map(p=>new Qe(p))),m={};for(let p=0;p<e.length;p++){let f=r[p],o=e[p];if(!f)continue;let S=new ue({key:o,state:ue.deserialize(f.data)});m[o.toString()]=S,t==="devnet"?ae[o.toString()]=S:xe[o.toString()]=S}return m}var xe={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ue({key:new Qe("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ue.deserialize(Buffer.from("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","base64"))})},ae={},Me=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ae[e])return ae;let t=new Qe(e),r=await n.getAccountInfo(t);return r&&(ae[e]=new ue({key:t,state:ue.deserialize(r.data)})),ae};import{PublicKey as oe,sendAndConfirmTransaction as Xe,SystemProgram as an,Transaction as Pe,TransactionMessage as Y,VersionedTransaction as $}from"@solana/web3.js";import un from"axios";var we=2e3,Ae=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await un.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=ye(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(an.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new oe(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(he.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:m=[],endInstructionTypes:p=[],lookupTableAddress:f=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...m),this.endInstructionTypes.push(...p),this.lookupTableAddress.push(...f.filter(o=>o!==oe.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(K({},t||{})):this.build(t)}build(e){var r;let t=new Pe;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(m=>m.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async m=>{var x;let{recentBlockHash:p,skipPreflight:f=!0,sendAndConfirm:o,notSendToRpc:S}=m||{},l=p!=null?p:await re(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),ee([t]),(x=this.owner)!=null&&x.isKeyPair)return{txId:o?await Xe(this.connection,t,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:f}),signedTx:t};if(this.signAllTransactions){let b=await this.signAllTransactions([t]);if(this.signers.length)for(let A of b)try{A.sign(...this.signers)}catch{}return{txId:S?"":await this.connection.sendRawTransaction(b[0].serialize(),{skipPreflight:f}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:m}=this.build(r),p=t.filter(x=>x.transaction.instructions.length>0),f=[m,...p.map(x=>x.transaction)],o=[this.signers,...p.map(x=>x.signers)],S=[...this.instructionTypes,...p.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:f,signers:o,instructionTypes:S,execute:async x=>{var B;let{sequentially:b,onTxUpdate:A,skipTxCount:P=0,recentBlockHash:c,skipPreflight:h=!0}=x||{},a=c!=null?c:await re(this.connection,this.blockhashCommitment);if((B=this.owner)!=null&&B.isKeyPair){if(b){let T=[],D=0;for(let u of f){if(++D,D<=P)continue;let i=await Xe(this.connection,u,this.signers.find(s=>s.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:h});T.push(i)}return{txIds:T,signedTxs:f}}return{txIds:await await Promise.all(f.map(async T=>(T.recentBlockhash=a,await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:h})))),signedTxs:f}}if(this.signAllTransactions){let T=f.map((u,i)=>(u.recentBlockhash=a,o[i].length&&u.sign(...o[i]),u));ee(T);let D=await this.signAllTransactions(T);if(b){let u=0,i=[],s=async()=>{if(!D[u])return;let y=await this.connection.sendRawTransaction(D[u].serialize(),{skipPreflight:h});i.push({txId:y,status:"sent",signedTx:D[u]}),A==null||A([...i]),u++;let d=!1,I=null,_=null,M=w=>{I!==null&&clearInterval(I),_!==null&&this.connection.removeSignatureListener(_);let k=i.findIndex(C=>C.txId===y);if(k>-1){if(i[k].status==="error"||i[k].status==="success")return;i[k].status=w.err?"error":"success"}A==null||A([...i]),w.err||s()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var w;if(d){clearInterval(I);return}try{let k=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});k&&(d=!0,clearInterval(I),M({err:((w=k.meta)==null?void 0:w.err)||null}),console.log("tx status from getTransaction:",y))}catch(k){d=!0,clearInterval(I),console.error("getTransaction timeout:",k,y)}},we)),_=this.connection.onSignature(y,w=>{if(d){this.connection.removeSignatureListener(_);return}d=!0,M(w)},"confirmed"),this.connection.getSignatureStatus(y)};return await s(),{txIds:i.map(y=>y.txId),signedTxs:D}}else{let u=[];for(let i=0;i<D.length;i+=1){let s=await this.connection.sendRawTransaction(D[i].serialize(),{skipPreflight:h});u.push(s)}return{txIds:u,signedTxs:D}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var h;let c=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:m,recentBlockhash:p}=c,f=le(c,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=K(K({},this.cluster==="devnet"?await Me(this.connection):xe),t),S=Array.from(new Set([...r,...this.lookupTableAddress])),l=[];for(let a of S)o[a]===void 0&&l.push(new oe(a));let x=await De({connection:this.connection,address:l});for(let[a,B]of Object.entries(x))o[a]=B;let b=m?oe.default.toBase58():p!=null?p:await re(this.connection,this.blockhashCommitment),A=new Y({payerKey:this.feePayer,recentBlockhash:b,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((h=this.owner)==null?void 0:h.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new $(A);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var u;let{skipPreflight:B=!0,sendAndConfirm:T,notSendToRpc:D}=a||{};if(ee([P]),(u=this.owner)!=null&&u.isKeyPair){let i=await this.connection.sendTransaction(P,{skipPreflight:B});return T&&await be(this.connection,i),{txId:i,signedTx:P}}if(this.signAllTransactions){let i=await this.signAllTransactions([P]);if(this.signers.length)for(let s of i)try{s.sign(this.signers)}catch{}return{txId:D?"":await this.connection.sendTransaction(i[0],{skipPreflight:B}),signedTx:i[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:m}=await this.buildV0(r),p=t.filter(x=>x.builder.instructions.length>0),f=[m,...p.map(x=>x.transaction)],o=[this.signers,...p.map(x=>x.signers)],S=[...this.instructionTypes,...p.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),f.forEach(async(x,b)=>{x.sign(o[b])}),{builder:this,transactions:f,signers:o,instructionTypes:S,buildProps:r,execute:async x=>{var h;let{sequentially:b,onTxUpdate:A,recentBlockHash:P,skipPreflight:c=!0}=x||{};if(P&&f.forEach(a=>a.message.recentBlockhash=P),ee(f),(h=this.owner)!=null&&h.isKeyPair){if(b){let a=[];for(let B of f){let T=await this.connection.sendTransaction(B,{skipPreflight:c});await be(this.connection,T),a.push(T)}return{txIds:a,signedTxs:f}}return{txIds:await Promise.all(f.map(async a=>await this.connection.sendTransaction(a,{skipPreflight:c}))),signedTxs:f}}if(this.signAllTransactions){let a=await this.signAllTransactions(f);if(b){let B=0,T=[],D=async()=>{if(!a[B])return;let u=await this.connection.sendTransaction(a[B],{skipPreflight:c});T.push({txId:u,status:"sent",signedTx:a[B]}),A==null||A([...T]),B++;let i=!1,s=null,y=null,d=I=>{s!==null&&clearInterval(s),y!==null&&this.connection.removeSignatureListener(y);let _=T.findIndex(M=>M.txId===u);if(_>-1){if(T[_].status==="error"||T[_].status==="success")return;T[_].status=I.err?"error":"success"}A==null||A([...T]),I.err||D()};this.loopMultiTxStatus&&(s=setInterval(async()=>{var I;if(i){clearInterval(s);return}try{let _=await this.connection.getTransaction(u,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(i=!0,clearInterval(s),d({err:((I=_.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",u))}catch(_){i=!0,clearInterval(s),console.error("getTransaction timeout:",_,u)}},we)),y=this.connection.onSignature(u,I=>{if(i){this.connection.removeSignatureListener(y);return}i=!0,d(I)},"confirmed"),this.connection.getSignatureStatus(u)};return D(),{txIds:[],signedTxs:a}}else{let B=[];for(let T=0;T<a.length;T+=1){let D=await this.connection.sendTransaction(a[T],{skipPreflight:c});B.push(D)}return{txIds:B,signedTxs:a}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var A;let b=e||{},{splitIns:t=[],computeBudgetConfig:r}=b,m=le(b,["splitIns","computeBudgetConfig"]),p=r?ye(r):{instructions:[],instructionTypes:[]},f=this.signers.reduce((P,c)=>j(K({},P),{[c.publicKey.toBase58()]:c}),{}),o=[],S=[],l=[],x=0;if(this.allInstructions.forEach(P=>{let c=[...l,P],h=r?[...p.instructions,...c]:c,B=[...new Set(c.map(T=>T.keys.filter(D=>D.isSigner).map(D=>D.pubkey.toString())).flat()).values()].map(T=>new oe(T));if(P!==t[x]&&l.length<12&&(Te({instructions:h,payer:this.feePayer,signers:B})||Te({instructions:c,payer:this.feePayer,signers:B})))l.push(P);else{if(l.length===0)throw Error("item ins too big");x+=P===t[x]?1:0,Te({instructions:r?[...p.instructions,...l]:[...l],payer:this.feePayer,signers:B})?o.push(new Pe().add(...p.instructions,...l)):o.push(new Pe().add(...l)),S.push(Array.from(new Set(l.map(T=>T.keys.filter(D=>D.isSigner).map(D=>D.pubkey.toString())).flat())).map(T=>f[T]).filter(T=>T!==void 0)),l=[P]}}),l.length>0){let c=[...new Set(l.map(h=>h.keys.filter(a=>a.isSigner).map(a=>a.pubkey.toString())).flat()).values()].map(h=>f[h]).filter(h=>h!==void 0);Te({instructions:r?[...p.instructions,...l]:[...l],payer:this.feePayer,signers:c.map(h=>h.publicKey)})?o.push(new Pe().add(...p.instructions,...l)):o.push(new Pe().add(...l)),S.push(c)}return o.forEach(P=>P.feePayer=this.feePayer),(A=this.owner)!=null&&A.signer&&S.forEach(P=>{P.some(c=>c.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:o,signers:S,instructionTypes:this.instructionTypes,execute:async P=>{var u;let{sequentially:c,onTxUpdate:h,skipTxCount:a=0,recentBlockHash:B,skipPreflight:T=!0}=P||{},D=B!=null?B:await re(this.connection,this.blockhashCommitment);if(o.forEach(async(i,s)=>{i.recentBlockhash=D,S[s].length&&i.sign(...S[s])}),ee(o),(u=this.owner)!=null&&u.isKeyPair){if(c){let i=0,s=[];for(let y of o){if(++i,i<=a){s.push("tx skipped");continue}let d=await Xe(this.connection,y,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});s.push(d)}return{txIds:s,signedTxs:o}}return{txIds:await Promise.all(o.map(async i=>await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:T}))),signedTxs:o}}if(this.signAllTransactions){let i=await this.signAllTransactions(o.slice(a,o.length)),s=[...o.slice(0,a),...i];if(c){let y=0,d=[],I=async()=>{if(!s[y])return;y<a&&(d.push({txId:"",status:"success",signedTx:s[y]}),h==null||h([...d]),y++,I());let _=await this.connection.sendRawTransaction(s[y].serialize(),{skipPreflight:T});d.push({txId:_,status:"sent",signedTx:s[y]}),h==null||h([...d]),y++;let M=!1,w=null,k=null,C=F=>{w!==null&&clearInterval(w),k!==null&&this.connection.removeSignatureListener(k);let E=d.findIndex(U=>U.txId===_);if(E>-1){if(d[E].status==="error"||d[E].status==="success")return;d[E].status=F.err?"error":"success"}h==null||h([...d]),F.err||I()};this.loopMultiTxStatus&&(w=setInterval(async()=>{var F;if(M){clearInterval(w);return}try{let E=await this.connection.getTransaction(_,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(M=!0,clearInterval(w),C({err:((F=E.meta)==null?void 0:F.err)||null}),console.log("tx status from getTransaction:",_))}catch(E){M=!0,clearInterval(w),console.error("getTransaction timeout:",E,_)}},we)),k=this.connection.onSignature(_,F=>{if(M){this.connection.removeSignatureListener(k);return}M=!0,C(F)},"confirmed"),this.connection.getSignatureStatus(_)};return await I(),{txIds:d.map(_=>_.txId),signedTxs:s}}else{let y=[];for(let d=0;d<s.length;d+=1){let I=await this.connection.sendRawTransaction(s[d].serialize(),{skipPreflight:T});y.push(I)}return{txIds:y,signedTxs:s}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:m||{}}}async sizeCheckBuildV0(e){var D;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:m={},lookupTableAddress:p=[]}=T,f=le(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=K(K({},this.cluster==="devnet"?await Me(this.connection):xe),m),S=Array.from(new Set([...this.lookupTableAddress,...p])),l=[];for(let u of S)o[u]===void 0&&l.push(new oe(u));let x=await De({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?ye(t):{instructions:[],instructionTypes:[]},A=await re(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>j(K({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(X({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||X({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let d of[...new Set(S)])o[d]!==void 0&&(y[d]=o[d]);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let d=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}else{let d=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}h.push(Array.from(new Set(a.map(d=>d.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(d=>P[d]).filter(d=>d!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let s=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(D=this.owner)!=null&&D.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,instructionTypes:this.instructionTypes,execute:async u=>{var _;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:d,skipPreflight:I=!0}=u||{};if(c.map(async(M,w)=>{h[w].length&&M.sign(h[w]),d&&(M.message.recentBlockhash=d)}),ee(c),(_=this.owner)!=null&&_.isKeyPair){if(i){let M=0,w=[];for(let k of c){if(++M,M<=y){console.log("skip tx: ",M),w.push("tx skipped");continue}let C=await this.connection.sendTransaction(k,{skipPreflight:I});await be(this.connection,C),w.push(C)}return{txIds:w,signedTxs:c}}return{txIds:await Promise.all(c.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let M=await this.signAllTransactions(c.slice(y,c.length)),w=[...c.slice(0,y),...M];if(i){let k=0,C=[],F=async()=>{if(!w[k])return;if(k<y){C.push({txId:"",status:"success",signedTx:w[k]}),s==null||s([...C]),k++,F();return}let E=await this.connection.sendTransaction(w[k],{skipPreflight:I});C.push({txId:E,status:"sent",signedTx:w[k]}),s==null||s([...C]),k++;let U=!1,q=null,z=null,ce=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let V=C.findIndex(Ke=>Ke.txId===E);if(V>-1){if(C[V].status==="error"||C[V].status==="success")return;C[V].status=v.err?"error":"success"}s==null||s([...C]),v.err||F()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let V=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(U=!0,clearInterval(q),ce({err:((v=V.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(V){U=!0,clearInterval(q),console.error("getTransaction timeout:",V,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,ce(v)},"confirmed"),this.connection.getSignatureStatus(E)};return F(),{txIds:[],signedTxs:w}}else{let k=[];for(let C=0;C<w.length;C+=1){let F=await this.connection.sendTransaction(w[C],{skipPreflight:I});k.push(F)}return{txIds:k,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}async buildSniperTransaction(e){var D;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:m={},lookupTableAddress:p=[]}=T,f=le(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=K(K({},this.cluster==="devnet"?await Me(this.connection):xe),m),S=Array.from(new Set([...this.lookupTableAddress,...p])),l=[];for(let u of S)o[u]===void 0&&l.push(new oe(u));let x=await De({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?ye(t):{instructions:[],instructionTypes:[]},A=await re(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>j(K({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(X({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||X({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let d of[...new Set(S)])o[d]!==void 0&&(y[d]=o[d]);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let d=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}else{let d=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(d))}h.push(Array.from(new Set(a.map(d=>d.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(d=>P[d]).filter(d=>d!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let s=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Y({payerKey:this.feePayer,recentBlockhash:A,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(D=this.owner)!=null&&D.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,instructionTypes:this.instructionTypes,execute:async u=>{var _;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:d,skipPreflight:I=!0}=u||{};if(c.map(async(M,w)=>{h[w].length&&M.sign(h[w]),d&&(M.message.recentBlockhash=d)}),ee(c),(_=this.owner)!=null&&_.isKeyPair){if(i){let M=0,w=[];for(let k of c){if(++M,M<=y){console.log("skip tx: ",M),w.push("tx skipped");continue}let C=await this.connection.sendTransaction(k,{skipPreflight:I});await be(this.connection,C),w.push(C)}return{txIds:w,signedTxs:c}}return{txIds:await Promise.all(c.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let M=await this.signAllTransactions(c.slice(y,c.length)),w=[...c.slice(0,y),...M];if(i){let k=0,C=[],F=async()=>{if(!w[k])return;if(k<y){C.push({txId:"",status:"success",signedTx:w[k]}),s==null||s([...C]),k++,F();return}let E=await this.connection.sendTransaction(w[k],{skipPreflight:I});C.push({txId:E,status:"sent",signedTx:w[k]}),s==null||s([...C]),k++;let U=!1,q=null,z=null,ce=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let V=C.findIndex(Ke=>Ke.txId===E);if(V>-1){if(C[V].status==="error"||C[V].status==="success")return;C[V].status=v.err?"error":"success"}s==null||s([...C]),v.err||F()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let V=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(U=!0,clearInterval(q),ce({err:((v=V.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(V){U=!0,clearInterval(q),console.error("getTransaction timeout:",V,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,ce(v)},"confirmed"),this.connection.getSignatureStatus(E)};return F(),{txIds:[],signedTxs:w}}else{let k=[];for(let C=0;C<w.length;C+=1){let F=await this.connection.sendTransaction(w[C],{skipPreflight:I});k.push(F)}return{txIds:k,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}};import cn from"bn.js";var Bi=new cn(1e6);var mn=W("Raydium_amount"),Bt=fe(ln);function pn(n,e){let t="0",r="0";if(n.includes(".")){let m=n.split(".");m.length===2?([t,r]=m,r=r.padEnd(e,"0")):mn.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var J=class extends N{constructor(t,r,m=!0,p){let f=new Ne(0),o=ze.pow(new Ne(t.decimals));if(m)f=G(r);else{let S=new Ne(0),l=new Ne(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[x,b]=pn(r.toString(),t.decimals);S=G(x),l=G(b)}S=S.mul(o),f=S.add(l)}super(f,o);this.logger=W(p||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new J(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new J(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,m=0){return super.toSignificant(t,r,m)}toFixed(t=this.token.decimals,r,m=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,m)}toExact(t={groupSeparator:""}){return Bt.DP=this.token.decimals,new Bt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function Tt(n){return typeof n=="object"&&n!==null&&![ne,J,dn,N,fn,Z,se].some(e=>typeof e=="object"&&n instanceof e)}function _e(n){return typeof n=="string"?Ve(n):Array.isArray(n)?n.map(e=>_e(e)):Tt(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,_e(t)])):n}var Ye=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Se=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ae({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let r=new H(e);return new Ae({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:r,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Ye(e))}logInfo(...e){this.logger.info(Ye(e))}logAndCreateError(...e){let t=Ye(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as bn,TransactionInstruction as rt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ot}from"@solana/spl-token";import{PublicKey as Ia}from"@solana/web3.js";import Ba,{isBN as Ca}from"bn.js";import{bits as Ss,BitStructure as Is,blob as ks,Blob as Bs,cstr as Cs,f32 as Ls,f32be as Rs,f64 as Ds,f64be as Ms,greedy as Ns,Layout as _s,ns64 as Es,ns64be as Os,nu64 as gn,nu64be as Ks,offset as Fs,s16 as Vs,s16be as vs,s24 as Ws,s24be as Us,s32 as qs,s32be as Gs,s40 as js,s40be as Hs,s48 as zs,s48be as Zs,s8 as Js,seq as Qs,struct as Xs,Structure as hn,u16 as Ys,u16be as $s,u24 as ea,u24be as ta,u32 as na,u32be as ra,u40 as oa,u40be as ia,u48 as sa,u48be as aa,u8 as ua,UInt as yn,union as ca,Union as la,unionLayoutDiscriminator as ma,utf8 as pa}from"@solana/buffer-layout";var Ct=hn;var Lt=yn;var Rt=gn;function et(n){return new Lt(1,n)}var $e=class extends Ct{decode(e,t){return super.decode(e,t)}};function tt(n,e,t){return new $e(n,e,t)}var nt=tt([et("instruction"),Rt("amount")]),Ie=tt([et("instruction")]);function Va({programId:n,amount:e,instructionKeys:t}){let r=[{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},...Object.entries(t).map(([p,f])=>({pubkey:f,isSigner:p==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(p)}))],m=Buffer.alloc(nt.span);return nt.encode({instruction:1,amount:Number(e)},m),new rt({keys:r,programId:n,data:m})}function Ee({programId:n},e){let t=[{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},...Object.entries(e).map(([m,p])=>({pubkey:p,isSigner:m==="userOwner",isWritable:!["authority","userOwner"].includes(m)}))],r=Buffer.alloc(Ie.span);return Ie.encode({instruction:2},r),new rt({keys:t,programId:n,data:r})}function it(n){let{poolConfig:e,userKeys:t,side:r}=n,m=r==="base"?t.baseTokenAccount:t.quoteTokenAccount,p=r==="base"?e.baseVault:e.quoteVault,f=Buffer.alloc(Ie.span);Ie.encode({instruction:2},f);let o=[{pubkey:ot,isWritable:!1,isSigner:!1},{pubkey:bn,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new rt({programId:e.programId,keys:o,data:f})}var Tn={[me.IDO_PROGRAM_ID_V1.toString()]:1,[me.IDO_PROGRAM_ID_V2.toString()]:2,[me.IDO_PROGRAM_ID_V3.toString()]:3,[me.IDO_PROGRAM_ID_V4.toString()]:4},Oe=class extends Se{async claim({ownerInfo:e,idoKeys:t,associatedOnly:r=!0,checkCreateATAOwner:m=!1,txVersion:p,feePayer:f}){let o=this.createTxBuilder(f),S=Tn[t.programId];S||this.logAndCreateError("invalid version",S);let l=_e(t),[x,b]=[!new Dt(e.coin).isZero(),!new Dt(e.pc).isZero()],A=l.projectInfo.mint.address.equals(ie),{account:P,instructionParams:c}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.projectInfo.mint.programId,mint:l.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:r,checkCreateATAOwner:m});!P&&x&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),x&&c&&o.addInstruction(c);let h=l.buyInfo.mint.address.equals(ie),{account:a,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.buyInfo.mint.programId,mint:l.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:r,checkCreateATAOwner:m});if(!P&&b&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),b&&B&&o.addInstruction(B),(!P||!a)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),S===3)return o.addInstruction({instructions:[...x?[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolTokenAccount:l.projectInfo.vault,userTokenAccount:P,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...b?[Ee({programId:new ke(t.programId)},{idoId:l.id,authority:l.authority,poolTokenAccount:l.buyInfo.vault,userTokenAccount:a,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:p});if(S<3)return!x&&!b&&this.logAndCreateError("no claimable rewards"),o.addInstruction({instructions:[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolQuoteTokenAccount:l.buyInfo.vault,poolBaseTokenAccount:l.projectInfo.vault,userQuoteTokenAccount:a,userBaseTokenAccount:P,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:p});let T={poolConfig:{id:l.id,programId:l.programId,authority:l.authority,baseVault:l.projectInfo.vault,quoteVault:l.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:P,quoteTokenAccount:a,ledgerAccount:new ke(e.userIdoInfo),owner:this.scope.ownerPubKey}};return o.addInstruction({instructions:[...x?[it(j(K({},T),{side:"base"}))]:[],...b?[it(j(K({},T),{side:"quote"}))]:[]]}).versionBuild({txVersion:p})}};export{Ie as claimLayout,Oe as default,Ee as makeClaimInstruction,it as makeClaimInstructionV4,Va as makePurchaseInstruction,nt as purchaseLayout};
//# sourceMappingURL=index.mjs.map