var Dt=Object.defineProperty,Mt=Object.defineProperties;var Nt=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var it=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var ot=(n,e,t)=>e in n?Dt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,O=(n,e)=>{for(var t in e||(e={}))it.call(e,t)&&ot(n,t,e[t]);if(Te)for(var t of Te(e))st.call(e,t)&&ot(n,t,e[t]);return n},W=(n,e)=>Mt(n,Nt(e));var xe=(n,e)=>{var t={};for(var r in n)it.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Te)for(var r of Te(n))e.indexOf(r)<0&&st.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as he}from"@solana/web3.js";import Ct from"bn.js";import{PublicKey as l}from"@solana/web3.js";var Pn=new l("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),wn=new l("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),An=new l("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Sn=new l("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),In=new l("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),kn=new l("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Bn=new l("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ln=new l("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Cn=new l("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Rn=new l("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Dn=new l("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Mn=new l("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Nn=new l("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),_n=new l("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),En=new l("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),On=new l("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),_t=new l("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Et=new l("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ot=new l("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ft=new l("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Fn=new l("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Kn=new l("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Vn=new l("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),vn=new l("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Wn=new l("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Un=new l("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),qn=new l("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Gn=new l("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),jn=new l("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Hn=new l("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),zn=new l("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX"),oe={IDO_PROGRAM_ID_V1:_t,IDO_PROGRAM_ID_V2:Et,IDO_PROGRAM_ID_V3:Ot,IDO_PROGRAM_ID_V4:Ft};var Zn={OPEN_BOOK_PROGRAM:new l("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new l("Ray1111111111111111111111111111111111111111"),AMM_V4:new l("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new l("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new l("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new l("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new l("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new l("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new l("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new l("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new l("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new l("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:l.default,Router:new l("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new l("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new l("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new l("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new l("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new l("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new l("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new l("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new l("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new l("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new l("Ray1111111111111111111111111111111111111111")};import{PublicKey as N,SystemProgram as at,SYSVAR_RENT_PUBKEY as Kt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Vt}from"@solana/spl-token";function Ne({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var $n=[Ne({pubkey:Vt,isWritable:!1}),Ne({pubkey:at.programId,isWritable:!1}),Ne({pubkey:Kt,isWritable:!1})];function ut({publicKey:n,transformSol:e}){let t=_e(n.toString());if(t instanceof N)return e&&t.equals(ie)?Y:t;if(e&&t.toString()===ie.toBase58())return Y;if(typeof t=="string"){if(t===N.default.toBase58())return N.default;try{return new N(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function _e(n){try{return new N(n)}catch{return n}}var er=new N("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),tr=new N("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ct=new N("SysvarRent111111111111111111111111111111111"),Ee=new N("SysvarC1ock11111111111111111111111111111111"),nr=new N("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),rr=new N("Sysvar1nstructions1111111111111111111111111"),lt=at.programId,or=new N("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ir=new N("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),sr=new N("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ar=new N("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ur=new N("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),cr=new N("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),lr=new N("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),mr=new N("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),pr=new N("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),dr=new N("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),fr=new N("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Y=new N("So11111111111111111111111111111111111111112"),ie=N.default;import{PublicKey as pn}from"@solana/web3.js";import dn from"bn.js";import cn from"big.js";import Ce from"bn.js";import j from"bn.js";import oo from"decimal.js";import{PublicKey as vt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mt}from"@solana/spl-token";var pt={chainId:101,address:vt.default.toBase58(),programId:mt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Z={chainId:101,address:"So11111111111111111111111111111111111111112",programId:mt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Oe}from"@solana/web3.js";var Fe=class{constructor({mint:e,decimals:t,symbol:r,name:i,skipMint:a=!1,isToken2022:m=!1}){if(e===ie.toBase58()||e instanceof Oe&&ie.equals(e)){this.decimals=Z.decimals,this.symbol=Z.symbol,this.name=Z.name,this.mint=new Oe(Z.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=a?Oe.default:ut({publicKey:e}),this.isToken2022=m}equals(e){return this===e?!0:this.mint.equals(e.mint)}},J=Fe;J.WSOL=new Fe(W(O({},Z),{mint:Z.address}));var Ke=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Pe=Ke;Pe.SOL=new Ke(pt);import Ae from"big.js";import Ht from"bn.js";import zt from"decimal.js-light";import{get as dt,set as Wt}from"lodash";var Ve=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ft={},Ut={};function K(n){let e=dt(ft,n);if(!e){let t=dt(Ut,n);e=new Ve({name:n,logLevel:t}),Wt(ft,n,e)}return e}import se from"bn.js";var gt=9007199254740991;function v(n){let e=K("Raydium_parseBigNumberish");if(n instanceof se)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new se(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=gt||n<=-gt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new se(String(n))):typeof n=="bigint"?new se(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new se(0))}import qt from"toformat";var Gt=qt,ae=Gt;var we=K("module/fraction"),ve=ae(Ae),ue=ae(zt),Zt={[0]:ue.ROUND_DOWN,[1]:ue.ROUND_HALF_UP,[2]:ue.ROUND_UP},Jt={[0]:Ae.roundDown,[1]:Ae.roundHalfUp,[2]:Ae.roundUp},L=class{constructor(e,t=new Ht(1)){this.numerator=v(e),this.denominator=v(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new L(this.denominator,this.numerator)}add(e){let t=e instanceof L?e:new L(v(e));return this.denominator.eq(t.denominator)?new L(this.numerator.add(t.numerator),this.denominator):new L(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof L?e:new L(v(e));return this.denominator.eq(t.denominator)?new L(this.numerator.sub(t.numerator),this.denominator):new L(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof L?e:new L(v(e));return new L(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof L?e:new L(v(e));return new L(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||we.logWithError(`${e} is not an integer.`),e<=0&&we.logWithError(`${e} is not positive.`),ue.set({precision:e+1,rounding:Zt[r]});let i=new ue(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||we.logWithError(`${e} is not an integer.`),e<0&&we.logWithError(`${e} is negative.`),ve.DP=e,ve.RM=Jt[r]||1,new ve(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import Qt from"bn.js";var yt=new L(new Qt(100)),$=class extends L{toSignificant(e=5,t,r){return this.mul(yt).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(yt).toFixed(e,t,r)}};var Xt=K("Raydium_price"),q=class extends L{constructor(t){let{baseToken:r,quoteToken:i,numerator:a,denominator:m}=t;super(a,m);this.baseToken=r,this.quoteToken=i,this.scalar=new L(We(r.decimals),We(i.decimals))}get raw(){return new L(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new q({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Xt.logWithError("mul token not equals");let r=super.mul(t);return new q({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,i){return this.adjusted.toSignificant(t,r,i)}toFixed(t=this.quoteToken.decimals,r,i){return this.adjusted.toFixed(t,r,i)}};var Yt=new j(0),go=new j(1),yo=new j(2),ho=new j(3),bo=new j(5),Ue=new j(10),To=new j(100),xo=new j(1e3),Po=new j(1e4);function We(n){return Ue.pow(v(n))}import{PublicKey as $t}from"@solana/web3.js";import{MINT_SIZE as Mo,TOKEN_PROGRAM_ID as No,getTransferFeeConfig as _o,unpackMint as Eo}from"@solana/spl-token";var qe=K("Raydium_accountInfo_util");async function bt(n,e,t){let{batchRequest:r,commitment:i="confirmed",chunkCount:a=100}=O({batchRequest:!1},t),m=Ge(e,a),o=new Array(m.length).fill([]);if(r){let w=m.map(T=>{let A=n._buildArgs([T.map(h=>h.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:A}}),s=Ge(w,10);o=(await(await Promise.all(s.map(async T=>await n._rpcBatchRequest(T)))).flat()).map(T=>(T.error&&qe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${T.error.message}`),T.result.value.map(A=>{if(A){let{data:h,executable:d,lamports:b,owner:u,rentEpoch:k}=A;return h.length!==2&&h[1]!=="base64"&&qe.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(h[0],"base64"),executable:d,lamports:b,owner:new $t(u),rentEpoch:k}}return null})))}else try{o=await Promise.all(m.map(w=>n.getMultipleAccountsInfo(w,i)))}catch(w){w instanceof Error&&qe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${w.message}`)}return o.flat()}function Ge(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}import{PublicKey as ei}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ni}from"@solana/spl-token";import{ComputeBudgetProgram as Tt,Keypair as Pt,PublicKey as jo,Transaction as wt,TransactionMessage as en,VersionedTransaction as At}from"@solana/web3.js";var ce={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as tn}from"@solana/spl-token";var xt=K("Raydium_txUtil"),St=1644;function Se(n){let e=[],t=[];return n.microLamports&&(e.push(Tt.setComputeUnitPrice({microLamports:n.microLamports})),t.push(ce.SetComputeUnitPrice)),n.units&&(e.push(Tt.setComputeUnitLimit({units:n.units})),t.push(ce.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ee(n,e){var r,i;let t=e!=null?e:"confirmed";return(i=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:i.blockhash}async function Ie(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let i=setTimeout(r,6e4);n.onSignature(e,a=>{if(clearTimeout(i),!a.err){t("");return}r(Object.assign(a.err,{txId:e}))},"confirmed")})}function nn(n,e){n.length<1&&xt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&xt.logWithError(`no signers provided:, ${e.toString()}`);let t=new wt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<St}catch{return!1}}function le({instructions:n,payer:e,signers:t}){return nn(n,[e,...t])}function me({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=Pt.generate().publicKey.toString()}){let a=new en({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new At(a).serialize()).toString("base64").length<St}catch{return!1}}var rn=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),on=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof At&&(e=rn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Q(n){let e=[];return n.forEach(t=>{t instanceof wt&&(t.recentBlockhash||(t.recentBlockhash=tn.toBase58()),t.feePayer||(t.feePayer=Pt.generate().publicKey)),e.push(on(t))}),console.log("simulate tx string:",e),e}import si from"bn.js";import{PublicKey as je,AddressLookupTableAccount as ne}from"@solana/web3.js";async function He({connection:n,address:e,cluster:t="mainnet"}){let r=await bt(n,[...new Set(e.map(a=>a.toString()))].map(a=>new je(a))),i={};for(let a=0;a<e.length;a++){let m=r[a],o=e[a];if(!m)continue;let w=new ne({key:o,state:ne.deserialize(m.data)});i[o.toString()]=w,t==="devnet"?te[o.toString()]=w:ke[o.toString()]=w}return i}var ke={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ne({key:new je("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ne.deserialize(Buffer.from("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","base64"))})},te={},ze=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(te[e])return te;let t=new je(e),r=await n.getAccountInfo(t);return r&&(te[e]=new ne({key:t,state:ne.deserialize(r.data)})),te};import{PublicKey as re,sendAndConfirmTransaction as Ze,SystemProgram as sn,Transaction as pe,TransactionMessage as de,VersionedTransaction as fe}from"@solana/web3.js";import an from"axios";var Be=2e3,Le=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await an.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Se(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(sn.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new re(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(ce.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:a=[],lookupTableAddress:m=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...a),this.lookupTableAddress.push(...m.filter(o=>o!==re.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(O({},t||{})):this.build(t)}build(e){var r;let t=new pe;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var y;let{recentBlockHash:a,skipPreflight:m=!0,sendAndConfirm:o,notSendToRpc:w}=i||{},s=a!=null?a:await ee(this.connection,this.blockhashCommitment);if(t.recentBlockhash=s,this.signers.length&&t.sign(...this.signers),Q([t]),(y=this.owner)!=null&&y.isKeyPair)return{txId:o?await Ze(this.connection,t,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:m}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:m}),signedTx:t};if(this.signAllTransactions){let T=await this.signAllTransactions([t]);if(this.signers.length)for(let A of T)try{A.sign(...this.signers)}catch{}return{txId:w?"":await this.connection.sendRawTransaction(T[0].serialize(),{skipPreflight:m}),signedTx:T[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var s;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:i}=this.build(r),a=t.filter(y=>y.transaction.instructions.length>0),m=[i,...a.map(y=>y.transaction)],o=[this.signers,...a.map(y=>y.signers)],w=[...this.instructionTypes,...a.map(y=>y.instructionTypes).flat()];return(s=this.owner)!=null&&s.signer&&o.forEach(y=>{y.some(T=>T.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:m,signers:o,instructionTypes:w,execute:async y=>{var k;let{sequentially:T,onTxUpdate:A,skipTxCount:h=0,recentBlockHash:d,skipPreflight:b=!0}=y||{},u=d!=null?d:await ee(this.connection,this.blockhashCommitment);if((k=this.owner)!=null&&k.isKeyPair){if(T){let g=[],C=0;for(let f of m){if(++C,C<=h)continue;let c=await Ze(this.connection,f,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});g.push(c)}return{txIds:g,signedTxs:m}}return{txIds:await await Promise.all(m.map(async g=>(g.recentBlockhash=u,await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:b})))),signedTxs:m}}if(this.signAllTransactions){let g=m.map((f,c)=>(f.recentBlockhash=u,o[c].length&&f.sign(...o[c]),f));Q(g);let C=await this.signAllTransactions(g);if(T){let f=0,c=[],p=async()=>{if(!C[f])return;let P=await this.connection.sendRawTransaction(C[f].serialize(),{skipPreflight:b});c.push({txId:P,status:"sent",signedTx:C[f]}),A==null||A([...c]),f++;let x=!1,B=null,D=null,_=R=>{B!==null&&clearInterval(B),D!==null&&this.connection.removeSignatureListener(D);let M=c.findIndex(E=>E.txId===P);if(M>-1){if(c[M].status==="error"||c[M].status==="success")return;c[M].status=R.err?"error":"success"}A==null||A([...c]),R.err||p()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var R;if(x){clearInterval(B);return}try{let M=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(x=!0,clearInterval(B),_({err:((R=M.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",P))}catch(M){x=!0,clearInterval(B),console.error("getTransaction timeout:",M,P)}},Be)),D=this.connection.onSignature(P,R=>{if(x){this.connection.removeSignatureListener(D);return}x=!0,_(R)},"confirmed"),this.connection.getSignatureStatus(P)};return await p(),{txIds:c.map(P=>P.txId),signedTxs:C}}else{let f=[];for(let c=0;c<C.length;c+=1){let p=await this.connection.sendRawTransaction(C[c].serialize(),{skipPreflight:b});f.push(p)}return{txIds:f,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var b;let d=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:a}=d,m=xe(d,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=O(O({},this.cluster==="devnet"?await ze(this.connection):ke),t),w=Array.from(new Set([...r,...this.lookupTableAddress])),s=[];for(let u of w)o[u]===void 0&&s.push(new re(u));let y=await He({connection:this.connection,address:s});for(let[u,k]of Object.entries(y))o[u]=k;let T=i?re.default.toBase58():a!=null?a:await ee(this.connection,this.blockhashCommitment),A=new de({payerKey:this.feePayer,recentBlockhash:T,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(u=>u.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let h=new fe(A);return h.sign(this.signers),{builder:this,transaction:h,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async u=>{var f;let{skipPreflight:k=!0,sendAndConfirm:g,notSendToRpc:C}=u||{};if(Q([h]),(f=this.owner)!=null&&f.isKeyPair){let c=await this.connection.sendTransaction(h,{skipPreflight:k});return g&&await Ie(this.connection,c),{txId:c,signedTx:h}}if(this.signAllTransactions){let c=await this.signAllTransactions([h]);if(this.signers.length)for(let p of c)try{p.sign(this.signers)}catch{}return{txId:C?"":await this.connection.sendTransaction(c[0],{skipPreflight:k}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:m||{}}}async buildV0MultiTx(e){var s;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:i}=await this.buildV0(r),a=t.filter(y=>y.builder.instructions.length>0),m=[i,...a.map(y=>y.transaction)],o=[this.signers,...a.map(y=>y.signers)],w=[...this.instructionTypes,...a.map(y=>y.instructionTypes).flat()];return(s=this.owner)!=null&&s.signer&&o.forEach(y=>{y.some(T=>T.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),m.forEach(async(y,T)=>{y.sign(o[T])}),{builder:this,transactions:m,signers:o,instructionTypes:w,buildProps:r,execute:async y=>{var b;let{sequentially:T,onTxUpdate:A,recentBlockHash:h,skipPreflight:d=!0}=y||{};if(h&&m.forEach(u=>u.message.recentBlockhash=h),Q(m),(b=this.owner)!=null&&b.isKeyPair){if(T){let u=[];for(let k of m){let g=await this.connection.sendTransaction(k,{skipPreflight:d});await Ie(this.connection,g),u.push(g)}return{txIds:u,signedTxs:m}}return{txIds:await Promise.all(m.map(async u=>await this.connection.sendTransaction(u,{skipPreflight:d}))),signedTxs:m}}if(this.signAllTransactions){let u=await this.signAllTransactions(m);if(T){let k=0,g=[],C=async()=>{if(!u[k])return;let f=await this.connection.sendTransaction(u[k],{skipPreflight:d});g.push({txId:f,status:"sent",signedTx:u[k]}),A==null||A([...g]),k++;let c=!1,p=null,P=null,x=B=>{p!==null&&clearInterval(p),P!==null&&this.connection.removeSignatureListener(P);let D=g.findIndex(_=>_.txId===f);if(D>-1){if(g[D].status==="error"||g[D].status==="success")return;g[D].status=B.err?"error":"success"}A==null||A([...g]),B.err||C()};this.loopMultiTxStatus&&(p=setInterval(async()=>{var B;if(c){clearInterval(p);return}try{let D=await this.connection.getTransaction(f,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(c=!0,clearInterval(p),x({err:((B=D.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",f))}catch(D){c=!0,clearInterval(p),console.error("getTransaction timeout:",D,f)}},Be)),P=this.connection.onSignature(f,B=>{if(c){this.connection.removeSignatureListener(P);return}c=!0,x(B)},"confirmed"),this.connection.getSignatureStatus(f)};return C(),{txIds:[],signedTxs:u}}else{let k=[];for(let g=0;g<u.length;g+=1){let C=await this.connection.sendTransaction(u[g],{skipPreflight:d});k.push(C)}return{txIds:k,signedTxs:u}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var A;let T=e||{},{splitIns:t=[],computeBudgetConfig:r}=T,i=xe(T,["splitIns","computeBudgetConfig"]),a=r?Se(r):{instructions:[],instructionTypes:[]},m=this.signers.reduce((h,d)=>W(O({},h),{[d.publicKey.toBase58()]:d}),{}),o=[],w=[],s=[],y=0;if(this.allInstructions.forEach(h=>{let d=[...s,h],b=r?[...a.instructions,...d]:d,k=[...new Set(d.map(g=>g.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat()).values()].map(g=>new re(g));if(h!==t[y]&&s.length<12&&(le({instructions:b,payer:this.feePayer,signers:k})||le({instructions:d,payer:this.feePayer,signers:k})))s.push(h);else{if(s.length===0)throw Error("item ins too big");y+=h===t[y]?1:0,le({instructions:r?[...a.instructions,...s]:[...s],payer:this.feePayer,signers:k})?o.push(new pe().add(...a.instructions,...s)):o.push(new pe().add(...s)),w.push(Array.from(new Set(s.map(g=>g.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(g=>m[g]).filter(g=>g!==void 0)),s=[h]}}),s.length>0){let d=[...new Set(s.map(b=>b.keys.filter(u=>u.isSigner).map(u=>u.pubkey.toString())).flat()).values()].map(b=>m[b]).filter(b=>b!==void 0);le({instructions:r?[...a.instructions,...s]:[...s],payer:this.feePayer,signers:d.map(b=>b.publicKey)})?o.push(new pe().add(...a.instructions,...s)):o.push(new pe().add(...s)),w.push(d)}return o.forEach(h=>h.feePayer=this.feePayer),(A=this.owner)!=null&&A.signer&&w.forEach(h=>{h.some(d=>d.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),{builder:this,transactions:o,signers:w,instructionTypes:this.instructionTypes,execute:async h=>{var f;let{sequentially:d,onTxUpdate:b,skipTxCount:u=0,recentBlockHash:k,skipPreflight:g=!0}=h||{},C=k!=null?k:await ee(this.connection,this.blockhashCommitment);if(o.forEach(async(c,p)=>{c.recentBlockhash=C,w[p].length&&c.sign(...w[p])}),Q(o),(f=this.owner)!=null&&f.isKeyPair){if(d){let c=0,p=[];for(let P of o){if(++c,c<=u){p.push("tx skipped");continue}let x=await Ze(this.connection,P,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});p.push(x)}return{txIds:p,signedTxs:o}}return{txIds:await Promise.all(o.map(async c=>await this.connection.sendRawTransaction(c.serialize(),{skipPreflight:g}))),signedTxs:o}}if(this.signAllTransactions){let c=await this.signAllTransactions(o.slice(u,o.length)),p=[...o.slice(0,u),...c];if(d){let P=0,x=[],B=async()=>{if(!p[P])return;P<u&&(x.push({txId:"",status:"success",signedTx:p[P]}),b==null||b([...x]),P++,B());let D=await this.connection.sendRawTransaction(p[P].serialize(),{skipPreflight:g});x.push({txId:D,status:"sent",signedTx:p[P]}),b==null||b([...x]),P++;let _=!1,R=null,M=null,E=V=>{R!==null&&clearInterval(R),M!==null&&this.connection.removeSignatureListener(M);let F=x.findIndex(H=>H.txId===D);if(F>-1){if(x[F].status==="error"||x[F].status==="success")return;x[F].status=V.err?"error":"success"}b==null||b([...x]),V.err||B()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var V;if(_){clearInterval(R);return}try{let F=await this.connection.getTransaction(D,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(_=!0,clearInterval(R),E({err:((V=F.meta)==null?void 0:V.err)||null}),console.log("tx status from getTransaction:",D))}catch(F){_=!0,clearInterval(R),console.error("getTransaction timeout:",F,D)}},Be)),M=this.connection.onSignature(D,V=>{if(_){this.connection.removeSignatureListener(M);return}_=!0,E(V)},"confirmed"),this.connection.getSignatureStatus(D)};return await B(),{txIds:x.map(D=>D.txId),signedTxs:p}}else{let P=[];for(let x=0;x<p.length;x+=1){let B=await this.connection.sendRawTransaction(p[x].serialize(),{skipPreflight:g});P.push(B)}return{txIds:P,signedTxs:p}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var C;let g=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:i={},lookupTableAddress:a=[]}=g,m=xe(g,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=O(O({},this.cluster==="devnet"?await ze(this.connection):ke),i),w=Array.from(new Set([...this.lookupTableAddress,...a])),s=[];for(let f of w)o[f]===void 0&&s.push(new re(f));let y=await He({connection:this.connection,address:s});for(let[f,c]of Object.entries(y))o[f]=c;let T=t?Se(t):{instructions:[],instructionTypes:[]},A=await ee(this.connection,this.blockhashCommitment),h=this.signers.reduce((f,c)=>W(O({},f),{[c.publicKey.toBase58()]:c}),{}),d=[],b=[],u=[],k=0;if(this.allInstructions.forEach(f=>{let c=[...u,f],p=t?[...T.instructions,...c]:c;if(f!==r[k]&&u.length<12&&(me({instructions:p,payer:this.feePayer,lookupTableAddressAccount:o})||me({instructions:c,payer:this.feePayer,lookupTableAddressAccount:o})))u.push(f);else{if(u.length===0)throw Error("item ins too big");k+=f===r[k]?1:0;let P={};for(let x of[...new Set(w)])o[x]!==void 0&&(P[x]=o[x]);if(t&&me({instructions:[...T.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let x=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...T.instructions,...u]}).compileToV0Message(Object.values(o));d.push(new fe(x))}else{let x=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...u]}).compileToV0Message(Object.values(o));d.push(new fe(x))}b.push(Array.from(new Set(u.map(x=>x.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(x=>h[x]).filter(x=>x!==void 0)),u=[f]}}),u.length>0){let c=[...new Set(u.map(p=>p.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(p=>h[p]).filter(p=>p!==void 0);if(t&&me({instructions:[...T.instructions,...u],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let p=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...T.instructions,...u]}).compileToV0Message(Object.values(o));d.push(new fe(p))}else{let p=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...u]}).compileToV0Message(Object.values(o));d.push(new fe(p))}b.push(c)}return(C=this.owner)!=null&&C.signer&&b.forEach(f=>{f.some(c=>c.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),d.forEach((f,c)=>{f.sign(b[c])}),{builder:this,transactions:d,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async f=>{var D;let{sequentially:c,onTxUpdate:p,skipTxCount:P=0,recentBlockHash:x,skipPreflight:B=!0}=f||{};if(d.map(async(_,R)=>{b[R].length&&_.sign(b[R]),x&&(_.message.recentBlockhash=x)}),Q(d),(D=this.owner)!=null&&D.isKeyPair){if(c){let _=0,R=[];for(let M of d){if(++_,_<=P){console.log("skip tx: ",_),R.push("tx skipped");continue}let E=await this.connection.sendTransaction(M,{skipPreflight:B});await Ie(this.connection,E),R.push(E)}return{txIds:R,signedTxs:d}}return{txIds:await Promise.all(d.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:B}))),signedTxs:d}}if(this.signAllTransactions){let _=await this.signAllTransactions(d.slice(P,d.length)),R=[...d.slice(0,P),..._];if(c){let M=0,E=[],V=async()=>{if(!R[M])return;if(M<P){E.push({txId:"",status:"success",signedTx:R[M]}),p==null||p([...E]),M++,V();return}let F=await this.connection.sendTransaction(R[M],{skipPreflight:B});E.push({txId:F,status:"sent",signedTx:R[M]}),p==null||p([...E]),M++;let H=!1,X=null,be=null,rt=z=>{X!==null&&clearInterval(X),be!==null&&this.connection.removeSignatureListener(be);let U=E.findIndex(Rt=>Rt.txId===F);if(U>-1){if(E[U].status==="error"||E[U].status==="success")return;E[U].status=z.err?"error":"success"}p==null||p([...E]),z.err||V()};this.loopMultiTxStatus&&(X=setInterval(async()=>{var z;if(H){clearInterval(X);return}try{let U=await this.connection.getTransaction(F,{commitment:"confirmed",maxSupportedTransactionVersion:0});U&&(H=!0,clearInterval(X),rt({err:((z=U.meta)==null?void 0:z.err)||null}),console.log("tx status from getTransaction:",F))}catch(U){H=!0,clearInterval(X),console.error("getTransaction timeout:",U,F)}},Be)),be=this.connection.onSignature(F,z=>{if(H){this.connection.removeSignatureListener(be);return}H=!0,rt(z)},"confirmed"),this.connection.getSignatureStatus(F)};return V(),{txIds:[],signedTxs:R}}else{let M=[];for(let E=0;E<R.length;E+=1){let V=await this.connection.sendTransaction(R[E],{skipPreflight:B});M.push(V)}return{txIds:M,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:m||{}}}};import un from"bn.js";var ki=new un(1e6);var ln=K("Raydium_amount"),It=ae(cn);function mn(n,e){let t="0",r="0";if(n.includes(".")){let i=n.split(".");i.length===2?([t,r]=i,r=r.padEnd(e,"0")):ln.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var G=class extends L{constructor(t,r,i=!0,a){let m=new Ce(0),o=Ue.pow(new Ce(t.decimals));if(i)m=v(r);else{let w=new Ce(0),s=new Ce(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[y,T]=mn(r.toString(),t.decimals);w=v(y),s=v(T)}w=w.mul(o),m=w.add(s)}super(m,o);this.logger=K(a||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new G(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new G(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,i=0){return super.toSignificant(t,r,i)}toFixed(t=this.token.decimals,r,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,i)}toExact(t={groupSeparator:""}){return It.DP=this.token.decimals,new It(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function ht(n){return typeof n=="object"&&n!==null&&![J,G,pn,L,dn,q,$].some(e=>typeof e=="object"&&n instanceof e)}function Re(n){return typeof n=="string"?_e(n):Array.isArray(n)?n.map(e=>Re(e)):ht(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,Re(t)])):n}var Je=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ge=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=K(t)}createTxBuilder(e){return this.scope.checkOwner(),new Le({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Je(e))}logInfo(...e){this.logger.info(Je(e))}logAndCreateError(...e){let t=Je(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as hn,TransactionInstruction as et}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as tt}from"@solana/spl-token";import{PublicKey as Aa}from"@solana/web3.js";import Ia,{isBN as ka}from"bn.js";import{bits as ws,BitStructure as As,blob as Ss,Blob as Is,cstr as ks,f32 as Bs,f32be as Ls,f64 as Cs,f64be as Rs,greedy as Ds,Layout as Ms,ns64 as Ns,ns64be as _s,nu64 as fn,nu64be as Es,offset as Os,s16 as Fs,s16be as Ks,s24 as Vs,s24be as vs,s32 as Ws,s32be as Us,s40 as qs,s40be as Gs,s48 as js,s48be as Hs,s8 as zs,seq as Zs,struct as Js,Structure as gn,u16 as Qs,u16be as Xs,u24 as Ys,u24be as $s,u32 as ea,u32be as ta,u40 as na,u40be as ra,u48 as oa,u48be as ia,u8 as sa,UInt as yn,union as aa,Union as ua,unionLayoutDiscriminator as ca,utf8 as la}from"@solana/buffer-layout";var kt=gn;var Bt=yn;var Lt=fn;function Xe(n){return new Bt(1,n)}var Qe=class extends kt{decode(e,t){return super.decode(e,t)}};function Ye(n,e,t){return new Qe(n,e,t)}var $e=Ye([Xe("instruction"),Lt("amount")]),ye=Ye([Xe("instruction")]);function Fa({programId:n,amount:e,instructionKeys:t}){let r=[{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:Ee,isSigner:!1,isWritable:!1},...Object.entries(t).map(([a,m])=>({pubkey:m,isSigner:a==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(a)}))],i=Buffer.alloc($e.span);return $e.encode({instruction:1,amount:Number(e)},i),new et({keys:r,programId:n,data:i})}function De({programId:n},e){let t=[{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:Ee,isSigner:!1,isWritable:!1},...Object.entries(e).map(([i,a])=>({pubkey:a,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],r=Buffer.alloc(ye.span);return ye.encode({instruction:2},r),new et({keys:t,programId:n,data:r})}function nt(n){let{poolConfig:e,userKeys:t,side:r}=n,i=r==="base"?t.baseTokenAccount:t.quoteTokenAccount,a=r==="base"?e.baseVault:e.quoteVault,m=Buffer.alloc(ye.span);ye.encode({instruction:2},m);let o=[{pubkey:tt,isWritable:!1,isSigner:!1},{pubkey:hn,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:a,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new et({programId:e.programId,keys:o,data:m})}var bn={[oe.IDO_PROGRAM_ID_V1.toString()]:1,[oe.IDO_PROGRAM_ID_V2.toString()]:2,[oe.IDO_PROGRAM_ID_V3.toString()]:3,[oe.IDO_PROGRAM_ID_V4.toString()]:4},Me=class extends ge{async claim({ownerInfo:e,idoKeys:t,associatedOnly:r=!0,checkCreateATAOwner:i=!1,txVersion:a,feePayer:m}){let o=this.createTxBuilder(m),w=bn[t.programId];w||this.logAndCreateError("invalid version",w);let s=Re(t),[y,T]=[!new Ct(e.coin).isZero(),!new Ct(e.pc).isZero()],A=s.projectInfo.mint.address.equals(Y),{account:h,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:s.projectInfo.mint.programId,mint:s.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:r,checkCreateATAOwner:i});!h&&y&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),y&&d&&o.addInstruction(d);let b=s.buyInfo.mint.address.equals(Y),{account:u,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:s.buyInfo.mint.programId,mint:s.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:b?!1:r,checkCreateATAOwner:i});if(!h&&T&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),T&&k&&o.addInstruction(k),(!h||!u)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),w===3)return o.addInstruction({instructions:[...y?[De({programId:s.programId},{idoId:s.id,authority:s.authority,poolTokenAccount:s.projectInfo.vault,userTokenAccount:h,userIdoInfo:new he(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...T?[De({programId:new he(t.programId)},{idoId:s.id,authority:s.authority,poolTokenAccount:s.buyInfo.vault,userTokenAccount:u,userIdoInfo:new he(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:a});if(w<3)return!y&&!T&&this.logAndCreateError("no claimable rewards"),o.addInstruction({instructions:[De({programId:s.programId},{idoId:s.id,authority:s.authority,poolQuoteTokenAccount:s.buyInfo.vault,poolBaseTokenAccount:s.projectInfo.vault,userQuoteTokenAccount:u,userBaseTokenAccount:h,userIdoInfo:new he(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:a});let g={poolConfig:{id:s.id,programId:s.programId,authority:s.authority,baseVault:s.projectInfo.vault,quoteVault:s.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:h,quoteTokenAccount:u,ledgerAccount:new he(e.userIdoInfo),owner:this.scope.ownerPubKey}};return o.addInstruction({instructions:[...y?[nt(W(O({},g),{side:"base"}))]:[],...T?[nt(W(O({},g),{side:"quote"}))]:[]]}).versionBuild({txVersion:a})}};export{ye as claimLayout,Me as default,De as makeClaimInstruction,nt as makeClaimInstructionV4,Fa as makePurchaseInstruction,$e as purchaseLayout};
//# sourceMappingURL=index.mjs.map