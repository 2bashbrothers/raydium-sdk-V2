var Lt=Object.defineProperty,Ct=Object.defineProperties;var Rt=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var et=(n,e,t)=>e in n?Lt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,O=(n,e)=>{for(var t in e||(e={}))tt.call(e,t)&&et(n,t,e[t]);if(Te)for(var t of Te(e))nt.call(e,t)&&et(n,t,e[t]);return n},W=(n,e)=>Ct(n,Rt(e));var xe=(n,e)=>{var t={};for(var r in n)tt.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Te)for(var r of Te(n))e.indexOf(r)<0&&nt.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as he}from"@solana/web3.js";import It from"bn.js";import{PublicKey as l}from"@solana/web3.js";var Pn=new l("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),wn=new l("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),An=new l("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Sn=new l("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Bn=new l("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),In=new l("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),kn=new l("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ln=new l("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Cn=new l("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Rn=new l("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Dn=new l("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Mn=new l("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Nn=new l("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),_n=new l("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),En=new l("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),On=new l("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Dt=new l("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Mt=new l("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Nt=new l("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),_t=new l("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Fn=new l("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Vn=new l("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Kn=new l("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),vn=new l("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Wn=new l("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Un=new l("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),qn=new l("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Gn=new l("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),jn=new l("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Hn=new l("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),zn=new l("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX"),oe={IDO_PROGRAM_ID_V1:Dt,IDO_PROGRAM_ID_V2:Mt,IDO_PROGRAM_ID_V3:Nt,IDO_PROGRAM_ID_V4:_t};var Zn={OPEN_BOOK_PROGRAM:new l("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new l("Ray1111111111111111111111111111111111111111"),AMM_V4:new l("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new l("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new l("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new l("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new l("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new l("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new l("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new l("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new l("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new l("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:l.default,Router:new l("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new l("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new l("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new l("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new l("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new l("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new l("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new l("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new l("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new l("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new l("Ray1111111111111111111111111111111111111111")};import{PublicKey as N,SystemProgram as rt,SYSVAR_RENT_PUBKEY as Et}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ot}from"@solana/spl-token";function Me({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var $n=[Me({pubkey:Ot,isWritable:!1}),Me({pubkey:rt.programId,isWritable:!1}),Me({pubkey:Et,isWritable:!1})];function ot({publicKey:n,transformSol:e}){let t=Ne(n.toString());if(t instanceof N)return e&&t.equals(ie)?Q:t;if(e&&t.toString()===ie.toBase58())return Q;if(typeof t=="string"){if(t===N.default.toBase58())return N.default;try{return new N(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ne(n){try{return new N(n)}catch{return n}}var er=new N("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),tr=new N("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ft=new N("SysvarRent111111111111111111111111111111111"),it=new N("SysvarC1ock11111111111111111111111111111111"),nr=new N("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),rr=new N("Sysvar1nstructions1111111111111111111111111"),Vt=rt.programId,or=new N("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ir=new N("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),sr=new N("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ar=new N("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ur=new N("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),cr=new N("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),lr=new N("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),mr=new N("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),pr=new N("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),dr=new N("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),fr=new N("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Q=new N("So11111111111111111111111111111111111111112"),ie=N.default;import{PublicKey as mn}from"@solana/web3.js";import pn from"bn.js";import un from"big.js";import Ce from"bn.js";import j from"bn.js";import oo from"decimal.js";import{PublicKey as Kt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as st}from"@solana/spl-token";var at={chainId:101,address:Kt.default.toBase58(),programId:st.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Z={chainId:101,address:"So11111111111111111111111111111111111111112",programId:st.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as _e}from"@solana/web3.js";var Ee=class{constructor({mint:e,decimals:t,symbol:r,name:u,skipMint:c=!1,isToken2022:p=!1}){if(e===ie.toBase58()||e instanceof _e&&ie.equals(e)){this.decimals=Z.decimals,this.symbol=Z.symbol,this.name=Z.name,this.mint=new _e(Z.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=u||e.toString().substring(0,6),this.mint=c?_e.default:ot({publicKey:e}),this.isToken2022=p}equals(e){return this===e?!0:this.mint.equals(e.mint)}},J=Ee;J.WSOL=new Ee(W(O({},Z),{mint:Z.address}));var Oe=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Pe=Oe;Pe.SOL=new Oe(at);import Ae from"big.js";import jt from"bn.js";import Ht from"decimal.js-light";import{get as ut,set as vt}from"lodash";var Fe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ct={},Wt={};function V(n){let e=ut(ct,n);if(!e){let t=ut(Wt,n);e=new Fe({name:n,logLevel:t}),vt(ct,n,e)}return e}import se from"bn.js";var lt=9007199254740991;function v(n){let e=V("Raydium_parseBigNumberish");if(n instanceof se)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new se(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=lt||n<=-lt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new se(String(n))):typeof n=="bigint"?new se(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new se(0))}import Ut from"toformat";var qt=Ut,ae=qt;var we=V("module/fraction"),Ve=ae(Ae),ue=ae(Ht),zt={[0]:ue.ROUND_DOWN,[1]:ue.ROUND_HALF_UP,[2]:ue.ROUND_UP},Zt={[0]:Ae.roundDown,[1]:Ae.roundHalfUp,[2]:Ae.roundUp},L=class{constructor(e,t=new jt(1)){this.numerator=v(e),this.denominator=v(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new L(this.denominator,this.numerator)}add(e){let t=e instanceof L?e:new L(v(e));return this.denominator.eq(t.denominator)?new L(this.numerator.add(t.numerator),this.denominator):new L(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof L?e:new L(v(e));return this.denominator.eq(t.denominator)?new L(this.numerator.sub(t.numerator),this.denominator):new L(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof L?e:new L(v(e));return new L(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof L?e:new L(v(e));return new L(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||we.logWithError(`${e} is not an integer.`),e<=0&&we.logWithError(`${e} is not positive.`),ue.set({precision:e+1,rounding:zt[r]});let u=new ue(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return u.toFormat(u.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||we.logWithError(`${e} is not an integer.`),e<0&&we.logWithError(`${e} is negative.`),Ve.DP=e,Ve.RM=Zt[r]||1,new Ve(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import Jt from"bn.js";var mt=new L(new Jt(100)),$=class extends L{toSignificant(e=5,t,r){return this.mul(mt).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(mt).toFixed(e,t,r)}};var Xt=V("Raydium_price"),q=class extends L{constructor(t){let{baseToken:r,quoteToken:u,numerator:c,denominator:p}=t;super(c,p);this.baseToken=r,this.quoteToken=u,this.scalar=new L(Ke(r.decimals),Ke(u.decimals))}get raw(){return new L(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new q({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Xt.logWithError("mul token not equals");let r=super.mul(t);return new q({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,u){return this.adjusted.toSignificant(t,r,u)}toFixed(t=this.quoteToken.decimals,r,u){return this.adjusted.toFixed(t,r,u)}};var Yt=new j(0),go=new j(1),yo=new j(2),ho=new j(3),bo=new j(5),ve=new j(10),To=new j(100),xo=new j(1e3),Po=new j(1e4);function Ke(n){return ve.pow(v(n))}import{PublicKey as Qt}from"@solana/web3.js";import{MINT_SIZE as Mo,TOKEN_PROGRAM_ID as No,getTransferFeeConfig as _o,unpackMint as Eo}from"@solana/spl-token";var We=V("Raydium_accountInfo_util");async function dt(n,e,t){let{batchRequest:r,commitment:u="confirmed",chunkCount:c=100}=O({batchRequest:!1},t),p=Ue(e,c),o=new Array(p.length).fill([]);if(r){let w=p.map(T=>{let A=n._buildArgs([T.map(h=>h.toBase58())],u,"base64");return{methodName:"getMultipleAccounts",args:A}}),i=Ue(w,10);o=(await(await Promise.all(i.map(async T=>await n._rpcBatchRequest(T)))).flat()).map(T=>(T.error&&We.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${T.error.message}`),T.result.value.map(A=>{if(A){let{data:h,executable:d,lamports:b,owner:s,rentEpoch:S}=A;return h.length!==2&&h[1]!=="base64"&&We.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(h[0],"base64"),executable:d,lamports:b,owner:new Qt(s),rentEpoch:S}}return null})))}else try{o=await Promise.all(p.map(w=>n.getMultipleAccountsInfo(w,u)))}catch(w){w instanceof Error&&We.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${w.message}`)}return o.flat()}function Ue(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}import{PublicKey as ei}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ni}from"@solana/spl-token";import{ComputeBudgetProgram as ft,Keypair as yt,PublicKey as jo,Transaction as ht,TransactionMessage as $t,VersionedTransaction as bt}from"@solana/web3.js";var ce={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as en}from"@solana/spl-token";var gt=V("Raydium_txUtil"),Tt=1644;function Se(n){let e=[],t=[];return n.microLamports&&(e.push(ft.setComputeUnitPrice({microLamports:n.microLamports})),t.push(ce.SetComputeUnitPrice)),n.units&&(e.push(ft.setComputeUnitLimit({units:n.units})),t.push(ce.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ee(n,e){var r,u;let t=e!=null?e:"confirmed";return(u=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:u.blockhash}async function Be(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let u=setTimeout(r,6e4);n.onSignature(e,c=>{if(clearTimeout(u),!c.err){t("");return}r(Object.assign(c.err,{txId:e}))},"confirmed")})}function tn(n,e){n.length<1&&gt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&gt.logWithError(`no signers provided:, ${e.toString()}`);let t=new ht;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Tt}catch{return!1}}function le({instructions:n,payer:e,signers:t}){return tn(n,[e,...t])}function me({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=yt.generate().publicKey.toString()}){let c=new $t({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new bt(c).serialize()).toString("base64").length<Tt}catch{return!1}}var nn=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),rn=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof bt&&(e=nn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function X(n){let e=[];return n.forEach(t=>{t instanceof ht&&(t.recentBlockhash||(t.recentBlockhash=en.toBase58()),t.feePayer||(t.feePayer=yt.generate().publicKey)),e.push(rn(t))}),console.log("simulate tx string:",e),e}import si from"bn.js";import{PublicKey as qe,AddressLookupTableAccount as ne}from"@solana/web3.js";async function Ge({connection:n,address:e,cluster:t="mainnet"}){let r=await dt(n,[...new Set(e.map(c=>c.toString()))].map(c=>new qe(c))),u={};for(let c=0;c<e.length;c++){let p=r[c],o=e[c];if(!p)continue;let w=new ne({key:o,state:ne.deserialize(p.data)});u[o.toString()]=w,t==="devnet"?te[o.toString()]=w:Ie[o.toString()]=w}return u}var Ie={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ne({key:new qe("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ne.deserialize(Buffer.from("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","base64"))})},te={},je=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(te[e])return te;let t=new qe(e),r=await n.getAccountInfo(t);return r&&(te[e]=new ne({key:t,state:ne.deserialize(r.data)})),te};import{PublicKey as re,sendAndConfirmTransaction as He,SystemProgram as on,Transaction as pe,TransactionMessage as de,VersionedTransaction as fe}from"@solana/web3.js";import sn from"axios";var ke=2e3,Le=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await sn.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Se(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(on.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new re(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(ce.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:u=[],endInstructionTypes:c=[],lookupTableAddress:p=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...u),this.endInstructionTypes.push(...c),this.lookupTableAddress.push(...p.filter(o=>o!==re.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(O({},t||{})):this.build(t)}build(e){var r;let t=new pe;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(u=>u.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async u=>{var y;let{recentBlockHash:c,skipPreflight:p=!0,sendAndConfirm:o,notSendToRpc:w}=u||{},i=c!=null?c:await ee(this.connection,this.blockhashCommitment);if(t.recentBlockhash=i,this.signers.length&&t.sign(...this.signers),X([t]),(y=this.owner)!=null&&y.isKeyPair)return{txId:o?await He(this.connection,t,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:p}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:p}),signedTx:t};if(this.signAllTransactions){let T=await this.signAllTransactions([t]);if(this.signers.length)for(let A of T)try{A.sign(...this.signers)}catch{}return{txId:w?"":await this.connection.sendRawTransaction(T[0].serialize(),{skipPreflight:p}),signedTx:T[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var i;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:u}=this.build(r),c=t.filter(y=>y.transaction.instructions.length>0),p=[u,...c.map(y=>y.transaction)],o=[this.signers,...c.map(y=>y.signers)],w=[...this.instructionTypes,...c.map(y=>y.instructionTypes).flat()];return(i=this.owner)!=null&&i.signer&&o.forEach(y=>{y.some(T=>T.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:p,signers:o,instructionTypes:w,execute:async y=>{var S;let{sequentially:T,onTxUpdate:A,skipTxCount:h=0,recentBlockHash:d,skipPreflight:b=!0}=y||{},s=d!=null?d:await ee(this.connection,this.blockhashCommitment);if((S=this.owner)!=null&&S.isKeyPair){if(T){let g=[],C=0;for(let f of p){if(++C,C<=h)continue;let a=await He(this.connection,f,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});g.push(a)}return{txIds:g,signedTxs:p}}return{txIds:await await Promise.all(p.map(async g=>(g.recentBlockhash=s,await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:b})))),signedTxs:p}}if(this.signAllTransactions){let g=p.map((f,a)=>(f.recentBlockhash=s,o[a].length&&f.sign(...o[a]),f));X(g);let C=await this.signAllTransactions(g);if(T){let f=0,a=[],m=async()=>{if(!C[f])return;let P=await this.connection.sendRawTransaction(C[f].serialize(),{skipPreflight:b});a.push({txId:P,status:"sent",signedTx:C[f]}),A==null||A([...a]),f++;let x=!1,k=null,D=null,_=R=>{k!==null&&clearInterval(k),D!==null&&this.connection.removeSignatureListener(D);let M=a.findIndex(E=>E.txId===P);if(M>-1){if(a[M].status==="error"||a[M].status==="success")return;a[M].status=R.err?"error":"success"}A==null||A([...a]),R.err||m()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var R;if(x){clearInterval(k);return}try{let M=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(x=!0,clearInterval(k),_({err:((R=M.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",P))}catch(M){x=!0,clearInterval(k),console.error("getTransaction timeout:",M,P)}},ke)),D=this.connection.onSignature(P,R=>{if(x){this.connection.removeSignatureListener(D);return}x=!0,_(R)},"confirmed"),this.connection.getSignatureStatus(P)};return await m(),{txIds:a.map(P=>P.txId),signedTxs:C}}else{let f=[];for(let a=0;a<C.length;a+=1){let m=await this.connection.sendRawTransaction(C[a].serialize(),{skipPreflight:b});f.push(m)}return{txIds:f,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var b;let d=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:u,recentBlockhash:c}=d,p=xe(d,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=O(O({},this.cluster==="devnet"?await je(this.connection):Ie),t),w=Array.from(new Set([...r,...this.lookupTableAddress])),i=[];for(let s of w)o[s]===void 0&&i.push(new re(s));let y=await Ge({connection:this.connection,address:i});for(let[s,S]of Object.entries(y))o[s]=S;let T=u?re.default.toBase58():c!=null?c:await ee(this.connection,this.blockhashCommitment),A=new de({payerKey:this.feePayer,recentBlockhash:T,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(s=>s.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let h=new fe(A);return h.sign(this.signers),{builder:this,transaction:h,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async s=>{var f;let{skipPreflight:S=!0,sendAndConfirm:g,notSendToRpc:C}=s||{};if(X([h]),(f=this.owner)!=null&&f.isKeyPair){let a=await this.connection.sendTransaction(h,{skipPreflight:S});return g&&await Be(this.connection,a),{txId:a,signedTx:h}}if(this.signAllTransactions){let a=await this.signAllTransactions([h]);if(this.signers.length)for(let m of a)try{m.sign(this.signers)}catch{}return{txId:C?"":await this.connection.sendTransaction(a[0],{skipPreflight:S}),signedTx:a[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:p||{}}}async buildV0MultiTx(e){var i;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:u}=await this.buildV0(r),c=t.filter(y=>y.builder.instructions.length>0),p=[u,...c.map(y=>y.transaction)],o=[this.signers,...c.map(y=>y.signers)],w=[...this.instructionTypes,...c.map(y=>y.instructionTypes).flat()];return(i=this.owner)!=null&&i.signer&&o.forEach(y=>{y.some(T=>T.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),p.forEach(async(y,T)=>{y.sign(o[T])}),{builder:this,transactions:p,signers:o,instructionTypes:w,buildProps:r,execute:async y=>{var b;let{sequentially:T,onTxUpdate:A,recentBlockHash:h,skipPreflight:d=!0}=y||{};if(h&&p.forEach(s=>s.message.recentBlockhash=h),X(p),(b=this.owner)!=null&&b.isKeyPair){if(T){let s=[];for(let S of p){let g=await this.connection.sendTransaction(S,{skipPreflight:d});await Be(this.connection,g),s.push(g)}return{txIds:s,signedTxs:p}}return{txIds:await Promise.all(p.map(async s=>await this.connection.sendTransaction(s,{skipPreflight:d}))),signedTxs:p}}if(this.signAllTransactions){let s=await this.signAllTransactions(p);if(T){let S=0,g=[],C=async()=>{if(!s[S])return;let f=await this.connection.sendTransaction(s[S],{skipPreflight:d});g.push({txId:f,status:"sent",signedTx:s[S]}),A==null||A([...g]),S++;let a=!1,m=null,P=null,x=k=>{m!==null&&clearInterval(m),P!==null&&this.connection.removeSignatureListener(P);let D=g.findIndex(_=>_.txId===f);if(D>-1){if(g[D].status==="error"||g[D].status==="success")return;g[D].status=k.err?"error":"success"}A==null||A([...g]),k.err||C()};this.loopMultiTxStatus&&(m=setInterval(async()=>{var k;if(a){clearInterval(m);return}try{let D=await this.connection.getTransaction(f,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(a=!0,clearInterval(m),x({err:((k=D.meta)==null?void 0:k.err)||null}),console.log("tx status from getTransaction:",f))}catch(D){a=!0,clearInterval(m),console.error("getTransaction timeout:",D,f)}},ke)),P=this.connection.onSignature(f,k=>{if(a){this.connection.removeSignatureListener(P);return}a=!0,x(k)},"confirmed"),this.connection.getSignatureStatus(f)};return C(),{txIds:[],signedTxs:s}}else{let S=[];for(let g=0;g<s.length;g+=1){let C=await this.connection.sendTransaction(s[g],{skipPreflight:d});S.push(C)}return{txIds:S,signedTxs:s}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var A;let T=e||{},{splitIns:t=[],computeBudgetConfig:r}=T,u=xe(T,["splitIns","computeBudgetConfig"]),c=r?Se(r):{instructions:[],instructionTypes:[]},p=this.signers.reduce((h,d)=>W(O({},h),{[d.publicKey.toBase58()]:d}),{}),o=[],w=[],i=[],y=0;if(this.allInstructions.forEach(h=>{let d=[...i,h],b=r?[...c.instructions,...d]:d,S=[...new Set(d.map(g=>g.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat()).values()].map(g=>new re(g));if(h!==t[y]&&i.length<12&&(le({instructions:b,payer:this.feePayer,signers:S})||le({instructions:d,payer:this.feePayer,signers:S})))i.push(h);else{if(i.length===0)throw Error("item ins too big");y+=h===t[y]?1:0,le({instructions:r?[...c.instructions,...i]:[...i],payer:this.feePayer,signers:S})?o.push(new pe().add(...c.instructions,...i)):o.push(new pe().add(...i)),w.push(Array.from(new Set(i.map(g=>g.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(g=>p[g]).filter(g=>g!==void 0)),i=[h]}}),i.length>0){let d=[...new Set(i.map(b=>b.keys.filter(s=>s.isSigner).map(s=>s.pubkey.toString())).flat()).values()].map(b=>p[b]).filter(b=>b!==void 0);le({instructions:r?[...c.instructions,...i]:[...i],payer:this.feePayer,signers:d.map(b=>b.publicKey)})?o.push(new pe().add(...c.instructions,...i)):o.push(new pe().add(...i)),w.push(d)}return o.forEach(h=>h.feePayer=this.feePayer),(A=this.owner)!=null&&A.signer&&w.forEach(h=>{h.some(d=>d.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),{builder:this,transactions:o,signers:w,instructionTypes:this.instructionTypes,execute:async h=>{var f;let{sequentially:d,onTxUpdate:b,skipTxCount:s=0,recentBlockHash:S,skipPreflight:g=!0}=h||{},C=S!=null?S:await ee(this.connection,this.blockhashCommitment);if(o.forEach(async(a,m)=>{a.recentBlockhash=C,w[m].length&&a.sign(...w[m])}),X(o),(f=this.owner)!=null&&f.isKeyPair){if(d){let a=0,m=[];for(let P of o){if(++a,a<=s){m.push("tx skipped");continue}let x=await He(this.connection,P,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});m.push(x)}return{txIds:m,signedTxs:o}}return{txIds:await Promise.all(o.map(async a=>await this.connection.sendRawTransaction(a.serialize(),{skipPreflight:g}))),signedTxs:o}}if(this.signAllTransactions){let a=await this.signAllTransactions(o.slice(s,o.length)),m=[...o.slice(0,s),...a];if(d){let P=0,x=[],k=async()=>{if(!m[P])return;P<s&&(x.push({txId:"",status:"success",signedTx:m[P]}),b==null||b([...x]),P++,k());let D=await this.connection.sendRawTransaction(m[P].serialize(),{skipPreflight:g});x.push({txId:D,status:"sent",signedTx:m[P]}),b==null||b([...x]),P++;let _=!1,R=null,M=null,E=K=>{R!==null&&clearInterval(R),M!==null&&this.connection.removeSignatureListener(M);let F=x.findIndex(H=>H.txId===D);if(F>-1){if(x[F].status==="error"||x[F].status==="success")return;x[F].status=K.err?"error":"success"}b==null||b([...x]),K.err||k()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var K;if(_){clearInterval(R);return}try{let F=await this.connection.getTransaction(D,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(_=!0,clearInterval(R),E({err:((K=F.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",D))}catch(F){_=!0,clearInterval(R),console.error("getTransaction timeout:",F,D)}},ke)),M=this.connection.onSignature(D,K=>{if(_){this.connection.removeSignatureListener(M);return}_=!0,E(K)},"confirmed"),this.connection.getSignatureStatus(D)};return await k(),{txIds:x.map(D=>D.txId),signedTxs:m}}else{let P=[];for(let x=0;x<m.length;x+=1){let k=await this.connection.sendRawTransaction(m[x].serialize(),{skipPreflight:g});P.push(k)}return{txIds:P,signedTxs:m}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:u||{}}}async sizeCheckBuildV0(e){var C;let g=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:u={},lookupTableAddress:c=[]}=g,p=xe(g,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=O(O({},this.cluster==="devnet"?await je(this.connection):Ie),u),w=Array.from(new Set([...this.lookupTableAddress,...c])),i=[];for(let f of w)o[f]===void 0&&i.push(new re(f));let y=await Ge({connection:this.connection,address:i});for(let[f,a]of Object.entries(y))o[f]=a;let T=t?Se(t):{instructions:[],instructionTypes:[]},A=await ee(this.connection,this.blockhashCommitment),h=this.signers.reduce((f,a)=>W(O({},f),{[a.publicKey.toBase58()]:a}),{}),d=[],b=[],s=[],S=0;if(this.allInstructions.forEach(f=>{let a=[...s,f],m=t?[...T.instructions,...a]:a;if(f!==r[S]&&s.length<12&&(me({instructions:m,payer:this.feePayer,lookupTableAddressAccount:o})||me({instructions:a,payer:this.feePayer,lookupTableAddressAccount:o})))s.push(f);else{if(s.length===0)throw Error("item ins too big");S+=f===r[S]?1:0;let P={};for(let x of[...new Set(w)])o[x]!==void 0&&(P[x]=o[x]);if(t&&me({instructions:[...T.instructions,...s],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let x=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...T.instructions,...s]}).compileToV0Message(Object.values(o));d.push(new fe(x))}else{let x=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...s]}).compileToV0Message(Object.values(o));d.push(new fe(x))}b.push(Array.from(new Set(s.map(x=>x.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(x=>h[x]).filter(x=>x!==void 0)),s=[f]}}),s.length>0){let a=[...new Set(s.map(m=>m.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(m=>h[m]).filter(m=>m!==void 0);if(t&&me({instructions:[...T.instructions,...s],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:A})){let m=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...T.instructions,...s]}).compileToV0Message(Object.values(o));d.push(new fe(m))}else{let m=new de({payerKey:this.feePayer,recentBlockhash:A,instructions:[...s]}).compileToV0Message(Object.values(o));d.push(new fe(m))}b.push(a)}return(C=this.owner)!=null&&C.signer&&b.forEach(f=>{f.some(a=>a.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),d.forEach((f,a)=>{f.sign(b[a])}),{builder:this,transactions:d,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async f=>{var D;let{sequentially:a,onTxUpdate:m,skipTxCount:P=0,recentBlockHash:x,skipPreflight:k=!0}=f||{};if(d.map(async(_,R)=>{b[R].length&&_.sign(b[R]),x&&(_.message.recentBlockhash=x)}),X(d),(D=this.owner)!=null&&D.isKeyPair){if(a){let _=0,R=[];for(let M of d){if(++_,_<=P){console.log("skip tx: ",_),R.push("tx skipped");continue}let E=await this.connection.sendTransaction(M,{skipPreflight:k});await Be(this.connection,E),R.push(E)}return{txIds:R,signedTxs:d}}return{txIds:await Promise.all(d.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:k}))),signedTxs:d}}if(this.signAllTransactions){let _=await this.signAllTransactions(d.slice(P,d.length)),R=[...d.slice(0,P),..._];if(a){let M=0,E=[],K=async()=>{if(!R[M])return;if(M<P){E.push({txId:"",status:"success",signedTx:R[M]}),m==null||m([...E]),M++,K();return}let F=await this.connection.sendTransaction(R[M],{skipPreflight:k});E.push({txId:F,status:"sent",signedTx:R[M]}),m==null||m([...E]),M++;let H=!1,Y=null,be=null,$e=z=>{Y!==null&&clearInterval(Y),be!==null&&this.connection.removeSignatureListener(be);let U=E.findIndex(kt=>kt.txId===F);if(U>-1){if(E[U].status==="error"||E[U].status==="success")return;E[U].status=z.err?"error":"success"}m==null||m([...E]),z.err||K()};this.loopMultiTxStatus&&(Y=setInterval(async()=>{var z;if(H){clearInterval(Y);return}try{let U=await this.connection.getTransaction(F,{commitment:"confirmed",maxSupportedTransactionVersion:0});U&&(H=!0,clearInterval(Y),$e({err:((z=U.meta)==null?void 0:z.err)||null}),console.log("tx status from getTransaction:",F))}catch(U){H=!0,clearInterval(Y),console.error("getTransaction timeout:",U,F)}},ke)),be=this.connection.onSignature(F,z=>{if(H){this.connection.removeSignatureListener(be);return}H=!0,$e(z)},"confirmed"),this.connection.getSignatureStatus(F)};return K(),{txIds:[],signedTxs:R}}else{let M=[];for(let E=0;E<R.length;E+=1){let K=await this.connection.sendTransaction(R[E],{skipPreflight:k});M.push(K)}return{txIds:M,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:p||{}}}};import an from"bn.js";var Ii=new an(1e6);var cn=V("Raydium_amount"),xt=ae(un);function ln(n,e){let t="0",r="0";if(n.includes(".")){let u=n.split(".");u.length===2?([t,r]=u,r=r.padEnd(e,"0")):cn.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var G=class extends L{constructor(t,r,u=!0,c){let p=new Ce(0),o=ve.pow(new Ce(t.decimals));if(u)p=v(r);else{let w=new Ce(0),i=new Ce(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[y,T]=ln(r.toString(),t.decimals);w=v(y),i=v(T)}w=w.mul(o),p=w.add(i)}super(p,o);this.logger=V(c||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new G(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new G(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,u=0){return super.toSignificant(t,r,u)}toFixed(t=this.token.decimals,r,u=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,u)}toExact(t={groupSeparator:""}){return xt.DP=this.token.decimals,new xt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function pt(n){return typeof n=="object"&&n!==null&&![J,G,mn,L,pn,q,$].some(e=>typeof e=="object"&&n instanceof e)}function Re(n){return typeof n=="string"?Ne(n):Array.isArray(n)?n.map(e=>Re(e)):pt(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,Re(t)])):n}var ze=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ge=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=V(t)}createTxBuilder(e){return this.scope.checkOwner(),new Le({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(ze(e))}logInfo(...e){this.logger.info(ze(e))}logAndCreateError(...e){let t=ze(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as hn,TransactionInstruction as St}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bt}from"@solana/spl-token";import{PublicKey as Aa}from"@solana/web3.js";import Ba,{isBN as Ia}from"bn.js";import{bits as ws,BitStructure as As,blob as Ss,Blob as Bs,cstr as Is,f32 as ks,f32be as Ls,f64 as Cs,f64be as Rs,greedy as Ds,Layout as Ms,ns64 as Ns,ns64be as _s,nu64 as dn,nu64be as Es,offset as Os,s16 as Fs,s16be as Vs,s24 as Ks,s24be as vs,s32 as Ws,s32be as Us,s40 as qs,s40be as Gs,s48 as js,s48be as Hs,s8 as zs,seq as Zs,struct as Js,Structure as fn,u16 as Xs,u16be as Ys,u24 as Qs,u24be as $s,u32 as ea,u32be as ta,u40 as na,u40be as ra,u48 as oa,u48be as ia,u8 as sa,UInt as gn,union as aa,Union as ua,unionLayoutDiscriminator as ca,utf8 as la}from"@solana/buffer-layout";var Pt=fn;var wt=gn;var At=dn;function Je(n){return new wt(1,n)}var Ze=class extends Pt{decode(e,t){return super.decode(e,t)}};function Xe(n,e,t){return new Ze(n,e,t)}var yn=Xe([Je("instruction"),At("amount")]),ye=Xe([Je("instruction")]);function De({programId:n},e){let t=[{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},...Object.entries(e).map(([u,c])=>({pubkey:c,isSigner:u==="userOwner",isWritable:!["authority","userOwner"].includes(u)}))],r=Buffer.alloc(ye.span);return ye.encode({instruction:2},r),new St({keys:t,programId:n,data:r})}function Ye(n){let{poolConfig:e,userKeys:t,side:r}=n,u=r==="base"?t.baseTokenAccount:t.quoteTokenAccount,c=r==="base"?e.baseVault:e.quoteVault,p=Buffer.alloc(ye.span);ye.encode({instruction:2},p);let o=[{pubkey:Bt,isWritable:!1,isSigner:!1},{pubkey:hn,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new St({programId:e.programId,keys:o,data:p})}var bn={[oe.IDO_PROGRAM_ID_V1.toString()]:1,[oe.IDO_PROGRAM_ID_V2.toString()]:2,[oe.IDO_PROGRAM_ID_V3.toString()]:3,[oe.IDO_PROGRAM_ID_V4.toString()]:4},Qe=class extends ge{async claim({ownerInfo:e,idoKeys:t,associatedOnly:r=!0,checkCreateATAOwner:u=!1,txVersion:c,feePayer:p}){let o=this.createTxBuilder(p),w=bn[t.programId];w||this.logAndCreateError("invalid version",w);let i=Re(t),[y,T]=[!new It(e.coin).isZero(),!new It(e.pc).isZero()],A=i.projectInfo.mint.address.equals(Q),{account:h,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:i.projectInfo.mint.programId,mint:i.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:r,checkCreateATAOwner:u});!h&&y&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),y&&d&&o.addInstruction(d);let b=i.buyInfo.mint.address.equals(Q),{account:s,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:i.buyInfo.mint.programId,mint:i.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:b?!1:r,checkCreateATAOwner:u});if(!h&&T&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),T&&S&&o.addInstruction(S),(!h||!s)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),w===3)return o.addInstruction({instructions:[...y?[De({programId:i.programId},{idoId:i.id,authority:i.authority,poolTokenAccount:i.projectInfo.vault,userTokenAccount:h,userIdoInfo:new he(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...T?[De({programId:new he(t.programId)},{idoId:i.id,authority:i.authority,poolTokenAccount:i.buyInfo.vault,userTokenAccount:s,userIdoInfo:new he(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:c});if(w<3)return!y&&!T&&this.logAndCreateError("no claimable rewards"),o.addInstruction({instructions:[De({programId:i.programId},{idoId:i.id,authority:i.authority,poolQuoteTokenAccount:i.buyInfo.vault,poolBaseTokenAccount:i.projectInfo.vault,userQuoteTokenAccount:s,userBaseTokenAccount:h,userIdoInfo:new he(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:c});let g={poolConfig:{id:i.id,programId:i.programId,authority:i.authority,baseVault:i.projectInfo.vault,quoteVault:i.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:h,quoteTokenAccount:s,ledgerAccount:new he(e.userIdoInfo),owner:this.scope.ownerPubKey}};return o.addInstruction({instructions:[...y?[Ye(W(O({},g),{side:"base"}))]:[],...T?[Ye(W(O({},g),{side:"quote"}))]:[]]}).versionBuild({txVersion:c})}};export{Qe as default};
//# sourceMappingURL=ido.mjs.map