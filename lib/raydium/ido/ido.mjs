var Ct=Object.defineProperty,Rt=Object.defineProperties;var _t=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var rt=(n,e,t)=>e in n?Ct(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,F=(n,e)=>{for(var t in e||(e={}))ot.call(e,t)&&rt(n,t,e[t]);if(Be)for(var t of Be(e))it.call(e,t)&&rt(n,t,e[t]);return n},H=(n,e)=>Rt(n,_t(e));var me=(n,e)=>{var t={};for(var r in n)ot.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Be)for(var r of Be(n))e.indexOf(r)<0&&it.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as ke}from"@solana/web3.js";import Lt from"bn.js";import{PublicKey as f}from"@solana/web3.js";var Sn=new f("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),An=new f("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),In=new f("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),kn=new f("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Bn=new f("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ln=new f("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Cn=new f("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Rn=new f("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),_n=new f("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Dn=new f("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Mn=new f("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Nn=new f("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),En=new f("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),On=new f("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Fn=new f("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Vn=new f("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Dt=new f("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Mt=new f("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Nt=new f("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Et=new f("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Kn=new f("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),vn=new f("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Wn=new f("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Un=new f("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),qn=new f("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Gn=new f("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Hn=new f("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),jn=new f("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),zn=new f("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Yn=new f("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Jn=new f("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX"),pe={IDO_PROGRAM_ID_V1:Dt,IDO_PROGRAM_ID_V2:Mt,IDO_PROGRAM_ID_V3:Nt,IDO_PROGRAM_ID_V4:Et};var Zn={OPEN_BOOK_PROGRAM:new f("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new f("Ray1111111111111111111111111111111111111111"),AMM_V4:new f("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new f("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new f("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new f("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new f("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new f("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new f("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new f("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new f("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new f("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:f.default,Router:new f("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new f("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new f("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new f("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new f("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new f("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new f("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new f("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new f("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new f("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new f("Ray1111111111111111111111111111111111111111")};import{PublicKey as O,SystemProgram as st,SYSVAR_RENT_PUBKEY as Ot}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ft}from"@solana/spl-token";function Fe({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var tr=[Fe({pubkey:Ft,isWritable:!1}),Fe({pubkey:st.programId,isWritable:!1}),Fe({pubkey:Ot,isWritable:!1})];function at({publicKey:n,transformSol:e}){let t=Ve(n.toString());if(t instanceof O)return e&&t.equals(de)?se:t;if(e&&t.toString()===de.toBase58())return se;if(typeof t=="string"){if(t===O.default.toBase58())return O.default;try{return new O(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ve(n){try{return new O(n)}catch{return n}}var nr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),rr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Vt=new O("SysvarRent111111111111111111111111111111111"),ut=new O("SysvarC1ock11111111111111111111111111111111"),or=new O("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ir=new O("Sysvar1nstructions1111111111111111111111111"),Kt=st.programId,sr=new O("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ar=new O("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ur=new O("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),cr=new O("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),lr=new O("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),mr=new O("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),pr=new O("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),dr=new O("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),fr=new O("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),gr=new O("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),hr=new O("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),se=new O("So11111111111111111111111111111111111111112"),de=O.default;import{PublicKey as pn}from"@solana/web3.js";import dn from"bn.js";import cn from"big.js";import Me from"bn.js";import Z from"bn.js";import so from"decimal.js";import{PublicKey as vt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ct}from"@solana/spl-token";var lt={chainId:101,address:vt.default.toBase58(),programId:ct.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ne={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ct.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ke}from"@solana/web3.js";var ve=class{constructor({mint:e,decimals:t,symbol:r,name:p,skipMint:d=!1,isToken2022:g=!1}){if(e===de.toBase58()||e instanceof Ke&&de.equals(e)){this.decimals=ne.decimals,this.symbol=ne.symbol,this.name=ne.name,this.mint=new Ke(ne.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=p||e.toString().substring(0,6),this.mint=d?Ke.default:at({publicKey:e}),this.isToken2022=g}equals(e){return this===e?!0:this.mint.equals(e.mint)}},re=ve;re.WSOL=new ve(H(F({},ne),{mint:ne.address}));var We=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Le=We;Le.SOL=new We(lt);import Re from"big.js";import jt from"bn.js";import zt from"decimal.js-light";import{get as mt,set as Wt}from"lodash";var Ue=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},pt={},Ut={};function W(n){let e=mt(pt,n);if(!e){let t=mt(Ut,n);e=new Ue({name:n,logLevel:t}),Wt(pt,n,e)}return e}import fe from"bn.js";var dt=9007199254740991;function G(n){let e=W("Raydium_parseBigNumberish");if(n instanceof fe)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new fe(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=dt||n<=-dt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new fe(String(n))):typeof n=="bigint"?new fe(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new fe(0))}import qt from"toformat";var Gt=qt,ge=Gt;var Ce=W("module/fraction"),qe=ge(Re),he=ge(zt),Yt={[0]:he.ROUND_DOWN,[1]:he.ROUND_HALF_UP,[2]:he.ROUND_UP},Jt={[0]:Re.roundDown,[1]:Re.roundHalfUp,[2]:Re.roundUp},M=class{constructor(e,t=new jt(1)){this.numerator=G(e),this.denominator=G(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new M(this.denominator,this.numerator)}add(e){let t=e instanceof M?e:new M(G(e));return this.denominator.eq(t.denominator)?new M(this.numerator.add(t.numerator),this.denominator):new M(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof M?e:new M(G(e));return this.denominator.eq(t.denominator)?new M(this.numerator.sub(t.numerator),this.denominator):new M(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof M?e:new M(G(e));return new M(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof M?e:new M(G(e));return new M(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||Ce.logWithError(`${e} is not an integer.`),e<=0&&Ce.logWithError(`${e} is not positive.`),he.set({precision:e+1,rounding:Yt[r]});let p=new he(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return p.toFormat(p.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||Ce.logWithError(`${e} is not an integer.`),e<0&&Ce.logWithError(`${e} is negative.`),qe.DP=e,qe.RM=Jt[r]||1,new qe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import Zt from"bn.js";var ft=new M(new Zt(100)),ae=class extends M{toSignificant(e=5,t,r){return this.mul(ft).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(ft).toFixed(e,t,r)}};var Xt=W("Raydium_price"),Y=class extends M{constructor(t){let{baseToken:r,quoteToken:p,numerator:d,denominator:g}=t;super(d,g);this.baseToken=r,this.quoteToken=p,this.scalar=new M(Ge(r.decimals),Ge(p.decimals))}get raw(){return new M(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Y({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Xt.logWithError("mul token not equals");let r=super.mul(t);return new Y({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,p){return this.adjusted.toSignificant(t,r,p)}toFixed(t=this.quoteToken.decimals,r,p){return this.adjusted.toFixed(t,r,p)}};var Qt=new Z(0),ho=new Z(1),yo=new Z(2),bo=new Z(3),To=new Z(5),He=new Z(10),xo=new Z(100),Po=new Z(1e3),wo=new Z(1e4);function Ge(n){return He.pow(G(n))}import{PublicKey as $t}from"@solana/web3.js";import{MINT_SIZE as Mo,TOKEN_PROGRAM_ID as No,getTransferFeeConfig as Eo,unpackMint as Oo}from"@solana/spl-token";var je=W("Raydium_accountInfo_util");async function gt(n,e,t){let{batchRequest:r,commitment:p="confirmed",chunkCount:d=100}=F({batchRequest:!1},t),g=ze(e,d),o=new Array(g.length).fill([]);if(r){let A=g.map(b=>{let w=n._buildArgs([b.map(P=>P.toBase58())],p,"base64");return{methodName:"getMultipleAccounts",args:w}}),l=ze(A,10);o=(await(await Promise.all(l.map(async b=>await n._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&je.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(w=>{if(w){let{data:P,executable:c,lamports:h,owner:a,rentEpoch:B}=w;return P.length!==2&&P[1]!=="base64"&&je.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:c,lamports:h,owner:new $t(a),rentEpoch:B}}return null})))}else try{o=await Promise.all(g.map(A=>n.getMultipleAccountsInfo(A,p)))}catch(A){A instanceof Error&&je.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${A.message}`)}return o.flat()}function ze(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var j=class{constructor(e){this._owner=e}get publicKey(){return j.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return j.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return j.isKeyPair(this._owner)}get isPublicKey(){return j.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!j.isKeyPair(e)}};import{PublicKey as ti}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ri}from"@solana/spl-token";import{ComputeBudgetProgram as ht,Keypair as bt,PublicKey as jo,Transaction as Tt,TransactionMessage as en,VersionedTransaction as xt}from"@solana/web3.js";var ye={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as tn}from"@solana/spl-token";var yt=W("Raydium_txUtil"),Pt=1644;function be(n){let e=[],t=[];return n.microLamports&&(e.push(ht.setComputeUnitPrice({microLamports:n.microLamports})),t.push(ye.SetComputeUnitPrice)),n.units&&(e.push(ht.setComputeUnitLimit({units:n.units})),t.push(ye.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function oe(n,e){var r,p;let t=e!=null?e:"confirmed";return(p=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:p.blockhash}async function Te(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let p=setTimeout(r,6e4);n.onSignature(e,d=>{if(clearTimeout(p),!d.err){t("");return}r(Object.assign(d.err,{txId:e}))},"confirmed")})}function nn(n,e){n.length<1&&yt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&yt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Tt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Pt}catch{return!1}}function xe({instructions:n,payer:e,signers:t}){return nn(n,[e,...t])}function X({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=bt.generate().publicKey.toString()}){let d=new en({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new xt(d).serialize()).toString("base64").length<Pt}catch{return!1}}var rn=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),on=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof xt&&(e=rn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ee(n){let e=[];return n.forEach(t=>{t instanceof Tt&&(t.recentBlockhash||(t.recentBlockhash=tn.toBase58()),t.feePayer||(t.feePayer=bt.generate().publicKey)),e.push(on(t))}),console.log("simulate tx string:",e),e}import ai from"bn.js";import{PublicKey as Ye,AddressLookupTableAccount as ce}from"@solana/web3.js";async function _e({connection:n,address:e,cluster:t="mainnet"}){let r=await gt(n,[...new Set(e.map(d=>d.toString()))].map(d=>new Ye(d))),p={};for(let d=0;d<e.length;d++){let g=r[d],o=e[d];if(!g)continue;let A=new ce({key:o,state:ce.deserialize(g.data)});p[o.toString()]=A,t==="devnet"?ue[o.toString()]=A:te[o.toString()]=A}return p}var te={},Je=async n=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(te[e])return te;let t=new Ye(e),r=await n.getAccountInfo(t);return r&&(te[e]=new ce({key:t,state:ce.deserialize(r.data)})),te},ue={},De=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ue[e])return ue;let t=new Ye(e),r=await n.getAccountInfo(t);return r&&(ue[e]=new ce({key:t,state:ce.deserialize(r.data)})),ue};import{PublicKey as ie,sendAndConfirmTransaction as Ze,SystemProgram as sn,Transaction as Pe,TransactionMessage as Q,VersionedTransaction as $}from"@solana/web3.js";import an from"axios";var we=2e3,Se=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await an.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=be(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(sn.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new ie(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(ye.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:p=[],endInstructionTypes:d=[],lookupTableAddress:g=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...p),this.endInstructionTypes.push(...d),this.lookupTableAddress.push(...g.filter(o=>o!==ie.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(F({},t||{})):this.build(t)}build(e){var r;let t=new Pe;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(p=>p.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async p=>{var x;let{recentBlockHash:d,skipPreflight:g=!0,sendAndConfirm:o,notSendToRpc:A}=p||{},l=d!=null?d:await oe(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),ee([t]),(x=this.owner)!=null&&x.isKeyPair)return{txId:o?await Ze(this.connection,t,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:g}),signedTx:t};if(this.signAllTransactions){let b=await this.signAllTransactions([t]);if(this.signers.length)for(let w of b)try{w.sign(...this.signers)}catch{}return{txId:A?"":await this.connection.sendRawTransaction(b[0].serialize(),{skipPreflight:g}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:p}=this.build(r),d=t.filter(x=>x.transaction.instructions.length>0),g=[p,...d.map(x=>x.transaction)],o=[this.signers,...d.map(x=>x.signers)],A=[...this.instructionTypes,...d.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:g,signers:o,instructionTypes:A,execute:async x=>{var B;let{sequentially:b,onTxUpdate:w,skipTxCount:P=0,recentBlockHash:c,skipPreflight:h=!0}=x||{},a=c!=null?c:await oe(this.connection,this.blockhashCommitment);if((B=this.owner)!=null&&B.isKeyPair){if(b){let T=[],C=0;for(let u of g){if(++C,C<=P)continue;let i=await Ze(this.connection,u,this.signers.find(s=>s.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:h});T.push(i)}return{txIds:T,signedTxs:g}}return{txIds:await await Promise.all(g.map(async T=>(T.recentBlockhash=a,await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:h})))),signedTxs:g}}if(this.signAllTransactions){let T=g.map((u,i)=>(u.recentBlockhash=a,o[i].length&&u.sign(...o[i]),u));ee(T);let C=await this.signAllTransactions(T);if(b){let u=0,i=[],s=async()=>{if(!C[u])return;let y=await this.connection.sendRawTransaction(C[u].serialize(),{skipPreflight:h});i.push({txId:y,status:"sent",signedTx:C[u]}),w==null||w([...i]),u++;let m=!1,I=null,N=null,D=S=>{I!==null&&clearInterval(I),N!==null&&this.connection.removeSignatureListener(N);let k=i.findIndex(L=>L.txId===y);if(k>-1){if(i[k].status==="error"||i[k].status==="success")return;i[k].status=S.err?"error":"success"}w==null||w([...i]),S.err||s()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var S;if(m){clearInterval(I);return}try{let k=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});k&&(m=!0,clearInterval(I),D({err:((S=k.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",y))}catch(k){m=!0,clearInterval(I),console.error("getTransaction timeout:",k,y)}},we)),N=this.connection.onSignature(y,S=>{if(m){this.connection.removeSignatureListener(N);return}m=!0,D(S)},"confirmed"),this.connection.getSignatureStatus(y)};return await s(),{txIds:i.map(y=>y.txId),signedTxs:C}}else{let u=[];for(let i=0;i<C.length;i+=1){let s=await this.connection.sendRawTransaction(C[i].serialize(),{skipPreflight:h});u.push(s)}return{txIds:u,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var h;let c=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:p,recentBlockhash:d}=c,g=me(c,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=F(F({},this.cluster==="devnet"?await De(this.connection):await Je(this.connection)),t),A=Array.from(new Set([...r,...this.lookupTableAddress])),l=[];for(let a of A)o[a]===void 0&&l.push(new ie(a));let x=await _e({connection:this.connection,address:l});for(let[a,B]of Object.entries(x))o[a]=B;let b=p?ie.default.toBase58():d!=null?d:await oe(this.connection,this.blockhashCommitment),w=new Q({payerKey:this.feePayer,recentBlockhash:b,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((h=this.owner)==null?void 0:h.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new $(w);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var u;let{skipPreflight:B=!0,sendAndConfirm:T,notSendToRpc:C}=a||{};if(ee([P]),(u=this.owner)!=null&&u.isKeyPair){let i=await this.connection.sendTransaction(P,{skipPreflight:B});return T&&await Te(this.connection,i),{txId:i,signedTx:P}}if(this.signAllTransactions){let i=await this.signAllTransactions([P]);if(this.signers.length)for(let s of i)try{s.sign(this.signers)}catch{}return{txId:C?"":await this.connection.sendTransaction(i[0],{skipPreflight:B}),signedTx:i[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:g||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:p}=await this.buildV0(r),d=t.filter(x=>x.builder.instructions.length>0),g=[p,...d.map(x=>x.transaction)],o=[this.signers,...d.map(x=>x.signers)],A=[...this.instructionTypes,...d.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),g.forEach(async(x,b)=>{x.sign(o[b])}),{builder:this,transactions:g,signers:o,instructionTypes:A,buildProps:r,execute:async x=>{var h;let{sequentially:b,onTxUpdate:w,recentBlockHash:P,skipPreflight:c=!0}=x||{};if(P&&g.forEach(a=>a.message.recentBlockhash=P),ee(g),(h=this.owner)!=null&&h.isKeyPair){if(b){let a=[];for(let B of g){let T=await this.connection.sendTransaction(B,{skipPreflight:c});await Te(this.connection,T),a.push(T)}return{txIds:a,signedTxs:g}}return{txIds:await Promise.all(g.map(async a=>await this.connection.sendTransaction(a,{skipPreflight:c}))),signedTxs:g}}if(this.signAllTransactions){let a=await this.signAllTransactions(g);if(b){let B=0,T=[],C=async()=>{if(!a[B])return;let u=await this.connection.sendTransaction(a[B],{skipPreflight:c});T.push({txId:u,status:"sent",signedTx:a[B]}),w==null||w([...T]),B++;let i=!1,s=null,y=null,m=I=>{s!==null&&clearInterval(s),y!==null&&this.connection.removeSignatureListener(y);let N=T.findIndex(D=>D.txId===u);if(N>-1){if(T[N].status==="error"||T[N].status==="success")return;T[N].status=I.err?"error":"success"}w==null||w([...T]),I.err||C()};this.loopMultiTxStatus&&(s=setInterval(async()=>{var I;if(i){clearInterval(s);return}try{let N=await this.connection.getTransaction(u,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(i=!0,clearInterval(s),m({err:((I=N.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",u))}catch(N){i=!0,clearInterval(s),console.error("getTransaction timeout:",N,u)}},we)),y=this.connection.onSignature(u,I=>{if(i){this.connection.removeSignatureListener(y);return}i=!0,m(I)},"confirmed"),this.connection.getSignatureStatus(u)};return C(),{txIds:[],signedTxs:a}}else{let B=[];for(let T=0;T<a.length;T+=1){let C=await this.connection.sendTransaction(a[T],{skipPreflight:c});B.push(C)}return{txIds:B,signedTxs:a}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var w;let b=e||{},{splitIns:t=[],computeBudgetConfig:r}=b,p=me(b,["splitIns","computeBudgetConfig"]),d=r?be(r):{instructions:[],instructionTypes:[]},g=this.signers.reduce((P,c)=>H(F({},P),{[c.publicKey.toBase58()]:c}),{}),o=[],A=[],l=[],x=0;if(this.allInstructions.forEach(P=>{let c=[...l,P],h=r?[...d.instructions,...c]:c,B=[...new Set(c.map(T=>T.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat()).values()].map(T=>new ie(T));if(P!==t[x]&&l.length<12&&(xe({instructions:h,payer:this.feePayer,signers:B})||xe({instructions:c,payer:this.feePayer,signers:B})))l.push(P);else{if(l.length===0)throw Error("item ins too big");x+=P===t[x]?1:0,xe({instructions:r?[...d.instructions,...l]:[...l],payer:this.feePayer,signers:B})?o.push(new Pe().add(...d.instructions,...l)):o.push(new Pe().add(...l)),A.push(Array.from(new Set(l.map(T=>T.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(T=>g[T]).filter(T=>T!==void 0)),l=[P]}}),l.length>0){let c=[...new Set(l.map(h=>h.keys.filter(a=>a.isSigner).map(a=>a.pubkey.toString())).flat()).values()].map(h=>g[h]).filter(h=>h!==void 0);xe({instructions:r?[...d.instructions,...l]:[...l],payer:this.feePayer,signers:c.map(h=>h.publicKey)})?o.push(new Pe().add(...d.instructions,...l)):o.push(new Pe().add(...l)),A.push(c)}return o.forEach(P=>P.feePayer=this.feePayer),(w=this.owner)!=null&&w.signer&&A.forEach(P=>{P.some(c=>c.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:o,signers:A,instructionTypes:this.instructionTypes,execute:async P=>{var u;let{sequentially:c,onTxUpdate:h,skipTxCount:a=0,recentBlockHash:B,skipPreflight:T=!0}=P||{},C=B!=null?B:await oe(this.connection,this.blockhashCommitment);if(o.forEach(async(i,s)=>{i.recentBlockhash=C,A[s].length&&i.sign(...A[s])}),ee(o),(u=this.owner)!=null&&u.isKeyPair){if(c){let i=0,s=[];for(let y of o){if(++i,i<=a){s.push("tx skipped");continue}let m=await Ze(this.connection,y,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});s.push(m)}return{txIds:s,signedTxs:o}}return{txIds:await Promise.all(o.map(async i=>await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:T}))),signedTxs:o}}if(this.signAllTransactions){let i=await this.signAllTransactions(o.slice(a,o.length)),s=[...o.slice(0,a),...i];if(c){let y=0,m=[],I=async()=>{if(!s[y])return;y<a&&(m.push({txId:"",status:"success",signedTx:s[y]}),h==null||h([...m]),y++,I());let N=await this.connection.sendRawTransaction(s[y].serialize(),{skipPreflight:T});m.push({txId:N,status:"sent",signedTx:s[y]}),h==null||h([...m]),y++;let D=!1,S=null,k=null,L=V=>{S!==null&&clearInterval(S),k!==null&&this.connection.removeSignatureListener(k);let E=m.findIndex(U=>U.txId===N);if(E>-1){if(m[E].status==="error"||m[E].status==="success")return;m[E].status=V.err?"error":"success"}h==null||h([...m]),V.err||I()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var V;if(D){clearInterval(S);return}try{let E=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(D=!0,clearInterval(S),L({err:((V=E.meta)==null?void 0:V.err)||null}),console.log("tx status from getTransaction:",N))}catch(E){D=!0,clearInterval(S),console.error("getTransaction timeout:",E,N)}},we)),k=this.connection.onSignature(N,V=>{if(D){this.connection.removeSignatureListener(k);return}D=!0,L(V)},"confirmed"),this.connection.getSignatureStatus(N)};return await I(),{txIds:m.map(N=>N.txId),signedTxs:s}}else{let y=[];for(let m=0;m<s.length;m+=1){let I=await this.connection.sendRawTransaction(s[m].serialize(),{skipPreflight:T});y.push(I)}return{txIds:y,signedTxs:s}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:p||{}}}async sizeCheckBuildV0(e){var C;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:p={},lookupTableAddress:d=[]}=T,g=me(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=F(F({},this.cluster==="devnet"?await De(this.connection):te),p),A=Array.from(new Set([...this.lookupTableAddress,...d])),l=[];for(let u of A)o[u]===void 0&&l.push(new ie(u));let x=await _e({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?be(t):{instructions:[],instructionTypes:[]},w=await oe(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>H(F({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(X({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||X({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let m of[...new Set(A)])o[m]!==void 0&&(y[m]=o[m]);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}else{let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}h.push(Array.from(new Set(a.map(m=>m.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(m=>P[m]).filter(m=>m!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(C=this.owner)!=null&&C.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,blockHash:w,instructionTypes:this.instructionTypes,execute:async u=>{var N;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:m,skipPreflight:I=!0}=u||{};if(c.map(async(D,S)=>{h[S].length&&D.sign(h[S]),m&&(D.message.recentBlockhash=m)}),ee(c),(N=this.owner)!=null&&N.isKeyPair){if(i){let D=0,S=[];for(let k of c){if(++D,D<=y){console.log("skip tx: ",D),S.push("tx skipped");continue}let L=await this.connection.sendTransaction(k,{skipPreflight:I});await Te(this.connection,L),S.push(L)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(y,c.length)),S=[...c.slice(0,y),...D];if(i){let k=0,L=[],V=async()=>{if(!S[k])return;if(k<y){L.push({txId:"",status:"success",signedTx:S[k]}),s==null||s([...L]),k++,V();return}let E=await this.connection.sendTransaction(S[k],{skipPreflight:I});L.push({txId:E,status:"sent",signedTx:S[k]}),s==null||s([...L]),k++;let U=!1,q=null,z=null,le=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let K=L.findIndex(Oe=>Oe.txId===E);if(K>-1){if(L[K].status==="error"||L[K].status==="success")return;L[K].status=v.err?"error":"success"}s==null||s([...L]),v.err||V()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let K=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});K&&(U=!0,clearInterval(q),le({err:((v=K.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(K){U=!0,clearInterval(q),console.error("getTransaction timeout:",K,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,le(v)},"confirmed"),this.connection.getSignatureStatus(E)};return V(),{txIds:[],signedTxs:S}}else{let k=[];for(let L=0;L<S.length;L+=1){let V=await this.connection.sendTransaction(S[L],{skipPreflight:I});k.push(V)}return{txIds:k,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:g||{}}}async buildSniperTransaction(e){var C;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:p={},lookupTableAddress:d=[]}=T,g=me(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=F(F({},this.cluster==="devnet"?await De(this.connection):await Je(this.connection)),p),A=Array.from(new Set([...this.lookupTableAddress,...d])),l=[];for(let u of A)o[u]===void 0&&l.push(new ie(u));let x=await _e({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?be(t):{instructions:[],instructionTypes:[]},w=await oe(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>H(F({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(X({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||X({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let m of[...new Set(A)])o[m]!==void 0&&(y[m]=o[m]);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}else{let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}h.push(Array.from(new Set(a.map(m=>m.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(m=>P[m]).filter(m=>m!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&X({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(C=this.owner)!=null&&C.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,instructionTypes:this.instructionTypes,execute:async u=>{var N;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:m,skipPreflight:I=!0}=u||{};if(c.map(async(D,S)=>{h[S].length&&D.sign(h[S]),m&&(D.message.recentBlockhash=m)}),ee(c),(N=this.owner)!=null&&N.isKeyPair){if(i){let D=0,S=[];for(let k of c){if(++D,D<=y){console.log("skip tx: ",D),S.push("tx skipped");continue}let L=await this.connection.sendTransaction(k,{skipPreflight:I});await Te(this.connection,L),S.push(L)}return{txIds:S,signedTxs:c}}return{txIds:await Promise.all(c.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:I}))),signedTxs:c}}if(this.signAllTransactions){let D=await this.signAllTransactions(c.slice(y,c.length)),S=[...c.slice(0,y),...D];if(i){let k=0,L=[],V=async()=>{if(!S[k])return;if(k<y){L.push({txId:"",status:"success",signedTx:S[k]}),s==null||s([...L]),k++,V();return}let E=await this.connection.sendTransaction(S[k],{skipPreflight:I});L.push({txId:E,status:"sent",signedTx:S[k]}),s==null||s([...L]),k++;let U=!1,q=null,z=null,le=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let K=L.findIndex(Oe=>Oe.txId===E);if(K>-1){if(L[K].status==="error"||L[K].status==="success")return;L[K].status=v.err?"error":"success"}s==null||s([...L]),v.err||V()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let K=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});K&&(U=!0,clearInterval(q),le({err:((v=K.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(K){U=!0,clearInterval(q),console.error("getTransaction timeout:",K,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,le(v)},"confirmed"),this.connection.getSignatureStatus(E)};return V(),{txIds:[],signedTxs:S}}else{let k=[];for(let L=0;L<S.length;L+=1){let V=await this.connection.sendTransaction(S[L],{skipPreflight:I});k.push(V)}return{txIds:k,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:g||{}}}};import un from"bn.js";var Li=new un(1e6);var ln=W("Raydium_amount"),wt=ge(cn);function mn(n,e){let t="0",r="0";if(n.includes(".")){let p=n.split(".");p.length===2?([t,r]=p,r=r.padEnd(e,"0")):ln.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var J=class extends M{constructor(t,r,p=!0,d){let g=new Me(0),o=He.pow(new Me(t.decimals));if(p)g=G(r);else{let A=new Me(0),l=new Me(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[x,b]=mn(r.toString(),t.decimals);A=G(x),l=G(b)}A=A.mul(o),g=A.add(l)}super(g,o);this.logger=W(d||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new J(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new J(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,p=0){return super.toSignificant(t,r,p)}toFixed(t=this.token.decimals,r,p=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,p)}toExact(t={groupSeparator:""}){return wt.DP=this.token.decimals,new wt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function fn(n){return typeof n=="object"&&n!==null&&![re,J,pn,M,dn,Y,ae].some(e=>typeof e=="object"&&n instanceof e)}function Ne(n){return typeof n=="string"?Ve(n):Array.isArray(n)?n.map(e=>Ne(e)):fn(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,Ne(t)])):n}var Xe=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ae=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new Se({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let r=new j(e);return new Se({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:r,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Xe(e))}logInfo(...e){this.logger.info(Xe(e))}logAndCreateError(...e){let t=Xe(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as Tn,TransactionInstruction as kt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bt}from"@solana/spl-token";import{PublicKey as ka}from"@solana/web3.js";import La,{isBN as Ca}from"bn.js";import{bits as Is,BitStructure as ks,blob as Bs,Blob as Ls,cstr as Cs,f32 as Rs,f32be as _s,f64 as Ds,f64be as Ms,greedy as Ns,Layout as Es,ns64 as Os,ns64be as Fs,nu64 as gn,nu64be as Vs,offset as Ks,s16 as vs,s16be as Ws,s24 as Us,s24be as qs,s32 as Gs,s32be as Hs,s40 as js,s40be as zs,s48 as Ys,s48be as Js,s8 as Zs,seq as Xs,struct as Qs,Structure as hn,u16 as $s,u16be as ea,u24 as ta,u24be as na,u32 as ra,u32be as oa,u40 as ia,u40be as sa,u48 as aa,u48be as ua,u8 as ca,UInt as yn,union as la,Union as ma,unionLayoutDiscriminator as pa,utf8 as da}from"@solana/buffer-layout";var St=hn;var At=yn;var It=gn;function $e(n){return new At(1,n)}var Qe=class extends St{decode(e,t){return super.decode(e,t)}};function et(n,e,t){return new Qe(n,e,t)}var bn=et([$e("instruction"),It("amount")]),Ie=et([$e("instruction")]);function Ee({programId:n},e){let t=[{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},...Object.entries(e).map(([p,d])=>({pubkey:d,isSigner:p==="userOwner",isWritable:!["authority","userOwner"].includes(p)}))],r=Buffer.alloc(Ie.span);return Ie.encode({instruction:2},r),new kt({keys:t,programId:n,data:r})}function tt(n){let{poolConfig:e,userKeys:t,side:r}=n,p=r==="base"?t.baseTokenAccount:t.quoteTokenAccount,d=r==="base"?e.baseVault:e.quoteVault,g=Buffer.alloc(Ie.span);Ie.encode({instruction:2},g);let o=[{pubkey:Bt,isWritable:!1,isSigner:!1},{pubkey:Tn,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!1},{pubkey:p,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new kt({programId:e.programId,keys:o,data:g})}var xn={[pe.IDO_PROGRAM_ID_V1.toString()]:1,[pe.IDO_PROGRAM_ID_V2.toString()]:2,[pe.IDO_PROGRAM_ID_V3.toString()]:3,[pe.IDO_PROGRAM_ID_V4.toString()]:4},nt=class extends Ae{async claim({ownerInfo:e,idoKeys:t,associatedOnly:r=!0,checkCreateATAOwner:p=!1,txVersion:d,feePayer:g}){let o=this.createTxBuilder(g),A=xn[t.programId];A||this.logAndCreateError("invalid version",A);let l=Ne(t),[x,b]=[!new Lt(e.coin).isZero(),!new Lt(e.pc).isZero()],w=l.projectInfo.mint.address.equals(se),{account:P,instructionParams:c}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.projectInfo.mint.programId,mint:l.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:r,checkCreateATAOwner:p});!P&&x&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),x&&c&&o.addInstruction(c);let h=l.buyInfo.mint.address.equals(se),{account:a,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.buyInfo.mint.programId,mint:l.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:r,checkCreateATAOwner:p});if(!P&&b&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),b&&B&&o.addInstruction(B),(!P||!a)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),A===3)return o.addInstruction({instructions:[...x?[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolTokenAccount:l.projectInfo.vault,userTokenAccount:P,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...b?[Ee({programId:new ke(t.programId)},{idoId:l.id,authority:l.authority,poolTokenAccount:l.buyInfo.vault,userTokenAccount:a,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:d});if(A<3)return!x&&!b&&this.logAndCreateError("no claimable rewards"),o.addInstruction({instructions:[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolQuoteTokenAccount:l.buyInfo.vault,poolBaseTokenAccount:l.projectInfo.vault,userQuoteTokenAccount:a,userBaseTokenAccount:P,userIdoInfo:new ke(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:d});let T={poolConfig:{id:l.id,programId:l.programId,authority:l.authority,baseVault:l.projectInfo.vault,quoteVault:l.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:P,quoteTokenAccount:a,ledgerAccount:new ke(e.userIdoInfo),owner:this.scope.ownerPubKey}};return o.addInstruction({instructions:[...x?[tt(H(F({},T),{side:"base"}))]:[],...b?[tt(H(F({},T),{side:"quote"}))]:[]]}).versionBuild({txVersion:d})}};export{nt as default};
//# sourceMappingURL=ido.mjs.map