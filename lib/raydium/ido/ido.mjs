var Ct=Object.defineProperty,Rt=Object.defineProperties;var Dt=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var nt=(n,e,t)=>e in n?Ct(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,F=(n,e)=>{for(var t in e||(e={}))rt.call(e,t)&&nt(n,t,e[t]);if(Be)for(var t of Be(e))ot.call(e,t)&&nt(n,t,e[t]);return n},j=(n,e)=>Rt(n,Dt(e));var le=(n,e)=>{var t={};for(var r in n)rt.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Be)for(var r of Be(n))e.indexOf(r)<0&&ot.call(n,r)&&(t[r]=n[r]);return t};import{PublicKey as Ie}from"@solana/web3.js";import Lt from"bn.js";import{PublicKey as f}from"@solana/web3.js";var wn=new f("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),An=new f("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Sn=new f("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),kn=new f("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),In=new f("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Bn=new f("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ln=new f("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Cn=new f("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Rn=new f("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Dn=new f("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Mn=new f("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Nn=new f("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),_n=new f("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),En=new f("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),On=new f("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Fn=new f("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Mt=new f("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Nt=new f("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),_t=new f("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Et=new f("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Vn=new f("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Kn=new f("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),vn=new f("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Wn=new f("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Un=new f("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),qn=new f("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Gn=new f("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),jn=new f("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Hn=new f("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),zn=new f("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Zn=new f("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX"),me={IDO_PROGRAM_ID_V1:Mt,IDO_PROGRAM_ID_V2:Nt,IDO_PROGRAM_ID_V3:_t,IDO_PROGRAM_ID_V4:Et};var Jn={OPEN_BOOK_PROGRAM:new f("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new f("Ray1111111111111111111111111111111111111111"),AMM_V4:new f("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new f("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new f("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new f("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new f("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new f("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new f("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new f("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new f("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new f("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:f.default,Router:new f("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new f("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new f("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new f("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new f("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new f("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new f("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new f("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new f("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new f("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new f("Ray1111111111111111111111111111111111111111")};import{PublicKey as O,SystemProgram as it,SYSVAR_RENT_PUBKEY as Ot}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ft}from"@solana/spl-token";function Fe({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var er=[Fe({pubkey:Ft,isWritable:!1}),Fe({pubkey:it.programId,isWritable:!1}),Fe({pubkey:Ot,isWritable:!1})];function st({publicKey:n,transformSol:e}){let t=Ve(n.toString());if(t instanceof O)return e&&t.equals(pe)?ie:t;if(e&&t.toString()===pe.toBase58())return ie;if(typeof t=="string"){if(t===O.default.toBase58())return O.default;try{return new O(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ve(n){try{return new O(n)}catch{return n}}var tr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),nr=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Vt=new O("SysvarRent111111111111111111111111111111111"),at=new O("SysvarC1ock11111111111111111111111111111111"),rr=new O("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),or=new O("Sysvar1nstructions1111111111111111111111111"),Kt=it.programId,ir=new O("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),sr=new O("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ar=new O("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ur=new O("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),cr=new O("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),lr=new O("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),mr=new O("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),pr=new O("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),dr=new O("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),fr=new O("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),gr=new O("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ie=new O("So11111111111111111111111111111111111111112"),pe=O.default;import{PublicKey as pn}from"@solana/web3.js";import dn from"bn.js";import cn from"big.js";import Ne from"bn.js";import X from"bn.js";import io from"decimal.js";import{PublicKey as vt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ut}from"@solana/spl-token";var ct={chainId:101,address:vt.default.toBase58(),programId:ut.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},te={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ut.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ke}from"@solana/web3.js";var ve=class{constructor({mint:e,decimals:t,symbol:r,name:p,skipMint:d=!1,isToken2022:g=!1}){if(e===pe.toBase58()||e instanceof Ke&&pe.equals(e)){this.decimals=te.decimals,this.symbol=te.symbol,this.name=te.name,this.mint=new Ke(te.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=p||e.toString().substring(0,6),this.mint=d?Ke.default:st({publicKey:e}),this.isToken2022=g}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ne=ve;ne.WSOL=new ve(j(F({},te),{mint:te.address}));var We=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Le=We;Le.SOL=new We(ct);import Re from"big.js";import Ht from"bn.js";import zt from"decimal.js-light";import{get as lt,set as Wt}from"lodash";var Ue=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},mt={},Ut={};function W(n){let e=lt(mt,n);if(!e){let t=lt(Ut,n);e=new Ue({name:n,logLevel:t}),Wt(mt,n,e)}return e}import de from"bn.js";var pt=9007199254740991;function G(n){let e=W("Raydium_parseBigNumberish");if(n instanceof de)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new de(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=pt||n<=-pt)&&e.logWithError(`BigNumberish number overflow: ${n}`),new de(String(n))):typeof n=="bigint"?new de(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new de(0))}import qt from"toformat";var Gt=qt,fe=Gt;var Ce=W("module/fraction"),qe=fe(Re),ge=fe(zt),Zt={[0]:ge.ROUND_DOWN,[1]:ge.ROUND_HALF_UP,[2]:ge.ROUND_UP},Jt={[0]:Re.roundDown,[1]:Re.roundHalfUp,[2]:Re.roundUp},N=class{constructor(e,t=new Ht(1)){this.numerator=G(e),this.denominator=G(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(e){let t=e instanceof N?e:new N(G(e));return this.denominator.eq(t.denominator)?new N(this.numerator.add(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof N?e:new N(G(e));return this.denominator.eq(t.denominator)?new N(this.numerator.sub(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof N?e:new N(G(e));return new N(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof N?e:new N(G(e));return new N(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||Ce.logWithError(`${e} is not an integer.`),e<=0&&Ce.logWithError(`${e} is not positive.`),ge.set({precision:e+1,rounding:Zt[r]});let p=new ge(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return p.toFormat(p.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||Ce.logWithError(`${e} is not an integer.`),e<0&&Ce.logWithError(`${e} is negative.`),qe.DP=e,qe.RM=Jt[r]||1,new qe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import Xt from"bn.js";var dt=new N(new Xt(100)),se=class extends N{toSignificant(e=5,t,r){return this.mul(dt).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(dt).toFixed(e,t,r)}};var Yt=W("Raydium_price"),Z=class extends N{constructor(t){let{baseToken:r,quoteToken:p,numerator:d,denominator:g}=t;super(d,g);this.baseToken=r,this.quoteToken=p,this.scalar=new N(Ge(r.decimals),Ge(p.decimals))}get raw(){return new N(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Z({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Yt.logWithError("mul token not equals");let r=super.mul(t);return new Z({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,p){return this.adjusted.toSignificant(t,r,p)}toFixed(t=this.quoteToken.decimals,r,p){return this.adjusted.toFixed(t,r,p)}};var Qt=new X(0),ho=new X(1),yo=new X(2),bo=new X(3),To=new X(5),je=new X(10),xo=new X(100),Po=new X(1e3),wo=new X(1e4);function Ge(n){return je.pow(G(n))}import{PublicKey as $t}from"@solana/web3.js";import{MINT_SIZE as No,TOKEN_PROGRAM_ID as _o,getTransferFeeConfig as Eo,unpackMint as Oo}from"@solana/spl-token";var He=W("Raydium_accountInfo_util");async function gt(n,e,t){let{batchRequest:r,commitment:p="confirmed",chunkCount:d=100}=F({batchRequest:!1},t),g=ze(e,d),o=new Array(g.length).fill([]);if(r){let S=g.map(b=>{let w=n._buildArgs([b.map(P=>P.toBase58())],p,"base64");return{methodName:"getMultipleAccounts",args:w}}),l=ze(S,10);o=(await(await Promise.all(l.map(async b=>await n._rpcBatchRequest(b)))).flat()).map(b=>(b.error&&He.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${b.error.message}`),b.result.value.map(w=>{if(w){let{data:P,executable:c,lamports:h,owner:a,rentEpoch:B}=w;return P.length!==2&&P[1]!=="base64"&&He.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:c,lamports:h,owner:new $t(a),rentEpoch:B}}return null})))}else try{o=await Promise.all(g.map(S=>n.getMultipleAccountsInfo(S,p)))}catch(S){S instanceof Error&&He.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${S.message}`)}return o.flat()}function ze(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var H=class{constructor(e){this._owner=e}get publicKey(){return H.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return H.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return H.isKeyPair(this._owner)}get isPublicKey(){return H.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!H.isKeyPair(e)}};import{PublicKey as ti}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ri}from"@solana/spl-token";import{ComputeBudgetProgram as ht,Keypair as bt,PublicKey as Ho,Transaction as Tt,TransactionMessage as en,VersionedTransaction as xt}from"@solana/web3.js";var he={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as tn}from"@solana/spl-token";var yt=W("Raydium_txUtil"),Pt=1644;function ye(n){let e=[],t=[];return n.microLamports&&(e.push(ht.setComputeUnitPrice({microLamports:n.microLamports})),t.push(he.SetComputeUnitPrice)),n.units&&(e.push(ht.setComputeUnitLimit({units:n.units})),t.push(he.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function re(n,e){var r,p;let t=e!=null?e:"confirmed";return(p=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:p.blockhash}async function be(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let p=setTimeout(r,6e4);n.onSignature(e,d=>{if(clearTimeout(p),!d.err){t("");return}r(Object.assign(d.err,{txId:e}))},"confirmed")})}function nn(n,e){n.length<1&&yt.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&yt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Tt;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Pt}catch{return!1}}function Te({instructions:n,payer:e,signers:t}){return nn(n,[e,...t])}function Y({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=bt.generate().publicKey.toString()}){let d=new en({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new xt(d).serialize()).toString("base64").length<Pt}catch{return!1}}var rn=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),on=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof xt&&(e=rn(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ee(n){let e=[];return n.forEach(t=>{t instanceof Tt&&(t.recentBlockhash||(t.recentBlockhash=tn.toBase58()),t.feePayer||(t.feePayer=bt.generate().publicKey)),e.push(on(t))}),console.log("simulate tx string:",e),e}import ai from"bn.js";import{PublicKey as Ze,AddressLookupTableAccount as ue}from"@solana/web3.js";async function De({connection:n,address:e,cluster:t="mainnet"}){let r=await gt(n,[...new Set(e.map(d=>d.toString()))].map(d=>new Ze(d))),p={};for(let d=0;d<e.length;d++){let g=r[d],o=e[d];if(!g)continue;let S=new ue({key:o,state:ue.deserialize(g.data)});p[o.toString()]=S,t==="devnet"?ae[o.toString()]=S:xe[o.toString()]=S}return p}var xe={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ue({key:new Ze("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ue.deserialize(Buffer.from("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","base64"))})},ae={},Me=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ae[e])return ae;let t=new Ze(e),r=await n.getAccountInfo(t);return r&&(ae[e]=new ue({key:t,state:ue.deserialize(r.data)})),ae};import{PublicKey as oe,sendAndConfirmTransaction as Je,SystemProgram as sn,Transaction as Pe,TransactionMessage as Q,VersionedTransaction as $}from"@solana/web3.js";import an from"axios";var we=2e3,Ae=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await an.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=ye(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(sn.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new oe(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(he.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:p=[],endInstructionTypes:d=[],lookupTableAddress:g=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...p),this.endInstructionTypes.push(...d),this.lookupTableAddress.push(...g.filter(o=>o!==oe.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(F({},t||{})):this.build(t)}build(e){var r;let t=new Pe;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(p=>p.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async p=>{var x;let{recentBlockHash:d,skipPreflight:g=!0,sendAndConfirm:o,notSendToRpc:S}=p||{},l=d!=null?d:await re(this.connection,this.blockhashCommitment);if(t.recentBlockhash=l,this.signers.length&&t.sign(...this.signers),ee([t]),(x=this.owner)!=null&&x.isKeyPair)return{txId:o?await Je(this.connection,t,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:g}),signedTx:t};if(this.signAllTransactions){let b=await this.signAllTransactions([t]);if(this.signers.length)for(let w of b)try{w.sign(...this.signers)}catch{}return{txId:S?"":await this.connection.sendRawTransaction(b[0].serialize(),{skipPreflight:g}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var l;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:p}=this.build(r),d=t.filter(x=>x.transaction.instructions.length>0),g=[p,...d.map(x=>x.transaction)],o=[this.signers,...d.map(x=>x.signers)],S=[...this.instructionTypes,...d.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:g,signers:o,instructionTypes:S,execute:async x=>{var B;let{sequentially:b,onTxUpdate:w,skipTxCount:P=0,recentBlockHash:c,skipPreflight:h=!0}=x||{},a=c!=null?c:await re(this.connection,this.blockhashCommitment);if((B=this.owner)!=null&&B.isKeyPair){if(b){let T=[],C=0;for(let u of g){if(++C,C<=P)continue;let i=await Je(this.connection,u,this.signers.find(s=>s.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:h});T.push(i)}return{txIds:T,signedTxs:g}}return{txIds:await await Promise.all(g.map(async T=>(T.recentBlockhash=a,await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:h})))),signedTxs:g}}if(this.signAllTransactions){let T=g.map((u,i)=>(u.recentBlockhash=a,o[i].length&&u.sign(...o[i]),u));ee(T);let C=await this.signAllTransactions(T);if(b){let u=0,i=[],s=async()=>{if(!C[u])return;let y=await this.connection.sendRawTransaction(C[u].serialize(),{skipPreflight:h});i.push({txId:y,status:"sent",signedTx:C[u]}),w==null||w([...i]),u++;let m=!1,k=null,_=null,M=A=>{k!==null&&clearInterval(k),_!==null&&this.connection.removeSignatureListener(_);let I=i.findIndex(L=>L.txId===y);if(I>-1){if(i[I].status==="error"||i[I].status==="success")return;i[I].status=A.err?"error":"success"}w==null||w([...i]),A.err||s()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var A;if(m){clearInterval(k);return}try{let I=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});I&&(m=!0,clearInterval(k),M({err:((A=I.meta)==null?void 0:A.err)||null}),console.log("tx status from getTransaction:",y))}catch(I){m=!0,clearInterval(k),console.error("getTransaction timeout:",I,y)}},we)),_=this.connection.onSignature(y,A=>{if(m){this.connection.removeSignatureListener(_);return}m=!0,M(A)},"confirmed"),this.connection.getSignatureStatus(y)};return await s(),{txIds:i.map(y=>y.txId),signedTxs:C}}else{let u=[];for(let i=0;i<C.length;i+=1){let s=await this.connection.sendRawTransaction(C[i].serialize(),{skipPreflight:h});u.push(s)}return{txIds:u,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var h;let c=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:p,recentBlockhash:d}=c,g=le(c,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),o=F(F({},this.cluster==="devnet"?await Me(this.connection):xe),t),S=Array.from(new Set([...r,...this.lookupTableAddress])),l=[];for(let a of S)o[a]===void 0&&l.push(new oe(a));let x=await De({connection:this.connection,address:l});for(let[a,B]of Object.entries(x))o[a]=B;let b=p?oe.default.toBase58():d!=null?d:await re(this.connection,this.blockhashCommitment),w=new Q({payerKey:this.feePayer,recentBlockhash:b,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(o));((h=this.owner)==null?void 0:h.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new $(w);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var u;let{skipPreflight:B=!0,sendAndConfirm:T,notSendToRpc:C}=a||{};if(ee([P]),(u=this.owner)!=null&&u.isKeyPair){let i=await this.connection.sendTransaction(P,{skipPreflight:B});return T&&await be(this.connection,i),{txId:i,signedTx:P}}if(this.signAllTransactions){let i=await this.signAllTransactions([P]);if(this.signers.length)for(let s of i)try{s.sign(this.signers)}catch{}return{txId:C?"":await this.connection.sendTransaction(i[0],{skipPreflight:B}),signedTx:i[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:g||{}}}async buildV0MultiTx(e){var l;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:p}=await this.buildV0(r),d=t.filter(x=>x.builder.instructions.length>0),g=[p,...d.map(x=>x.transaction)],o=[this.signers,...d.map(x=>x.signers)],S=[...this.instructionTypes,...d.map(x=>x.instructionTypes).flat()];return(l=this.owner)!=null&&l.signer&&o.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),g.forEach(async(x,b)=>{x.sign(o[b])}),{builder:this,transactions:g,signers:o,instructionTypes:S,buildProps:r,execute:async x=>{var h;let{sequentially:b,onTxUpdate:w,recentBlockHash:P,skipPreflight:c=!0}=x||{};if(P&&g.forEach(a=>a.message.recentBlockhash=P),ee(g),(h=this.owner)!=null&&h.isKeyPair){if(b){let a=[];for(let B of g){let T=await this.connection.sendTransaction(B,{skipPreflight:c});await be(this.connection,T),a.push(T)}return{txIds:a,signedTxs:g}}return{txIds:await Promise.all(g.map(async a=>await this.connection.sendTransaction(a,{skipPreflight:c}))),signedTxs:g}}if(this.signAllTransactions){let a=await this.signAllTransactions(g);if(b){let B=0,T=[],C=async()=>{if(!a[B])return;let u=await this.connection.sendTransaction(a[B],{skipPreflight:c});T.push({txId:u,status:"sent",signedTx:a[B]}),w==null||w([...T]),B++;let i=!1,s=null,y=null,m=k=>{s!==null&&clearInterval(s),y!==null&&this.connection.removeSignatureListener(y);let _=T.findIndex(M=>M.txId===u);if(_>-1){if(T[_].status==="error"||T[_].status==="success")return;T[_].status=k.err?"error":"success"}w==null||w([...T]),k.err||C()};this.loopMultiTxStatus&&(s=setInterval(async()=>{var k;if(i){clearInterval(s);return}try{let _=await this.connection.getTransaction(u,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(i=!0,clearInterval(s),m({err:((k=_.meta)==null?void 0:k.err)||null}),console.log("tx status from getTransaction:",u))}catch(_){i=!0,clearInterval(s),console.error("getTransaction timeout:",_,u)}},we)),y=this.connection.onSignature(u,k=>{if(i){this.connection.removeSignatureListener(y);return}i=!0,m(k)},"confirmed"),this.connection.getSignatureStatus(u)};return C(),{txIds:[],signedTxs:a}}else{let B=[];for(let T=0;T<a.length;T+=1){let C=await this.connection.sendTransaction(a[T],{skipPreflight:c});B.push(C)}return{txIds:B,signedTxs:a}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var w;let b=e||{},{splitIns:t=[],computeBudgetConfig:r}=b,p=le(b,["splitIns","computeBudgetConfig"]),d=r?ye(r):{instructions:[],instructionTypes:[]},g=this.signers.reduce((P,c)=>j(F({},P),{[c.publicKey.toBase58()]:c}),{}),o=[],S=[],l=[],x=0;if(this.allInstructions.forEach(P=>{let c=[...l,P],h=r?[...d.instructions,...c]:c,B=[...new Set(c.map(T=>T.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat()).values()].map(T=>new oe(T));if(P!==t[x]&&l.length<12&&(Te({instructions:h,payer:this.feePayer,signers:B})||Te({instructions:c,payer:this.feePayer,signers:B})))l.push(P);else{if(l.length===0)throw Error("item ins too big");x+=P===t[x]?1:0,Te({instructions:r?[...d.instructions,...l]:[...l],payer:this.feePayer,signers:B})?o.push(new Pe().add(...d.instructions,...l)):o.push(new Pe().add(...l)),S.push(Array.from(new Set(l.map(T=>T.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(T=>g[T]).filter(T=>T!==void 0)),l=[P]}}),l.length>0){let c=[...new Set(l.map(h=>h.keys.filter(a=>a.isSigner).map(a=>a.pubkey.toString())).flat()).values()].map(h=>g[h]).filter(h=>h!==void 0);Te({instructions:r?[...d.instructions,...l]:[...l],payer:this.feePayer,signers:c.map(h=>h.publicKey)})?o.push(new Pe().add(...d.instructions,...l)):o.push(new Pe().add(...l)),S.push(c)}return o.forEach(P=>P.feePayer=this.feePayer),(w=this.owner)!=null&&w.signer&&S.forEach(P=>{P.some(c=>c.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:o,signers:S,instructionTypes:this.instructionTypes,execute:async P=>{var u;let{sequentially:c,onTxUpdate:h,skipTxCount:a=0,recentBlockHash:B,skipPreflight:T=!0}=P||{},C=B!=null?B:await re(this.connection,this.blockhashCommitment);if(o.forEach(async(i,s)=>{i.recentBlockhash=C,S[s].length&&i.sign(...S[s])}),ee(o),(u=this.owner)!=null&&u.isKeyPair){if(c){let i=0,s=[];for(let y of o){if(++i,i<=a){s.push("tx skipped");continue}let m=await Je(this.connection,y,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:T});s.push(m)}return{txIds:s,signedTxs:o}}return{txIds:await Promise.all(o.map(async i=>await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:T}))),signedTxs:o}}if(this.signAllTransactions){let i=await this.signAllTransactions(o.slice(a,o.length)),s=[...o.slice(0,a),...i];if(c){let y=0,m=[],k=async()=>{if(!s[y])return;y<a&&(m.push({txId:"",status:"success",signedTx:s[y]}),h==null||h([...m]),y++,k());let _=await this.connection.sendRawTransaction(s[y].serialize(),{skipPreflight:T});m.push({txId:_,status:"sent",signedTx:s[y]}),h==null||h([...m]),y++;let M=!1,A=null,I=null,L=V=>{A!==null&&clearInterval(A),I!==null&&this.connection.removeSignatureListener(I);let E=m.findIndex(U=>U.txId===_);if(E>-1){if(m[E].status==="error"||m[E].status==="success")return;m[E].status=V.err?"error":"success"}h==null||h([...m]),V.err||k()};this.loopMultiTxStatus&&(A=setInterval(async()=>{var V;if(M){clearInterval(A);return}try{let E=await this.connection.getTransaction(_,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(M=!0,clearInterval(A),L({err:((V=E.meta)==null?void 0:V.err)||null}),console.log("tx status from getTransaction:",_))}catch(E){M=!0,clearInterval(A),console.error("getTransaction timeout:",E,_)}},we)),I=this.connection.onSignature(_,V=>{if(M){this.connection.removeSignatureListener(I);return}M=!0,L(V)},"confirmed"),this.connection.getSignatureStatus(_)};return await k(),{txIds:m.map(_=>_.txId),signedTxs:s}}else{let y=[];for(let m=0;m<s.length;m+=1){let k=await this.connection.sendRawTransaction(s[m].serialize(),{skipPreflight:T});y.push(k)}return{txIds:y,signedTxs:s}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:p||{}}}async sizeCheckBuildV0(e){var C;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:p={},lookupTableAddress:d=[]}=T,g=le(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=F(F({},this.cluster==="devnet"?await Me(this.connection):xe),p),S=Array.from(new Set([...this.lookupTableAddress,...d])),l=[];for(let u of S)o[u]===void 0&&l.push(new oe(u));let x=await De({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?ye(t):{instructions:[],instructionTypes:[]},w=await re(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>j(F({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(Y({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||Y({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let m of[...new Set(S)])o[m]!==void 0&&(y[m]=o[m]);if(t&&Y({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}else{let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}h.push(Array.from(new Set(a.map(m=>m.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(m=>P[m]).filter(m=>m!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&Y({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(C=this.owner)!=null&&C.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,blockHash:w,instructionTypes:this.instructionTypes,execute:async u=>{var _;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:m,skipPreflight:k=!0}=u||{};if(c.map(async(M,A)=>{h[A].length&&M.sign(h[A]),m&&(M.message.recentBlockhash=m)}),ee(c),(_=this.owner)!=null&&_.isKeyPair){if(i){let M=0,A=[];for(let I of c){if(++M,M<=y){console.log("skip tx: ",M),A.push("tx skipped");continue}let L=await this.connection.sendTransaction(I,{skipPreflight:k});await be(this.connection,L),A.push(L)}return{txIds:A,signedTxs:c}}return{txIds:await Promise.all(c.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:k}))),signedTxs:c}}if(this.signAllTransactions){let M=await this.signAllTransactions(c.slice(y,c.length)),A=[...c.slice(0,y),...M];if(i){let I=0,L=[],V=async()=>{if(!A[I])return;if(I<y){L.push({txId:"",status:"success",signedTx:A[I]}),s==null||s([...L]),I++,V();return}let E=await this.connection.sendTransaction(A[I],{skipPreflight:k});L.push({txId:E,status:"sent",signedTx:A[I]}),s==null||s([...L]),I++;let U=!1,q=null,z=null,ce=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let K=L.findIndex(Oe=>Oe.txId===E);if(K>-1){if(L[K].status==="error"||L[K].status==="success")return;L[K].status=v.err?"error":"success"}s==null||s([...L]),v.err||V()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let K=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});K&&(U=!0,clearInterval(q),ce({err:((v=K.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(K){U=!0,clearInterval(q),console.error("getTransaction timeout:",K,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,ce(v)},"confirmed"),this.connection.getSignatureStatus(E)};return V(),{txIds:[],signedTxs:A}}else{let I=[];for(let L=0;L<A.length;L+=1){let V=await this.connection.sendTransaction(A[L],{skipPreflight:k});I.push(V)}return{txIds:I,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:g||{}}}async buildSniperTransaction(e){var C;let T=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:p={},lookupTableAddress:d=[]}=T,g=le(T,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),o=F(F({},this.cluster==="devnet"?await Me(this.connection):xe),p),S=Array.from(new Set([...this.lookupTableAddress,...d])),l=[];for(let u of S)o[u]===void 0&&l.push(new oe(u));let x=await De({connection:this.connection,address:l});for(let[u,i]of Object.entries(x))o[u]=i;let b=t?ye(t):{instructions:[],instructionTypes:[]},w=await re(this.connection,this.blockhashCommitment),P=this.signers.reduce((u,i)=>j(F({},u),{[i.publicKey.toBase58()]:i}),{}),c=[],h=[],a=[],B=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],s=t?[...b.instructions,...i]:i;if(u!==r[B]&&a.length<12&&(Y({instructions:s,payer:this.feePayer,lookupTableAddressAccount:o})||Y({instructions:i,payer:this.feePayer,lookupTableAddressAccount:o})))a.push(u);else{if(a.length===0)throw Error("item ins too big");B+=u===r[B]?1:0;let y={};for(let m of[...new Set(S)])o[m]!==void 0&&(y[m]=o[m]);if(t&&Y({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}else{let m=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(m))}h.push(Array.from(new Set(a.map(m=>m.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(m=>P[m]).filter(m=>m!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(s=>s.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(s=>P[s]).filter(s=>s!==void 0);if(t&&Y({instructions:[...b.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:o,recentBlockhash:w})){let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...b.instructions,...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}else{let s=new Q({payerKey:this.feePayer,recentBlockhash:w,instructions:[...a]}).compileToV0Message(Object.values(o));c.push(new $(s))}h.push(i)}return(C=this.owner)!=null&&C.signer&&h.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),c.forEach((u,i)=>{u.sign(h[i])}),{builder:this,transactions:c,buildProps:e,signers:h,instructionTypes:this.instructionTypes,execute:async u=>{var _;let{sequentially:i,onTxUpdate:s,skipTxCount:y=0,recentBlockHash:m,skipPreflight:k=!0}=u||{};if(c.map(async(M,A)=>{h[A].length&&M.sign(h[A]),m&&(M.message.recentBlockhash=m)}),ee(c),(_=this.owner)!=null&&_.isKeyPair){if(i){let M=0,A=[];for(let I of c){if(++M,M<=y){console.log("skip tx: ",M),A.push("tx skipped");continue}let L=await this.connection.sendTransaction(I,{skipPreflight:k});await be(this.connection,L),A.push(L)}return{txIds:A,signedTxs:c}}return{txIds:await Promise.all(c.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:k}))),signedTxs:c}}if(this.signAllTransactions){let M=await this.signAllTransactions(c.slice(y,c.length)),A=[...c.slice(0,y),...M];if(i){let I=0,L=[],V=async()=>{if(!A[I])return;if(I<y){L.push({txId:"",status:"success",signedTx:A[I]}),s==null||s([...L]),I++,V();return}let E=await this.connection.sendTransaction(A[I],{skipPreflight:k});L.push({txId:E,status:"sent",signedTx:A[I]}),s==null||s([...L]),I++;let U=!1,q=null,z=null,ce=v=>{q!==null&&clearInterval(q),z!==null&&this.connection.removeSignatureListener(z);let K=L.findIndex(Oe=>Oe.txId===E);if(K>-1){if(L[K].status==="error"||L[K].status==="success")return;L[K].status=v.err?"error":"success"}s==null||s([...L]),v.err||V()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var v;if(U){clearInterval(q);return}try{let K=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});K&&(U=!0,clearInterval(q),ce({err:((v=K.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",E))}catch(K){U=!0,clearInterval(q),console.error("getTransaction timeout:",K,E)}},we)),z=this.connection.onSignature(E,v=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,ce(v)},"confirmed"),this.connection.getSignatureStatus(E)};return V(),{txIds:[],signedTxs:A}}else{let I=[];for(let L=0;L<A.length;L+=1){let V=await this.connection.sendTransaction(A[L],{skipPreflight:k});I.push(V)}return{txIds:I,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:g||{}}}};import un from"bn.js";var Bi=new un(1e6);var ln=W("Raydium_amount"),wt=fe(cn);function mn(n,e){let t="0",r="0";if(n.includes(".")){let p=n.split(".");p.length===2?([t,r]=p,r=r.padEnd(e,"0")):ln.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var J=class extends N{constructor(t,r,p=!0,d){let g=new Ne(0),o=je.pow(new Ne(t.decimals));if(p)g=G(r);else{let S=new Ne(0),l=new Ne(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[x,b]=mn(r.toString(),t.decimals);S=G(x),l=G(b)}S=S.mul(o),g=S.add(l)}super(g,o);this.logger=W(d||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new J(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new J(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,p=0){return super.toSignificant(t,r,p)}toFixed(t=this.token.decimals,r,p=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,p)}toExact(t={groupSeparator:""}){return wt.DP=this.token.decimals,new wt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function ft(n){return typeof n=="object"&&n!==null&&![ne,J,pn,N,dn,Z,se].some(e=>typeof e=="object"&&n instanceof e)}function _e(n){return typeof n=="string"?Ve(n):Array.isArray(n)?n.map(e=>_e(e)):ft(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,_e(t)])):n}var Xe=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Se=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=W(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ae({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let r=new H(e);return new Ae({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:r,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Xe(e))}logInfo(...e){this.logger.info(Xe(e))}logAndCreateError(...e){let t=Xe(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as bn,TransactionInstruction as It}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bt}from"@solana/spl-token";import{PublicKey as ka}from"@solana/web3.js";import Ba,{isBN as La}from"bn.js";import{bits as Ss,BitStructure as ks,blob as Is,Blob as Bs,cstr as Ls,f32 as Cs,f32be as Rs,f64 as Ds,f64be as Ms,greedy as Ns,Layout as _s,ns64 as Es,ns64be as Os,nu64 as fn,nu64be as Fs,offset as Vs,s16 as Ks,s16be as vs,s24 as Ws,s24be as Us,s32 as qs,s32be as Gs,s40 as js,s40be as Hs,s48 as zs,s48be as Zs,s8 as Js,seq as Xs,struct as Ys,Structure as gn,u16 as Qs,u16be as $s,u24 as ea,u24be as ta,u32 as na,u32be as ra,u40 as oa,u40be as ia,u48 as sa,u48be as aa,u8 as ua,UInt as hn,union as ca,Union as la,unionLayoutDiscriminator as ma,utf8 as pa}from"@solana/buffer-layout";var At=gn;var St=hn;var kt=fn;function Qe(n){return new St(1,n)}var Ye=class extends At{decode(e,t){return super.decode(e,t)}};function $e(n,e,t){return new Ye(n,e,t)}var yn=$e([Qe("instruction"),kt("amount")]),ke=$e([Qe("instruction")]);function Ee({programId:n},e){let t=[{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},...Object.entries(e).map(([p,d])=>({pubkey:d,isSigner:p==="userOwner",isWritable:!["authority","userOwner"].includes(p)}))],r=Buffer.alloc(ke.span);return ke.encode({instruction:2},r),new It({keys:t,programId:n,data:r})}function et(n){let{poolConfig:e,userKeys:t,side:r}=n,p=r==="base"?t.baseTokenAccount:t.quoteTokenAccount,d=r==="base"?e.baseVault:e.quoteVault,g=Buffer.alloc(ke.span);ke.encode({instruction:2},g);let o=[{pubkey:Bt,isWritable:!1,isSigner:!1},{pubkey:bn,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!1},{pubkey:p,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new It({programId:e.programId,keys:o,data:g})}var Tn={[me.IDO_PROGRAM_ID_V1.toString()]:1,[me.IDO_PROGRAM_ID_V2.toString()]:2,[me.IDO_PROGRAM_ID_V3.toString()]:3,[me.IDO_PROGRAM_ID_V4.toString()]:4},tt=class extends Se{async claim({ownerInfo:e,idoKeys:t,associatedOnly:r=!0,checkCreateATAOwner:p=!1,txVersion:d,feePayer:g}){let o=this.createTxBuilder(g),S=Tn[t.programId];S||this.logAndCreateError("invalid version",S);let l=_e(t),[x,b]=[!new Lt(e.coin).isZero(),!new Lt(e.pc).isZero()],w=l.projectInfo.mint.address.equals(ie),{account:P,instructionParams:c}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.projectInfo.mint.programId,mint:l.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:r,checkCreateATAOwner:p});!P&&x&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),x&&c&&o.addInstruction(c);let h=l.buyInfo.mint.address.equals(ie),{account:a,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.buyInfo.mint.programId,mint:l.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:r,checkCreateATAOwner:p});if(!P&&b&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),b&&B&&o.addInstruction(B),(!P||!a)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),S===3)return o.addInstruction({instructions:[...x?[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolTokenAccount:l.projectInfo.vault,userTokenAccount:P,userIdoInfo:new Ie(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...b?[Ee({programId:new Ie(t.programId)},{idoId:l.id,authority:l.authority,poolTokenAccount:l.buyInfo.vault,userTokenAccount:a,userIdoInfo:new Ie(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:d});if(S<3)return!x&&!b&&this.logAndCreateError("no claimable rewards"),o.addInstruction({instructions:[Ee({programId:l.programId},{idoId:l.id,authority:l.authority,poolQuoteTokenAccount:l.buyInfo.vault,poolBaseTokenAccount:l.projectInfo.vault,userQuoteTokenAccount:a,userBaseTokenAccount:P,userIdoInfo:new Ie(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:d});let T={poolConfig:{id:l.id,programId:l.programId,authority:l.authority,baseVault:l.projectInfo.vault,quoteVault:l.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:P,quoteTokenAccount:a,ledgerAccount:new Ie(e.userIdoInfo),owner:this.scope.ownerPubKey}};return o.addInstruction({instructions:[...x?[et(j(F({},T),{side:"base"}))]:[],...b?[et(j(F({},T),{side:"quote"}))]:[]]}).versionBuild({txVersion:d})}};export{tt as default};
//# sourceMappingURL=ido.mjs.map