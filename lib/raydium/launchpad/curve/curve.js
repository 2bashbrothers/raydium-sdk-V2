var Jt=Object.create;var se=Object.defineProperty,$t=Object.defineProperties,en=Object.getOwnPropertyDescriptor,tn=Object.getOwnPropertyDescriptors,nn=Object.getOwnPropertyNames,ut=Object.getOwnPropertySymbols,rn=Object.getPrototypeOf,mt=Object.prototype.hasOwnProperty,on=Object.prototype.propertyIsEnumerable;var lt=(r,e,t)=>e in r?se(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,C=(r,e)=>{for(var t in e||(e={}))mt.call(e,t)&&lt(r,t,e[t]);if(ut)for(var t of ut(e))on.call(e,t)&&lt(r,t,e[t]);return r},M=(r,e)=>$t(r,tn(e));var sn=(r,e)=>{for(var t in e)se(r,t,{get:e[t],enumerable:!0})},dt=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of nn(e))!mt.call(r,i)&&i!==t&&se(r,i,{get:()=>e[i],enumerable:!(n=en(e,i))||n.enumerable});return r};var m=(r,e,t)=>(t=r!=null?Jt(rn(r)):{},dt(e||!r||!r.__esModule?se(t,"default",{value:r,enumerable:!0}):t,r)),an=r=>dt(se({},"__esModule",{value:!0}),r);var pi={};sn(pi,{Curve:()=>we});module.exports=an(pi);var R=m(require("bn.js")),at=m(require("decimal.js"));var un=require("@solana/web3.js");var ae=require("lodash");var Oe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},pt={},cn={};function x(r){let e=(0,ae.get)(pt,r);if(!e){let t=(0,ae.get)(cn,r);e=new Oe({name:r,logLevel:t}),(0,ae.set)(pt,r,e)}return e}var Te=require("@solana/spl-token"),Ti=x("Raydium_accountInfo_util");var v=m(require("bn.js")),wn=m(require("decimal.js"));var At=m(require("big.js")),fn=m(require("bn.js"));var yt=m(require("toformat")),ln=yt.default,ce=ln;var ue=m(require("big.js")),gt=m(require("bn.js")),Pt=m(require("decimal.js-light"));var Q=m(require("bn.js"));var bt=9007199254740991;function _(r){let e=x("Raydium_parseBigNumberish");if(r instanceof Q.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Q.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=bt||r<=-bt)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Q.default(String(r))):typeof r=="bigint"?new Q.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Q.default(0))}var Be=x("module/fraction"),Ee=ce(ue.default),le=ce(Pt.default),dn={[0]:le.ROUND_DOWN,[1]:le.ROUND_HALF_UP,[2]:le.ROUND_UP},pn={[0]:ue.default.roundDown,[1]:ue.default.roundHalfUp,[2]:ue.default.roundUp},g=class{constructor(e,t=new gt.default(1)){this.numerator=_(e),this.denominator=_(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new g(this.denominator,this.numerator)}add(e){let t=e instanceof g?e:new g(_(e));return this.denominator.eq(t.denominator)?new g(this.numerator.add(t.numerator),this.denominator):new g(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof g?e:new g(_(e));return this.denominator.eq(t.denominator)?new g(this.numerator.sub(t.numerator),this.denominator):new g(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof g?e:new g(_(e));return new g(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof g?e:new g(_(e));return new g(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Be.logWithError(`${e} is not an integer.`),e<=0&&Be.logWithError(`${e} is not positive.`),le.set({precision:e+1,rounding:dn[n]});let i=new le(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Be.logWithError(`${e} is not an integer.`),e<0&&Be.logWithError(`${e} is negative.`),Ee.DP=e,Ee.RM=pn[n]||1,new Ee(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Vi=x("Raydium_amount"),Wi=ce(At.default);var wt=require("@solana/web3.js"),ve=require("@solana/spl-token"),De={chainId:101,address:wt.PublicKey.default.toBase58(),programId:ve.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},G={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ve.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var he=require("@solana/web3.js");var y=require("@solana/web3.js"),Tt=require("@solana/spl-token");function _e({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Xi=[_e({pubkey:Tt.TOKEN_PROGRAM_ID,isWritable:!1}),_e({pubkey:y.SystemProgram.programId,isWritable:!1}),_e({pubkey:y.SYSVAR_RENT_PUBKEY,isWritable:!1})];function kt({publicKey:r,transformSol:e}){let t=Bt(r.toString());if(t instanceof y.PublicKey)return e&&t.equals(me)?ke:t;if(e&&t.toString()===me.toBase58())return ke;if(typeof t=="string"){if(t===y.PublicKey.default.toBase58())return y.PublicKey.default;try{return new y.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Bt(r){try{return new y.PublicKey(r)}catch{return r}}var bn=new y.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),gn=new y.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Pn=new y.PublicKey("SysvarRent111111111111111111111111111111111"),Hi=new y.PublicKey("SysvarC1ock11111111111111111111111111111111"),ht=new y.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),zi=new y.PublicKey("Sysvar1nstructions1111111111111111111111111"),Yi=y.SystemProgram.programId,ji=new y.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Zi=new y.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Qi=new y.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ji=new y.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),$i=new y.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),er=new y.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),tr=new y.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),nr=new y.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ir=new y.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),rr=new y.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),or=new y.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ke=new y.PublicKey("So11111111111111111111111111111111111111112"),me=y.PublicKey.default;var Ve=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===me.toBase58()||e instanceof he.PublicKey&&me.equals(e)){this.decimals=G.decimals,this.symbol=G.symbol,this.name=G.name,this.mint=new he.PublicKey(G.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?he.PublicKey.default:kt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},U=Ve;U.WSOL=new Ve(M(C({},G),{mint:G.address}));var We=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},xe=We;xe.SOL=new We(De);var xt=m(require("bn.js"));var yr=new g(new xt.default(100));var Tr=x("Raydium_price");var An=new v.default(0),zr=new v.default(1),Yr=new v.default(2),jr=new v.default(3),Zr=new v.default(5),yn=new v.default(10),Qr=new v.default(100),Jr=new v.default(1e3),$r=new v.default(1e4);function It(r,e,t){return r.mul(e).add(t).sub(new v.default(1)).div(t)}var Bn=require("@solana/web3.js"),hn=require("@solana/spl-token");var J=require("@solana/web3.js");var Tn=require("@solana/spl-token"),po=x("Raydium_txUtil");var a=require("@solana/web3.js"),go=new a.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Po=new a.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ao=new a.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),wo=new a.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),To=new a.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ko=new a.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Bo=new a.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ho=new a.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),xo=new a.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Io=new a.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),xn=new a.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),In=new a.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Sn=new a.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),So=new a.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Co=new a.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ko=new a.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),No=new a.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ro=new a.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Lo=new a.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Fo=new a.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Mo=new a.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Oo=new a.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Eo=new a.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),vo=new a.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Do=new a.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),_o=new a.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Vo=new a.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Wo=new a.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),qo=new a.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Go=new a.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Uo=new a.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Xo={OPEN_BOOK_PROGRAM:new a.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new a.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new a.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new a.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new a.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new a.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new a.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new a.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new a.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new a.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new a.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new a.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:a.PublicKey.default,Router:new a.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new a.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new a.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new a.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new a.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new a.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new a.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new a.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new a.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new a.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new a.PublicKey("Ray1111111111111111111111111111111111111111")};var B=m(require("bn.js")),de=1e4;function Xe(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new B.default(0))?t.add(new B.default(1)):t}function Y(r,e){if(r.isZero())return new B.default(0);let t=r.div(e);return t.isZero()?new B.default(1):r.mod(e).gt(new B.default(0))?t.add(new B.default(1)):t}function He(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new B.default(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,l=Xe(r.mul(new B.default(i.transferFeeBasisPoints)),new B.default(de)),P=l.gt(o)?o:l;return{amount:r,fee:P,expirationTime:s}}function ze(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new B.default(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===de){let l=new B.default(i.maximumFee.toString());return{amount:r.add(l),fee:l,expirationTime:s}}else{let l=Xe(r.mul(new B.default(de)),new B.default(de-i.transferFeeBasisPoints)),P=new B.default(i.maximumFee.toString()),f=l.sub(r).gt(P)?r.add(P):l,A=Xe(f.mul(new B.default(i.transferFeeBasisPoints)),new B.default(de)),p=A.gt(o)?o:A;return{amount:f,fee:p,expirationTime:s}}}var Ct=require("@solana/web3.js");var $=require("@solana/web3.js"),Nn=m(require("axios"));var Rn=require("@solana/web3.js"),Ln=m(require("bn.js"));var Kt=m(require("bn.js")),j=new Kt.default(1e6);var pe=m(require("bn.js")),ee=m(require("decimal.js"));var X=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Se=class extends X{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new ee.default(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new ee.default(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new ee.default(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new ee.default(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new ee.default(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new pe.default(0)))throw Error("supplyMinusSellLocked <= 0");let l=t.sub(o);if(l.lte(new pe.default(0)))throw Error("tfMinusMf <= 0");let P=l.mul(n).mul(n).div(s),f=l.mul(n).div(s).sub(t),A=P.div(f),p=t.mul(t).div(f);if(A.lt(new pe.default(0))||p.lt(new pe.default(0)))throw Error("invalid input 0");return{a:A,b:p,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),o=t.add(e);return i.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),o=n.sub(e);return Y(i,o)}};var fe=m(require("bn.js")),te=m(require("decimal.js"));var Ce=class extends X{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new te.default(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new te.default(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new te.default(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new te.default(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new te.default(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new fe.default(0)))throw Error("invalid input 1");let l=new fe.default(2).mul(t).sub(o),f=t.mul(s).div(l);if(f.lt(new fe.default(0))||t.lt(new fe.default(0)))throw Error("invalid input 0");return{a:f,b:t,c:f}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return Y(i,n)}};var S=m(require("bn.js")),H=m(require("decimal.js"));var li=require("@solana/web3.js"),mi=m(require("bn.js")),di=m(require("decimal.js"));var Le=require("@solana/spl-token");var Fn=require("@solana/web3.js"),Nt=require("@solana/spl-token");var Re=require("@solana/web3.js"),ui=m(require("bn.js"));var ot=require("@solana/spl-token");var Mt=require("@solana/web3.js"),ne=m(require("bn.js"));var c=require("@solana/buffer-layout"),Ye=c.Layout,Rt=c.Structure;var je=c.UInt;var Lt=c.u8,ye=c.u16;var q=c.s32;var Ft=c.seq;var K=c.blob;var ie=class extends Ye{constructor(t,n,i){super(t,i);this.blob=K(t),this.signed=n}decode(t,n=0){let i=new ne.default(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new ne.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function I(r){return new je(1,r)}function re(r){return new je(4,r)}function d(r){return new ie(8,!1,r)}function w(r){return new ie(16,!1,r)}function Ot(r){return new ie(8,!0,r)}function Et(r){return new ie(16,!0,r)}var Ke=class extends Ye{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function b(r){return new Ke(K(32),e=>new Mt.PublicKey(e),e=>e.toBuffer(),r)}function Qe(r){return new Ke(Lt(),Mn,On,r)}function Mn(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function On(r){return r?1:0}var Ze=class extends Rt{decode(e,t){return super.decode(e,t)}};function h(r,e,t){return new Ze(r,e,t)}function T(r,e,t){let n,i=typeof e=="number"?e:(0,ne.isBN)(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let l=Reflect.get(o,"count");n=(0,ne.isBN)(l)?l.toNumber():l,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,l){return s==="count"&&(n=l),Reflect.set(o,s,l)}});return Ft(r,i,t)}var Zn=m(require("bn.js")),Qn=m(require("decimal.js"));var N=m(require("bn.js")),Je=new N.default(0),vt=new N.default(1),Dt=new N.default(-1),V=new N.default(1).shln(64),_t=new N.default(1).shln(128),$e=V.sub(vt);var En=_t.subn(1),oe=-443636,be=-oe,et=new N.default("4295048016"),tt=new N.default("79226673521066979257578248091"),wa=new N.default("4295048017"),Ta=new N.default("79226673521066979257578248090");var vn=new N.default(10).pow(new N.default(6));var ka=new N.default("18446744073700000000");var Yn=m(require("bn.js")),jn=m(require("decimal.js"));var Ka=Buffer.from("amm_config","utf8"),Na=Buffer.from("pool","utf8"),Ra=Buffer.from("pool_vault","utf8"),La=Buffer.from("pool_reward_vault","utf8"),Fa=Buffer.from("position","utf8"),Ma=Buffer.from("tick_array","utf8"),Oa=Buffer.from("operation","utf8"),Ea=Buffer.from("pool_tick_array_bitmap_extension","utf8"),va=Buffer.from("observation","utf8");var Da=Buffer.from("locked_position","utf8");var _a=Buffer.from("support_mint","utf8");var Gn=require("@solana/web3.js"),Un=require("@solana/spl-token"),Xn=m(require("bn.js")),Hn=m(require("decimal.js"));var Dn=m(require("bn.js")),_n=m(require("decimal.js"));var rt=14;var Ne=60;var Jn=h([K(8),I("bump"),ye("index"),b(""),re("protocolFeeRate"),re("tradeFeeRate"),ye("tickSpacing"),T(d(),8,"")]),$n=h([re("blockTimestamp"),Ot("tickCumulative"),T(d(),4)]),jt=h([K(8),Qe("initialized"),d("recentEpoch"),ye("observationIndex"),b("poolId"),T($n,100,"observations"),T(d(),4)]),ei=h([I("rewardState"),d("openTime"),d("endTime"),d("lastUpdateTime"),w("emissionsPerSecondX64"),d("rewardTotalEmissioned"),d("rewardClaimed"),b("tokenMint"),b("tokenVault"),b("creator"),w("rewardGrowthGlobalX64")]),Ht=h([K(8),I("bump"),b("ammConfig"),b("creator"),b("mintA"),b("mintB"),b("vaultA"),b("vaultB"),b("observationId"),I("mintDecimalsA"),I("mintDecimalsB"),ye("tickSpacing"),w("liquidity"),w("sqrtPriceX64"),q("tickCurrent"),re(),w("feeGrowthGlobalX64A"),w("feeGrowthGlobalX64B"),d("protocolFeesTokenA"),d("protocolFeesTokenB"),w("swapInAmountTokenA"),w("swapOutAmountTokenB"),w("swapInAmountTokenB"),w("swapOutAmountTokenA"),I("status"),T(I(),7,""),T(ei,3,"rewardInfos"),T(d(),16,"tickArrayBitmap"),d("totalFeesTokenA"),d("totalFeesClaimedTokenA"),d("totalFeesTokenB"),d("totalFeesClaimedTokenB"),d("fundFeesTokenA"),d("fundFeesTokenB"),d("startTime"),T(d(),15*4-3,"padding")]),ti=h([w("growthInsideLastX64"),d("rewardAmountOwed")]),zt=h([K(8),I("bump"),b("nftMint"),b("poolId"),q("tickLower"),q("tickUpper"),w("liquidity"),w("feeGrowthInsideLastX64A"),w("feeGrowthInsideLastX64B"),d("tokenFeesOwedA"),d("tokenFeesOwedB"),T(ti,3,"rewardInfos"),T(d(),8,"")]),$c=h([K(8),I("bump"),b("poolId"),q("tickLowerIndex"),q("tickUpperIndex"),w("liquidity"),w("feeGrowthInsideLastX64A"),w("feeGrowthInsideLastX64B"),d("tokenFeesOwedA"),d("tokenFeesOwedB"),T(w(),3,"rewardGrowthInside"),T(d(),8,"")]),ni=h([q("tick"),Et("liquidityNet"),w("liquidityGross"),w("feeGrowthOutsideX64A"),w("feeGrowthOutsideX64B"),T(w(),3,"rewardGrowthsOutsideX64"),T(re(),13,"")]),Gt=h([K(8),b("poolId"),q("startTickIndex"),T(ni,Ne,"ticks"),I("initializedTickCount"),T(I(),115,"")]),ii=h([K(329),T(b(),100,"whitelistMints")]),zn=h([K(8),b("poolId"),T(T(d(),8),rt,"positiveTickArrayBitmap"),T(T(d(),8),rt,"negativeTickArrayBitmap")]),eu=h([d(),I("bump"),b("owner"),b("poolId"),b("positionId"),b("nftAccount"),T(d(),8)]),ri=h([K(8),I("bump"),b("lockOwner"),b("poolId"),b("positionId"),b("nftAccount"),b("lockNftMint"),d("recentEpoch"),T(d(),8)]);jt.span;var Au=x("Raydium_Clmm");var st=m(require("bn.js")),Fe=m(require("decimal.js")),Ae=class{static _multipler(e){return new Fe.default(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Fe.default(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new st.default(i.mul(this._Q64).toFixed(0))}};Ae._Q64=new Fe.default(new st.default(1).shln(64).toString());var Me=class extends X{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new H.default(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new H.default(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new H.default(e.virtualA.mul(e.realA).toString()).div(Ae._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new H.default(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new H.default(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new S.default(0)))throw Error("supplyMinusLocked need gt 0");let l=t.mul(new S.default(3)).sub(o),f=t.mul(new S.default(2)).mul(s).div(l),A=f.mul(f),p=t.mul(new S.default(2)).mul(V).div(A);if(!p.gt(new S.default(0)))throw Error("a need gt 0");if(!$e.gt(p))throw Error("a need lt u64 max");if(p.lt(new S.default(0))||f.lt(new S.default(0)))throw Error("invalid input 0");return{a:p,b:new S.default(0),c:f}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new S.default(2).mul(n).mul(V).div(e.virtualA);return new S.default(new H.default(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return Y(e.virtualA.mul(i),new S.default(2).mul(V)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),o=Y(e.virtualA.mul(i),new S.default(2).mul(V));return e.realB.sub(o)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new S.default(2).mul(n).mul(V).div(e.virtualA),o=new S.default(new H.default(i.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var we=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:l,decimalA:P,decimalB:f}){if(t<3)throw Error("point count < 3");let A=this.getCurve(e),p=A.getInitParam({supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:l}),L=A.getPoolInitPriceByInit(M(C({},p),{decimalA:P,decimalB:f})),F=i.div(new R.default(t-1)),k=new R.default(0),O=[{price:L,totalSellSupply:0}],{a:D,b:W}=p,E=k,z=k;for(let Z=1;Z<t;Z++){let Zt=Z!==t-1?F:i.sub(z),ct=this.buyExactIn({poolInfo:{virtualA:D,virtualB:W,realA:E,realB:z,totalFundRaisingB:i,totalSellA:o},amountB:Zt,protocolFeeRate:k,platformFeeRate:k,curveType:e,shareFeeRate:k,creatorFeeRate:k,transferFeeConfigA:void 0,slot:0});E=E.add(ct.amountA.amount),z=z.add(ct.amountB);let Qt=this.getPrice({poolInfo:{virtualA:D,virtualB:W,realA:E,realB:z},decimalA:P,decimalB:f,curveType:e});O.push({price:Qt,totalSellSupply:new at.default(E.toString()).div(10**P).toNumber()})}return O}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:o,config:s,migrateType:l}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(j).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new R.default(10**o))))throw Error("supply lt min supply");let f=e.mul(s.minSellRateA).div(j);if(n.lt(f))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let A=e.sub(n).sub(i),p=e.mul(s.minMigrateRateA).div(j);if(A.lt(p))throw Error("migrate lt min migrate amoount");let L=e.sub(n).sub(i),F=new R.default(new at.default(L.mul(t).toString()).sqrt().toFixed(0));if(l==="amm"){let k=new R.default(10).pow(new R.default(o));if(F.lte(k))throw Error("check migrate lp error")}else if(l==="cpmm"){let k=new R.default(100);if(F.lte(k))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:P,slot:f}){let A=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),p=this.calculateFee({amount:t,feeRate:A}),L=t.sub(p),F=this.getCurve(o),k=F.buyExactIn({poolInfo:e,amount:L}),O=e.totalSellA.sub(e.realA),D,W,E;if(k.gt(O)){D=O;let Z=F.buyExactOut({poolInfo:e,amount:D});W=this.calculatePreFee({postFeeAmount:Z,feeRate:A}),E=W.sub(Z)}else D=k,W=t,E=p;let z=this.splitFee({totalFee:E,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:He(D,P,f),amountB:W,splitFee:z}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:P,slot:f}){let A=e.totalSellA.sub(e.realA),p=ze(t,P,f),L=p.fee?p.amount.add(p.fee):p.amount;t.gt(A)&&(L=A);let k=this.getCurve(o).buyExactOut({poolInfo:e,amount:L}),O=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),D=this.calculatePreFee({postFeeAmount:k,feeRate:O}),W=D.sub(k),E=this.splitFee({totalFee:W,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:p,amountB:D,splitFee:E}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:P,slot:f}){let A=this.getCurve(o),p=He(t,P,f),L=p.fee?p.amount.sub(p.fee):p.amount,F=A.sellExactIn({poolInfo:e,amount:L}),k=this.calculateFee({amount:F,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l})}),O=this.splitFee({totalFee:k,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:p,amountB:F.sub(k),splitFee:O}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:P,slot:f}){let A=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),p=this.calculatePreFee({postFeeAmount:t,feeRate:A});if(e.realB.lt(p))throw Error("Insufficient liquidity");let L=p.sub(t),k=we.getCurve(o).sellExactOut({poolInfo:e,amount:p});if(k.gt(e.realA))throw Error();let O=this.splitFee({totalFee:L,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:ze(k,P,f),amountB:t,splitFee:O}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}),l=s.isZero()?new R.default(0):e.mul(n).div(s),P=s.isZero()?new R.default(0):e.mul(i).div(s),f=s.isZero()?new R.default(0):e.mul(o).div(s),A=e.sub(l).sub(P).sub(f);return{platformFee:l,shareFee:P,protocolFee:A,creatorFee:f}}static calculateFee({amount:e,feeRate:t}){return It(e,t,j)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(j),i=j.sub(t);return n.add(i).sub(new R.default(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new R.default(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return Se;case 1:return Ce;case 2:return Me}throw Error("find curve error")}};0&&(module.exports={Curve});
//# sourceMappingURL=curve.js.map