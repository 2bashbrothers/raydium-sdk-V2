var Mt=Object.defineProperty,Ot=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var Ze=Object.getOwnPropertySymbols;var vt=Object.prototype.hasOwnProperty,Dt=Object.prototype.propertyIsEnumerable;var Ye=(r,e,t)=>e in r?Mt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))vt.call(e,t)&&Ye(r,t,e[t]);if(Ze)for(var t of Ze(e))Dt.call(e,t)&&Ye(r,t,e[t]);return r},R=(r,e)=>Ot(r,Et(e));import F from"bn.js";import Rt from"decimal.js";import{PublicKey as Qn}from"@solana/web3.js";import{get as Je,set as Vt}from"lodash";var he=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},$e={},_t={};function h(r){let e=Je($e,r);if(!e){let t=Je(_t,r);e=new he({name:r,logLevel:t}),Vt($e,r,e)}return e}import{MINT_SIZE as $n,TOKEN_PROGRAM_ID as ei,getTransferFeeConfig as ti,unpackMint as ni}from"@solana/spl-token";var ii=h("Raydium_accountInfo_util");import D from"bn.js";import Xr from"decimal.js";import jt from"big.js";import Ti from"bn.js";import Wt from"toformat";var qt=Wt,$=qt;import pe from"big.js";import Ut from"bn.js";import Xt from"decimal.js-light";import ee from"bn.js";var tt=9007199254740991;function v(r){let e=h("Raydium_parseBigNumberish");if(r instanceof ee)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new ee(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=tt||r<=-tt)&&e.logWithError(`BigNumberish number overflow: ${r}`),new ee(String(r))):typeof r=="bigint"?new ee(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new ee(0))}var de=h("module/fraction"),xe=$(pe),te=$(Xt),Ht={[0]:te.ROUND_DOWN,[1]:te.ROUND_HALF_UP,[2]:te.ROUND_UP},zt={[0]:pe.roundDown,[1]:pe.roundHalfUp,[2]:pe.roundUp},b=class{constructor(e,t=new Ut(1)){this.numerator=v(e),this.denominator=v(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new b(this.denominator,this.numerator)}add(e){let t=e instanceof b?e:new b(v(e));return this.denominator.eq(t.denominator)?new b(this.numerator.add(t.numerator),this.denominator):new b(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof b?e:new b(v(e));return this.denominator.eq(t.denominator)?new b(this.numerator.sub(t.numerator),this.denominator):new b(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof b?e:new b(v(e));return new b(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof b?e:new b(v(e));return new b(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||de.logWithError(`${e} is not an integer.`),e<=0&&de.logWithError(`${e} is not positive.`),te.set({precision:e+1,rounding:Ht[n]});let i=new te(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||de.logWithError(`${e} is not an integer.`),e<0&&de.logWithError(`${e} is negative.`),xe.DP=e,xe.RM=zt[n]||1,new xe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ni=h("Raydium_amount"),Ri=$(jt);import{PublicKey as Zt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as nt}from"@solana/spl-token";var Ie={chainId:101,address:Zt.default.toBase58(),programId:nt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},q={chainId:101,address:"So11111111111111111111111111111111111111112",programId:nt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ce}from"@solana/web3.js";import{PublicKey as P,SystemProgram as it,SYSVAR_RENT_PUBKEY as Yt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jt}from"@solana/spl-token";function Se({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Vi=[Se({pubkey:Jt,isWritable:!1}),Se({pubkey:it.programId,isWritable:!1}),Se({pubkey:Yt,isWritable:!1})];function rt({publicKey:r,transformSol:e}){let t=ot(r.toString());if(t instanceof P)return e&&t.equals(ne)?me:t;if(e&&t.toString()===ne.toBase58())return me;if(typeof t=="string"){if(t===P.default.toBase58())return P.default;try{return new P(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ot(r){try{return new P(r)}catch{return r}}var $t=new P("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),en=new P("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),tn=new P("SysvarRent111111111111111111111111111111111"),_i=new P("SysvarC1ock11111111111111111111111111111111"),st=new P("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Wi=new P("Sysvar1nstructions1111111111111111111111111"),qi=it.programId,Gi=new P("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ui=new P("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Xi=new P("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Hi=new P("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),zi=new P("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ji=new P("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Qi=new P("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Zi=new P("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Yi=new P("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ji=new P("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),$i=new P("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),me=new P("So11111111111111111111111111111111111111112"),ne=P.default;var Ke=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===ne.toBase58()||e instanceof Ce&&ne.equals(e)){this.decimals=q.decimals,this.symbol=q.symbol,this.name=q.name,this.mint=new Ce(q.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Ce.default:rt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},G=Ke;G.WSOL=new Ke(R(S({},q),{mint:q.address}));var Ne=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},fe=Ne;fe.SOL=new Ne(Ie);import nn from"bn.js";var mr=new b(new nn(100));var gr=h("Raydium_price");import{PublicKey as Mr}from"@solana/web3.js";import Er from"bn.js";var rn=new D(0),to=new D(1),no=new D(2),io=new D(3),ro=new D(5),Qt=new D(10),oo=new D(100),so=new D(1e3),ao=new D(1e4);function at(r,e,t){return r.mul(e).add(t).sub(new D(1)).div(t)}import{PublicKey as Fo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Oo}from"@solana/spl-token";import{ComputeBudgetProgram as yo,Keypair as Ao,PublicKey as wo,Transaction as ko,TransactionMessage as ho,VersionedTransaction as xo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ko}from"@solana/spl-token";var No=h("Raydium_txUtil");import{PublicKey as a}from"@solana/web3.js";var Vo=new a("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),_o=new a("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Wo=new a("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),qo=new a("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Go=new a("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Uo=new a("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Xo=new a("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ho=new a("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),zo=new a("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),jo=new a("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),sn=new a("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),an=new a("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),cn=new a("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Qo=new a("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Zo=new a("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Yo=new a("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Jo=new a("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),$o=new a("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),es=new a("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ts=new a("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ns=new a("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),is=new a("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),rs=new a("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),os=new a("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ss=new a("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),as=new a("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),cs=new a("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),us=new a("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),ls=new a("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),ms=new a("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),ds=new a("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ps={OPEN_BOOK_PROGRAM:new a("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new a("Ray1111111111111111111111111111111111111111"),AMM_V4:new a("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new a("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new a("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new a("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new a("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new a("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new a("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new a("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new a("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new a("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:a.default,Router:new a("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new a("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new a("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new a("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new a("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new a("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new a("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new a("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new a("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new a("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new a("Ray1111111111111111111111111111111111111111")};import k from"bn.js";var ie=1e4;function Me(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new k(0))?t.add(new k(1)):t}function H(r,e){if(r.isZero())return new k(0);let t=r.div(e);return t.isZero()?new k(1):r.mod(e).gt(new k(0))?t.add(new k(1)):t}function Oe(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new k(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,l=Me(r.mul(new k(i.transferFeeBasisPoints)),new k(ie)),y=l.gt(o)?o:l;return{amount:r,fee:y,expirationTime:s}}function Ee(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new k(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===ie){let l=new k(i.maximumFee.toString());return{amount:r.add(l),fee:l,expirationTime:s}}else{let l=Me(r.mul(new k(ie)),new k(ie-i.transferFeeBasisPoints)),y=new k(i.maximumFee.toString()),p=l.sub(r).gt(y)?r.add(y):l,g=Me(p.mul(new k(i.transferFeeBasisPoints)),new k(ie)),d=g.gt(o)?o:g;return{amount:p,fee:d,expirationTime:s}}}import{PublicKey as un,AddressLookupTableAccount as ct}from"@solana/web3.js";var ln={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ct({key:new un("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ct.deserialize(Buffer.from("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","base64"))})};import{PublicKey as Ls,sendAndConfirmTransaction as Fs,SystemProgram as Es,Transaction as vs,TransactionMessage as Vs,VersionedTransaction as _s}from"@solana/web3.js";import qs from"axios";import pn from"bn.js";var z=new pn(1e6);import ye from"bn.js";import re from"decimal.js";var U=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var ge=class extends U{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new re(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new re(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new re(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new re(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new re(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new ye(0)))throw Error("supplyMinusSellLocked <= 0");let l=t.sub(o);if(l.lte(new ye(0)))throw Error("tfMinusMf <= 0");let y=l.mul(n).mul(n).div(s),p=l.mul(n).div(s).sub(t),g=y.div(p),d=t.mul(t).div(p);if(g.lt(new ye(0))||d.lt(new ye(0)))throw Error("invalid input 0");return{a:g,b:d,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),o=t.add(e);return i.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),o=n.sub(e);return H(i,o)}};import Pe from"bn.js";import oe from"decimal.js";var Ae=class extends U{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new oe(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new oe(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new oe(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new oe(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new oe(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new Pe(0)))throw Error("invalid input 1");let l=new Pe(2).mul(t).sub(o),p=t.mul(s).div(l);if(p.lt(new Pe(0))||t.lt(new Pe(0)))throw Error("invalid input 0");return{a:p,b:t,c:p}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return H(i,n)}};import I from"bn.js";import j from"decimal.js";import{PublicKey as Rm}from"@solana/web3.js";import Fm from"bn.js";import Om from"decimal.js";import{AccountLayout as Dm,createAssociatedTokenAccountIdempotentInstruction as Vm,TOKEN_2022_PROGRAM_ID as _m,TOKEN_PROGRAM_ID as Wm}from"@solana/spl-token";import{PublicKey as Na}from"@solana/web3.js";import{MintLayout as La,TOKEN_PROGRAM_ID as Ma}from"@solana/spl-token";import{Keypair as em,PublicKey as tm,SystemProgram as im,TransactionInstruction as rm}from"@solana/web3.js";import sm from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as um,TOKEN_2022_PROGRAM_ID as lm,TOKEN_PROGRAM_ID as mm}from"@solana/spl-token";import{PublicKey as kn}from"@solana/web3.js";import pt,{isBN as ft}from"bn.js";import{bits as ja,BitStructure as Qa,blob as fn,Blob as Za,cstr as Ya,f32 as Ja,f32be as $a,f64 as ec,f64be as tc,greedy as nc,Layout as bn,ns64 as ic,ns64be as rc,nu64 as oc,nu64be as sc,offset as ac,s16 as cc,s16be as uc,s24 as lc,s24be as mc,s32 as yn,s32be as dc,s40 as pc,s40be as fc,s48 as bc,s48be as yc,s8 as gc,seq as gn,struct as Pc,Structure as Pn,u16 as An,u16be as Ac,u24 as wc,u24be as Tc,u32 as kc,u32be as Bc,u40 as hc,u40be as xc,u48 as Ic,u48be as Sc,u8 as wn,UInt as Tn,union as Cc,Union as Kc,unionLayoutDiscriminator as Nc,utf8 as Rc}from"@solana/buffer-layout";var ve=bn,lt=Pn;var De=Tn;var mt=wn,se=An;var W=yn;var dt=gn;var C=fn;var Z=class extends ve{constructor(t,n,i){super(t,i);this.blob=C(t),this.signed=n}decode(t,n=0){let i=new pt(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new pt(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function x(r){return new De(1,r)}function Y(r){return new De(4,r)}function m(r){return new Z(8,!1,r)}function A(r){return new Z(16,!1,r)}function bt(r){return new Z(8,!0,r)}function yt(r){return new Z(16,!0,r)}var we=class extends ve{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function f(r){return new we(C(32),e=>new kn(e),e=>e.toBuffer(),r)}function _e(r){return new we(mt(),Bn,hn,r)}function Bn(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function hn(r){return r?1:0}var Ve=class extends lt{decode(e,t){return super.decode(e,t)}};function B(r,e,t){return new Ve(r,e,t)}function w(r,e,t){let n,i=typeof e=="number"?e:ft(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let l=Reflect.get(o,"count");n=ft(l)?l.toNumber():l,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,l){return s==="count"&&(n=l),Reflect.set(o,s,l)}});return dt(r,i,t)}import Ll from"bn.js";import Ml from"decimal.js";import L from"bn.js";var We=new L(0),gt=new L(1),Pt=new L(-1),V=new L(1).shln(64),At=new L(1).shln(128),qe=V.sub(gt);var xn=At.subn(1),J=-443636,ae=-J,Ge=new L("4295048016"),Ue=new L("79226673521066979257578248091"),Xc=new L("4295048017"),Hc=new L("79226673521066979257578248090");var In=new L(10).pow(new L(6));var zc=new L("18446744073700000000");import gl from"bn.js";import Al from"decimal.js";var eu=Buffer.from("amm_config","utf8"),tu=Buffer.from("pool","utf8"),nu=Buffer.from("pool_vault","utf8"),iu=Buffer.from("pool_reward_vault","utf8"),ru=Buffer.from("position","utf8"),ou=Buffer.from("tick_array","utf8"),su=Buffer.from("operation","utf8"),au=Buffer.from("pool_tick_array_bitmap_extension","utf8"),cu=Buffer.from("observation","utf8");var uu=Buffer.from("locked_position","utf8");var lu=Buffer.from("support_mint","utf8");import{PublicKey as Uu}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Hu}from"@solana/spl-token";import ju from"bn.js";import Zu from"decimal.js";import pu from"bn.js";import bu from"decimal.js";var ze=14;var Te=60;var Rn=B([C(8),x("bump"),se("index"),f(""),Y("protocolFeeRate"),Y("tradeFeeRate"),se("tickSpacing"),w(m(),8,"")]),Ln=B([Y("blockTimestamp"),bt("tickCumulative"),w(m(),4)]),Kt=B([C(8),_e("initialized"),m("recentEpoch"),se("observationIndex"),f("poolId"),w(Ln,100,"observations"),w(m(),4)]),Fn=B([x("rewardState"),m("openTime"),m("endTime"),m("lastUpdateTime"),A("emissionsPerSecondX64"),m("rewardTotalEmissioned"),m("rewardClaimed"),f("tokenMint"),f("tokenVault"),f("creator"),A("rewardGrowthGlobalX64")]),It=B([C(8),x("bump"),f("ammConfig"),f("creator"),f("mintA"),f("mintB"),f("vaultA"),f("vaultB"),f("observationId"),x("mintDecimalsA"),x("mintDecimalsB"),se("tickSpacing"),A("liquidity"),A("sqrtPriceX64"),W("tickCurrent"),Y(),A("feeGrowthGlobalX64A"),A("feeGrowthGlobalX64B"),m("protocolFeesTokenA"),m("protocolFeesTokenB"),A("swapInAmountTokenA"),A("swapOutAmountTokenB"),A("swapInAmountTokenB"),A("swapOutAmountTokenA"),x("status"),w(x(),7,""),w(Fn,3,"rewardInfos"),w(m(),16,"tickArrayBitmap"),m("totalFeesTokenA"),m("totalFeesClaimedTokenA"),m("totalFeesTokenB"),m("totalFeesClaimedTokenB"),m("fundFeesTokenA"),m("fundFeesTokenB"),m("startTime"),w(m(),15*4-3,"padding")]),Mn=B([A("growthInsideLastX64"),m("rewardAmountOwed")]),St=B([C(8),x("bump"),f("nftMint"),f("poolId"),W("tickLower"),W("tickUpper"),A("liquidity"),A("feeGrowthInsideLastX64A"),A("feeGrowthInsideLastX64B"),m("tokenFeesOwedA"),m("tokenFeesOwedB"),w(Mn,3,"rewardInfos"),w(m(),8,"")]),Gl=B([C(8),x("bump"),f("poolId"),W("tickLowerIndex"),W("tickUpperIndex"),A("liquidity"),A("feeGrowthInsideLastX64A"),A("feeGrowthInsideLastX64B"),m("tokenFeesOwedA"),m("tokenFeesOwedB"),w(A(),3,"rewardGrowthInside"),w(m(),8,"")]),On=B([W("tick"),yt("liquidityNet"),A("liquidityGross"),A("feeGrowthOutsideX64A"),A("feeGrowthOutsideX64B"),w(A(),3,"rewardGrowthsOutsideX64"),w(Y(),13,"")]),Bt=B([C(8),f("poolId"),W("startTickIndex"),w(On,Te,"ticks"),x("initializedTickCount"),w(x(),115,"")]),En=B([C(329),w(f(),100,"whitelistMints")]),Nn=B([C(8),f("poolId"),w(w(m(),8),ze,"positiveTickArrayBitmap"),w(w(m(),8),ze,"negativeTickArrayBitmap")]),Ul=B([m(),x("bump"),f("owner"),f("poolId"),f("positionId"),f("nftAccount"),w(m(),8)]),vn=B([C(8),x("bump"),f("lockOwner"),f("poolId"),f("positionId"),f("nftAccount"),f("lockNftMint"),m("recentEpoch"),w(m(),8)]);Kt.span;var wm=h("Raydium_Clmm");import Nt from"bn.js";import je from"decimal.js";var le=class{static _multipler(e){return new je(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new je(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new Nt(i.mul(this._Q64).toFixed(0))}};le._Q64=new je(new Nt(1).shln(64).toString());var ke=class extends U{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new j(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new j(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new j(e.virtualA.mul(e.realA).toString()).div(le._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new j(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new j(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new I(0)))throw Error("supplyMinusLocked need gt 0");let l=t.mul(new I(3)).sub(o),p=t.mul(new I(2)).mul(s).div(l),g=p.mul(p),d=t.mul(new I(2)).mul(V).div(g);if(!d.gt(new I(0)))throw Error("a need gt 0");if(!qe.gt(d))throw Error("a need lt u64 max");if(d.lt(new I(0))||p.lt(new I(0)))throw Error("invalid input 0");return{a:d,b:new I(0),c:p}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new I(2).mul(n).mul(V).div(e.virtualA);return new I(new j(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return H(e.virtualA.mul(i),new I(2).mul(V)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),o=H(e.virtualA.mul(i),new I(2).mul(V));return e.realB.sub(o)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new I(2).mul(n).mul(V).div(e.virtualA),o=new I(new j(i.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var Be=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:l,decimalA:y,decimalB:p}){if(t<3)throw Error("point count < 3");let g=this.getCurve(e),d=g.getInitParam({supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:l}),K=g.getPoolInitPriceByInit(R(S({},d),{decimalA:y,decimalB:p})),N=i.div(new F(t-1)),T=new F(0),M=[{price:K,totalSellSupply:0}],{a:E,b:_}=d,O=T,X=T;for(let Q=1;Q<t;Q++){let Lt=Q!==t-1?N:i.sub(X),Qe=this.buyExactIn({poolInfo:{virtualA:E,virtualB:_,realA:O,realB:X,totalFundRaisingB:i,totalSellA:o},amountB:Lt,protocolFeeRate:T,platformFeeRate:T,curveType:e,shareFeeRate:T,creatorFeeRate:T,transferFeeConfigA:void 0,slot:0});O=O.add(Qe.amountA.amount),X=X.add(Qe.amountB);let Ft=this.getPrice({poolInfo:{virtualA:E,virtualB:_,realA:O,realB:X},decimalA:y,decimalB:p,curveType:e});M.push({price:Ft,totalSellSupply:new Rt(O.toString()).div(10**y).toNumber()})}return M}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:o,config:s,migrateType:l}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(z).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new F(10**o))))throw Error("supply lt min supply");let p=e.mul(s.minSellRateA).div(z);if(n.lt(p))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let g=e.sub(n).sub(i),d=e.mul(s.minMigrateRateA).div(z);if(g.lt(d))throw Error("migrate lt min migrate amoount");let K=e.sub(n).sub(i),N=new F(new Rt(K.mul(t).toString()).sqrt().toFixed(0));if(l==="amm"){let T=new F(10).pow(new F(o));if(N.lte(T))throw Error("check migrate lp error")}else if(l==="cpmm"){let T=new F(100);if(N.lte(T))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:y,slot:p}){let g=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),d=this.calculateFee({amount:t,feeRate:g}),K=t.sub(d),N=this.getCurve(o),T=N.buyExactIn({poolInfo:e,amount:K}),M=e.totalSellA.sub(e.realA),E,_,O;if(T.gt(M)){E=M;let Q=N.buyExactOut({poolInfo:e,amount:E});_=this.calculatePreFee({postFeeAmount:Q,feeRate:g}),O=_.sub(Q)}else E=T,_=t,O=d;let X=this.splitFee({totalFee:O,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:Oe(E,y,p),amountB:_,splitFee:X}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:y,slot:p}){let g=e.totalSellA.sub(e.realA),d=Ee(t,y,p),K=d.fee?d.amount.add(d.fee):d.amount;t.gt(g)&&(K=g);let T=this.getCurve(o).buyExactOut({poolInfo:e,amount:K}),M=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),E=this.calculatePreFee({postFeeAmount:T,feeRate:M}),_=E.sub(T),O=this.splitFee({totalFee:_,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:d,amountB:E,splitFee:O}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:y,slot:p}){let g=this.getCurve(o),d=Oe(t,y,p),K=d.fee?d.amount.sub(d.fee):d.amount,N=g.sellExactIn({poolInfo:e,amount:K}),T=this.calculateFee({amount:N,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l})}),M=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:d,amountB:N.sub(T),splitFee:M}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:y,slot:p}){let g=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),d=this.calculatePreFee({postFeeAmount:t,feeRate:g});if(e.realB.lt(d))throw Error("Insufficient liquidity");let K=d.sub(t),T=Be.getCurve(o).sellExactOut({poolInfo:e,amount:d});if(T.gt(e.realA))throw Error();let M=this.splitFee({totalFee:K,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:Ee(T,y,p),amountB:t,splitFee:M}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}),l=s.isZero()?new F(0):e.mul(n).div(s),y=s.isZero()?new F(0):e.mul(i).div(s),p=s.isZero()?new F(0):e.mul(o).div(s),g=e.sub(l).sub(y).sub(p);return{platformFee:l,shareFee:y,protocolFee:g,creatorFee:p}}static calculateFee({amount:e,feeRate:t}){return at(e,t,z)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(z),i=z.sub(t);return n.add(i).sub(new F(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new F(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return ge;case 1:return Ae;case 2:return ke}throw Error("find curve error")}};export{Be as Curve};
//# sourceMappingURL=curve.mjs.map