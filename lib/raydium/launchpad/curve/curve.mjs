var Ft=Object.defineProperty,Mt=Object.defineProperties;var Ot=Object.getOwnPropertyDescriptors;var Ze=Object.getOwnPropertySymbols;var Et=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable;var Qe=(r,e,t)=>e in r?Ft(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))Et.call(e,t)&&Qe(r,t,e[t]);if(Ze)for(var t of Ze(e))vt.call(e,t)&&Qe(r,t,e[t]);return r},R=(r,e)=>Mt(r,Ot(e));import F from"bn.js";import Nt from"decimal.js";import{PublicKey as Hn}from"@solana/web3.js";import{get as Je,set as Dt}from"lodash";var he=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},$e={},_t={};function h(r){let e=Je($e,r);if(!e){let t=Je(_t,r);e=new he({name:r,logLevel:t}),Dt($e,r,e)}return e}import{MINT_SIZE as Zn,TOKEN_PROGRAM_ID as Qn,getTransferFeeConfig as Jn,unpackMint as $n}from"@solana/spl-token";var ei=h("Raydium_accountInfo_util");import D from"bn.js";import Mr from"decimal.js";import zt from"big.js";import Pi from"bn.js";import Vt from"toformat";var Wt=Vt,$=Wt;import pe from"big.js";import Gt from"bn.js";import Ut from"decimal.js-light";import ee from"bn.js";var tt=9007199254740991;function v(r){let e=h("Raydium_parseBigNumberish");if(r instanceof ee)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new ee(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=tt||r<=-tt)&&e.logWithError(`BigNumberish number overflow: ${r}`),new ee(String(r))):typeof r=="bigint"?new ee(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new ee(0))}var de=h("module/fraction"),xe=$(pe),te=$(Ut),Xt={[0]:te.ROUND_DOWN,[1]:te.ROUND_HALF_UP,[2]:te.ROUND_UP},Ht={[0]:pe.roundDown,[1]:pe.roundHalfUp,[2]:pe.roundUp},y=class{constructor(e,t=new Gt(1)){this.numerator=v(e),this.denominator=v(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new y(this.denominator,this.numerator)}add(e){let t=e instanceof y?e:new y(v(e));return this.denominator.eq(t.denominator)?new y(this.numerator.add(t.numerator),this.denominator):new y(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof y?e:new y(v(e));return this.denominator.eq(t.denominator)?new y(this.numerator.sub(t.numerator),this.denominator):new y(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof y?e:new y(v(e));return new y(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof y?e:new y(v(e));return new y(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||de.logWithError(`${e} is not an integer.`),e<=0&&de.logWithError(`${e} is not positive.`),te.set({precision:e+1,rounding:Xt[n]});let i=new te(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||de.logWithError(`${e} is not an integer.`),e<0&&de.logWithError(`${e} is negative.`),xe.DP=e,xe.RM=Ht[n]||1,new xe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Si=h("Raydium_amount"),Ci=$(zt);import{PublicKey as jt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as nt}from"@solana/spl-token";var Ie={chainId:101,address:jt.default.toBase58(),programId:nt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},q={chainId:101,address:"So11111111111111111111111111111111111111112",programId:nt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ce}from"@solana/web3.js";import{PublicKey as P,SystemProgram as it,SYSVAR_RENT_PUBKEY as Zt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Qt}from"@solana/spl-token";function Se({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Ei=[Se({pubkey:Qt,isWritable:!1}),Se({pubkey:it.programId,isWritable:!1}),Se({pubkey:Zt,isWritable:!1})];function rt({publicKey:r,transformSol:e}){let t=ot(r.toString());if(t instanceof P)return e&&t.equals(ne)?me:t;if(e&&t.toString()===ne.toBase58())return me;if(typeof t=="string"){if(t===P.default.toBase58())return P.default;try{return new P(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ot(r){try{return new P(r)}catch{return r}}var Jt=new P("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),$t=new P("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),en=new P("SysvarRent111111111111111111111111111111111"),vi=new P("SysvarC1ock11111111111111111111111111111111"),st=new P("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Di=new P("Sysvar1nstructions1111111111111111111111111"),_i=it.programId,Vi=new P("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Wi=new P("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),qi=new P("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Gi=new P("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ui=new P("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Xi=new P("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Hi=new P("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),zi=new P("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Yi=new P("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ji=new P("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Zi=new P("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),me=new P("So11111111111111111111111111111111111111112"),ne=P.default;var Ke=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===ne.toBase58()||e instanceof Ce&&ne.equals(e)){this.decimals=q.decimals,this.symbol=q.symbol,this.name=q.name,this.mint=new Ce(q.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Ce.default:rt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},G=Ke;G.WSOL=new Ke(R(S({},q),{mint:q.address}));var Ne=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},fe=Ne;fe.SOL=new Ne(Ie);import tn from"bn.js";var cr=new y(new tn(100));var fr=h("Raydium_price");var nn=new D(0),Gr=new D(1),Ur=new D(2),Xr=new D(3),Hr=new D(5),Yt=new D(10),zr=new D(100),Yr=new D(1e3),jr=new D(1e4);function at(r,e,t){return r.mul(e).add(t).sub(new D(1)).div(t)}import{PublicKey as To}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bo}from"@solana/spl-token";import{ComputeBudgetProgram as io,Keypair as so,PublicKey as ao,Transaction as uo,TransactionMessage as mo,VersionedTransaction as po}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as go}from"@solana/spl-token";var Po=h("Raydium_txUtil");import{PublicKey as a}from"@solana/web3.js";var So=new a("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Co=new a("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ko=new a("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),No=new a("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ro=new a("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Lo=new a("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Fo=new a("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Mo=new a("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Oo=new a("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Eo=new a("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),on=new a("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),sn=new a("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),an=new a("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),vo=new a("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Do=new a("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),_o=new a("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Vo=new a("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Wo=new a("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),qo=new a("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Go=new a("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Uo=new a("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Xo=new a("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ho=new a("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),zo=new a("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Yo=new a("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),jo=new a("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Zo=new a("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Qo=new a("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Jo=new a("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),$o=new a("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),es=new a("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ts={OPEN_BOOK_PROGRAM:new a("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new a("Ray1111111111111111111111111111111111111111"),AMM_V4:new a("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new a("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new a("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new a("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new a("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new a("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new a("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new a("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new a("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new a("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:a.default,Router:new a("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new a("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new a("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new a("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new a("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new a("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new a("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new a("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new a("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new a("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new a("Ray1111111111111111111111111111111111111111")};import k from"bn.js";var ie=1e4;function Me(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new k(0))?t.add(new k(1)):t}function H(r,e){if(r.isZero())return new k(0);let t=r.div(e);return t.isZero()?new k(1):r.mod(e).gt(new k(0))?t.add(new k(1)):t}function Oe(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new k(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,l=Me(r.mul(new k(i.transferFeeBasisPoints)),new k(ie)),b=l.gt(o)?o:l;return{amount:r,fee:b,expirationTime:s}}function Ee(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new k(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===ie){let l=new k(i.maximumFee.toString());return{amount:r.add(l),fee:l,expirationTime:s}}else{let l=Me(r.mul(new k(ie)),new k(ie-i.transferFeeBasisPoints)),b=new k(i.maximumFee.toString()),p=l.sub(r).gt(b)?r.add(b):l,g=Me(p.mul(new k(i.transferFeeBasisPoints)),new k(ie)),d=g.gt(o)?o:g;return{amount:p,fee:d,expirationTime:s}}}import{PublicKey as as,AddressLookupTableAccount as cs}from"@solana/web3.js";import{PublicKey as hs,sendAndConfirmTransaction as xs,SystemProgram as Cs,Transaction as Ks,TransactionMessage as Rs,VersionedTransaction as Ls}from"@solana/web3.js";import Ms from"axios";import{PublicKey as qs}from"@solana/web3.js";import Us from"bn.js";import ln from"bn.js";var z=new ln(1e6);import be from"bn.js";import re from"decimal.js";var U=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var ge=class extends U{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new re(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new re(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new re(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new re(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new re(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new be(0)))throw Error("supplyMinusSellLocked <= 0");let l=t.sub(o);if(l.lte(new be(0)))throw Error("tfMinusMf <= 0");let b=l.mul(n).mul(n).div(s),p=l.mul(n).div(s).sub(t),g=b.div(p),d=t.mul(t).div(p);if(g.lt(new be(0))||d.lt(new be(0)))throw Error("invalid input 0");return{a:g,b:d,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),o=t.add(e);return i.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),o=n.sub(e);return H(i,o)}};import Pe from"bn.js";import oe from"decimal.js";var Ae=class extends U{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new oe(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new oe(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new oe(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new oe(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new oe(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new Pe(0)))throw Error("invalid input 1");let l=new Pe(2).mul(t).sub(o),p=t.mul(s).div(l);if(p.lt(new Pe(0))||t.lt(new Pe(0)))throw Error("invalid input 0");return{a:p,b:t,c:p}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return H(i,n)}};import I from"bn.js";import Y from"decimal.js";import{PublicKey as Lm}from"@solana/web3.js";import Mm from"bn.js";import Em from"decimal.js";import{AccountLayout as _m,createAssociatedTokenAccountIdempotentInstruction as Vm,TOKEN_2022_PROGRAM_ID as Wm,TOKEN_PROGRAM_ID as qm}from"@solana/spl-token";import{PublicKey as Na}from"@solana/web3.js";import{MintLayout as La,TOKEN_PROGRAM_ID as Ma}from"@solana/spl-token";import{Keypair as tm,PublicKey as nm,SystemProgram as rm,TransactionInstruction as om}from"@solana/web3.js";import am from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as lm,TOKEN_2022_PROGRAM_ID as mm,TOKEN_PROGRAM_ID as dm}from"@solana/spl-token";import{PublicKey as An}from"@solana/web3.js";import dt,{isBN as pt}from"bn.js";import{bits as Ya,BitStructure as ja,blob as mn,Blob as Za,cstr as Qa,f32 as Ja,f32be as $a,f64 as ec,f64be as tc,greedy as nc,Layout as dn,ns64 as ic,ns64be as rc,nu64 as oc,nu64be as sc,offset as ac,s16 as cc,s16be as uc,s24 as lc,s24be as mc,s32 as pn,s32be as dc,s40 as pc,s40be as fc,s48 as yc,s48be as bc,s8 as gc,seq as fn,struct as Pc,Structure as yn,u16 as bn,u16be as Ac,u24 as wc,u24be as Tc,u32 as kc,u32be as Bc,u40 as hc,u40be as xc,u48 as Ic,u48be as Sc,u8 as gn,UInt as Pn,union as Cc,Union as Kc,unionLayoutDiscriminator as Nc,utf8 as Rc}from"@solana/buffer-layout";var ve=dn,ut=yn;var De=Pn;var lt=gn,se=bn;var W=pn;var mt=fn;var C=mn;var Z=class extends ve{constructor(t,n,i){super(t,i);this.blob=C(t),this.signed=n}decode(t,n=0){let i=new dt(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new dt(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function x(r){return new De(1,r)}function Q(r){return new De(4,r)}function m(r){return new Z(8,!1,r)}function A(r){return new Z(16,!1,r)}function ft(r){return new Z(8,!0,r)}function yt(r){return new Z(16,!0,r)}var we=class extends ve{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function f(r){return new we(C(32),e=>new An(e),e=>e.toBuffer(),r)}function Ve(r){return new we(lt(),wn,Tn,r)}function wn(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Tn(r){return r?1:0}var _e=class extends ut{decode(e,t){return super.decode(e,t)}};function B(r,e,t){return new _e(r,e,t)}function w(r,e,t){let n,i=typeof e=="number"?e:pt(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let l=Reflect.get(o,"count");n=pt(l)?l.toNumber():l,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,l){return s==="count"&&(n=l),Reflect.set(o,s,l)}});return mt(r,i,t)}import Fl from"bn.js";import Ol from"decimal.js";import L from"bn.js";var We=new L(0),bt=new L(1),gt=new L(-1),_=new L(1).shln(64),Pt=new L(1).shln(128),qe=_.sub(bt);var kn=Pt.subn(1),J=-443636,ae=-J,Ge=new L("4295048016"),Ue=new L("79226673521066979257578248091"),Xc=new L("4295048017"),Hc=new L("79226673521066979257578248090");var Bn=new L(10).pow(new L(6));var zc=new L("18446744073700000000");import Pl from"bn.js";import wl from"decimal.js";var eu=Buffer.from("amm_config","utf8"),tu=Buffer.from("pool","utf8"),nu=Buffer.from("pool_vault","utf8"),iu=Buffer.from("pool_reward_vault","utf8"),ru=Buffer.from("position","utf8"),ou=Buffer.from("tick_array","utf8"),su=Buffer.from("operation","utf8"),au=Buffer.from("pool_tick_array_bitmap_extension","utf8"),cu=Buffer.from("observation","utf8");var uu=Buffer.from("locked_position","utf8");var lu=Buffer.from("support_mint","utf8");import{PublicKey as Uu}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Hu}from"@solana/spl-token";import Yu from"bn.js";import Zu from"decimal.js";import pu from"bn.js";import yu from"decimal.js";var ze=14;var Te=60;var Cn=B([C(8),x("bump"),se("index"),f(""),Q("protocolFeeRate"),Q("tradeFeeRate"),se("tickSpacing"),w(m(),8,"")]),Kn=B([Q("blockTimestamp"),ft("tickCumulative"),w(m(),4)]),Ct=B([C(8),Ve("initialized"),m("recentEpoch"),se("observationIndex"),f("poolId"),w(Kn,100,"observations"),w(m(),4)]),Nn=B([x("rewardState"),m("openTime"),m("endTime"),m("lastUpdateTime"),A("emissionsPerSecondX64"),m("rewardTotalEmissioned"),m("rewardClaimed"),f("tokenMint"),f("tokenVault"),f("creator"),A("rewardGrowthGlobalX64")]),xt=B([C(8),x("bump"),f("ammConfig"),f("creator"),f("mintA"),f("mintB"),f("vaultA"),f("vaultB"),f("observationId"),x("mintDecimalsA"),x("mintDecimalsB"),se("tickSpacing"),A("liquidity"),A("sqrtPriceX64"),W("tickCurrent"),Q(),A("feeGrowthGlobalX64A"),A("feeGrowthGlobalX64B"),m("protocolFeesTokenA"),m("protocolFeesTokenB"),A("swapInAmountTokenA"),A("swapOutAmountTokenB"),A("swapInAmountTokenB"),A("swapOutAmountTokenA"),x("status"),w(x(),7,""),w(Nn,3,"rewardInfos"),w(m(),16,"tickArrayBitmap"),m("totalFeesTokenA"),m("totalFeesClaimedTokenA"),m("totalFeesTokenB"),m("totalFeesClaimedTokenB"),m("fundFeesTokenA"),m("fundFeesTokenB"),m("startTime"),w(m(),15*4-3,"padding")]),Rn=B([A("growthInsideLastX64"),m("rewardAmountOwed")]),It=B([C(8),x("bump"),f("nftMint"),f("poolId"),W("tickLower"),W("tickUpper"),A("liquidity"),A("feeGrowthInsideLastX64A"),A("feeGrowthInsideLastX64B"),m("tokenFeesOwedA"),m("tokenFeesOwedB"),w(Rn,3,"rewardInfos"),w(m(),8,"")]),Ul=B([C(8),x("bump"),f("poolId"),W("tickLowerIndex"),W("tickUpperIndex"),A("liquidity"),A("feeGrowthInsideLastX64A"),A("feeGrowthInsideLastX64B"),m("tokenFeesOwedA"),m("tokenFeesOwedB"),w(A(),3,"rewardGrowthInside"),w(m(),8,"")]),Ln=B([W("tick"),yt("liquidityNet"),A("liquidityGross"),A("feeGrowthOutsideX64A"),A("feeGrowthOutsideX64B"),w(A(),3,"rewardGrowthsOutsideX64"),w(Q(),13,"")]),kt=B([C(8),f("poolId"),W("startTickIndex"),w(Ln,Te,"ticks"),x("initializedTickCount"),w(x(),115,"")]),Fn=B([C(329),w(f(),100,"whitelistMints")]),Sn=B([C(8),f("poolId"),w(w(m(),8),ze,"positiveTickArrayBitmap"),w(w(m(),8),ze,"negativeTickArrayBitmap")]),Xl=B([m(),x("bump"),f("owner"),f("poolId"),f("positionId"),f("nftAccount"),w(m(),8)]),Mn=B([C(8),x("bump"),f("lockOwner"),f("poolId"),f("positionId"),f("nftAccount"),f("lockNftMint"),m("recentEpoch"),w(m(),8)]);Ct.span;var Tm=h("Raydium_Clmm");import Kt from"bn.js";import Ye from"decimal.js";var le=class{static _multipler(e){return new Ye(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Ye(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new Kt(i.mul(this._Q64).toFixed(0))}};le._Q64=new Ye(new Kt(1).shln(64).toString());var ke=class extends U{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Y(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Y(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Y(e.virtualA.mul(e.realA).toString()).div(le._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:l}){return new Y(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-l))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new Y(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new I(0)))throw Error("supplyMinusLocked need gt 0");let l=t.mul(new I(3)).sub(o),p=t.mul(new I(2)).mul(s).div(l),g=p.mul(p),d=t.mul(new I(2)).mul(_).div(g);if(!d.gt(new I(0)))throw Error("a need gt 0");if(!qe.gt(d))throw Error("a need lt u64 max");if(d.lt(new I(0))||p.lt(new I(0)))throw Error("invalid input 0");return{a:d,b:new I(0),c:p}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new I(2).mul(n).mul(_).div(e.virtualA);return new I(new Y(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return H(e.virtualA.mul(i),new I(2).mul(_)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),o=H(e.virtualA.mul(i),new I(2).mul(_));return e.realB.sub(o)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new I(2).mul(n).mul(_).div(e.virtualA),o=new I(new Y(i.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var Be=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:l,decimalA:b,decimalB:p}){if(t<3)throw Error("point count < 3");let g=this.getCurve(e),d=g.getInitParam({supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:l}),K=g.getPoolInitPriceByInit(R(S({},d),{decimalA:b,decimalB:p})),N=i.div(new F(t-1)),T=new F(0),M=[{price:K,totalSellSupply:0}],{a:E,b:V}=d,O=T,X=T;for(let j=1;j<t;j++){let Rt=j!==t-1?N:i.sub(X),je=this.buyExactIn({poolInfo:{virtualA:E,virtualB:V,realA:O,realB:X,totalFundRaisingB:i,totalSellA:o},amountB:Rt,protocolFeeRate:T,platformFeeRate:T,curveType:e,shareFeeRate:T,creatorFeeRate:T,transferFeeConfigA:void 0,slot:0});O=O.add(je.amountA.amount),X=X.add(je.amountB);let Lt=this.getPrice({poolInfo:{virtualA:E,virtualB:V,realA:O,realB:X},decimalA:b,decimalB:p,curveType:e});M.push({price:Lt,totalSellSupply:new Nt(O.toString()).div(10**b).toNumber()})}return M}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:o,config:s,migrateType:l}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(z).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new F(10**o))))throw Error("supply lt min supply");let p=e.mul(s.minSellRateA).div(z);if(n.lt(p))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let g=e.sub(n).sub(i),d=e.mul(s.minMigrateRateA).div(z);if(g.lt(d))throw Error("migrate lt min migrate amoount");let K=e.sub(n).sub(i),N=new F(new Nt(K.mul(t).toString()).sqrt().toFixed(0));if(l==="amm"){let T=new F(10).pow(new F(o));if(N.lte(T))throw Error("check migrate lp error")}else if(l==="cpmm"){let T=new F(100);if(N.lte(T))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:b,slot:p}){let g=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),d=this.calculateFee({amount:t,feeRate:g}),K=t.sub(d),N=this.getCurve(o),T=N.buyExactIn({poolInfo:e,amount:K}),M=e.totalSellA.sub(e.realA),E,V,O;if(T.gt(M)){E=M;let j=N.buyExactOut({poolInfo:e,amount:E});V=this.calculatePreFee({postFeeAmount:j,feeRate:g}),O=V.sub(j)}else E=T,V=t,O=d;let X=this.splitFee({totalFee:O,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:Oe(E,b,p),amountB:V,splitFee:X}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:b,slot:p}){let g=e.totalSellA.sub(e.realA),d=Ee(t,b,p),K=d.fee?d.amount.add(d.fee):d.amount;t.gt(g)&&(K=g);let T=this.getCurve(o).buyExactOut({poolInfo:e,amount:K}),M=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),E=this.calculatePreFee({postFeeAmount:T,feeRate:M}),V=E.sub(T),O=this.splitFee({totalFee:V,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:d,amountB:E,splitFee:O}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:b,slot:p}){let g=this.getCurve(o),d=Oe(t,b,p),K=d.fee?d.amount.sub(d.fee):d.amount,N=g.sellExactIn({poolInfo:e,amount:K}),T=this.calculateFee({amount:N,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l})}),M=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:d,amountB:N.sub(T),splitFee:M}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:l,transferFeeConfigA:b,slot:p}){let g=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l}),d=this.calculatePreFee({postFeeAmount:t,feeRate:g});if(e.realB.lt(d))throw Error("Insufficient liquidity");let K=d.sub(t),T=Be.getCurve(o).sellExactOut({poolInfo:e,amount:d});if(T.gt(e.realA))throw Error();let M=this.splitFee({totalFee:K,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:l});return{amountA:Ee(T,b,p),amountB:t,splitFee:M}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}),l=s.isZero()?new F(0):e.mul(n).div(s),b=s.isZero()?new F(0):e.mul(i).div(s),p=s.isZero()?new F(0):e.mul(o).div(s),g=e.sub(l).sub(b).sub(p);return{platformFee:l,shareFee:b,protocolFee:g,creatorFee:p}}static calculateFee({amount:e,feeRate:t}){return at(e,t,z)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(z),i=z.sub(t);return n.add(i).sub(new F(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new F(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return ge;case 1:return Ae;case 2:return ke}throw Error("find curve error")}};export{Be as Curve};
//# sourceMappingURL=curve.mjs.map