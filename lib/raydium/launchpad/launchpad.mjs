var uo=Object.defineProperty,co=Object.defineProperties;var lo=Object.getOwnPropertyDescriptors;var Et=Object.getOwnPropertySymbols;var ri=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable;var oi=(r,e,t)=>e in r?uo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_=(r,e)=>{for(var t in e||(e={}))ri.call(e,t)&&oi(r,t,e[t]);if(Et)for(var t of Et(e))si.call(e,t)&&oi(r,t,e[t]);return r},Z=(r,e)=>co(r,lo(e));var _e=(r,e)=>{var t={};for(var n in r)ri.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Et)for(var n of Et(r))e.indexOf(n)<0&&si.call(r,n)&&(t[n]=r[n]);return t};import{get as ai,set as mo}from"lodash";var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ui={},po={};function ue(r){let e=ai(ui,r);if(!e){let t=ai(po,r);e=new en({name:r,logLevel:t}),mo(ui,r,e)}return e}import{PublicKey as Qe,sendAndConfirmTransaction as Pn,SystemProgram as Go,Transaction as ht,TransactionMessage as Ee,VersionedTransaction as ve}from"@solana/web3.js";import Uo from"axios";import{PublicKey as yn,AddressLookupTableAccount as ut}from"@solana/web3.js";import{PublicKey as qo}from"@solana/web3.js";import Ce from"bn.js";import pa from"decimal.js";import wo from"big.js";import Qr from"bn.js";import fo from"toformat";var bo=fo,bt=bo;import Wt from"big.js";import go from"bn.js";import Po from"decimal.js-light";import yt from"bn.js";var ci=9007199254740991;function Ke(r){let e=ue("Raydium_parseBigNumberish");if(r instanceof yt)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new yt(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=ci||r<=-ci)&&e.logWithError(`BigNumberish number overflow: ${r}`),new yt(String(r))):typeof r=="bigint"?new yt(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new yt(0))}var vt=ue("module/fraction"),tn=bt(Wt),gt=bt(Po),Ao={[0]:gt.ROUND_DOWN,[1]:gt.ROUND_HALF_UP,[2]:gt.ROUND_UP},To={[0]:Wt.roundDown,[1]:Wt.roundHalfUp,[2]:Wt.roundUp},te=class{constructor(e,t=new go(1)){this.numerator=Ke(e),this.denominator=Ke(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new te(this.denominator,this.numerator)}add(e){let t=e instanceof te?e:new te(Ke(e));return this.denominator.eq(t.denominator)?new te(this.numerator.add(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof te?e:new te(Ke(e));return this.denominator.eq(t.denominator)?new te(this.numerator.sub(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof te?e:new te(Ke(e));return new te(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof te?e:new te(Ke(e));return new te(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<=0&&vt.logWithError(`${e} is not positive.`),gt.set({precision:e+1,rounding:Ao[n]});let i=new gt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<0&&vt.logWithError(`${e} is negative.`),tn.DP=e,tn.RM=To[n]||1,new tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ss=ue("Raydium_amount"),as=bt(wo);import{PublicKey as Bo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as li}from"@solana/spl-token";var nn={chainId:101,address:Bo.default.toBase58(),programId:li.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},qe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:li.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as sn}from"@solana/web3.js";import{PublicKey as ne,SystemProgram as mi,SYSVAR_RENT_PUBKEY as ho}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as xo}from"@solana/spl-token";function on({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var bs=[on({pubkey:xo,isWritable:!1}),on({pubkey:mi.programId,isWritable:!1}),on({pubkey:ho,isWritable:!1})];function di({publicKey:r,transformSol:e}){let t=pi(r.toString());if(t instanceof ne)return e&&t.equals(Pt)?Dt:t;if(e&&t.toString()===Pt.toBase58())return Dt;if(typeof t=="string"){if(t===ne.default.toBase58())return ne.default;try{return new ne(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function pi(r){try{return new ne(r)}catch{return r}}var Io=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),So=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),rn=new ne("SysvarRent111111111111111111111111111111111"),ys=new ne("SysvarC1ock11111111111111111111111111111111"),st=new ne("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),gs=new ne("Sysvar1nstructions1111111111111111111111111"),Ps=mi.programId,As=new ne("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ts=new ne("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ws=new ne("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ks=new ne("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Bs=new ne("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),hs=new ne("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),xs=new ne("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Is=new ne("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ss=new ne("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ks=new ne("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Cs=new ne("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Dt=new ne("So11111111111111111111111111111111111111112"),Pt=ne.default;var an=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Pt.toBase58()||e instanceof sn&&Pt.equals(e)){this.decimals=qe.decimals,this.symbol=qe.symbol,this.name=qe.name,this.mint=new sn(qe.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?sn.default:di({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ge=an;Ge.WSOL=new an(Z(_({},qe),{mint:qe.address}));var un=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Vt=un;Vt.SOL=new un(nn);import Ko from"bn.js";var _s=new te(new Ko(100));var Hs=ue("Raydium_price");var Co=new Ce(0),ka=new Ce(1),Ba=new Ce(2),ha=new Ce(3),xa=new Ce(5),ko=new Ce(10),Ia=new Ce(100),Sa=new Ce(1e3),Ka=new Ce(1e4);function fi(r,e,t){return r.mul(e).add(t).sub(new Ce(1)).div(t)}function mn(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Ne=class{constructor(e){this._owner=e}get publicKey(){return Ne.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return Ne.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return Ne.isKeyPair(this._owner)}get isPublicKey(){return Ne.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!Ne.isKeyPair(e)}};import{PublicKey as Eo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vo}from"@solana/spl-token";import{ComputeBudgetProgram as bi,Keypair as gi,PublicKey as No,Transaction as Pi,TransactionMessage as Ro,VersionedTransaction as Ai}from"@solana/web3.js";var He={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Lo}from"@solana/spl-token";var yi=ue("Raydium_txUtil"),Ti=1644;function At(r){let e=[],t=[];return r.microLamports&&(e.push(bi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(He.SetComputeUnitPrice)),r.units&&(e.push(bi.setComputeUnitLimit({units:r.units})),t.push(He.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ye(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function Tt(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,o=>{if(clearTimeout(i),!o.err){t("");return}n(Object.assign(o.err,{txId:e}))},"confirmed")})}function Fo(r,e){r.length<1&&yi.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&yi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Pi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ti}catch{return!1}}function me(r,e){let[t,n]=No.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function wt({instructions:r,payer:e,signers:t}){return Fo(r,[e,...t])}function Oe({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=gi.generate().publicKey.toString()}){let o=new Ro({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ai(o).serialize()).toString("base64").length<Ti}catch{return!1}}var Mo=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Oo=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Ai&&(e=Mo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Ue(r){let e=[];return r.forEach(t=>{t instanceof Pi&&(t.recentBlockhash||(t.recentBlockhash=Lo.toBase58()),t.feePayer||(t.feePayer=gi.generate().publicKey)),e.push(Oo(t))}),console.log("simulate tx string:",e),e}function Pe(r,e,t){return me([r.toBuffer(),(t!=null?t:vo).toBuffer(),e.toBuffer()],new Eo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var ja=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Za=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Qa=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ja=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),$a=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),eu=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),tu=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),nu=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),iu=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ou=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Wo=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Do=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Vo=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ru=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),su=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),au=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),uu=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),cu=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),lu=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),mu=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),du=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),pu=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),fu=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),bu=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),yu=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),re=new O("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),gu=new O("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Pu=new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Au=new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Tu=new O("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),wu=new O("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ku={OPEN_BOOK_PROGRAM:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O("Ray1111111111111111111111111111111111111111"),AMM_V4:new O("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.default,Router:new O("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O("Ray1111111111111111111111111111111111111111")};import ce from"bn.js";var kt=1e4;function dn(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new ce(0))?t.add(new ce(1)):t}function je(r,e){if(r.isZero())return new ce(0);let t=r.div(e);return t.isZero()?new ce(1):r.mod(e).gt(new ce(0))?t.add(new ce(1)):t}function pn(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ce(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=dn(r.mul(new ce(i.transferFeeBasisPoints)),new ce(kt)),c=a.gt(o)?o:a;return{amount:r,fee:c,expirationTime:s}}function fn(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ce(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===kt){let a=new ce(i.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=dn(r.mul(new ce(kt)),new ce(kt-i.transferFeeBasisPoints)),c=new ce(i.maximumFee.toString()),u=a.sub(r).gt(c)?r.add(c):a,p=dn(u.mul(new ce(i.transferFeeBasisPoints)),new ce(kt)),m=p.gt(o)?o:p;return{amount:u,fee:m,expirationTime:s}}}import{PublicKey as Su}from"@solana/web3.js";import Cu from"bn.js";import _o from"bn.js";var Ze=new _o(1e6);import{MINT_SIZE as ac,TOKEN_PROGRAM_ID as uc,getTransferFeeConfig as cc,unpackMint as lc}from"@solana/spl-token";var bn=ue("Raydium_accountInfo_util");async function Bt(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=_({batchRequest:!1},t),s=mn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let T=r._buildArgs([m.map(P=>P.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:T}}),u=mn(c,10);a=(await(await Promise.all(u.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(T=>{if(T){let{data:P,executable:l,lamports:b,owner:f,rentEpoch:h}=T;return P.length!==2&&P[1]!=="base64"&&bn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:l,lamports:b,owner:new qo(f),rentEpoch:h}}return null})))}else try{a=await Promise.all(s.map(c=>r.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Re(r,e,t){let n=await Bt(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>Z(_({},i),{accountInfo:n[o]}))}async function qt({connection:r,address:e,cluster:t="mainnet"}){let n=await Bt(r,[...new Set(e.map(o=>o.toString()))].map(o=>new yn(o))),i={};for(let o=0;o<e.length;o++){let s=n[o],a=e[o];if(!s)continue;let c=new ut({key:a,state:ut.deserialize(s.data)});i[a.toString()]=c,t==="devnet"?at[a.toString()]=c:Xe[a.toString()]=c}return i}var Xe={},gn=async r=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(Xe[e])return Xe;let t=new yn(e),n=await r.getAccountInfo(t);return n&&(Xe[e]=new ut({key:t,state:ut.deserialize(n.data)})),Xe},at={},Gt=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(at[e])return at;let t=new yn(e),n=await r.getAccountInfo(t);return n&&(at[e]=new ut({key:t,state:ut.deserialize(n.data)})),at};var xt=2e3,It=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Uo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=At(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Go.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Qe(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(He.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Qe.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(_({},t||{})):this.build(t)}build(e){var n;let t=new ht;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var p;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=i||{},u=o!=null?o:await Ye(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Ue([t]),(p=this.owner)!=null&&p.isKeyPair)return{txId:a?await Pn(this.connection,t,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let T of m)try{T.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(p=>p.transaction.instructions.length>0),s=[i,...o.map(p=>p.transaction)],a=[this.signers,...o.map(p=>p.signers)],c=[...this.instructionTypes,...o.map(p=>p.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(p=>{p.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async p=>{var h;let{sequentially:m,onTxUpdate:T,skipTxCount:P=0,recentBlockHash:l,skipPreflight:b=!0}=p||{},f=l!=null?l:await Ye(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(m){let y=[],I=0;for(let w of s){if(++I,I<=P)continue;let d=await Pn(this.connection,w,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});y.push(d)}return{txIds:y,signedTxs:s}}return{txIds:await await Promise.all(s.map(async y=>(y.recentBlockhash=f,await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:b})))),signedTxs:s}}if(this.signAllTransactions){let y=s.map((w,d)=>(w.recentBlockhash=f,a[d].length&&w.sign(...a[d]),w));Ue(y);let I=await this.signAllTransactions(y);if(m){let w=0,d=[],A=async()=>{if(!I[w])return;let x=await this.connection.sendRawTransaction(I[w].serialize(),{skipPreflight:b});d.push({txId:x,status:"sent",signedTx:I[w]}),T==null||T([...d]),w++;let k=!1,S=null,C=null,L=B=>{S!==null&&clearInterval(S),C!==null&&this.connection.removeSignatureListener(C);let R=d.findIndex(N=>N.txId===x);if(R>-1){if(d[R].status==="error"||d[R].status==="success")return;d[R].status=B.err?"error":"success"}T==null||T([...d]),B.err||A()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var B;if(k){clearInterval(S);return}try{let R=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(k=!0,clearInterval(S),L({err:((B=R.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",x))}catch(R){k=!0,clearInterval(S),console.error("getTransaction timeout:",R,x)}},xt)),C=this.connection.onSignature(x,B=>{if(k){this.connection.removeSignatureListener(C);return}k=!0,L(B)},"confirmed"),this.connection.getSignatureStatus(x)};return await A(),{txIds:d.map(x=>x.txId),signedTxs:I}}else{let w=[];for(let d=0;d<I.length;d+=1){let A=await this.connection.sendRawTransaction(I[d].serialize(),{skipPreflight:b});w.push(A)}return{txIds:w,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var b;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:o}=l,s=_e(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=_(_({},this.cluster==="devnet"?await Gt(this.connection):await gn(this.connection)),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let f of c)a[f]===void 0&&u.push(new Qe(f));let p=await qt({connection:this.connection,address:u});for(let[f,h]of Object.entries(p))a[f]=h;let m=i?Qe.default.toBase58():o!=null?o:await Ye(this.connection,this.blockhashCommitment),T=new Ee({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(f=>f.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new ve(T);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{var w;let{skipPreflight:h=!0,sendAndConfirm:y,notSendToRpc:I}=f||{};if(Ue([P]),(w=this.owner)!=null&&w.isKeyPair){let d=await this.connection.sendTransaction(P,{skipPreflight:h});return y&&await Tt(this.connection,d),{txId:d,signedTx:P}}if(this.signAllTransactions){let d=await this.signAllTransactions([P]);if(this.signers.length)for(let A of d)try{A.sign(this.signers)}catch{}return{txId:I?"":await this.connection.sendTransaction(d[0],{skipPreflight:h}),signedTx:d[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(p=>p.builder.instructions.length>0),s=[i,...o.map(p=>p.transaction)],a=[this.signers,...o.map(p=>p.signers)],c=[...this.instructionTypes,...o.map(p=>p.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(p=>{p.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(p,m)=>{p.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async p=>{var b;let{sequentially:m,onTxUpdate:T,recentBlockHash:P,skipPreflight:l=!0}=p||{};if(P&&s.forEach(f=>f.message.recentBlockhash=P),Ue(s),(b=this.owner)!=null&&b.isKeyPair){if(m){let f=[];for(let h of s){let y=await this.connection.sendTransaction(h,{skipPreflight:l});await Tt(this.connection,y),f.push(y)}return{txIds:f,signedTxs:s}}return{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f,{skipPreflight:l}))),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let h=0,y=[],I=async()=>{if(!f[h])return;let w=await this.connection.sendTransaction(f[h],{skipPreflight:l});y.push({txId:w,status:"sent",signedTx:f[h]}),T==null||T([...y]),h++;let d=!1,A=null,x=null,k=S=>{A!==null&&clearInterval(A),x!==null&&this.connection.removeSignatureListener(x);let C=y.findIndex(L=>L.txId===w);if(C>-1){if(y[C].status==="error"||y[C].status==="success")return;y[C].status=S.err?"error":"success"}T==null||T([...y]),S.err||I()};this.loopMultiTxStatus&&(A=setInterval(async()=>{var S;if(d){clearInterval(A);return}try{let C=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(d=!0,clearInterval(A),k({err:((S=C.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",w))}catch(C){d=!0,clearInterval(A),console.error("getTransaction timeout:",C,w)}},xt)),x=this.connection.onSignature(w,S=>{if(d){this.connection.removeSignatureListener(x);return}d=!0,k(S)},"confirmed"),this.connection.getSignatureStatus(w)};return I(),{txIds:[],signedTxs:f}}else{let h=[];for(let y=0;y<f.length;y+=1){let I=await this.connection.sendTransaction(f[y],{skipPreflight:l});h.push(I)}return{txIds:h,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var T;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=_e(m,["splitIns","computeBudgetConfig"]),o=n?At(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((P,l)=>Z(_({},P),{[l.publicKey.toBase58()]:l}),{}),a=[],c=[],u=[],p=0;if(this.allInstructions.forEach(P=>{let l=[...u,P],b=n?[...o.instructions,...l]:l,h=[...new Set(l.map(y=>y.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(y=>new Qe(y));if(P!==t[p]&&u.length<12&&(wt({instructions:b,payer:this.feePayer,signers:h})||wt({instructions:l,payer:this.feePayer,signers:h})))u.push(P);else{if(u.length===0)throw Error("item ins too big");p+=P===t[p]?1:0,wt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:h})?a.push(new ht().add(...o.instructions,...u)):a.push(new ht().add(...u)),c.push(Array.from(new Set(u.map(y=>y.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(y=>s[y]).filter(y=>y!==void 0)),u=[P]}}),u.length>0){let l=[...new Set(u.map(b=>b.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(b=>s[b]).filter(b=>b!==void 0);wt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:l.map(b=>b.publicKey)})?a.push(new ht().add(...o.instructions,...u)):a.push(new ht().add(...u)),c.push(l)}return a.forEach(P=>P.feePayer=this.feePayer),(T=this.owner)!=null&&T.signer&&c.forEach(P=>{P.some(l=>l.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async P=>{var w;let{sequentially:l,onTxUpdate:b,skipTxCount:f=0,recentBlockHash:h,skipPreflight:y=!0}=P||{},I=h!=null?h:await Ye(this.connection,this.blockhashCommitment);if(a.forEach(async(d,A)=>{d.recentBlockhash=I,c[A].length&&d.sign(...c[A])}),Ue(a),(w=this.owner)!=null&&w.isKeyPair){if(l){let d=0,A=[];for(let x of a){if(++d,d<=f){A.push("tx skipped");continue}let k=await Pn(this.connection,x,this.signers.find(S=>S.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});A.push(k)}return{txIds:A,signedTxs:a}}return{txIds:await Promise.all(a.map(async d=>await this.connection.sendRawTransaction(d.serialize(),{skipPreflight:y}))),signedTxs:a}}if(this.signAllTransactions){let d=await this.signAllTransactions(a.slice(f,a.length)),A=[...a.slice(0,f),...d];if(l){let x=0,k=[],S=async()=>{if(!A[x])return;x<f&&(k.push({txId:"",status:"success",signedTx:A[x]}),b==null||b([...k]),x++,S());let C=await this.connection.sendRawTransaction(A[x].serialize(),{skipPreflight:y});k.push({txId:C,status:"sent",signedTx:A[x]}),b==null||b([...k]),x++;let L=!1,B=null,R=null,N=K=>{B!==null&&clearInterval(B),R!==null&&this.connection.removeSignatureListener(R);let E=k.findIndex(G=>G.txId===C);if(E>-1){if(k[E].status==="error"||k[E].status==="success")return;k[E].status=K.err?"error":"success"}b==null||b([...k]),K.err||S()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var K;if(L){clearInterval(B);return}try{let E=await this.connection.getTransaction(C,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(L=!0,clearInterval(B),N({err:((K=E.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",C))}catch(E){L=!0,clearInterval(B),console.error("getTransaction timeout:",E,C)}},xt)),R=this.connection.onSignature(C,K=>{if(L){this.connection.removeSignatureListener(R);return}L=!0,N(K)},"confirmed"),this.connection.getSignatureStatus(C)};return await S(),{txIds:k.map(C=>C.txId),signedTxs:A}}else{let x=[];for(let k=0;k<A.length;k+=1){let S=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:y});x.push(S)}return{txIds:x,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var I;let y=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:o=[]}=y,s=_e(y,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await Gt(this.connection):Xe),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let w of c)a[w]===void 0&&u.push(new Qe(w));let p=await qt({connection:this.connection,address:u});for(let[w,d]of Object.entries(p))a[w]=d;let m=t?At(t):{instructions:[],instructionTypes:[]},T=await Ye(this.connection,this.blockhashCommitment),P=this.signers.reduce((w,d)=>Z(_({},w),{[d.publicKey.toBase58()]:d}),{}),l=[],b=[],f=[],h=0;if(this.allInstructions.forEach(w=>{let d=[...f,w],A=t?[...m.instructions,...d]:d;if(w!==n[h]&&f.length<12&&(Oe({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||Oe({instructions:d,payer:this.feePayer,lookupTableAddressAccount:a})))f.push(w);else{if(f.length===0)throw Error("item ins too big");h+=w===n[h]?1:0;let x={};for(let k of[...new Set(c)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Oe({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));l.push(new ve(k))}else{let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...f]}).compileToV0Message(Object.values(a));l.push(new ve(k))}b.push(Array.from(new Set(f.map(k=>k.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(k=>P[k]).filter(k=>k!==void 0)),f=[w]}}),f.length>0){let d=[...new Set(f.map(A=>A.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(A=>P[A]).filter(A=>A!==void 0);if(t&&Oe({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));l.push(new ve(A))}else{let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...f]}).compileToV0Message(Object.values(a));l.push(new ve(A))}b.push(d)}return(I=this.owner)!=null&&I.signer&&b.forEach(w=>{w.some(d=>d.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,d)=>{w.sign(b[d])}),{builder:this,transactions:l,buildProps:e,signers:b,blockHash:T,instructionTypes:this.instructionTypes,execute:async w=>{var C;let{sequentially:d,onTxUpdate:A,skipTxCount:x=0,recentBlockHash:k,skipPreflight:S=!0}=w||{};if(l.map(async(L,B)=>{b[B].length&&L.sign(b[B]),k&&(L.message.recentBlockhash=k)}),Ue(l),(C=this.owner)!=null&&C.isKeyPair){if(d){let L=0,B=[];for(let R of l){if(++L,L<=x){console.log("skip tx: ",L),B.push("tx skipped");continue}let N=await this.connection.sendTransaction(R,{skipPreflight:S});await Tt(this.connection,N),B.push(N)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:S}))),signedTxs:l}}if(this.signAllTransactions){let L=await this.signAllTransactions(l.slice(x,l.length)),B=[...l.slice(0,x),...L];if(d){let R=0,N=[],K=async()=>{if(!B[R])return;if(R<x){N.push({txId:"",status:"success",signedTx:B[R]}),A==null||A([...N]),R++,K();return}let E=await this.connection.sendTransaction(B[R],{skipPreflight:S});N.push({txId:E,status:"sent",signedTx:B[R]}),A==null||A([...N]),R++;let G=!1,U=null,X=null,z=Q=>{U!==null&&clearInterval(U),X!==null&&this.connection.removeSignatureListener(X);let H=N.findIndex(oe=>oe.txId===E);if(H>-1){if(N[H].status==="error"||N[H].status==="success")return;N[H].status=Q.err?"error":"success"}A==null||A([...N]),Q.err||K()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var Q;if(G){clearInterval(U);return}try{let H=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});H&&(G=!0,clearInterval(U),z({err:((Q=H.meta)==null?void 0:Q.err)||null}),console.log("tx status from getTransaction:",E))}catch(H){G=!0,clearInterval(U),console.error("getTransaction timeout:",H,E)}},xt)),X=this.connection.onSignature(E,Q=>{if(G){this.connection.removeSignatureListener(X);return}G=!0,z(Q)},"confirmed"),this.connection.getSignatureStatus(E)};return K(),{txIds:[],signedTxs:B}}else{let R=[];for(let N=0;N<B.length;N+=1){let K=await this.connection.sendTransaction(B[N],{skipPreflight:S});R.push(K)}return{txIds:R,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildSniperTransaction(e){var I;let y=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:o=[]}=y,s=_e(y,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await Gt(this.connection):await gn(this.connection)),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let w of c)a[w]===void 0&&u.push(new Qe(w));let p=await qt({connection:this.connection,address:u});for(let[w,d]of Object.entries(p))a[w]=d;let m=t?At(t):{instructions:[],instructionTypes:[]},T=await Ye(this.connection,this.blockhashCommitment),P=this.signers.reduce((w,d)=>Z(_({},w),{[d.publicKey.toBase58()]:d}),{}),l=[],b=[],f=[],h=0;if(this.allInstructions.forEach(w=>{let d=[...f,w],A=t?[...m.instructions,...d]:d;if(w!==n[h]&&f.length<12&&(Oe({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||Oe({instructions:d,payer:this.feePayer,lookupTableAddressAccount:a})))f.push(w);else{if(f.length===0)throw Error("item ins too big");h+=w===n[h]?1:0;let x={};for(let k of[...new Set(c)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Oe({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));l.push(new ve(k))}else{let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...f]}).compileToV0Message(Object.values(a));l.push(new ve(k))}b.push(Array.from(new Set(f.map(k=>k.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(k=>P[k]).filter(k=>k!==void 0)),f=[w]}}),f.length>0){let d=[...new Set(f.map(A=>A.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(A=>P[A]).filter(A=>A!==void 0);if(t&&Oe({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));l.push(new ve(A))}else{let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...f]}).compileToV0Message(Object.values(a));l.push(new ve(A))}b.push(d)}return(I=this.owner)!=null&&I.signer&&b.forEach(w=>{w.some(d=>d.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,d)=>{w.sign(b[d])}),{builder:this,transactions:l,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async w=>{var C;let{sequentially:d,onTxUpdate:A,skipTxCount:x=0,recentBlockHash:k,skipPreflight:S=!0}=w||{};if(l.map(async(L,B)=>{b[B].length&&L.sign(b[B]),k&&(L.message.recentBlockhash=k)}),Ue(l),(C=this.owner)!=null&&C.isKeyPair){if(d){let L=0,B=[];for(let R of l){if(++L,L<=x){console.log("skip tx: ",L),B.push("tx skipped");continue}let N=await this.connection.sendTransaction(R,{skipPreflight:S});await Tt(this.connection,N),B.push(N)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:S}))),signedTxs:l}}if(this.signAllTransactions){let L=await this.signAllTransactions(l.slice(x,l.length)),B=[...l.slice(0,x),...L];if(d){let R=0,N=[],K=async()=>{if(!B[R])return;if(R<x){N.push({txId:"",status:"success",signedTx:B[R]}),A==null||A([...N]),R++,K();return}let E=await this.connection.sendTransaction(B[R],{skipPreflight:S});N.push({txId:E,status:"sent",signedTx:B[R]}),A==null||A([...N]),R++;let G=!1,U=null,X=null,z=Q=>{U!==null&&clearInterval(U),X!==null&&this.connection.removeSignatureListener(X);let H=N.findIndex(oe=>oe.txId===E);if(H>-1){if(N[H].status==="error"||N[H].status==="success")return;N[H].status=Q.err?"error":"success"}A==null||A([...N]),Q.err||K()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var Q;if(G){clearInterval(U);return}try{let H=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});H&&(G=!0,clearInterval(U),z({err:((Q=H.meta)==null?void 0:Q.err)||null}),console.log("tx status from getTransaction:",E))}catch(H){G=!0,clearInterval(U),console.error("getTransaction timeout:",H,E)}},xt)),X=this.connection.onSignature(E,Q=>{if(G){this.connection.removeSignatureListener(X);return}G=!0,z(Q)},"confirmed"),this.connection.getSignatureStatus(E)};return K(),{txIds:[],signedTxs:B}}else{let R=[];for(let N=0;N<B.length;N+=1){let K=await this.connection.sendTransaction(B[N],{skipPreflight:S});R.push(K)}return{txIds:R,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var An=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ct=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ue(t)}createTxBuilder(e){return this.scope.checkOwner(),new It({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new Ne(e);return new It({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(An(e))}logInfo(...e){this.logger.info(An(e))}logAndCreateError(...e){let t=An(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Bp}from"@solana/web3.js";import xp from"bn.js";import Sp from"decimal.js";import{AccountLayout as Np,createAssociatedTokenAccountIdempotentInstruction as Rp,TOKEN_2022_PROGRAM_ID as Lp,TOKEN_PROGRAM_ID as Fp}from"@solana/spl-token";import{PublicKey as vc}from"@solana/web3.js";import{MintLayout as Dc,TOKEN_PROGRAM_ID as _c}from"@solana/spl-token";import{Keypair as Hd,PublicKey as Yd,SystemProgram as Zd,TransactionInstruction as Qd}from"@solana/web3.js";import $d from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as np,TOKEN_2022_PROGRAM_ID as ip,TOKEN_PROGRAM_ID as op}from"@solana/spl-token";import{PublicKey as tr}from"@solana/web3.js";import Ii,{isBN as Si}from"bn.js";import{bits as Yc,BitStructure as jc,blob as Xo,Blob as Zc,cstr as Qc,f32 as Jc,f32be as $c,f64 as el,f64be as tl,greedy as nl,Layout as zo,ns64 as il,ns64be as ol,nu64 as rl,nu64be as sl,offset as Ho,s16 as al,s16be as ul,s24 as cl,s24be as ll,s32 as Yo,s32be as ml,s40 as dl,s40be as pl,s48 as fl,s48be as bl,s8 as yl,seq as jo,struct as gl,Structure as Zo,u16 as Qo,u16be as Pl,u24 as Al,u24be as Tl,u32 as Jo,u32be as wl,u40 as kl,u40be as Bl,u48 as hl,u48be as xl,u8 as $o,UInt as er,union as Il,Union as Sl,unionLayoutDiscriminator as Kl,utf8 as Cl}from"@solana/buffer-layout";var Tn=zo,Bi=Zo;var wn=er;var hi=$o,We=Qo;var kn=Jo;var De=Yo;var xi=jo;var de=Xo;var Bn=Ho;var lt=class extends Tn{constructor(t,n,i){super(t,i);this.blob=de(t),this.signed=n}decode(t,n=0){let i=new Ii(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Ii(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function D(r){return new wn(1,r)}function mt(r){return new wn(4,r)}function g(r){return new lt(8,!1,r)}function ie(r){return new lt(16,!1,r)}function Ki(r){return new lt(8,!0,r)}function Ci(r){return new lt(16,!0,r)}var Je=class extends Tn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function v(r){return new Je(de(32),e=>new tr(e),e=>e.toBuffer(),r)}function xn(r){return new Je(hi(),nr,ir,r)}function nr(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function ir(r){return r?1:0}function Ni(r,e){let t=kn("length"),n=V([t,Y(r,Bn(t,-t.span),"values")]);return new Je(n,({values:i})=>i,i=>({values:i}),e)}function or(r){let e=kn("length"),t=V([e,de(Bn(e,-e.span),"data")]);return new Je(t,({data:n})=>n,n=>({data:n}),r)}function pe(r){return new Je(or(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),r)}var hn=class extends Bi{decode(e,t){return super.decode(e,t)}};function V(r,e,t){return new hn(r,e,t)}function Y(r,e,t){let n,i=typeof e=="number"?e:Si(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Si(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return xi(r,i,t)}import Id from"bn.js";import Kd from"decimal.js";import Ae from"bn.js";var In=new Ae(0),Ri=new Ae(1),Li=new Ae(-1),Le=new Ae(1).shln(64),Fi=new Ae(1).shln(128),Sn=Le.sub(Ri);var rr=Fi.subn(1),dt=-443636,St=-dt,Kn=new Ae("4295048016"),Cn=new Ae("79226673521066979257578248091"),_l=new Ae("4295048017"),ql=new Ae("79226673521066979257578248090");var sr=new Ae(10).pow(new Ae(6));var Gl=new Ae("18446744073700000000");import md from"bn.js";import pd from"decimal.js";var jl=Buffer.from("amm_config","utf8"),Mi=Buffer.from("pool","utf8"),Oi=Buffer.from("pool_vault","utf8"),Zl=Buffer.from("pool_reward_vault","utf8"),Ql=Buffer.from("position","utf8"),Jl=Buffer.from("tick_array","utf8"),$l=Buffer.from("operation","utf8"),em=Buffer.from("pool_tick_array_bitmap_extension","utf8"),tm=Buffer.from("observation","utf8");function Nn(r){return me([Buffer.from("metadata","utf8"),st.toBuffer(),r.toBuffer()],st)}var nm=Buffer.from("locked_position","utf8");var im=Buffer.from("support_mint","utf8");import{PublicKey as vm}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Dm}from"@solana/spl-token";import _m from"bn.js";import Gm from"decimal.js";import sm from"bn.js";import um from"decimal.js";var Fn=14;var Ut=60;var mr=V([de(8),D("bump"),We("index"),v(""),mt("protocolFeeRate"),mt("tradeFeeRate"),We("tickSpacing"),Y(g(),8,"")]),dr=V([mt("blockTimestamp"),Ki("tickCumulative"),Y(g(),4)]),Xi=V([de(8),xn("initialized"),g("recentEpoch"),We("observationIndex"),v("poolId"),Y(dr,100,"observations"),Y(g(),4)]),pr=V([D("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),ie("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),v("tokenMint"),v("tokenVault"),v("creator"),ie("rewardGrowthGlobalX64")]),qi=V([de(8),D("bump"),v("ammConfig"),v("creator"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("observationId"),D("mintDecimalsA"),D("mintDecimalsB"),We("tickSpacing"),ie("liquidity"),ie("sqrtPriceX64"),De("tickCurrent"),mt(),ie("feeGrowthGlobalX64A"),ie("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),ie("swapInAmountTokenA"),ie("swapOutAmountTokenB"),ie("swapInAmountTokenB"),ie("swapOutAmountTokenA"),D("status"),Y(D(),7,""),Y(pr,3,"rewardInfos"),Y(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),Y(g(),15*4-3,"padding")]),fr=V([ie("growthInsideLastX64"),g("rewardAmountOwed")]),Gi=V([de(8),D("bump"),v("nftMint"),v("poolId"),De("tickLower"),De("tickUpper"),ie("liquidity"),ie("feeGrowthInsideLastX64A"),ie("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Y(fr,3,"rewardInfos"),Y(g(),8,"")]),vd=V([de(8),D("bump"),v("poolId"),De("tickLowerIndex"),De("tickUpperIndex"),ie("liquidity"),ie("feeGrowthInsideLastX64A"),ie("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Y(ie(),3,"rewardGrowthInside"),Y(g(),8,"")]),br=V([De("tick"),Ci("liquidityNet"),ie("liquidityGross"),ie("feeGrowthOutsideX64A"),ie("feeGrowthOutsideX64B"),Y(ie(),3,"rewardGrowthsOutsideX64"),Y(mt(),13,"")]),Di=V([de(8),v("poolId"),De("startTickIndex"),Y(br,Ut,"ticks"),D("initializedTickCount"),Y(D(),115,"")]),yr=V([de(329),Y(v(),100,"whitelistMints")]),lr=V([de(8),v("poolId"),Y(Y(g(),8),Fn,"positiveTickArrayBitmap"),Y(Y(g(),8),Fn,"negativeTickArrayBitmap")]),Wd=V([g(),D("bump"),v("owner"),v("poolId"),v("positionId"),v("nftAccount"),Y(g(),8)]),gr=V([de(8),D("bump"),v("lockOwner"),v("poolId"),v("positionId"),v("nftAccount"),v("lockNftMint"),g("recentEpoch"),Y(g(),8)]);Xi.span;var pp=ue("Raydium_Clmm");var wr=Buffer.from("vault_auth_seed","utf8"),Af=Buffer.from("global_config","utf8"),kr=Buffer.from("pool_vesting","utf8"),Br=Buffer.from("platform_config","utf8"),hr=Buffer.from("platform_fee_vault_auth_seed","utf8"),xr=Buffer.from("creator_fee_vault_auth_seed","utf8");function xe(r){return me([wr],r)}function $e(r,e,t){return me([Mi,e.toBuffer(),t.toBuffer()],r)}function Mn(r,e,t){return me([Oi,e.toBuffer(),t.toBuffer()],r)}function et(r){return me([Buffer.from("__event_authority","utf8")],r)}function On(r,e){return me([Br,e.toBuffer()],r)}function Nt(r,e,t){return me([kr,e.toBuffer(),t.toBuffer()],r)}function tt(r,e,t){return me([e.toBuffer(),t.toBuffer()],r)}function En(r){return me([hr],r)}function nt(r,e,t){return me([e.toBuffer(),t.toBuffer()],r)}function vn(r){return me([xr],r)}import{ASSOCIATED_TOKEN_PROGRAM_ID as Xt,TOKEN_2022_PROGRAM_ID as Kr,TOKEN_PROGRAM_ID as Wn}from"@solana/spl-token";import{SystemProgram as we,TransactionInstruction as be}from"@solana/web3.js";import pt from"bn.js";var Ve=V([g(),g("epoch"),D("curveType"),We("index"),g("migrateFee"),g("tradeFeeRate"),g("maxShareFeeRate"),g("minSupplyA"),g("maxLockRate"),g("minSellRateA"),g("minMigrateRateA"),g("minFundRaisingB"),v("mintB"),v("protocolFeeOwner"),v("migrateFeeOwner"),v("migrateToAmmWallet"),v("migrateToCpmmWallet"),Y(g(),16)]),Ir=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),g("startTime"),g("totalAllocatedShare")]),Te=V([g(),g("epoch"),D("bump"),D("status"),D("mintDecimalsA"),D("mintDecimalsB"),D("migrateType"),g("supply"),g("totalSellA"),g("virtualA"),g("virtualB"),g("realA"),g("realB"),g("totalFundRaisingB"),g("protocolFee"),g("platformFee"),g("migrateFee"),Ir.replicate("vestingSchedule"),v("configId"),v("platformId"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("creator"),D("mintProgramFlag"),D("cpmmCreatorFeeOn"),Y(D(),62)]),kf=V([g(),g("epoch"),v("poolId"),v("beneficiary"),g("claimedAmount"),g("tokenShareAmount"),Y(g(),8)]),zi=V([D("migrateType"),D("migrateCpmmFeeOn"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod")]),Sr=V([g("epoch"),D("index"),v("configId"),zi.replicate("bondingCurveParam"),Y(g(),50)]),it=V([g(),g("epoch"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),Y(D(),64,"name"),Y(D(),256,"web"),Y(D(),256,"img"),v("cpConfigId"),g("creatorFeeRate"),v("transferFeeExtensionAuth"),Y(D(),180),Ni(Sr,"platformCurve")]);var ye={initialize:Buffer.from([175,175,109,31,13,152,155,237]),initializeV2:Buffer.from([67,153,175,39,218,16,38,32]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252]),updatePlatformCurveParam:Buffer.from([138,144,138,250,220,128,4,57]),removePlatformCurveParam:Buffer.from([27,30,62,169,93,224,24,145])};function Hi(r,e,t,n,i,o,s,a,c,u,p,m,T,P,l,b,f,h,y,I,w){let d=V([D("decimals"),pe("name"),pe("symbol"),pe("uri")]),A=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),D("cpmmCreatorFeeOn")]),x=V([D("index"),g("supply"),g("totalFundRaisingB"),D("migrateType")]),k=V([D("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),D("migrateType")]),S=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:rn,isSigner:!1,isWritable:!1},{pubkey:et(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(P,"utf-8").length+Buffer.from(l,"utf-8").length+Buffer.from(b,"utf-8").length+4*3+1),L=Buffer.alloc(A.span),B=Buffer.alloc(f.type==="ConstantCurve"?k.span:x.span);return d.encode({decimals:T,name:P,symbol:l,uri:b},C),f.type==="ConstantCurve"?k.encode(Z(_({index:0},f),{migrateType:f.migrateType==="amm"?0:1}),B):f.type==="FixedCurve"?x.encode(Z(_({index:1},f),{migrateType:f.migrateType==="amm"?0:1}),B):f.type==="LinearCurve"&&x.encode(Z(_({index:2},f),{migrateType:f.migrateType==="amm"?0:1}),B),A.encode({totalLockedAmount:h,cliffPeriod:y,unlockPeriod:I,cpmmCreatorFeeOn:w},L),new be({keys:S,programId:r,data:Buffer.from([...ye.initializeV2,...C,...B,...L])})}function Yi(r,e,t,n,i,o,s,a,c,u,p,m,T,P,l,b,f,h,y,I,w){let d=V([D("decimals"),pe("name"),pe("symbol"),pe("uri")]),A=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),D("cpmmCreatorFeeOn"),D("transferFeeExtensionParamsOption"),V([We("transferFeeBasePoints"),g("maxinumFee")]).replicate("transferFeeExtensionParams")]),x=V([D("index"),g("supply"),g("totalFundRaisingB"),D("migrateType")]),k=V([D("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),D("migrateType")]),S=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Kr,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:et(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(T,"utf-8").length+Buffer.from(P,"utf-8").length+Buffer.from(l,"utf-8").length+4*3+1),L=Buffer.alloc(A.span),B=Buffer.alloc(b.type==="ConstantCurve"?k.span:x.span);return d.encode({decimals:m,name:T,symbol:P,uri:l},C),b.type==="ConstantCurve"?k.encode(Z(_({index:0},b),{migrateType:b.migrateType==="amm"?0:1}),B):b.type==="FixedCurve"?x.encode(Z(_({index:1},b),{migrateType:b.migrateType==="amm"?0:1}),B):b.type==="LinearCurve"&&x.encode(Z(_({index:2},b),{migrateType:b.migrateType==="amm"?0:1}),B),A.encode({totalLockedAmount:f,cliffPeriod:h,unlockPeriod:y,cpmmCreatorFeeOn:I,transferFeeExtensionParamsOption:w?1:0,transferFeeExtensionParams:w!=null?w:{transferFeeBasePoints:0,maxinumFee:new pt(0)}},L),new be({keys:S,programId:r,data:Buffer.from([...ye.initializeWithToken2022,...C,...B,...L])})}function ji(r,e,t,n,i,o,s,a,c,u,p,m,T,P,l,b,f,h,y,I){let w=V([g("amountB"),g("minAmountA"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:et(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:l,isSigner:!1,isWritable:!0}),d.push({pubkey:b,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountB:f,minAmountA:h,shareFeeRate:y!=null?y:new pt(0)},A),new be({keys:d,programId:r,data:Buffer.from([...ye.buyExactIn,...A])})}function Zi(r,e,t,n,i,o,s,a,c,u,p,m,T,P,l,b,f,h,y,I){let w=V([g("amountA"),g("maxAmountB"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:et(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:l,isSigner:!1,isWritable:!0}),d.push({pubkey:b,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountA:f,maxAmountB:h,shareFeeRate:y!=null?y:new pt(0)},A),new be({keys:d,programId:r,data:Buffer.from([...ye.buyExactOut,...A])})}function Qi(r,e,t,n,i,o,s,a,c,u,p,m,T,P,l,b,f,h,y,I){let w=V([g("amountA"),g("minAmountB"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:et(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:l,isSigner:!1,isWritable:!0}),d.push({pubkey:b,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountA:f,minAmountB:h,shareFeeRate:y!=null?y:new pt(0)},A),new be({keys:d,programId:r,data:Buffer.from([...ye.sellExactIn,...A])})}function Ji(r,e,t,n,i,o,s,a,c,u,p,m,T,P,l,b,f,h,y,I){let w=V([g("amountB"),g("maxAmountA"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:et(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:l,isSigner:!1,isWritable:!0}),d.push({pubkey:b,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountB:f,maxAmountA:h,shareFeeRate:y!=null?y:new pt(0)},A),new be({keys:d,programId:r,data:Buffer.from([...ye.sellExactOut,...A])})}function Dn(r,e,t,n,i,o,s,a,c){let u=V([]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new be({keys:p,programId:r,data:Buffer.from([...ye.claimVestedToken,...m])})}function Vn(r,e,t,n,i,o){let s=V([g("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:o},c),new be({keys:a,programId:r,data:Buffer.from([...ye.createVestingAccount,...c])})}function _n(r,e,t,n,i,o,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!0},{pubkey:Xt,isSigner:!1,isWritable:!0}];return new be({keys:u,programId:r,data:ye.claimPlatformFee})}function $i(r,e,t,n,i,o,s,a,c,u,p,m,T){let P=V([g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),pe("name"),pe("web"),pe("img"),g("creatorFeeRate")]),l=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],b=Buffer.alloc(8*5+Buffer.from(p,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(T,"utf-8").length+4*3);return P.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:c,name:p,web:m,img:T,creatorFeeRate:u},b),new be({keys:l,programId:r,data:Buffer.from([...ye.createPlatformConfig,...b])})}function eo(r,e,t,n){let i=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],o;if(n.type==="updateClaimFeeWallet"){let s=V([D("index"),v("value")]);o=Buffer.alloc(s.span),s.encode({index:0,value:n.value},o)}else if(n.type==="updateLockNftWallet"){let s=V([D("index"),v("value")]);o=Buffer.alloc(s.span),s.encode({index:1,value:n.value},o)}else if(n.type==="migrateCpLockNftScale"){let s=V([D("index"),g("platformScale"),g("creatorScale"),g("burnScale")]);o=Buffer.alloc(s.span),s.encode(_({index:2},n.value),o)}else if(n.type==="updateFeeRate"){let s=V([D("index"),g("value")]);o=Buffer.alloc(s.span),s.encode({index:3,value:n.value},o)}else if(n.type==="updateImg"||n.type==="updateName"||n.type==="updateWeb"){let s=V([D("index"),pe("value")]);o=Buffer.alloc(Buffer.from(n.value,"utf-8").length+4+1*1),n.type==="updateName"?s.encode({index:4,value:n.value},o):n.type==="updateWeb"?s.encode({index:5,value:n.value},o):n.type==="updateImg"&&s.encode({index:6,value:n.value},o)}else if(n.type==="updateCpConfigId"){i.push({pubkey:n.value,isSigner:!1,isWritable:!1});let s=V([D("index")]);o=Buffer.alloc(s.span),s.encode({index:7},o)}else if(n.type==="updateAll"){i.push({pubkey:n.value.cpConfigId,isSigner:!1,isWritable:!1});let s=V([D("index"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),pe("name"),pe("web"),pe("img"),v("transferFeeExtensionAuth"),g("creatorFeeRate")]);o=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(n.value.name,"utf-8").length+Buffer.from(n.value.web,"utf-8").length+Buffer.from(n.value.img,"utf-8").length+32+8),s.encode({index:8,platformClaimFeeWallet:n.value.platformClaimFeeWallet,platformLockNftWallet:n.value.platformLockNftWallet,platformScale:n.value.migrateCpLockNftScale.platformScale,creatorScale:n.value.migrateCpLockNftScale.creatorScale,burnScale:n.value.migrateCpLockNftScale.burnScale,feeRate:n.value.feeRate,name:n.value.name,web:n.value.web,img:n.value.img,transferFeeExtensionAuth:n.value.transferFeeExtensionAuth,creatorFeeRate:n.value.creatorFeeRate},o)}else throw Error("updateInfo params type error");return new be({keys:i,programId:r,data:Buffer.from([...ye.updatePlaformConfig,...o])})}function qn(r,e,t,n,i,o,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1}];return new be({keys:c,programId:r,data:ye.claimPlatformFeeFromVault})}function Gn(r,e,t,n,i,o,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1}];return new be({keys:a,programId:r,data:ye.claimCreatorFee})}var Mf=new pt("18446744073709551615");import{NATIVE_MINT as Ie,TOKEN_2022_PROGRAM_ID as Be,TOKEN_PROGRAM_ID as J,createAssociatedTokenAccountIdempotentInstruction as le,createSyncNativeInstruction as Cr,getTransferFeeConfig as Mt,unpackMint as Ot}from"@solana/spl-token";import W from"bn.js";import{PublicKey as io,SystemProgram as Nr}from"@solana/web3.js";import ke from"bn.js";import no from"decimal.js";import zt from"bn.js";import Rt from"decimal.js";var ze=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Ht=class extends ze{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Rt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){return new Rt(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new Rt(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new zt(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(o);if(a.lte(new zt(0)))throw Error("tfMinusMf <= 0");let c=a.mul(n).mul(n).div(s),u=a.mul(n).div(s).sub(t),p=c.div(u),m=t.mul(t).div(u);if(p.lt(new zt(0))||m.lt(new zt(0)))throw Error("invalid input 0");return{a:p,b:m,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),o=t.add(e);return i.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),o=n.sub(e);return je(i,o)}};import Yt from"bn.js";import Lt from"decimal.js";var jt=class extends ze{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Lt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){return new Lt(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new Lt(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new Yt(0)))throw Error("invalid input 1");let a=new Yt(2).mul(t).sub(o),u=t.mul(s).div(a);if(u.lt(new Yt(0))||t.lt(new Yt(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return je(i,n)}};import fe from"bn.js";import ot from"decimal.js";import to from"bn.js";import Un from"decimal.js";var Ft=class{static _multipler(e){return new Un(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Un(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new to(i.mul(this._Q64).toFixed(0))}};Ft._Q64=new Un(new to(1).shln(64).toString());var Zt=class extends ze{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new ot(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new ot(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new ot(e.virtualA.mul(e.realA).toString()).div(Ft._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){return new ot(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new ot(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new fe(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new fe(3)).sub(o),u=t.mul(new fe(2)).mul(s).div(a),p=u.mul(u),m=t.mul(new fe(2)).mul(Le).div(p);if(!m.gt(new fe(0)))throw Error("a need gt 0");if(!Sn.gt(m))throw Error("a need lt u64 max");if(m.lt(new fe(0))||u.lt(new fe(0)))throw Error("invalid input 0");return{a:m,b:new fe(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new fe(2).mul(n).mul(Le).div(e.virtualA);return new fe(new ot(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return je(e.virtualA.mul(i),new fe(2).mul(Le)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),o=je(e.virtualA.mul(i),new fe(2).mul(Le));return e.realB.sub(o)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new fe(2).mul(n).mul(Le).div(e.virtualA),o=new fe(new ot(i.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var ge=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let p=this.getCurve(e),m=p.getInitParam({supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:a}),T=p.getPoolInitPriceByInit(Z(_({},m),{decimalA:c,decimalB:u})),P=i.div(new ke(t-1)),l=new ke(0),b=[{price:T,totalSellSupply:0}],{a:f,b:h}=m,y=l,I=l;for(let w=1;w<t;w++){let d=w!==t-1?P:i.sub(I),A=this.buyExactIn({poolInfo:{virtualA:f,virtualB:h,realA:y,realB:I,totalFundRaisingB:i,totalSellA:o},amountB:d,protocolFeeRate:l,platformFeeRate:l,curveType:e,shareFeeRate:l,creatorFeeRate:l,transferFeeConfigA:void 0,slot:0});y=y.add(A.amountA.amount),I=I.add(A.amountB);let x=this.getPrice({poolInfo:{virtualA:f,virtualB:h,realA:y,realB:I},decimalA:c,decimalB:u,curveType:e});b.push({price:x,totalSellSupply:new no(y.toString()).div(10**c).toNumber()})}return b}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:o,config:s,migrateType:a}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(Ze).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new ke(10**o))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(Ze);if(n.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let p=e.sub(n).sub(i),m=e.mul(s.minMigrateRateA).div(Ze);if(p.lt(m))throw Error("migrate lt min migrate amoount");let T=e.sub(n).sub(i),P=new ke(new no(T.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let l=new ke(10).pow(new ke(o));if(P.lte(l))throw Error("check migrate lp error")}else if(a==="cpmm"){let l=new ke(100);if(P.lte(l))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let p=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:p}),T=t.sub(m),P=this.getCurve(o),l=P.buyExactIn({poolInfo:e,amount:T}),b=e.totalSellA.sub(e.realA),f,h,y;if(l.gt(b)){f=b;let w=P.buyExactOut({poolInfo:e,amount:f});h=this.calculatePreFee({postFeeAmount:w,feeRate:p}),y=h.sub(w)}else f=l,h=t,y=m;let I=this.splitFee({totalFee:y,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:pn(f,c,u),amountB:h,splitFee:I}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let p=e.totalSellA.sub(e.realA),m=fn(t,c,u),T=m.fee?m.amount.add(m.fee):m.amount;t.gt(p)&&(T=p);let l=this.getCurve(o).buyExactOut({poolInfo:e,amount:T}),b=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),f=this.calculatePreFee({postFeeAmount:l,feeRate:b}),h=f.sub(l),y=this.splitFee({totalFee:h,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:f,splitFee:y}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let p=this.getCurve(o),m=pn(t,c,u),T=m.fee?m.amount.sub(m.fee):m.amount,P=p.sellExactIn({poolInfo:e,amount:T}),l=this.calculateFee({amount:P,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a})}),b=this.splitFee({totalFee:l,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:P.sub(l),splitFee:b}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let p=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:p});if(e.realB.lt(m))throw Error("Insufficient liquidity");let T=m.sub(t),l=ge.getCurve(o).sellExactOut({poolInfo:e,amount:m});if(l.gt(e.realA))throw Error();let b=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:fn(l,c,u),amountB:t,splitFee:b}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}),a=s.isZero()?new ke(0):e.mul(n).div(s),c=s.isZero()?new ke(0):e.mul(i).div(s),u=s.isZero()?new ke(0):e.mul(o).div(s),p=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:p,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return fi(e,t,Ze)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(Ze),i=Ze.sub(t);return n.add(i).sub(new ke(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new ke(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return Ht;case 1:return jt;case 2:return Zt}throw Error("find curve error")}};import ae from"decimal.js";var rt={initPriceX64:new W("515752397214619"),supply:new W(1e15),totalSellA:new W(7931e11),totalFundRaisingB:new W(85e9),totalLockedAmount:new W("0"),cliffPeriod:new W("0"),unlockPeriod:new W("0"),decimals:6,virtualA:new W("1073471847374405"),virtualB:new W("30050573465"),realA:new W(0),realB:new W(0),protocolFee:new W(0),platformId:new io("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new W(0),cliffPeriod:new W(0),unlockPeriod:new W(0),startTime:new W(0),totalAllocatedShare:new W(0)}},Fe=new W(1e4),Xn=class extends ct{constructor(e){super(e)}async sayHello(){console.log("hello")}async createLaunchpad(R){var N=R,{programId:e=re,authProgramId:t,platformId:n=rt.platformId,mintA:i,decimals:o=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:p,configId:m,snipers:T,configInfo:P,platformFeeRate:l,txVersion:b,computeBudgetConfig:f,txTipConfig:h,feePayer:y,buyAmount:I,minMintAAmount:w,slippage:d,associatedOnly:A=!0,checkCreateATAOwner:x=!1,extraSigners:k,token2022:S,transferFeeExtensionParams:C,creatorFeeOn:L=0}=N,B=_e(N,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","snipers","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams","creatorFeeOn"]);var Hn,Yn,jn,Zn,Qn,Jn,$n,ei,ti,ni;let K=[],E=this.createTxBuilder(y);t=t!=null?t:xe(e).publicKey,S=!!C,S&&(p="cpmm");let G=P;if(!G&&m){let he=await this.scope.connection.getAccountInfo(m);he&&(G=Ve.decode(he.data))}G||this.logAndCreateError("config not found");let U=G.mintB,X=G.curveType,{publicKey:z}=$e(e,i,U),{publicKey:Q}=Mn(e,z,i),{publicKey:H}=Mn(e,z,U),{publicKey:oe}=Nn(i);console.log(`create token: ${i.toBase58()}, mintB: ${U.toBase58()}, decimals A:${o}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let j=(Hn=B==null?void 0:B.supply)!=null?Hn:rt.supply,q=(Yn=B==null?void 0:B.totalSellA)!=null?Yn:rt.totalSellA,se=(jn=B==null?void 0:B.totalFundRaisingB)!=null?jn:rt.totalFundRaisingB,ee=(Zn=B==null?void 0:B.totalLockedAmount)!=null?Zn:new W(0),$=l;if(!l){let he=await this.scope.connection.getAccountInfo(n);he||this.logAndCreateError("platform id not found:",n.toString()),$=it.decode(he.data).feeRate}let zn=ge.getCurve(G.curveType).getInitParam({supply:j,totalFundRaising:se,totalSell:q,totalLockedAmount:ee,migrateFee:G.migrateFee}),Se={epoch:new W(896),bump:254,status:0,mintDecimalsA:o,mintDecimalsB:s,supply:j,totalSellA:q,mintA:new io(i),mintB:U,virtualA:zn.a,virtualB:zn.b,realA:rt.realA,realB:rt.realB,migrateFee:G.migrateFee,migrateType:p==="amm"?0:1,protocolFee:rt.protocolFee,platformFee:$,platformId:n,configId:m,vaultA:Q,vaultB:H,creator:this.scope.ownerPubKey,totalFundRaisingB:se,vestingSchedule:{totalLockedAmount:ee,cliffPeriod:new W(0),unlockPeriod:new W(0),startTime:new W(0),totalAllocatedShare:new W(0)},mintProgramFlag:S?1:0,cpmmCreatorFeeOn:L},oo=ge.getCurve(G.curveType),{c:ro}=oo.getInitParam({supply:Se.supply,totalFundRaising:Se.totalFundRaisingB,totalLockedAmount:ee,totalSell:G.curveType===0?Se.totalSellA:new W(0),migrateFee:G.migrateFee});try{ge.checkParam({supply:Se.supply,totalFundRaising:Se.totalFundRaisingB,totalSell:ro,totalLockedAmount:ee,decimals:Se.mintDecimalsA,config:G,migrateType:p}),this.logDebug("check init params success")}catch(he){this.logAndCreateError(`check create mint params failed, ${he.message}`)}E.addInstruction({instructions:[S?Yi(e,y!=null?y:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,z,i,U,Q,H,o,a,c,u||"https://",{type:X===0?"ConstantCurve":X===1?"FixedCurve":X===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:p,supply:j,totalFundRaisingB:se},ee,(Qn=B==null?void 0:B.cliffPeriod)!=null?Qn:new W(0),(Jn=B==null?void 0:B.unlockPeriod)!=null?Jn:new W(0),L,C):Hi(e,y!=null?y:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,z,i,U,Q,H,oe,o,a,c,u||"https://",{type:X===0?"ConstantCurve":X===1?"FixedCurve":X===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:p,supply:j,totalFundRaisingB:se},ee,($n=B==null?void 0:B.cliffPeriod)!=null?$n:new W(0),(ei=B==null?void 0:B.unlockPeriod)!=null?ei:new W(0),L)]});let Qt=S?await this.scope.connection.getEpochInfo():void 0,Me=C?{epoch:BigInt((Qt==null?void 0:Qt.epoch)||0),maximumFee:BigInt((ti=C==null?void 0:C.maxinumFee.toString())!=null?ti:0),transferFeeBasisPoints:(ni=C==null?void 0:C.transferFeeBasePoints)!=null?ni:0}:void 0,Jt={amountA:{amount:new W(0),fee:void 0,expirationTime:void 0},amountB:new W(0),splitFee:{platformFee:new W(0),shareFee:new W(0),protocolFee:new W(0),creatorFee:new W(0)}},$t;if(k!=null&&k.length&&E.addInstruction({signers:k}),!B.createOnly){let{builder:he,extInfo:so}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:S?Be:void 0,mintA:i,mintB:U,poolInfo:Se,buyAmount:I,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:G,platformFeeRate:$,slippage:d,associatedOnly:A,checkCreateATAOwner:x,skipCheckMintA:!Me,transferFeeConfigA:Me?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Me,newerTransferFee:Me}:void 0,fromCreate:!0});console.log("FEE: ",Me),console.log("PREPARING SNIPER TRANSACTIONS");for(let ii of T){let{builder:ao,extInfo:Lr}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:S?Be:void 0,mintA:i,mintB:U,poolInfo:Se,buyAmount:ii.amount,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:G,platformFeeRate:$,slippage:d,sniper:ii,associatedOnly:A,checkCreateATAOwner:x,skipCheckMintA:!Me,transferFeeConfigA:Me?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Me,newerTransferFee:Me}:void 0,fromCreate:!0});K.push(Z(_({},ao.AllTxData),{blockHash:this.scope.blockhashCommitment}))}E.addInstruction(_({},he.AllTxData)),Jt=_({},so),$t=(this.scope.cluster==="devnet"||b===1)&&B.shareFeeReceiver?[he.allInstructions[0]]:void 0}return b===0?(console.log("VERSION V0"),{tx:await E.sizeCheckBuildV0({computeBudgetConfig:f,swapInfo:Jt,splitIns:$t,address:Z(_({},Se),{poolId:z})}),txs:K}):(console.log("VERSION PLAIN"),{tx:await E.sizeCheckBuild({computeBudgetConfig:f,swapInfo:Jt,splitIns:$t,address:Z(_({},Se),{poolId:z})}),txs:K})}async buyTokenOriginal({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=J,mintB:o=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:p,txTipConfig:m,feePayer:T,buyAmount:P,minMintAAmount:l,slippage:b,sniper:f,shareFeeRate:h=new W(0),shareFeeReceiver:y,associatedOnly:I=!0,checkCreateATAOwner:w=!1,fromCreate:d=!1,transferFeeConfigA:A,skipCheckMintA:x=!1}){var j,q,se;P.lte(new W(0))&&this.logAndCreateError("buy amount should gt 0:",P.toString());let k=f?this.createSniperTxBuilder(f.owner,f.owner.publicKey):this.createTxBuilder(T),{publicKey:S}=$e(e,n,o);t=t!=null?t:xe(e).publicKey;let C=A;if(!x)if(console.log("!skipCheckMintA: ",x),C)console.log("TOKEN_2022_PROGRAM_ID: ",Be),i=Be;else{console.log("!transferFeeConfigA: ",C);let ee=await this.scope.connection.getAccountInfo(n);if(ee&&ee.owner.equals(Be)){console.log("TOKEN_2022_PROGRAM_ID: ",x),i=ee.owner;let $=Ot(n,ee,i);C=Mt($)||void 0}}let L=this.scope.account.getAssociatedTokenAccount(n,i),B=d?this.scope.account.getAssociatedTokenAccount(o,J):null,R=o.equals(Ie);if(k.addInstruction({instructions:[le(this.scope.ownerPubKey,L,this.scope.ownerPubKey,n,i),...d?[le(this.scope.ownerPubKey,B,this.scope.ownerPubKey,o,J),Nr.transfer({fromPubkey:this.scope.ownerPubKey,toPubkey:B,lamports:BigInt(P.toString())}),Cr(B)]:[]]}),!d){let{account:ee,instructionParams:$}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:R?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!R,notUseTokenAccount:R,associatedOnly:R?!1:I,checkCreateATAOwner:w});ee&&(B=ee),k.addInstruction($||{})}B===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let N=s;if(!N){let ee=await this.scope.connection.getAccountInfo(S,{commitment:"processed"});ee||this.logAndCreateError("cannot found pool:",S.toBase58()),N=Te.decode(ee.data)}let K=a,E=await Re(this.scope.connection,[K?void 0:N.configId,N.platformId].filter(Boolean).map(ee=>({pubkey:ee})));if(!K){let ee=E.find($=>$.pubkey.equals(N.configId));(!ee||!ee.accountInfo)&&this.logAndCreateError("config not found: ",N.configId.toBase58()),K=Ve.decode(ee.accountInfo.data)}let G=E.find(ee=>ee.pubkey.equals(N.platformId));(!G||!G.accountInfo)&&this.logAndCreateError("platform info not found: ",N.configId.toBase58());let U=it.decode(G.accountInfo.data);c=c||U.feeRate;let X=ge.buyExactIn({poolInfo:N,amountB:P,protocolFeeRate:K.tradeFeeRate,platformFeeRate:c,curveType:K.curveType,shareFeeRate:h,creatorFeeRate:U.creatorFeeRate,transferFeeConfigA:C,slot:await this.scope.connection.getSlot()}),z=new ae(X.amountA.amount.toString()).sub((q=(j=X.amountA.fee)==null?void 0:j.toString())!=null?q:0),Q=b?new ae(Fe.sub(b).toNumber()/Fe.toNumber()).clampedTo(0,1):new ae(1),H=l!=null?l:b?new W(z.mul(Q).toFixed(0)):X.amountA.amount.sub((se=X.amountA.fee)!=null?se:new W(0));X.amountB.lt(P)&&console.log(`maximum ${n.toBase58()} amount can buy is ${X.amountA.toString()}, input ${o.toBase58()} amount: ${X.amountB.toString()}`);let oe=y?Pe(y,o,J).publicKey:void 0;return oe&&k.addInstruction({instructions:[le(this.scope.ownerPubKey,oe,y,o)]}),k.addInstruction({instructions:[ji(e,this.scope.ownerPubKey,t,N.configId,N.platformId,S,L,B,N.vaultA,N.vaultB,n,o,i,J,tt(e,N.platformId,o).publicKey,nt(e,N.creator,o).publicKey,X.amountB.lt(P)?X.amountB:P,H,h,oe)]}),k.addCustomComputeBudget(p),k.addTipInstruction(m),k.versionBuild({txVersion:u,extInfo:Z(_({},X),{decimalOutAmount:z,minDecimalOutAmount:new ae(H.toString())})})}async buyToken({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=J,mintB:o=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:p,txTipConfig:m,feePayer:T,buyAmount:P,minMintAAmount:l,slippage:b,shareFeeRate:f=new W(0),shareFeeReceiver:h,sniper:y,associatedOnly:I=!0,checkCreateATAOwner:w=!1,fromCreate:d=!1,transferFeeConfigA:A,skipCheckMintA:x=!1}){var q,se,ee;P.lte(new W(0))&&this.logAndCreateError("buy amount should gt 0:",P.toString());let k=y?this.createSniperTxBuilder(y.owner,y.owner.publicKey):this.createTxBuilder(T),{publicKey:S}=$e(e,n,o);t=t!=null?t:xe(e).publicKey;let C=A;if(!x)if(console.log("!skipCheckMintA: ",x),C)console.log("mintAProgram: ",Be),i=Be;else{console.log("!transferFeeConfigA: ",C);let $=await this.scope.connection.getAccountInfo(n);if($&&$.owner.equals(Be)){console.log("!mintInfo: ",$),i=$.owner;let ft=Ot(n,$,i);C=Mt(ft)||void 0}}let L=y?this.scope.account.getAssociatedTokenAccountByOwner(y.owner.publicKey,n,i):this.scope.account.getAssociatedTokenAccount(n,i),B=d?y?this.scope.account.getAssociatedTokenAccountByOwner(y.owner.publicKey,o,J):this.scope.account.getAssociatedTokenAccount(o,J):null,R=o.equals(Ie);console.log("userTokenAccountA: ",L),console.log("userTokenAccountB: ",B);let N=[le((y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,L,(y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,n,i),...d?[le((y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,B,(y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,o,J)]:[]];if(console.log("adding ixs: ",N),k.addInstruction({instructions:N}),!d){let{account:$,instructionParams:ft}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:R?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!R,notUseTokenAccount:R,associatedOnly:R?!1:I,checkCreateATAOwner:w});$&&(B=$)}B===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let K=s;if(!K){let $=await this.scope.connection.getAccountInfo(S,{commitment:"processed"});$||this.logAndCreateError("cannot found pool:",S.toBase58()),K=Te.decode($.data)}let E=a,G=await Re(this.scope.connection,[E?void 0:K.configId,K.platformId].filter(Boolean).map($=>({pubkey:$})));if(!E){let $=G.find(ft=>ft.pubkey.equals(K.configId));(!$||!$.accountInfo)&&this.logAndCreateError("config not found: ",K.configId.toBase58()),E=Ve.decode($.accountInfo.data)}let U=G.find($=>$.pubkey.equals(K.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",K.configId.toBase58());let X=it.decode(U.accountInfo.data);c=c||X.feeRate;let z=ge.buyExactIn({poolInfo:K,amountB:P,protocolFeeRate:E.tradeFeeRate,platformFeeRate:c,curveType:E.curveType,shareFeeRate:f,creatorFeeRate:X.creatorFeeRate,transferFeeConfigA:C,slot:await this.scope.connection.getSlot()}),Q=new ae(z.amountA.amount.toString()).sub((se=(q=z.amountA.fee)==null?void 0:q.toString())!=null?se:0),H=b?new ae(Fe.sub(b).toNumber()/Fe.toNumber()).clampedTo(0,1):new ae(1),oe=l!=null?l:b?new W(Q.mul(H).toFixed(0)):z.amountA.amount.sub((ee=z.amountA.fee)!=null?ee:new W(0));z.amountB.lt(P)&&console.log(`maximum ${n.toBase58()} amount can buy is ${z.amountA.toString()}, input ${o.toBase58()} amount: ${z.amountB.toString()}`);let j=h?Pe(h,o,J).publicKey:void 0;return k.addCustomComputeBudget(p),k.addTipInstruction(m),k.versionBuild({txVersion:u,extInfo:Z(_({},z),{decimalOutAmount:Q,minDecimalOutAmount:new ae(oe.toString())})})}async buyTokenExactOut({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=J,mintB:o=Ie,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:p,computeBudgetConfig:m,txTipConfig:T,feePayer:P,maxBuyAmount:l,outAmount:b,slippage:f,shareFeeRate:h=new W(0),shareFeeReceiver:y,associatedOnly:I=!0,checkCreateATAOwner:w=!1,skipCheckMintA:d=!1}){b.lte(new W(0))&&this.logAndCreateError("out amount should gt 0:",b.toString());let A=this.createTxBuilder(P),{publicKey:x}=$e(e,n,o);t=t!=null?t:xe(e).publicKey;let k=s;if(!k){let j=await this.scope.connection.getAccountInfo(x,{commitment:"processed"});j||this.logAndCreateError("cannot found pool:",x.toBase58()),k=Te.decode(j.data)}let S=a,C=await Re(this.scope.connection,[S?void 0:k.configId,k.platformId].filter(Boolean).map(j=>({pubkey:j})));if(!S){let j=C.find(q=>q.pubkey.equals(k.configId));(!j||!j.accountInfo)&&this.logAndCreateError("config not found: ",k.configId.toBase58()),S=Ve.decode(j.accountInfo.data)}let L=C.find(j=>j.pubkey.equals(k.platformId));(!L||!L.accountInfo)&&this.logAndCreateError("platform info not found: ",k.configId.toBase58());let B=it.decode(L.accountInfo.data);u=u||B.feeRate;let R=c;if(!d)if(R)i=Be;else{let j=await this.scope.connection.getAccountInfo(n);if(j&&j.owner.equals(Be)){i=j.owner;let q=Ot(n,j,i);R=Mt(q)||void 0}}let N=ge.buyExactOut({poolInfo:k,amountA:b,protocolFeeRate:S.tradeFeeRate,platformFeeRate:u,curveType:S.curveType,shareFeeRate:h,creatorFeeRate:B.creatorFeeRate,transferFeeConfigA:R,slot:await this.scope.connection.getSlot()}),K=new ae(N.amountB.toString()),E=f?new ae(Fe.add(f).toNumber()/Fe.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new ae(1),G=(l!=null?l:f)?new W(K.mul(E).toFixed(0)):N.amountB,U=this.scope.account.getAssociatedTokenAccount(n,i),X=null,z=o.equals(Ie);A.addInstruction({instructions:[le(this.scope.ownerPubKey,U,this.scope.ownerPubKey,n,i)]});let{account:Q,instructionParams:H}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:z?{payer:this.scope.ownerPubKey,amount:N.amountB}:void 0,skipCloseAccount:!z,notUseTokenAccount:z,associatedOnly:z?!1:I,checkCreateATAOwner:w});Q&&(X=Q),A.addInstruction(H||{}),X===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let oe=y?Pe(y,o,J).publicKey:void 0;return oe&&A.addInstruction({instructions:[le(this.scope.ownerPubKey,oe,y,o)]}),A.addInstruction({instructions:[Zi(e,this.scope.ownerPubKey,t,k.configId,k.platformId,x,U,X,k.vaultA,k.vaultB,n,o,i,J,tt(e,k.platformId,o).publicKey,nt(e,k.creator,o).publicKey,b,G,h,oe)]}),A.addCustomComputeBudget(m),A.addTipInstruction(T),A.versionBuild({txVersion:p,extInfo:{maxSpentAmount:G,outAmount:b}})}async sellToken({programId:e=re,authProgramId:t,mintAProgram:n=J,mintA:i,mintB:o=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:p,txTipConfig:m,feePayer:T,sellAmount:P,minAmountB:l,slippage:b,shareFeeRate:f=new W(0),shareFeeReceiver:h,associatedOnly:y=!0,checkCreateATAOwner:I=!1,skipCheckMintA:w=!1}){t=t!=null?t:xe(e).publicKey;let d=this.createTxBuilder(T);P.lte(new W(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:A}=$e(e,i,o),x;if(!w){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(Be)){n=q.owner;let se=Ot(i,q,n);x=Mt(se)||void 0}}let k=null,S=null,C=o.equals(Ie),{account:L,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:y,checkCreateATAOwner:I});L&&(k=L),d.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:R,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:y,checkCreateATAOwner:I});R&&(S=R),d.addInstruction(N||{}),S===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let K=s;if(!K){let q=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",A.toBase58()),K=Te.decode(q.data)}let E=a,G=await Re(this.scope.connection,[E?void 0:K.configId,K.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!E){let q=G.find(se=>se.pubkey.equals(K.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",K.configId.toBase58()),E=Ve.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(K.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",K.configId.toBase58());let X=it.decode(U.accountInfo.data);c=c||X.feeRate;let z=ge.sellExactIn({poolInfo:K,amountA:P,protocolFeeRate:E.tradeFeeRate,platformFeeRate:c,curveType:E.curveType,shareFeeRate:f,creatorFeeRate:X.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Q=new ae(z.amountB.toString()),H=b?new ae(Fe.sub(b).toNumber()/Fe.toNumber()).clampedTo(0,1):new ae(1),oe=l!=null?l:b?new W(Q.mul(H).toFixed(0)):z.amountB;oe.lte(new W(0))&&this.logAndCreateError(`out ${o.toBase58()} amount should be gt 0`);let j=h?Pe(h,o,J).publicKey:void 0;return j&&d.addInstruction({instructions:[le(this.scope.ownerPubKey,j,h,o)]}),d.addInstruction({instructions:[Qi(e,this.scope.ownerPubKey,t,K.configId,K.platformId,A,k,S,K.vaultA,K.vaultB,i,o,n,J,tt(e,K.platformId,o).publicKey,nt(e,K.creator,o).publicKey,z.amountA.amount.lt(P)?z.amountA.amount:P,oe,f,j)]}),d.addCustomComputeBudget(p),d.addTipInstruction(m),d.versionBuild({txVersion:u,extInfo:{outAmount:oe}})}async sellTokenExactOut({programId:e=re,authProgramId:t,mintAProgram:n=J,mintA:i,mintB:o=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:p,txTipConfig:m,feePayer:T,inAmount:P,maxSellAmount:l,slippage:b,shareFeeRate:f=new W(0),shareFeeReceiver:h,associatedOnly:y=!0,checkCreateATAOwner:I=!1,skipCheckMintA:w=!1}){t=t!=null?t:xe(e).publicKey;let d=this.createTxBuilder(T);l!=null&&l.lte(new W(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:A}=$e(e,i,o),x;if(!w){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(Be)){n=q.owner;let se=Ot(i,q,n);x=Mt(se)||void 0}}let k=null,S=null,C=o.equals(Ie),{account:L,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:y,checkCreateATAOwner:I});L&&(k=L),d.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:R,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:y,checkCreateATAOwner:I});R&&(S=R),d.addInstruction(N||{}),S===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let K=s;if(!K){let q=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",A.toBase58()),K=Te.decode(q.data)}let E=a,G=await Re(this.scope.connection,[E?void 0:K.configId,K.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!E){let q=G.find(se=>se.pubkey.equals(K.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",K.configId.toBase58()),E=Ve.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(K.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",K.configId.toBase58());let X=it.decode(U.accountInfo.data);c=c||X.feeRate;let z=ge.sellExactOut({poolInfo:K,amountB:P,protocolFeeRate:E.tradeFeeRate,platformFeeRate:c,curveType:E.curveType,shareFeeRate:f,creatorFeeRate:X.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Q=new ae(z.amountA.amount.toString()),H=b?new ae(Fe.add(b).toNumber()/Fe.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new ae(1),oe=(l!=null?l:b)?new W(Q.mul(H).toFixed(0)):z.amountA.amount,j=h?Pe(h,o,J).publicKey:void 0;return j&&d.addInstruction({instructions:[le(this.scope.ownerPubKey,j,h,o)]}),d.addInstruction({instructions:[Ji(e,this.scope.ownerPubKey,t,K.configId,K.platformId,A,k,S,K.vaultA,K.vaultB,i,o,n,J,tt(e,K.platformId,o).publicKey,nt(e,K.creator,o).publicKey,P,oe,f,j)]}),d.addCustomComputeBudget(p),d.addTipInstruction(m),d.versionBuild({txVersion:u,extInfo:{maxSellAmount:oe}})}async createPlatformConfig({programId:e=re,platformAdmin:t,platformClaimFeeWallet:n,platformLockNftWallet:i,cpConfigId:o,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:c,feeRate:u,name:p,web:m,img:T,txVersion:P,computeBudgetConfig:l,txTipConfig:b,feePayer:f}){let h=this.createTxBuilder(f),{publicKey:y}=On(e,t);return h.addInstruction({instructions:[$i(e,t,n,i,y,o,a,s,u,c,p,m,T)]}),h.addCustomComputeBudget(l),h.addTipInstruction(b),h.versionBuild({txVersion:P,extInfo:{platformId:y}})}async updatePlatformConfig({programId:e=re,platformAdmin:t,platformId:n,updateInfo:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),p=n!=null?n:On(e,t).publicKey;return u.addInstruction({instructions:[eo(e,t,p,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimPlatformFee({programId:e=re,authProgramId:t,platformId:n,poolId:i,platformClaimFeeWallet:o,mintB:s,vaultB:a,mintBProgram:c=J,txVersion:u,computeBudgetConfig:p,txTipConfig:m,feePayer:T}){var h;let P=this.createTxBuilder(T);t=t!=null?t:xe(e).publicKey;let l=s,b=a;if(!l){let y=await this.scope.connection.getAccountInfo(i,{commitment:"processed"});y||this.logAndCreateError("cannot found pool:",i.toBase58());let I=Te.decode(y.data),w=await this.scope.connection.getAccountInfo(I.configId,{commitment:"processed"});w||this.logAndCreateError("cannot found config:",I.configId.toBase58()),l=Ve.decode(w.data).mintB,b=b!=null?b:I.vaultB}(!l||!b)&&this.logAndCreateError("cannot found mint info, mintB: ",l.toBase58(),", vaultB: ",(h=b==null?void 0:b.toBase58())!=null?h:"");let f=Pe(this.scope.ownerPubKey,l,J).publicKey;return P.addInstruction({instructions:[le(this.scope.ownerPubKey,f,this.scope.ownerPubKey,l)]}),P.addInstruction({instructions:[_n(e,o,t,i,n,b,f,l,c)]}),P.addCustomComputeBudget(p),P.addTipInstruction(m),P.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=re,authProgramId:t,platformId:n,platformClaimFeeWallet:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:xe(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Te.span},{memcmp:{offset:Te.offsetOf("platformId"),bytes:n.toString()}}]})).forEach(m=>{let T=Te.decode(m.account.data);if(T.platformFee.lte(new W(0)))return;let P=Pe(this.scope.ownerPubKey,T.mintB,J).publicKey;u.addInstruction({instructions:[le(this.scope.ownerPubKey,P,this.scope.ownerPubKey,T.mintB)]}),u.addInstruction({instructions:[_n(e,i,t,m.pubkey,n,T.vaultB,P,T.mintB,J)]})}),u.addTipInstruction(a),o===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=re,poolId:t,beneficiary:n,shareAmount:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),p=await this.getRpcPoolInfo({poolId:t});i.add(p.vestingSchedule.totalAllocatedShare).gt(p.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=Nt(e,t,n).publicKey;return u.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,n,t,m,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async createMultipleVesting({programId:e=re,poolId:t,beneficiaryList:n,txVersion:i,computeBudgetConfig:o,feePayer:s}){let a=this.createTxBuilder(s);n.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return n.reduce((p,m)=>p.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),n.forEach(p=>{let m=Nt(e,t,p.wallet).publicKey;a.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,p.wallet,t,m,p.shareAmount)]})}),i===0?a.sizeCheckBuildV0({computeBudgetConfig:o}):a.sizeCheckBuild({computeBudgetConfig:o})}async claimVesting({programId:e=re,poolId:t,poolInfo:n,vestingRecord:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),p=xe(e).publicKey,m=i||Nt(e,t,this.scope.ownerPubKey).publicKey,T=n;if(!T){let l=await this.scope.connection.getAccountInfo(t);l||this.logAndCreateError("pool not found"),T=Te.decode(l.data)}let P=Pe(this.scope.ownerPubKey,T.mintA,J).publicKey;return u.addInstruction({instructions:[le(this.scope.ownerPubKey,P,this.scope.ownerPubKey,T.mintA)]}),u.addInstruction({instructions:[Dn(e,this.scope.ownerPubKey,p,t,m,P,T.vaultA,T.mintA,J)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimMultiVesting({programId:e=re,poolIdList:t,poolsInfo:n={},vestingRecords:i={},txVersion:o,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=_({},n),p=xe(e).publicKey,m=t.filter(T=>!u[T.toBase58()]);if(m.length){let T=await this.getRpcPoolsInfo({poolIdList:m});u=_(_({},u),T.poolInfoMap)}return t.forEach(T=>{let P=T.toBase58(),l=u[P];l||this.logAndCreateError(`pool info not found: ${P}`);let b=i[P]||Nt(e,T,this.scope.ownerPubKey).publicKey,f=Pe(this.scope.ownerPubKey,l.mintA,J).publicKey;c.addInstruction({instructions:[le(this.scope.ownerPubKey,f,this.scope.ownerPubKey,l.mintA)]}),c.addInstruction({instructions:[Dn(e,this.scope.ownerPubKey,p,T,b,f,l.vaultA,l.mintA,J)]})}),o===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=re,platformId:t,mintB:n,mintBProgram:i=J,claimFeeWallet:o,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let p=this.createTxBuilder(u),m=tt(e,t,n).publicKey,T=En(e).publicKey,P=this.scope.account.getAssociatedTokenAccount(n,i);return p.addInstruction({instructions:[le(this.scope.ownerPubKey,P,this.scope.ownerPubKey,n,i),qn(e,t,o!=null?o:this.scope.ownerPubKey,T,m,P,n,i)]}),p.addCustomComputeBudget(a),p.addTipInstruction(c),p.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=re,platformList:t,unwrapSol:n=!0,txVersion:i,computeBudgetConfig:o,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),p={};return t.forEach(async m=>{var f,h;let T=En(e).publicKey,P=tt(e,m.id,m.mintB).publicKey,l=m.mintB.equals(Ie)&&n,b=p[m.mintB.toBase58()];if(!b){let{account:y,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:l?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!l,notUseTokenAccount:l,associatedOnly:l?!1:a,checkCreateATAOwner:c});y&&(b=y),u.addInstruction(I||{}),b===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[qn(e,m.id,(f=m.claimFeeWallet)!=null?f:this.scope.ownerPubKey,P,T,b,m.mintB,(h=m.mintBProgram)!=null?h:J)]})}),i===0?u.sizeCheckBuildV0({computeBudgetConfig:o}):u.sizeCheckBuild({computeBudgetConfig:o})}async claimCreatorFee({programId:e=re,mintB:t,mintBProgram:n=J,txVersion:i,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=nt(e,this.scope.ownerPubKey,t).publicKey,p=vn(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,n);return c.addInstruction({instructions:[le(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,n),Gn(e,this.scope.ownerPubKey,p,u,m,t,n)]}),c.addCustomComputeBudget(o),c.addTipInstruction(s),c.versionBuild({txVersion:i})}async claimMultipleCreatorFee({programId:e=re,mintBList:t,txVersion:n,computeBudgetConfig:i,feePayer:o}){let s=this.createTxBuilder(o);return t.forEach(a=>{var P;let c=a.pubKey,u=(P=a.programId)!=null?P:J,p=nt(e,this.scope.ownerPubKey,c).publicKey,m=vn(e).publicKey,T=this.scope.account.getAssociatedTokenAccount(c,u);s.addInstruction({instructions:[le(this.scope.ownerPubKey,T,this.scope.ownerPubKey,c,u),Gn(e,this.scope.ownerPubKey,m,p,T,c,u)]})}),n==0?s.sizeCheckBuildV0({computeBudgetConfig:i}):s.sizeCheckBuild({computeBudgetConfig:i})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let n=await Re(this.scope.connection,e.map(c=>({pubkey:c})),t),i={},o=[];for(let c=0;c<e.length;c++){let u=n[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let p=Te.decode(u.accountInfo.data);i[e[c].toBase58()]=Z(_({},p),{poolId:u.accountInfo.owner}),o.push(p.configId)}let s=await Re(this.scope.connection,o.map(c=>({pubkey:c})),t),a={};for(let c=0;c<o.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+o[c].toBase58());let p=Ve.decode(u.accountInfo.data);a[o[c].toBase58()]=Z(_({},p),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(i).reduce((c,u)=>Z(_({},c),{[u]:Z(_({},i[u]),{configInfo:a[i[u].configId.toBase58()]})}),{})}}};export{rt as LaunchpadPoolInitParam,Xn as default};
//# sourceMappingURL=launchpad.mjs.map