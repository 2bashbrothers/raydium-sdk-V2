var ar=Object.defineProperty,ur=Object.defineProperties;var cr=Object.getOwnPropertyDescriptors;var Mt=Object.getOwnPropertySymbols;var oi=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable;var ri=(o,e,t)=>e in o?ar(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,_=(o,e)=>{for(var t in e||(e={}))oi.call(e,t)&&ri(o,t,e[t]);if(Mt)for(var t of Mt(e))si.call(e,t)&&ri(o,t,e[t]);return o},H=(o,e)=>ur(o,cr(e));var De=(o,e)=>{var t={};for(var n in o)oi.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&Mt)for(var n of Mt(o))e.indexOf(n)<0&&si.call(o,n)&&(t[n]=o[n]);return t};import{get as ai,set as lr}from"lodash";var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ui={},mr={};function oe(o){let e=ai(ui,o);if(!e){let t=ai(mr,o);e=new en({name:o,logLevel:t}),lr(ui,o,e)}return e}import{PublicKey as Qe,sendAndConfirmTransaction as Pn,SystemProgram as _r,Transaction as Bt,TransactionMessage as Fe,VersionedTransaction as Me}from"@solana/web3.js";import qr from"axios";import{PublicKey as yn,AddressLookupTableAccount as it}from"@solana/web3.js";import{PublicKey as Vr}from"@solana/web3.js";import xe from"bn.js";import da from"decimal.js";import Ar from"big.js";import Zo from"bn.js";import dr from"toformat";var pr=dr,ft=pr;import Et from"big.js";import br from"bn.js";import yr from"decimal.js-light";import bt from"bn.js";var ci=9007199254740991;function he(o){let e=oe("Raydium_parseBigNumberish");if(o instanceof bt)return o;if(typeof o=="string"){if(o.match(/^-?[0-9]+$/))return new bt(o);e.logWithError(`invalid BigNumberish string: ${o}`)}return typeof o=="number"?(o%1&&e.logWithError(`BigNumberish number underflow: ${o}`),(o>=ci||o<=-ci)&&e.logWithError(`BigNumberish number overflow: ${o}`),new bt(String(o))):typeof o=="bigint"?new bt(o.toString()):(e.error(`invalid BigNumberish value: ${o}`),new bt(0))}var Ot=oe("module/fraction"),tn=ft(Et),yt=ft(yr),gr={[0]:yt.ROUND_DOWN,[1]:yt.ROUND_HALF_UP,[2]:yt.ROUND_UP},Pr={[0]:Et.roundDown,[1]:Et.roundHalfUp,[2]:Et.roundUp},$=class{constructor(e,t=new br(1)){this.numerator=he(e),this.denominator=he(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new $(this.denominator,this.numerator)}add(e){let t=e instanceof $?e:new $(he(e));return this.denominator.eq(t.denominator)?new $(this.numerator.add(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof $?e:new $(he(e));return this.denominator.eq(t.denominator)?new $(this.numerator.sub(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof $?e:new $(he(e));return new $(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof $?e:new $(he(e));return new $(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<=0&&Ot.logWithError(`${e} is not positive.`),yt.set({precision:e+1,rounding:gr[n]});let i=new yt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<0&&Ot.logWithError(`${e} is negative.`),tn.DP=e,tn.RM=Pr[n]||1,new tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var os=oe("Raydium_amount"),ss=ft(Ar);import{PublicKey as kr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as li}from"@solana/spl-token";var nn={chainId:101,address:kr.default.toBase58(),programId:li.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ve={chainId:101,address:"So11111111111111111111111111111111111111112",programId:li.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as sn}from"@solana/web3.js";import{PublicKey as te,SystemProgram as mi,SYSVAR_RENT_PUBKEY as wr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Br}from"@solana/spl-token";function rn({pubkey:o,isSigner:e=!1,isWritable:t=!0}){return{pubkey:o,isWritable:t,isSigner:e}}var fs=[rn({pubkey:Br,isWritable:!1}),rn({pubkey:mi.programId,isWritable:!1}),rn({pubkey:wr,isWritable:!1})];function di({publicKey:o,transformSol:e}){let t=pi(o.toString());if(t instanceof te)return e&&t.equals(gt)?vt:t;if(e&&t.toString()===gt.toBase58())return vt;if(typeof t=="string"){if(t===te.default.toBase58())return te.default;try{return new te(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function pi(o){try{return new te(o)}catch{return o}}var hr=new te("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xr=new te("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),on=new te("SysvarRent111111111111111111111111111111111"),bs=new te("SysvarC1ock11111111111111111111111111111111"),tt=new te("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ys=new te("Sysvar1nstructions1111111111111111111111111"),gs=mi.programId,Ps=new te("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),As=new te("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ts=new te("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ks=new te("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ws=new te("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Bs=new te("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),hs=new te("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),xs=new te("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Is=new te("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ss=new te("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Cs=new te("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),vt=new te("So11111111111111111111111111111111111111112"),gt=te.default;var an=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:r=!1,isToken2022:s=!1}){if(e===gt.toBase58()||e instanceof sn&&gt.equals(e)){this.decimals=Ve.decimals,this.symbol=Ve.symbol,this.name=Ve.name,this.mint=new sn(Ve.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=r?sn.default:di({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},_e=an;_e.WSOL=new an(H(_({},Ve),{mint:Ve.address}));var un=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Wt=un;Wt.SOL=new un(nn);import Ir from"bn.js";var Vs=new $(new Ir(100));var zs=oe("Raydium_price");var Sr=new xe(0),ka=new xe(1),wa=new xe(2),Ba=new xe(3),ha=new xe(5),Tr=new xe(10),xa=new xe(100),Ia=new xe(1e3),Sa=new xe(1e4);function fi(o,e,t){return o.mul(e).add(t).sub(new xe(1)).div(t)}function mn(o,e=1,t=[]){let n=[...o];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Ie=class{constructor(e){this._owner=e}get publicKey(){return Ie.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return Ie.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return Ie.isKeyPair(this._owner)}get isPublicKey(){return Ie.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!Ie.isKeyPair(e)}};import{PublicKey as Mr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Or}from"@solana/spl-token";import{ComputeBudgetProgram as bi,Keypair as gi,PublicKey as Cr,Transaction as Pi,TransactionMessage as Kr,VersionedTransaction as Ai}from"@solana/web3.js";var He={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Nr}from"@solana/spl-token";var yi=oe("Raydium_txUtil"),Ti=1644;function Pt(o){let e=[],t=[];return o.microLamports&&(e.push(bi.setComputeUnitPrice({microLamports:o.microLamports})),t.push(He.SetComputeUnitPrice)),o.units&&(e.push(bi.setComputeUnitLimit({units:o.units})),t.push(He.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ye(o,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=o.getLatestBlockhash)==null?void 0:n.call(o,{commitment:t})))==null?void 0:i.blockhash}async function At(o,e){return o.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);o.onSignature(e,r=>{if(clearTimeout(i),!r.err){t("");return}n(Object.assign(r.err,{txId:e}))},"confirmed")})}function Rr(o,e){o.length<1&&yi.logWithError(`no instructions provided: ${o.toString()}`),e.length<1&&yi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Pi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...o);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ti}catch{return!1}}function ue(o,e){let[t,n]=Cr.findProgramAddressSync(o,e);return{publicKey:t,nonce:n}}function Tt({instructions:o,payer:e,signers:t}){return Rr(o,[e,...t])}function Re({instructions:o,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=gi.generate().publicKey.toString()}){let r=new Kr({payerKey:e,recentBlockhash:n,instructions:o}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ai(r).serialize()).toString("base64").length<Ti}catch{return!1}}var Lr=o=>Buffer.isBuffer(o)?o:o instanceof Uint8Array?Buffer.from(o.buffer,o.byteOffset,o.byteLength):Buffer.from(o),Fr=o=>{let e=o.serialize({requireAllSignatures:!1,verifySignatures:!1});o instanceof Ai&&(e=Lr(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function qe(o){let e=[];return o.forEach(t=>{t instanceof Pi&&(t.recentBlockhash||(t.recentBlockhash=Nr.toBase58()),t.feePayer||(t.feePayer=gi.generate().publicKey)),e.push(Fr(t))}),console.log("simulate tx string:",e),e}function Te(o,e,t){return ue([o.toBuffer(),(t!=null?t:Or).toBuffer(),e.toBuffer()],new Mr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as F}from"@solana/web3.js";var Ya=new F("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ja=new F("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Za=new F("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Qa=new F("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ja=new F("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),$a=new F("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),eu=new F("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),tu=new F("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),nu=new F("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),iu=new F("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Er=new F("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),vr=new F("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Wr=new F("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ru=new F("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ou=new F("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),su=new F("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),au=new F("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),uu=new F("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),cu=new F("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),lu=new F("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),mu=new F("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),du=new F("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),pu=new F("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),fu=new F("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),bu=new F("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),re=new F("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),yu=new F("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),gu=new F("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Pu=new F("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Au=new F("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Tu=new F("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ku={OPEN_BOOK_PROGRAM:new F("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new F("Ray1111111111111111111111111111111111111111"),AMM_V4:new F("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new F("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new F("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new F("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new F("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new F("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new F("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new F("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new F("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new F("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:F.default,Router:new F("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new F("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new F("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new F("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new F("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new F("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new F("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new F("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new F("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new F("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new F("Ray1111111111111111111111111111111111111111")};import se from"bn.js";var kt=1e4;function dn(o,e){let{div:t,mod:n}=o.divmod(e);return n.gt(new se(0))?t.add(new se(1)):t}function je(o,e){if(o.isZero())return new se(0);let t=o.div(e);return t.isZero()?new se(1):o.mod(e).gt(new se(0))?t.add(new se(1)):t}function pn(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new se(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=dn(o.mul(new se(i.transferFeeBasisPoints)),new se(kt)),c=a.gt(r)?r:a;return{amount:o,fee:c,expirationTime:s}}function fn(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new se(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===kt){let a=new se(i.maximumFee.toString());return{amount:o.add(a),fee:a,expirationTime:s}}else{let a=dn(o.mul(new se(kt)),new se(kt-i.transferFeeBasisPoints)),c=new se(i.maximumFee.toString()),u=a.sub(o).gt(c)?o.add(c):a,d=dn(u.mul(new se(i.transferFeeBasisPoints)),new se(kt)),m=d.gt(r)?r:d;return{amount:u,fee:m,expirationTime:s}}}import{PublicKey as Iu}from"@solana/web3.js";import Cu from"bn.js";import Dr from"bn.js";var Ze=new Dr(1e6);import{MINT_SIZE as sc,TOKEN_PROGRAM_ID as ac,getTransferFeeConfig as uc,unpackMint as cc}from"@solana/spl-token";var bn=oe("Raydium_accountInfo_util");async function wt(o,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:r=100}=_({batchRequest:!1},t),s=mn(e,r),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let T=o._buildArgs([m.map(A=>A.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:T}}),u=mn(c,10);a=(await(await Promise.all(u.map(async m=>await o._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(T=>{if(T){let{data:A,executable:l,lamports:g,owner:b,rentEpoch:h}=T;return A.length!==2&&A[1]!=="base64"&&bn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(A[0],"base64"),executable:l,lamports:g,owner:new Vr(b),rentEpoch:h}}return null})))}else try{a=await Promise.all(s.map(c=>o.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Le(o,e,t){let n=await wt(o,e.map(i=>i.pubkey),t);return e.map((i,r)=>H(_({},i),{accountInfo:n[r]}))}async function Vt({connection:o,address:e,cluster:t="mainnet"}){let n=await wt(o,[...new Set(e.map(r=>r.toString()))].map(r=>new yn(r))),i={};for(let r=0;r<e.length;r++){let s=n[r],a=e[r];if(!s)continue;let c=new it({key:a,state:it.deserialize(s.data)});i[a.toString()]=c,t==="devnet"?nt[a.toString()]=c:Ge[a.toString()]=c}return i}var Ge={},gn=async o=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(Ge[e])return Ge;let t=new yn(e),n=await o.getAccountInfo(t);return n&&(Ge[e]=new it({key:t,state:it.deserialize(n.data)})),Ge},nt={},_t=async o=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(nt[e])return nt;let t=new yn(e),n=await o.getAccountInfo(t);return n&&(nt[e]=new it({key:t,state:it.deserialize(n.data)})),nt};var ht=2e3,xt=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await qr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Pt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(_r.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Qe(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(He.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:r=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...r),this.lookupTableAddress.push(...s.filter(a=>a!==Qe.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(_({},t||{})):this.build(t)}build(e){var n;let t=new Bt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var d;let{recentBlockHash:r,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=i||{},u=r!=null?r:await Ye(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),qe([t]),(d=this.owner)!=null&&d.isKeyPair)return{txId:a?await Pn(this.connection,t,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let T of m)try{T.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),r=t.filter(d=>d.transaction.instructions.length>0),s=[i,...r.map(d=>d.transaction)],a=[this.signers,...r.map(d=>d.signers)],c=[...this.instructionTypes,...r.map(d=>d.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(d=>{d.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async d=>{var h;let{sequentially:m,onTxUpdate:T,skipTxCount:A=0,recentBlockHash:l,skipPreflight:g=!0}=d||{},b=l!=null?l:await Ye(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(m){let y=[],I=0;for(let k of s){if(++I,I<=A)continue;let p=await Pn(this.connection,k,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});y.push(p)}return{txIds:y,signedTxs:s}}return{txIds:await await Promise.all(s.map(async y=>(y.recentBlockhash=b,await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let y=s.map((k,p)=>(k.recentBlockhash=b,a[p].length&&k.sign(...a[p]),k));qe(y);let I=await this.signAllTransactions(y);if(m){let k=0,p=[],P=async()=>{if(!I[k])return;let x=await this.connection.sendRawTransaction(I[k].serialize(),{skipPreflight:g});p.push({txId:x,status:"sent",signedTx:I[k]}),T==null||T([...p]),k++;let B=!1,S=null,K=null,M=w=>{S!==null&&clearInterval(S),K!==null&&this.connection.removeSignatureListener(K);let L=p.findIndex(v=>v.txId===x);if(L>-1){if(p[L].status==="error"||p[L].status==="success")return;p[L].status=w.err?"error":"success"}T==null||T([...p]),w.err||P()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var w;if(B){clearInterval(S);return}try{let L=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(B=!0,clearInterval(S),M({err:((w=L.meta)==null?void 0:w.err)||null}),console.log("tx status from getTransaction:",x))}catch(L){B=!0,clearInterval(S),console.error("getTransaction timeout:",L,x)}},ht)),K=this.connection.onSignature(x,w=>{if(B){this.connection.removeSignatureListener(K);return}B=!0,M(w)},"confirmed"),this.connection.getSignatureStatus(x)};return await P(),{txIds:p.map(x=>x.txId),signedTxs:I}}else{let k=[];for(let p=0;p<I.length;p+=1){let P=await this.connection.sendRawTransaction(I[p].serialize(),{skipPreflight:g});k.push(P)}return{txIds:k,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var g;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:r}=l,s=De(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):await gn(this.connection)),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new Qe(b));let d=await Vt({connection:this.connection,address:u});for(let[b,h]of Object.entries(d))a[b]=h;let m=i?Qe.default.toBase58():r!=null?r:await Ye(this.connection,this.blockhashCommitment),T=new Fe({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let A=new Me(T);return A.sign(this.signers),{builder:this,transaction:A,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var k;let{skipPreflight:h=!0,sendAndConfirm:y,notSendToRpc:I}=b||{};if(qe([A]),(k=this.owner)!=null&&k.isKeyPair){let p=await this.connection.sendTransaction(A,{skipPreflight:h});return y&&await At(this.connection,p),{txId:p,signedTx:A}}if(this.signAllTransactions){let p=await this.signAllTransactions([A]);if(this.signers.length)for(let P of p)try{P.sign(this.signers)}catch{}return{txId:I?"":await this.connection.sendTransaction(p[0],{skipPreflight:h}),signedTx:p[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),r=t.filter(d=>d.builder.instructions.length>0),s=[i,...r.map(d=>d.transaction)],a=[this.signers,...r.map(d=>d.signers)],c=[...this.instructionTypes,...r.map(d=>d.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(d=>{d.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(d,m)=>{d.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async d=>{var g;let{sequentially:m,onTxUpdate:T,recentBlockHash:A,skipPreflight:l=!0}=d||{};if(A&&s.forEach(b=>b.message.recentBlockhash=A),qe(s),(g=this.owner)!=null&&g.isKeyPair){if(m){let b=[];for(let h of s){let y=await this.connection.sendTransaction(h,{skipPreflight:l});await At(this.connection,y),b.push(y)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:l}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(m){let h=0,y=[],I=async()=>{if(!b[h])return;let k=await this.connection.sendTransaction(b[h],{skipPreflight:l});y.push({txId:k,status:"sent",signedTx:b[h]}),T==null||T([...y]),h++;let p=!1,P=null,x=null,B=S=>{P!==null&&clearInterval(P),x!==null&&this.connection.removeSignatureListener(x);let K=y.findIndex(M=>M.txId===k);if(K>-1){if(y[K].status==="error"||y[K].status==="success")return;y[K].status=S.err?"error":"success"}T==null||T([...y]),S.err||I()};this.loopMultiTxStatus&&(P=setInterval(async()=>{var S;if(p){clearInterval(P);return}try{let K=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});K&&(p=!0,clearInterval(P),B({err:((S=K.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",k))}catch(K){p=!0,clearInterval(P),console.error("getTransaction timeout:",K,k)}},ht)),x=this.connection.onSignature(k,S=>{if(p){this.connection.removeSignatureListener(x);return}p=!0,B(S)},"confirmed"),this.connection.getSignatureStatus(k)};return I(),{txIds:[],signedTxs:b}}else{let h=[];for(let y=0;y<b.length;y+=1){let I=await this.connection.sendTransaction(b[y],{skipPreflight:l});h.push(I)}return{txIds:h,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var T;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=De(m,["splitIns","computeBudgetConfig"]),r=n?Pt(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((A,l)=>H(_({},A),{[l.publicKey.toBase58()]:l}),{}),a=[],c=[],u=[],d=0;if(this.allInstructions.forEach(A=>{let l=[...u,A],g=n?[...r.instructions,...l]:l,h=[...new Set(l.map(y=>y.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(y=>new Qe(y));if(A!==t[d]&&u.length<12&&(Tt({instructions:g,payer:this.feePayer,signers:h})||Tt({instructions:l,payer:this.feePayer,signers:h})))u.push(A);else{if(u.length===0)throw Error("item ins too big");d+=A===t[d]?1:0,Tt({instructions:n?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:h})?a.push(new Bt().add(...r.instructions,...u)):a.push(new Bt().add(...u)),c.push(Array.from(new Set(u.map(y=>y.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(y=>s[y]).filter(y=>y!==void 0)),u=[A]}}),u.length>0){let l=[...new Set(u.map(g=>g.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(g=>s[g]).filter(g=>g!==void 0);Tt({instructions:n?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:l.map(g=>g.publicKey)})?a.push(new Bt().add(...r.instructions,...u)):a.push(new Bt().add(...u)),c.push(l)}return a.forEach(A=>A.feePayer=this.feePayer),(T=this.owner)!=null&&T.signer&&c.forEach(A=>{A.some(l=>l.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async A=>{var k;let{sequentially:l,onTxUpdate:g,skipTxCount:b=0,recentBlockHash:h,skipPreflight:y=!0}=A||{},I=h!=null?h:await Ye(this.connection,this.blockhashCommitment);if(a.forEach(async(p,P)=>{p.recentBlockhash=I,c[P].length&&p.sign(...c[P])}),qe(a),(k=this.owner)!=null&&k.isKeyPair){if(l){let p=0,P=[];for(let x of a){if(++p,p<=b){P.push("tx skipped");continue}let B=await Pn(this.connection,x,this.signers.find(S=>S.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});P.push(B)}return{txIds:P,signedTxs:a}}return{txIds:await Promise.all(a.map(async p=>await this.connection.sendRawTransaction(p.serialize(),{skipPreflight:y}))),signedTxs:a}}if(this.signAllTransactions){let p=await this.signAllTransactions(a.slice(b,a.length)),P=[...a.slice(0,b),...p];if(l){let x=0,B=[],S=async()=>{if(!P[x])return;x<b&&(B.push({txId:"",status:"success",signedTx:P[x]}),g==null||g([...B]),x++,S());let K=await this.connection.sendRawTransaction(P[x].serialize(),{skipPreflight:y});B.push({txId:K,status:"sent",signedTx:P[x]}),g==null||g([...B]),x++;let M=!1,w=null,L=null,v=C=>{w!==null&&clearInterval(w),L!==null&&this.connection.removeSignatureListener(L);let W=B.findIndex(G=>G.txId===K);if(W>-1){if(B[W].status==="error"||B[W].status==="success")return;B[W].status=C.err?"error":"success"}g==null||g([...B]),C.err||S()};this.loopMultiTxStatus&&(w=setInterval(async()=>{var C;if(M){clearInterval(w);return}try{let W=await this.connection.getTransaction(K,{commitment:"confirmed",maxSupportedTransactionVersion:0});W&&(M=!0,clearInterval(w),v({err:((C=W.meta)==null?void 0:C.err)||null}),console.log("tx status from getTransaction:",K))}catch(W){M=!0,clearInterval(w),console.error("getTransaction timeout:",W,K)}},ht)),L=this.connection.onSignature(K,C=>{if(M){this.connection.removeSignatureListener(L);return}M=!0,v(C)},"confirmed"),this.connection.getSignatureStatus(K)};return await S(),{txIds:B.map(K=>K.txId),signedTxs:P}}else{let x=[];for(let B=0;B<P.length;B+=1){let S=await this.connection.sendRawTransaction(P[B].serialize(),{skipPreflight:y});x.push(S)}return{txIds:x,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var I;let y=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:r=[]}=y,s=De(y,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):Ge),i),c=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let k of c)a[k]===void 0&&u.push(new Qe(k));let d=await Vt({connection:this.connection,address:u});for(let[k,p]of Object.entries(d))a[k]=p;let m=t?Pt(t):{instructions:[],instructionTypes:[]},T=await Ye(this.connection,this.blockhashCommitment),A=this.signers.reduce((k,p)=>H(_({},k),{[p.publicKey.toBase58()]:p}),{}),l=[],g=[],b=[],h=0;if(this.allInstructions.forEach(k=>{let p=[...b,k],P=t?[...m.instructions,...p]:p;if(k!==n[h]&&b.length<12&&(Re({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||Re({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(k);else{if(b.length===0)throw Error("item ins too big");h+=k===n[h]?1:0;let x={};for(let B of[...new Set(c)])a[B]!==void 0&&(x[B]=a[B]);if(t&&Re({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let B=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Me(B))}else{let B=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Me(B))}g.push(Array.from(new Set(b.map(B=>B.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(B=>A[B]).filter(B=>B!==void 0)),b=[k]}}),b.length>0){let p=[...new Set(b.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>A[P]).filter(P=>P!==void 0);if(t&&Re({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Me(P))}else{let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Me(P))}g.push(p)}return(I=this.owner)!=null&&I.signer&&g.forEach(k=>{k.some(p=>p.publicKey.equals(this.owner.publicKey))||k.push(this.owner.signer)}),l.forEach((k,p)=>{k.sign(g[p])}),{builder:this,transactions:l,buildProps:e,signers:g,blockHash:T,instructionTypes:this.instructionTypes,execute:async k=>{var K;let{sequentially:p,onTxUpdate:P,skipTxCount:x=0,recentBlockHash:B,skipPreflight:S=!0}=k||{};if(l.map(async(M,w)=>{g[w].length&&M.sign(g[w]),B&&(M.message.recentBlockhash=B)}),qe(l),(K=this.owner)!=null&&K.isKeyPair){if(p){let M=0,w=[];for(let L of l){if(++M,M<=x){console.log("skip tx: ",M),w.push("tx skipped");continue}let v=await this.connection.sendTransaction(L,{skipPreflight:S});await At(this.connection,v),w.push(v)}return{txIds:w,signedTxs:l}}return{txIds:await Promise.all(l.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:S}))),signedTxs:l}}if(this.signAllTransactions){let M=await this.signAllTransactions(l.slice(x,l.length)),w=[...l.slice(0,x),...M];if(p){let L=0,v=[],C=async()=>{if(!w[L])return;if(L<x){v.push({txId:"",status:"success",signedTx:w[L]}),P==null||P([...v]),L++,C();return}let W=await this.connection.sendTransaction(w[L],{skipPreflight:S});v.push({txId:W,status:"sent",signedTx:w[L]}),P==null||P([...v]),L++;let G=!1,U=null,Z=null,X=Q=>{U!==null&&clearInterval(U),Z!==null&&this.connection.removeSignatureListener(Z);let Y=v.findIndex(ie=>ie.txId===W);if(Y>-1){if(v[Y].status==="error"||v[Y].status==="success")return;v[Y].status=Q.err?"error":"success"}P==null||P([...v]),Q.err||C()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var Q;if(G){clearInterval(U);return}try{let Y=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(G=!0,clearInterval(U),X({err:((Q=Y.meta)==null?void 0:Q.err)||null}),console.log("tx status from getTransaction:",W))}catch(Y){G=!0,clearInterval(U),console.error("getTransaction timeout:",Y,W)}},ht)),Z=this.connection.onSignature(W,Q=>{if(G){this.connection.removeSignatureListener(Z);return}G=!0,X(Q)},"confirmed"),this.connection.getSignatureStatus(W)};return C(),{txIds:[],signedTxs:w}}else{let L=[];for(let v=0;v<w.length;v+=1){let C=await this.connection.sendTransaction(w[v],{skipPreflight:S});L.push(C)}return{txIds:L,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildSniperTransaction(e){var I;let y=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:r=[]}=y,s=De(y,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):await gn(this.connection)),i),c=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let k of c)a[k]===void 0&&u.push(new Qe(k));let d=await Vt({connection:this.connection,address:u});for(let[k,p]of Object.entries(d))a[k]=p;let m=t?Pt(t):{instructions:[],instructionTypes:[]},T=await Ye(this.connection,this.blockhashCommitment),A=this.signers.reduce((k,p)=>H(_({},k),{[p.publicKey.toBase58()]:p}),{}),l=[],g=[],b=[],h=0;if(this.allInstructions.forEach(k=>{let p=[...b,k],P=t?[...m.instructions,...p]:p;if(k!==n[h]&&b.length<12&&(Re({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||Re({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(k);else{if(b.length===0)throw Error("item ins too big");h+=k===n[h]?1:0;let x={};for(let B of[...new Set(c)])a[B]!==void 0&&(x[B]=a[B]);if(t&&Re({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let B=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Me(B))}else{let B=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Me(B))}g.push(Array.from(new Set(b.map(B=>B.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(B=>A[B]).filter(B=>B!==void 0)),b=[k]}}),b.length>0){let p=[...new Set(b.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>A[P]).filter(P=>P!==void 0);if(t&&Re({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Me(P))}else{let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Me(P))}g.push(p)}return(I=this.owner)!=null&&I.signer&&g.forEach(k=>{k.some(p=>p.publicKey.equals(this.owner.publicKey))||k.push(this.owner.signer)}),l.forEach((k,p)=>{k.sign(g[p])}),{builder:this,transactions:l,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async k=>{var K;let{sequentially:p,onTxUpdate:P,skipTxCount:x=0,recentBlockHash:B,skipPreflight:S=!0}=k||{};if(l.map(async(M,w)=>{g[w].length&&M.sign(g[w]),B&&(M.message.recentBlockhash=B)}),qe(l),(K=this.owner)!=null&&K.isKeyPair){if(p){let M=0,w=[];for(let L of l){if(++M,M<=x){console.log("skip tx: ",M),w.push("tx skipped");continue}let v=await this.connection.sendTransaction(L,{skipPreflight:S});await At(this.connection,v),w.push(v)}return{txIds:w,signedTxs:l}}return{txIds:await Promise.all(l.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:S}))),signedTxs:l}}if(this.signAllTransactions){let M=await this.signAllTransactions(l.slice(x,l.length)),w=[...l.slice(0,x),...M];if(p){let L=0,v=[],C=async()=>{if(!w[L])return;if(L<x){v.push({txId:"",status:"success",signedTx:w[L]}),P==null||P([...v]),L++,C();return}let W=await this.connection.sendTransaction(w[L],{skipPreflight:S});v.push({txId:W,status:"sent",signedTx:w[L]}),P==null||P([...v]),L++;let G=!1,U=null,Z=null,X=Q=>{U!==null&&clearInterval(U),Z!==null&&this.connection.removeSignatureListener(Z);let Y=v.findIndex(ie=>ie.txId===W);if(Y>-1){if(v[Y].status==="error"||v[Y].status==="success")return;v[Y].status=Q.err?"error":"success"}P==null||P([...v]),Q.err||C()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var Q;if(G){clearInterval(U);return}try{let Y=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(G=!0,clearInterval(U),X({err:((Q=Y.meta)==null?void 0:Q.err)||null}),console.log("tx status from getTransaction:",W))}catch(Y){G=!0,clearInterval(U),console.error("getTransaction timeout:",Y,W)}},ht)),Z=this.connection.onSignature(W,Q=>{if(G){this.connection.removeSignatureListener(Z);return}G=!0,X(Q)},"confirmed"),this.connection.getSignatureStatus(W)};return C(),{txIds:[],signedTxs:w}}else{let L=[];for(let v=0;v<w.length;v+=1){let C=await this.connection.sendTransaction(w[v],{skipPreflight:S});L.push(C)}return{txIds:L,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var An=(...o)=>o.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),rt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=oe(t)}createTxBuilder(e){return this.scope.checkOwner(),new xt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new Ie(e);return new xt({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(An(e))}logInfo(...e){this.logger.info(An(e))}logAndCreateError(...e){let t=An(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as wp}from"@solana/web3.js";import hp from"bn.js";import Ip from"decimal.js";import{AccountLayout as Kp,createAssociatedTokenAccountIdempotentInstruction as Np,TOKEN_2022_PROGRAM_ID as Rp,TOKEN_PROGRAM_ID as Lp}from"@solana/spl-token";import{PublicKey as Ec}from"@solana/web3.js";import{MintLayout as Wc,TOKEN_PROGRAM_ID as Vc}from"@solana/spl-token";import{Keypair as zd,PublicKey as Hd,SystemProgram as jd,TransactionInstruction as Zd}from"@solana/web3.js";import Jd from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as tp,TOKEN_2022_PROGRAM_ID as np,TOKEN_PROGRAM_ID as ip}from"@solana/spl-token";import{PublicKey as $r}from"@solana/web3.js";import Ii,{isBN as Si}from"bn.js";import{bits as Hc,BitStructure as Yc,blob as Gr,Blob as jc,cstr as Zc,f32 as Qc,f32be as Jc,f64 as $c,f64be as el,greedy as tl,Layout as Ur,ns64 as nl,ns64be as il,nu64 as rl,nu64be as ol,offset as Xr,s16 as sl,s16be as al,s24 as ul,s24be as cl,s32 as zr,s32be as ll,s40 as ml,s40be as dl,s48 as pl,s48be as fl,s8 as bl,seq as Hr,struct as yl,Structure as Yr,u16 as jr,u16be as gl,u24 as Pl,u24be as Al,u32 as Zr,u32be as Tl,u40 as kl,u40be as wl,u48 as Bl,u48be as hl,u8 as Qr,UInt as Jr,union as xl,Union as Il,unionLayoutDiscriminator as Sl,utf8 as Cl}from"@solana/buffer-layout";var Tn=Ur,Bi=Yr;var kn=Jr;var hi=Qr,Oe=jr;var wn=Zr;var Ee=zr;var xi=Hr;var ce=Gr;var Bn=Xr;var ot=class extends Tn{constructor(t,n,i){super(t,i);this.blob=ce(t),this.signed=n}decode(t,n=0){let i=new Ii(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Ii(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function E(o){return new kn(1,o)}function st(o){return new kn(4,o)}function f(o){return new ot(8,!1,o)}function ne(o){return new ot(16,!1,o)}function Ci(o){return new ot(8,!0,o)}function Ki(o){return new ot(16,!0,o)}var Je=class extends Tn{constructor(t,n,i,r){super(t.span,r);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function O(o){return new Je(ce(32),e=>new $r(e),e=>e.toBuffer(),o)}function xn(o){return new Je(hi(),eo,to,o)}function eo(o){if(o===0)return!1;if(o===1)return!0;throw new Error("Invalid bool: "+o)}function to(o){return o?1:0}function Ni(o,e){let t=wn("length"),n=V([t,z(o,Bn(t,-t.span),"values")]);return new Je(n,({values:i})=>i,i=>({values:i}),e)}function no(o){let e=wn("length"),t=V([e,ce(Bn(e,-e.span),"data")]);return new Je(t,({data:n})=>n,n=>({data:n}),o)}function le(o){return new Je(no(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),o)}var hn=class extends Bi{decode(e,t){return super.decode(e,t)}};function V(o,e,t){return new hn(o,e,t)}function z(o,e,t){let n,i=typeof e=="number"?e:Si(e)?e.toNumber():new Proxy(e,{get(r,s){if(!n){let a=Reflect.get(r,"count");n=Si(a)?a.toNumber():a,Reflect.set(r,"count",n)}return Reflect.get(r,s)},set(r,s,a){return s==="count"&&(n=a),Reflect.set(r,s,a)}});return xi(o,i,t)}import xd from"bn.js";import Sd from"decimal.js";import fe from"bn.js";var In=new fe(0),Ri=new fe(1),Li=new fe(-1),Se=new fe(1).shln(64),Fi=new fe(1).shln(128),Sn=Se.sub(Ri);var io=Fi.subn(1),at=-443636,It=-at,Cn=new fe("4295048016"),Kn=new fe("79226673521066979257578248091"),Vl=new fe("4295048017"),_l=new fe("79226673521066979257578248090");var ro=new fe(10).pow(new fe(6));var ql=new fe("18446744073700000000");import ld from"bn.js";import dd from"decimal.js";var Yl=Buffer.from("amm_config","utf8"),Mi=Buffer.from("pool","utf8"),Oi=Buffer.from("pool_vault","utf8"),jl=Buffer.from("pool_reward_vault","utf8"),Zl=Buffer.from("position","utf8"),Ql=Buffer.from("tick_array","utf8"),Jl=Buffer.from("operation","utf8"),$l=Buffer.from("pool_tick_array_bitmap_extension","utf8"),em=Buffer.from("observation","utf8");function Nn(o){return ue([Buffer.from("metadata","utf8"),tt.toBuffer(),o.toBuffer()],tt)}var tm=Buffer.from("locked_position","utf8");var nm=Buffer.from("support_mint","utf8");import{PublicKey as Em}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Wm}from"@solana/spl-token";import Vm from"bn.js";import qm from"decimal.js";import om from"bn.js";import am from"decimal.js";var Fn=14;var qt=60;var co=V([ce(8),E("bump"),Oe("index"),O(""),st("protocolFeeRate"),st("tradeFeeRate"),Oe("tickSpacing"),z(f(),8,"")]),lo=V([st("blockTimestamp"),Ci("tickCumulative"),z(f(),4)]),Xi=V([ce(8),xn("initialized"),f("recentEpoch"),Oe("observationIndex"),O("poolId"),z(lo,100,"observations"),z(f(),4)]),mo=V([E("rewardState"),f("openTime"),f("endTime"),f("lastUpdateTime"),ne("emissionsPerSecondX64"),f("rewardTotalEmissioned"),f("rewardClaimed"),O("tokenMint"),O("tokenVault"),O("creator"),ne("rewardGrowthGlobalX64")]),qi=V([ce(8),E("bump"),O("ammConfig"),O("creator"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("observationId"),E("mintDecimalsA"),E("mintDecimalsB"),Oe("tickSpacing"),ne("liquidity"),ne("sqrtPriceX64"),Ee("tickCurrent"),st(),ne("feeGrowthGlobalX64A"),ne("feeGrowthGlobalX64B"),f("protocolFeesTokenA"),f("protocolFeesTokenB"),ne("swapInAmountTokenA"),ne("swapOutAmountTokenB"),ne("swapInAmountTokenB"),ne("swapOutAmountTokenA"),E("status"),z(E(),7,""),z(mo,3,"rewardInfos"),z(f(),16,"tickArrayBitmap"),f("totalFeesTokenA"),f("totalFeesClaimedTokenA"),f("totalFeesTokenB"),f("totalFeesClaimedTokenB"),f("fundFeesTokenA"),f("fundFeesTokenB"),f("startTime"),z(f(),15*4-3,"padding")]),po=V([ne("growthInsideLastX64"),f("rewardAmountOwed")]),Gi=V([ce(8),E("bump"),O("nftMint"),O("poolId"),Ee("tickLower"),Ee("tickUpper"),ne("liquidity"),ne("feeGrowthInsideLastX64A"),ne("feeGrowthInsideLastX64B"),f("tokenFeesOwedA"),f("tokenFeesOwedB"),z(po,3,"rewardInfos"),z(f(),8,"")]),Ed=V([ce(8),E("bump"),O("poolId"),Ee("tickLowerIndex"),Ee("tickUpperIndex"),ne("liquidity"),ne("feeGrowthInsideLastX64A"),ne("feeGrowthInsideLastX64B"),f("tokenFeesOwedA"),f("tokenFeesOwedB"),z(ne(),3,"rewardGrowthInside"),z(f(),8,"")]),fo=V([Ee("tick"),Ki("liquidityNet"),ne("liquidityGross"),ne("feeGrowthOutsideX64A"),ne("feeGrowthOutsideX64B"),z(ne(),3,"rewardGrowthsOutsideX64"),z(st(),13,"")]),Di=V([ce(8),O("poolId"),Ee("startTickIndex"),z(fo,qt,"ticks"),E("initializedTickCount"),z(E(),115,"")]),bo=V([ce(329),z(O(),100,"whitelistMints")]),uo=V([ce(8),O("poolId"),z(z(f(),8),Fn,"positiveTickArrayBitmap"),z(z(f(),8),Fn,"negativeTickArrayBitmap")]),vd=V([f(),E("bump"),O("owner"),O("poolId"),O("positionId"),O("nftAccount"),z(f(),8)]),yo=V([ce(8),E("bump"),O("lockOwner"),O("poolId"),O("positionId"),O("nftAccount"),O("lockNftMint"),f("recentEpoch"),z(f(),8)]);Xi.span;var dp=oe("Raydium_Clmm");var To=Buffer.from("vault_auth_seed","utf8"),Pf=Buffer.from("global_config","utf8"),ko=Buffer.from("pool_vesting","utf8"),wo=Buffer.from("platform_config","utf8"),Bo=Buffer.from("platform_fee_vault_auth_seed","utf8"),ho=Buffer.from("creator_fee_vault_auth_seed","utf8");function Ce(o){return ue([To],o)}function ut(o,e,t){return ue([Mi,e.toBuffer(),t.toBuffer()],o)}function Mn(o,e,t){return ue([Oi,e.toBuffer(),t.toBuffer()],o)}function ct(o){return ue([Buffer.from("__event_authority","utf8")],o)}function On(o,e){return ue([wo,e.toBuffer()],o)}function Kt(o,e,t){return ue([ko,e.toBuffer(),t.toBuffer()],o)}function lt(o,e,t){return ue([e.toBuffer(),t.toBuffer()],o)}function En(o){return ue([Bo],o)}function mt(o,e,t){return ue([e.toBuffer(),t.toBuffer()],o)}function vn(o){return ue([ho],o)}import{ASSOCIATED_TOKEN_PROGRAM_ID as Gt,TOKEN_2022_PROGRAM_ID as So,TOKEN_PROGRAM_ID as Wn}from"@solana/spl-token";import{SystemProgram as we,TransactionInstruction as be}from"@solana/web3.js";import Nt from"bn.js";var Ue=V([f(),f("epoch"),E("curveType"),Oe("index"),f("migrateFee"),f("tradeFeeRate"),f("maxShareFeeRate"),f("minSupplyA"),f("maxLockRate"),f("minSellRateA"),f("minMigrateRateA"),f("minFundRaisingB"),O("mintB"),O("protocolFeeOwner"),O("migrateFeeOwner"),O("migrateToAmmWallet"),O("migrateToCpmmWallet"),z(f(),16)]),xo=V([f("totalLockedAmount"),f("cliffPeriod"),f("unlockPeriod"),f("startTime"),f("totalAllocatedShare")]),ke=V([f(),f("epoch"),E("bump"),E("status"),E("mintDecimalsA"),E("mintDecimalsB"),E("migrateType"),f("supply"),f("totalSellA"),f("virtualA"),f("virtualB"),f("realA"),f("realB"),f("totalFundRaisingB"),f("protocolFee"),f("platformFee"),f("migrateFee"),xo.replicate("vestingSchedule"),O("configId"),O("platformId"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("creator"),E("mintProgramFlag"),E("cpmmCreatorFeeOn"),z(E(),62)]),kf=V([f(),f("epoch"),O("poolId"),O("beneficiary"),f("claimedAmount"),f("tokenShareAmount"),z(f(),8)]),zi=V([E("migrateType"),E("migrateCpmmFeeOn"),f("supply"),f("totalSellA"),f("totalFundRaisingB"),f("totalLockedAmount"),f("cliffPeriod"),f("unlockPeriod")]),Io=V([f("epoch"),E("index"),O("configId"),zi.replicate("bondingCurveParam"),z(f(),50)]),dt=V([f(),f("epoch"),O("platformClaimFeeWallet"),O("platformLockNftWallet"),f("platformScale"),f("creatorScale"),f("burnScale"),f("feeRate"),z(E(),64,"name"),z(E(),256,"web"),z(E(),256,"img"),O("cpConfigId"),f("creatorFeeRate"),O("transferFeeExtensionAuth"),z(E(),180),Ni(Io,"platformCurve")]);var ye={initialize:Buffer.from([175,175,109,31,13,152,155,237]),initializeV2:Buffer.from([67,153,175,39,218,16,38,32]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252]),updatePlatformCurveParam:Buffer.from([138,144,138,250,220,128,4,57]),removePlatformCurveParam:Buffer.from([27,30,62,169,93,224,24,145])};function Hi(o,e,t,n,i,r,s,a,c,u,d,m,T,A,l,g,b,h,y,I,k){let p=V([E("decimals"),le("name"),le("symbol"),le("uri")]),P=V([f("totalLockedAmount"),f("cliffPeriod"),f("unlockPeriod"),E("cpmmCreatorFeeOn")]),x=V([E("index"),f("supply"),f("totalFundRaisingB"),E("migrateType")]),B=V([E("index"),f("supply"),f("totalSellA"),f("totalFundRaisingB"),E("migrateType")]),S=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:ct(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],K=Buffer.alloc(Buffer.from(A,"utf-8").length+Buffer.from(l,"utf-8").length+Buffer.from(g,"utf-8").length+4*3+1),M=Buffer.alloc(P.span),w=Buffer.alloc(b.type==="ConstantCurve"?B.span:x.span);return p.encode({decimals:T,name:A,symbol:l,uri:g},K),b.type==="ConstantCurve"?B.encode(H(_({index:0},b),{migrateType:b.migrateType==="amm"?0:1}),w):b.type==="FixedCurve"?x.encode(H(_({index:1},b),{migrateType:b.migrateType==="amm"?0:1}),w):b.type==="LinearCurve"&&x.encode(H(_({index:2},b),{migrateType:b.migrateType==="amm"?0:1}),w),P.encode({totalLockedAmount:h,cliffPeriod:y,unlockPeriod:I,cpmmCreatorFeeOn:k},M),new be({keys:S,programId:o,data:Buffer.from([...ye.initializeV2,...K,...w,...M])})}function Yi(o,e,t,n,i,r,s,a,c,u,d,m,T,A,l,g,b,h,y,I,k){let p=V([E("decimals"),le("name"),le("symbol"),le("uri")]),P=V([f("totalLockedAmount"),f("cliffPeriod"),f("unlockPeriod"),E("cpmmCreatorFeeOn"),E("transferFeeExtensionParamsOption"),V([Oe("transferFeeBasePoints"),f("maxinumFee")]).replicate("transferFeeExtensionParams")]),x=V([E("index"),f("supply"),f("totalFundRaisingB"),E("migrateType")]),B=V([E("index"),f("supply"),f("totalSellA"),f("totalFundRaisingB"),E("migrateType")]),S=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:So,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:ct(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],K=Buffer.alloc(Buffer.from(T,"utf-8").length+Buffer.from(A,"utf-8").length+Buffer.from(l,"utf-8").length+4*3+1),M=Buffer.alloc(P.span),w=Buffer.alloc(g.type==="ConstantCurve"?B.span:x.span);return p.encode({decimals:m,name:T,symbol:A,uri:l},K),g.type==="ConstantCurve"?B.encode(H(_({index:0},g),{migrateType:g.migrateType==="amm"?0:1}),w):g.type==="FixedCurve"?x.encode(H(_({index:1},g),{migrateType:g.migrateType==="amm"?0:1}),w):g.type==="LinearCurve"&&x.encode(H(_({index:2},g),{migrateType:g.migrateType==="amm"?0:1}),w),P.encode({totalLockedAmount:b,cliffPeriod:h,unlockPeriod:y,cpmmCreatorFeeOn:I,transferFeeExtensionParamsOption:k?1:0,transferFeeExtensionParams:k!=null?k:{transferFeeBasePoints:0,maxinumFee:new Nt(0)}},M),new be({keys:S,programId:o,data:Buffer.from([...ye.initializeWithToken2022,...K,...w,...M])})}function ji(o,e,t,n,i,r,s,a,c,u,d,m,T,A,l,g,b,h,y,I){let k=V([f("amountA"),f("maxAmountB"),f("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:ct(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&p.push({pubkey:I,isSigner:!1,isWritable:!0}),p.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:g,isSigner:!1,isWritable:!0});let P=Buffer.alloc(k.span);return k.encode({amountA:b,maxAmountB:h,shareFeeRate:y!=null?y:new Nt(0)},P),new be({keys:p,programId:o,data:Buffer.from([...ye.buyExactOut,...P])})}function Zi(o,e,t,n,i,r,s,a,c,u,d,m,T,A,l,g,b,h,y,I){let k=V([f("amountA"),f("minAmountB"),f("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:ct(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&p.push({pubkey:I,isSigner:!1,isWritable:!0}),p.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:g,isSigner:!1,isWritable:!0});let P=Buffer.alloc(k.span);return k.encode({amountA:b,minAmountB:h,shareFeeRate:y!=null?y:new Nt(0)},P),new be({keys:p,programId:o,data:Buffer.from([...ye.sellExactIn,...P])})}function Qi(o,e,t,n,i,r,s,a,c,u,d,m,T,A,l,g,b,h,y,I){let k=V([f("amountB"),f("maxAmountA"),f("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:ct(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&p.push({pubkey:I,isSigner:!1,isWritable:!0}),p.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:g,isSigner:!1,isWritable:!0});let P=Buffer.alloc(k.span);return k.encode({amountB:b,maxAmountA:h,shareFeeRate:y!=null?y:new Nt(0)},P),new be({keys:p,programId:o,data:Buffer.from([...ye.sellExactOut,...P])})}function Dn(o,e,t,n,i,r,s,a,c){let u=V([]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new be({keys:d,programId:o,data:Buffer.from([...ye.claimVestedToken,...m])})}function Vn(o,e,t,n,i,r){let s=V([f("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:r},c),new be({keys:a,programId:o,data:Buffer.from([...ye.createVestingAccount,...c])})}function _n(o,e,t,n,i,r,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!0},{pubkey:Gt,isSigner:!1,isWritable:!0}];return new be({keys:u,programId:o,data:ye.claimPlatformFee})}function Ji(o,e,t,n,i,r,s,a,c,u,d,m,T){let A=V([f("platformScale"),f("creatorScale"),f("burnScale"),f("feeRate"),le("name"),le("web"),le("img"),f("creatorFeeRate")]),l=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],g=Buffer.alloc(8*5+Buffer.from(d,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(T,"utf-8").length+4*3);return A.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:c,name:d,web:m,img:T,creatorFeeRate:u},g),new be({keys:l,programId:o,data:Buffer.from([...ye.createPlatformConfig,...g])})}function $i(o,e,t,n){let i=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],r;if(n.type==="updateClaimFeeWallet"){let s=V([E("index"),O("value")]);r=Buffer.alloc(s.span),s.encode({index:0,value:n.value},r)}else if(n.type==="updateLockNftWallet"){let s=V([E("index"),O("value")]);r=Buffer.alloc(s.span),s.encode({index:1,value:n.value},r)}else if(n.type==="migrateCpLockNftScale"){let s=V([E("index"),f("platformScale"),f("creatorScale"),f("burnScale")]);r=Buffer.alloc(s.span),s.encode(_({index:2},n.value),r)}else if(n.type==="updateFeeRate"){let s=V([E("index"),f("value")]);r=Buffer.alloc(s.span),s.encode({index:3,value:n.value},r)}else if(n.type==="updateImg"||n.type==="updateName"||n.type==="updateWeb"){let s=V([E("index"),le("value")]);r=Buffer.alloc(Buffer.from(n.value,"utf-8").length+4+1*1),n.type==="updateName"?s.encode({index:4,value:n.value},r):n.type==="updateWeb"?s.encode({index:5,value:n.value},r):n.type==="updateImg"&&s.encode({index:6,value:n.value},r)}else if(n.type==="updateCpConfigId"){i.push({pubkey:n.value,isSigner:!1,isWritable:!1});let s=V([E("index")]);r=Buffer.alloc(s.span),s.encode({index:7},r)}else if(n.type==="updateAll"){i.push({pubkey:n.value.cpConfigId,isSigner:!1,isWritable:!1});let s=V([E("index"),O("platformClaimFeeWallet"),O("platformLockNftWallet"),f("platformScale"),f("creatorScale"),f("burnScale"),f("feeRate"),le("name"),le("web"),le("img"),O("transferFeeExtensionAuth"),f("creatorFeeRate")]);r=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(n.value.name,"utf-8").length+Buffer.from(n.value.web,"utf-8").length+Buffer.from(n.value.img,"utf-8").length+32+8),s.encode({index:8,platformClaimFeeWallet:n.value.platformClaimFeeWallet,platformLockNftWallet:n.value.platformLockNftWallet,platformScale:n.value.migrateCpLockNftScale.platformScale,creatorScale:n.value.migrateCpLockNftScale.creatorScale,burnScale:n.value.migrateCpLockNftScale.burnScale,feeRate:n.value.feeRate,name:n.value.name,web:n.value.web,img:n.value.img,transferFeeExtensionAuth:n.value.transferFeeExtensionAuth,creatorFeeRate:n.value.creatorFeeRate},r)}else throw Error("updateInfo params type error");return new be({keys:i,programId:o,data:Buffer.from([...ye.updatePlaformConfig,...r])})}function qn(o,e,t,n,i,r,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}];return new be({keys:c,programId:o,data:ye.claimPlatformFeeFromVault})}function Gn(o,e,t,n,i,r,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}];return new be({keys:a,programId:o,data:ye.claimCreatorFee})}var Ff=new Nt("18446744073709551615");import{NATIVE_MINT as ve,TOKEN_2022_PROGRAM_ID as We,TOKEN_PROGRAM_ID as J,createAssociatedTokenAccountIdempotentInstruction as de,createSyncNativeInstruction as Co,getTransferFeeConfig as jt,unpackMint as Zt}from"@solana/spl-token";import D from"bn.js";import{PublicKey as nr,SystemProgram as Ko}from"@solana/web3.js";import ge from"bn.js";import tr from"decimal.js";import Ut from"bn.js";import Rt from"decimal.js";var Xe=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Xt=class extends Xe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Rt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new Rt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new Rt(e.virtualB.add(e.realB.add(r)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new Ut(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(r);if(a.lte(new Ut(0)))throw Error("tfMinusMf <= 0");let c=a.mul(n).mul(n).div(s),u=a.mul(n).div(s).sub(t),d=c.div(u),m=t.mul(t).div(u);if(d.lt(new Ut(0))||m.lt(new Ut(0)))throw Error("invalid input 0");return{a:d,b:m,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),r=t.add(e);return i.div(r)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),r=n.sub(e);return je(i,r)}};import zt from"bn.js";import Lt from"decimal.js";var Ht=class extends Xe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Lt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new Lt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new Lt(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new zt(0)))throw Error("invalid input 1");let a=new zt(2).mul(t).sub(r),u=t.mul(s).div(a);if(u.lt(new zt(0))||t.lt(new zt(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return je(i,n)}};import me from"bn.js";import $e from"decimal.js";import er from"bn.js";import Un from"decimal.js";var Ft=class{static _multipler(e){return new Un(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Un(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new er(i.mul(this._Q64).toFixed(0))}};Ft._Q64=new Un(new er(1).shln(64).toString());var Yt=class extends Xe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new $e(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new $e(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new $e(e.virtualA.mul(e.realA).toString()).div(Ft._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new $e(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new $e(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new me(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new me(3)).sub(r),u=t.mul(new me(2)).mul(s).div(a),d=u.mul(u),m=t.mul(new me(2)).mul(Se).div(d);if(!m.gt(new me(0)))throw Error("a need gt 0");if(!Sn.gt(m))throw Error("a need lt u64 max");if(m.lt(new me(0))||u.lt(new me(0)))throw Error("invalid input 0");return{a:m,b:new me(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new me(2).mul(n).mul(Se).div(e.virtualA);return new me(new $e(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return je(e.virtualA.mul(i),new me(2).mul(Se)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),r=je(e.virtualA.mul(i),new me(2).mul(Se));return e.realB.sub(r)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new me(2).mul(n).mul(Se).div(e.virtualA),r=new me(new $e(i.toString()).sqrt().toFixed(0));return e.realA.sub(r)}};var Pe=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let d=this.getCurve(e),m=d.getInitParam({supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a}),T=d.getPoolInitPriceByInit(H(_({},m),{decimalA:c,decimalB:u})),A=i.div(new ge(t-1)),l=new ge(0),g=[{price:T,totalSellSupply:0}],{a:b,b:h}=m,y=l,I=l;for(let k=1;k<t;k++){let p=k!==t-1?A:i.sub(I),P=this.buyExactIn({poolInfo:{virtualA:b,virtualB:h,realA:y,realB:I,totalFundRaisingB:i,totalSellA:r},amountB:p,protocolFeeRate:l,platformFeeRate:l,curveType:e,shareFeeRate:l,creatorFeeRate:l,transferFeeConfigA:void 0,slot:0});y=y.add(P.amountA.amount),I=I.add(P.amountB);let x=this.getPrice({poolInfo:{virtualA:b,virtualB:h,realA:y,realB:I},decimalA:c,decimalB:u,curveType:e});g.push({price:x,totalSellSupply:new tr(y.toString()).div(10**c).toNumber()})}return g}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:r,config:s,migrateType:a}){if(Number(r)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(Ze).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new ge(10**r))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(Ze);if(n.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let d=e.sub(n).sub(i),m=e.mul(s.minMigrateRateA).div(Ze);if(d.lt(m))throw Error("migrate lt min migrate amoount");let T=e.sub(n).sub(i),A=new ge(new tr(T.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let l=new ge(10).pow(new ge(r));if(A.lte(l))throw Error("check migrate lp error")}else if(a==="cpmm"){let l=new ge(100);if(A.lte(l))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:d}),T=t.sub(m),A=this.getCurve(r),l=A.buyExactIn({poolInfo:e,amount:T}),g=e.totalSellA.sub(e.realA),b,h,y;if(l.gt(g)){b=g;let k=A.buyExactOut({poolInfo:e,amount:b});h=this.calculatePreFee({postFeeAmount:k,feeRate:d}),y=h.sub(k)}else b=l,h=t,y=m;let I=this.splitFee({totalFee:y,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:pn(b,c,u),amountB:h,splitFee:I}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=e.totalSellA.sub(e.realA),m=fn(t,c,u),T=m.fee?m.amount.add(m.fee):m.amount;t.gt(d)&&(T=d);let l=this.getCurve(r).buyExactOut({poolInfo:e,amount:T}),g=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),b=this.calculatePreFee({postFeeAmount:l,feeRate:g}),h=b.sub(l),y=this.splitFee({totalFee:h,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:b,splitFee:y}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=this.getCurve(r),m=pn(t,c,u),T=m.fee?m.amount.sub(m.fee):m.amount,A=d.sellExactIn({poolInfo:e,amount:T}),l=this.calculateFee({amount:A,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a})}),g=this.splitFee({totalFee:l,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:A.sub(l),splitFee:g}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:d});if(e.realB.lt(m))throw Error("Insufficient liquidity");let T=m.sub(t),l=Pe.getCurve(r).sellExactOut({poolInfo:e,amount:m});if(l.gt(e.realA))throw Error();let g=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:fn(l,c,u),amountB:t,splitFee:g}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}),a=s.isZero()?new ge(0):e.mul(n).div(s),c=s.isZero()?new ge(0):e.mul(i).div(s),u=s.isZero()?new ge(0):e.mul(r).div(s),d=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:d,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return fi(e,t,Ze)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(Ze),i=Ze.sub(t);return n.add(i).sub(new ge(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new ge(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return Xt;case 1:return Ht;case 2:return Yt}throw Error("find curve error")}};import pe from"decimal.js";var et={initPriceX64:new D("515752397214619"),supply:new D(1e15),totalSellA:new D(7931e11),totalFundRaisingB:new D(85e9),totalLockedAmount:new D("0"),cliffPeriod:new D("0"),unlockPeriod:new D("0"),decimals:6,virtualA:new D("1073471847374405"),virtualB:new D("30050573465"),realA:new D(0),realB:new D(0),protocolFee:new D(0),platformId:new nr("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new D(0),cliffPeriod:new D(0),unlockPeriod:new D(0),startTime:new D(0),totalAllocatedShare:new D(0)}},ze=new D(1e4),Xn=class extends rt{constructor(e){super(e)}async sayHello(){console.log("hello")}async createLaunchpad(L){var v=L,{programId:e=re,authProgramId:t,platformId:n=et.platformId,mintA:i,decimals:r=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:d,configId:m,snipers:T,configInfo:A,platformFeeRate:l,txVersion:g,computeBudgetConfig:b,txTipConfig:h,feePayer:y,buyAmount:I,minMintAAmount:k,slippage:p,associatedOnly:P=!0,checkCreateATAOwner:x=!1,extraSigners:B,token2022:S,transferFeeExtensionParams:K,creatorFeeOn:M=0}=v,w=De(v,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","snipers","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams","creatorFeeOn"]);var Hn,Yn,jn,Zn,Qn,Jn,$n,ei,ti,ni;let C=[],W=this.createTxBuilder(y);t=t!=null?t:Ce(e).publicKey,S=!!K,S&&(d="cpmm");let G=A;if(!G&&m){let Ae=await this.scope.connection.getAccountInfo(m);Ae&&(G=Ue.decode(Ae.data))}G||this.logAndCreateError("config not found");let U=G.mintB,Z=G.curveType,{publicKey:X}=ut(e,i,U),{publicKey:Q}=Mn(e,X,i),{publicKey:Y}=Mn(e,X,U),{publicKey:ie}=Nn(i);console.log(`create token: ${i.toBase58()}, mintB: ${U.toBase58()}, decimals A:${r}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let j=(Hn=w==null?void 0:w.supply)!=null?Hn:et.supply,q=(Yn=w==null?void 0:w.totalSellA)!=null?Yn:et.totalSellA,ae=(jn=w==null?void 0:w.totalFundRaisingB)!=null?jn:et.totalFundRaisingB,Ke=(Zn=w==null?void 0:w.totalLockedAmount)!=null?Zn:new D(0),ee=l;if(!l){let Ae=await this.scope.connection.getAccountInfo(n);Ae||this.logAndCreateError("platform id not found:",n.toString()),ee=dt.decode(Ae.data).feeRate}let zn=Pe.getCurve(G.curveType).getInitParam({supply:j,totalFundRaising:ae,totalSell:q,totalLockedAmount:Ke,migrateFee:G.migrateFee}),Be={epoch:new D(896),bump:254,status:0,mintDecimalsA:r,mintDecimalsB:s,supply:j,totalSellA:q,mintA:new nr(i),mintB:U,virtualA:zn.a,virtualB:zn.b,realA:et.realA,realB:et.realB,migrateFee:G.migrateFee,migrateType:d==="amm"?0:1,protocolFee:et.protocolFee,platformFee:ee,platformId:n,configId:m,vaultA:Q,vaultB:Y,creator:this.scope.ownerPubKey,totalFundRaisingB:ae,vestingSchedule:{totalLockedAmount:Ke,cliffPeriod:new D(0),unlockPeriod:new D(0),startTime:new D(0),totalAllocatedShare:new D(0)},mintProgramFlag:S?1:0,cpmmCreatorFeeOn:M},ir=Pe.getCurve(G.curveType),{c:rr}=ir.getInitParam({supply:Be.supply,totalFundRaising:Be.totalFundRaisingB,totalLockedAmount:Ke,totalSell:G.curveType===0?Be.totalSellA:new D(0),migrateFee:G.migrateFee});try{Pe.checkParam({supply:Be.supply,totalFundRaising:Be.totalFundRaisingB,totalSell:rr,totalLockedAmount:Ke,decimals:Be.mintDecimalsA,config:G,migrateType:d}),this.logDebug("check init params success")}catch(Ae){this.logAndCreateError(`check create mint params failed, ${Ae.message}`)}W.addInstruction({instructions:[S?Yi(e,y!=null?y:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,X,i,U,Q,Y,r,a,c,u||"https://",{type:Z===0?"ConstantCurve":Z===1?"FixedCurve":Z===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:d,supply:j,totalFundRaisingB:ae},Ke,(Qn=w==null?void 0:w.cliffPeriod)!=null?Qn:new D(0),(Jn=w==null?void 0:w.unlockPeriod)!=null?Jn:new D(0),M,K):Hi(e,y!=null?y:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,X,i,U,Q,Y,ie,r,a,c,u||"https://",{type:Z===0?"ConstantCurve":Z===1?"FixedCurve":Z===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:d,supply:j,totalFundRaisingB:ae},Ke,($n=w==null?void 0:w.cliffPeriod)!=null?$n:new D(0),(ei=w==null?void 0:w.unlockPeriod)!=null?ei:new D(0),M)]});let Qt=S?await this.scope.connection.getEpochInfo():void 0,Ne=K?{epoch:BigInt((Qt==null?void 0:Qt.epoch)||0),maximumFee:BigInt((ti=K==null?void 0:K.maxinumFee.toString())!=null?ti:0),transferFeeBasisPoints:(ni=K==null?void 0:K.transferFeeBasePoints)!=null?ni:0}:void 0,Jt={amountA:{amount:new D(0),fee:void 0,expirationTime:void 0},amountB:new D(0),splitFee:{platformFee:new D(0),shareFee:new D(0),protocolFee:new D(0),creatorFee:new D(0)}},$t;if(B!=null&&B.length&&W.addInstruction({signers:B}),!w.createOnly){let{builder:Ae,extInfo:or}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:S?We:void 0,mintA:i,mintB:U,poolInfo:Be,buyAmount:I,minMintAAmount:k,shareFeeRate:w.shareFeeRate,shareFeeReceiver:w.shareFeeReceiver,configInfo:G,platformFeeRate:ee,slippage:p,associatedOnly:P,checkCreateATAOwner:x,skipCheckMintA:!Ne,transferFeeConfigA:Ne?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Ne,newerTransferFee:Ne}:void 0,fromCreate:!0});console.log("FEE: ",Ne),console.log("PREPARING SNIPER TRANSACTIONS");for(let ii of T){let{builder:sr,extInfo:Ro}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:S?We:void 0,mintA:i,mintB:U,poolInfo:Be,buyAmount:ii.amount,minMintAAmount:k,shareFeeRate:w.shareFeeRate,shareFeeReceiver:w.shareFeeReceiver,configInfo:G,platformFeeRate:ee,slippage:p,sniper:ii,associatedOnly:P,checkCreateATAOwner:x,skipCheckMintA:!Ne,transferFeeConfigA:Ne?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Ne,newerTransferFee:Ne}:void 0,fromCreate:!0});C.push(H(_({},sr.AllTxData),{blockHash:this.scope.blockhashCommitment}))}W.addInstruction(_({},Ae.AllTxData)),Jt=_({},or),$t=(this.scope.cluster==="devnet"||g===1)&&w.shareFeeReceiver?[Ae.allInstructions[0]]:void 0}return g===0?(console.log("VERSION V0"),{tx:await W.sizeCheckBuildV0({computeBudgetConfig:b,swapInfo:Jt,splitIns:$t,address:H(_({},Be),{poolId:X})}),txs:C}):(console.log("VERSION PLAIN"),{tx:await W.sizeCheckBuild({computeBudgetConfig:b,swapInfo:Jt,splitIns:$t,address:H(_({},Be),{poolId:X})}),txs:C})}async buyToken({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=J,mintB:r=ve,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:d,txTipConfig:m,feePayer:T,buyAmount:A,minMintAAmount:l,slippage:g,shareFeeRate:b=new D(0),shareFeeReceiver:h,sniper:y,associatedOnly:I=!0,checkCreateATAOwner:k=!1,fromCreate:p=!1,transferFeeConfigA:P,skipCheckMintA:x=!1}){var q,ae,Ke;A.lte(new D(0))&&this.logAndCreateError("buy amount should gt 0:",A.toString());let B=y?this.createSniperTxBuilder(y.owner,y.owner.publicKey):this.createTxBuilder(T),{publicKey:S}=ut(e,n,r);t=t!=null?t:Ce(e).publicKey;let K=P;if(!x)if(console.log("!skipCheckMintA: ",x),K)console.log("mintAProgram: ",We),i=We;else{console.log("!transferFeeConfigA: ",K);let ee=await this.scope.connection.getAccountInfo(n);if(ee&&ee.owner.equals(We)){console.log("!mintInfo: ",ee),i=ee.owner;let pt=Zt(n,ee,i);K=jt(pt)||void 0}}let M=y?this.scope.account.getAssociatedTokenAccountByOwner(y.owner.publicKey,n,i):this.scope.account.getAssociatedTokenAccount(n,i),w=p?y?this.scope.account.getAssociatedTokenAccountByOwner(y.owner.publicKey,r,J):this.scope.account.getAssociatedTokenAccount(r,J):null,L=r.equals(ve),v=[de((y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,M,(y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,n,i),...p?[de((y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,w,(y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,r,J),Ko.transfer({fromPubkey:(y==null?void 0:y.owner.publicKey)||this.scope.ownerPubKey,toPubkey:w,lamports:BigInt(A.toString())}),Co(w)]:[]];if(B.addInstruction({instructions:v}),!p){let{account:ee,instructionParams:pt}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:L?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!L,notUseTokenAccount:L,associatedOnly:L?!1:I,checkCreateATAOwner:k});ee&&(w=ee)}w===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let C=s;if(!C){let ee=await this.scope.connection.getAccountInfo(S,{commitment:"processed"});ee||this.logAndCreateError("cannot found pool:",S.toBase58()),C=ke.decode(ee.data)}let W=a,G=await Le(this.scope.connection,[W?void 0:C.configId,C.platformId].filter(Boolean).map(ee=>({pubkey:ee})));if(!W){let ee=G.find(pt=>pt.pubkey.equals(C.configId));(!ee||!ee.accountInfo)&&this.logAndCreateError("config not found: ",C.configId.toBase58()),W=Ue.decode(ee.accountInfo.data)}let U=G.find(ee=>ee.pubkey.equals(C.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",C.configId.toBase58());let Z=dt.decode(U.accountInfo.data);c=c||Z.feeRate;let X=Pe.buyExactIn({poolInfo:C,amountB:A,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:b,creatorFeeRate:Z.creatorFeeRate,transferFeeConfigA:K,slot:await this.scope.connection.getSlot()}),Q=new pe(X.amountA.amount.toString()).sub((ae=(q=X.amountA.fee)==null?void 0:q.toString())!=null?ae:0),Y=g?new pe(ze.sub(g).toNumber()/ze.toNumber()).clampedTo(0,1):new pe(1),ie=l!=null?l:g?new D(Q.mul(Y).toFixed(0)):X.amountA.amount.sub((Ke=X.amountA.fee)!=null?Ke:new D(0));X.amountB.lt(A)&&console.log(`maximum ${n.toBase58()} amount can buy is ${X.amountA.toString()}, input ${r.toBase58()} amount: ${X.amountB.toString()}`);let j=h?Te(h,r,J).publicKey:void 0;return B.addCustomComputeBudget(d),B.addTipInstruction(m),B.versionBuild({txVersion:u,extInfo:H(_({},X),{decimalOutAmount:Q,minDecimalOutAmount:new pe(ie.toString())})})}async buyTokenExactOut({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=J,mintB:r=ve,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:d,computeBudgetConfig:m,txTipConfig:T,feePayer:A,maxBuyAmount:l,outAmount:g,slippage:b,shareFeeRate:h=new D(0),shareFeeReceiver:y,associatedOnly:I=!0,checkCreateATAOwner:k=!1,skipCheckMintA:p=!1}){g.lte(new D(0))&&this.logAndCreateError("out amount should gt 0:",g.toString());let P=this.createTxBuilder(A),{publicKey:x}=ut(e,n,r);t=t!=null?t:Ce(e).publicKey;let B=s;if(!B){let j=await this.scope.connection.getAccountInfo(x,{commitment:"processed"});j||this.logAndCreateError("cannot found pool:",x.toBase58()),B=ke.decode(j.data)}let S=a,K=await Le(this.scope.connection,[S?void 0:B.configId,B.platformId].filter(Boolean).map(j=>({pubkey:j})));if(!S){let j=K.find(q=>q.pubkey.equals(B.configId));(!j||!j.accountInfo)&&this.logAndCreateError("config not found: ",B.configId.toBase58()),S=Ue.decode(j.accountInfo.data)}let M=K.find(j=>j.pubkey.equals(B.platformId));(!M||!M.accountInfo)&&this.logAndCreateError("platform info not found: ",B.configId.toBase58());let w=dt.decode(M.accountInfo.data);u=u||w.feeRate;let L=c;if(!p)if(L)i=We;else{let j=await this.scope.connection.getAccountInfo(n);if(j&&j.owner.equals(We)){i=j.owner;let q=Zt(n,j,i);L=jt(q)||void 0}}let v=Pe.buyExactOut({poolInfo:B,amountA:g,protocolFeeRate:S.tradeFeeRate,platformFeeRate:u,curveType:S.curveType,shareFeeRate:h,creatorFeeRate:w.creatorFeeRate,transferFeeConfigA:L,slot:await this.scope.connection.getSlot()}),C=new pe(v.amountB.toString()),W=b?new pe(ze.add(b).toNumber()/ze.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new pe(1),G=(l!=null?l:b)?new D(C.mul(W).toFixed(0)):v.amountB,U=this.scope.account.getAssociatedTokenAccount(n,i),Z=null,X=r.equals(ve);P.addInstruction({instructions:[de(this.scope.ownerPubKey,U,this.scope.ownerPubKey,n,i)]});let{account:Q,instructionParams:Y}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:X?{payer:this.scope.ownerPubKey,amount:v.amountB}:void 0,skipCloseAccount:!X,notUseTokenAccount:X,associatedOnly:X?!1:I,checkCreateATAOwner:k});Q&&(Z=Q),P.addInstruction(Y||{}),Z===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let ie=y?Te(y,r,J).publicKey:void 0;return ie&&P.addInstruction({instructions:[de(this.scope.ownerPubKey,ie,y,r)]}),P.addInstruction({instructions:[ji(e,this.scope.ownerPubKey,t,B.configId,B.platformId,x,U,Z,B.vaultA,B.vaultB,n,r,i,J,lt(e,B.platformId,r).publicKey,mt(e,B.creator,r).publicKey,g,G,h,ie)]}),P.addCustomComputeBudget(m),P.addTipInstruction(T),P.versionBuild({txVersion:d,extInfo:{maxSpentAmount:G,outAmount:g}})}async sellToken({programId:e=re,authProgramId:t,mintAProgram:n=J,mintA:i,mintB:r=ve,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:d,txTipConfig:m,feePayer:T,sellAmount:A,minAmountB:l,slippage:g,shareFeeRate:b=new D(0),shareFeeReceiver:h,associatedOnly:y=!0,checkCreateATAOwner:I=!1,skipCheckMintA:k=!1}){t=t!=null?t:Ce(e).publicKey;let p=this.createTxBuilder(T);A.lte(new D(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:P}=ut(e,i,r),x;if(!k){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(We)){n=q.owner;let ae=Zt(i,q,n);x=jt(ae)||void 0}}let B=null,S=null,K=r.equals(ve),{account:M,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:y,checkCreateATAOwner:I});M&&(B=M),p.addInstruction(w||{}),B===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:K?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!K,notUseTokenAccount:K,associatedOnly:K?!1:y,checkCreateATAOwner:I});L&&(S=L),p.addInstruction(v||{}),S===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let C=s;if(!C){let q=await this.scope.connection.getAccountInfo(P,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",P.toBase58()),C=ke.decode(q.data)}let W=a,G=await Le(this.scope.connection,[W?void 0:C.configId,C.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!W){let q=G.find(ae=>ae.pubkey.equals(C.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",C.configId.toBase58()),W=Ue.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(C.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",C.configId.toBase58());let Z=dt.decode(U.accountInfo.data);c=c||Z.feeRate;let X=Pe.sellExactIn({poolInfo:C,amountA:A,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:b,creatorFeeRate:Z.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Q=new pe(X.amountB.toString()),Y=g?new pe(ze.sub(g).toNumber()/ze.toNumber()).clampedTo(0,1):new pe(1),ie=l!=null?l:g?new D(Q.mul(Y).toFixed(0)):X.amountB;ie.lte(new D(0))&&this.logAndCreateError(`out ${r.toBase58()} amount should be gt 0`);let j=h?Te(h,r,J).publicKey:void 0;return j&&p.addInstruction({instructions:[de(this.scope.ownerPubKey,j,h,r)]}),p.addInstruction({instructions:[Zi(e,this.scope.ownerPubKey,t,C.configId,C.platformId,P,B,S,C.vaultA,C.vaultB,i,r,n,J,lt(e,C.platformId,r).publicKey,mt(e,C.creator,r).publicKey,X.amountA.amount.lt(A)?X.amountA.amount:A,ie,b,j)]}),p.addCustomComputeBudget(d),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{outAmount:ie}})}async sellTokenExactOut({programId:e=re,authProgramId:t,mintAProgram:n=J,mintA:i,mintB:r=ve,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:d,txTipConfig:m,feePayer:T,inAmount:A,maxSellAmount:l,slippage:g,shareFeeRate:b=new D(0),shareFeeReceiver:h,associatedOnly:y=!0,checkCreateATAOwner:I=!1,skipCheckMintA:k=!1}){t=t!=null?t:Ce(e).publicKey;let p=this.createTxBuilder(T);l!=null&&l.lte(new D(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:P}=ut(e,i,r),x;if(!k){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(We)){n=q.owner;let ae=Zt(i,q,n);x=jt(ae)||void 0}}let B=null,S=null,K=r.equals(ve),{account:M,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:y,checkCreateATAOwner:I});M&&(B=M),p.addInstruction(w||{}),B===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:K?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!K,notUseTokenAccount:K,associatedOnly:K?!1:y,checkCreateATAOwner:I});L&&(S=L),p.addInstruction(v||{}),S===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let C=s;if(!C){let q=await this.scope.connection.getAccountInfo(P,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",P.toBase58()),C=ke.decode(q.data)}let W=a,G=await Le(this.scope.connection,[W?void 0:C.configId,C.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!W){let q=G.find(ae=>ae.pubkey.equals(C.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",C.configId.toBase58()),W=Ue.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(C.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",C.configId.toBase58());let Z=dt.decode(U.accountInfo.data);c=c||Z.feeRate;let X=Pe.sellExactOut({poolInfo:C,amountB:A,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:b,creatorFeeRate:Z.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Q=new pe(X.amountA.amount.toString()),Y=g?new pe(ze.add(g).toNumber()/ze.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new pe(1),ie=(l!=null?l:g)?new D(Q.mul(Y).toFixed(0)):X.amountA.amount,j=h?Te(h,r,J).publicKey:void 0;return j&&p.addInstruction({instructions:[de(this.scope.ownerPubKey,j,h,r)]}),p.addInstruction({instructions:[Qi(e,this.scope.ownerPubKey,t,C.configId,C.platformId,P,B,S,C.vaultA,C.vaultB,i,r,n,J,lt(e,C.platformId,r).publicKey,mt(e,C.creator,r).publicKey,A,ie,b,j)]}),p.addCustomComputeBudget(d),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{maxSellAmount:ie}})}async createPlatformConfig({programId:e=re,platformAdmin:t,platformClaimFeeWallet:n,platformLockNftWallet:i,cpConfigId:r,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:c,feeRate:u,name:d,web:m,img:T,txVersion:A,computeBudgetConfig:l,txTipConfig:g,feePayer:b}){let h=this.createTxBuilder(b),{publicKey:y}=On(e,t);return h.addInstruction({instructions:[Ji(e,t,n,i,y,r,a,s,u,c,d,m,T)]}),h.addCustomComputeBudget(l),h.addTipInstruction(g),h.versionBuild({txVersion:A,extInfo:{platformId:y}})}async updatePlatformConfig({programId:e=re,platformAdmin:t,platformId:n,updateInfo:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),d=n!=null?n:On(e,t).publicKey;return u.addInstruction({instructions:[$i(e,t,d,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async claimPlatformFee({programId:e=re,authProgramId:t,platformId:n,poolId:i,platformClaimFeeWallet:r,mintB:s,vaultB:a,mintBProgram:c=J,txVersion:u,computeBudgetConfig:d,txTipConfig:m,feePayer:T}){var h;let A=this.createTxBuilder(T);t=t!=null?t:Ce(e).publicKey;let l=s,g=a;if(!l){let y=await this.scope.connection.getAccountInfo(i,{commitment:"processed"});y||this.logAndCreateError("cannot found pool:",i.toBase58());let I=ke.decode(y.data),k=await this.scope.connection.getAccountInfo(I.configId,{commitment:"processed"});k||this.logAndCreateError("cannot found config:",I.configId.toBase58()),l=Ue.decode(k.data).mintB,g=g!=null?g:I.vaultB}(!l||!g)&&this.logAndCreateError("cannot found mint info, mintB: ",l.toBase58(),", vaultB: ",(h=g==null?void 0:g.toBase58())!=null?h:"");let b=Te(this.scope.ownerPubKey,l,J).publicKey;return A.addInstruction({instructions:[de(this.scope.ownerPubKey,b,this.scope.ownerPubKey,l)]}),A.addInstruction({instructions:[_n(e,r,t,i,n,g,b,l,c)]}),A.addCustomComputeBudget(d),A.addTipInstruction(m),A.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=re,authProgramId:t,platformId:n,platformClaimFeeWallet:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:Ce(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:ke.span},{memcmp:{offset:ke.offsetOf("platformId"),bytes:n.toString()}}]})).forEach(m=>{let T=ke.decode(m.account.data);if(T.platformFee.lte(new D(0)))return;let A=Te(this.scope.ownerPubKey,T.mintB,J).publicKey;u.addInstruction({instructions:[de(this.scope.ownerPubKey,A,this.scope.ownerPubKey,T.mintB)]}),u.addInstruction({instructions:[_n(e,i,t,m.pubkey,n,T.vaultB,A,T.mintB,J)]})}),u.addTipInstruction(a),r===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=re,poolId:t,beneficiary:n,shareAmount:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),d=await this.getRpcPoolInfo({poolId:t});i.add(d.vestingSchedule.totalAllocatedShare).gt(d.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=Kt(e,t,n).publicKey;return u.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,n,t,m,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async createMultipleVesting({programId:e=re,poolId:t,beneficiaryList:n,txVersion:i,computeBudgetConfig:r,feePayer:s}){let a=this.createTxBuilder(s);n.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return n.reduce((d,m)=>d.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),n.forEach(d=>{let m=Kt(e,t,d.wallet).publicKey;a.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,d.wallet,t,m,d.shareAmount)]})}),i===0?a.sizeCheckBuildV0({computeBudgetConfig:r}):a.sizeCheckBuild({computeBudgetConfig:r})}async claimVesting({programId:e=re,poolId:t,poolInfo:n,vestingRecord:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),d=Ce(e).publicKey,m=i||Kt(e,t,this.scope.ownerPubKey).publicKey,T=n;if(!T){let l=await this.scope.connection.getAccountInfo(t);l||this.logAndCreateError("pool not found"),T=ke.decode(l.data)}let A=Te(this.scope.ownerPubKey,T.mintA,J).publicKey;return u.addInstruction({instructions:[de(this.scope.ownerPubKey,A,this.scope.ownerPubKey,T.mintA)]}),u.addInstruction({instructions:[Dn(e,this.scope.ownerPubKey,d,t,m,A,T.vaultA,T.mintA,J)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async claimMultiVesting({programId:e=re,poolIdList:t,poolsInfo:n={},vestingRecords:i={},txVersion:r,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=_({},n),d=Ce(e).publicKey,m=t.filter(T=>!u[T.toBase58()]);if(m.length){let T=await this.getRpcPoolsInfo({poolIdList:m});u=_(_({},u),T.poolInfoMap)}return t.forEach(T=>{let A=T.toBase58(),l=u[A];l||this.logAndCreateError(`pool info not found: ${A}`);let g=i[A]||Kt(e,T,this.scope.ownerPubKey).publicKey,b=Te(this.scope.ownerPubKey,l.mintA,J).publicKey;c.addInstruction({instructions:[de(this.scope.ownerPubKey,b,this.scope.ownerPubKey,l.mintA)]}),c.addInstruction({instructions:[Dn(e,this.scope.ownerPubKey,d,T,g,b,l.vaultA,l.mintA,J)]})}),r===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=re,platformId:t,mintB:n,mintBProgram:i=J,claimFeeWallet:r,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let d=this.createTxBuilder(u),m=lt(e,t,n).publicKey,T=En(e).publicKey,A=this.scope.account.getAssociatedTokenAccount(n,i);return d.addInstruction({instructions:[de(this.scope.ownerPubKey,A,this.scope.ownerPubKey,n,i),qn(e,t,r!=null?r:this.scope.ownerPubKey,T,m,A,n,i)]}),d.addCustomComputeBudget(a),d.addTipInstruction(c),d.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=re,platformList:t,unwrapSol:n=!0,txVersion:i,computeBudgetConfig:r,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),d={};return t.forEach(async m=>{var b,h;let T=En(e).publicKey,A=lt(e,m.id,m.mintB).publicKey,l=m.mintB.equals(ve)&&n,g=d[m.mintB.toBase58()];if(!g){let{account:y,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:l?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!l,notUseTokenAccount:l,associatedOnly:l?!1:a,checkCreateATAOwner:c});y&&(g=y),u.addInstruction(I||{}),g===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[qn(e,m.id,(b=m.claimFeeWallet)!=null?b:this.scope.ownerPubKey,A,T,g,m.mintB,(h=m.mintBProgram)!=null?h:J)]})}),i===0?u.sizeCheckBuildV0({computeBudgetConfig:r}):u.sizeCheckBuild({computeBudgetConfig:r})}async claimCreatorFee({programId:e=re,mintB:t,mintBProgram:n=J,txVersion:i,computeBudgetConfig:r,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=mt(e,this.scope.ownerPubKey,t).publicKey,d=vn(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,n);return c.addInstruction({instructions:[de(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,n),Gn(e,this.scope.ownerPubKey,d,u,m,t,n)]}),c.addCustomComputeBudget(r),c.addTipInstruction(s),c.versionBuild({txVersion:i})}async claimMultipleCreatorFee({programId:e=re,mintBList:t,txVersion:n,computeBudgetConfig:i,feePayer:r}){let s=this.createTxBuilder(r);return t.forEach(a=>{var A;let c=a.pubKey,u=(A=a.programId)!=null?A:J,d=mt(e,this.scope.ownerPubKey,c).publicKey,m=vn(e).publicKey,T=this.scope.account.getAssociatedTokenAccount(c,u);s.addInstruction({instructions:[de(this.scope.ownerPubKey,T,this.scope.ownerPubKey,c,u),Gn(e,this.scope.ownerPubKey,m,d,T,c,u)]})}),n==0?s.sizeCheckBuildV0({computeBudgetConfig:i}):s.sizeCheckBuild({computeBudgetConfig:i})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let n=await Le(this.scope.connection,e.map(c=>({pubkey:c})),t),i={},r=[];for(let c=0;c<e.length;c++){let u=n[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let d=ke.decode(u.accountInfo.data);i[e[c].toBase58()]=H(_({},d),{poolId:u.accountInfo.owner}),r.push(d.configId)}let s=await Le(this.scope.connection,r.map(c=>({pubkey:c})),t),a={};for(let c=0;c<r.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+r[c].toBase58());let d=Ue.decode(u.accountInfo.data);a[r[c].toBase58()]=H(_({},d),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(i).reduce((c,u)=>H(_({},c),{[u]:H(_({},i[u]),{configInfo:a[i[u].configId.toBase58()]})}),{})}}};export{et as LaunchpadPoolInitParam,Xn as default};
//# sourceMappingURL=launchpad.mjs.map