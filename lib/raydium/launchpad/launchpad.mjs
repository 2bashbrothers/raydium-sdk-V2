var ur=Object.defineProperty,cr=Object.defineProperties;var lr=Object.getOwnPropertyDescriptors;var Mt=Object.getOwnPropertySymbols;var oi=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable;var ri=(o,e,t)=>e in o?ur(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,_=(o,e)=>{for(var t in e||(e={}))oi.call(e,t)&&ri(o,t,e[t]);if(Mt)for(var t of Mt(e))si.call(e,t)&&ri(o,t,e[t]);return o},Y=(o,e)=>cr(o,lr(e));var De=(o,e)=>{var t={};for(var n in o)oi.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&Mt)for(var n of Mt(o))e.indexOf(n)<0&&si.call(o,n)&&(t[n]=o[n]);return t};import{get as ai,set as mr}from"lodash";var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ui={},dr={};function oe(o){let e=ai(ui,o);if(!e){let t=ai(dr,o);e=new en({name:o,logLevel:t}),mr(ui,o,e)}return e}import{PublicKey as Qe,sendAndConfirmTransaction as Pn,SystemProgram as qr,Transaction as ht,TransactionMessage as Fe,VersionedTransaction as Me}from"@solana/web3.js";import Gr from"axios";import{PublicKey as yn,AddressLookupTableAccount as at}from"@solana/web3.js";import{PublicKey as _r}from"@solana/web3.js";import xe from"bn.js";import pa from"decimal.js";import Tr from"big.js";import Qo from"bn.js";import pr from"toformat";var fr=pr,bt=fr;import Et from"big.js";import yr from"bn.js";import gr from"decimal.js-light";import yt from"bn.js";var ci=9007199254740991;function he(o){let e=oe("Raydium_parseBigNumberish");if(o instanceof yt)return o;if(typeof o=="string"){if(o.match(/^-?[0-9]+$/))return new yt(o);e.logWithError(`invalid BigNumberish string: ${o}`)}return typeof o=="number"?(o%1&&e.logWithError(`BigNumberish number underflow: ${o}`),(o>=ci||o<=-ci)&&e.logWithError(`BigNumberish number overflow: ${o}`),new yt(String(o))):typeof o=="bigint"?new yt(o.toString()):(e.error(`invalid BigNumberish value: ${o}`),new yt(0))}var Ot=oe("module/fraction"),tn=bt(Et),gt=bt(gr),Pr={[0]:gt.ROUND_DOWN,[1]:gt.ROUND_HALF_UP,[2]:gt.ROUND_UP},Ar={[0]:Et.roundDown,[1]:Et.roundHalfUp,[2]:Et.roundUp},$=class{constructor(e,t=new yr(1)){this.numerator=he(e),this.denominator=he(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new $(this.denominator,this.numerator)}add(e){let t=e instanceof $?e:new $(he(e));return this.denominator.eq(t.denominator)?new $(this.numerator.add(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof $?e:new $(he(e));return this.denominator.eq(t.denominator)?new $(this.numerator.sub(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof $?e:new $(he(e));return new $(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof $?e:new $(he(e));return new $(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<=0&&Ot.logWithError(`${e} is not positive.`),gt.set({precision:e+1,rounding:Pr[n]});let i=new gt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<0&&Ot.logWithError(`${e} is negative.`),tn.DP=e,tn.RM=Ar[n]||1,new tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ss=oe("Raydium_amount"),as=bt(Tr);import{PublicKey as kr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as li}from"@solana/spl-token";var nn={chainId:101,address:kr.default.toBase58(),programId:li.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ve={chainId:101,address:"So11111111111111111111111111111111111111112",programId:li.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as sn}from"@solana/web3.js";import{PublicKey as te,SystemProgram as mi,SYSVAR_RENT_PUBKEY as Br}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as hr}from"@solana/spl-token";function rn({pubkey:o,isSigner:e=!1,isWritable:t=!0}){return{pubkey:o,isWritable:t,isSigner:e}}var bs=[rn({pubkey:hr,isWritable:!1}),rn({pubkey:mi.programId,isWritable:!1}),rn({pubkey:Br,isWritable:!1})];function di({publicKey:o,transformSol:e}){let t=pi(o.toString());if(t instanceof te)return e&&t.equals(Pt)?vt:t;if(e&&t.toString()===Pt.toBase58())return vt;if(typeof t=="string"){if(t===te.default.toBase58())return te.default;try{return new te(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function pi(o){try{return new te(o)}catch{return o}}var xr=new te("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ir=new te("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),on=new te("SysvarRent111111111111111111111111111111111"),ys=new te("SysvarC1ock11111111111111111111111111111111"),ot=new te("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),gs=new te("Sysvar1nstructions1111111111111111111111111"),Ps=mi.programId,As=new te("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ts=new te("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ws=new te("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ks=new te("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Bs=new te("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),hs=new te("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),xs=new te("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Is=new te("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ss=new te("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ks=new te("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Cs=new te("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),vt=new te("So11111111111111111111111111111111111111112"),Pt=te.default;var an=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:r=!1,isToken2022:s=!1}){if(e===Pt.toBase58()||e instanceof sn&&Pt.equals(e)){this.decimals=Ve.decimals,this.symbol=Ve.symbol,this.name=Ve.name,this.mint=new sn(Ve.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=r?sn.default:di({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},_e=an;_e.WSOL=new an(Y(_({},Ve),{mint:Ve.address}));var un=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Wt=un;Wt.SOL=new un(nn);import Sr from"bn.js";var _s=new $(new Sr(100));var Hs=oe("Raydium_price");var Kr=new xe(0),ka=new xe(1),Ba=new xe(2),ha=new xe(3),xa=new xe(5),wr=new xe(10),Ia=new xe(100),Sa=new xe(1e3),Ka=new xe(1e4);function fi(o,e,t){return o.mul(e).add(t).sub(new xe(1)).div(t)}function mn(o,e=1,t=[]){let n=[...o];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Ie=class{constructor(e){this._owner=e}get publicKey(){return Ie.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return Ie.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return Ie.isKeyPair(this._owner)}get isPublicKey(){return Ie.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!Ie.isKeyPair(e)}};import{PublicKey as Or}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Er}from"@solana/spl-token";import{ComputeBudgetProgram as bi,Keypair as gi,PublicKey as Cr,Transaction as Pi,TransactionMessage as Nr,VersionedTransaction as Ai}from"@solana/web3.js";var He={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Rr}from"@solana/spl-token";var yi=oe("Raydium_txUtil"),Ti=1644;function At(o){let e=[],t=[];return o.microLamports&&(e.push(bi.setComputeUnitPrice({microLamports:o.microLamports})),t.push(He.SetComputeUnitPrice)),o.units&&(e.push(bi.setComputeUnitLimit({units:o.units})),t.push(He.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ye(o,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=o.getLatestBlockhash)==null?void 0:n.call(o,{commitment:t})))==null?void 0:i.blockhash}async function Tt(o,e){return o.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);o.onSignature(e,r=>{if(clearTimeout(i),!r.err){t("");return}n(Object.assign(r.err,{txId:e}))},"confirmed")})}function Lr(o,e){o.length<1&&yi.logWithError(`no instructions provided: ${o.toString()}`),e.length<1&&yi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Pi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...o);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ti}catch{return!1}}function ue(o,e){let[t,n]=Cr.findProgramAddressSync(o,e);return{publicKey:t,nonce:n}}function wt({instructions:o,payer:e,signers:t}){return Lr(o,[e,...t])}function Re({instructions:o,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=gi.generate().publicKey.toString()}){let r=new Nr({payerKey:e,recentBlockhash:n,instructions:o}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ai(r).serialize()).toString("base64").length<Ti}catch{return!1}}var Fr=o=>Buffer.isBuffer(o)?o:o instanceof Uint8Array?Buffer.from(o.buffer,o.byteOffset,o.byteLength):Buffer.from(o),Mr=o=>{let e=o.serialize({requireAllSignatures:!1,verifySignatures:!1});o instanceof Ai&&(e=Fr(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function qe(o){let e=[];return o.forEach(t=>{t instanceof Pi&&(t.recentBlockhash||(t.recentBlockhash=Rr.toBase58()),t.feePayer||(t.feePayer=gi.generate().publicKey)),e.push(Mr(t))}),console.log("simulate tx string:",e),e}function we(o,e,t){return ue([o.toBuffer(),(t!=null?t:Er).toBuffer(),e.toBuffer()],new Or("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as M}from"@solana/web3.js";var ja=new M("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Za=new M("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Qa=new M("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ja=new M("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),$a=new M("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),eu=new M("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),tu=new M("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),nu=new M("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),iu=new M("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ru=new M("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),vr=new M("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Wr=new M("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Dr=new M("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ou=new M("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),su=new M("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),au=new M("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),uu=new M("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),cu=new M("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),lu=new M("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),mu=new M("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),du=new M("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),pu=new M("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),fu=new M("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),bu=new M("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),yu=new M("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),re=new M("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),gu=new M("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Pu=new M("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Au=new M("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Tu=new M("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),wu=new M("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ku={OPEN_BOOK_PROGRAM:new M("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new M("Ray1111111111111111111111111111111111111111"),AMM_V4:new M("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new M("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new M("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new M("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new M("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new M("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new M("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new M("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new M("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new M("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:M.default,Router:new M("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new M("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new M("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new M("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new M("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new M("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new M("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new M("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new M("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new M("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new M("Ray1111111111111111111111111111111111111111")};import se from"bn.js";var kt=1e4;function dn(o,e){let{div:t,mod:n}=o.divmod(e);return n.gt(new se(0))?t.add(new se(1)):t}function je(o,e){if(o.isZero())return new se(0);let t=o.div(e);return t.isZero()?new se(1):o.mod(e).gt(new se(0))?t.add(new se(1)):t}function pn(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new se(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=dn(o.mul(new se(i.transferFeeBasisPoints)),new se(kt)),c=a.gt(r)?r:a;return{amount:o,fee:c,expirationTime:s}}function fn(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new se(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===kt){let a=new se(i.maximumFee.toString());return{amount:o.add(a),fee:a,expirationTime:s}}else{let a=dn(o.mul(new se(kt)),new se(kt-i.transferFeeBasisPoints)),c=new se(i.maximumFee.toString()),u=a.sub(o).gt(c)?o.add(c):a,f=dn(u.mul(new se(i.transferFeeBasisPoints)),new se(kt)),m=f.gt(r)?r:f;return{amount:u,fee:m,expirationTime:s}}}import{PublicKey as Su}from"@solana/web3.js";import Cu from"bn.js";import Vr from"bn.js";var Ze=new Vr(1e6);import{MINT_SIZE as ac,TOKEN_PROGRAM_ID as uc,getTransferFeeConfig as cc,unpackMint as lc}from"@solana/spl-token";var bn=oe("Raydium_accountInfo_util");async function Bt(o,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:r=100}=_({batchRequest:!1},t),s=mn(e,r),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let T=o._buildArgs([m.map(A=>A.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:T}}),u=mn(c,10);a=(await(await Promise.all(u.map(async m=>await o._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(T=>{if(T){let{data:A,executable:l,lamports:g,owner:y,rentEpoch:h}=T;return A.length!==2&&A[1]!=="base64"&&bn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(A[0],"base64"),executable:l,lamports:g,owner:new _r(y),rentEpoch:h}}return null})))}else try{a=await Promise.all(s.map(c=>o.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Le(o,e,t){let n=await Bt(o,e.map(i=>i.pubkey),t);return e.map((i,r)=>Y(_({},i),{accountInfo:n[r]}))}async function Vt({connection:o,address:e,cluster:t="mainnet"}){let n=await Bt(o,[...new Set(e.map(r=>r.toString()))].map(r=>new yn(r))),i={};for(let r=0;r<e.length;r++){let s=n[r],a=e[r];if(!s)continue;let c=new at({key:a,state:at.deserialize(s.data)});i[a.toString()]=c,t==="devnet"?st[a.toString()]=c:Ge[a.toString()]=c}return i}var Ge={},gn=async o=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(Ge[e])return Ge;let t=new yn(e),n=await o.getAccountInfo(t);return n&&(Ge[e]=new at({key:t,state:at.deserialize(n.data)})),Ge},st={},_t=async o=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(st[e])return st;let t=new yn(e),n=await o.getAccountInfo(t);return n&&(st[e]=new at({key:t,state:at.deserialize(n.data)})),st};var xt=2e3,It=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Gr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=At(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(qr.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Qe(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(He.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:r=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...r),this.lookupTableAddress.push(...s.filter(a=>a!==Qe.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(_({},t||{})):this.build(t)}build(e){var n;let t=new ht;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var f;let{recentBlockHash:r,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=i||{},u=r!=null?r:await Ye(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),qe([t]),(f=this.owner)!=null&&f.isKeyPair)return{txId:a?await Pn(this.connection,t,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let T of m)try{T.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),r=t.filter(f=>f.transaction.instructions.length>0),s=[i,...r.map(f=>f.transaction)],a=[this.signers,...r.map(f=>f.signers)],c=[...this.instructionTypes,...r.map(f=>f.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async f=>{var h;let{sequentially:m,onTxUpdate:T,skipTxCount:A=0,recentBlockHash:l,skipPreflight:g=!0}=f||{},y=l!=null?l:await Ye(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(m){let d=[],I=0;for(let w of s){if(++I,I<=A)continue;let p=await Pn(this.connection,w,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});d.push(p)}return{txIds:d,signedTxs:s}}return{txIds:await await Promise.all(s.map(async d=>(d.recentBlockhash=y,await this.connection.sendRawTransaction(d.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let d=s.map((w,p)=>(w.recentBlockhash=y,a[p].length&&w.sign(...a[p]),w));qe(d);let I=await this.signAllTransactions(d);if(m){let w=0,p=[],P=async()=>{if(!I[w])return;let x=await this.connection.sendRawTransaction(I[w].serialize(),{skipPreflight:g});p.push({txId:x,status:"sent",signedTx:I[w]}),T==null||T([...p]),w++;let k=!1,K=null,C=null,F=B=>{K!==null&&clearInterval(K),C!==null&&this.connection.removeSignatureListener(C);let L=p.findIndex(v=>v.txId===x);if(L>-1){if(p[L].status==="error"||p[L].status==="success")return;p[L].status=B.err?"error":"success"}T==null||T([...p]),B.err||P()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var B;if(k){clearInterval(K);return}try{let L=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(k=!0,clearInterval(K),F({err:((B=L.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",x))}catch(L){k=!0,clearInterval(K),console.error("getTransaction timeout:",L,x)}},xt)),C=this.connection.onSignature(x,B=>{if(k){this.connection.removeSignatureListener(C);return}k=!0,F(B)},"confirmed"),this.connection.getSignatureStatus(x)};return await P(),{txIds:p.map(x=>x.txId),signedTxs:I}}else{let w=[];for(let p=0;p<I.length;p+=1){let P=await this.connection.sendRawTransaction(I[p].serialize(),{skipPreflight:g});w.push(P)}return{txIds:w,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var g;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:r}=l,s=De(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):await gn(this.connection)),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new Qe(y));let f=await Vt({connection:this.connection,address:u});for(let[y,h]of Object.entries(f))a[y]=h;let m=i?Qe.default.toBase58():r!=null?r:await Ye(this.connection,this.blockhashCommitment),T=new Fe({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let A=new Me(T);return A.sign(this.signers),{builder:this,transaction:A,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var w;let{skipPreflight:h=!0,sendAndConfirm:d,notSendToRpc:I}=y||{};if(qe([A]),(w=this.owner)!=null&&w.isKeyPair){let p=await this.connection.sendTransaction(A,{skipPreflight:h});return d&&await Tt(this.connection,p),{txId:p,signedTx:A}}if(this.signAllTransactions){let p=await this.signAllTransactions([A]);if(this.signers.length)for(let P of p)try{P.sign(this.signers)}catch{}return{txId:I?"":await this.connection.sendTransaction(p[0],{skipPreflight:h}),signedTx:p[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),r=t.filter(f=>f.builder.instructions.length>0),s=[i,...r.map(f=>f.transaction)],a=[this.signers,...r.map(f=>f.signers)],c=[...this.instructionTypes,...r.map(f=>f.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(f,m)=>{f.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async f=>{var g;let{sequentially:m,onTxUpdate:T,recentBlockHash:A,skipPreflight:l=!0}=f||{};if(A&&s.forEach(y=>y.message.recentBlockhash=A),qe(s),(g=this.owner)!=null&&g.isKeyPair){if(m){let y=[];for(let h of s){let d=await this.connection.sendTransaction(h,{skipPreflight:l});await Tt(this.connection,d),y.push(d)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:l}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let h=0,d=[],I=async()=>{if(!y[h])return;let w=await this.connection.sendTransaction(y[h],{skipPreflight:l});d.push({txId:w,status:"sent",signedTx:y[h]}),T==null||T([...d]),h++;let p=!1,P=null,x=null,k=K=>{P!==null&&clearInterval(P),x!==null&&this.connection.removeSignatureListener(x);let C=d.findIndex(F=>F.txId===w);if(C>-1){if(d[C].status==="error"||d[C].status==="success")return;d[C].status=K.err?"error":"success"}T==null||T([...d]),K.err||I()};this.loopMultiTxStatus&&(P=setInterval(async()=>{var K;if(p){clearInterval(P);return}try{let C=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(p=!0,clearInterval(P),k({err:((K=C.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",w))}catch(C){p=!0,clearInterval(P),console.error("getTransaction timeout:",C,w)}},xt)),x=this.connection.onSignature(w,K=>{if(p){this.connection.removeSignatureListener(x);return}p=!0,k(K)},"confirmed"),this.connection.getSignatureStatus(w)};return I(),{txIds:[],signedTxs:y}}else{let h=[];for(let d=0;d<y.length;d+=1){let I=await this.connection.sendTransaction(y[d],{skipPreflight:l});h.push(I)}return{txIds:h,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var T;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=De(m,["splitIns","computeBudgetConfig"]),r=n?At(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((A,l)=>Y(_({},A),{[l.publicKey.toBase58()]:l}),{}),a=[],c=[],u=[],f=0;if(this.allInstructions.forEach(A=>{let l=[...u,A],g=n?[...r.instructions,...l]:l,h=[...new Set(l.map(d=>d.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(d=>new Qe(d));if(A!==t[f]&&u.length<12&&(wt({instructions:g,payer:this.feePayer,signers:h})||wt({instructions:l,payer:this.feePayer,signers:h})))u.push(A);else{if(u.length===0)throw Error("item ins too big");f+=A===t[f]?1:0,wt({instructions:n?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:h})?a.push(new ht().add(...r.instructions,...u)):a.push(new ht().add(...u)),c.push(Array.from(new Set(u.map(d=>d.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(d=>s[d]).filter(d=>d!==void 0)),u=[A]}}),u.length>0){let l=[...new Set(u.map(g=>g.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(g=>s[g]).filter(g=>g!==void 0);wt({instructions:n?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:l.map(g=>g.publicKey)})?a.push(new ht().add(...r.instructions,...u)):a.push(new ht().add(...u)),c.push(l)}return a.forEach(A=>A.feePayer=this.feePayer),(T=this.owner)!=null&&T.signer&&c.forEach(A=>{A.some(l=>l.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async A=>{var w;let{sequentially:l,onTxUpdate:g,skipTxCount:y=0,recentBlockHash:h,skipPreflight:d=!0}=A||{},I=h!=null?h:await Ye(this.connection,this.blockhashCommitment);if(a.forEach(async(p,P)=>{p.recentBlockhash=I,c[P].length&&p.sign(...c[P])}),qe(a),(w=this.owner)!=null&&w.isKeyPair){if(l){let p=0,P=[];for(let x of a){if(++p,p<=y){P.push("tx skipped");continue}let k=await Pn(this.connection,x,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:d});P.push(k)}return{txIds:P,signedTxs:a}}return{txIds:await Promise.all(a.map(async p=>await this.connection.sendRawTransaction(p.serialize(),{skipPreflight:d}))),signedTxs:a}}if(this.signAllTransactions){let p=await this.signAllTransactions(a.slice(y,a.length)),P=[...a.slice(0,y),...p];if(l){let x=0,k=[],K=async()=>{if(!P[x])return;x<y&&(k.push({txId:"",status:"success",signedTx:P[x]}),g==null||g([...k]),x++,K());let C=await this.connection.sendRawTransaction(P[x].serialize(),{skipPreflight:d});k.push({txId:C,status:"sent",signedTx:P[x]}),g==null||g([...k]),x++;let F=!1,B=null,L=null,v=S=>{B!==null&&clearInterval(B),L!==null&&this.connection.removeSignatureListener(L);let W=k.findIndex(G=>G.txId===C);if(W>-1){if(k[W].status==="error"||k[W].status==="success")return;k[W].status=S.err?"error":"success"}g==null||g([...k]),S.err||K()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var S;if(F){clearInterval(B);return}try{let W=await this.connection.getTransaction(C,{commitment:"confirmed",maxSupportedTransactionVersion:0});W&&(F=!0,clearInterval(B),v({err:((S=W.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",C))}catch(W){F=!0,clearInterval(B),console.error("getTransaction timeout:",W,C)}},xt)),L=this.connection.onSignature(C,S=>{if(F){this.connection.removeSignatureListener(L);return}F=!0,v(S)},"confirmed"),this.connection.getSignatureStatus(C)};return await K(),{txIds:k.map(C=>C.txId),signedTxs:P}}else{let x=[];for(let k=0;k<P.length;k+=1){let K=await this.connection.sendRawTransaction(P[k].serialize(),{skipPreflight:d});x.push(K)}return{txIds:x,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var I;let d=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:r=[]}=d,s=De(d,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):Ge),i),c=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let w of c)a[w]===void 0&&u.push(new Qe(w));let f=await Vt({connection:this.connection,address:u});for(let[w,p]of Object.entries(f))a[w]=p;let m=t?At(t):{instructions:[],instructionTypes:[]},T=await Ye(this.connection,this.blockhashCommitment),A=this.signers.reduce((w,p)=>Y(_({},w),{[p.publicKey.toBase58()]:p}),{}),l=[],g=[],y=[],h=0;if(this.allInstructions.forEach(w=>{let p=[...y,w],P=t?[...m.instructions,...p]:p;if(w!==n[h]&&y.length<12&&(Re({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||Re({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(w);else{if(y.length===0)throw Error("item ins too big");h+=w===n[h]?1:0;let x={};for(let k of[...new Set(c)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Re({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));l.push(new Me(k))}else{let k=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...y]}).compileToV0Message(Object.values(a));l.push(new Me(k))}g.push(Array.from(new Set(y.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>A[k]).filter(k=>k!==void 0)),y=[w]}}),y.length>0){let p=[...new Set(y.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>A[P]).filter(P=>P!==void 0);if(t&&Re({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));l.push(new Me(P))}else{let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...y]}).compileToV0Message(Object.values(a));l.push(new Me(P))}g.push(p)}return(I=this.owner)!=null&&I.signer&&g.forEach(w=>{w.some(p=>p.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,p)=>{w.sign(g[p])}),{builder:this,transactions:l,buildProps:e,signers:g,blockHash:T,instructionTypes:this.instructionTypes,execute:async w=>{var C;let{sequentially:p,onTxUpdate:P,skipTxCount:x=0,recentBlockHash:k,skipPreflight:K=!0}=w||{};if(l.map(async(F,B)=>{g[B].length&&F.sign(g[B]),k&&(F.message.recentBlockhash=k)}),qe(l),(C=this.owner)!=null&&C.isKeyPair){if(p){let F=0,B=[];for(let L of l){if(++F,F<=x){console.log("skip tx: ",F),B.push("tx skipped");continue}let v=await this.connection.sendTransaction(L,{skipPreflight:K});await Tt(this.connection,v),B.push(v)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async F=>await this.connection.sendTransaction(F,{skipPreflight:K}))),signedTxs:l}}if(this.signAllTransactions){let F=await this.signAllTransactions(l.slice(x,l.length)),B=[...l.slice(0,x),...F];if(p){let L=0,v=[],S=async()=>{if(!B[L])return;if(L<x){v.push({txId:"",status:"success",signedTx:B[L]}),P==null||P([...v]),L++,S();return}let W=await this.connection.sendTransaction(B[L],{skipPreflight:K});v.push({txId:W,status:"sent",signedTx:B[L]}),P==null||P([...v]),L++;let G=!1,U=null,Z=null,X=Q=>{U!==null&&clearInterval(U),Z!==null&&this.connection.removeSignatureListener(Z);let j=v.findIndex(ie=>ie.txId===W);if(j>-1){if(v[j].status==="error"||v[j].status==="success")return;v[j].status=Q.err?"error":"success"}P==null||P([...v]),Q.err||S()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var Q;if(G){clearInterval(U);return}try{let j=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});j&&(G=!0,clearInterval(U),X({err:((Q=j.meta)==null?void 0:Q.err)||null}),console.log("tx status from getTransaction:",W))}catch(j){G=!0,clearInterval(U),console.error("getTransaction timeout:",j,W)}},xt)),Z=this.connection.onSignature(W,Q=>{if(G){this.connection.removeSignatureListener(Z);return}G=!0,X(Q)},"confirmed"),this.connection.getSignatureStatus(W)};return S(),{txIds:[],signedTxs:B}}else{let L=[];for(let v=0;v<B.length;v+=1){let S=await this.connection.sendTransaction(B[v],{skipPreflight:K});L.push(S)}return{txIds:L,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildSniperTransaction(e){var I;let d=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:r=[]}=d,s=De(d,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):await gn(this.connection)),i),c=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let w of c)a[w]===void 0&&u.push(new Qe(w));let f=await Vt({connection:this.connection,address:u});for(let[w,p]of Object.entries(f))a[w]=p;let m=t?At(t):{instructions:[],instructionTypes:[]},T=await Ye(this.connection,this.blockhashCommitment),A=this.signers.reduce((w,p)=>Y(_({},w),{[p.publicKey.toBase58()]:p}),{}),l=[],g=[],y=[],h=0;if(this.allInstructions.forEach(w=>{let p=[...y,w],P=t?[...m.instructions,...p]:p;if(w!==n[h]&&y.length<12&&(Re({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||Re({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(w);else{if(y.length===0)throw Error("item ins too big");h+=w===n[h]?1:0;let x={};for(let k of[...new Set(c)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Re({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));l.push(new Me(k))}else{let k=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...y]}).compileToV0Message(Object.values(a));l.push(new Me(k))}g.push(Array.from(new Set(y.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>A[k]).filter(k=>k!==void 0)),y=[w]}}),y.length>0){let p=[...new Set(y.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>A[P]).filter(P=>P!==void 0);if(t&&Re({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));l.push(new Me(P))}else{let P=new Fe({payerKey:this.feePayer,recentBlockhash:T,instructions:[...y]}).compileToV0Message(Object.values(a));l.push(new Me(P))}g.push(p)}return(I=this.owner)!=null&&I.signer&&g.forEach(w=>{w.some(p=>p.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,p)=>{w.sign(g[p])}),{builder:this,transactions:l,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async w=>{var C;let{sequentially:p,onTxUpdate:P,skipTxCount:x=0,recentBlockHash:k,skipPreflight:K=!0}=w||{};if(l.map(async(F,B)=>{g[B].length&&F.sign(g[B]),k&&(F.message.recentBlockhash=k)}),qe(l),(C=this.owner)!=null&&C.isKeyPair){if(p){let F=0,B=[];for(let L of l){if(++F,F<=x){console.log("skip tx: ",F),B.push("tx skipped");continue}let v=await this.connection.sendTransaction(L,{skipPreflight:K});await Tt(this.connection,v),B.push(v)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async F=>await this.connection.sendTransaction(F,{skipPreflight:K}))),signedTxs:l}}if(this.signAllTransactions){let F=await this.signAllTransactions(l.slice(x,l.length)),B=[...l.slice(0,x),...F];if(p){let L=0,v=[],S=async()=>{if(!B[L])return;if(L<x){v.push({txId:"",status:"success",signedTx:B[L]}),P==null||P([...v]),L++,S();return}let W=await this.connection.sendTransaction(B[L],{skipPreflight:K});v.push({txId:W,status:"sent",signedTx:B[L]}),P==null||P([...v]),L++;let G=!1,U=null,Z=null,X=Q=>{U!==null&&clearInterval(U),Z!==null&&this.connection.removeSignatureListener(Z);let j=v.findIndex(ie=>ie.txId===W);if(j>-1){if(v[j].status==="error"||v[j].status==="success")return;v[j].status=Q.err?"error":"success"}P==null||P([...v]),Q.err||S()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var Q;if(G){clearInterval(U);return}try{let j=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});j&&(G=!0,clearInterval(U),X({err:((Q=j.meta)==null?void 0:Q.err)||null}),console.log("tx status from getTransaction:",W))}catch(j){G=!0,clearInterval(U),console.error("getTransaction timeout:",j,W)}},xt)),Z=this.connection.onSignature(W,Q=>{if(G){this.connection.removeSignatureListener(Z);return}G=!0,X(Q)},"confirmed"),this.connection.getSignatureStatus(W)};return S(),{txIds:[],signedTxs:B}}else{let L=[];for(let v=0;v<B.length;v+=1){let S=await this.connection.sendTransaction(B[v],{skipPreflight:K});L.push(S)}return{txIds:L,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var An=(...o)=>o.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ut=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=oe(t)}createTxBuilder(e){return this.scope.checkOwner(),new It({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new Ie(e);return new It({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(An(e))}logInfo(...e){this.logger.info(An(e))}logAndCreateError(...e){let t=An(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Bp}from"@solana/web3.js";import xp from"bn.js";import Sp from"decimal.js";import{AccountLayout as Np,createAssociatedTokenAccountIdempotentInstruction as Rp,TOKEN_2022_PROGRAM_ID as Lp,TOKEN_PROGRAM_ID as Fp}from"@solana/spl-token";import{PublicKey as vc}from"@solana/web3.js";import{MintLayout as Dc,TOKEN_PROGRAM_ID as _c}from"@solana/spl-token";import{Keypair as Hd,PublicKey as Yd,SystemProgram as Zd,TransactionInstruction as Qd}from"@solana/web3.js";import $d from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as np,TOKEN_2022_PROGRAM_ID as ip,TOKEN_PROGRAM_ID as rp}from"@solana/spl-token";import{PublicKey as eo}from"@solana/web3.js";import Ii,{isBN as Si}from"bn.js";import{bits as Yc,BitStructure as jc,blob as Ur,Blob as Zc,cstr as Qc,f32 as Jc,f32be as $c,f64 as el,f64be as tl,greedy as nl,Layout as Xr,ns64 as il,ns64be as rl,nu64 as ol,nu64be as sl,offset as zr,s16 as al,s16be as ul,s24 as cl,s24be as ll,s32 as Hr,s32be as ml,s40 as dl,s40be as pl,s48 as fl,s48be as bl,s8 as yl,seq as Yr,struct as gl,Structure as jr,u16 as Zr,u16be as Pl,u24 as Al,u24be as Tl,u32 as Qr,u32be as wl,u40 as kl,u40be as Bl,u48 as hl,u48be as xl,u8 as Jr,UInt as $r,union as Il,Union as Sl,unionLayoutDiscriminator as Kl,utf8 as Cl}from"@solana/buffer-layout";var Tn=Xr,Bi=jr;var wn=$r;var hi=Jr,Oe=Zr;var kn=Qr;var Ee=Hr;var xi=Yr;var ce=Ur;var Bn=zr;var ct=class extends Tn{constructor(t,n,i){super(t,i);this.blob=ce(t),this.signed=n}decode(t,n=0){let i=new Ii(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Ii(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function E(o){return new wn(1,o)}function lt(o){return new wn(4,o)}function b(o){return new ct(8,!1,o)}function ne(o){return new ct(16,!1,o)}function Ki(o){return new ct(8,!0,o)}function Ci(o){return new ct(16,!0,o)}var Je=class extends Tn{constructor(t,n,i,r){super(t.span,r);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function O(o){return new Je(ce(32),e=>new eo(e),e=>e.toBuffer(),o)}function xn(o){return new Je(hi(),to,no,o)}function to(o){if(o===0)return!1;if(o===1)return!0;throw new Error("Invalid bool: "+o)}function no(o){return o?1:0}function Ni(o,e){let t=kn("length"),n=D([t,z(o,Bn(t,-t.span),"values")]);return new Je(n,({values:i})=>i,i=>({values:i}),e)}function io(o){let e=kn("length"),t=D([e,ce(Bn(e,-e.span),"data")]);return new Je(t,({data:n})=>n,n=>({data:n}),o)}function le(o){return new Je(io(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),o)}var hn=class extends Bi{decode(e,t){return super.decode(e,t)}};function D(o,e,t){return new hn(o,e,t)}function z(o,e,t){let n,i=typeof e=="number"?e:Si(e)?e.toNumber():new Proxy(e,{get(r,s){if(!n){let a=Reflect.get(r,"count");n=Si(a)?a.toNumber():a,Reflect.set(r,"count",n)}return Reflect.get(r,s)},set(r,s,a){return s==="count"&&(n=a),Reflect.set(r,s,a)}});return xi(o,i,t)}import Id from"bn.js";import Kd from"decimal.js";import ye from"bn.js";var In=new ye(0),Ri=new ye(1),Li=new ye(-1),Se=new ye(1).shln(64),Fi=new ye(1).shln(128),Sn=Se.sub(Ri);var ro=Fi.subn(1),mt=-443636,St=-mt,Kn=new ye("4295048016"),Cn=new ye("79226673521066979257578248091"),_l=new ye("4295048017"),ql=new ye("79226673521066979257578248090");var oo=new ye(10).pow(new ye(6));var Gl=new ye("18446744073700000000");import md from"bn.js";import pd from"decimal.js";var jl=Buffer.from("amm_config","utf8"),Mi=Buffer.from("pool","utf8"),Oi=Buffer.from("pool_vault","utf8"),Zl=Buffer.from("pool_reward_vault","utf8"),Ql=Buffer.from("position","utf8"),Jl=Buffer.from("tick_array","utf8"),$l=Buffer.from("operation","utf8"),em=Buffer.from("pool_tick_array_bitmap_extension","utf8"),tm=Buffer.from("observation","utf8");function Nn(o){return ue([Buffer.from("metadata","utf8"),ot.toBuffer(),o.toBuffer()],ot)}var nm=Buffer.from("locked_position","utf8");var im=Buffer.from("support_mint","utf8");import{PublicKey as vm}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Dm}from"@solana/spl-token";import _m from"bn.js";import Gm from"decimal.js";import sm from"bn.js";import um from"decimal.js";var Fn=14;var qt=60;var lo=D([ce(8),E("bump"),Oe("index"),O(""),lt("protocolFeeRate"),lt("tradeFeeRate"),Oe("tickSpacing"),z(b(),8,"")]),mo=D([lt("blockTimestamp"),Ki("tickCumulative"),z(b(),4)]),Xi=D([ce(8),xn("initialized"),b("recentEpoch"),Oe("observationIndex"),O("poolId"),z(mo,100,"observations"),z(b(),4)]),po=D([E("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),ne("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),O("tokenMint"),O("tokenVault"),O("creator"),ne("rewardGrowthGlobalX64")]),qi=D([ce(8),E("bump"),O("ammConfig"),O("creator"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("observationId"),E("mintDecimalsA"),E("mintDecimalsB"),Oe("tickSpacing"),ne("liquidity"),ne("sqrtPriceX64"),Ee("tickCurrent"),lt(),ne("feeGrowthGlobalX64A"),ne("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),ne("swapInAmountTokenA"),ne("swapOutAmountTokenB"),ne("swapInAmountTokenB"),ne("swapOutAmountTokenA"),E("status"),z(E(),7,""),z(po,3,"rewardInfos"),z(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),z(b(),15*4-3,"padding")]),fo=D([ne("growthInsideLastX64"),b("rewardAmountOwed")]),Gi=D([ce(8),E("bump"),O("nftMint"),O("poolId"),Ee("tickLower"),Ee("tickUpper"),ne("liquidity"),ne("feeGrowthInsideLastX64A"),ne("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),z(fo,3,"rewardInfos"),z(b(),8,"")]),vd=D([ce(8),E("bump"),O("poolId"),Ee("tickLowerIndex"),Ee("tickUpperIndex"),ne("liquidity"),ne("feeGrowthInsideLastX64A"),ne("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),z(ne(),3,"rewardGrowthInside"),z(b(),8,"")]),bo=D([Ee("tick"),Ci("liquidityNet"),ne("liquidityGross"),ne("feeGrowthOutsideX64A"),ne("feeGrowthOutsideX64B"),z(ne(),3,"rewardGrowthsOutsideX64"),z(lt(),13,"")]),Di=D([ce(8),O("poolId"),Ee("startTickIndex"),z(bo,qt,"ticks"),E("initializedTickCount"),z(E(),115,"")]),yo=D([ce(329),z(O(),100,"whitelistMints")]),co=D([ce(8),O("poolId"),z(z(b(),8),Fn,"positiveTickArrayBitmap"),z(z(b(),8),Fn,"negativeTickArrayBitmap")]),Wd=D([b(),E("bump"),O("owner"),O("poolId"),O("positionId"),O("nftAccount"),z(b(),8)]),go=D([ce(8),E("bump"),O("lockOwner"),O("poolId"),O("positionId"),O("nftAccount"),O("lockNftMint"),b("recentEpoch"),z(b(),8)]);Xi.span;var pp=oe("Raydium_Clmm");var wo=Buffer.from("vault_auth_seed","utf8"),Af=Buffer.from("global_config","utf8"),ko=Buffer.from("pool_vesting","utf8"),Bo=Buffer.from("platform_config","utf8"),ho=Buffer.from("platform_fee_vault_auth_seed","utf8"),xo=Buffer.from("creator_fee_vault_auth_seed","utf8");function Ke(o){return ue([wo],o)}function dt(o,e,t){return ue([Mi,e.toBuffer(),t.toBuffer()],o)}function Mn(o,e,t){return ue([Oi,e.toBuffer(),t.toBuffer()],o)}function $e(o){return ue([Buffer.from("__event_authority","utf8")],o)}function On(o,e){return ue([Bo,e.toBuffer()],o)}function Nt(o,e,t){return ue([ko,e.toBuffer(),t.toBuffer()],o)}function et(o,e,t){return ue([e.toBuffer(),t.toBuffer()],o)}function En(o){return ue([ho],o)}function tt(o,e,t){return ue([e.toBuffer(),t.toBuffer()],o)}function vn(o){return ue([xo],o)}import{ASSOCIATED_TOKEN_PROGRAM_ID as Gt,TOKEN_2022_PROGRAM_ID as Ko,TOKEN_PROGRAM_ID as Wn}from"@solana/spl-token";import{SystemProgram as ge,TransactionInstruction as pe}from"@solana/web3.js";import ft from"bn.js";var Ue=D([b(),b("epoch"),E("curveType"),Oe("index"),b("migrateFee"),b("tradeFeeRate"),b("maxShareFeeRate"),b("minSupplyA"),b("maxLockRate"),b("minSellRateA"),b("minMigrateRateA"),b("minFundRaisingB"),O("mintB"),O("protocolFeeOwner"),O("migrateFeeOwner"),O("migrateToAmmWallet"),O("migrateToCpmmWallet"),z(b(),16)]),Io=D([b("totalLockedAmount"),b("cliffPeriod"),b("unlockPeriod"),b("startTime"),b("totalAllocatedShare")]),ke=D([b(),b("epoch"),E("bump"),E("status"),E("mintDecimalsA"),E("mintDecimalsB"),E("migrateType"),b("supply"),b("totalSellA"),b("virtualA"),b("virtualB"),b("realA"),b("realB"),b("totalFundRaisingB"),b("protocolFee"),b("platformFee"),b("migrateFee"),Io.replicate("vestingSchedule"),O("configId"),O("platformId"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("creator"),E("mintProgramFlag"),E("cpmmCreatorFeeOn"),z(E(),62)]),kf=D([b(),b("epoch"),O("poolId"),O("beneficiary"),b("claimedAmount"),b("tokenShareAmount"),z(b(),8)]),zi=D([E("migrateType"),E("migrateCpmmFeeOn"),b("supply"),b("totalSellA"),b("totalFundRaisingB"),b("totalLockedAmount"),b("cliffPeriod"),b("unlockPeriod")]),So=D([b("epoch"),E("index"),O("configId"),zi.replicate("bondingCurveParam"),z(b(),50)]),pt=D([b(),b("epoch"),O("platformClaimFeeWallet"),O("platformLockNftWallet"),b("platformScale"),b("creatorScale"),b("burnScale"),b("feeRate"),z(E(),64,"name"),z(E(),256,"web"),z(E(),256,"img"),O("cpConfigId"),b("creatorFeeRate"),O("transferFeeExtensionAuth"),z(E(),180),Ni(So,"platformCurve")]);var fe={initialize:Buffer.from([175,175,109,31,13,152,155,237]),initializeV2:Buffer.from([67,153,175,39,218,16,38,32]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252]),updatePlatformCurveParam:Buffer.from([138,144,138,250,220,128,4,57]),removePlatformCurveParam:Buffer.from([27,30,62,169,93,224,24,145])};function Hi(o,e,t,n,i,r,s,a,c,u,f,m,T,A,l,g,y,h,d,I,w){let p=D([E("decimals"),le("name"),le("symbol"),le("uri")]),P=D([b("totalLockedAmount"),b("cliffPeriod"),b("unlockPeriod"),E("cpmmCreatorFeeOn")]),x=D([E("index"),b("supply"),b("totalFundRaisingB"),E("migrateType")]),k=D([E("index"),b("supply"),b("totalSellA"),b("totalFundRaisingB"),E("migrateType")]),K=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:$e(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(A,"utf-8").length+Buffer.from(l,"utf-8").length+Buffer.from(g,"utf-8").length+4*3+1),F=Buffer.alloc(P.span),B=Buffer.alloc(y.type==="ConstantCurve"?k.span:x.span);return p.encode({decimals:T,name:A,symbol:l,uri:g},C),y.type==="ConstantCurve"?k.encode(Y(_({index:0},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="FixedCurve"?x.encode(Y(_({index:1},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="LinearCurve"&&x.encode(Y(_({index:2},y),{migrateType:y.migrateType==="amm"?0:1}),B),P.encode({totalLockedAmount:h,cliffPeriod:d,unlockPeriod:I,cpmmCreatorFeeOn:w},F),new pe({keys:K,programId:o,data:Buffer.from([...fe.initializeV2,...C,...B,...F])})}function Yi(o,e,t,n,i,r,s,a,c,u,f,m,T,A,l,g,y,h,d,I,w){let p=D([E("decimals"),le("name"),le("symbol"),le("uri")]),P=D([b("totalLockedAmount"),b("cliffPeriod"),b("unlockPeriod"),E("cpmmCreatorFeeOn"),E("transferFeeExtensionParamsOption"),D([Oe("transferFeeBasePoints"),b("maxinumFee")]).replicate("transferFeeExtensionParams")]),x=D([E("index"),b("supply"),b("totalFundRaisingB"),E("migrateType")]),k=D([E("index"),b("supply"),b("totalSellA"),b("totalFundRaisingB"),E("migrateType")]),K=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Ko,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:$e(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(T,"utf-8").length+Buffer.from(A,"utf-8").length+Buffer.from(l,"utf-8").length+4*3+1),F=Buffer.alloc(P.span),B=Buffer.alloc(g.type==="ConstantCurve"?k.span:x.span);return p.encode({decimals:m,name:T,symbol:A,uri:l},C),g.type==="ConstantCurve"?k.encode(Y(_({index:0},g),{migrateType:g.migrateType==="amm"?0:1}),B):g.type==="FixedCurve"?x.encode(Y(_({index:1},g),{migrateType:g.migrateType==="amm"?0:1}),B):g.type==="LinearCurve"&&x.encode(Y(_({index:2},g),{migrateType:g.migrateType==="amm"?0:1}),B),P.encode({totalLockedAmount:y,cliffPeriod:h,unlockPeriod:d,cpmmCreatorFeeOn:I,transferFeeExtensionParamsOption:w?1:0,transferFeeExtensionParams:w!=null?w:{transferFeeBasePoints:0,maxinumFee:new ft(0)}},F),new pe({keys:K,programId:o,data:Buffer.from([...fe.initializeWithToken2022,...C,...B,...F])})}function ji(o,e,t,n,i,r,s,a,c,u,f,m,T,A,l,g,y,h,d,I){let w=D([b("amountB"),b("minAmountA"),b("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:$e(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&p.push({pubkey:I,isSigner:!1,isWritable:!0}),p.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:g,isSigner:!1,isWritable:!0});let P=Buffer.alloc(w.span);return w.encode({amountB:y,minAmountA:h,shareFeeRate:d!=null?d:new ft(0)},P),new pe({keys:p,programId:o,data:Buffer.from([...fe.buyExactIn,...P])})}function Zi(o,e,t,n,i,r,s,a,c,u,f,m,T,A,l,g,y,h,d,I){let w=D([b("amountA"),b("maxAmountB"),b("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:$e(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&p.push({pubkey:I,isSigner:!1,isWritable:!0}),p.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:g,isSigner:!1,isWritable:!0});let P=Buffer.alloc(w.span);return w.encode({amountA:y,maxAmountB:h,shareFeeRate:d!=null?d:new ft(0)},P),new pe({keys:p,programId:o,data:Buffer.from([...fe.buyExactOut,...P])})}function Qi(o,e,t,n,i,r,s,a,c,u,f,m,T,A,l,g,y,h,d,I){let w=D([b("amountA"),b("minAmountB"),b("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:$e(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&p.push({pubkey:I,isSigner:!1,isWritable:!0}),p.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:g,isSigner:!1,isWritable:!0});let P=Buffer.alloc(w.span);return w.encode({amountA:y,minAmountB:h,shareFeeRate:d!=null?d:new ft(0)},P),new pe({keys:p,programId:o,data:Buffer.from([...fe.sellExactIn,...P])})}function Ji(o,e,t,n,i,r,s,a,c,u,f,m,T,A,l,g,y,h,d,I){let w=D([b("amountB"),b("maxAmountA"),b("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:$e(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&p.push({pubkey:I,isSigner:!1,isWritable:!0}),p.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:g,isSigner:!1,isWritable:!0});let P=Buffer.alloc(w.span);return w.encode({amountB:y,maxAmountA:h,shareFeeRate:d!=null?d:new ft(0)},P),new pe({keys:p,programId:o,data:Buffer.from([...fe.sellExactOut,...P])})}function Dn(o,e,t,n,i,r,s,a,c){let u=D([]),f=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new pe({keys:f,programId:o,data:Buffer.from([...fe.claimVestedToken,...m])})}function Vn(o,e,t,n,i,r){let s=D([b("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:ge.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:r},c),new pe({keys:a,programId:o,data:Buffer.from([...fe.createVestingAccount,...c])})}function _n(o,e,t,n,i,r,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:ge.programId,isSigner:!1,isWritable:!0},{pubkey:Gt,isSigner:!1,isWritable:!0}];return new pe({keys:u,programId:o,data:fe.claimPlatformFee})}function $i(o,e,t,n,i,r,s,a,c,u,f,m,T){let A=D([b("platformScale"),b("creatorScale"),b("burnScale"),b("feeRate"),le("name"),le("web"),le("img"),b("creatorFeeRate")]),l=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],g=Buffer.alloc(8*5+Buffer.from(f,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(T,"utf-8").length+4*3);return A.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:c,name:f,web:m,img:T,creatorFeeRate:u},g),new pe({keys:l,programId:o,data:Buffer.from([...fe.createPlatformConfig,...g])})}function er(o,e,t,n){let i=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],r;if(n.type==="updateClaimFeeWallet"){let s=D([E("index"),O("value")]);r=Buffer.alloc(s.span),s.encode({index:0,value:n.value},r)}else if(n.type==="updateLockNftWallet"){let s=D([E("index"),O("value")]);r=Buffer.alloc(s.span),s.encode({index:1,value:n.value},r)}else if(n.type==="migrateCpLockNftScale"){let s=D([E("index"),b("platformScale"),b("creatorScale"),b("burnScale")]);r=Buffer.alloc(s.span),s.encode(_({index:2},n.value),r)}else if(n.type==="updateFeeRate"){let s=D([E("index"),b("value")]);r=Buffer.alloc(s.span),s.encode({index:3,value:n.value},r)}else if(n.type==="updateImg"||n.type==="updateName"||n.type==="updateWeb"){let s=D([E("index"),le("value")]);r=Buffer.alloc(Buffer.from(n.value,"utf-8").length+4+1*1),n.type==="updateName"?s.encode({index:4,value:n.value},r):n.type==="updateWeb"?s.encode({index:5,value:n.value},r):n.type==="updateImg"&&s.encode({index:6,value:n.value},r)}else if(n.type==="updateCpConfigId"){i.push({pubkey:n.value,isSigner:!1,isWritable:!1});let s=D([E("index")]);r=Buffer.alloc(s.span),s.encode({index:7},r)}else if(n.type==="updateAll"){i.push({pubkey:n.value.cpConfigId,isSigner:!1,isWritable:!1});let s=D([E("index"),O("platformClaimFeeWallet"),O("platformLockNftWallet"),b("platformScale"),b("creatorScale"),b("burnScale"),b("feeRate"),le("name"),le("web"),le("img"),O("transferFeeExtensionAuth"),b("creatorFeeRate")]);r=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(n.value.name,"utf-8").length+Buffer.from(n.value.web,"utf-8").length+Buffer.from(n.value.img,"utf-8").length+32+8),s.encode({index:8,platformClaimFeeWallet:n.value.platformClaimFeeWallet,platformLockNftWallet:n.value.platformLockNftWallet,platformScale:n.value.migrateCpLockNftScale.platformScale,creatorScale:n.value.migrateCpLockNftScale.creatorScale,burnScale:n.value.migrateCpLockNftScale.burnScale,feeRate:n.value.feeRate,name:n.value.name,web:n.value.web,img:n.value.img,transferFeeExtensionAuth:n.value.transferFeeExtensionAuth,creatorFeeRate:n.value.creatorFeeRate},r)}else throw Error("updateInfo params type error");return new pe({keys:i,programId:o,data:Buffer.from([...fe.updatePlaformConfig,...r])})}function qn(o,e,t,n,i,r,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}];return new pe({keys:c,programId:o,data:fe.claimPlatformFeeFromVault})}function Gn(o,e,t,n,i,r,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}];return new pe({keys:a,programId:o,data:fe.claimCreatorFee})}var Mf=new ft("18446744073709551615");import{NATIVE_MINT as ve,TOKEN_2022_PROGRAM_ID as We,TOKEN_PROGRAM_ID as J,createAssociatedTokenAccountIdempotentInstruction as de,createSyncNativeInstruction as Co,getTransferFeeConfig as jt,unpackMint as Zt}from"@solana/spl-token";import V from"bn.js";import{PublicKey as ir,SystemProgram as No}from"@solana/web3.js";import Pe from"bn.js";import nr from"decimal.js";import Ut from"bn.js";import Rt from"decimal.js";var Xe=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Xt=class extends Xe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Rt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new Rt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new Rt(e.virtualB.add(e.realB.add(r)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new Ut(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(r);if(a.lte(new Ut(0)))throw Error("tfMinusMf <= 0");let c=a.mul(n).mul(n).div(s),u=a.mul(n).div(s).sub(t),f=c.div(u),m=t.mul(t).div(u);if(f.lt(new Ut(0))||m.lt(new Ut(0)))throw Error("invalid input 0");return{a:f,b:m,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),r=t.add(e);return i.div(r)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),r=n.sub(e);return je(i,r)}};import zt from"bn.js";import Lt from"decimal.js";var Ht=class extends Xe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Lt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new Lt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new Lt(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new zt(0)))throw Error("invalid input 1");let a=new zt(2).mul(t).sub(r),u=t.mul(s).div(a);if(u.lt(new zt(0))||t.lt(new zt(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return je(i,n)}};import me from"bn.js";import nt from"decimal.js";import tr from"bn.js";import Un from"decimal.js";var Ft=class{static _multipler(e){return new Un(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Un(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new tr(i.mul(this._Q64).toFixed(0))}};Ft._Q64=new Un(new tr(1).shln(64).toString());var Yt=class extends Xe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new nt(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new nt(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new nt(e.virtualA.mul(e.realA).toString()).div(Ft._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new nt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new nt(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new me(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new me(3)).sub(r),u=t.mul(new me(2)).mul(s).div(a),f=u.mul(u),m=t.mul(new me(2)).mul(Se).div(f);if(!m.gt(new me(0)))throw Error("a need gt 0");if(!Sn.gt(m))throw Error("a need lt u64 max");if(m.lt(new me(0))||u.lt(new me(0)))throw Error("invalid input 0");return{a:m,b:new me(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new me(2).mul(n).mul(Se).div(e.virtualA);return new me(new nt(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return je(e.virtualA.mul(i),new me(2).mul(Se)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),r=je(e.virtualA.mul(i),new me(2).mul(Se));return e.realB.sub(r)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new me(2).mul(n).mul(Se).div(e.virtualA),r=new me(new nt(i.toString()).sqrt().toFixed(0));return e.realA.sub(r)}};var Ae=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let f=this.getCurve(e),m=f.getInitParam({supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a}),T=f.getPoolInitPriceByInit(Y(_({},m),{decimalA:c,decimalB:u})),A=i.div(new Pe(t-1)),l=new Pe(0),g=[{price:T,totalSellSupply:0}],{a:y,b:h}=m,d=l,I=l;for(let w=1;w<t;w++){let p=w!==t-1?A:i.sub(I),P=this.buyExactIn({poolInfo:{virtualA:y,virtualB:h,realA:d,realB:I,totalFundRaisingB:i,totalSellA:r},amountB:p,protocolFeeRate:l,platformFeeRate:l,curveType:e,shareFeeRate:l,creatorFeeRate:l,transferFeeConfigA:void 0,slot:0});d=d.add(P.amountA.amount),I=I.add(P.amountB);let x=this.getPrice({poolInfo:{virtualA:y,virtualB:h,realA:d,realB:I},decimalA:c,decimalB:u,curveType:e});g.push({price:x,totalSellSupply:new nr(d.toString()).div(10**c).toNumber()})}return g}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:r,config:s,migrateType:a}){if(Number(r)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(Ze).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new Pe(10**r))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(Ze);if(n.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let f=e.sub(n).sub(i),m=e.mul(s.minMigrateRateA).div(Ze);if(f.lt(m))throw Error("migrate lt min migrate amoount");let T=e.sub(n).sub(i),A=new Pe(new nr(T.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let l=new Pe(10).pow(new Pe(r));if(A.lte(l))throw Error("check migrate lp error")}else if(a==="cpmm"){let l=new Pe(100);if(A.lte(l))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:f}),T=t.sub(m),A=this.getCurve(r),l=A.buyExactIn({poolInfo:e,amount:T}),g=e.totalSellA.sub(e.realA),y,h,d;if(l.gt(g)){y=g;let w=A.buyExactOut({poolInfo:e,amount:y});h=this.calculatePreFee({postFeeAmount:w,feeRate:f}),d=h.sub(w)}else y=l,h=t,d=m;let I=this.splitFee({totalFee:d,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:pn(y,c,u),amountB:h,splitFee:I}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=e.totalSellA.sub(e.realA),m=fn(t,c,u),T=m.fee?m.amount.add(m.fee):m.amount;t.gt(f)&&(T=f);let l=this.getCurve(r).buyExactOut({poolInfo:e,amount:T}),g=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),y=this.calculatePreFee({postFeeAmount:l,feeRate:g}),h=y.sub(l),d=this.splitFee({totalFee:h,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:y,splitFee:d}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.getCurve(r),m=pn(t,c,u),T=m.fee?m.amount.sub(m.fee):m.amount,A=f.sellExactIn({poolInfo:e,amount:T}),l=this.calculateFee({amount:A,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a})}),g=this.splitFee({totalFee:l,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:A.sub(l),splitFee:g}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:f});if(e.realB.lt(m))throw Error("Insufficient liquidity");let T=m.sub(t),l=Ae.getCurve(r).sellExactOut({poolInfo:e,amount:m});if(l.gt(e.realA))throw Error();let g=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:fn(l,c,u),amountB:t,splitFee:g}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}),a=s.isZero()?new Pe(0):e.mul(n).div(s),c=s.isZero()?new Pe(0):e.mul(i).div(s),u=s.isZero()?new Pe(0):e.mul(r).div(s),f=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:f,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return fi(e,t,Ze)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(Ze),i=Ze.sub(t);return n.add(i).sub(new Pe(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new Pe(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return Xt;case 1:return Ht;case 2:return Yt}throw Error("find curve error")}};import be from"decimal.js";var it={initPriceX64:new V("515752397214619"),supply:new V(1e15),totalSellA:new V(7931e11),totalFundRaisingB:new V(85e9),totalLockedAmount:new V("0"),cliffPeriod:new V("0"),unlockPeriod:new V("0"),decimals:6,virtualA:new V("1073471847374405"),virtualB:new V("30050573465"),realA:new V(0),realB:new V(0),protocolFee:new V(0),platformId:new ir("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new V(0),cliffPeriod:new V(0),unlockPeriod:new V(0),startTime:new V(0),totalAllocatedShare:new V(0)}},ze=new V(1e4),Xn=class extends ut{constructor(e){super(e)}async sayHello(){console.log("hello")}async createLaunchpad(L){var v=L,{programId:e=re,authProgramId:t,platformId:n=it.platformId,mintA:i,decimals:r=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:f,configId:m,snipers:T,configInfo:A,platformFeeRate:l,txVersion:g,computeBudgetConfig:y,txTipConfig:h,feePayer:d,buyAmount:I,minMintAAmount:w,slippage:p,associatedOnly:P=!0,checkCreateATAOwner:x=!1,extraSigners:k,token2022:K,transferFeeExtensionParams:C,creatorFeeOn:F=0}=v,B=De(v,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","snipers","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams","creatorFeeOn"]);var Hn,Yn,jn,Zn,Qn,Jn,$n,ei,ti,ni;let S=[],W=this.createTxBuilder(d);t=t!=null?t:Ke(e).publicKey,K=!!C,K&&(f="cpmm");let G=A;if(!G&&m){let Te=await this.scope.connection.getAccountInfo(m);Te&&(G=Ue.decode(Te.data))}G||this.logAndCreateError("config not found");let U=G.mintB,Z=G.curveType,{publicKey:X}=dt(e,i,U),{publicKey:Q}=Mn(e,X,i),{publicKey:j}=Mn(e,X,U),{publicKey:ie}=Nn(i);console.log(`create token: ${i.toBase58()}, mintB: ${U.toBase58()}, decimals A:${r}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let H=(Hn=B==null?void 0:B.supply)!=null?Hn:it.supply,q=(Yn=B==null?void 0:B.totalSellA)!=null?Yn:it.totalSellA,ae=(jn=B==null?void 0:B.totalFundRaisingB)!=null?jn:it.totalFundRaisingB,Ce=(Zn=B==null?void 0:B.totalLockedAmount)!=null?Zn:new V(0),ee=l;if(!l){let Te=await this.scope.connection.getAccountInfo(n);Te||this.logAndCreateError("platform id not found:",n.toString()),ee=pt.decode(Te.data).feeRate}let zn=Ae.getCurve(G.curveType).getInitParam({supply:H,totalFundRaising:ae,totalSell:q,totalLockedAmount:Ce,migrateFee:G.migrateFee}),Be={epoch:new V(896),bump:254,status:0,mintDecimalsA:r,mintDecimalsB:s,supply:H,totalSellA:q,mintA:new ir(i),mintB:U,virtualA:zn.a,virtualB:zn.b,realA:it.realA,realB:it.realB,migrateFee:G.migrateFee,migrateType:f==="amm"?0:1,protocolFee:it.protocolFee,platformFee:ee,platformId:n,configId:m,vaultA:Q,vaultB:j,creator:this.scope.ownerPubKey,totalFundRaisingB:ae,vestingSchedule:{totalLockedAmount:Ce,cliffPeriod:new V(0),unlockPeriod:new V(0),startTime:new V(0),totalAllocatedShare:new V(0)},mintProgramFlag:K?1:0,cpmmCreatorFeeOn:F},rr=Ae.getCurve(G.curveType),{c:or}=rr.getInitParam({supply:Be.supply,totalFundRaising:Be.totalFundRaisingB,totalLockedAmount:Ce,totalSell:G.curveType===0?Be.totalSellA:new V(0),migrateFee:G.migrateFee});try{Ae.checkParam({supply:Be.supply,totalFundRaising:Be.totalFundRaisingB,totalSell:or,totalLockedAmount:Ce,decimals:Be.mintDecimalsA,config:G,migrateType:f}),this.logDebug("check init params success")}catch(Te){this.logAndCreateError(`check create mint params failed, ${Te.message}`)}W.addInstruction({instructions:[K?Yi(e,d!=null?d:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,X,i,U,Q,j,r,a,c,u||"https://",{type:Z===0?"ConstantCurve":Z===1?"FixedCurve":Z===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:f,supply:H,totalFundRaisingB:ae},Ce,(Qn=B==null?void 0:B.cliffPeriod)!=null?Qn:new V(0),(Jn=B==null?void 0:B.unlockPeriod)!=null?Jn:new V(0),F,C):Hi(e,d!=null?d:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,X,i,U,Q,j,ie,r,a,c,u||"https://",{type:Z===0?"ConstantCurve":Z===1?"FixedCurve":Z===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:f,supply:H,totalFundRaisingB:ae},Ce,($n=B==null?void 0:B.cliffPeriod)!=null?$n:new V(0),(ei=B==null?void 0:B.unlockPeriod)!=null?ei:new V(0),F)]});let Qt=K?await this.scope.connection.getEpochInfo():void 0,Ne=C?{epoch:BigInt((Qt==null?void 0:Qt.epoch)||0),maximumFee:BigInt((ti=C==null?void 0:C.maxinumFee.toString())!=null?ti:0),transferFeeBasisPoints:(ni=C==null?void 0:C.transferFeeBasePoints)!=null?ni:0}:void 0,Jt={amountA:{amount:new V(0),fee:void 0,expirationTime:void 0},amountB:new V(0),splitFee:{platformFee:new V(0),shareFee:new V(0),protocolFee:new V(0),creatorFee:new V(0)}},$t;if(k!=null&&k.length&&W.addInstruction({signers:k}),!B.createOnly){let{builder:Te,extInfo:sr}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?We:void 0,mintA:i,mintB:U,poolInfo:Be,buyAmount:I,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:G,platformFeeRate:ee,slippage:p,associatedOnly:P,checkCreateATAOwner:x,skipCheckMintA:!Ne,transferFeeConfigA:Ne?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Ne,newerTransferFee:Ne}:void 0,fromCreate:!0});console.log("FEE: ",Ne),console.log("PREPARING SNIPER TRANSACTIONS");for(let ii of T){let{builder:ar,extInfo:Lo}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?We:void 0,mintA:i,mintB:U,poolInfo:Be,buyAmount:ii.amount,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:G,platformFeeRate:ee,slippage:p,sniper:ii,associatedOnly:P,checkCreateATAOwner:x,skipCheckMintA:!Ne,transferFeeConfigA:Ne?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Ne,newerTransferFee:Ne}:void 0,fromCreate:!0});S.push(Y(_({},ar.AllTxData),{blockHash:this.scope.blockhashCommitment}))}W.addInstruction(_({},Te.AllTxData)),Jt=_({},sr),$t=(this.scope.cluster==="devnet"||g===1)&&B.shareFeeReceiver?[Te.allInstructions[0]]:void 0}return g===0?(console.log("VERSION V0"),{tx:await W.sizeCheckBuildV0({computeBudgetConfig:y,swapInfo:Jt,splitIns:$t,address:Y(_({},Be),{poolId:X})}),txs:S}):(console.log("VERSION PLAIN"),{tx:await W.sizeCheckBuild({computeBudgetConfig:y,swapInfo:Jt,splitIns:$t,address:Y(_({},Be),{poolId:X})}),txs:S})}async buyToken({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=J,mintB:r=ve,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,buyAmount:A,minMintAAmount:l,slippage:g,shareFeeRate:y=new V(0),shareFeeReceiver:h,sniper:d,associatedOnly:I=!0,checkCreateATAOwner:w=!1,fromCreate:p=!1,transferFeeConfigA:P,skipCheckMintA:x=!1}){var q,ae,Ce;A.lte(new V(0))&&this.logAndCreateError("buy amount should gt 0:",A.toString());let k=d?this.createSniperTxBuilder(d.owner,d.owner.publicKey):this.createTxBuilder(T),{publicKey:K}=dt(e,n,r);t=t!=null?t:Ke(e).publicKey;let C=P;if(!x)if(console.log("!skipCheckMintA: ",x),C)console.log("mintAProgram: ",We),i=We;else{console.log("!transferFeeConfigA: ",C);let ee=await this.scope.connection.getAccountInfo(n);if(ee&&ee.owner.equals(We)){console.log("!mintInfo: ",ee),i=ee.owner;let rt=Zt(n,ee,i);C=jt(rt)||void 0}}let F=d?this.scope.account.getAssociatedTokenAccountByOwner(d.owner.publicKey,n,i):this.scope.account.getAssociatedTokenAccount(n,i),B=p?d?this.scope.account.getAssociatedTokenAccountByOwner(d.owner.publicKey,r,J):this.scope.account.getAssociatedTokenAccount(r,J):null,L=r.equals(ve),v=[de((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,F,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,n,i),...p?[de((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,B,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,r,J),No.transfer({fromPubkey:(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,toPubkey:B,lamports:BigInt(A.toString())}),Co(B)]:[]];if(k.addInstruction({instructions:v}),!p){let{account:ee,instructionParams:rt}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:L?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!L,notUseTokenAccount:L,associatedOnly:L?!1:I,checkCreateATAOwner:w});ee&&(B=ee),k.addInstruction(rt||{})}B===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let ee=await this.scope.connection.getAccountInfo(K,{commitment:"processed"});ee||this.logAndCreateError("cannot found pool:",K.toBase58()),S=ke.decode(ee.data)}let W=a,G=await Le(this.scope.connection,[W?void 0:S.configId,S.platformId].filter(Boolean).map(ee=>({pubkey:ee})));if(!W){let ee=G.find(rt=>rt.pubkey.equals(S.configId));(!ee||!ee.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),W=Ue.decode(ee.accountInfo.data)}let U=G.find(ee=>ee.pubkey.equals(S.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Z=pt.decode(U.accountInfo.data);c=c||Z.feeRate;let X=Ae.buyExactIn({poolInfo:S,amountB:A,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:y,creatorFeeRate:Z.creatorFeeRate,transferFeeConfigA:C,slot:await this.scope.connection.getSlot()}),Q=new be(X.amountA.amount.toString()).sub((ae=(q=X.amountA.fee)==null?void 0:q.toString())!=null?ae:0),j=g?new be(ze.sub(g).toNumber()/ze.toNumber()).clampedTo(0,1):new be(1),ie=l!=null?l:g?new V(Q.mul(j).toFixed(0)):X.amountA.amount.sub((Ce=X.amountA.fee)!=null?Ce:new V(0));X.amountB.lt(A)&&console.log(`maximum ${n.toBase58()} amount can buy is ${X.amountA.toString()}, input ${r.toBase58()} amount: ${X.amountB.toString()}`);let H=h?we(h,r,J).publicKey:void 0;return H&&k.addInstruction({instructions:[de((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,H,h,r)]}),k.addInstruction({instructions:[ji(e,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,t,S.configId,S.platformId,K,F,B,S.vaultA,S.vaultB,n,r,i,J,et(e,S.platformId,r).publicKey,tt(e,S.creator,r).publicKey,X.amountB.lt(A)?X.amountB:A,ie,y,H)]}),k.addCustomComputeBudget(f),k.addTipInstruction(m),k.versionBuild({txVersion:u,extInfo:Y(_({},X),{decimalOutAmount:Q,minDecimalOutAmount:new be(ie.toString())})})}async buyTokenExactOut({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=J,mintB:r=ve,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:f,computeBudgetConfig:m,txTipConfig:T,feePayer:A,maxBuyAmount:l,outAmount:g,slippage:y,shareFeeRate:h=new V(0),shareFeeReceiver:d,associatedOnly:I=!0,checkCreateATAOwner:w=!1,skipCheckMintA:p=!1}){g.lte(new V(0))&&this.logAndCreateError("out amount should gt 0:",g.toString());let P=this.createTxBuilder(A),{publicKey:x}=dt(e,n,r);t=t!=null?t:Ke(e).publicKey;let k=s;if(!k){let H=await this.scope.connection.getAccountInfo(x,{commitment:"processed"});H||this.logAndCreateError("cannot found pool:",x.toBase58()),k=ke.decode(H.data)}let K=a,C=await Le(this.scope.connection,[K?void 0:k.configId,k.platformId].filter(Boolean).map(H=>({pubkey:H})));if(!K){let H=C.find(q=>q.pubkey.equals(k.configId));(!H||!H.accountInfo)&&this.logAndCreateError("config not found: ",k.configId.toBase58()),K=Ue.decode(H.accountInfo.data)}let F=C.find(H=>H.pubkey.equals(k.platformId));(!F||!F.accountInfo)&&this.logAndCreateError("platform info not found: ",k.configId.toBase58());let B=pt.decode(F.accountInfo.data);u=u||B.feeRate;let L=c;if(!p)if(L)i=We;else{let H=await this.scope.connection.getAccountInfo(n);if(H&&H.owner.equals(We)){i=H.owner;let q=Zt(n,H,i);L=jt(q)||void 0}}let v=Ae.buyExactOut({poolInfo:k,amountA:g,protocolFeeRate:K.tradeFeeRate,platformFeeRate:u,curveType:K.curveType,shareFeeRate:h,creatorFeeRate:B.creatorFeeRate,transferFeeConfigA:L,slot:await this.scope.connection.getSlot()}),S=new be(v.amountB.toString()),W=y?new be(ze.add(y).toNumber()/ze.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new be(1),G=(l!=null?l:y)?new V(S.mul(W).toFixed(0)):v.amountB,U=this.scope.account.getAssociatedTokenAccount(n,i),Z=null,X=r.equals(ve);P.addInstruction({instructions:[de(this.scope.ownerPubKey,U,this.scope.ownerPubKey,n,i)]});let{account:Q,instructionParams:j}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:X?{payer:this.scope.ownerPubKey,amount:v.amountB}:void 0,skipCloseAccount:!X,notUseTokenAccount:X,associatedOnly:X?!1:I,checkCreateATAOwner:w});Q&&(Z=Q),P.addInstruction(j||{}),Z===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let ie=d?we(d,r,J).publicKey:void 0;return ie&&P.addInstruction({instructions:[de(this.scope.ownerPubKey,ie,d,r)]}),P.addInstruction({instructions:[Zi(e,this.scope.ownerPubKey,t,k.configId,k.platformId,x,U,Z,k.vaultA,k.vaultB,n,r,i,J,et(e,k.platformId,r).publicKey,tt(e,k.creator,r).publicKey,g,G,h,ie)]}),P.addCustomComputeBudget(m),P.addTipInstruction(T),P.versionBuild({txVersion:f,extInfo:{maxSpentAmount:G,outAmount:g}})}async sellToken({programId:e=re,authProgramId:t,mintAProgram:n=J,mintA:i,mintB:r=ve,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,sellAmount:A,minAmountB:l,slippage:g,shareFeeRate:y=new V(0),shareFeeReceiver:h,associatedOnly:d=!0,checkCreateATAOwner:I=!1,skipCheckMintA:w=!1}){t=t!=null?t:Ke(e).publicKey;let p=this.createTxBuilder(T);A.lte(new V(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:P}=dt(e,i,r),x;if(!w){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(We)){n=q.owner;let ae=Zt(i,q,n);x=jt(ae)||void 0}}let k=null,K=null,C=r.equals(ve),{account:F,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:d,checkCreateATAOwner:I});F&&(k=F),p.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:d,checkCreateATAOwner:I});L&&(K=L),p.addInstruction(v||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let q=await this.scope.connection.getAccountInfo(P,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",P.toBase58()),S=ke.decode(q.data)}let W=a,G=await Le(this.scope.connection,[W?void 0:S.configId,S.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!W){let q=G.find(ae=>ae.pubkey.equals(S.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),W=Ue.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(S.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Z=pt.decode(U.accountInfo.data);c=c||Z.feeRate;let X=Ae.sellExactIn({poolInfo:S,amountA:A,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:y,creatorFeeRate:Z.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Q=new be(X.amountB.toString()),j=g?new be(ze.sub(g).toNumber()/ze.toNumber()).clampedTo(0,1):new be(1),ie=l!=null?l:g?new V(Q.mul(j).toFixed(0)):X.amountB;ie.lte(new V(0))&&this.logAndCreateError(`out ${r.toBase58()} amount should be gt 0`);let H=h?we(h,r,J).publicKey:void 0;return H&&p.addInstruction({instructions:[de(this.scope.ownerPubKey,H,h,r)]}),p.addInstruction({instructions:[Qi(e,this.scope.ownerPubKey,t,S.configId,S.platformId,P,k,K,S.vaultA,S.vaultB,i,r,n,J,et(e,S.platformId,r).publicKey,tt(e,S.creator,r).publicKey,X.amountA.amount.lt(A)?X.amountA.amount:A,ie,y,H)]}),p.addCustomComputeBudget(f),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{outAmount:ie}})}async sellTokenExactOut({programId:e=re,authProgramId:t,mintAProgram:n=J,mintA:i,mintB:r=ve,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,inAmount:A,maxSellAmount:l,slippage:g,shareFeeRate:y=new V(0),shareFeeReceiver:h,associatedOnly:d=!0,checkCreateATAOwner:I=!1,skipCheckMintA:w=!1}){t=t!=null?t:Ke(e).publicKey;let p=this.createTxBuilder(T);l!=null&&l.lte(new V(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:P}=dt(e,i,r),x;if(!w){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(We)){n=q.owner;let ae=Zt(i,q,n);x=jt(ae)||void 0}}let k=null,K=null,C=r.equals(ve),{account:F,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:d,checkCreateATAOwner:I});F&&(k=F),p.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:d,checkCreateATAOwner:I});L&&(K=L),p.addInstruction(v||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let q=await this.scope.connection.getAccountInfo(P,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",P.toBase58()),S=ke.decode(q.data)}let W=a,G=await Le(this.scope.connection,[W?void 0:S.configId,S.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!W){let q=G.find(ae=>ae.pubkey.equals(S.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),W=Ue.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(S.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Z=pt.decode(U.accountInfo.data);c=c||Z.feeRate;let X=Ae.sellExactOut({poolInfo:S,amountB:A,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:y,creatorFeeRate:Z.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Q=new be(X.amountA.amount.toString()),j=g?new be(ze.add(g).toNumber()/ze.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new be(1),ie=(l!=null?l:g)?new V(Q.mul(j).toFixed(0)):X.amountA.amount,H=h?we(h,r,J).publicKey:void 0;return H&&p.addInstruction({instructions:[de(this.scope.ownerPubKey,H,h,r)]}),p.addInstruction({instructions:[Ji(e,this.scope.ownerPubKey,t,S.configId,S.platformId,P,k,K,S.vaultA,S.vaultB,i,r,n,J,et(e,S.platformId,r).publicKey,tt(e,S.creator,r).publicKey,A,ie,y,H)]}),p.addCustomComputeBudget(f),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{maxSellAmount:ie}})}async createPlatformConfig({programId:e=re,platformAdmin:t,platformClaimFeeWallet:n,platformLockNftWallet:i,cpConfigId:r,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:c,feeRate:u,name:f,web:m,img:T,txVersion:A,computeBudgetConfig:l,txTipConfig:g,feePayer:y}){let h=this.createTxBuilder(y),{publicKey:d}=On(e,t);return h.addInstruction({instructions:[$i(e,t,n,i,d,r,a,s,u,c,f,m,T)]}),h.addCustomComputeBudget(l),h.addTipInstruction(g),h.versionBuild({txVersion:A,extInfo:{platformId:d}})}async updatePlatformConfig({programId:e=re,platformAdmin:t,platformId:n,updateInfo:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=n!=null?n:On(e,t).publicKey;return u.addInstruction({instructions:[er(e,t,f,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async claimPlatformFee({programId:e=re,authProgramId:t,platformId:n,poolId:i,platformClaimFeeWallet:r,mintB:s,vaultB:a,mintBProgram:c=J,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T}){var h;let A=this.createTxBuilder(T);t=t!=null?t:Ke(e).publicKey;let l=s,g=a;if(!l){let d=await this.scope.connection.getAccountInfo(i,{commitment:"processed"});d||this.logAndCreateError("cannot found pool:",i.toBase58());let I=ke.decode(d.data),w=await this.scope.connection.getAccountInfo(I.configId,{commitment:"processed"});w||this.logAndCreateError("cannot found config:",I.configId.toBase58()),l=Ue.decode(w.data).mintB,g=g!=null?g:I.vaultB}(!l||!g)&&this.logAndCreateError("cannot found mint info, mintB: ",l.toBase58(),", vaultB: ",(h=g==null?void 0:g.toBase58())!=null?h:"");let y=we(this.scope.ownerPubKey,l,J).publicKey;return A.addInstruction({instructions:[de(this.scope.ownerPubKey,y,this.scope.ownerPubKey,l)]}),A.addInstruction({instructions:[_n(e,r,t,i,n,g,y,l,c)]}),A.addCustomComputeBudget(f),A.addTipInstruction(m),A.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=re,authProgramId:t,platformId:n,platformClaimFeeWallet:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:Ke(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:ke.span},{memcmp:{offset:ke.offsetOf("platformId"),bytes:n.toString()}}]})).forEach(m=>{let T=ke.decode(m.account.data);if(T.platformFee.lte(new V(0)))return;let A=we(this.scope.ownerPubKey,T.mintB,J).publicKey;u.addInstruction({instructions:[de(this.scope.ownerPubKey,A,this.scope.ownerPubKey,T.mintB)]}),u.addInstruction({instructions:[_n(e,i,t,m.pubkey,n,T.vaultB,A,T.mintB,J)]})}),u.addTipInstruction(a),r===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=re,poolId:t,beneficiary:n,shareAmount:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=await this.getRpcPoolInfo({poolId:t});i.add(f.vestingSchedule.totalAllocatedShare).gt(f.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=Nt(e,t,n).publicKey;return u.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,n,t,m,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async createMultipleVesting({programId:e=re,poolId:t,beneficiaryList:n,txVersion:i,computeBudgetConfig:r,feePayer:s}){let a=this.createTxBuilder(s);n.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return n.reduce((f,m)=>f.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),n.forEach(f=>{let m=Nt(e,t,f.wallet).publicKey;a.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,f.wallet,t,m,f.shareAmount)]})}),i===0?a.sizeCheckBuildV0({computeBudgetConfig:r}):a.sizeCheckBuild({computeBudgetConfig:r})}async claimVesting({programId:e=re,poolId:t,poolInfo:n,vestingRecord:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=Ke(e).publicKey,m=i||Nt(e,t,this.scope.ownerPubKey).publicKey,T=n;if(!T){let l=await this.scope.connection.getAccountInfo(t);l||this.logAndCreateError("pool not found"),T=ke.decode(l.data)}let A=we(this.scope.ownerPubKey,T.mintA,J).publicKey;return u.addInstruction({instructions:[de(this.scope.ownerPubKey,A,this.scope.ownerPubKey,T.mintA)]}),u.addInstruction({instructions:[Dn(e,this.scope.ownerPubKey,f,t,m,A,T.vaultA,T.mintA,J)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async claimMultiVesting({programId:e=re,poolIdList:t,poolsInfo:n={},vestingRecords:i={},txVersion:r,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=_({},n),f=Ke(e).publicKey,m=t.filter(T=>!u[T.toBase58()]);if(m.length){let T=await this.getRpcPoolsInfo({poolIdList:m});u=_(_({},u),T.poolInfoMap)}return t.forEach(T=>{let A=T.toBase58(),l=u[A];l||this.logAndCreateError(`pool info not found: ${A}`);let g=i[A]||Nt(e,T,this.scope.ownerPubKey).publicKey,y=we(this.scope.ownerPubKey,l.mintA,J).publicKey;c.addInstruction({instructions:[de(this.scope.ownerPubKey,y,this.scope.ownerPubKey,l.mintA)]}),c.addInstruction({instructions:[Dn(e,this.scope.ownerPubKey,f,T,g,y,l.vaultA,l.mintA,J)]})}),r===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=re,platformId:t,mintB:n,mintBProgram:i=J,claimFeeWallet:r,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let f=this.createTxBuilder(u),m=et(e,t,n).publicKey,T=En(e).publicKey,A=this.scope.account.getAssociatedTokenAccount(n,i);return f.addInstruction({instructions:[de(this.scope.ownerPubKey,A,this.scope.ownerPubKey,n,i),qn(e,t,r!=null?r:this.scope.ownerPubKey,T,m,A,n,i)]}),f.addCustomComputeBudget(a),f.addTipInstruction(c),f.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=re,platformList:t,unwrapSol:n=!0,txVersion:i,computeBudgetConfig:r,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),f={};return t.forEach(async m=>{var y,h;let T=En(e).publicKey,A=et(e,m.id,m.mintB).publicKey,l=m.mintB.equals(ve)&&n,g=f[m.mintB.toBase58()];if(!g){let{account:d,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:l?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!l,notUseTokenAccount:l,associatedOnly:l?!1:a,checkCreateATAOwner:c});d&&(g=d),u.addInstruction(I||{}),g===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[qn(e,m.id,(y=m.claimFeeWallet)!=null?y:this.scope.ownerPubKey,A,T,g,m.mintB,(h=m.mintBProgram)!=null?h:J)]})}),i===0?u.sizeCheckBuildV0({computeBudgetConfig:r}):u.sizeCheckBuild({computeBudgetConfig:r})}async claimCreatorFee({programId:e=re,mintB:t,mintBProgram:n=J,txVersion:i,computeBudgetConfig:r,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=tt(e,this.scope.ownerPubKey,t).publicKey,f=vn(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,n);return c.addInstruction({instructions:[de(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,n),Gn(e,this.scope.ownerPubKey,f,u,m,t,n)]}),c.addCustomComputeBudget(r),c.addTipInstruction(s),c.versionBuild({txVersion:i})}async claimMultipleCreatorFee({programId:e=re,mintBList:t,txVersion:n,computeBudgetConfig:i,feePayer:r}){let s=this.createTxBuilder(r);return t.forEach(a=>{var A;let c=a.pubKey,u=(A=a.programId)!=null?A:J,f=tt(e,this.scope.ownerPubKey,c).publicKey,m=vn(e).publicKey,T=this.scope.account.getAssociatedTokenAccount(c,u);s.addInstruction({instructions:[de(this.scope.ownerPubKey,T,this.scope.ownerPubKey,c,u),Gn(e,this.scope.ownerPubKey,m,f,T,c,u)]})}),n==0?s.sizeCheckBuildV0({computeBudgetConfig:i}):s.sizeCheckBuild({computeBudgetConfig:i})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let n=await Le(this.scope.connection,e.map(c=>({pubkey:c})),t),i={},r=[];for(let c=0;c<e.length;c++){let u=n[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let f=ke.decode(u.accountInfo.data);i[e[c].toBase58()]=Y(_({},f),{poolId:u.accountInfo.owner}),r.push(f.configId)}let s=await Le(this.scope.connection,r.map(c=>({pubkey:c})),t),a={};for(let c=0;c<r.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+r[c].toBase58());let f=Ue.decode(u.accountInfo.data);a[r[c].toBase58()]=Y(_({},f),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(i).reduce((c,u)=>Y(_({},c),{[u]:Y(_({},i[u]),{configInfo:a[i[u].configId.toBase58()]})}),{})}}};export{it as LaunchpadPoolInitParam,Xn as default};
//# sourceMappingURL=launchpad.mjs.map