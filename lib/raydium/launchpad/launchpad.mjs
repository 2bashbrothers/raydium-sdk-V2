var rr=Object.defineProperty,or=Object.defineProperties;var sr=Object.getOwnPropertyDescriptors;var Mt=Object.getOwnPropertySymbols;var $n=Object.prototype.hasOwnProperty,ei=Object.prototype.propertyIsEnumerable;var Jn=(o,e,t)=>e in o?rr(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,_=(o,e)=>{for(var t in e||(e={}))$n.call(e,t)&&Jn(o,t,e[t]);if(Mt)for(var t of Mt(e))ei.call(e,t)&&Jn(o,t,e[t]);return o},j=(o,e)=>or(o,sr(e));var ve=(o,e)=>{var t={};for(var n in o)$n.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&Mt)for(var n of Mt(o))e.indexOf(n)<0&&ei.call(o,n)&&(t[n]=o[n]);return t};import{get as ti,set as ar}from"lodash";var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ni={},cr={};function se(o){let e=ti(ni,o);if(!e){let t=ti(cr,o);e=new en({name:o,logLevel:t}),ar(ni,o,e)}return e}import{PublicKey as Ze,sendAndConfirmTransaction as gn,SystemProgram as Dr,Transaction as Bt,TransactionMessage as Re,VersionedTransaction as Le}from"@solana/web3.js";import Wr from"axios";import{PublicKey as yn,AddressLookupTableAccount as rt}from"@solana/web3.js";import{PublicKey as vr}from"@solana/web3.js";import xe from"bn.js";import ba from"decimal.js";import yr from"big.js";import Xo from"bn.js";import ur from"toformat";var lr=ur,pt=lr;import Et from"big.js";import dr from"bn.js";import pr from"decimal.js-light";import ft from"bn.js";var ii=9007199254740991;function he(o){let e=se("Raydium_parseBigNumberish");if(o instanceof ft)return o;if(typeof o=="string"){if(o.match(/^-?[0-9]+$/))return new ft(o);e.logWithError(`invalid BigNumberish string: ${o}`)}return typeof o=="number"?(o%1&&e.logWithError(`BigNumberish number underflow: ${o}`),(o>=ii||o<=-ii)&&e.logWithError(`BigNumberish number overflow: ${o}`),new ft(String(o))):typeof o=="bigint"?new ft(o.toString()):(e.error(`invalid BigNumberish value: ${o}`),new ft(0))}var Ot=se("module/fraction"),tn=pt(Et),bt=pt(pr),fr={[0]:bt.ROUND_DOWN,[1]:bt.ROUND_HALF_UP,[2]:bt.ROUND_UP},br={[0]:Et.roundDown,[1]:Et.roundHalfUp,[2]:Et.roundUp},J=class{constructor(e,t=new dr(1)){this.numerator=he(e),this.denominator=he(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(he(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(he(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(he(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(he(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<=0&&Ot.logWithError(`${e} is not positive.`),bt.set({precision:e+1,rounding:fr[n]});let i=new bt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<0&&Ot.logWithError(`${e} is negative.`),tn.DP=e,tn.RM=br[n]||1,new tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var es=se("Raydium_amount"),ts=pt(yr);import{PublicKey as Pr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ri}from"@solana/spl-token";var nn={chainId:101,address:Pr.default.toBase58(),programId:ri.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},De={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ri.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as sn}from"@solana/web3.js";import{PublicKey as $,SystemProgram as oi,SYSVAR_RENT_PUBKEY as Ar}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wr}from"@solana/spl-token";function rn({pubkey:o,isSigner:e=!1,isWritable:t=!0}){return{pubkey:o,isWritable:t,isSigner:e}}var us=[rn({pubkey:wr,isWritable:!1}),rn({pubkey:oi.programId,isWritable:!1}),rn({pubkey:Ar,isWritable:!1})];function si({publicKey:o,transformSol:e}){let t=ai(o.toString());if(t instanceof $)return e&&t.equals(yt)?vt:t;if(e&&t.toString()===yt.toBase58())return vt;if(typeof t=="string"){if(t===$.default.toBase58())return $.default;try{return new $(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ai(o){try{return new $(o)}catch{return o}}var Tr=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),kr=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),on=new $("SysvarRent111111111111111111111111111111111"),ls=new $("SysvarC1ock11111111111111111111111111111111"),nt=new $("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ms=new $("Sysvar1nstructions1111111111111111111111111"),ds=oi.programId,ps=new $("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),fs=new $("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),bs=new $("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ys=new $("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),gs=new $("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ps=new $("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),As=new $("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ws=new $("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ts=new $("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ks=new $("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Bs=new $("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),vt=new $("So11111111111111111111111111111111111111112"),yt=$.default;var an=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:r=!1,isToken2022:s=!1}){if(e===yt.toBase58()||e instanceof sn&&yt.equals(e)){this.decimals=De.decimals,this.symbol=De.symbol,this.name=De.name,this.mint=new sn(De.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=r?sn.default:si({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},We=an;We.WSOL=new an(j(_({},De),{mint:De.address}));var cn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Dt=cn;Dt.SOL=new cn(nn);import Br from"bn.js";var Os=new J(new Br(100));var _s=se("Raydium_price");import{PublicKey as ra}from"@solana/web3.js";import sa from"bn.js";var hr=new xe(0),xa=new xe(1),Ia=new xe(2),Sa=new xe(3),Ka=new xe(5),gr=new xe(10),Ca=new xe(100),Na=new xe(1e3),Ra=new xe(1e4);function ci(o,e,t){return o.mul(e).add(t).sub(new xe(1)).div(t)}function mn(o,e=1,t=[]){let n=[...o];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Ie=class{constructor(e){this._owner=e}get publicKey(){return Ie.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return Ie.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return Ie.isKeyPair(this._owner)}get isPublicKey(){return Ie.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!Ie.isKeyPair(e)}};import{PublicKey as Rr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Lr}from"@solana/spl-token";import{ComputeBudgetProgram as ui,Keypair as mi,PublicKey as xr,Transaction as di,TransactionMessage as Ir,VersionedTransaction as pi}from"@solana/web3.js";var ze={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Sr}from"@solana/spl-token";var li=se("Raydium_txUtil"),fi=1644;function gt(o){let e=[],t=[];return o.microLamports&&(e.push(ui.setComputeUnitPrice({microLamports:o.microLamports})),t.push(ze.SetComputeUnitPrice)),o.units&&(e.push(ui.setComputeUnitLimit({units:o.units})),t.push(ze.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function He(o,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=o.getLatestBlockhash)==null?void 0:n.call(o,{commitment:t})))==null?void 0:i.blockhash}async function Pt(o,e){return o.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);o.onSignature(e,r=>{if(clearTimeout(i),!r.err){t("");return}n(Object.assign(r.err,{txId:e}))},"confirmed")})}function Kr(o,e){o.length<1&&li.logWithError(`no instructions provided: ${o.toString()}`),e.length<1&&li.logWithError(`no signers provided:, ${e.toString()}`);let t=new di;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...o);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<fi}catch{return!1}}function ce(o,e){let[t,n]=xr.findProgramAddressSync(o,e);return{publicKey:t,nonce:n}}function At({instructions:o,payer:e,signers:t}){return Kr(o,[e,...t])}function Ce({instructions:o,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=mi.generate().publicKey.toString()}){let r=new Ir({payerKey:e,recentBlockhash:n,instructions:o}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new pi(r).serialize()).toString("base64").length<fi}catch{return!1}}var Cr=o=>Buffer.isBuffer(o)?o:o instanceof Uint8Array?Buffer.from(o.buffer,o.byteOffset,o.byteLength):Buffer.from(o),Nr=o=>{let e=o.serialize({requireAllSignatures:!1,verifySignatures:!1});o instanceof pi&&(e=Cr(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Ve(o){let e=[];return o.forEach(t=>{t instanceof di&&(t.recentBlockhash||(t.recentBlockhash=Sr.toBase58()),t.feePayer||(t.feePayer=mi.generate().publicKey)),e.push(Nr(t))}),console.log("simulate tx string:",e),e}function Te(o,e,t){return ce([o.toBuffer(),(t!=null?t:Lr).toBuffer(),e.toBuffer()],new Rr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var Ja=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),$a=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ec=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),tc=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),nc=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ic=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),rc=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),oc=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),sc=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ac=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Fr=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Mr=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Or=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),cc=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),uc=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),lc=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),mc=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),dc=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),pc=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),fc=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),bc=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),yc=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),gc=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Pc=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ac=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),re=new O("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),wc=new O("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Tc=new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),kc=new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Bc=new O("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),hc=new O("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var xc={OPEN_BOOK_PROGRAM:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O("Ray1111111111111111111111111111111111111111"),AMM_V4:new O("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.default,Router:new O("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O("Ray1111111111111111111111111111111111111111")};import ae from"bn.js";var wt=1e4;function dn(o,e){let{div:t,mod:n}=o.divmod(e);return n.gt(new ae(0))?t.add(new ae(1)):t}function je(o,e){if(o.isZero())return new ae(0);let t=o.div(e);return t.isZero()?new ae(1):o.mod(e).gt(new ae(0))?t.add(new ae(1)):t}function pn(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new ae(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=dn(o.mul(new ae(i.transferFeeBasisPoints)),new ae(wt)),l=a.gt(r)?r:a;return{amount:o,fee:l,expirationTime:s}}function fn(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new ae(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===wt){let a=new ae(i.maximumFee.toString());return{amount:o.add(a),fee:a,expirationTime:s}}else{let a=dn(o.mul(new ae(wt)),new ae(wt-i.transferFeeBasisPoints)),l=new ae(i.maximumFee.toString()),c=a.sub(o).gt(l)?o.add(l):a,p=dn(c.mul(new ae(i.transferFeeBasisPoints)),new ae(wt)),m=p.gt(r)?r:p;return{amount:c,fee:m,expirationTime:s}}}import Er from"bn.js";var Qe=new Er(1e6);import{MINT_SIZE as iu,TOKEN_PROGRAM_ID as ru,getTransferFeeConfig as ou,unpackMint as su}from"@solana/spl-token";var bn=se("Raydium_accountInfo_util");async function Tt(o,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:r=100}=_({batchRequest:!1},t),s=mn(e,r),a=new Array(s.length).fill([]);if(n){let l=s.map(m=>{let w=o._buildArgs([m.map(A=>A.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:w}}),c=mn(l,10);a=(await(await Promise.all(c.map(async m=>await o._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(w=>{if(w){let{data:A,executable:u,lamports:y,owner:f,rentEpoch:h}=w;return A.length!==2&&A[1]!=="base64"&&bn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(A[0],"base64"),executable:u,lamports:y,owner:new vr(f),rentEpoch:h}}return null})))}else try{a=await Promise.all(s.map(l=>o.getMultipleAccountsInfo(l,i)))}catch(l){l instanceof Error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.message}`)}return a.flat()}async function Ne(o,e,t){let n=await Tt(o,e.map(i=>i.pubkey),t);return e.map((i,r)=>j(_({},i),{accountInfo:n[r]}))}async function Vt({connection:o,address:e,cluster:t="mainnet"}){let n=await Tt(o,[...new Set(e.map(r=>r.toString()))].map(r=>new yn(r))),i={};for(let r=0;r<e.length;r++){let s=n[r],a=e[r];if(!s)continue;let l=new rt({key:a,state:rt.deserialize(s.data)});i[a.toString()]=l,t==="devnet"?it[a.toString()]=l:kt[a.toString()]=l}return i}var kt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new rt({key:new yn("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:rt.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},it={},_t=async o=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(it[e])return it;let t=new yn(e),n=await o.getAccountInfo(t);return n&&(it[e]=new rt({key:t,state:rt.deserialize(n.data)})),it};var ht=2e3,xt=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Wr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=gt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Dr.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Ze(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(ze.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:r=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...r),this.lookupTableAddress.push(...s.filter(a=>a!==Ze.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(_({},t||{})):this.build(t)}build(e){var n;let t=new Bt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var p;let{recentBlockHash:r,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:l}=i||{},c=r!=null?r:await He(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),Ve([t]),(p=this.owner)!=null&&p.isKeyPair)return{txId:a?await gn(this.connection,t,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let w of m)try{w.sign(...this.signers)}catch{}return{txId:l?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var c;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),r=t.filter(p=>p.transaction.instructions.length>0),s=[i,...r.map(p=>p.transaction)],a=[this.signers,...r.map(p=>p.signers)],l=[...this.instructionTypes,...r.map(p=>p.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(p=>{p.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:l,execute:async p=>{var h;let{sequentially:m,onTxUpdate:w,skipTxCount:A=0,recentBlockHash:u,skipPreflight:y=!0}=p||{},f=u!=null?u:await He(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(m){let b=[],I=0;for(let T of s){if(++I,I<=A)continue;let d=await gn(this.connection,T,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});b.push(d)}return{txIds:b,signedTxs:s}}return{txIds:await await Promise.all(s.map(async b=>(b.recentBlockhash=f,await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:y})))),signedTxs:s}}if(this.signAllTransactions){let b=s.map((T,d)=>(T.recentBlockhash=f,a[d].length&&T.sign(...a[d]),T));Ve(b);let I=await this.signAllTransactions(b);if(m){let T=0,d=[],P=async()=>{if(!I[T])return;let x=await this.connection.sendRawTransaction(I[T].serialize(),{skipPreflight:y});d.push({txId:x,status:"sent",signedTx:I[T]}),w==null||w([...d]),T++;let k=!1,K=null,C=null,B=R=>{K!==null&&clearInterval(K),C!==null&&this.connection.removeSignatureListener(C);let L=d.findIndex(v=>v.txId===x);if(L>-1){if(d[L].status==="error"||d[L].status==="success")return;d[L].status=R.err?"error":"success"}w==null||w([...d]),R.err||P()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var R;if(k){clearInterval(K);return}try{let L=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(k=!0,clearInterval(K),B({err:((R=L.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",x))}catch(L){k=!0,clearInterval(K),console.error("getTransaction timeout:",L,x)}},ht)),C=this.connection.onSignature(x,R=>{if(k){this.connection.removeSignatureListener(C);return}k=!0,B(R)},"confirmed"),this.connection.getSignatureStatus(x)};return await P(),{txIds:d.map(x=>x.txId),signedTxs:I}}else{let T=[];for(let d=0;d<I.length;d+=1){let P=await this.connection.sendRawTransaction(I[d].serialize(),{skipPreflight:y});T.push(P)}return{txIds:T,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var y;let u=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:r}=u,s=ve(u,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):kt),t),l=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let f of l)a[f]===void 0&&c.push(new Ze(f));let p=await Vt({connection:this.connection,address:c});for(let[f,h]of Object.entries(p))a[f]=h;let m=i?Ze.default.toBase58():r!=null?r:await He(this.connection,this.blockhashCommitment),w=new Re({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((y=this.owner)==null?void 0:y.signer)&&!this.signers.some(f=>f.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let A=new Le(w);return A.sign(this.signers),{builder:this,transaction:A,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{var T;let{skipPreflight:h=!0,sendAndConfirm:b,notSendToRpc:I}=f||{};if(Ve([A]),(T=this.owner)!=null&&T.isKeyPair){let d=await this.connection.sendTransaction(A,{skipPreflight:h});return b&&await Pt(this.connection,d),{txId:d,signedTx:A}}if(this.signAllTransactions){let d=await this.signAllTransactions([A]);if(this.signers.length)for(let P of d)try{P.sign(this.signers)}catch{}return{txId:I?"":await this.connection.sendTransaction(d[0],{skipPreflight:h}),signedTx:d[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var c;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),r=t.filter(p=>p.builder.instructions.length>0),s=[i,...r.map(p=>p.transaction)],a=[this.signers,...r.map(p=>p.signers)],l=[...this.instructionTypes,...r.map(p=>p.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(p=>{p.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(p,m)=>{p.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:l,buildProps:n,execute:async p=>{var y;let{sequentially:m,onTxUpdate:w,recentBlockHash:A,skipPreflight:u=!0}=p||{};if(A&&s.forEach(f=>f.message.recentBlockhash=A),Ve(s),(y=this.owner)!=null&&y.isKeyPair){if(m){let f=[];for(let h of s){let b=await this.connection.sendTransaction(h,{skipPreflight:u});await Pt(this.connection,b),f.push(b)}return{txIds:f,signedTxs:s}}return{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f,{skipPreflight:u}))),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let h=0,b=[],I=async()=>{if(!f[h])return;let T=await this.connection.sendTransaction(f[h],{skipPreflight:u});b.push({txId:T,status:"sent",signedTx:f[h]}),w==null||w([...b]),h++;let d=!1,P=null,x=null,k=K=>{P!==null&&clearInterval(P),x!==null&&this.connection.removeSignatureListener(x);let C=b.findIndex(B=>B.txId===T);if(C>-1){if(b[C].status==="error"||b[C].status==="success")return;b[C].status=K.err?"error":"success"}w==null||w([...b]),K.err||I()};this.loopMultiTxStatus&&(P=setInterval(async()=>{var K;if(d){clearInterval(P);return}try{let C=await this.connection.getTransaction(T,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(d=!0,clearInterval(P),k({err:((K=C.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",T))}catch(C){d=!0,clearInterval(P),console.error("getTransaction timeout:",C,T)}},ht)),x=this.connection.onSignature(T,K=>{if(d){this.connection.removeSignatureListener(x);return}d=!0,k(K)},"confirmed"),this.connection.getSignatureStatus(T)};return I(),{txIds:[],signedTxs:f}}else{let h=[];for(let b=0;b<f.length;b+=1){let I=await this.connection.sendTransaction(f[b],{skipPreflight:u});h.push(I)}return{txIds:h,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var w;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=ve(m,["splitIns","computeBudgetConfig"]),r=n?gt(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((A,u)=>j(_({},A),{[u.publicKey.toBase58()]:u}),{}),a=[],l=[],c=[],p=0;if(this.allInstructions.forEach(A=>{let u=[...c,A],y=n?[...r.instructions,...u]:u,h=[...new Set(u.map(b=>b.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(b=>new Ze(b));if(A!==t[p]&&c.length<12&&(At({instructions:y,payer:this.feePayer,signers:h})||At({instructions:u,payer:this.feePayer,signers:h})))c.push(A);else{if(c.length===0)throw Error("item ins too big");p+=A===t[p]?1:0,At({instructions:n?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:h})?a.push(new Bt().add(...r.instructions,...c)):a.push(new Bt().add(...c)),l.push(Array.from(new Set(c.map(b=>b.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(b=>s[b]).filter(b=>b!==void 0)),c=[A]}}),c.length>0){let u=[...new Set(c.map(y=>y.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(y=>s[y]).filter(y=>y!==void 0);At({instructions:n?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:u.map(y=>y.publicKey)})?a.push(new Bt().add(...r.instructions,...c)):a.push(new Bt().add(...c)),l.push(u)}return a.forEach(A=>A.feePayer=this.feePayer),(w=this.owner)!=null&&w.signer&&l.forEach(A=>{A.some(u=>u.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:a,signers:l,instructionTypes:this.instructionTypes,execute:async A=>{var T;let{sequentially:u,onTxUpdate:y,skipTxCount:f=0,recentBlockHash:h,skipPreflight:b=!0}=A||{},I=h!=null?h:await He(this.connection,this.blockhashCommitment);if(a.forEach(async(d,P)=>{d.recentBlockhash=I,l[P].length&&d.sign(...l[P])}),Ve(a),(T=this.owner)!=null&&T.isKeyPair){if(u){let d=0,P=[];for(let x of a){if(++d,d<=f){P.push("tx skipped");continue}let k=await gn(this.connection,x,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});P.push(k)}return{txIds:P,signedTxs:a}}return{txIds:await Promise.all(a.map(async d=>await this.connection.sendRawTransaction(d.serialize(),{skipPreflight:b}))),signedTxs:a}}if(this.signAllTransactions){let d=await this.signAllTransactions(a.slice(f,a.length)),P=[...a.slice(0,f),...d];if(u){let x=0,k=[],K=async()=>{if(!P[x])return;x<f&&(k.push({txId:"",status:"success",signedTx:P[x]}),y==null||y([...k]),x++,K());let C=await this.connection.sendRawTransaction(P[x].serialize(),{skipPreflight:b});k.push({txId:C,status:"sent",signedTx:P[x]}),y==null||y([...k]),x++;let B=!1,R=null,L=null,v=S=>{R!==null&&clearInterval(R),L!==null&&this.connection.removeSignatureListener(L);let N=k.findIndex(U=>U.txId===C);if(N>-1){if(k[N].status==="error"||k[N].status==="success")return;k[N].status=S.err?"error":"success"}y==null||y([...k]),S.err||K()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var S;if(B){clearInterval(R);return}try{let N=await this.connection.getTransaction(C,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(B=!0,clearInterval(R),v({err:((S=N.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",C))}catch(N){B=!0,clearInterval(R),console.error("getTransaction timeout:",N,C)}},ht)),L=this.connection.onSignature(C,S=>{if(B){this.connection.removeSignatureListener(L);return}B=!0,v(S)},"confirmed"),this.connection.getSignatureStatus(C)};return await K(),{txIds:k.map(C=>C.txId),signedTxs:P}}else{let x=[];for(let k=0;k<P.length;k+=1){let K=await this.connection.sendRawTransaction(P[k].serialize(),{skipPreflight:b});x.push(K)}return{txIds:x,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var I;let b=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:r=[]}=b,s=ve(b,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):kt),i),l=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let T of l)a[T]===void 0&&c.push(new Ze(T));let p=await Vt({connection:this.connection,address:c});for(let[T,d]of Object.entries(p))a[T]=d;let m=t?gt(t):{instructions:[],instructionTypes:[]},w=await He(this.connection,this.blockhashCommitment),A=this.signers.reduce((T,d)=>j(_({},T),{[d.publicKey.toBase58()]:d}),{}),u=[],y=[],f=[],h=0;if(this.allInstructions.forEach(T=>{let d=[...f,T],P=t?[...m.instructions,...d]:d;if(T!==n[h]&&f.length<12&&(Ce({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||Ce({instructions:d,payer:this.feePayer,lookupTableAddressAccount:a})))f.push(T);else{if(f.length===0)throw Error("item ins too big");h+=T===n[h]?1:0;let x={};for(let k of[...new Set(l)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Ce({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:w})){let k=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));u.push(new Le(k))}else{let k=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...f]}).compileToV0Message(Object.values(a));u.push(new Le(k))}y.push(Array.from(new Set(f.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>A[k]).filter(k=>k!==void 0)),f=[T]}}),f.length>0){let d=[...new Set(f.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>A[P]).filter(P=>P!==void 0);if(t&&Ce({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:w})){let P=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));u.push(new Le(P))}else{let P=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...f]}).compileToV0Message(Object.values(a));u.push(new Le(P))}y.push(d)}return(I=this.owner)!=null&&I.signer&&y.forEach(T=>{T.some(d=>d.publicKey.equals(this.owner.publicKey))||T.push(this.owner.signer)}),u.forEach((T,d)=>{T.sign(y[d])}),{builder:this,transactions:u,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async T=>{var C;let{sequentially:d,onTxUpdate:P,skipTxCount:x=0,recentBlockHash:k,skipPreflight:K=!0}=T||{};if(u.map(async(B,R)=>{y[R].length&&B.sign(y[R]),k&&(B.message.recentBlockhash=k)}),Ve(u),(C=this.owner)!=null&&C.isKeyPair){if(d){let B=0,R=[];for(let L of u){if(++B,B<=x){console.log("skip tx: ",B),R.push("tx skipped");continue}let v=await this.connection.sendTransaction(L,{skipPreflight:K});await Pt(this.connection,v),R.push(v)}return{txIds:R,signedTxs:u}}return{txIds:await Promise.all(u.map(async B=>await this.connection.sendTransaction(B,{skipPreflight:K}))),signedTxs:u}}if(this.signAllTransactions){let B=await this.signAllTransactions(u.slice(x,u.length)),R=[...u.slice(0,x),...B];if(d){let L=0,v=[],S=async()=>{if(!R[L])return;if(L<x){v.push({txId:"",status:"success",signedTx:R[L]}),P==null||P([...v]),L++,S();return}let N=await this.connection.sendTransaction(R[L],{skipPreflight:K});v.push({txId:N,status:"sent",signedTx:R[L]}),P==null||P([...v]),L++;let U=!1,G=null,Q=null,X=Z=>{G!==null&&clearInterval(G),Q!==null&&this.connection.removeSignatureListener(Q);let Y=v.findIndex(ne=>ne.txId===N);if(Y>-1){if(v[Y].status==="error"||v[Y].status==="success")return;v[Y].status=Z.err?"error":"success"}P==null||P([...v]),Z.err||S()};this.loopMultiTxStatus&&(G=setInterval(async()=>{var Z;if(U){clearInterval(G);return}try{let Y=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(U=!0,clearInterval(G),X({err:((Z=Y.meta)==null?void 0:Z.err)||null}),console.log("tx status from getTransaction:",N))}catch(Y){U=!0,clearInterval(G),console.error("getTransaction timeout:",Y,N)}},ht)),Q=this.connection.onSignature(N,Z=>{if(U){this.connection.removeSignatureListener(Q);return}U=!0,X(Z)},"confirmed"),this.connection.getSignatureStatus(N)};return S(),{txIds:[],signedTxs:R}}else{let L=[];for(let v=0;v<R.length;v+=1){let S=await this.connection.sendTransaction(R[v],{skipPreflight:K});L.push(S)}return{txIds:L,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildSniperTransaction(e){var I;let b=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:r=[]}=b,s=ve(b,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await _t(this.connection):kt),i),l=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let T of l)a[T]===void 0&&c.push(new Ze(T));let p=await Vt({connection:this.connection,address:c});for(let[T,d]of Object.entries(p))a[T]=d;let m=t?gt(t):{instructions:[],instructionTypes:[]},w=await He(this.connection,this.blockhashCommitment),A=this.signers.reduce((T,d)=>j(_({},T),{[d.publicKey.toBase58()]:d}),{}),u=[],y=[],f=[],h=0;if(this.allInstructions.forEach(T=>{let d=[...f,T],P=t?[...m.instructions,...d]:d;if(T!==n[h]&&f.length<12&&(Ce({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||Ce({instructions:d,payer:this.feePayer,lookupTableAddressAccount:a})))f.push(T);else{if(f.length===0)throw Error("item ins too big");h+=T===n[h]?1:0;let x={};for(let k of[...new Set(l)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Ce({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:w})){let k=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));u.push(new Le(k))}else{let k=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...f]}).compileToV0Message(Object.values(a));u.push(new Le(k))}y.push(Array.from(new Set(f.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>A[k]).filter(k=>k!==void 0)),f=[T]}}),f.length>0){let d=[...new Set(f.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>A[P]).filter(P=>P!==void 0);if(t&&Ce({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:w})){let P=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(a));u.push(new Le(P))}else{let P=new Re({payerKey:this.feePayer,recentBlockhash:w,instructions:[...f]}).compileToV0Message(Object.values(a));u.push(new Le(P))}y.push(d)}return(I=this.owner)!=null&&I.signer&&y.forEach(T=>{T.some(d=>d.publicKey.equals(this.owner.publicKey))||T.push(this.owner.signer)}),u.forEach((T,d)=>{T.sign(y[d])}),{builder:this,transactions:u,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async T=>{var C;let{sequentially:d,onTxUpdate:P,skipTxCount:x=0,recentBlockHash:k,skipPreflight:K=!0}=T||{};if(u.map(async(B,R)=>{y[R].length&&B.sign(y[R]),k&&(B.message.recentBlockhash=k)}),Ve(u),(C=this.owner)!=null&&C.isKeyPair){if(d){let B=0,R=[];for(let L of u){if(++B,B<=x){console.log("skip tx: ",B),R.push("tx skipped");continue}let v=await this.connection.sendTransaction(L,{skipPreflight:K});await Pt(this.connection,v),R.push(v)}return{txIds:R,signedTxs:u}}return{txIds:await Promise.all(u.map(async B=>await this.connection.sendTransaction(B,{skipPreflight:K}))),signedTxs:u}}if(this.signAllTransactions){let B=await this.signAllTransactions(u.slice(x,u.length)),R=[...u.slice(0,x),...B];if(d){let L=0,v=[],S=async()=>{if(!R[L])return;if(L<x){v.push({txId:"",status:"success",signedTx:R[L]}),P==null||P([...v]),L++,S();return}let N=await this.connection.sendTransaction(R[L],{skipPreflight:K});v.push({txId:N,status:"sent",signedTx:R[L]}),P==null||P([...v]),L++;let U=!1,G=null,Q=null,X=Z=>{G!==null&&clearInterval(G),Q!==null&&this.connection.removeSignatureListener(Q);let Y=v.findIndex(ne=>ne.txId===N);if(Y>-1){if(v[Y].status==="error"||v[Y].status==="success")return;v[Y].status=Z.err?"error":"success"}P==null||P([...v]),Z.err||S()};this.loopMultiTxStatus&&(G=setInterval(async()=>{var Z;if(U){clearInterval(G);return}try{let Y=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(U=!0,clearInterval(G),X({err:((Z=Y.meta)==null?void 0:Z.err)||null}),console.log("tx status from getTransaction:",N))}catch(Y){U=!0,clearInterval(G),console.error("getTransaction timeout:",Y,N)}},ht)),Q=this.connection.onSignature(N,Z=>{if(U){this.connection.removeSignatureListener(Q);return}U=!0,X(Z)},"confirmed"),this.connection.getSignatureStatus(N)};return S(),{txIds:[],signedTxs:R}}else{let L=[];for(let v=0;v<R.length;v+=1){let S=await this.connection.sendTransaction(R[v],{skipPreflight:K});L.push(S)}return{txIds:L,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var Pn=(...o)=>o.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ot=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=se(t)}createTxBuilder(e){return this.scope.checkOwner(),new xt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new Ie(e);return new xt({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Pn(e))}logInfo(...e){this.logger.info(Pn(e))}logAndCreateError(...e){let t=Pn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as yp}from"@solana/web3.js";import Pp from"bn.js";import wp from"decimal.js";import{AccountLayout as Bp,createAssociatedTokenAccountIdempotentInstruction as hp,TOKEN_2022_PROGRAM_ID as xp,TOKEN_PROGRAM_ID as Ip}from"@solana/spl-token";import{PublicKey as Ru}from"@solana/web3.js";import{MintLayout as Fu,TOKEN_PROGRAM_ID as Ou}from"@solana/spl-token";import{Keypair as Vd,PublicKey as _d,SystemProgram as Gd,TransactionInstruction as Ud}from"@solana/web3.js";import zd from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Qd,TOKEN_2022_PROGRAM_ID as Zd,TOKEN_PROGRAM_ID as Yd}from"@solana/spl-token";import{PublicKey as Zr}from"@solana/web3.js";import ki,{isBN as Bi}from"bn.js";import{bits as qu,BitStructure as Gu,blob as Vr,Blob as Uu,cstr as Xu,f32 as zu,f32be as Hu,f64 as ju,f64be as Qu,greedy as Zu,Layout as _r,ns64 as Yu,ns64be as Ju,nu64 as $u,nu64be as el,offset as qr,s16 as tl,s16be as nl,s24 as il,s24be as rl,s32 as Gr,s32be as ol,s40 as sl,s40be as al,s48 as cl,s48be as ul,s8 as ll,seq as Ur,struct as ml,Structure as Xr,u16 as zr,u16be as dl,u24 as pl,u24be as fl,u32 as Hr,u32be as bl,u40 as yl,u40be as gl,u48 as Pl,u48be as Al,u8 as jr,UInt as Qr,union as wl,Union as Tl,unionLayoutDiscriminator as kl,utf8 as Bl}from"@solana/buffer-layout";var An=_r,gi=Xr;var wn=Qr;var Pi=jr,Fe=zr;var Ai=Hr;var Me=Gr;var wi=Ur;var ue=Vr;var Ti=qr;var st=class extends An{constructor(t,n,i){super(t,i);this.blob=ue(t),this.signed=n}decode(t,n=0){let i=new ki(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new ki(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function W(o){return new wn(1,o)}function ct(o){return new wn(4,o)}function g(o){return new st(8,!1,o)}function ee(o){return new st(16,!1,o)}function hi(o){return new st(8,!0,o)}function xi(o){return new st(16,!0,o)}var at=class extends An{constructor(t,n,i,r){super(t.span,r);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function E(o){return new at(ue(32),e=>new Zr(e),e=>e.toBuffer(),o)}function kn(o){return new at(Pi(),Yr,Jr,o)}function Yr(o){if(o===0)return!1;if(o===1)return!0;throw new Error("Invalid bool: "+o)}function Jr(o){return o?1:0}function $r(o){let e=Ai("length"),t=V([e,ue(Ti(e,-e.span),"data")]);return new at(t,({data:n})=>n,n=>({data:n}),o)}function le(o){return new at($r(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),o)}var Tn=class extends gi{decode(e,t){return super.decode(e,t)}};function V(o,e,t){return new Tn(o,e,t)}function H(o,e,t){let n,i=typeof e=="number"?e:Bi(e)?e.toNumber():new Proxy(e,{get(r,s){if(!n){let a=Reflect.get(r,"count");n=Bi(a)?a.toNumber():a,Reflect.set(r,"count",n)}return Reflect.get(r,s)},set(r,s,a){return s==="count"&&(n=a),Reflect.set(r,s,a)}});return wi(o,i,t)}import Ad from"bn.js";import Td from"decimal.js";import be from"bn.js";var Bn=new be(0),Ii=new be(1),Si=new be(-1),Se=new be(1).shln(64),Ki=new be(1).shln(128),hn=Se.sub(Ii);var eo=Ki.subn(1),ut=-443636,It=-ut,xn=new be("4295048016"),In=new be("79226673521066979257578248091"),Ol=new be("4295048017"),El=new be("79226673521066979257578248090");var to=new be(10).pow(new be(6));var vl=new be("18446744073700000000");import rd from"bn.js";import sd from"decimal.js";var Gl=Buffer.from("amm_config","utf8"),Ci=Buffer.from("pool","utf8"),Ni=Buffer.from("pool_vault","utf8"),Ul=Buffer.from("pool_reward_vault","utf8"),Xl=Buffer.from("position","utf8"),zl=Buffer.from("tick_array","utf8"),Hl=Buffer.from("operation","utf8"),jl=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ql=Buffer.from("observation","utf8");function Sn(o){return ce([Buffer.from("metadata","utf8"),nt.toBuffer(),o.toBuffer()],nt)}var Zl=Buffer.from("locked_position","utf8");var Yl=Buffer.from("support_mint","utf8");import{PublicKey as Rm}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Fm}from"@solana/spl-token";import Om from"bn.js";import vm from"decimal.js";import em from"bn.js";import nm from"decimal.js";var Nn=14;var qt=60;var so=V([ue(8),W("bump"),Fe("index"),E(""),ct("protocolFeeRate"),ct("tradeFeeRate"),Fe("tickSpacing"),H(g(),8,"")]),ao=V([ct("blockTimestamp"),hi("tickCumulative"),H(g(),4)]),Vi=V([ue(8),kn("initialized"),g("recentEpoch"),Fe("observationIndex"),E("poolId"),H(ao,100,"observations"),H(g(),4)]),co=V([W("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),ee("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),E("tokenMint"),E("tokenVault"),E("creator"),ee("rewardGrowthGlobalX64")]),vi=V([ue(8),W("bump"),E("ammConfig"),E("creator"),E("mintA"),E("mintB"),E("vaultA"),E("vaultB"),E("observationId"),W("mintDecimalsA"),W("mintDecimalsB"),Fe("tickSpacing"),ee("liquidity"),ee("sqrtPriceX64"),Me("tickCurrent"),ct(),ee("feeGrowthGlobalX64A"),ee("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),ee("swapInAmountTokenA"),ee("swapOutAmountTokenB"),ee("swapInAmountTokenB"),ee("swapOutAmountTokenA"),W("status"),H(W(),7,""),H(co,3,"rewardInfos"),H(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),H(g(),15*4-3,"padding")]),uo=V([ee("growthInsideLastX64"),g("rewardAmountOwed")]),Di=V([ue(8),W("bump"),E("nftMint"),E("poolId"),Me("tickLower"),Me("tickUpper"),ee("liquidity"),ee("feeGrowthInsideLastX64A"),ee("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),H(uo,3,"rewardInfos"),H(g(),8,"")]),Nd=V([ue(8),W("bump"),E("poolId"),Me("tickLowerIndex"),Me("tickUpperIndex"),ee("liquidity"),ee("feeGrowthInsideLastX64A"),ee("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),H(ee(),3,"rewardGrowthInside"),H(g(),8,"")]),lo=V([Me("tick"),xi("liquidityNet"),ee("liquidityGross"),ee("feeGrowthOutsideX64A"),ee("feeGrowthOutsideX64B"),H(ee(),3,"rewardGrowthsOutsideX64"),H(ct(),13,"")]),Mi=V([ue(8),E("poolId"),Me("startTickIndex"),H(lo,qt,"ticks"),W("initializedTickCount"),H(W(),115,"")]),mo=V([ue(329),H(E(),100,"whitelistMints")]),oo=V([ue(8),E("poolId"),H(H(g(),8),Nn,"positiveTickArrayBitmap"),H(H(g(),8),Nn,"negativeTickArrayBitmap")]),Rd=V([g(),W("bump"),E("owner"),E("poolId"),E("positionId"),E("nftAccount"),H(g(),8)]),po=V([ue(8),W("bump"),E("lockOwner"),E("poolId"),E("positionId"),E("nftAccount"),E("lockNftMint"),g("recentEpoch"),H(g(),8)]);Vi.span;var sp=se("Raydium_Clmm");var go=Buffer.from("vault_auth_seed","utf8"),df=Buffer.from("global_config","utf8"),Po=Buffer.from("pool_vesting","utf8"),Ao=Buffer.from("platform_config","utf8"),wo=Buffer.from("platform_fee_vault_auth_seed","utf8"),To=Buffer.from("creator_fee_vault_auth_seed","utf8");function Ke(o){return ce([go],o)}function lt(o,e,t){return ce([Ci,e.toBuffer(),t.toBuffer()],o)}function Rn(o,e,t){return ce([Ni,e.toBuffer(),t.toBuffer()],o)}function Ye(o){return ce([Buffer.from("__event_authority","utf8")],o)}function Ln(o,e){return ce([Ao,e.toBuffer()],o)}function Ct(o,e,t){return ce([Po,e.toBuffer(),t.toBuffer()],o)}function Je(o,e,t){return ce([e.toBuffer(),t.toBuffer()],o)}function Fn(o){return ce([wo],o)}function mt(o,e,t){return ce([e.toBuffer(),t.toBuffer()],o)}function _i(o){return ce([To],o)}import{SystemProgram as ye,TransactionInstruction as de}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Gt,TOKEN_2022_PROGRAM_ID as ko,TOKEN_PROGRAM_ID as Mn}from"@solana/spl-token";import Nt from"bn.js";var pe={initialize:Buffer.from([175,175,109,31,13,152,155,237]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252])};function qi(o,e,t,n,i,r,s,a,l,c,p,m,w,A,u,y,f,h,b,I){let T=V([W("decimals"),le("name"),le("symbol"),le("uri")]),d=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod")]),P=V([W("index"),g("supply"),g("totalFundRaisingB"),W("migrateType")]),x=V([W("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),W("migrateType")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Mn,isSigner:!1,isWritable:!1},{pubkey:Mn,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:ye.programId,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:Ye(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],K=Buffer.alloc(Buffer.from(A,"utf-8").length+Buffer.from(u,"utf-8").length+Buffer.from(y,"utf-8").length+4*3+1),C=Buffer.alloc(d.span),B=Buffer.alloc(f.type==="ConstantCurve"?x.span:P.span);return T.encode({decimals:w,name:A,symbol:u,uri:y},K),f.type==="ConstantCurve"?x.encode(j(_({index:0},f),{migrateType:f.migrateType==="amm"?0:1}),B):f.type==="FixedCurve"?P.encode(j(_({index:1},f),{migrateType:f.migrateType==="amm"?0:1}),B):f.type==="LinearCurve"&&P.encode(j(_({index:2},f),{migrateType:f.migrateType==="amm"?0:1}),B),d.encode({totalLockedAmount:h,cliffPeriod:b,unlockPeriod:I},C),new de({keys:k,programId:o,data:Buffer.from([...pe.initialize,...K,...B,...C])})}function Gi(o,e,t,n,i,r,s,a,l,c,p,m,w,A,u,y,f,h,b,I){let T=V([W("decimals"),le("name"),le("symbol"),le("uri")]),d=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),W("transferFeeExtensionParamsOption"),V([Fe("transferFeeBasePoints"),g("maxinumFee")]).replicate("transferFeeExtensionParams")]),P=V([W("index"),g("supply"),g("totalFundRaisingB"),W("migrateType")]),x=V([W("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),W("migrateType")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ko,isSigner:!1,isWritable:!1},{pubkey:Mn,isSigner:!1,isWritable:!1},{pubkey:ye.programId,isSigner:!1,isWritable:!1},{pubkey:Ye(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],K=Buffer.alloc(Buffer.from(w,"utf-8").length+Buffer.from(A,"utf-8").length+Buffer.from(u,"utf-8").length+4*3+1),C=Buffer.alloc(d.span),B=Buffer.alloc(y.type==="ConstantCurve"?x.span:P.span);return T.encode({decimals:m,name:w,symbol:A,uri:u},K),y.type==="ConstantCurve"?x.encode(j(_({index:0},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="FixedCurve"?P.encode(j(_({index:1},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="LinearCurve"&&P.encode(j(_({index:2},y),{migrateType:y.migrateType==="amm"?0:1}),B),d.encode({totalLockedAmount:f,cliffPeriod:h,unlockPeriod:b,transferFeeExtensionParamsOption:I?1:0,transferFeeExtensionParams:I!=null?I:{transferFeeBasePoints:0,maxinumFee:new Nt(0)}},C),new de({keys:k,programId:o,data:Buffer.from([...pe.initializeWithToken2022,...K,...B,...C])})}function Ui(o,e,t,n,i,r,s,a,l,c,p,m,w,A,u,y,f,h,b,I){let T=V([g("amountB"),g("minAmountA"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:Ye(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:ye.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:u,isSigner:!1,isWritable:!0}),d.push({pubkey:y,isSigner:!1,isWritable:!0});let P=Buffer.alloc(T.span);return T.encode({amountB:f,minAmountA:h,shareFeeRate:b!=null?b:new Nt(0)},P),new de({keys:d,programId:o,data:Buffer.from([...pe.buyExactIn,...P])})}function Xi(o,e,t,n,i,r,s,a,l,c,p,m,w,A,u,y,f,h,b,I){let T=V([g("amountA"),g("maxAmountB"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:Ye(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:ye.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:u,isSigner:!1,isWritable:!0}),d.push({pubkey:y,isSigner:!1,isWritable:!0});let P=Buffer.alloc(T.span);return T.encode({amountA:f,maxAmountB:h,shareFeeRate:b!=null?b:new Nt(0)},P),new de({keys:d,programId:o,data:Buffer.from([...pe.buyExactOut,...P])})}function zi(o,e,t,n,i,r,s,a,l,c,p,m,w,A,u,y,f,h,b,I){let T=V([g("amountA"),g("minAmountB"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:Ye(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:ye.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:u,isSigner:!1,isWritable:!0}),d.push({pubkey:y,isSigner:!1,isWritable:!0});let P=Buffer.alloc(T.span);return T.encode({amountA:f,minAmountB:h,shareFeeRate:b!=null?b:new Nt(0)},P),new de({keys:d,programId:o,data:Buffer.from([...pe.sellExactIn,...P])})}function Hi(o,e,t,n,i,r,s,a,l,c,p,m,w,A,u,y,f,h,b,I){let T=V([g("amountB"),g("maxAmountA"),g("shareFeeRate")]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:Ye(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];I&&d.push({pubkey:I,isSigner:!1,isWritable:!0}),d.push({pubkey:ye.programId,isSigner:!1,isWritable:!1}),d.push({pubkey:u,isSigner:!1,isWritable:!0}),d.push({pubkey:y,isSigner:!1,isWritable:!0});let P=Buffer.alloc(T.span);return T.encode({amountB:f,maxAmountA:h,shareFeeRate:b!=null?b:new Nt(0)},P),new de({keys:d,programId:o,data:Buffer.from([...pe.sellExactOut,...P])})}function On(o,e,t,n,i,r,s,a,l){let c=V([]),p=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ye.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}],m=Buffer.alloc(c.span);return c.encode({},m),new de({keys:p,programId:o,data:Buffer.from([...pe.claimVestedToken,...m])})}function En(o,e,t,n,i,r){let s=V([g("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:ye.programId,isSigner:!1,isWritable:!1}],l=Buffer.alloc(s.span);return s.encode({shareAmount:r},l),new de({keys:a,programId:o,data:Buffer.from([...pe.createVestingAccount,...l])})}function vn(o,e,t,n,i,r,s,a,l){let c=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ye.programId,isSigner:!1,isWritable:!0},{pubkey:Gt,isSigner:!1,isWritable:!0}];return new de({keys:c,programId:o,data:pe.claimPlatformFee})}function ji(o,e,t,n,i,r,s,a,l,c,p,m,w){let A=V([g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),le("name"),le("web"),le("img"),g("creatorFeeRate")]),u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ye.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],y=Buffer.alloc(8*5+Buffer.from(p,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(w,"utf-8").length+4*3);return A.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:l,name:p,web:m,img:w,creatorFeeRate:c},y),new de({keys:u,programId:o,data:Buffer.from([...pe.createPlatformConfig,...y])})}function Qi(o,e,t,n){let i=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],r;if(n.type==="updateClaimFeeWallet"){let s=V([W("index"),E("value")]);r=Buffer.alloc(s.span),s.encode({index:0,value:n.value},r)}else if(n.type==="updateLockNftWallet"){let s=V([W("index"),E("value")]);r=Buffer.alloc(s.span),s.encode({index:1,value:n.value},r)}else if(n.type==="migrateCpLockNftScale"){let s=V([W("index"),g("platformScale"),g("creatorScale"),g("burnScale")]);r=Buffer.alloc(s.span),s.encode(_({index:2},n.value),r)}else if(n.type==="updateFeeRate"){let s=V([W("index"),g("value")]);r=Buffer.alloc(s.span),s.encode({index:3,value:n.value},r)}else if(n.type==="updateImg"||n.type==="updateName"||n.type==="updateWeb"){let s=V([W("index"),le("value")]);r=Buffer.alloc(Buffer.from(n.value,"utf-8").length+4+1*1),n.type==="updateName"?s.encode({index:4,value:n.value},r):n.type==="updateWeb"?s.encode({index:5,value:n.value},r):n.type==="updateImg"&&s.encode({index:6,value:n.value},r)}else if(n.type==="updateCpConfigId"){i.push({pubkey:n.value,isSigner:!1,isWritable:!1});let s=V([W("index")]);r=Buffer.alloc(s.span),s.encode({index:7},r)}else if(n.type==="updateAll"){i.push({pubkey:n.value.cpConfigId,isSigner:!1,isWritable:!1});let s=V([W("index"),E("platformClaimFeeWallet"),E("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),le("name"),le("web"),le("img"),E("transferFeeExtensionAuth"),g("creatorFeeRate")]);r=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(n.value.name,"utf-8").length+Buffer.from(n.value.web,"utf-8").length+Buffer.from(n.value.img,"utf-8").length),s.encode({index:8,platformClaimFeeWallet:n.value.platformClaimFeeWallet,platformLockNftWallet:n.value.platformLockNftWallet,platformScale:n.value.migrateCpLockNftScale.platformScale,creatorScale:n.value.migrateCpLockNftScale.creatorScale,burnScale:n.value.migrateCpLockNftScale.burnScale,feeRate:n.value.feeRate,name:n.value.name,web:n.value.web,img:n.value.img,transferFeeExtensionAuth:n.value.transferFeeExtensionAuth,creatorFeeRate:n.value.creatorFeeRate},r)}else throw Error("updateInfo params type error");return new de({keys:i,programId:o,data:Buffer.from([...pe.updatePlaformConfig,...r])})}function Dn(o,e,t,n,i,r,s,a){let l=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ye.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}];return new de({keys:l,programId:o,data:pe.claimPlatformFeeFromVault})}function Zi(o,e,t,n,i,r,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ye.programId,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}];return new de({keys:a,programId:o,data:pe.claimCreatorFee})}import{NATIVE_MINT as Oe,TOKEN_2022_PROGRAM_ID as Ge,TOKEN_PROGRAM_ID as te,createAssociatedTokenAccountIdempotentInstruction as Ae,getTransferFeeConfig as Qt,unpackMint as Zt}from"@solana/spl-token";import D from"bn.js";import{PublicKey as $i}from"@solana/web3.js";var _e=V([g(),g("epoch"),W("curveType"),Fe("index"),g("migrateFee"),g("tradeFeeRate"),g("maxShareFeeRate"),g("minSupplyA"),g("maxLockRate"),g("minSellRateA"),g("minMigrateRateA"),g("minFundRaisingB"),E("mintB"),E("protocolFeeOwner"),E("migrateFeeOwner"),E("migrateToAmmWallet"),E("migrateToCpmmWallet"),H(g(),16)]),Bo=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),g("startTime"),g("totalAllocatedShare")]),ke=V([g(),g("epoch"),W("bump"),W("status"),W("mintDecimalsA"),W("mintDecimalsB"),W("migrateType"),g("supply"),g("totalSellA"),g("virtualA"),g("virtualB"),g("realA"),g("realB"),g("totalFundRaisingB"),g("protocolFee"),g("platformFee"),g("migrateFee"),Bo.replicate("vestingSchedule"),E("configId"),E("platformId"),E("mintA"),E("mintB"),E("vaultA"),E("vaultB"),E("creator"),W("mintProgramFlag"),H(W(),63)]),hf=V([g(),g("epoch"),E("poolId"),E("beneficiary"),g("claimedAmount"),g("tokenShareAmount"),H(g(),8)]),dt=V([g(),g("epoch"),E("platformClaimFeeWallet"),E("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),H(W(),64,"name"),H(W(),256,"web"),H(W(),256,"img"),E("cpConfigId"),g("creatorFeeRate"),E("transferFeeExtensionAuth"),H(W(),184)]);import ge from"bn.js";import Ji from"decimal.js";import Ut from"bn.js";import Rt from"decimal.js";var qe=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Xt=class extends qe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Rt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new Rt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new Rt(e.virtualB.add(e.realB.add(r)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new Ut(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(r);if(a.lte(new Ut(0)))throw Error("tfMinusMf <= 0");let l=a.mul(n).mul(n).div(s),c=a.mul(n).div(s).sub(t),p=l.div(c),m=t.mul(t).div(c);if(p.lt(new Ut(0))||m.lt(new Ut(0)))throw Error("invalid input 0");return{a:p,b:m,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),r=t.add(e);return i.div(r)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),r=n.sub(e);return je(i,r)}};import zt from"bn.js";import Lt from"decimal.js";var Ht=class extends qe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Lt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new Lt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new Lt(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new zt(0)))throw Error("invalid input 1");let a=new zt(2).mul(t).sub(r),c=t.mul(s).div(a);if(c.lt(new zt(0))||t.lt(new zt(0)))throw Error("invalid input 0");return{a:c,b:t,c}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return je(i,n)}};import me from"bn.js";import $e from"decimal.js";import Yi from"bn.js";import Wn from"decimal.js";var Ft=class{static _multipler(e){return new Wn(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Wn(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new Yi(i.mul(this._Q64).toFixed(0))}};Ft._Q64=new Wn(new Yi(1).shln(64).toString());var jt=class extends qe{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new $e(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new $e(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new $e(e.virtualA.mul(e.realA).toString()).div(Ft._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new $e(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new $e(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new me(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new me(3)).sub(r),c=t.mul(new me(2)).mul(s).div(a),p=c.mul(c),m=t.mul(new me(2)).mul(Se).div(p);if(!m.gt(new me(0)))throw Error("a need gt 0");if(!hn.gt(m))throw Error("a need lt u64 max");if(m.lt(new me(0))||c.lt(new me(0)))throw Error("invalid input 0");return{a:m,b:new me(0),c}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new me(2).mul(n).mul(Se).div(e.virtualA);return new me(new $e(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return je(e.virtualA.mul(i),new me(2).mul(Se)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),r=je(e.virtualA.mul(i),new me(2).mul(Se));return e.realB.sub(r)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new me(2).mul(n).mul(Se).div(e.virtualA),r=new me(new $e(i.toString()).sqrt().toFixed(0));return e.realA.sub(r)}};var Pe=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a,decimalA:l,decimalB:c}){if(t<3)throw Error("point count < 3");let p=this.getCurve(e),m=p.getInitParam({supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a}),w=p.getPoolInitPriceByInit(j(_({},m),{decimalA:l,decimalB:c})),A=i.div(new ge(t-1)),u=new ge(0),y=[{price:w,totalSellSupply:0}],{a:f,b:h}=m,b=u,I=u;for(let T=1;T<t;T++){let d=T!==t-1?A:i.sub(I),P=this.buyExactIn({poolInfo:{virtualA:f,virtualB:h,realA:b,realB:I,totalFundRaisingB:i,totalSellA:r},amountB:d,protocolFeeRate:u,platformFeeRate:u,curveType:e,shareFeeRate:u,creatorFeeRate:u,transferFeeConfigA:void 0,slot:0});b=b.add(P.amountA.amount),I=I.add(P.amountB);let x=this.getPrice({poolInfo:{virtualA:f,virtualB:h,realA:b,realB:I},decimalA:l,decimalB:c,curveType:e});y.push({price:x,totalSellSupply:new Ji(b.toString()).div(10**l).toNumber()})}return y}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:r,config:s,migrateType:a}){if(Number(r)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(Qe).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new ge(10**r))))throw Error("supply lt min supply");let c=e.mul(s.minSellRateA).div(Qe);if(n.lt(c))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let p=e.sub(n).sub(i),m=e.mul(s.minMigrateRateA).div(Qe);if(p.lt(m))throw Error("migrate lt min migrate amoount");let w=e.sub(n).sub(i),A=new ge(new Ji(w.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let u=new ge(10).pow(new ge(r));if(A.lte(u))throw Error("check migrate lp error")}else if(a==="cpmm"){let u=new ge(100);if(A.lte(u))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:l,slot:c}){let p=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:p}),w=t.sub(m),A=this.getCurve(r),u=A.buyExactIn({poolInfo:e,amount:w}),y=e.totalSellA.sub(e.realA),f,h,b;if(u.gt(y)){f=y;let T=A.buyExactOut({poolInfo:e,amount:f});h=this.calculatePreFee({postFeeAmount:T,feeRate:p}),b=h.sub(T)}else f=u,h=t,b=m;let I=this.splitFee({totalFee:b,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:pn(f,l,c),amountB:h,splitFee:I}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:l,slot:c}){let p=e.totalSellA.sub(e.realA),m=fn(t,l,c),w=m.fee?m.amount.add(m.fee):m.amount;t.gt(p)&&(w=p);let u=this.getCurve(r).buyExactOut({poolInfo:e,amount:w}),y=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),f=this.calculatePreFee({postFeeAmount:u,feeRate:y}),h=f.sub(u),b=this.splitFee({totalFee:h,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:f,splitFee:b}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:l,slot:c}){let p=this.getCurve(r),m=pn(t,l,c),w=m.fee?m.amount.sub(m.fee):m.amount,A=p.sellExactIn({poolInfo:e,amount:w}),u=this.calculateFee({amount:A,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a})}),y=this.splitFee({totalFee:u,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:A.sub(u),splitFee:y}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:l,slot:c}){let p=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:p});if(e.realB.lt(m))throw Error("Insufficient liquidity");let w=m.sub(t),u=Pe.getCurve(r).sellExactOut({poolInfo:e,amount:m});if(u.gt(e.realA))throw Error();let y=this.splitFee({totalFee:w,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:fn(u,l,c),amountB:t,splitFee:y}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}),a=s.isZero()?new ge(0):e.mul(n).div(s),l=s.isZero()?new ge(0):e.mul(i).div(s),c=s.isZero()?new ge(0):e.mul(r).div(s),p=e.sub(a).sub(l).sub(c);return{platformFee:a,shareFee:l,protocolFee:p,creatorFee:c}}static calculateFee({amount:e,feeRate:t}){return ci(e,t,Qe)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(Qe),i=Qe.sub(t);return n.add(i).sub(new ge(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new ge(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return Xt;case 1:return Ht;case 2:return jt}throw Error("find curve error")}};import fe from"decimal.js";var et={initPriceX64:new D("515752397214619"),supply:new D(1e15),totalSellA:new D(7931e11),totalFundRaisingB:new D(85e9),totalLockedAmount:new D("0"),cliffPeriod:new D("0"),unlockPeriod:new D("0"),decimals:6,virtualA:new D("1073471847374405"),virtualB:new D("30050573465"),realA:new D(0),realB:new D(0),protocolFee:new D(0),platformId:new $i("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new D(0),cliffPeriod:new D(0),unlockPeriod:new D(0),startTime:new D(0),totalAllocatedShare:new D(0)}},Ue=new D(1e4),Vn=class extends ot{constructor(e){super(e)}async sayHello(){console.log("hello")}async createLaunchpad(R){var L=R,{programId:e=re,authProgramId:t,platformId:n=et.platformId,mintA:i,decimals:r=6,mintBDecimals:s=9,name:a,symbol:l,uri:c,migrateType:p,configId:m,snipers:w,configInfo:A,platformFeeRate:u,txVersion:y,computeBudgetConfig:f,txTipConfig:h,feePayer:b,buyAmount:I,minMintAAmount:T,slippage:d,associatedOnly:P=!0,checkCreateATAOwner:x=!1,extraSigners:k,token2022:K,transferFeeExtensionParams:C}=L,B=ve(L,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","snipers","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams"]);var _n,qn,Gn,Un,Xn,zn,Hn,jn,Qn,Zn;let v=[],S=this.createTxBuilder(b);t=t!=null?t:Ke(e).publicKey,K=!!C,K&&(p="cpmm");let N=A;if(!N&&m){let we=await this.scope.connection.getAccountInfo(m);we&&(N=_e.decode(we.data))}N||this.logAndCreateError("config not found");let U=N.mintB,G=N.curveType,{publicKey:Q}=lt(e,i,U),{publicKey:X}=Rn(e,Q,i),{publicKey:Z}=Rn(e,Q,U),{publicKey:Y}=Sn(i);this.logDebug(`create token: ${i.toBase58()}, mintB: ${U.toBase58()}, decimals A:${r}/B:${s}, config:${m.toBase58()}`),l.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),c||this.logAndCreateError("uri should not empty");let ne=(_n=B==null?void 0:B.supply)!=null?_n:et.supply,z=(qn=B==null?void 0:B.totalSellA)!=null?qn:et.totalSellA,q=(Gn=B==null?void 0:B.totalFundRaisingB)!=null?Gn:et.totalFundRaisingB,ie=(Un=B==null?void 0:B.totalLockedAmount)!=null?Un:new D(0),Xe=u;if(!u){let we=await this.scope.connection.getAccountInfo(n);we||this.logAndCreateError("platform id not found:",n.toString()),Xe=dt.decode(we.data).feeRate}let tt=Pe.getCurve(N.curveType).getInitParam({supply:ne,totalFundRaising:q,totalSell:z,totalLockedAmount:ie,migrateFee:N.migrateFee}),Be={epoch:new D(896),bump:254,status:0,mintDecimalsA:r,mintDecimalsB:s,supply:ne,totalSellA:z,mintA:new $i(i),mintB:U,virtualA:tt.a,virtualB:tt.b,realA:et.realA,realB:et.realB,migrateFee:N.migrateFee,migrateType:p==="amm"?0:1,protocolFee:et.protocolFee,platformFee:Xe,platformId:n,configId:m,vaultA:X,vaultB:Z,creator:this.scope.ownerPubKey,totalFundRaisingB:q,vestingSchedule:{totalLockedAmount:ie,cliffPeriod:new D(0),unlockPeriod:new D(0),startTime:new D(0),totalAllocatedShare:new D(0)},mintProgramFlag:K?1:0},er=Pe.getCurve(N.curveType),{c:tr}=er.getInitParam({supply:Be.supply,totalFundRaising:Be.totalFundRaisingB,totalLockedAmount:ie,totalSell:N.curveType===0?Be.totalSellA:new D(0),migrateFee:N.migrateFee});try{Pe.checkParam({supply:Be.supply,totalFundRaising:Be.totalFundRaisingB,totalSell:tr,totalLockedAmount:ie,decimals:Be.mintDecimalsA,config:N,migrateType:p}),this.logDebug("check init params success")}catch(we){this.logAndCreateError(`check create mint params failed, ${we.message}`)}S.addInstruction({instructions:[K?Gi(e,b!=null?b:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,Q,i,U,X,Z,r,a,l,c||"https://",{type:G===0?"ConstantCurve":G===1?"FixedCurve":G===2?"LinearCurve":"ConstantCurve",totalSellA:z,migrateType:p,supply:ne,totalFundRaisingB:q},ie,(Xn=B==null?void 0:B.cliffPeriod)!=null?Xn:new D(0),(zn=B==null?void 0:B.unlockPeriod)!=null?zn:new D(0),C):qi(e,b!=null?b:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,Q,i,U,X,Z,Y,r,a,l,c||"https://",{type:G===0?"ConstantCurve":G===1?"FixedCurve":G===2?"LinearCurve":"ConstantCurve",totalSellA:z,migrateType:p,supply:ne,totalFundRaisingB:q},ie,(Hn=B==null?void 0:B.cliffPeriod)!=null?Hn:new D(0),(jn=B==null?void 0:B.unlockPeriod)!=null?jn:new D(0))]});let Yt=K?await this.scope.connection.getEpochInfo():void 0,Ee=C?{epoch:BigInt((Yt==null?void 0:Yt.epoch)||0),maximumFee:BigInt((Qn=C==null?void 0:C.maxinumFee.toString())!=null?Qn:0),transferFeeBasisPoints:(Zn=C==null?void 0:C.transferFeeBasePoints)!=null?Zn:0}:void 0,Jt={amountA:{amount:new D(0),fee:void 0,expirationTime:void 0},amountB:new D(0),splitFee:{platformFee:new D(0),shareFee:new D(0),protocolFee:new D(0),creatorFee:new D(0)}},$t;if(k!=null&&k.length&&S.addInstruction({signers:k}),!B.createOnly){let{builder:we,extInfo:nr}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?Ge:void 0,mintA:i,mintB:U,poolInfo:Be,buyAmount:I,minMintAAmount:T,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:N,platformFeeRate:Xe,slippage:d,associatedOnly:P,checkCreateATAOwner:x,skipCheckMintA:!Ee,transferFeeConfigA:Ee?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Ee,newerTransferFee:Ee}:void 0});for(let Yn of w){let{builder:xo,extInfo:Io,transaction:ir}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?Ge:void 0,mintA:i,mintB:U,poolInfo:Be,buyAmount:Yn.amount,minMintAAmount:T,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:N,platformFeeRate:Xe,slippage:d,sniper:Yn,associatedOnly:P,checkCreateATAOwner:x,skipCheckMintA:!Ee,transferFeeConfigA:Ee?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Ee,newerTransferFee:Ee}:void 0});v.push(ir)}S.addInstruction(_({},we.AllTxData)),Jt=_({},nr),$t=(this.scope.cluster==="devnet"||y===1)&&B.shareFeeReceiver?[we.allInstructions[0]]:void 0}return S.addTipInstruction(h),y===0?{tx:await S.sizeCheckBuildV0({computeBudgetConfig:f,swapInfo:Jt,splitIns:$t,address:j(_({},Be),{poolId:Q})}),txs:v}:{tx:await S.sizeCheckBuild({computeBudgetConfig:f,swapInfo:Jt,splitIns:$t,address:j(_({},Be),{poolId:Q})}),txs:v}}async buyToken({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=te,mintB:r=Oe,poolInfo:s,configInfo:a,platformFeeRate:l,txVersion:c,computeBudgetConfig:p,txTipConfig:m,feePayer:w,buyAmount:A,minMintAAmount:u,slippage:y,shareFeeRate:f=new D(0),shareFeeReceiver:h,sniper:b,associatedOnly:I=!0,checkCreateATAOwner:T=!1,transferFeeConfigA:d,skipCheckMintA:P=!1}){var q,ie,Xe;A.lte(new D(0))&&this.logAndCreateError("buy amount should gt 0:",A.toString());let x=b?this.createSniperTxBuilder(b.owner,b.owner.publicKey):this.createTxBuilder(w),{publicKey:k}=lt(e,n,r);t=t!=null?t:Ke(e).publicKey;let K=d;if(!P)if(K)i=Ge;else{let oe=await this.scope.connection.getAccountInfo(n);if(oe&&oe.owner.equals(Ge)){i=oe.owner;let tt=Zt(n,oe,i);K=Qt(tt)||void 0}}let C=this.scope.account.getAssociatedTokenAccount(n,i),B=null,R=r.equals(Oe);x.addInstruction({instructions:[Ae((b==null?void 0:b.owner.publicKey)||this.scope.ownerPubKey,C,(b==null?void 0:b.owner.publicKey)||this.scope.ownerPubKey,n,i)]});let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:(b==null?void 0:b.owner.publicKey)||this.scope.ownerPubKey,createInfo:R?{payer:(b==null?void 0:b.owner.publicKey)||this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!R,notUseTokenAccount:R,associatedOnly:R?!1:I,checkCreateATAOwner:T});L&&(B=L),x.addInstruction(v||{}),B===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let oe=await this.scope.connection.getAccountInfo(k,{commitment:"processed"});oe||this.logAndCreateError("cannot found pool:",k.toBase58()),S=ke.decode(oe.data)}let N=a,U=await Ne(this.scope.connection,[N?void 0:S.configId,S.platformId].filter(Boolean).map(oe=>({pubkey:oe})));if(!N){let oe=U.find(tt=>tt.pubkey.equals(S.configId));(!oe||!oe.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),N=_e.decode(oe.accountInfo.data)}let G=U.find(oe=>oe.pubkey.equals(S.platformId));(!G||!G.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Q=dt.decode(G.accountInfo.data);l=l||Q.feeRate;let X=Pe.buyExactIn({poolInfo:S,amountB:A,protocolFeeRate:N.tradeFeeRate,platformFeeRate:l,curveType:N.curveType,shareFeeRate:f,creatorFeeRate:Q.creatorFeeRate,transferFeeConfigA:K,slot:await this.scope.connection.getSlot()}),Z=new fe(X.amountA.amount.toString()).sub((ie=(q=X.amountA.fee)==null?void 0:q.toString())!=null?ie:0),Y=y?new fe(Ue.sub(y).toNumber()/Ue.toNumber()).clampedTo(0,1):new fe(1),ne=u!=null?u:y?new D(Z.mul(Y).toFixed(0)):X.amountA.amount.sub((Xe=X.amountA.fee)!=null?Xe:new D(0));X.amountB.lt(A)&&console.log(`maximum ${n.toBase58()} amount can buy is ${X.amountA.toString()}, input ${r.toBase58()} amount: ${X.amountB.toString()}`);let z=h?Te(h,r,te).publicKey:void 0;return z&&x.addInstruction({instructions:[Ae((b==null?void 0:b.owner.publicKey)||this.scope.ownerPubKey,z,h,r)]}),x.addInstruction({instructions:[Ui(e,(b==null?void 0:b.owner.publicKey)||this.scope.ownerPubKey,t,S.configId,S.platformId,k,C,B,S.vaultA,S.vaultB,n,r,i,te,Je(e,S.platformId,r).publicKey,mt(e,S.creator,r).publicKey,X.amountB.lt(A)?X.amountB:A,ne,f,z)]}),x.addCustomComputeBudget(p),x.addTipInstruction(m),x.versionBuild({txVersion:c,extInfo:j(_({},X),{decimalOutAmount:Z,minDecimalOutAmount:new fe(ne.toString())})})}async buyTokenExactOut({programId:e=re,authProgramId:t,mintA:n,mintAProgram:i=te,mintB:r=Oe,poolInfo:s,configInfo:a,transferFeeConfigA:l,platformFeeRate:c,txVersion:p,computeBudgetConfig:m,txTipConfig:w,feePayer:A,maxBuyAmount:u,outAmount:y,slippage:f,shareFeeRate:h=new D(0),shareFeeReceiver:b,associatedOnly:I=!0,checkCreateATAOwner:T=!1,skipCheckMintA:d=!1}){y.lte(new D(0))&&this.logAndCreateError("out amount should gt 0:",y.toString());let P=this.createTxBuilder(A),{publicKey:x}=lt(e,n,r);t=t!=null?t:Ke(e).publicKey;let k=s;if(!k){let z=await this.scope.connection.getAccountInfo(x,{commitment:"processed"});z||this.logAndCreateError("cannot found pool:",x.toBase58()),k=ke.decode(z.data)}let K=a,C=await Ne(this.scope.connection,[K?void 0:k.configId,k.platformId].filter(Boolean).map(z=>({pubkey:z})));if(!K){let z=C.find(q=>q.pubkey.equals(k.configId));(!z||!z.accountInfo)&&this.logAndCreateError("config not found: ",k.configId.toBase58()),K=_e.decode(z.accountInfo.data)}let B=C.find(z=>z.pubkey.equals(k.platformId));(!B||!B.accountInfo)&&this.logAndCreateError("platform info not found: ",k.configId.toBase58());let R=dt.decode(B.accountInfo.data);c=c||R.feeRate;let L=l;if(!d)if(L)i=Ge;else{let z=await this.scope.connection.getAccountInfo(n);if(z&&z.owner.equals(Ge)){i=z.owner;let q=Zt(n,z,i);L=Qt(q)||void 0}}let v=Pe.buyExactOut({poolInfo:k,amountA:y,protocolFeeRate:K.tradeFeeRate,platformFeeRate:c,curveType:K.curveType,shareFeeRate:h,creatorFeeRate:R.creatorFeeRate,transferFeeConfigA:L,slot:await this.scope.connection.getSlot()}),S=new fe(v.amountB.toString()),N=f?new fe(Ue.add(f).toNumber()/Ue.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new fe(1),U=(u!=null?u:f)?new D(S.mul(N).toFixed(0)):v.amountB,G=this.scope.account.getAssociatedTokenAccount(n,i),Q=null,X=r.equals(Oe);P.addInstruction({instructions:[Ae(this.scope.ownerPubKey,G,this.scope.ownerPubKey,n,i)]});let{account:Z,instructionParams:Y}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:X?{payer:this.scope.ownerPubKey,amount:v.amountB}:void 0,skipCloseAccount:!X,notUseTokenAccount:X,associatedOnly:X?!1:I,checkCreateATAOwner:T});Z&&(Q=Z),P.addInstruction(Y||{}),Q===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let ne=b?Te(b,r,te).publicKey:void 0;return ne&&P.addInstruction({instructions:[Ae(this.scope.ownerPubKey,ne,b,r)]}),P.addInstruction({instructions:[Xi(e,this.scope.ownerPubKey,t,k.configId,k.platformId,x,G,Q,k.vaultA,k.vaultB,n,r,i,te,Je(e,k.platformId,r).publicKey,mt(e,k.creator,r).publicKey,y,U,h,ne)]}),P.addCustomComputeBudget(m),P.addTipInstruction(w),P.versionBuild({txVersion:p,extInfo:{maxSpentAmount:U,outAmount:y}})}async sellToken({programId:e=re,authProgramId:t,mintAProgram:n=te,mintA:i,mintB:r=Oe,poolInfo:s,configInfo:a,platformFeeRate:l,txVersion:c,computeBudgetConfig:p,txTipConfig:m,feePayer:w,sellAmount:A,minAmountB:u,slippage:y,shareFeeRate:f=new D(0),shareFeeReceiver:h,associatedOnly:b=!0,checkCreateATAOwner:I=!1,skipCheckMintA:T=!1}){t=t!=null?t:Ke(e).publicKey;let d=this.createTxBuilder(w);A.lte(new D(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:P}=lt(e,i,r),x;if(!T){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(Ge)){n=q.owner;let ie=Zt(i,q,n);x=Qt(ie)||void 0}}let k=null,K=null,C=r.equals(Oe),{account:B,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:b,checkCreateATAOwner:I});B&&(k=B),d.addInstruction(R||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:b,checkCreateATAOwner:I});L&&(K=L),d.addInstruction(v||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let q=await this.scope.connection.getAccountInfo(P,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",P.toBase58()),S=ke.decode(q.data)}let N=a,U=await Ne(this.scope.connection,[N?void 0:S.configId,S.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!N){let q=U.find(ie=>ie.pubkey.equals(S.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),N=_e.decode(q.accountInfo.data)}let G=U.find(q=>q.pubkey.equals(S.platformId));(!G||!G.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Q=dt.decode(G.accountInfo.data);l=l||Q.feeRate;let X=Pe.sellExactIn({poolInfo:S,amountA:A,protocolFeeRate:N.tradeFeeRate,platformFeeRate:l,curveType:N.curveType,shareFeeRate:f,creatorFeeRate:Q.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Z=new fe(X.amountB.toString()),Y=y?new fe(Ue.sub(y).toNumber()/Ue.toNumber()).clampedTo(0,1):new fe(1),ne=u!=null?u:y?new D(Z.mul(Y).toFixed(0)):X.amountB;ne.lte(new D(0))&&this.logAndCreateError(`out ${r.toBase58()} amount should be gt 0`);let z=h?Te(h,r,te).publicKey:void 0;return z&&d.addInstruction({instructions:[Ae(this.scope.ownerPubKey,z,h,r)]}),d.addInstruction({instructions:[zi(e,this.scope.ownerPubKey,t,S.configId,S.platformId,P,k,K,S.vaultA,S.vaultB,i,r,n,te,Je(e,S.platformId,r).publicKey,mt(e,S.creator,r).publicKey,X.amountA.amount.lt(A)?X.amountA.amount:A,ne,f,z)]}),d.addCustomComputeBudget(p),d.addTipInstruction(m),d.versionBuild({txVersion:c,extInfo:{outAmount:ne}})}async sellTokenExactOut({programId:e=re,authProgramId:t,mintAProgram:n=te,mintA:i,mintB:r=Oe,poolInfo:s,configInfo:a,platformFeeRate:l,txVersion:c,computeBudgetConfig:p,txTipConfig:m,feePayer:w,inAmount:A,maxSellAmount:u,slippage:y,shareFeeRate:f=new D(0),shareFeeReceiver:h,associatedOnly:b=!0,checkCreateATAOwner:I=!1,skipCheckMintA:T=!1}){t=t!=null?t:Ke(e).publicKey;let d=this.createTxBuilder(w);u!=null&&u.lte(new D(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:P}=lt(e,i,r),x;if(!T){let q=await this.scope.connection.getAccountInfo(i);if(q&&q.owner.equals(Ge)){n=q.owner;let ie=Zt(i,q,n);x=Qt(ie)||void 0}}let k=null,K=null,C=r.equals(Oe),{account:B,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:b,checkCreateATAOwner:I});B&&(k=B),d.addInstruction(R||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:b,checkCreateATAOwner:I});L&&(K=L),d.addInstruction(v||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let q=await this.scope.connection.getAccountInfo(P,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",P.toBase58()),S=ke.decode(q.data)}let N=a,U=await Ne(this.scope.connection,[N?void 0:S.configId,S.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!N){let q=U.find(ie=>ie.pubkey.equals(S.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),N=_e.decode(q.accountInfo.data)}let G=U.find(q=>q.pubkey.equals(S.platformId));(!G||!G.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Q=dt.decode(G.accountInfo.data);l=l||Q.feeRate;let X=Pe.sellExactOut({poolInfo:S,amountB:A,protocolFeeRate:N.tradeFeeRate,platformFeeRate:l,curveType:N.curveType,shareFeeRate:f,creatorFeeRate:Q.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),Z=new fe(X.amountA.amount.toString()),Y=y?new fe(Ue.add(y).toNumber()/Ue.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new fe(1),ne=(u!=null?u:y)?new D(Z.mul(Y).toFixed(0)):X.amountA.amount,z=h?Te(h,r,te).publicKey:void 0;return z&&d.addInstruction({instructions:[Ae(this.scope.ownerPubKey,z,h,r)]}),d.addInstruction({instructions:[Hi(e,this.scope.ownerPubKey,t,S.configId,S.platformId,P,k,K,S.vaultA,S.vaultB,i,r,n,te,Je(e,S.platformId,r).publicKey,mt(e,S.creator,r).publicKey,A,ne,f,z)]}),d.addCustomComputeBudget(p),d.addTipInstruction(m),d.versionBuild({txVersion:c,extInfo:{maxSellAmount:ne}})}async createPlatformConfig({programId:e=re,platformAdmin:t,platformClaimFeeWallet:n,platformLockNftWallet:i,cpConfigId:r,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:l,feeRate:c,name:p,web:m,img:w,txVersion:A,computeBudgetConfig:u,txTipConfig:y,feePayer:f}){let h=this.createTxBuilder(f),{publicKey:b}=Ln(e,t);return h.addInstruction({instructions:[ji(e,t,n,i,b,r,a,s,c,l,p,m,w)]}),h.addCustomComputeBudget(u),h.addTipInstruction(y),h.versionBuild({txVersion:A,extInfo:{platformId:b}})}async updatePlatformConfig({programId:e=re,platformAdmin:t,platformId:n,updateInfo:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:l}){let c=this.createTxBuilder(l),p=n!=null?n:Ln(e,t).publicKey;return c.addInstruction({instructions:[Qi(e,t,p,i)]}),c.addCustomComputeBudget(s),c.addTipInstruction(a),c.versionBuild({txVersion:r})}async claimPlatformFee({programId:e=re,authProgramId:t,platformId:n,poolId:i,platformClaimFeeWallet:r,mintB:s,vaultB:a,mintBProgram:l=te,txVersion:c,computeBudgetConfig:p,txTipConfig:m,feePayer:w}){var h;let A=this.createTxBuilder(w);t=t!=null?t:Ke(e).publicKey;let u=s,y=a;if(!u){let b=await this.scope.connection.getAccountInfo(i,{commitment:"processed"});b||this.logAndCreateError("cannot found pool:",i.toBase58());let I=ke.decode(b.data),T=await this.scope.connection.getAccountInfo(I.configId,{commitment:"processed"});T||this.logAndCreateError("cannot found config:",I.configId.toBase58()),u=_e.decode(T.data).mintB,y=y!=null?y:I.vaultB}(!u||!y)&&this.logAndCreateError("cannot found mint info, mintB: ",u.toBase58(),", vaultB: ",(h=y==null?void 0:y.toBase58())!=null?h:"");let f=Te(this.scope.ownerPubKey,u,te).publicKey;return A.addInstruction({instructions:[Ae(this.scope.ownerPubKey,f,this.scope.ownerPubKey,u)]}),A.addInstruction({instructions:[vn(e,r,t,i,n,y,f,u,l)]}),A.addCustomComputeBudget(p),A.addTipInstruction(m),A.versionBuild({txVersion:c})}async claimAllPlatformFee({programId:e=re,authProgramId:t,platformId:n,platformClaimFeeWallet:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:l}){let c=this.createTxBuilder(l);return t=t!=null?t:Ke(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:ke.span},{memcmp:{offset:ke.offsetOf("platformId"),bytes:n.toString()}}]})).forEach(m=>{let w=ke.decode(m.account.data);if(w.platformFee.lte(new D(0)))return;let A=Te(this.scope.ownerPubKey,w.mintB,te).publicKey;c.addInstruction({instructions:[Ae(this.scope.ownerPubKey,A,this.scope.ownerPubKey,w.mintB)]}),c.addInstruction({instructions:[vn(e,i,t,m.pubkey,n,w.vaultB,A,w.mintB,te)]})}),c.addTipInstruction(a),r===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=re,poolId:t,beneficiary:n,shareAmount:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:l}){let c=this.createTxBuilder(l),p=await this.getRpcPoolInfo({poolId:t});i.add(p.vestingSchedule.totalAllocatedShare).gt(p.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=Ct(e,t,n).publicKey;return c.addInstruction({instructions:[En(e,this.scope.ownerPubKey,n,t,m,i)]}),c.addCustomComputeBudget(s),c.addTipInstruction(a),c.versionBuild({txVersion:r})}async createMultipleVesting({programId:e=re,poolId:t,beneficiaryList:n,txVersion:i,computeBudgetConfig:r,feePayer:s}){let a=this.createTxBuilder(s);n.length===0&&this.logAndCreateError("beneficiaryList is null");let l=await this.getRpcPoolInfo({poolId:t});return n.reduce((p,m)=>p.add(m.shareAmount),l.vestingSchedule.totalAllocatedShare).gt(l.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),n.forEach(p=>{let m=Ct(e,t,p.wallet).publicKey;a.addInstruction({instructions:[En(e,this.scope.ownerPubKey,p.wallet,t,m,p.shareAmount)]})}),i===0?a.sizeCheckBuildV0({computeBudgetConfig:r}):a.sizeCheckBuild({computeBudgetConfig:r})}async claimVesting({programId:e=re,poolId:t,poolInfo:n,vestingRecord:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:l}){let c=this.createTxBuilder(l),p=Ke(e).publicKey,m=i||Ct(e,t,this.scope.ownerPubKey).publicKey,w=n;if(!w){let u=await this.scope.connection.getAccountInfo(t);u||this.logAndCreateError("pool not found"),w=ke.decode(u.data)}let A=Te(this.scope.ownerPubKey,w.mintA,te).publicKey;return c.addInstruction({instructions:[Ae(this.scope.ownerPubKey,A,this.scope.ownerPubKey,w.mintA)]}),c.addInstruction({instructions:[On(e,this.scope.ownerPubKey,p,t,m,A,w.vaultA,w.mintA,te)]}),c.addCustomComputeBudget(s),c.addTipInstruction(a),c.versionBuild({txVersion:r})}async claimMultiVesting({programId:e=re,poolIdList:t,poolsInfo:n={},vestingRecords:i={},txVersion:r,computeBudgetConfig:s,feePayer:a}){let l=this.createTxBuilder(a),c=_({},n),p=Ke(e).publicKey,m=t.filter(w=>!c[w.toBase58()]);if(m.length){let w=await this.getRpcPoolsInfo({poolIdList:m});c=_(_({},c),w.poolInfoMap)}return t.forEach(w=>{let A=w.toBase58(),u=c[A];u||this.logAndCreateError(`pool info not found: ${A}`);let y=i[A]||Ct(e,w,this.scope.ownerPubKey).publicKey,f=Te(this.scope.ownerPubKey,u.mintA,te).publicKey;l.addInstruction({instructions:[Ae(this.scope.ownerPubKey,f,this.scope.ownerPubKey,u.mintA)]}),l.addInstruction({instructions:[On(e,this.scope.ownerPubKey,p,w,y,f,u.vaultA,u.mintA,te)]})}),r===0?l.sizeCheckBuildV0({computeBudgetConfig:s}):l.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=re,platformId:t,mintB:n,mintBProgram:i=te,claimFeeWallet:r,txVersion:s,computeBudgetConfig:a,txTipConfig:l,feePayer:c}){let p=this.createTxBuilder(c),m=Je(e,t,n).publicKey,w=Fn(e).publicKey,A=this.scope.account.getAssociatedTokenAccount(n,i);return p.addInstruction({instructions:[Ae(this.scope.ownerPubKey,A,this.scope.ownerPubKey,n,i),Dn(e,t,r!=null?r:this.scope.ownerPubKey,w,m,A,n,i)]}),p.addCustomComputeBudget(a),p.addTipInstruction(l),p.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=re,platformList:t,unwrapSol:n=!0,txVersion:i,computeBudgetConfig:r,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:l=!1}){let c=this.createTxBuilder(s),p={};return t.forEach(async m=>{var f,h;let w=Fn(e).publicKey,A=Je(e,m.id,m.mintB).publicKey,u=m.mintB.equals(Oe)&&n,y=p[m.mintB.toBase58()];if(!y){let{account:b,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:u?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!u,notUseTokenAccount:u,associatedOnly:u?!1:a,checkCreateATAOwner:l});b&&(y=b),c.addInstruction(I||{}),y===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}c.addInstruction({instructions:[Dn(e,m.id,(f=m.claimFeeWallet)!=null?f:this.scope.ownerPubKey,A,w,y,m.mintB,(h=m.mintBProgram)!=null?h:te)]})}),i===0?c.sizeCheckBuildV0({computeBudgetConfig:r}):c.sizeCheckBuild({computeBudgetConfig:r})}async claimCreatorFee({programId:e=re,mintB:t,mintBProgram:n=te,txVersion:i,computeBudgetConfig:r,txTipConfig:s,feePayer:a}){let l=this.createTxBuilder(a),c=mt(e,this.scope.ownerPubKey,t).publicKey,p=_i(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,n);return l.addInstruction({instructions:[Ae(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,n),Zi(e,this.scope.ownerPubKey,p,c,m,t,n)]}),l.addCustomComputeBudget(r),l.addTipInstruction(s),l.versionBuild({txVersion:i})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let n=await Ne(this.scope.connection,e.map(l=>({pubkey:l})),t),i={},r=[];for(let l=0;l<e.length;l++){let c=n[l];if(c===null||!c.accountInfo)throw Error("fetch pool info error: "+e[l].toBase58());let p=ke.decode(c.accountInfo.data);i[e[l].toBase58()]=j(_({},p),{poolId:c.accountInfo.owner}),r.push(p.configId)}let s=await Ne(this.scope.connection,r.map(l=>({pubkey:l})),t),a={};for(let l=0;l<r.length;l++){let c=s[l];if(c===null||!c.accountInfo)throw Error("fetch config info error: "+r[l].toBase58());let p=_e.decode(c.accountInfo.data);a[r[l].toBase58()]=j(_({},p),{configId:c.accountInfo.owner})}return{poolInfoMap:Object.keys(i).reduce((l,c)=>j(_({},l),{[c]:j(_({},i[c]),{configInfo:a[i[c].configId.toBase58()]})}),{})}}};export{et as LaunchpadPoolInitParam,Vn as default};
//# sourceMappingURL=launchpad.mjs.map