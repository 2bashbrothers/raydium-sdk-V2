var lo=Object.defineProperty,mo=Object.defineProperties;var po=Object.getOwnPropertyDescriptors;var Et=Object.getOwnPropertySymbols;var si=Object.prototype.hasOwnProperty,ai=Object.prototype.propertyIsEnumerable;var ri=(r,e,t)=>e in r?lo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_=(r,e)=>{for(var t in e||(e={}))si.call(e,t)&&ri(r,t,e[t]);if(Et)for(var t of Et(e))ai.call(e,t)&&ri(r,t,e[t]);return r},Z=(r,e)=>mo(r,po(e));var _e=(r,e)=>{var t={};for(var n in r)si.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Et)for(var n of Et(r))e.indexOf(n)<0&&ai.call(r,n)&&(t[n]=r[n]);return t};import{get as ui,set as fo}from"lodash";var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ci={},bo={};function ce(r){let e=ui(ci,r);if(!e){let t=ui(bo,r);e=new en({name:r,logLevel:t}),fo(ci,r,e)}return e}import{PublicKey as $e,sendAndConfirmTransaction as Pn,SystemProgram as Xo,Transaction as ht,TransactionMessage as Ee,VersionedTransaction as ve}from"@solana/web3.js";import zo from"axios";import{PublicKey as yn,AddressLookupTableAccount as ct}from"@solana/web3.js";import{PublicKey as Uo}from"@solana/web3.js";import Ce from"bn.js";import pa from"decimal.js";import Bo from"big.js";import Qr from"bn.js";import yo from"toformat";var go=yo,bt=go;import Wt from"big.js";import Ao from"bn.js";import To from"decimal.js-light";import yt from"bn.js";var li=9007199254740991;function Ke(r){let e=ce("Raydium_parseBigNumberish");if(r instanceof yt)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new yt(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=li||r<=-li)&&e.logWithError(`BigNumberish number overflow: ${r}`),new yt(String(r))):typeof r=="bigint"?new yt(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new yt(0))}var vt=ce("module/fraction"),tn=bt(Wt),gt=bt(To),wo={[0]:gt.ROUND_DOWN,[1]:gt.ROUND_HALF_UP,[2]:gt.ROUND_UP},ko={[0]:Wt.roundDown,[1]:Wt.roundHalfUp,[2]:Wt.roundUp},te=class{constructor(e,t=new Ao(1)){this.numerator=Ke(e),this.denominator=Ke(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new te(this.denominator,this.numerator)}add(e){let t=e instanceof te?e:new te(Ke(e));return this.denominator.eq(t.denominator)?new te(this.numerator.add(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof te?e:new te(Ke(e));return this.denominator.eq(t.denominator)?new te(this.numerator.sub(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof te?e:new te(Ke(e));return new te(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof te?e:new te(Ke(e));return new te(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<=0&&vt.logWithError(`${e} is not positive.`),gt.set({precision:e+1,rounding:wo[n]});let o=new gt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<0&&vt.logWithError(`${e} is negative.`),tn.DP=e,tn.RM=ko[n]||1,new tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ss=ce("Raydium_amount"),as=bt(Bo);import{PublicKey as xo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mi}from"@solana/spl-token";var nn={chainId:101,address:xo.default.toBase58(),programId:mi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},qe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:mi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as sn}from"@solana/web3.js";import{PublicKey as ne,SystemProgram as di,SYSVAR_RENT_PUBKEY as Io}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as So}from"@solana/spl-token";function on({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var bs=[on({pubkey:So,isWritable:!1}),on({pubkey:di.programId,isWritable:!1}),on({pubkey:Io,isWritable:!1})];function pi({publicKey:r,transformSol:e}){let t=fi(r.toString());if(t instanceof ne)return e&&t.equals(Pt)?Dt:t;if(e&&t.toString()===Pt.toBase58())return Dt;if(typeof t=="string"){if(t===ne.default.toBase58())return ne.default;try{return new ne(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function fi(r){try{return new ne(r)}catch{return r}}var Ko=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Co=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),rn=new ne("SysvarRent111111111111111111111111111111111"),ys=new ne("SysvarC1ock11111111111111111111111111111111"),at=new ne("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),gs=new ne("Sysvar1nstructions1111111111111111111111111"),Ps=di.programId,As=new ne("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ts=new ne("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ws=new ne("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ks=new ne("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Bs=new ne("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),hs=new ne("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),xs=new ne("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Is=new ne("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ss=new ne("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ks=new ne("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Cs=new ne("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Dt=new ne("So11111111111111111111111111111111111111112"),Pt=ne.default;var an=class{constructor({mint:e,decimals:t,symbol:n,name:o,skipMint:i=!1,isToken2022:s=!1}){if(e===Pt.toBase58()||e instanceof sn&&Pt.equals(e)){this.decimals=qe.decimals,this.symbol=qe.symbol,this.name=qe.name,this.mint=new sn(qe.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=i?sn.default:pi({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ge=an;Ge.WSOL=new an(Z(_({},qe),{mint:qe.address}));var un=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Vt=un;Vt.SOL=new un(nn);import No from"bn.js";var _s=new te(new No(100));var Hs=ce("Raydium_price");var Ro=new Ce(0),ka=new Ce(1),Ba=new Ce(2),ha=new Ce(3),xa=new Ce(5),ho=new Ce(10),Ia=new Ce(100),Sa=new Ce(1e3),Ka=new Ce(1e4);function bi(r,e,t){return r.mul(e).add(t).sub(new Ce(1)).div(t)}function mn(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Ne=class{constructor(e){this._owner=e}get publicKey(){return Ne.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return Ne.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return Ne.isKeyPair(this._owner)}get isPublicKey(){return Ne.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!Ne.isKeyPair(e)}};import{PublicKey as Wo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Do}from"@solana/spl-token";import{ComputeBudgetProgram as yi,Keypair as Pi,PublicKey as Lo,Transaction as Ai,TransactionMessage as Fo,VersionedTransaction as Ti}from"@solana/web3.js";var je={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Mo}from"@solana/spl-token";var gi=ce("Raydium_txUtil"),wi=1644;function At(r){let e=[],t=[];return r.microLamports&&(e.push(yi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(je.SetComputeUnitPrice)),r.units&&(e.push(yi.setComputeUnitLimit({units:r.units})),t.push(je.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ze(r,e){var n,o;let t=e!=null?e:"confirmed";return(o=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:o.blockhash}async function Tt(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let o=setTimeout(n,6e4);r.onSignature(e,i=>{if(clearTimeout(o),!i.err){t("");return}n(Object.assign(i.err,{txId:e}))},"confirmed")})}function Oo(r,e){r.length<1&&gi.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&gi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ai;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<wi}catch{return!1}}function me(r,e){let[t,n]=Lo.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function wt({instructions:r,payer:e,signers:t}){return Oo(r,[e,...t])}function Oe({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Pi.generate().publicKey.toString()}){let i=new Fo({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ti(i).serialize()).toString("base64").length<wi}catch{return!1}}var Eo=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),vo=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Ti&&(e=Eo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Ue(r){let e=[];return r.forEach(t=>{t instanceof Ai&&(t.recentBlockhash||(t.recentBlockhash=Mo.toBase58()),t.feePayer||(t.feePayer=Pi.generate().publicKey)),e.push(vo(t))}),console.log("simulate tx string:",e),e}function Pe(r,e,t){return me([r.toBuffer(),(t!=null?t:Do).toBuffer(),e.toBuffer()],new Wo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var ja=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Za=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Qa=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ja=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),$a=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),eu=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),tu=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),nu=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),iu=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ou=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Vo=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),_o=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),qo=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ru=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),su=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),au=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),uu=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),cu=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),lu=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),mu=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),du=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),pu=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),fu=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),bu=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),yu=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),re=new O("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),gu=new O("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Pu=new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Au=new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Tu=new O("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),wu=new O("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var ku={OPEN_BOOK_PROGRAM:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O("Ray1111111111111111111111111111111111111111"),AMM_V4:new O("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.default,Router:new O("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O("Ray1111111111111111111111111111111111111111")};import le from"bn.js";var kt=1e4;function dn(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new le(0))?t.add(new le(1)):t}function Qe(r,e){if(r.isZero())return new le(0);let t=r.div(e);return t.isZero()?new le(1):r.mod(e).gt(new le(0))?t.add(new le(1)):t}function pn(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),o=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,i=new le(o.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=dn(r.mul(new le(o.transferFeeBasisPoints)),new le(kt)),c=a.gt(i)?i:a;return{amount:r,fee:c,expirationTime:s}}function fn(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),o=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,i=new le(o.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(o.transferFeeBasisPoints===kt){let a=new le(o.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=dn(r.mul(new le(kt)),new le(kt-o.transferFeeBasisPoints)),c=new le(o.maximumFee.toString()),u=a.sub(r).gt(c)?r.add(c):a,f=dn(u.mul(new le(o.transferFeeBasisPoints)),new le(kt)),m=f.gt(i)?i:f;return{amount:u,fee:m,expirationTime:s}}}import{PublicKey as Su}from"@solana/web3.js";import Cu from"bn.js";import Go from"bn.js";var Je=new Go(1e6);import{MINT_SIZE as ac,TOKEN_PROGRAM_ID as uc,getTransferFeeConfig as cc,unpackMint as lc}from"@solana/spl-token";var bn=ce("Raydium_accountInfo_util");async function Bt(r,e,t){let{batchRequest:n,commitment:o="confirmed",chunkCount:i=100}=_({batchRequest:!1},t),s=mn(e,i),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let T=r._buildArgs([m.map(P=>P.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:T}}),u=mn(c,10);a=(await(await Promise.all(u.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(T=>{if(T){let{data:P,executable:l,lamports:y,owner:b,rentEpoch:h}=T;return P.length!==2&&P[1]!=="base64"&&bn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:l,lamports:y,owner:new Uo(b),rentEpoch:h}}return null})))}else try{a=await Promise.all(s.map(c=>r.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Re(r,e,t){let n=await Bt(r,e.map(o=>o.pubkey),t);return e.map((o,i)=>Z(_({},o),{accountInfo:n[i]}))}async function qt({connection:r,address:e,cluster:t="mainnet"}){let n=await Bt(r,[...new Set(e.map(i=>i.toString()))].map(i=>new yn(i))),o={};for(let i=0;i<e.length;i++){let s=n[i],a=e[i];if(!s)continue;let c=new ct({key:a,state:ct.deserialize(s.data)});o[a.toString()]=c,t==="devnet"?ut[a.toString()]=c:Xe[a.toString()]=c}return o}var Xe={},gn=async r=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(Xe[e])return Xe;let t=new yn(e),n=await r.getAccountInfo(t);return n&&(Xe[e]=new ct({key:t,state:ct.deserialize(n.data)})),Xe},ut={},Gt=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ut[e])return ut;let t=new yn(e),n=await r.getAccountInfo(t);return n&&(ut[e]=new ct({key:t,state:ct.deserialize(n.data)})),ut};var xt=2e3,It=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await zo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=At(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Xo.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new $e(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(je.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==$e.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(_({},t||{})):this.build(t)}build(e){var n;let t=new ht;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var f;let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=o||{},u=i!=null?i:await Ze(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Ue([t]),(f=this.owner)!=null&&f.isKeyPair)return{txId:a?await Pn(this.connection,t,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let T of m)try{T.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:o}=this.build(n),i=t.filter(f=>f.transaction.instructions.length>0),s=[o,...i.map(f=>f.transaction)],a=[this.signers,...i.map(f=>f.signers)],c=[...this.instructionTypes,...i.map(f=>f.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async f=>{var h;let{sequentially:m,onTxUpdate:T,skipTxCount:P=0,recentBlockHash:l,skipPreflight:y=!0}=f||{},b=l!=null?l:await Ze(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(m){let d=[],S=0;for(let w of s){if(++S,S<=P)continue;let p=await Pn(this.connection,w,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});d.push(p)}return{txIds:d,signedTxs:s}}return{txIds:await await Promise.all(s.map(async d=>(d.recentBlockhash=b,await this.connection.sendRawTransaction(d.serialize(),{skipPreflight:y})))),signedTxs:s}}if(this.signAllTransactions){let d=s.map((w,p)=>(w.recentBlockhash=b,a[p].length&&w.sign(...a[p]),w));Ue(d);let S=await this.signAllTransactions(d);if(m){let w=0,p=[],A=async()=>{if(!S[w])return;let x=await this.connection.sendRawTransaction(S[w].serialize(),{skipPreflight:y});p.push({txId:x,status:"sent",signedTx:S[w]}),T==null||T([...p]),w++;let k=!1,K=null,C=null,L=B=>{K!==null&&clearInterval(K),C!==null&&this.connection.removeSignatureListener(C);let R=p.findIndex(N=>N.txId===x);if(R>-1){if(p[R].status==="error"||p[R].status==="success")return;p[R].status=B.err?"error":"success"}T==null||T([...p]),B.err||A()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var B;if(k){clearInterval(K);return}try{let R=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(k=!0,clearInterval(K),L({err:((B=R.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",x))}catch(R){k=!0,clearInterval(K),console.error("getTransaction timeout:",R,x)}},xt)),C=this.connection.onSignature(x,B=>{if(k){this.connection.removeSignatureListener(C);return}k=!0,L(B)},"confirmed"),this.connection.getSignatureStatus(x)};return await A(),{txIds:p.map(x=>x.txId),signedTxs:S}}else{let w=[];for(let p=0;p<S.length;p+=1){let A=await this.connection.sendRawTransaction(S[p].serialize(),{skipPreflight:y});w.push(A)}return{txIds:w,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var y;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:i}=l,s=_e(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=_(_({},this.cluster==="devnet"?await Gt(this.connection):await gn(this.connection)),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new $e(b));let f=await qt({connection:this.connection,address:u});for(let[b,h]of Object.entries(f))a[b]=h;let m=o?$e.default.toBase58():i!=null?i:await Ze(this.connection,this.blockhashCommitment),T=new Ee({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((y=this.owner)==null?void 0:y.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new ve(T);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var w;let{skipPreflight:h=!0,sendAndConfirm:d,notSendToRpc:S}=b||{};if(Ue([P]),(w=this.owner)!=null&&w.isKeyPair){let p=await this.connection.sendTransaction(P,{skipPreflight:h});return d&&await Tt(this.connection,p),{txId:p,signedTx:P}}if(this.signAllTransactions){let p=await this.signAllTransactions([P]);if(this.signers.length)for(let A of p)try{A.sign(this.signers)}catch{}return{txId:S?"":await this.connection.sendTransaction(p[0],{skipPreflight:h}),signedTx:p[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),i=t.filter(f=>f.builder.instructions.length>0),s=[o,...i.map(f=>f.transaction)],a=[this.signers,...i.map(f=>f.signers)],c=[...this.instructionTypes,...i.map(f=>f.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(f,m)=>{f.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async f=>{var y;let{sequentially:m,onTxUpdate:T,recentBlockHash:P,skipPreflight:l=!0}=f||{};if(P&&s.forEach(b=>b.message.recentBlockhash=P),Ue(s),(y=this.owner)!=null&&y.isKeyPair){if(m){let b=[];for(let h of s){let d=await this.connection.sendTransaction(h,{skipPreflight:l});await Tt(this.connection,d),b.push(d)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:l}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(m){let h=0,d=[],S=async()=>{if(!b[h])return;let w=await this.connection.sendTransaction(b[h],{skipPreflight:l});d.push({txId:w,status:"sent",signedTx:b[h]}),T==null||T([...d]),h++;let p=!1,A=null,x=null,k=K=>{A!==null&&clearInterval(A),x!==null&&this.connection.removeSignatureListener(x);let C=d.findIndex(L=>L.txId===w);if(C>-1){if(d[C].status==="error"||d[C].status==="success")return;d[C].status=K.err?"error":"success"}T==null||T([...d]),K.err||S()};this.loopMultiTxStatus&&(A=setInterval(async()=>{var K;if(p){clearInterval(A);return}try{let C=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(p=!0,clearInterval(A),k({err:((K=C.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",w))}catch(C){p=!0,clearInterval(A),console.error("getTransaction timeout:",C,w)}},xt)),x=this.connection.onSignature(w,K=>{if(p){this.connection.removeSignatureListener(x);return}p=!0,k(K)},"confirmed"),this.connection.getSignatureStatus(w)};return S(),{txIds:[],signedTxs:b}}else{let h=[];for(let d=0;d<b.length;d+=1){let S=await this.connection.sendTransaction(b[d],{skipPreflight:l});h.push(S)}return{txIds:h,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var T;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,o=_e(m,["splitIns","computeBudgetConfig"]),i=n?At(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((P,l)=>Z(_({},P),{[l.publicKey.toBase58()]:l}),{}),a=[],c=[],u=[],f=0;if(this.allInstructions.forEach(P=>{let l=[...u,P],y=n?[...i.instructions,...l]:l,h=[...new Set(l.map(d=>d.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(d=>new $e(d));if(P!==t[f]&&u.length<12&&(wt({instructions:y,payer:this.feePayer,signers:h})||wt({instructions:l,payer:this.feePayer,signers:h})))u.push(P);else{if(u.length===0)throw Error("item ins too big");f+=P===t[f]?1:0,wt({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:h})?a.push(new ht().add(...i.instructions,...u)):a.push(new ht().add(...u)),c.push(Array.from(new Set(u.map(d=>d.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(d=>s[d]).filter(d=>d!==void 0)),u=[P]}}),u.length>0){let l=[...new Set(u.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>s[y]).filter(y=>y!==void 0);wt({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:l.map(y=>y.publicKey)})?a.push(new ht().add(...i.instructions,...u)):a.push(new ht().add(...u)),c.push(l)}return a.forEach(P=>P.feePayer=this.feePayer),(T=this.owner)!=null&&T.signer&&c.forEach(P=>{P.some(l=>l.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async P=>{var w;let{sequentially:l,onTxUpdate:y,skipTxCount:b=0,recentBlockHash:h,skipPreflight:d=!0}=P||{},S=h!=null?h:await Ze(this.connection,this.blockhashCommitment);if(a.forEach(async(p,A)=>{p.recentBlockhash=S,c[A].length&&p.sign(...c[A])}),Ue(a),(w=this.owner)!=null&&w.isKeyPair){if(l){let p=0,A=[];for(let x of a){if(++p,p<=b){A.push("tx skipped");continue}let k=await Pn(this.connection,x,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:d});A.push(k)}return{txIds:A,signedTxs:a}}return{txIds:await Promise.all(a.map(async p=>await this.connection.sendRawTransaction(p.serialize(),{skipPreflight:d}))),signedTxs:a}}if(this.signAllTransactions){let p=await this.signAllTransactions(a.slice(b,a.length)),A=[...a.slice(0,b),...p];if(l){let x=0,k=[],K=async()=>{if(!A[x])return;x<b&&(k.push({txId:"",status:"success",signedTx:A[x]}),y==null||y([...k]),x++,K());let C=await this.connection.sendRawTransaction(A[x].serialize(),{skipPreflight:d});k.push({txId:C,status:"sent",signedTx:A[x]}),y==null||y([...k]),x++;let L=!1,B=null,R=null,N=I=>{B!==null&&clearInterval(B),R!==null&&this.connection.removeSignatureListener(R);let E=k.findIndex(G=>G.txId===C);if(E>-1){if(k[E].status==="error"||k[E].status==="success")return;k[E].status=I.err?"error":"success"}y==null||y([...k]),I.err||K()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var I;if(L){clearInterval(B);return}try{let E=await this.connection.getTransaction(C,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(L=!0,clearInterval(B),N({err:((I=E.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",C))}catch(E){L=!0,clearInterval(B),console.error("getTransaction timeout:",E,C)}},xt)),R=this.connection.onSignature(C,I=>{if(L){this.connection.removeSignatureListener(R);return}L=!0,N(I)},"confirmed"),this.connection.getSignatureStatus(C)};return await K(),{txIds:k.map(C=>C.txId),signedTxs:A}}else{let x=[];for(let k=0;k<A.length;k+=1){let K=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:d});x.push(K)}return{txIds:x,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var S;let d=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:i=[]}=d,s=_e(d,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await Gt(this.connection):Xe),o),c=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let w of c)a[w]===void 0&&u.push(new $e(w));let f=await qt({connection:this.connection,address:u});for(let[w,p]of Object.entries(f))a[w]=p;let m=t?At(t):{instructions:[],instructionTypes:[]},T=await Ze(this.connection,this.blockhashCommitment),P=this.signers.reduce((w,p)=>Z(_({},w),{[p.publicKey.toBase58()]:p}),{}),l=[],y=[],b=[],h=0;if(this.allInstructions.forEach(w=>{let p=[...b,w],A=t?[...m.instructions,...p]:p;if(w!==n[h]&&b.length<12&&(Oe({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||Oe({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(w);else{if(b.length===0)throw Error("item ins too big");h+=w===n[h]?1:0;let x={};for(let k of[...new Set(c)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Oe({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new ve(k))}else{let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new ve(k))}y.push(Array.from(new Set(b.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>P[k]).filter(k=>k!==void 0)),b=[w]}}),b.length>0){let p=[...new Set(b.map(A=>A.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(A=>P[A]).filter(A=>A!==void 0);if(t&&Oe({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new ve(A))}else{let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new ve(A))}y.push(p)}return(S=this.owner)!=null&&S.signer&&y.forEach(w=>{w.some(p=>p.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,p)=>{w.sign(y[p])}),{builder:this,transactions:l,buildProps:e,signers:y,blockHash:T,instructionTypes:this.instructionTypes,execute:async w=>{var C;let{sequentially:p,onTxUpdate:A,skipTxCount:x=0,recentBlockHash:k,skipPreflight:K=!0}=w||{};if(l.map(async(L,B)=>{y[B].length&&L.sign(y[B]),k&&(L.message.recentBlockhash=k)}),Ue(l),(C=this.owner)!=null&&C.isKeyPair){if(p){let L=0,B=[];for(let R of l){if(++L,L<=x){console.log("skip tx: ",L),B.push("tx skipped");continue}let N=await this.connection.sendTransaction(R,{skipPreflight:K});await Tt(this.connection,N),B.push(N)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:K}))),signedTxs:l}}if(this.signAllTransactions){let L=await this.signAllTransactions(l.slice(x,l.length)),B=[...l.slice(0,x),...L];if(p){let R=0,N=[],I=async()=>{if(!B[R])return;if(R<x){N.push({txId:"",status:"success",signedTx:B[R]}),A==null||A([...N]),R++,I();return}let E=await this.connection.sendTransaction(B[R],{skipPreflight:K});N.push({txId:E,status:"sent",signedTx:B[R]}),A==null||A([...N]),R++;let G=!1,U=null,X=null,z=J=>{U!==null&&clearInterval(U),X!==null&&this.connection.removeSignatureListener(X);let Y=N.findIndex(oe=>oe.txId===E);if(Y>-1){if(N[Y].status==="error"||N[Y].status==="success")return;N[Y].status=J.err?"error":"success"}A==null||A([...N]),J.err||I()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var J;if(G){clearInterval(U);return}try{let Y=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(G=!0,clearInterval(U),z({err:((J=Y.meta)==null?void 0:J.err)||null}),console.log("tx status from getTransaction:",E))}catch(Y){G=!0,clearInterval(U),console.error("getTransaction timeout:",Y,E)}},xt)),X=this.connection.onSignature(E,J=>{if(G){this.connection.removeSignatureListener(X);return}G=!0,z(J)},"confirmed"),this.connection.getSignatureStatus(E)};return I(),{txIds:[],signedTxs:B}}else{let R=[];for(let N=0;N<B.length;N+=1){let I=await this.connection.sendTransaction(B[N],{skipPreflight:K});R.push(I)}return{txIds:R,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildSniperTransaction(e){var S;let d=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:i=[]}=d,s=_e(d,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=_(_({},this.cluster==="devnet"?await Gt(this.connection):await gn(this.connection)),o),c=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let w of c)a[w]===void 0&&u.push(new $e(w));let f=await qt({connection:this.connection,address:u});for(let[w,p]of Object.entries(f))a[w]=p;let m=t?At(t):{instructions:[],instructionTypes:[]},T=await Ze(this.connection,this.blockhashCommitment),P=this.signers.reduce((w,p)=>Z(_({},w),{[p.publicKey.toBase58()]:p}),{}),l=[],y=[],b=[],h=0;if(this.allInstructions.forEach(w=>{let p=[...b,w],A=t?[...m.instructions,...p]:p;if(w!==n[h]&&b.length<12&&(Oe({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||Oe({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(w);else{if(b.length===0)throw Error("item ins too big");h+=w===n[h]?1:0;let x={};for(let k of[...new Set(c)])a[k]!==void 0&&(x[k]=a[k]);if(t&&Oe({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new ve(k))}else{let k=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new ve(k))}y.push(Array.from(new Set(b.map(k=>k.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(k=>P[k]).filter(k=>k!==void 0)),b=[w]}}),b.length>0){let p=[...new Set(b.map(A=>A.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(A=>P[A]).filter(A=>A!==void 0);if(t&&Oe({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new ve(A))}else{let A=new Ee({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new ve(A))}y.push(p)}return(S=this.owner)!=null&&S.signer&&y.forEach(w=>{w.some(p=>p.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,p)=>{w.sign(y[p])}),{builder:this,transactions:l,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var C;let{sequentially:p,onTxUpdate:A,skipTxCount:x=0,recentBlockHash:k,skipPreflight:K=!0}=w||{};if(l.map(async(L,B)=>{y[B].length&&L.sign(y[B]),k&&(L.message.recentBlockhash=k)}),Ue(l),(C=this.owner)!=null&&C.isKeyPair){if(p){let L=0,B=[];for(let R of l){if(++L,L<=x){console.log("skip tx: ",L),B.push("tx skipped");continue}let N=await this.connection.sendTransaction(R,{skipPreflight:K});await Tt(this.connection,N),B.push(N)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:K}))),signedTxs:l}}if(this.signAllTransactions){let L=await this.signAllTransactions(l.slice(x,l.length)),B=[...l.slice(0,x),...L];if(p){let R=0,N=[],I=async()=>{if(!B[R])return;if(R<x){N.push({txId:"",status:"success",signedTx:B[R]}),A==null||A([...N]),R++,I();return}let E=await this.connection.sendTransaction(B[R],{skipPreflight:K});N.push({txId:E,status:"sent",signedTx:B[R]}),A==null||A([...N]),R++;let G=!1,U=null,X=null,z=J=>{U!==null&&clearInterval(U),X!==null&&this.connection.removeSignatureListener(X);let Y=N.findIndex(oe=>oe.txId===E);if(Y>-1){if(N[Y].status==="error"||N[Y].status==="success")return;N[Y].status=J.err?"error":"success"}A==null||A([...N]),J.err||I()};this.loopMultiTxStatus&&(U=setInterval(async()=>{var J;if(G){clearInterval(U);return}try{let Y=await this.connection.getTransaction(E,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(G=!0,clearInterval(U),z({err:((J=Y.meta)==null?void 0:J.err)||null}),console.log("tx status from getTransaction:",E))}catch(Y){G=!0,clearInterval(U),console.error("getTransaction timeout:",Y,E)}},xt)),X=this.connection.onSignature(E,J=>{if(G){this.connection.removeSignatureListener(X);return}G=!0,z(J)},"confirmed"),this.connection.getSignatureStatus(E)};return I(),{txIds:[],signedTxs:B}}else{let R=[];for(let N=0;N<B.length;N+=1){let I=await this.connection.sendTransaction(B[N],{skipPreflight:K});R.push(I)}return{txIds:R,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var An=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),lt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ce(t)}createTxBuilder(e){return this.scope.checkOwner(),new It({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new Ne(e);return new It({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(An(e))}logInfo(...e){this.logger.info(An(e))}logAndCreateError(...e){let t=An(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Bp}from"@solana/web3.js";import xp from"bn.js";import Sp from"decimal.js";import{AccountLayout as Np,createAssociatedTokenAccountIdempotentInstruction as Rp,TOKEN_2022_PROGRAM_ID as Lp,TOKEN_PROGRAM_ID as Fp}from"@solana/spl-token";import{PublicKey as vc}from"@solana/web3.js";import{MintLayout as Dc,TOKEN_PROGRAM_ID as _c}from"@solana/spl-token";import{Keypair as Hd,PublicKey as Yd,SystemProgram as Zd,TransactionInstruction as Qd}from"@solana/web3.js";import $d from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as np,TOKEN_2022_PROGRAM_ID as ip,TOKEN_PROGRAM_ID as op}from"@solana/spl-token";import{PublicKey as ir}from"@solana/web3.js";import Si,{isBN as Ki}from"bn.js";import{bits as Yc,BitStructure as jc,blob as Ho,Blob as Zc,cstr as Qc,f32 as Jc,f32be as $c,f64 as el,f64be as tl,greedy as nl,Layout as Yo,ns64 as il,ns64be as ol,nu64 as rl,nu64be as sl,offset as jo,s16 as al,s16be as ul,s24 as cl,s24be as ll,s32 as Zo,s32be as ml,s40 as dl,s40be as pl,s48 as fl,s48be as bl,s8 as yl,seq as Qo,struct as gl,Structure as Jo,u16 as $o,u16be as Pl,u24 as Al,u24be as Tl,u32 as er,u32be as wl,u40 as kl,u40be as Bl,u48 as hl,u48be as xl,u8 as tr,UInt as nr,union as Il,Union as Sl,unionLayoutDiscriminator as Kl,utf8 as Cl}from"@solana/buffer-layout";var Tn=Yo,hi=Jo;var wn=nr;var xi=tr,We=$o;var kn=er;var De=Zo;var Ii=Qo;var de=Ho;var Bn=jo;var mt=class extends Tn{constructor(t,n,o){super(t,o);this.blob=de(t),this.signed=n}decode(t,n=0){let o=new Si(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new Si(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function D(r){return new wn(1,r)}function dt(r){return new wn(4,r)}function g(r){return new mt(8,!1,r)}function ie(r){return new mt(16,!1,r)}function Ci(r){return new mt(8,!0,r)}function Ni(r){return new mt(16,!0,r)}var et=class extends Tn{constructor(t,n,o,i){super(t.span,i);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function v(r){return new et(de(32),e=>new ir(e),e=>e.toBuffer(),r)}function xn(r){return new et(xi(),or,rr,r)}function or(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function rr(r){return r?1:0}function Ri(r,e){let t=kn("length"),n=V([t,j(r,Bn(t,-t.span),"values")]);return new et(n,({values:o})=>o,o=>({values:o}),e)}function sr(r){let e=kn("length"),t=V([e,de(Bn(e,-e.span),"data")]);return new et(t,({data:n})=>n,n=>({data:n}),r)}function pe(r){return new et(sr(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),r)}var hn=class extends hi{decode(e,t){return super.decode(e,t)}};function V(r,e,t){return new hn(r,e,t)}function j(r,e,t){let n,o=typeof e=="number"?e:Ki(e)?e.toNumber():new Proxy(e,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=Ki(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return Ii(r,o,t)}import Id from"bn.js";import Kd from"decimal.js";import Ae from"bn.js";var In=new Ae(0),Li=new Ae(1),Fi=new Ae(-1),Le=new Ae(1).shln(64),Mi=new Ae(1).shln(128),Sn=Le.sub(Li);var ar=Mi.subn(1),pt=-443636,St=-pt,Kn=new Ae("4295048016"),Cn=new Ae("79226673521066979257578248091"),_l=new Ae("4295048017"),ql=new Ae("79226673521066979257578248090");var ur=new Ae(10).pow(new Ae(6));var Gl=new Ae("18446744073700000000");import md from"bn.js";import pd from"decimal.js";var jl=Buffer.from("amm_config","utf8"),Oi=Buffer.from("pool","utf8"),Ei=Buffer.from("pool_vault","utf8"),Zl=Buffer.from("pool_reward_vault","utf8"),Ql=Buffer.from("position","utf8"),Jl=Buffer.from("tick_array","utf8"),$l=Buffer.from("operation","utf8"),em=Buffer.from("pool_tick_array_bitmap_extension","utf8"),tm=Buffer.from("observation","utf8");function Nn(r){return me([Buffer.from("metadata","utf8"),at.toBuffer(),r.toBuffer()],at)}var nm=Buffer.from("locked_position","utf8");var im=Buffer.from("support_mint","utf8");import{PublicKey as vm}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Dm}from"@solana/spl-token";import _m from"bn.js";import Gm from"decimal.js";import sm from"bn.js";import um from"decimal.js";var Fn=14;var Ut=60;var pr=V([de(8),D("bump"),We("index"),v(""),dt("protocolFeeRate"),dt("tradeFeeRate"),We("tickSpacing"),j(g(),8,"")]),fr=V([dt("blockTimestamp"),Ci("tickCumulative"),j(g(),4)]),zi=V([de(8),xn("initialized"),g("recentEpoch"),We("observationIndex"),v("poolId"),j(fr,100,"observations"),j(g(),4)]),br=V([D("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),ie("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),v("tokenMint"),v("tokenVault"),v("creator"),ie("rewardGrowthGlobalX64")]),Gi=V([de(8),D("bump"),v("ammConfig"),v("creator"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("observationId"),D("mintDecimalsA"),D("mintDecimalsB"),We("tickSpacing"),ie("liquidity"),ie("sqrtPriceX64"),De("tickCurrent"),dt(),ie("feeGrowthGlobalX64A"),ie("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),ie("swapInAmountTokenA"),ie("swapOutAmountTokenB"),ie("swapInAmountTokenB"),ie("swapOutAmountTokenA"),D("status"),j(D(),7,""),j(br,3,"rewardInfos"),j(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),j(g(),15*4-3,"padding")]),yr=V([ie("growthInsideLastX64"),g("rewardAmountOwed")]),Ui=V([de(8),D("bump"),v("nftMint"),v("poolId"),De("tickLower"),De("tickUpper"),ie("liquidity"),ie("feeGrowthInsideLastX64A"),ie("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),j(yr,3,"rewardInfos"),j(g(),8,"")]),vd=V([de(8),D("bump"),v("poolId"),De("tickLowerIndex"),De("tickUpperIndex"),ie("liquidity"),ie("feeGrowthInsideLastX64A"),ie("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),j(ie(),3,"rewardGrowthInside"),j(g(),8,"")]),gr=V([De("tick"),Ni("liquidityNet"),ie("liquidityGross"),ie("feeGrowthOutsideX64A"),ie("feeGrowthOutsideX64B"),j(ie(),3,"rewardGrowthsOutsideX64"),j(dt(),13,"")]),Vi=V([de(8),v("poolId"),De("startTickIndex"),j(gr,Ut,"ticks"),D("initializedTickCount"),j(D(),115,"")]),Pr=V([de(329),j(v(),100,"whitelistMints")]),dr=V([de(8),v("poolId"),j(j(g(),8),Fn,"positiveTickArrayBitmap"),j(j(g(),8),Fn,"negativeTickArrayBitmap")]),Wd=V([g(),D("bump"),v("owner"),v("poolId"),v("positionId"),v("nftAccount"),j(g(),8)]),Ar=V([de(8),D("bump"),v("lockOwner"),v("poolId"),v("positionId"),v("nftAccount"),v("lockNftMint"),g("recentEpoch"),j(g(),8)]);zi.span;var pp=ce("Raydium_Clmm");var Br=Buffer.from("vault_auth_seed","utf8"),Af=Buffer.from("global_config","utf8"),hr=Buffer.from("pool_vesting","utf8"),xr=Buffer.from("platform_config","utf8"),Ir=Buffer.from("platform_fee_vault_auth_seed","utf8"),Sr=Buffer.from("creator_fee_vault_auth_seed","utf8");function xe(r){return me([Br],r)}function tt(r,e,t){return me([Oi,e.toBuffer(),t.toBuffer()],r)}function Mn(r,e,t){return me([Ei,e.toBuffer(),t.toBuffer()],r)}function nt(r){return me([Buffer.from("__event_authority","utf8")],r)}function On(r,e){return me([xr,e.toBuffer()],r)}function Nt(r,e,t){return me([hr,e.toBuffer(),t.toBuffer()],r)}function ze(r,e,t){return me([e.toBuffer(),t.toBuffer()],r)}function En(r){return me([Ir],r)}function He(r,e,t){return me([e.toBuffer(),t.toBuffer()],r)}function vn(r){return me([Sr],r)}import{ASSOCIATED_TOKEN_PROGRAM_ID as Xt,TOKEN_2022_PROGRAM_ID as Nr,TOKEN_PROGRAM_ID as Wn}from"@solana/spl-token";import{SystemProgram as we,TransactionInstruction as be}from"@solana/web3.js";import ft from"bn.js";var Ve=V([g(),g("epoch"),D("curveType"),We("index"),g("migrateFee"),g("tradeFeeRate"),g("maxShareFeeRate"),g("minSupplyA"),g("maxLockRate"),g("minSellRateA"),g("minMigrateRateA"),g("minFundRaisingB"),v("mintB"),v("protocolFeeOwner"),v("migrateFeeOwner"),v("migrateToAmmWallet"),v("migrateToCpmmWallet"),j(g(),16)]),Kr=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),g("startTime"),g("totalAllocatedShare")]),Te=V([g(),g("epoch"),D("bump"),D("status"),D("mintDecimalsA"),D("mintDecimalsB"),D("migrateType"),g("supply"),g("totalSellA"),g("virtualA"),g("virtualB"),g("realA"),g("realB"),g("totalFundRaisingB"),g("protocolFee"),g("platformFee"),g("migrateFee"),Kr.replicate("vestingSchedule"),v("configId"),v("platformId"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("creator"),D("mintProgramFlag"),D("cpmmCreatorFeeOn"),j(D(),62)]),kf=V([g(),g("epoch"),v("poolId"),v("beneficiary"),g("claimedAmount"),g("tokenShareAmount"),j(g(),8)]),Hi=V([D("migrateType"),D("migrateCpmmFeeOn"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod")]),Cr=V([g("epoch"),D("index"),v("configId"),Hi.replicate("bondingCurveParam"),j(g(),50)]),it=V([g(),g("epoch"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),j(D(),64,"name"),j(D(),256,"web"),j(D(),256,"img"),v("cpConfigId"),g("creatorFeeRate"),v("transferFeeExtensionAuth"),j(D(),180),Ri(Cr,"platformCurve")]);var ye={initialize:Buffer.from([175,175,109,31,13,152,155,237]),initializeV2:Buffer.from([67,153,175,39,218,16,38,32]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252]),updatePlatformCurveParam:Buffer.from([138,144,138,250,220,128,4,57]),removePlatformCurveParam:Buffer.from([27,30,62,169,93,224,24,145])};function Yi(r,e,t,n,o,i,s,a,c,u,f,m,T,P,l,y,b,h,d,S,w){let p=V([D("decimals"),pe("name"),pe("symbol"),pe("uri")]),A=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),D("cpmmCreatorFeeOn")]),x=V([D("index"),g("supply"),g("totalFundRaisingB"),D("migrateType")]),k=V([D("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),D("migrateType")]),K=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:rn,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(P,"utf-8").length+Buffer.from(l,"utf-8").length+Buffer.from(y,"utf-8").length+4*3+1),L=Buffer.alloc(A.span),B=Buffer.alloc(b.type==="ConstantCurve"?k.span:x.span);return p.encode({decimals:T,name:P,symbol:l,uri:y},C),b.type==="ConstantCurve"?k.encode(Z(_({index:0},b),{migrateType:b.migrateType==="amm"?0:1}),B):b.type==="FixedCurve"?x.encode(Z(_({index:1},b),{migrateType:b.migrateType==="amm"?0:1}),B):b.type==="LinearCurve"&&x.encode(Z(_({index:2},b),{migrateType:b.migrateType==="amm"?0:1}),B),A.encode({totalLockedAmount:h,cliffPeriod:d,unlockPeriod:S,cpmmCreatorFeeOn:w},L),new be({keys:K,programId:r,data:Buffer.from([...ye.initializeV2,...C,...B,...L])})}function ji(r,e,t,n,o,i,s,a,c,u,f,m,T,P,l,y,b,h,d,S,w){let p=V([D("decimals"),pe("name"),pe("symbol"),pe("uri")]),A=V([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),D("cpmmCreatorFeeOn"),D("transferFeeExtensionParamsOption"),V([We("transferFeeBasePoints"),g("maxinumFee")]).replicate("transferFeeExtensionParams")]),x=V([D("index"),g("supply"),g("totalFundRaisingB"),D("migrateType")]),k=V([D("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),D("migrateType")]),K=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Nr,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(T,"utf-8").length+Buffer.from(P,"utf-8").length+Buffer.from(l,"utf-8").length+4*3+1),L=Buffer.alloc(A.span),B=Buffer.alloc(y.type==="ConstantCurve"?k.span:x.span);return p.encode({decimals:m,name:T,symbol:P,uri:l},C),y.type==="ConstantCurve"?k.encode(Z(_({index:0},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="FixedCurve"?x.encode(Z(_({index:1},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="LinearCurve"&&x.encode(Z(_({index:2},y),{migrateType:y.migrateType==="amm"?0:1}),B),A.encode({totalLockedAmount:b,cliffPeriod:h,unlockPeriod:d,cpmmCreatorFeeOn:S,transferFeeExtensionParamsOption:w?1:0,transferFeeExtensionParams:w!=null?w:{transferFeeBasePoints:0,maxinumFee:new ft(0)}},L),new be({keys:K,programId:r,data:Buffer.from([...ye.initializeWithToken2022,...C,...B,...L])})}function Dn(r,e,t,n,o,i,s,a,c,u,f,m,T,P,l,y,b,h,d,S){let w=V([g("amountB"),g("minAmountA"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];S&&p.push({pubkey:S,isSigner:!1,isWritable:!0}),p.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountB:b,minAmountA:h,shareFeeRate:d!=null?d:new ft(0)},A),new be({keys:p,programId:r,data:Buffer.from([...ye.buyExactIn,...A])})}function Zi(r,e,t,n,o,i,s,a,c,u,f,m,T,P,l,y,b,h,d,S){let w=V([g("amountA"),g("maxAmountB"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];S&&p.push({pubkey:S,isSigner:!1,isWritable:!0}),p.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountA:b,maxAmountB:h,shareFeeRate:d!=null?d:new ft(0)},A),new be({keys:p,programId:r,data:Buffer.from([...ye.buyExactOut,...A])})}function Qi(r,e,t,n,o,i,s,a,c,u,f,m,T,P,l,y,b,h,d,S){let w=V([g("amountA"),g("minAmountB"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];S&&p.push({pubkey:S,isSigner:!1,isWritable:!0}),p.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountA:b,minAmountB:h,shareFeeRate:d!=null?d:new ft(0)},A),new be({keys:p,programId:r,data:Buffer.from([...ye.sellExactIn,...A])})}function Ji(r,e,t,n,o,i,s,a,c,u,f,m,T,P,l,y,b,h,d,S){let w=V([g("amountB"),g("maxAmountA"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];S&&p.push({pubkey:S,isSigner:!1,isWritable:!0}),p.push({pubkey:we.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountB:b,maxAmountA:h,shareFeeRate:d!=null?d:new ft(0)},A),new be({keys:p,programId:r,data:Buffer.from([...ye.sellExactOut,...A])})}function Vn(r,e,t,n,o,i,s,a,c){let u=V([]),f=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new be({keys:f,programId:r,data:Buffer.from([...ye.claimVestedToken,...m])})}function _n(r,e,t,n,o,i){let s=V([g("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:i},c),new be({keys:a,programId:r,data:Buffer.from([...ye.createVestingAccount,...c])})}function qn(r,e,t,n,o,i,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!0},{pubkey:Xt,isSigner:!1,isWritable:!0}];return new be({keys:u,programId:r,data:ye.claimPlatformFee})}function $i(r,e,t,n,o,i,s,a,c,u,f,m,T){let P=V([g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),pe("name"),pe("web"),pe("img"),g("creatorFeeRate")]),l=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],y=Buffer.alloc(8*5+Buffer.from(f,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(T,"utf-8").length+4*3);return P.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:c,name:f,web:m,img:T,creatorFeeRate:u},y),new be({keys:l,programId:r,data:Buffer.from([...ye.createPlatformConfig,...y])})}function eo(r,e,t,n){let o=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],i;if(n.type==="updateClaimFeeWallet"){let s=V([D("index"),v("value")]);i=Buffer.alloc(s.span),s.encode({index:0,value:n.value},i)}else if(n.type==="updateLockNftWallet"){let s=V([D("index"),v("value")]);i=Buffer.alloc(s.span),s.encode({index:1,value:n.value},i)}else if(n.type==="migrateCpLockNftScale"){let s=V([D("index"),g("platformScale"),g("creatorScale"),g("burnScale")]);i=Buffer.alloc(s.span),s.encode(_({index:2},n.value),i)}else if(n.type==="updateFeeRate"){let s=V([D("index"),g("value")]);i=Buffer.alloc(s.span),s.encode({index:3,value:n.value},i)}else if(n.type==="updateImg"||n.type==="updateName"||n.type==="updateWeb"){let s=V([D("index"),pe("value")]);i=Buffer.alloc(Buffer.from(n.value,"utf-8").length+4+1*1),n.type==="updateName"?s.encode({index:4,value:n.value},i):n.type==="updateWeb"?s.encode({index:5,value:n.value},i):n.type==="updateImg"&&s.encode({index:6,value:n.value},i)}else if(n.type==="updateCpConfigId"){o.push({pubkey:n.value,isSigner:!1,isWritable:!1});let s=V([D("index")]);i=Buffer.alloc(s.span),s.encode({index:7},i)}else if(n.type==="updateAll"){o.push({pubkey:n.value.cpConfigId,isSigner:!1,isWritable:!1});let s=V([D("index"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),pe("name"),pe("web"),pe("img"),v("transferFeeExtensionAuth"),g("creatorFeeRate")]);i=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(n.value.name,"utf-8").length+Buffer.from(n.value.web,"utf-8").length+Buffer.from(n.value.img,"utf-8").length+32+8),s.encode({index:8,platformClaimFeeWallet:n.value.platformClaimFeeWallet,platformLockNftWallet:n.value.platformLockNftWallet,platformScale:n.value.migrateCpLockNftScale.platformScale,creatorScale:n.value.migrateCpLockNftScale.creatorScale,burnScale:n.value.migrateCpLockNftScale.burnScale,feeRate:n.value.feeRate,name:n.value.name,web:n.value.web,img:n.value.img,transferFeeExtensionAuth:n.value.transferFeeExtensionAuth,creatorFeeRate:n.value.creatorFeeRate},i)}else throw Error("updateInfo params type error");return new be({keys:o,programId:r,data:Buffer.from([...ye.updatePlaformConfig,...i])})}function Gn(r,e,t,n,o,i,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1}];return new be({keys:c,programId:r,data:ye.claimPlatformFeeFromVault})}function Un(r,e,t,n,o,i,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:we.programId,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1}];return new be({keys:a,programId:r,data:ye.claimCreatorFee})}var Mf=new ft("18446744073709551615");import{NATIVE_MINT as Ie,TOKEN_2022_PROGRAM_ID as Be,TOKEN_PROGRAM_ID as Q,createAssociatedTokenAccountIdempotentInstruction as ae,createSyncNativeInstruction as io,getTransferFeeConfig as Mt,unpackMint as Ot}from"@solana/spl-token";import W from"bn.js";import{PublicKey as ro,SystemProgram as oo}from"@solana/web3.js";import ke from"bn.js";import no from"decimal.js";import zt from"bn.js";import Rt from"decimal.js";var Ye=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:o}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:o,migrateFee:i,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:o,migrateFee:i}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Ht=class extends Ye{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:o}){return new Rt(t.toString()).div(e.toString()).mul(10**(n-o))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Rt(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:o,migrateFee:i,decimalA:s,decimalB:a}){return new Rt(o.sub(i).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let o=e.totalSellA.sub(e.realA),i=e.totalFundRaisingB.sub(e.realB);return new Rt(e.virtualB.add(e.realB.add(i)).toString()).div(e.virtualA.sub(e.realA.add(o)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:o,migrateFee:i}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(o);if(s.lte(new zt(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(i);if(a.lte(new zt(0)))throw Error("tfMinusMf <= 0");let c=a.mul(n).mul(n).div(s),u=a.mul(n).div(s).sub(t),f=c.div(u),m=t.mul(t).div(u);if(f.lt(new zt(0))||m.lt(new zt(0)))throw Error("invalid input 0");return{a:f,b:m,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let o=e.mul(n),i=t.add(e);return o.div(i)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let o=t.mul(e),i=n.sub(e);return Qe(o,i)}};import Yt from"bn.js";import Lt from"decimal.js";var jt=class extends Ye{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:o}){return new Lt(t.toString()).div(e.toString()).mul(10**(n-o))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Lt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:o,migrateFee:i,decimalA:s,decimalB:a}){return new Lt(o.sub(i).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let o=e.totalSellA.sub(e.realA),i=e.totalFundRaisingB.sub(e.realB);return new Lt(e.virtualB.add(e.realB).add(i).toString()).div(e.virtualA.sub(e.realA).add(o).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:o,migrateFee:i}){let s=e.sub(o);if(s.lte(new Yt(0)))throw Error("invalid input 1");let a=new Yt(2).mul(t).sub(i),u=t.mul(s).div(a);if(u.lt(new Yt(0))||t.lt(new Yt(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let o=t.mul(e);return Qe(o,n)}};import fe from"bn.js";import ot from"decimal.js";import to from"bn.js";import Xn from"decimal.js";var Ft=class{static _multipler(e){return new Xn(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Xn(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let o=e.mul(this._multipler(n)).div(this._multipler(t));return new to(o.mul(this._Q64).toFixed(0))}};Ft._Q64=new Xn(new to(1).shln(64).toString());var Zt=class extends Ye{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new ot(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:o}){return new ot(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new ot(e.virtualA.mul(e.realA).toString()).div(Ft._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:o,migrateFee:i,decimalA:s,decimalB:a}){return new ot(o.sub(i).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let o=e.totalSellA.sub(e.realA),i=e.totalFundRaisingB.sub(e.realB);return new ot(e.virtualB.add(e.realB).add(i).toString()).div(e.virtualA.sub(e.realA).add(o).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:o,migrateFee:i}){let s=e.sub(o);if(s.lte(new fe(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new fe(3)).sub(i),u=t.mul(new fe(2)).mul(s).div(a),f=u.mul(u),m=t.mul(new fe(2)).mul(Le).div(f);if(!m.gt(new fe(0)))throw Error("a need gt 0");if(!Sn.gt(m))throw Error("a need lt u64 max");if(m.lt(new fe(0))||u.lt(new fe(0)))throw Error("invalid input 0");return{a:m,b:new fe(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),o=new fe(2).mul(n).mul(Le).div(e.virtualA);return new fe(new ot(o.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),o=n.mul(n);return Qe(e.virtualA.mul(o),new fe(2).mul(Le)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),o=n.mul(n),i=Qe(e.virtualA.mul(o),new fe(2).mul(Le));return e.realB.sub(i)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),o=new fe(2).mul(n).mul(Le).div(e.virtualA),i=new fe(new ot(o.toString()).sqrt().toFixed(0));return e.realA.sub(i)}};var ge=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:o,totalSell:i,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let f=this.getCurve(e),m=f.getInitParam({supply:n,totalFundRaising:o,totalSell:i,totalLockedAmount:s,migrateFee:a}),T=f.getPoolInitPriceByInit(Z(_({},m),{decimalA:c,decimalB:u})),P=o.div(new ke(t-1)),l=new ke(0),y=[{price:T,totalSellSupply:0}],{a:b,b:h}=m,d=l,S=l;for(let w=1;w<t;w++){let p=w!==t-1?P:o.sub(S),A=this.buyExactIn({poolInfo:{virtualA:b,virtualB:h,realA:d,realB:S,totalFundRaisingB:o,totalSellA:i},amountB:p,protocolFeeRate:l,platformFeeRate:l,curveType:e,shareFeeRate:l,creatorFeeRate:l,transferFeeConfigA:void 0,slot:0});d=d.add(A.amountA.amount),S=S.add(A.amountB);let x=this.getPrice({poolInfo:{virtualA:b,virtualB:h,realA:d,realB:S},decimalA:c,decimalB:u,curveType:e});y.push({price:x,totalSellSupply:new no(d.toString()).div(10**c).toNumber()})}return y}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:o}){return this.getCurve(o).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:o,curveType:i}){return this.getCurve(i).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:o})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:o}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:o})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:o}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:o})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:o}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:o})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:o,decimals:i,config:s,migrateType:a}){if(Number(i)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(Je).lt(o))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new ke(10**i))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(Je);if(n.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let f=e.sub(n).sub(o),m=e.mul(s.minMigrateRateA).div(Je);if(f.lt(m))throw Error("migrate lt min migrate amoount");let T=e.sub(n).sub(o),P=new ke(new no(T.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let l=new ke(10).pow(new ke(i));if(P.lte(l))throw Error("check migrate lp error")}else if(a==="cpmm"){let l=new ke(100);if(P.lte(l))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:o,curveType:i,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:f}),T=t.sub(m),P=this.getCurve(i),l=P.buyExactIn({poolInfo:e,amount:T}),y=e.totalSellA.sub(e.realA),b,h,d;if(l.gt(y)){b=y;let w=P.buyExactOut({poolInfo:e,amount:b});h=this.calculatePreFee({postFeeAmount:w,feeRate:f}),d=h.sub(w)}else b=l,h=t,d=m;let S=this.splitFee({totalFee:d,protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a});return{amountA:pn(b,c,u),amountB:h,splitFee:S}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:o,curveType:i,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=e.totalSellA.sub(e.realA),m=fn(t,c,u),T=m.fee?m.amount.add(m.fee):m.amount;t.gt(f)&&(T=f);let l=this.getCurve(i).buyExactOut({poolInfo:e,amount:T}),y=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a}),b=this.calculatePreFee({postFeeAmount:l,feeRate:y}),h=b.sub(l),d=this.splitFee({totalFee:h,protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:b,splitFee:d}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:o,curveType:i,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.getCurve(i),m=pn(t,c,u),T=m.fee?m.amount.sub(m.fee):m.amount,P=f.sellExactIn({poolInfo:e,amount:T}),l=this.calculateFee({amount:P,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a})}),y=this.splitFee({totalFee:l,protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:P.sub(l),splitFee:y}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:o,curveType:i,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:f});if(e.realB.lt(m))throw Error("Insufficient liquidity");let T=m.sub(t),l=ge.getCurve(i).sellExactOut({poolInfo:e,amount:m});if(l.gt(e.realA))throw Error();let y=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:o,shareFeeRate:s,creatorFeeRate:a});return{amountA:fn(l,c,u),amountB:t,splitFee:y}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:o,creatorFeeRate:i}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:o,creatorFeeRate:i}),a=s.isZero()?new ke(0):e.mul(n).div(s),c=s.isZero()?new ke(0):e.mul(o).div(s),u=s.isZero()?new ke(0):e.mul(i).div(s),f=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:f,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return bi(e,t,Je)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(Je),o=Je.sub(t);return n.add(o).sub(new ke(1)).div(o)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:o}){if(e.add(t).add(n).add(o).gt(new ke(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(o)}static getCurve(e){switch(e){case 0:return Ht;case 1:return jt;case 2:return Zt}throw Error("find curve error")}};import ue from"decimal.js";var rt={initPriceX64:new W("515752397214619"),supply:new W(1e15),totalSellA:new W(7931e11),totalFundRaisingB:new W(85e9),totalLockedAmount:new W("0"),cliffPeriod:new W("0"),unlockPeriod:new W("0"),decimals:6,virtualA:new W("1073471847374405"),virtualB:new W("30050573465"),realA:new W(0),realB:new W(0),protocolFee:new W(0),platformId:new ro("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new W(0),cliffPeriod:new W(0),unlockPeriod:new W(0),startTime:new W(0),totalAllocatedShare:new W(0)}},Fe=new W(1e4),zn=class extends lt{constructor(e){super(e)}async sayHello(){console.log("hello")}async createLaunchpad(R){var N=R,{programId:e=re,authProgramId:t,platformId:n=rt.platformId,mintA:o,decimals:i=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:f,configId:m,snipers:T,configInfo:P,platformFeeRate:l,txVersion:y,computeBudgetConfig:b,txTipConfig:h,feePayer:d,buyAmount:S,minMintAAmount:w,slippage:p,associatedOnly:A=!0,checkCreateATAOwner:x=!1,extraSigners:k,token2022:K,transferFeeExtensionParams:C,creatorFeeOn:L=0}=N,B=_e(N,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","snipers","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams","creatorFeeOn"]);var Yn,jn,Zn,Qn,Jn,$n,ei,ti,ni,ii;let I=[],E=this.createTxBuilder(d);t=t!=null?t:xe(e).publicKey,K=!!C,K&&(f="cpmm");let G=P;if(!G&&m){let he=await this.scope.connection.getAccountInfo(m);he&&(G=Ve.decode(he.data))}G||this.logAndCreateError("config not found");let U=G.mintB,X=G.curveType,{publicKey:z}=tt(e,o,U),{publicKey:J}=Mn(e,z,o),{publicKey:Y}=Mn(e,z,U),{publicKey:oe}=Nn(o);console.log(`create token: ${o.toBase58()}, mintB: ${U.toBase58()}, decimals A:${i}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let H=(Yn=B==null?void 0:B.supply)!=null?Yn:rt.supply,q=(jn=B==null?void 0:B.totalSellA)!=null?jn:rt.totalSellA,se=(Zn=B==null?void 0:B.totalFundRaisingB)!=null?Zn:rt.totalFundRaisingB,ee=(Qn=B==null?void 0:B.totalLockedAmount)!=null?Qn:new W(0),$=l;if(!l){let he=await this.scope.connection.getAccountInfo(n);he||this.logAndCreateError("platform id not found:",n.toString()),$=it.decode(he.data).feeRate}let Hn=ge.getCurve(G.curveType).getInitParam({supply:H,totalFundRaising:se,totalSell:q,totalLockedAmount:ee,migrateFee:G.migrateFee}),Se={epoch:new W(896),bump:254,status:0,mintDecimalsA:i,mintDecimalsB:s,supply:H,totalSellA:q,mintA:new ro(o),mintB:U,virtualA:Hn.a,virtualB:Hn.b,realA:rt.realA,realB:rt.realB,migrateFee:G.migrateFee,migrateType:f==="amm"?0:1,protocolFee:rt.protocolFee,platformFee:$,platformId:n,configId:m,vaultA:J,vaultB:Y,creator:this.scope.ownerPubKey,totalFundRaisingB:se,vestingSchedule:{totalLockedAmount:ee,cliffPeriod:new W(0),unlockPeriod:new W(0),startTime:new W(0),totalAllocatedShare:new W(0)},mintProgramFlag:K?1:0,cpmmCreatorFeeOn:L},so=ge.getCurve(G.curveType),{c:ao}=so.getInitParam({supply:Se.supply,totalFundRaising:Se.totalFundRaisingB,totalLockedAmount:ee,totalSell:G.curveType===0?Se.totalSellA:new W(0),migrateFee:G.migrateFee});try{ge.checkParam({supply:Se.supply,totalFundRaising:Se.totalFundRaisingB,totalSell:ao,totalLockedAmount:ee,decimals:Se.mintDecimalsA,config:G,migrateType:f}),this.logDebug("check init params success")}catch(he){this.logAndCreateError(`check create mint params failed, ${he.message}`)}E.addInstruction({instructions:[K?ji(e,d!=null?d:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,z,o,U,J,Y,i,a,c,u||"https://",{type:X===0?"ConstantCurve":X===1?"FixedCurve":X===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:f,supply:H,totalFundRaisingB:se},ee,(Jn=B==null?void 0:B.cliffPeriod)!=null?Jn:new W(0),($n=B==null?void 0:B.unlockPeriod)!=null?$n:new W(0),L,C):Yi(e,d!=null?d:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,z,o,U,J,Y,oe,i,a,c,u||"https://",{type:X===0?"ConstantCurve":X===1?"FixedCurve":X===2?"LinearCurve":"ConstantCurve",totalSellA:q,migrateType:f,supply:H,totalFundRaisingB:se},ee,(ei=B==null?void 0:B.cliffPeriod)!=null?ei:new W(0),(ti=B==null?void 0:B.unlockPeriod)!=null?ti:new W(0),L)]});let Qt=K?await this.scope.connection.getEpochInfo():void 0,Me=C?{epoch:BigInt((Qt==null?void 0:Qt.epoch)||0),maximumFee:BigInt((ni=C==null?void 0:C.maxinumFee.toString())!=null?ni:0),transferFeeBasisPoints:(ii=C==null?void 0:C.transferFeeBasePoints)!=null?ii:0}:void 0,Jt={amountA:{amount:new W(0),fee:void 0,expirationTime:void 0},amountB:new W(0),splitFee:{platformFee:new W(0),shareFee:new W(0),protocolFee:new W(0),creatorFee:new W(0)}},$t;if(k!=null&&k.length&&E.addInstruction({signers:k}),!B.createOnly){let{builder:he,extInfo:uo}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?Be:void 0,mintA:o,mintB:U,poolInfo:Se,buyAmount:S,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:G,platformFeeRate:$,slippage:p,associatedOnly:A,checkCreateATAOwner:x,skipCheckMintA:!Me,transferFeeConfigA:Me?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Me,newerTransferFee:Me}:void 0,fromCreate:!0});console.log("FEE: ",Me),console.log("PREPARING SNIPER TRANSACTIONS");for(let oi of T){let{builder:co,extInfo:Lr}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?Be:void 0,mintA:o,mintB:U,poolInfo:Se,buyAmount:oi.amount,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:G,platformFeeRate:$,slippage:p,sniper:oi,associatedOnly:A,checkCreateATAOwner:x,skipCheckMintA:!Me,transferFeeConfigA:Me?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Me,newerTransferFee:Me}:void 0,fromCreate:!0});I.push(Z(_({},co.AllTxData),{blockHash:this.scope.blockhashCommitment}))}E.addInstruction(_({},he.AllTxData)),Jt=_({},uo),$t=(this.scope.cluster==="devnet"||y===1)&&B.shareFeeReceiver?[he.allInstructions[0]]:void 0}return y===0?(console.log("VERSION V0"),{tx:await E.sizeCheckBuildV0({computeBudgetConfig:b,swapInfo:Jt,splitIns:$t,address:Z(_({},Se),{poolId:z})}),txs:I}):(console.log("VERSION PLAIN"),{tx:await E.sizeCheckBuild({computeBudgetConfig:b,swapInfo:Jt,splitIns:$t,address:Z(_({},Se),{poolId:z})}),txs:I})}async buyTokenOriginal({programId:e=re,authProgramId:t,mintA:n,mintAProgram:o=Q,mintB:i=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,buyAmount:P,minMintAAmount:l,slippage:y,sniper:b,shareFeeRate:h=new W(0),shareFeeReceiver:d,associatedOnly:S=!0,checkCreateATAOwner:w=!1,fromCreate:p=!1,transferFeeConfigA:A,skipCheckMintA:x=!1}){var H,q,se;P.lte(new W(0))&&this.logAndCreateError("buy amount should gt 0:",P.toString());let k=b?this.createSniperTxBuilder(b.owner,b.owner.publicKey):this.createTxBuilder(T),{publicKey:K}=tt(e,n,i);t=t!=null?t:xe(e).publicKey;let C=A;if(!x)if(console.log("!skipCheckMintA: ",x),C)console.log("TOKEN_2022_PROGRAM_ID: ",Be),o=Be;else{console.log("!transferFeeConfigA: ",C);let ee=await this.scope.connection.getAccountInfo(n);if(ee&&ee.owner.equals(Be)){console.log("TOKEN_2022_PROGRAM_ID: ",x),o=ee.owner;let $=Ot(n,ee,o);C=Mt($)||void 0}}let L=this.scope.account.getAssociatedTokenAccount(n,o),B=p?this.scope.account.getAssociatedTokenAccount(i,Q):null,R=i.equals(Ie);if(k.addInstruction({instructions:[ae(this.scope.ownerPubKey,L,this.scope.ownerPubKey,n,o),...p?[ae(this.scope.ownerPubKey,B,this.scope.ownerPubKey,i,Q),oo.transfer({fromPubkey:this.scope.ownerPubKey,toPubkey:B,lamports:BigInt(P.toString())}),io(B)]:[]]}),!p){let{account:ee,instructionParams:$}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:R?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!R,notUseTokenAccount:R,associatedOnly:R?!1:S,checkCreateATAOwner:w});ee&&(B=ee),k.addInstruction($||{})}B===void 0&&this.logAndCreateError(`cannot found mintB(${i.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let N=s;if(!N){let ee=await this.scope.connection.getAccountInfo(K,{commitment:"processed"});ee||this.logAndCreateError("cannot found pool:",K.toBase58()),N=Te.decode(ee.data)}let I=a,E=await Re(this.scope.connection,[I?void 0:N.configId,N.platformId].filter(Boolean).map(ee=>({pubkey:ee})));if(!I){let ee=E.find($=>$.pubkey.equals(N.configId));(!ee||!ee.accountInfo)&&this.logAndCreateError("config not found: ",N.configId.toBase58()),I=Ve.decode(ee.accountInfo.data)}let G=E.find(ee=>ee.pubkey.equals(N.platformId));(!G||!G.accountInfo)&&this.logAndCreateError("platform info not found: ",N.configId.toBase58());let U=it.decode(G.accountInfo.data);c=c||U.feeRate;let X=ge.buyExactIn({poolInfo:N,amountB:P,protocolFeeRate:I.tradeFeeRate,platformFeeRate:c,curveType:I.curveType,shareFeeRate:h,creatorFeeRate:U.creatorFeeRate,transferFeeConfigA:C,slot:await this.scope.connection.getSlot()}),z=new ue(X.amountA.amount.toString()).sub((q=(H=X.amountA.fee)==null?void 0:H.toString())!=null?q:0),J=y?new ue(Fe.sub(y).toNumber()/Fe.toNumber()).clampedTo(0,1):new ue(1),Y=l!=null?l:y?new W(z.mul(J).toFixed(0)):X.amountA.amount.sub((se=X.amountA.fee)!=null?se:new W(0));X.amountB.lt(P)&&console.log(`maximum ${n.toBase58()} amount can buy is ${X.amountA.toString()}, input ${i.toBase58()} amount: ${X.amountB.toString()}`);let oe=d?Pe(d,i,Q).publicKey:void 0;return oe&&k.addInstruction({instructions:[ae(this.scope.ownerPubKey,oe,d,i)]}),k.addInstruction({instructions:[Dn(e,this.scope.ownerPubKey,t,N.configId,N.platformId,K,L,B,N.vaultA,N.vaultB,n,i,o,Q,ze(e,N.platformId,i).publicKey,He(e,N.creator,i).publicKey,X.amountB.lt(P)?X.amountB:P,Y,h,oe)]}),k.addCustomComputeBudget(f),k.addTipInstruction(m),k.versionBuild({txVersion:u,extInfo:Z(_({},X),{decimalOutAmount:z,minDecimalOutAmount:new ue(Y.toString())})})}async buyToken({programId:e=re,authProgramId:t,mintA:n,mintAProgram:o=Q,mintB:i=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,buyAmount:P,minMintAAmount:l,slippage:y,shareFeeRate:b=new W(0),shareFeeReceiver:h,sniper:d,associatedOnly:S=!0,checkCreateATAOwner:w=!1,fromCreate:p=!1,transferFeeConfigA:A,skipCheckMintA:x=!1}){var q,se,ee;P.lte(new W(0))&&this.logAndCreateError("buy amount should gt 0:",P.toString());let k=d?this.createSniperTxBuilder(d.owner,d.owner.publicKey):this.createTxBuilder(T),{publicKey:K}=tt(e,n,i);t=t!=null?t:xe(e).publicKey;let C=A;if(!x)if(console.log("!skipCheckMintA: ",x),C)console.log("mintAProgram: ",Be),o=Be;else{console.log("!transferFeeConfigA: ",C);let $=await this.scope.connection.getAccountInfo(n);if($&&$.owner.equals(Be)){console.log("!mintInfo: ",$),o=$.owner;let st=Ot(n,$,o);C=Mt(st)||void 0}}let L=d?this.scope.account.getAssociatedTokenAccountByOwner(d.owner.publicKey,n,o):this.scope.account.getAssociatedTokenAccount(n,o),B=p?d?this.scope.account.getAssociatedTokenAccountByOwner(d.owner.publicKey,i,Q):this.scope.account.getAssociatedTokenAccount(i,Q):null,R=i.equals(Ie);console.log("userTokenAccountA: ",L),console.log("userTokenAccountB: ",B);let N=[ae((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,L,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,n,o),...p?[ae((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,B,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,i,Q),oo.transfer({fromPubkey:(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,toPubkey:B,lamports:BigInt(P.toString())}),io(B)]:[]];if(console.log("adding ixs: ",N),k.addInstruction({instructions:N}),!p){let{account:$,instructionParams:st}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:R?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!R,notUseTokenAccount:R,associatedOnly:R?!1:S,checkCreateATAOwner:w});$&&(B=$),k.addInstruction(st||{})}B===void 0&&this.logAndCreateError(`cannot found mintB(${i.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let I=s;if(!I){let $=await this.scope.connection.getAccountInfo(K,{commitment:"processed"});$||this.logAndCreateError("cannot found pool:",K.toBase58()),I=Te.decode($.data)}let E=a,G=await Re(this.scope.connection,[E?void 0:I.configId,I.platformId].filter(Boolean).map($=>({pubkey:$})));if(!E){let $=G.find(st=>st.pubkey.equals(I.configId));(!$||!$.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),E=Ve.decode($.accountInfo.data)}let U=G.find($=>$.pubkey.equals(I.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58());let X=it.decode(U.accountInfo.data);c=c||X.feeRate;let z=ge.buyExactIn({poolInfo:I,amountB:P,protocolFeeRate:E.tradeFeeRate,platformFeeRate:c,curveType:E.curveType,shareFeeRate:b,creatorFeeRate:X.creatorFeeRate,transferFeeConfigA:C,slot:await this.scope.connection.getSlot()}),J=new ue(z.amountA.amount.toString()).sub((se=(q=z.amountA.fee)==null?void 0:q.toString())!=null?se:0),Y=y?new ue(Fe.sub(y).toNumber()/Fe.toNumber()).clampedTo(0,1):new ue(1),oe=l!=null?l:y?new W(J.mul(Y).toFixed(0)):z.amountA.amount.sub((ee=z.amountA.fee)!=null?ee:new W(0));z.amountB.lt(P)&&console.log(`maximum ${n.toBase58()} amount can buy is ${z.amountA.toString()}, input ${i.toBase58()} amount: ${z.amountB.toString()}`);let H=h?Pe(h,i,Q).publicKey:void 0;return H&&k.addInstruction({instructions:[ae((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,H,h,i)]}),k.addInstruction({instructions:[Dn(e,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,t,I.configId,I.platformId,K,L,B,I.vaultA,I.vaultB,n,i,o,Q,ze(e,I.platformId,i).publicKey,He(e,I.creator,i).publicKey,z.amountB.lt(P)?z.amountB:P,oe,b,H)]}),k.addCustomComputeBudget(f),k.addTipInstruction(m),k.versionBuild({txVersion:u,extInfo:Z(_({},z),{decimalOutAmount:J,minDecimalOutAmount:new ue(oe.toString())})})}async buyTokenExactOut({programId:e=re,authProgramId:t,mintA:n,mintAProgram:o=Q,mintB:i=Ie,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:f,computeBudgetConfig:m,txTipConfig:T,feePayer:P,maxBuyAmount:l,outAmount:y,slippage:b,shareFeeRate:h=new W(0),shareFeeReceiver:d,associatedOnly:S=!0,checkCreateATAOwner:w=!1,skipCheckMintA:p=!1}){y.lte(new W(0))&&this.logAndCreateError("out amount should gt 0:",y.toString());let A=this.createTxBuilder(P),{publicKey:x}=tt(e,n,i);t=t!=null?t:xe(e).publicKey;let k=s;if(!k){let H=await this.scope.connection.getAccountInfo(x,{commitment:"processed"});H||this.logAndCreateError("cannot found pool:",x.toBase58()),k=Te.decode(H.data)}let K=a,C=await Re(this.scope.connection,[K?void 0:k.configId,k.platformId].filter(Boolean).map(H=>({pubkey:H})));if(!K){let H=C.find(q=>q.pubkey.equals(k.configId));(!H||!H.accountInfo)&&this.logAndCreateError("config not found: ",k.configId.toBase58()),K=Ve.decode(H.accountInfo.data)}let L=C.find(H=>H.pubkey.equals(k.platformId));(!L||!L.accountInfo)&&this.logAndCreateError("platform info not found: ",k.configId.toBase58());let B=it.decode(L.accountInfo.data);u=u||B.feeRate;let R=c;if(!p)if(R)o=Be;else{let H=await this.scope.connection.getAccountInfo(n);if(H&&H.owner.equals(Be)){o=H.owner;let q=Ot(n,H,o);R=Mt(q)||void 0}}let N=ge.buyExactOut({poolInfo:k,amountA:y,protocolFeeRate:K.tradeFeeRate,platformFeeRate:u,curveType:K.curveType,shareFeeRate:h,creatorFeeRate:B.creatorFeeRate,transferFeeConfigA:R,slot:await this.scope.connection.getSlot()}),I=new ue(N.amountB.toString()),E=b?new ue(Fe.add(b).toNumber()/Fe.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new ue(1),G=(l!=null?l:b)?new W(I.mul(E).toFixed(0)):N.amountB,U=this.scope.account.getAssociatedTokenAccount(n,o),X=null,z=i.equals(Ie);A.addInstruction({instructions:[ae(this.scope.ownerPubKey,U,this.scope.ownerPubKey,n,o)]});let{account:J,instructionParams:Y}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:z?{payer:this.scope.ownerPubKey,amount:N.amountB}:void 0,skipCloseAccount:!z,notUseTokenAccount:z,associatedOnly:z?!1:S,checkCreateATAOwner:w});J&&(X=J),A.addInstruction(Y||{}),X===void 0&&this.logAndCreateError(`cannot found mintB(${i.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let oe=d?Pe(d,i,Q).publicKey:void 0;return oe&&A.addInstruction({instructions:[ae(this.scope.ownerPubKey,oe,d,i)]}),A.addInstruction({instructions:[Zi(e,this.scope.ownerPubKey,t,k.configId,k.platformId,x,U,X,k.vaultA,k.vaultB,n,i,o,Q,ze(e,k.platformId,i).publicKey,He(e,k.creator,i).publicKey,y,G,h,oe)]}),A.addCustomComputeBudget(m),A.addTipInstruction(T),A.versionBuild({txVersion:f,extInfo:{maxSpentAmount:G,outAmount:y}})}async sellToken({programId:e=re,authProgramId:t,mintAProgram:n=Q,mintA:o,mintB:i=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,sellAmount:P,minAmountB:l,slippage:y,shareFeeRate:b=new W(0),shareFeeReceiver:h,associatedOnly:d=!0,checkCreateATAOwner:S=!1,skipCheckMintA:w=!1}){t=t!=null?t:xe(e).publicKey;let p=this.createTxBuilder(T);P.lte(new W(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:A}=tt(e,o,i),x;if(!w){let q=await this.scope.connection.getAccountInfo(o);if(q&&q.owner.equals(Be)){n=q.owner;let se=Ot(o,q,n);x=Mt(se)||void 0}}let k=null,K=null,C=i.equals(Ie),{account:L,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:o,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:d,checkCreateATAOwner:S});L&&(k=L),p.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:R,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:d,checkCreateATAOwner:S});R&&(K=R),p.addInstruction(N||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=s;if(!I){let q=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",A.toBase58()),I=Te.decode(q.data)}let E=a,G=await Re(this.scope.connection,[E?void 0:I.configId,I.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!E){let q=G.find(se=>se.pubkey.equals(I.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),E=Ve.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(I.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58());let X=it.decode(U.accountInfo.data);c=c||X.feeRate;let z=ge.sellExactIn({poolInfo:I,amountA:P,protocolFeeRate:E.tradeFeeRate,platformFeeRate:c,curveType:E.curveType,shareFeeRate:b,creatorFeeRate:X.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),J=new ue(z.amountB.toString()),Y=y?new ue(Fe.sub(y).toNumber()/Fe.toNumber()).clampedTo(0,1):new ue(1),oe=l!=null?l:y?new W(J.mul(Y).toFixed(0)):z.amountB;oe.lte(new W(0))&&this.logAndCreateError(`out ${i.toBase58()} amount should be gt 0`);let H=h?Pe(h,i,Q).publicKey:void 0;return H&&p.addInstruction({instructions:[ae(this.scope.ownerPubKey,H,h,i)]}),p.addInstruction({instructions:[Qi(e,this.scope.ownerPubKey,t,I.configId,I.platformId,A,k,K,I.vaultA,I.vaultB,o,i,n,Q,ze(e,I.platformId,i).publicKey,He(e,I.creator,i).publicKey,z.amountA.amount.lt(P)?z.amountA.amount:P,oe,b,H)]}),p.addCustomComputeBudget(f),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{outAmount:oe}})}async sellTokenExactOut({programId:e=re,authProgramId:t,mintAProgram:n=Q,mintA:o,mintB:i=Ie,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,inAmount:P,maxSellAmount:l,slippage:y,shareFeeRate:b=new W(0),shareFeeReceiver:h,associatedOnly:d=!0,checkCreateATAOwner:S=!1,skipCheckMintA:w=!1}){t=t!=null?t:xe(e).publicKey;let p=this.createTxBuilder(T);l!=null&&l.lte(new W(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:A}=tt(e,o,i),x;if(!w){let q=await this.scope.connection.getAccountInfo(o);if(q&&q.owner.equals(Be)){n=q.owner;let se=Ot(o,q,n);x=Mt(se)||void 0}}let k=null,K=null,C=i.equals(Ie),{account:L,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:o,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:d,checkCreateATAOwner:S});L&&(k=L),p.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:R,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:d,checkCreateATAOwner:S});R&&(K=R),p.addInstruction(N||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=s;if(!I){let q=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});q||this.logAndCreateError("cannot found pool",A.toBase58()),I=Te.decode(q.data)}let E=a,G=await Re(this.scope.connection,[E?void 0:I.configId,I.platformId].filter(Boolean).map(q=>({pubkey:q})));if(!E){let q=G.find(se=>se.pubkey.equals(I.configId));(!q||!q.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),E=Ve.decode(q.accountInfo.data)}let U=G.find(q=>q.pubkey.equals(I.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58());let X=it.decode(U.accountInfo.data);c=c||X.feeRate;let z=ge.sellExactOut({poolInfo:I,amountB:P,protocolFeeRate:E.tradeFeeRate,platformFeeRate:c,curveType:E.curveType,shareFeeRate:b,creatorFeeRate:X.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),J=new ue(z.amountA.amount.toString()),Y=y?new ue(Fe.add(y).toNumber()/Fe.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new ue(1),oe=(l!=null?l:y)?new W(J.mul(Y).toFixed(0)):z.amountA.amount,H=h?Pe(h,i,Q).publicKey:void 0;return H&&p.addInstruction({instructions:[ae(this.scope.ownerPubKey,H,h,i)]}),p.addInstruction({instructions:[Ji(e,this.scope.ownerPubKey,t,I.configId,I.platformId,A,k,K,I.vaultA,I.vaultB,o,i,n,Q,ze(e,I.platformId,i).publicKey,He(e,I.creator,i).publicKey,P,oe,b,H)]}),p.addCustomComputeBudget(f),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{maxSellAmount:oe}})}async createPlatformConfig({programId:e=re,platformAdmin:t,platformClaimFeeWallet:n,platformLockNftWallet:o,cpConfigId:i,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:c,feeRate:u,name:f,web:m,img:T,txVersion:P,computeBudgetConfig:l,txTipConfig:y,feePayer:b}){let h=this.createTxBuilder(b),{publicKey:d}=On(e,t);return h.addInstruction({instructions:[$i(e,t,n,o,d,i,a,s,u,c,f,m,T)]}),h.addCustomComputeBudget(l),h.addTipInstruction(y),h.versionBuild({txVersion:P,extInfo:{platformId:d}})}async updatePlatformConfig({programId:e=re,platformAdmin:t,platformId:n,updateInfo:o,txVersion:i,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=n!=null?n:On(e,t).publicKey;return u.addInstruction({instructions:[eo(e,t,f,o)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:i})}async claimPlatformFee({programId:e=re,authProgramId:t,platformId:n,poolId:o,platformClaimFeeWallet:i,mintB:s,vaultB:a,mintBProgram:c=Q,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T}){var h;let P=this.createTxBuilder(T);t=t!=null?t:xe(e).publicKey;let l=s,y=a;if(!l){let d=await this.scope.connection.getAccountInfo(o,{commitment:"processed"});d||this.logAndCreateError("cannot found pool:",o.toBase58());let S=Te.decode(d.data),w=await this.scope.connection.getAccountInfo(S.configId,{commitment:"processed"});w||this.logAndCreateError("cannot found config:",S.configId.toBase58()),l=Ve.decode(w.data).mintB,y=y!=null?y:S.vaultB}(!l||!y)&&this.logAndCreateError("cannot found mint info, mintB: ",l.toBase58(),", vaultB: ",(h=y==null?void 0:y.toBase58())!=null?h:"");let b=Pe(this.scope.ownerPubKey,l,Q).publicKey;return P.addInstruction({instructions:[ae(this.scope.ownerPubKey,b,this.scope.ownerPubKey,l)]}),P.addInstruction({instructions:[qn(e,i,t,o,n,y,b,l,c)]}),P.addCustomComputeBudget(f),P.addTipInstruction(m),P.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=re,authProgramId:t,platformId:n,platformClaimFeeWallet:o,txVersion:i,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:xe(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Te.span},{memcmp:{offset:Te.offsetOf("platformId"),bytes:n.toString()}}]})).forEach(m=>{let T=Te.decode(m.account.data);if(T.platformFee.lte(new W(0)))return;let P=Pe(this.scope.ownerPubKey,T.mintB,Q).publicKey;u.addInstruction({instructions:[ae(this.scope.ownerPubKey,P,this.scope.ownerPubKey,T.mintB)]}),u.addInstruction({instructions:[qn(e,o,t,m.pubkey,n,T.vaultB,P,T.mintB,Q)]})}),u.addTipInstruction(a),i===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=re,poolId:t,beneficiary:n,shareAmount:o,txVersion:i,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=await this.getRpcPoolInfo({poolId:t});o.add(f.vestingSchedule.totalAllocatedShare).gt(f.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=Nt(e,t,n).publicKey;return u.addInstruction({instructions:[_n(e,this.scope.ownerPubKey,n,t,m,o)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:i})}async createMultipleVesting({programId:e=re,poolId:t,beneficiaryList:n,txVersion:o,computeBudgetConfig:i,feePayer:s}){let a=this.createTxBuilder(s);n.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return n.reduce((f,m)=>f.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),n.forEach(f=>{let m=Nt(e,t,f.wallet).publicKey;a.addInstruction({instructions:[_n(e,this.scope.ownerPubKey,f.wallet,t,m,f.shareAmount)]})}),o===0?a.sizeCheckBuildV0({computeBudgetConfig:i}):a.sizeCheckBuild({computeBudgetConfig:i})}async claimVesting({programId:e=re,poolId:t,poolInfo:n,vestingRecord:o,txVersion:i,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=xe(e).publicKey,m=o||Nt(e,t,this.scope.ownerPubKey).publicKey,T=n;if(!T){let l=await this.scope.connection.getAccountInfo(t);l||this.logAndCreateError("pool not found"),T=Te.decode(l.data)}let P=Pe(this.scope.ownerPubKey,T.mintA,Q).publicKey;return u.addInstruction({instructions:[ae(this.scope.ownerPubKey,P,this.scope.ownerPubKey,T.mintA)]}),u.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,f,t,m,P,T.vaultA,T.mintA,Q)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:i})}async claimMultiVesting({programId:e=re,poolIdList:t,poolsInfo:n={},vestingRecords:o={},txVersion:i,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=_({},n),f=xe(e).publicKey,m=t.filter(T=>!u[T.toBase58()]);if(m.length){let T=await this.getRpcPoolsInfo({poolIdList:m});u=_(_({},u),T.poolInfoMap)}return t.forEach(T=>{let P=T.toBase58(),l=u[P];l||this.logAndCreateError(`pool info not found: ${P}`);let y=o[P]||Nt(e,T,this.scope.ownerPubKey).publicKey,b=Pe(this.scope.ownerPubKey,l.mintA,Q).publicKey;c.addInstruction({instructions:[ae(this.scope.ownerPubKey,b,this.scope.ownerPubKey,l.mintA)]}),c.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,f,T,y,b,l.vaultA,l.mintA,Q)]})}),i===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=re,platformId:t,mintB:n,mintBProgram:o=Q,claimFeeWallet:i,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let f=this.createTxBuilder(u),m=ze(e,t,n).publicKey,T=En(e).publicKey,P=this.scope.account.getAssociatedTokenAccount(n,o);return f.addInstruction({instructions:[ae(this.scope.ownerPubKey,P,this.scope.ownerPubKey,n,o),Gn(e,t,i!=null?i:this.scope.ownerPubKey,T,m,P,n,o)]}),f.addCustomComputeBudget(a),f.addTipInstruction(c),f.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=re,platformList:t,unwrapSol:n=!0,txVersion:o,computeBudgetConfig:i,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),f={};return t.forEach(async m=>{var b,h;let T=En(e).publicKey,P=ze(e,m.id,m.mintB).publicKey,l=m.mintB.equals(Ie)&&n,y=f[m.mintB.toBase58()];if(!y){let{account:d,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:l?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!l,notUseTokenAccount:l,associatedOnly:l?!1:a,checkCreateATAOwner:c});d&&(y=d),u.addInstruction(S||{}),y===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[Gn(e,m.id,(b=m.claimFeeWallet)!=null?b:this.scope.ownerPubKey,P,T,y,m.mintB,(h=m.mintBProgram)!=null?h:Q)]})}),o===0?u.sizeCheckBuildV0({computeBudgetConfig:i}):u.sizeCheckBuild({computeBudgetConfig:i})}async claimCreatorFee({programId:e=re,mintB:t,mintBProgram:n=Q,txVersion:o,computeBudgetConfig:i,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=He(e,this.scope.ownerPubKey,t).publicKey,f=vn(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,n);return c.addInstruction({instructions:[ae(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,n),Un(e,this.scope.ownerPubKey,f,u,m,t,n)]}),c.addCustomComputeBudget(i),c.addTipInstruction(s),c.versionBuild({txVersion:o})}async claimMultipleCreatorFee({programId:e=re,mintBList:t,txVersion:n,computeBudgetConfig:o,feePayer:i}){let s=this.createTxBuilder(i);return t.forEach(a=>{var P;let c=a.pubKey,u=(P=a.programId)!=null?P:Q,f=He(e,this.scope.ownerPubKey,c).publicKey,m=vn(e).publicKey,T=this.scope.account.getAssociatedTokenAccount(c,u);s.addInstruction({instructions:[ae(this.scope.ownerPubKey,T,this.scope.ownerPubKey,c,u),Un(e,this.scope.ownerPubKey,m,f,T,c,u)]})}),n==0?s.sizeCheckBuildV0({computeBudgetConfig:o}):s.sizeCheckBuild({computeBudgetConfig:o})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let n=await Re(this.scope.connection,e.map(c=>({pubkey:c})),t),o={},i=[];for(let c=0;c<e.length;c++){let u=n[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let f=Te.decode(u.accountInfo.data);o[e[c].toBase58()]=Z(_({},f),{poolId:u.accountInfo.owner}),i.push(f.configId)}let s=await Re(this.scope.connection,i.map(c=>({pubkey:c})),t),a={};for(let c=0;c<i.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+i[c].toBase58());let f=Ve.decode(u.accountInfo.data);a[i[c].toBase58()]=Z(_({},f),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(o).reduce((c,u)=>Z(_({},c),{[u]:Z(_({},o[u]),{configInfo:a[o[u].configId.toBase58()]})}),{})}}};export{rt as LaunchpadPoolInitParam,zn as default};
//# sourceMappingURL=launchpad.mjs.map