var er=Object.defineProperty,tr=Object.defineProperties;var nr=Object.getOwnPropertyDescriptors;var St=Object.getOwnPropertySymbols;var Qn=Object.prototype.hasOwnProperty,Yn=Object.prototype.propertyIsEnumerable;var Zn=(o,e,t)=>e in o?er(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,V=(o,e)=>{for(var t in e||(e={}))Qn.call(e,t)&&Zn(o,t,e[t]);if(St)for(var t of St(e))Yn.call(e,t)&&Zn(o,t,e[t]);return o},X=(o,e)=>tr(o,nr(e));var We=(o,e)=>{var t={};for(var n in o)Qn.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&St)for(var n of St(o))e.indexOf(n)<0&&Yn.call(o,n)&&(t[n]=o[n]);return t};import{get as Jn,set as ir}from"lodash";var Qt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},$n={},rr={};function se(o){let e=Jn($n,o);if(!e){let t=Jn(rr,o);e=new Qt({name:o,logLevel:t}),ir($n,o,e)}return e}import{PublicKey as $e,sendAndConfirmTransaction as bn,SystemProgram as Mr,Transaction as yt,TransactionMessage as gt,VersionedTransaction as Pt}from"@solana/web3.js";import Or from"axios";import{PublicKey as dn,AddressLookupTableAccount as Je}from"@solana/web3.js";import{PublicKey as Fr}from"@solana/web3.js";import Ie from"bn.js";import da from"decimal.js";import dr from"big.js";import qo from"bn.js";import or from"toformat";var sr=or,ut=sr;import Ct from"big.js";import ur from"bn.js";import cr from"decimal.js-light";import ct from"bn.js";var ei=9007199254740991;function xe(o){let e=se("Raydium_parseBigNumberish");if(o instanceof ct)return o;if(typeof o=="string"){if(o.match(/^-?[0-9]+$/))return new ct(o);e.logWithError(`invalid BigNumberish string: ${o}`)}return typeof o=="number"?(o%1&&e.logWithError(`BigNumberish number underflow: ${o}`),(o>=ei||o<=-ei)&&e.logWithError(`BigNumberish number overflow: ${o}`),new ct(String(o))):typeof o=="bigint"?new ct(o.toString()):(e.error(`invalid BigNumberish value: ${o}`),new ct(0))}var Kt=se("module/fraction"),Yt=ut(Ct),lt=ut(cr),lr={[0]:lt.ROUND_DOWN,[1]:lt.ROUND_HALF_UP,[2]:lt.ROUND_UP},mr={[0]:Ct.roundDown,[1]:Ct.roundHalfUp,[2]:Ct.roundUp},Z=class{constructor(e,t=new ur(1)){this.numerator=xe(e),this.denominator=xe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Z(this.denominator,this.numerator)}add(e){let t=e instanceof Z?e:new Z(xe(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.add(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Z?e:new Z(xe(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.sub(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Z?e:new Z(xe(e));return new Z(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Z?e:new Z(xe(e));return new Z(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Kt.logWithError(`${e} is not an integer.`),e<=0&&Kt.logWithError(`${e} is not positive.`),lt.set({precision:e+1,rounding:lr[n]});let i=new lt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Kt.logWithError(`${e} is not an integer.`),e<0&&Kt.logWithError(`${e} is negative.`),Yt.DP=e,Yt.RM=mr[n]||1,new Yt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Yo=se("Raydium_amount"),Jo=ut(dr);import{PublicKey as fr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ti}from"@solana/spl-token";var Jt={chainId:101,address:fr.default.toBase58(),programId:ti.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Me={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ti.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as tn}from"@solana/web3.js";import{PublicKey as Q,SystemProgram as ni,SYSVAR_RENT_PUBKEY as br}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as yr}from"@solana/spl-token";function $t({pubkey:o,isSigner:e=!1,isWritable:t=!0}){return{pubkey:o,isWritable:t,isSigner:e}}var ss=[$t({pubkey:yr,isWritable:!1}),$t({pubkey:ni.programId,isWritable:!1}),$t({pubkey:br,isWritable:!1})];function ii({publicKey:o,transformSol:e}){let t=ri(o.toString());if(t instanceof Q)return e&&t.equals(mt)?Nt:t;if(e&&t.toString()===mt.toBase58())return Nt;if(typeof t=="string"){if(t===Q.default.toBase58())return Q.default;try{return new Q(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ri(o){try{return new Q(o)}catch{return o}}var gr=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Pr=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),en=new Q("SysvarRent111111111111111111111111111111111"),as=new Q("SysvarC1ock11111111111111111111111111111111"),Ze=new Q("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),us=new Q("Sysvar1nstructions1111111111111111111111111"),cs=ni.programId,ls=new Q("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ms=new Q("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ds=new Q("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ps=new Q("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),fs=new Q("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),bs=new Q("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ys=new Q("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),gs=new Q("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ps=new Q("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),As=new Q("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ws=new Q("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Nt=new Q("So11111111111111111111111111111111111111112"),mt=Q.default;var nn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:r=!1,isToken2022:s=!1}){if(e===mt.toBase58()||e instanceof tn&&mt.equals(e)){this.decimals=Me.decimals,this.symbol=Me.symbol,this.name=Me.name,this.mint=new tn(Me.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=r?tn.default:ii({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Oe=nn;Oe.WSOL=new nn(X(V({},Me),{mint:Me.address}));var rn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Rt=rn;Rt.SOL=new rn(Jt);import Ar from"bn.js";var Ls=new Z(new Ar(100));var Ds=se("Raydium_price");import{PublicKey as ta}from"@solana/web3.js";import ia from"bn.js";var wr=new Ie(0),Ta=new Ie(1),Ba=new Ie(2),ha=new Ie(3),xa=new Ie(5),pr=new Ie(10),Ia=new Ie(100),Sa=new Ie(1e3),Ka=new Ie(1e4);function oi(o,e,t){return o.mul(e).add(t).sub(new Ie(1)).div(t)}function an(o,e=1,t=[]){let n=[...o];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Sr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Kr}from"@solana/spl-token";import{ComputeBudgetProgram as si,Keypair as ui,PublicKey as kr,Transaction as ci,TransactionMessage as Tr,VersionedTransaction as li}from"@solana/web3.js";var Ve={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Br}from"@solana/spl-token";var ai=se("Raydium_txUtil"),mi=1644;function Ft(o){let e=[],t=[];return o.microLamports&&(e.push(si.setComputeUnitPrice({microLamports:o.microLamports})),t.push(Ve.SetComputeUnitPrice)),o.units&&(e.push(si.setComputeUnitLimit({units:o.units})),t.push(Ve.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Qe(o,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=o.getLatestBlockhash)==null?void 0:n.call(o,{commitment:t})))==null?void 0:i.blockhash}async function Mt(o,e){return o.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);o.onSignature(e,r=>{if(clearTimeout(i),!r.err){t("");return}n(Object.assign(r.err,{txId:e}))},"confirmed")})}function hr(o,e){o.length<1&&ai.logWithError(`no instructions provided: ${o.toString()}`),e.length<1&&ai.logWithError(`no signers provided:, ${e.toString()}`);let t=new ci;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...o);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<mi}catch{return!1}}function ue(o,e){let[t,n]=kr.findProgramAddressSync(o,e);return{publicKey:t,nonce:n}}function dt({instructions:o,payer:e,signers:t}){return hr(o,[e,...t])}function pt({instructions:o,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=ui.generate().publicKey.toString()}){let r=new Tr({payerKey:e,recentBlockhash:n,instructions:o}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new li(r).serialize()).toString("base64").length<mi}catch{return!1}}var xr=o=>Buffer.isBuffer(o)?o:o instanceof Uint8Array?Buffer.from(o.buffer,o.byteOffset,o.byteLength):Buffer.from(o),Ir=o=>{let e=o.serialize({requireAllSignatures:!1,verifySignatures:!1});o instanceof li&&(e=xr(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function _e(o){let e=[];return o.forEach(t=>{t instanceof ci&&(t.recentBlockhash||(t.recentBlockhash=Br.toBase58()),t.feePayer||(t.feePayer=ui.generate().publicKey)),e.push(Ir(t))}),console.log("simulate tx string:",e),e}function Te(o,e,t){return ue([o.toBuffer(),(t!=null?t:Kr).toBuffer(),e.toBuffer()],new Sr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as L}from"@solana/web3.js";var Za=new L("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Qa=new L("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ya=new L("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ja=new L("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),$a=new L("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),eu=new L("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),tu=new L("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),nu=new L("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),iu=new L("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ru=new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Cr=new L("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Nr=new L("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Rr=new L("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ou=new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),su=new L("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),au=new L("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),uu=new L("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),cu=new L("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),lu=new L("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),mu=new L("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),du=new L("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),pu=new L("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),fu=new L("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),bu=new L("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),yu=new L("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ie=new L("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),gu=new L("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Pu=new L("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Au=new L("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),wu=new L("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),ku=new L("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Tu={OPEN_BOOK_PROGRAM:new L("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new L("Ray1111111111111111111111111111111111111111"),AMM_V4:new L("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new L("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new L("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new L("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new L("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new L("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new L("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new L("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new L("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new L("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:L.default,Router:new L("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new L("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new L("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new L("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new L("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new L("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new L("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new L("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new L("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new L("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new L("Ray1111111111111111111111111111111111111111")};import ae from"bn.js";var ft=1e4;function un(o,e){let{div:t,mod:n}=o.divmod(e);return n.gt(new ae(0))?t.add(new ae(1)):t}function qe(o,e){if(o.isZero())return new ae(0);let t=o.div(e);return t.isZero()?new ae(1):o.mod(e).gt(new ae(0))?t.add(new ae(1)):t}function cn(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new ae(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=un(o.mul(new ae(i.transferFeeBasisPoints)),new ae(ft)),c=a.gt(r)?r:a;return{amount:o,fee:c,expirationTime:s}}function ln(o,e,t){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,r=new ae(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===ft){let a=new ae(i.maximumFee.toString());return{amount:o.add(a),fee:a,expirationTime:s}}else{let a=un(o.mul(new ae(ft)),new ae(ft-i.transferFeeBasisPoints)),c=new ae(i.maximumFee.toString()),u=a.sub(o).gt(c)?o.add(c):a,d=un(u.mul(new ae(i.transferFeeBasisPoints)),new ae(ft)),l=d.gt(r)?r:d;return{amount:u,fee:l,expirationTime:s}}}import Lr from"bn.js";var Ge=new Lr(1e6);import{MINT_SIZE as ec,TOKEN_PROGRAM_ID as tc,getTransferFeeConfig as nc,unpackMint as ic}from"@solana/spl-token";var mn=se("Raydium_accountInfo_util");async function bt(o,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:r=100}=V({batchRequest:!1},t),s=an(e,r),a=new Array(s.length).fill([]);if(n){let c=s.map(l=>{let w=o._buildArgs([l.map(g=>g.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:w}}),u=an(c,10);a=(await(await Promise.all(u.map(async l=>await o._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&mn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(w=>{if(w){let{data:g,executable:m,lamports:f,owner:y,rentEpoch:T}=w;return g.length!==2&&g[1]!=="base64"&&mn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(g[0],"base64"),executable:m,lamports:f,owner:new Fr(y),rentEpoch:T}}return null})))}else try{a=await Promise.all(s.map(c=>o.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&mn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Ce(o,e,t){let n=await bt(o,e.map(i=>i.pubkey),t);return e.map((i,r)=>X(V({},i),{accountInfo:n[r]}))}async function pn({connection:o,address:e,cluster:t="mainnet"}){let n=await bt(o,[...new Set(e.map(r=>r.toString()))].map(r=>new dn(r))),i={};for(let r=0;r<e.length;r++){let s=n[r],a=e[r];if(!s)continue;let c=new Je({key:a,state:Je.deserialize(s.data)});i[a.toString()]=c,t==="devnet"?Ye[a.toString()]=c:Ot[a.toString()]=c}return i}var Ot={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Je({key:new dn("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Je.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Ye={},fn=async o=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Ye[e])return Ye;let t=new dn(e),n=await o.getAccountInfo(t);return n&&(Ye[e]=new Je({key:t,state:Je.deserialize(n.data)})),Ye};var Et=2e3,vt=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Or.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Ft(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Mr.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new $e(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Ve.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:r=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...r),this.lookupTableAddress.push(...s.filter(a=>a!==$e.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(V({},t||{})):this.build(t)}build(e){var n;let t=new yt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var d;let{recentBlockHash:r,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=i||{},u=r!=null?r:await Qe(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),_e([t]),(d=this.owner)!=null&&d.isKeyPair)return{txId:a?await bn(this.connection,t,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);if(this.signers.length)for(let w of l)try{w.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),r=t.filter(d=>d.transaction.instructions.length>0),s=[i,...r.map(d=>d.transaction)],a=[this.signers,...r.map(d=>d.signers)],c=[...this.instructionTypes,...r.map(d=>d.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(d=>{d.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async d=>{var T;let{sequentially:l,onTxUpdate:w,skipTxCount:g=0,recentBlockHash:m,skipPreflight:f=!0}=d||{},y=m!=null?m:await Qe(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(l){let P=[],x=0;for(let k of s){if(++x,x<=g)continue;let b=await bn(this.connection,k,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});P.push(b)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=y,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((k,b)=>(k.recentBlockhash=y,a[b].length&&k.sign(...a[b]),k));_e(P);let x=await this.signAllTransactions(P);if(l){let k=0,b=[],A=async()=>{if(!x[k])return;let S=await this.connection.sendRawTransaction(x[k].serialize(),{skipPreflight:f});b.push({txId:S,status:"sent",signedTx:x[k]}),w==null||w([...b]),k++;let B=!1,K=null,C=null,h=q=>{K!==null&&clearInterval(K),C!==null&&this.connection.removeSignatureListener(C);let _=b.findIndex(M=>M.txId===S);if(_>-1){if(b[_].status==="error"||b[_].status==="success")return;b[_].status=q.err?"error":"success"}w==null||w([...b]),q.err||A()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var q;if(B){clearInterval(K);return}try{let _=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(B=!0,clearInterval(K),h({err:((q=_.meta)==null?void 0:q.err)||null}),console.log("tx status from getTransaction:",S))}catch(_){B=!0,clearInterval(K),console.error("getTransaction timeout:",_,S)}},Et)),C=this.connection.onSignature(S,q=>{if(B){this.connection.removeSignatureListener(C);return}B=!0,h(q)},"confirmed"),this.connection.getSignatureStatus(S)};return await A(),{txIds:b.map(S=>S.txId),signedTxs:x}}else{let k=[];for(let b=0;b<x.length;b+=1){let A=await this.connection.sendRawTransaction(x[b].serialize(),{skipPreflight:f});k.push(A)}return{txIds:k,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let m=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:r}=m,s=We(m,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=V(V({},this.cluster==="devnet"?await fn(this.connection):Ot),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new $e(y));let d=await pn({connection:this.connection,address:u});for(let[y,T]of Object.entries(d))a[y]=T;let l=i?$e.default.toBase58():r!=null?r:await Qe(this.connection,this.blockhashCommitment),w=new gt({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let g=new Pt(w);return g.sign(this.signers),{builder:this,transaction:g,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var k;let{skipPreflight:T=!0,sendAndConfirm:P,notSendToRpc:x}=y||{};if(_e([g]),(k=this.owner)!=null&&k.isKeyPair){let b=await this.connection.sendTransaction(g,{skipPreflight:T});return P&&await Mt(this.connection,b),{txId:b,signedTx:g}}if(this.signAllTransactions){let b=await this.signAllTransactions([g]);if(this.signers.length)for(let A of b)try{A.sign(this.signers)}catch{}return{txId:x?"":await this.connection.sendTransaction(b[0],{skipPreflight:T}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),r=t.filter(d=>d.builder.instructions.length>0),s=[i,...r.map(d=>d.transaction)],a=[this.signers,...r.map(d=>d.signers)],c=[...this.instructionTypes,...r.map(d=>d.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(d=>{d.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(d,l)=>{d.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async d=>{var f;let{sequentially:l,onTxUpdate:w,recentBlockHash:g,skipPreflight:m=!0}=d||{};if(g&&s.forEach(y=>y.message.recentBlockhash=g),_e(s),(f=this.owner)!=null&&f.isKeyPair){if(l){let y=[];for(let T of s){let P=await this.connection.sendTransaction(T,{skipPreflight:m});await Mt(this.connection,P),y.push(P)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:m}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(l){let T=0,P=[],x=async()=>{if(!y[T])return;let k=await this.connection.sendTransaction(y[T],{skipPreflight:m});P.push({txId:k,status:"sent",signedTx:y[T]}),w==null||w([...P]),T++;let b=!1,A=null,S=null,B=K=>{A!==null&&clearInterval(A),S!==null&&this.connection.removeSignatureListener(S);let C=P.findIndex(h=>h.txId===k);if(C>-1){if(P[C].status==="error"||P[C].status==="success")return;P[C].status=K.err?"error":"success"}w==null||w([...P]),K.err||x()};this.loopMultiTxStatus&&(A=setInterval(async()=>{var K;if(b){clearInterval(A);return}try{let C=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(b=!0,clearInterval(A),B({err:((K=C.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",k))}catch(C){b=!0,clearInterval(A),console.error("getTransaction timeout:",C,k)}},Et)),S=this.connection.onSignature(k,K=>{if(b){this.connection.removeSignatureListener(S);return}b=!0,B(K)},"confirmed"),this.connection.getSignatureStatus(k)};return x(),{txIds:[],signedTxs:y}}else{let T=[];for(let P=0;P<y.length;P+=1){let x=await this.connection.sendTransaction(y[P],{skipPreflight:m});T.push(x)}return{txIds:T,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var w;let l=e||{},{splitIns:t=[],computeBudgetConfig:n}=l,i=We(l,["splitIns","computeBudgetConfig"]),r=n?Ft(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((g,m)=>X(V({},g),{[m.publicKey.toBase58()]:m}),{}),a=[],c=[],u=[],d=0;if(this.allInstructions.forEach(g=>{let m=[...u,g],f=n?[...r.instructions,...m]:m,T=[...new Set(m.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>new $e(P));if(g!==t[d]&&u.length<12&&(dt({instructions:f,payer:this.feePayer,signers:T})||dt({instructions:m,payer:this.feePayer,signers:T})))u.push(g);else{if(u.length===0)throw Error("item ins too big");d+=g===t[d]?1:0,dt({instructions:n?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:T})?a.push(new yt().add(...r.instructions,...u)):a.push(new yt().add(...u)),c.push(Array.from(new Set(u.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(P=>s[P]).filter(P=>P!==void 0)),u=[g]}}),u.length>0){let m=[...new Set(u.map(f=>f.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);dt({instructions:n?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(f=>f.publicKey)})?a.push(new yt().add(...r.instructions,...u)):a.push(new yt().add(...u)),c.push(m)}return a.forEach(g=>g.feePayer=this.feePayer),(w=this.owner)!=null&&w.signer&&c.forEach(g=>{g.some(m=>m.publicKey.equals(this.owner.publicKey))||g.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async g=>{var k;let{sequentially:m,onTxUpdate:f,skipTxCount:y=0,recentBlockHash:T,skipPreflight:P=!0}=g||{},x=T!=null?T:await Qe(this.connection,this.blockhashCommitment);if(a.forEach(async(b,A)=>{b.recentBlockhash=x,c[A].length&&b.sign(...c[A])}),_e(a),(k=this.owner)!=null&&k.isKeyPair){if(m){let b=0,A=[];for(let S of a){if(++b,b<=y){A.push("tx skipped");continue}let B=await bn(this.connection,S,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:P});A.push(B)}return{txIds:A,signedTxs:a}}return{txIds:await Promise.all(a.map(async b=>await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:P}))),signedTxs:a}}if(this.signAllTransactions){let b=await this.signAllTransactions(a.slice(y,a.length)),A=[...a.slice(0,y),...b];if(m){let S=0,B=[],K=async()=>{if(!A[S])return;S<y&&(B.push({txId:"",status:"success",signedTx:A[S]}),f==null||f([...B]),S++,K());let C=await this.connection.sendRawTransaction(A[S].serialize(),{skipPreflight:P});B.push({txId:C,status:"sent",signedTx:A[S]}),f==null||f([...B]),S++;let h=!1,q=null,_=null,M=I=>{q!==null&&clearInterval(q),_!==null&&this.connection.removeSignatureListener(_);let W=B.findIndex(H=>H.txId===C);if(W>-1){if(B[W].status==="error"||B[W].status==="success")return;B[W].status=I.err?"error":"success"}f==null||f([...B]),I.err||K()};this.loopMultiTxStatus&&(q=setInterval(async()=>{var I;if(h){clearInterval(q);return}try{let W=await this.connection.getTransaction(C,{commitment:"confirmed",maxSupportedTransactionVersion:0});W&&(h=!0,clearInterval(q),M({err:((I=W.meta)==null?void 0:I.err)||null}),console.log("tx status from getTransaction:",C))}catch(W){h=!0,clearInterval(q),console.error("getTransaction timeout:",W,C)}},Et)),_=this.connection.onSignature(C,I=>{if(h){this.connection.removeSignatureListener(_);return}h=!0,M(I)},"confirmed"),this.connection.getSignatureStatus(C)};return await K(),{txIds:B.map(C=>C.txId),signedTxs:A}}else{let S=[];for(let B=0;B<A.length;B+=1){let K=await this.connection.sendRawTransaction(A[B].serialize(),{skipPreflight:P});S.push(K)}return{txIds:S,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var x;let P=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:r=[]}=P,s=We(P,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=V(V({},this.cluster==="devnet"?await fn(this.connection):Ot),i),c=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let k of c)a[k]===void 0&&u.push(new $e(k));let d=await pn({connection:this.connection,address:u});for(let[k,b]of Object.entries(d))a[k]=b;let l=t?Ft(t):{instructions:[],instructionTypes:[]},w=await Qe(this.connection,this.blockhashCommitment),g=this.signers.reduce((k,b)=>X(V({},k),{[b.publicKey.toBase58()]:b}),{}),m=[],f=[],y=[],T=0;if(this.allInstructions.forEach(k=>{let b=[...y,k],A=t?[...l.instructions,...b]:b;if(k!==n[T]&&y.length<12&&(pt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||pt({instructions:b,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(k);else{if(y.length===0)throw Error("item ins too big");T+=k===n[T]?1:0;let S={};for(let B of[...new Set(c)])a[B]!==void 0&&(S[B]=a[B]);if(t&&pt({instructions:[...l.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:w})){let B=new gt({payerKey:this.feePayer,recentBlockhash:w,instructions:[...l.instructions,...y]}).compileToV0Message(Object.values(a));m.push(new Pt(B))}else{let B=new gt({payerKey:this.feePayer,recentBlockhash:w,instructions:[...y]}).compileToV0Message(Object.values(a));m.push(new Pt(B))}f.push(Array.from(new Set(y.map(B=>B.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(B=>g[B]).filter(B=>B!==void 0)),y=[k]}}),y.length>0){let b=[...new Set(y.map(A=>A.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(A=>g[A]).filter(A=>A!==void 0);if(t&&pt({instructions:[...l.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:w})){let A=new gt({payerKey:this.feePayer,recentBlockhash:w,instructions:[...l.instructions,...y]}).compileToV0Message(Object.values(a));m.push(new Pt(A))}else{let A=new gt({payerKey:this.feePayer,recentBlockhash:w,instructions:[...y]}).compileToV0Message(Object.values(a));m.push(new Pt(A))}f.push(b)}return(x=this.owner)!=null&&x.signer&&f.forEach(k=>{k.some(b=>b.publicKey.equals(this.owner.publicKey))||k.push(this.owner.signer)}),m.forEach((k,b)=>{k.sign(f[b])}),{builder:this,transactions:m,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async k=>{var C;let{sequentially:b,onTxUpdate:A,skipTxCount:S=0,recentBlockHash:B,skipPreflight:K=!0}=k||{};if(m.map(async(h,q)=>{f[q].length&&h.sign(f[q]),B&&(h.message.recentBlockhash=B)}),_e(m),(C=this.owner)!=null&&C.isKeyPair){if(b){let h=0,q=[];for(let _ of m){if(++h,h<=S){console.log("skip tx: ",h),q.push("tx skipped");continue}let M=await this.connection.sendTransaction(_,{skipPreflight:K});await Mt(this.connection,M),q.push(M)}return{txIds:q,signedTxs:m}}return{txIds:await Promise.all(m.map(async h=>await this.connection.sendTransaction(h,{skipPreflight:K}))),signedTxs:m}}if(this.signAllTransactions){let h=await this.signAllTransactions(m.slice(S,m.length)),q=[...m.slice(0,S),...h];if(b){let _=0,M=[],I=async()=>{if(!q[_])return;if(_<S){M.push({txId:"",status:"success",signedTx:q[_]}),A==null||A([...M]),_++,I();return}let W=await this.connection.sendTransaction(q[_],{skipPreflight:K});M.push({txId:W,status:"sent",signedTx:q[_]}),A==null||A([...M]),_++;let H=!1,j=null,z=null,ee=ne=>{j!==null&&clearInterval(j),z!==null&&this.connection.removeSignatureListener(z);let J=M.findIndex(te=>te.txId===W);if(J>-1){if(M[J].status==="error"||M[J].status==="success")return;M[J].status=ne.err?"error":"success"}A==null||A([...M]),ne.err||I()};this.loopMultiTxStatus&&(j=setInterval(async()=>{var ne;if(H){clearInterval(j);return}try{let J=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});J&&(H=!0,clearInterval(j),ee({err:((ne=J.meta)==null?void 0:ne.err)||null}),console.log("tx status from getTransaction:",W))}catch(J){H=!0,clearInterval(j),console.error("getTransaction timeout:",J,W)}},Et)),z=this.connection.onSignature(W,ne=>{if(H){this.connection.removeSignatureListener(z);return}H=!0,ee(ne)},"confirmed"),this.connection.getSignatureStatus(W)};return I(),{txIds:[],signedTxs:q}}else{let _=[];for(let M=0;M<q.length;M+=1){let I=await this.connection.sendTransaction(q[M],{skipPreflight:K});_.push(I)}return{txIds:_,signedTxs:q}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var yn=(...o)=>o.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),et=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=se(t)}createTxBuilder(e){return this.scope.checkOwner(),new vt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(yn(e))}logInfo(...e){this.logger.info(yn(e))}logAndCreateError(...e){let t=yn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as dp}from"@solana/web3.js";import fp from"bn.js";import yp from"decimal.js";import{AccountLayout as Ap,createAssociatedTokenAccountIdempotentInstruction as wp,TOKEN_2022_PROGRAM_ID as kp,TOKEN_PROGRAM_ID as Tp}from"@solana/spl-token";import{PublicKey as Sc}from"@solana/web3.js";import{MintLayout as Cc,TOKEN_PROGRAM_ID as Rc}from"@solana/spl-token";import{Keypair as Ed,PublicKey as vd,SystemProgram as Wd,TransactionInstruction as Vd}from"@solana/web3.js";import qd from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Xd,TOKEN_2022_PROGRAM_ID as zd,TOKEN_PROGRAM_ID as Hd}from"@solana/spl-token";import{PublicKey as zr}from"@solana/web3.js";import Ai,{isBN as wi}from"bn.js";import{bits as Dc,BitStructure as Wc,blob as Er,Blob as Vc,cstr as _c,f32 as qc,f32be as Gc,f64 as Uc,f64be as Xc,greedy as zc,Layout as vr,ns64 as Hc,ns64be as jc,nu64 as Zc,nu64be as Qc,offset as Dr,s16 as Yc,s16be as Jc,s24 as $c,s24be as el,s32 as Wr,s32be as tl,s40 as nl,s40be as il,s48 as rl,s48be as ol,s8 as sl,seq as Vr,struct as al,Structure as _r,u16 as qr,u16be as ul,u24 as cl,u24be as ll,u32 as Gr,u32be as ml,u40 as dl,u40be as pl,u48 as fl,u48be as bl,u8 as Ur,UInt as Xr,union as yl,Union as gl,unionLayoutDiscriminator as Pl,utf8 as Al}from"@solana/buffer-layout";var gn=vr,fi=_r;var Pn=Xr;var bi=Ur,Ne=qr;var yi=Gr;var Re=Wr;var gi=Vr;var ce=Er;var Pi=Dr;var tt=class extends gn{constructor(t,n,i){super(t,i);this.blob=ce(t),this.signed=n}decode(t,n=0){let i=new Ai(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Ai(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function E(o){return new Pn(1,o)}function it(o){return new Pn(4,o)}function p(o){return new tt(8,!1,o)}function Y(o){return new tt(16,!1,o)}function ki(o){return new tt(8,!0,o)}function Ti(o){return new tt(16,!0,o)}var nt=class extends gn{constructor(t,n,i,r){super(t.span,r);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function F(o){return new nt(ce(32),e=>new zr(e),e=>e.toBuffer(),o)}function wn(o){return new nt(bi(),Hr,jr,o)}function Hr(o){if(o===0)return!1;if(o===1)return!0;throw new Error("Invalid bool: "+o)}function jr(o){return o?1:0}function Zr(o){let e=yi("length"),t=v([e,ce(Pi(e,-e.span),"data")]);return new nt(t,({data:n})=>n,n=>({data:n}),o)}function le(o){return new nt(Zr(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),o)}var An=class extends fi{decode(e,t){return super.decode(e,t)}};function v(o,e,t){return new An(o,e,t)}function G(o,e,t){let n,i=typeof e=="number"?e:wi(e)?e.toNumber():new Proxy(e,{get(r,s){if(!n){let a=Reflect.get(r,"count");n=wi(a)?a.toNumber():a,Reflect.set(r,"count",n)}return Reflect.get(r,s)},set(r,s,a){return s==="count"&&(n=a),Reflect.set(r,s,a)}});return gi(o,i,t)}import bd from"bn.js";import gd from"decimal.js";import ye from"bn.js";var kn=new ye(0),Bi=new ye(1),hi=new ye(-1),Se=new ye(1).shln(64),xi=new ye(1).shln(128),Tn=Se.sub(Bi);var Qr=xi.subn(1),rt=-443636,At=-rt,Bn=new ye("4295048016"),hn=new ye("79226673521066979257578248091"),Rl=new ye("4295048017"),Ll=new ye("79226673521066979257578248090");var Yr=new ye(10).pow(new ye(6));var Fl=new ye("18446744073700000000");import ed from"bn.js";import nd from"decimal.js";var Wl=Buffer.from("amm_config","utf8"),Ii=Buffer.from("pool","utf8"),Si=Buffer.from("pool_vault","utf8"),Vl=Buffer.from("pool_reward_vault","utf8"),_l=Buffer.from("position","utf8"),ql=Buffer.from("tick_array","utf8"),Gl=Buffer.from("operation","utf8"),Ul=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Xl=Buffer.from("observation","utf8");function xn(o){return ue([Buffer.from("metadata","utf8"),Ze.toBuffer(),o.toBuffer()],Ze)}var zl=Buffer.from("locked_position","utf8");var Hl=Buffer.from("support_mint","utf8");import{PublicKey as Sm}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Cm}from"@solana/spl-token";import Rm from"bn.js";import Fm from"decimal.js";import Ql from"bn.js";import Jl from"decimal.js";var Kn=14;var Dt=60;var no=v([ce(8),E("bump"),Ne("index"),F(""),it("protocolFeeRate"),it("tradeFeeRate"),Ne("tickSpacing"),G(p(),8,"")]),io=v([it("blockTimestamp"),ki("tickCumulative"),G(p(),4)]),vi=v([ce(8),wn("initialized"),p("recentEpoch"),Ne("observationIndex"),F("poolId"),G(io,100,"observations"),G(p(),4)]),ro=v([E("rewardState"),p("openTime"),p("endTime"),p("lastUpdateTime"),Y("emissionsPerSecondX64"),p("rewardTotalEmissioned"),p("rewardClaimed"),F("tokenMint"),F("tokenVault"),F("creator"),Y("rewardGrowthGlobalX64")]),Mi=v([ce(8),E("bump"),F("ammConfig"),F("creator"),F("mintA"),F("mintB"),F("vaultA"),F("vaultB"),F("observationId"),E("mintDecimalsA"),E("mintDecimalsB"),Ne("tickSpacing"),Y("liquidity"),Y("sqrtPriceX64"),Re("tickCurrent"),it(),Y("feeGrowthGlobalX64A"),Y("feeGrowthGlobalX64B"),p("protocolFeesTokenA"),p("protocolFeesTokenB"),Y("swapInAmountTokenA"),Y("swapOutAmountTokenB"),Y("swapInAmountTokenB"),Y("swapOutAmountTokenA"),E("status"),G(E(),7,""),G(ro,3,"rewardInfos"),G(p(),16,"tickArrayBitmap"),p("totalFeesTokenA"),p("totalFeesClaimedTokenA"),p("totalFeesTokenB"),p("totalFeesClaimedTokenB"),p("fundFeesTokenA"),p("fundFeesTokenB"),p("startTime"),G(p(),15*4-3,"padding")]),oo=v([Y("growthInsideLastX64"),p("rewardAmountOwed")]),Oi=v([ce(8),E("bump"),F("nftMint"),F("poolId"),Re("tickLower"),Re("tickUpper"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),p("tokenFeesOwedA"),p("tokenFeesOwedB"),G(oo,3,"rewardInfos"),G(p(),8,"")]),Id=v([ce(8),E("bump"),F("poolId"),Re("tickLowerIndex"),Re("tickUpperIndex"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),p("tokenFeesOwedA"),p("tokenFeesOwedB"),G(Y(),3,"rewardGrowthInside"),G(p(),8,"")]),so=v([Re("tick"),Ti("liquidityNet"),Y("liquidityGross"),Y("feeGrowthOutsideX64A"),Y("feeGrowthOutsideX64B"),G(Y(),3,"rewardGrowthsOutsideX64"),G(it(),13,"")]),Ri=v([ce(8),F("poolId"),Re("startTickIndex"),G(so,Dt,"ticks"),E("initializedTickCount"),G(E(),115,"")]),ao=v([ce(329),G(F(),100,"whitelistMints")]),to=v([ce(8),F("poolId"),G(G(p(),8),Kn,"positiveTickArrayBitmap"),G(G(p(),8),Kn,"negativeTickArrayBitmap")]),Sd=v([p(),E("bump"),F("owner"),F("poolId"),F("positionId"),F("nftAccount"),G(p(),8)]),uo=v([ce(8),E("bump"),F("lockOwner"),F("poolId"),F("positionId"),F("nftAccount"),F("lockNftMint"),p("recentEpoch"),G(p(),8)]);vi.span;var np=se("Raydium_Clmm");var po=Buffer.from("vault_auth_seed","utf8"),uf=Buffer.from("global_config","utf8"),fo=Buffer.from("pool_vesting","utf8"),bo=Buffer.from("platform_config","utf8"),yo=Buffer.from("platform_fee_vault_auth_seed","utf8"),go=Buffer.from("creator_fee_vault_auth_seed","utf8");function Ke(o){return ue([po],o)}function ot(o,e,t){return ue([Ii,e.toBuffer(),t.toBuffer()],o)}function Cn(o,e,t){return ue([Si,e.toBuffer(),t.toBuffer()],o)}function Ue(o){return ue([Buffer.from("__event_authority","utf8")],o)}function Nn(o,e){return ue([bo,e.toBuffer()],o)}function Tt(o,e,t){return ue([fo,e.toBuffer(),t.toBuffer()],o)}function Xe(o,e,t){return ue([e.toBuffer(),t.toBuffer()],o)}function Rn(o){return ue([yo],o)}function st(o,e,t){return ue([e.toBuffer(),t.toBuffer()],o)}function Di(o){return ue([go],o)}import{SystemProgram as ge,TransactionInstruction as de}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Wt,TOKEN_2022_PROGRAM_ID as Po,TOKEN_PROGRAM_ID as Ln}from"@solana/spl-token";import Bt from"bn.js";var pe={initialize:Buffer.from([175,175,109,31,13,152,155,237]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252])};function Wi(o,e,t,n,i,r,s,a,c,u,d,l,w,g,m,f,y,T,P,x){let k=v([E("decimals"),le("name"),le("symbol"),le("uri")]),b=v([p("totalLockedAmount"),p("cliffPeriod"),p("unlockPeriod")]),A=v([E("index"),p("supply"),p("totalFundRaisingB"),E("migrateType")]),S=v([E("index"),p("supply"),p("totalSellA"),p("totalFundRaisingB"),E("migrateType")]),B=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Ln,isSigner:!1,isWritable:!1},{pubkey:Ln,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:Ue(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],K=Buffer.alloc(Buffer.from(g,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(f,"utf-8").length+4*3+1),C=Buffer.alloc(b.span),h=Buffer.alloc(y.type==="ConstantCurve"?S.span:A.span);return k.encode({decimals:w,name:g,symbol:m,uri:f},K),y.type==="ConstantCurve"?S.encode(X(V({index:0},y),{migrateType:y.migrateType==="amm"?0:1}),h):y.type==="FixedCurve"?A.encode(X(V({index:1},y),{migrateType:y.migrateType==="amm"?0:1}),h):y.type==="LinearCurve"&&A.encode(X(V({index:2},y),{migrateType:y.migrateType==="amm"?0:1}),h),b.encode({totalLockedAmount:T,cliffPeriod:P,unlockPeriod:x},C),new de({keys:B,programId:o,data:Buffer.from([...pe.initialize,...K,...h,...C])})}function Vi(o,e,t,n,i,r,s,a,c,u,d,l,w,g,m,f,y,T,P,x){let k=v([E("decimals"),le("name"),le("symbol"),le("uri")]),b=v([p("totalLockedAmount"),p("cliffPeriod"),p("unlockPeriod"),E("transferFeeExtensionParamsOption"),v([Ne("transferFeeBasePoints"),p("maxinumFee")]).replicate("transferFeeExtensionParams")]),A=v([E("index"),p("supply"),p("totalFundRaisingB"),E("migrateType")]),S=v([E("index"),p("supply"),p("totalSellA"),p("totalFundRaisingB"),E("migrateType")]),B=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Po,isSigner:!1,isWritable:!1},{pubkey:Ln,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:Ue(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}],K=Buffer.alloc(Buffer.from(w,"utf-8").length+Buffer.from(g,"utf-8").length+Buffer.from(m,"utf-8").length+4*3+1),C=Buffer.alloc(b.span),h=Buffer.alloc(f.type==="ConstantCurve"?S.span:A.span);return k.encode({decimals:l,name:w,symbol:g,uri:m},K),f.type==="ConstantCurve"?S.encode(X(V({index:0},f),{migrateType:f.migrateType==="amm"?0:1}),h):f.type==="FixedCurve"?A.encode(X(V({index:1},f),{migrateType:f.migrateType==="amm"?0:1}),h):f.type==="LinearCurve"&&A.encode(X(V({index:2},f),{migrateType:f.migrateType==="amm"?0:1}),h),b.encode({totalLockedAmount:y,cliffPeriod:T,unlockPeriod:P,transferFeeExtensionParamsOption:x?1:0,transferFeeExtensionParams:x!=null?x:{transferFeeBasePoints:0,maxinumFee:new Bt(0)}},C),new de({keys:B,programId:o,data:Buffer.from([...pe.initializeWithToken2022,...K,...h,...C])})}function _i(o,e,t,n,i,r,s,a,c,u,d,l,w,g,m,f,y,T,P,x){let k=v([p("amountB"),p("minAmountA"),p("shareFeeRate")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:Ue(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];x&&b.push({pubkey:x,isSigner:!1,isWritable:!0}),b.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),b.push({pubkey:m,isSigner:!1,isWritable:!0}),b.push({pubkey:f,isSigner:!1,isWritable:!0});let A=Buffer.alloc(k.span);return k.encode({amountB:y,minAmountA:T,shareFeeRate:P!=null?P:new Bt(0)},A),new de({keys:b,programId:o,data:Buffer.from([...pe.buyExactIn,...A])})}function qi(o,e,t,n,i,r,s,a,c,u,d,l,w,g,m,f,y,T,P,x){let k=v([p("amountA"),p("maxAmountB"),p("shareFeeRate")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:Ue(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];x&&b.push({pubkey:x,isSigner:!1,isWritable:!0}),b.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),b.push({pubkey:m,isSigner:!1,isWritable:!0}),b.push({pubkey:f,isSigner:!1,isWritable:!0});let A=Buffer.alloc(k.span);return k.encode({amountA:y,maxAmountB:T,shareFeeRate:P!=null?P:new Bt(0)},A),new de({keys:b,programId:o,data:Buffer.from([...pe.buyExactOut,...A])})}function Gi(o,e,t,n,i,r,s,a,c,u,d,l,w,g,m,f,y,T,P,x){let k=v([p("amountA"),p("minAmountB"),p("shareFeeRate")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:Ue(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];x&&b.push({pubkey:x,isSigner:!1,isWritable:!0}),b.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),b.push({pubkey:m,isSigner:!1,isWritable:!0}),b.push({pubkey:f,isSigner:!1,isWritable:!0});let A=Buffer.alloc(k.span);return k.encode({amountA:y,minAmountB:T,shareFeeRate:P!=null?P:new Bt(0)},A),new de({keys:b,programId:o,data:Buffer.from([...pe.sellExactIn,...A])})}function Ui(o,e,t,n,i,r,s,a,c,u,d,l,w,g,m,f,y,T,P,x){let k=v([p("amountB"),p("maxAmountA"),p("shareFeeRate")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:Ue(o).publicKey,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];x&&b.push({pubkey:x,isSigner:!1,isWritable:!0}),b.push({pubkey:ge.programId,isSigner:!1,isWritable:!1}),b.push({pubkey:m,isSigner:!1,isWritable:!0}),b.push({pubkey:f,isSigner:!1,isWritable:!0});let A=Buffer.alloc(k.span);return k.encode({amountB:y,maxAmountA:T,shareFeeRate:P!=null?P:new Bt(0)},A),new de({keys:b,programId:o,data:Buffer.from([...pe.sellExactOut,...A])})}function Fn(o,e,t,n,i,r,s,a,c){let u=v([]),d=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);return u.encode({},l),new de({keys:d,programId:o,data:Buffer.from([...pe.claimVestedToken,...l])})}function Mn(o,e,t,n,i,r){let s=v([p("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:ge.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:r},c),new de({keys:a,programId:o,data:Buffer.from([...pe.createVestingAccount,...c])})}function On(o,e,t,n,i,r,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:ge.programId,isSigner:!1,isWritable:!0},{pubkey:Wt,isSigner:!1,isWritable:!0}];return new de({keys:u,programId:o,data:pe.claimPlatformFee})}function Xi(o,e,t,n,i,r,s,a,c,u,d,l,w){let g=v([p("platformScale"),p("creatorScale"),p("burnScale"),p("feeRate"),le("name"),le("web"),le("img"),p("creatorFeeRate")]),m=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],f=Buffer.alloc(8*5+Buffer.from(d,"utf-8").length+Buffer.from(l,"utf-8").length+Buffer.from(w,"utf-8").length+4*3);return g.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:c,name:d,web:l,img:w,creatorFeeRate:u},f),new de({keys:m,programId:o,data:Buffer.from([...pe.createPlatformConfig,...f])})}function zi(o,e,t,n){let i=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],r;if(n.type==="updateClaimFeeWallet"){let s=v([E("index"),F("value")]);r=Buffer.alloc(s.span),s.encode({index:0,value:n.value},r)}else if(n.type==="updateLockNftWallet"){let s=v([E("index"),F("value")]);r=Buffer.alloc(s.span),s.encode({index:1,value:n.value},r)}else if(n.type==="migrateCpLockNftScale"){let s=v([E("index"),p("platformScale"),p("creatorScale"),p("burnScale")]);r=Buffer.alloc(s.span),s.encode(V({index:2},n.value),r)}else if(n.type==="updateFeeRate"){let s=v([E("index"),p("value")]);r=Buffer.alloc(s.span),s.encode({index:3,value:n.value},r)}else if(n.type==="updateImg"||n.type==="updateName"||n.type==="updateWeb"){let s=v([E("index"),le("value")]);r=Buffer.alloc(Buffer.from(n.value,"utf-8").length+4+1*1),n.type==="updateName"?s.encode({index:4,value:n.value},r):n.type==="updateWeb"?s.encode({index:5,value:n.value},r):n.type==="updateImg"&&s.encode({index:6,value:n.value},r)}else if(n.type==="updateCpConfigId"){i.push({pubkey:n.value,isSigner:!1,isWritable:!1});let s=v([E("index")]);r=Buffer.alloc(s.span),s.encode({index:7},r)}else if(n.type==="updateAll"){i.push({pubkey:n.value.cpConfigId,isSigner:!1,isWritable:!1});let s=v([E("index"),F("platformClaimFeeWallet"),F("platformLockNftWallet"),p("platformScale"),p("creatorScale"),p("burnScale"),p("feeRate"),le("name"),le("web"),le("img"),F("transferFeeExtensionAuth"),p("creatorFeeRate")]);r=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(n.value.name,"utf-8").length+Buffer.from(n.value.web,"utf-8").length+Buffer.from(n.value.img,"utf-8").length),s.encode({index:8,platformClaimFeeWallet:n.value.platformClaimFeeWallet,platformLockNftWallet:n.value.platformLockNftWallet,platformScale:n.value.migrateCpLockNftScale.platformScale,creatorScale:n.value.migrateCpLockNftScale.creatorScale,burnScale:n.value.migrateCpLockNftScale.burnScale,feeRate:n.value.feeRate,name:n.value.name,web:n.value.web,img:n.value.img,transferFeeExtensionAuth:n.value.transferFeeExtensionAuth,creatorFeeRate:n.value.creatorFeeRate},r)}else throw Error("updateInfo params type error");return new de({keys:i,programId:o,data:Buffer.from([...pe.updatePlaformConfig,...r])})}function En(o,e,t,n,i,r,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1}];return new de({keys:c,programId:o,data:pe.claimPlatformFeeFromVault})}function Hi(o,e,t,n,i,r,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ge.programId,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1}];return new de({keys:a,programId:o,data:pe.claimCreatorFee})}import{NATIVE_MINT as Le,TOKEN_2022_PROGRAM_ID as Fe,TOKEN_PROGRAM_ID as $,createAssociatedTokenAccountIdempotentInstruction as we,getTransferFeeConfig as Xt,unpackMint as zt}from"@solana/spl-token";import O from"bn.js";import{PublicKey as Qi}from"@solana/web3.js";var Ee=v([p(),p("epoch"),E("curveType"),Ne("index"),p("migrateFee"),p("tradeFeeRate"),p("maxShareFeeRate"),p("minSupplyA"),p("maxLockRate"),p("minSellRateA"),p("minMigrateRateA"),p("minFundRaisingB"),F("mintB"),F("protocolFeeOwner"),F("migrateFeeOwner"),F("migrateToAmmWallet"),F("migrateToCpmmWallet"),G(p(),16)]),Ao=v([p("totalLockedAmount"),p("cliffPeriod"),p("unlockPeriod"),p("startTime"),p("totalAllocatedShare")]),Be=v([p(),p("epoch"),E("bump"),E("status"),E("mintDecimalsA"),E("mintDecimalsB"),E("migrateType"),p("supply"),p("totalSellA"),p("virtualA"),p("virtualB"),p("realA"),p("realB"),p("totalFundRaisingB"),p("protocolFee"),p("platformFee"),p("migrateFee"),Ao.replicate("vestingSchedule"),F("configId"),F("platformId"),F("mintA"),F("mintB"),F("vaultA"),F("vaultB"),F("creator"),E("mintProgramFlag"),G(E(),63)]),wf=v([p(),p("epoch"),F("poolId"),F("beneficiary"),p("claimedAmount"),p("tokenShareAmount"),G(p(),8)]),at=v([p(),p("epoch"),F("platformClaimFeeWallet"),F("platformLockNftWallet"),p("platformScale"),p("creatorScale"),p("burnScale"),p("feeRate"),G(E(),64,"name"),G(E(),256,"web"),G(E(),256,"img"),F("cpConfigId"),p("creatorFeeRate"),F("transferFeeExtensionAuth"),G(E(),184)]);import Pe from"bn.js";import Zi from"decimal.js";import Vt from"bn.js";import ht from"decimal.js";var ve=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var _t=class extends ve{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new ht(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new ht(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new ht(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new ht(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new ht(e.virtualB.add(e.realB.add(r)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new Vt(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(r);if(a.lte(new Vt(0)))throw Error("tfMinusMf <= 0");let c=a.mul(n).mul(n).div(s),u=a.mul(n).div(s).sub(t),d=c.div(u),l=t.mul(t).div(u);if(d.lt(new Vt(0))||l.lt(new Vt(0)))throw Error("invalid input 0");return{a:d,b:l,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),r=t.add(e);return i.div(r)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),r=n.sub(e);return qe(i,r)}};import qt from"bn.js";import xt from"decimal.js";var Gt=class extends ve{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new xt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new xt(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new xt(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new xt(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new xt(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new qt(0)))throw Error("invalid input 1");let a=new qt(2).mul(t).sub(r),u=t.mul(s).div(a);if(u.lt(new qt(0))||t.lt(new qt(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return qe(i,n)}};import me from"bn.js";import ze from"decimal.js";import ji from"bn.js";import vn from"decimal.js";var It=class{static _multipler(e){return new vn(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new vn(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new ji(i.mul(this._Q64).toFixed(0))}};It._Q64=new vn(new ji(1).shln(64).toString());var Ut=class extends ve{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new ze(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new ze(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new ze(e.virtualA.mul(e.realA).toString()).div(It._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:r,decimalA:s,decimalB:a}){return new ze(i.sub(r).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),r=e.totalFundRaisingB.sub(e.realB);return new ze(e.virtualB.add(e.realB).add(r).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:r}){let s=e.sub(i);if(s.lte(new me(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new me(3)).sub(r),u=t.mul(new me(2)).mul(s).div(a),d=u.mul(u),l=t.mul(new me(2)).mul(Se).div(d);if(!l.gt(new me(0)))throw Error("a need gt 0");if(!Tn.gt(l))throw Error("a need lt u64 max");if(l.lt(new me(0))||u.lt(new me(0)))throw Error("invalid input 0");return{a:l,b:new me(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new me(2).mul(n).mul(Se).div(e.virtualA);return new me(new ze(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return qe(e.virtualA.mul(i),new me(2).mul(Se)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),r=qe(e.virtualA.mul(i),new me(2).mul(Se));return e.realB.sub(r)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new me(2).mul(n).mul(Se).div(e.virtualA),r=new me(new ze(i.toString()).sqrt().toFixed(0));return e.realA.sub(r)}};var Ae=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let d=this.getCurve(e),l=d.getInitParam({supply:n,totalFundRaising:i,totalSell:r,totalLockedAmount:s,migrateFee:a}),w=d.getPoolInitPriceByInit(X(V({},l),{decimalA:c,decimalB:u})),g=i.div(new Pe(t-1)),m=new Pe(0),f=[{price:w,totalSellSupply:0}],{a:y,b:T}=l,P=m,x=m;for(let k=1;k<t;k++){let b=k!==t-1?g:i.sub(x),A=this.buyExactIn({poolInfo:{virtualA:y,virtualB:T,realA:P,realB:x,totalFundRaisingB:i,totalSellA:r},amountB:b,protocolFeeRate:m,platformFeeRate:m,curveType:e,shareFeeRate:m,creatorFeeRate:m,transferFeeConfigA:void 0,slot:0});P=P.add(A.amountA.amount),x=x.add(A.amountB);let S=this.getPrice({poolInfo:{virtualA:y,virtualB:T,realA:P,realB:x},decimalA:c,decimalB:u,curveType:e});f.push({price:S,totalSellSupply:new Zi(P.toString()).div(10**c).toNumber()})}return f}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:r,config:s,migrateType:a}){if(Number(r)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(Ge).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new Pe(10**r))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(Ge);if(n.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let d=e.sub(n).sub(i),l=e.mul(s.minMigrateRateA).div(Ge);if(d.lt(l))throw Error("migrate lt min migrate amoount");let w=e.sub(n).sub(i),g=new Pe(new Zi(w.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let m=new Pe(10).pow(new Pe(r));if(g.lte(m))throw Error("check migrate lp error")}else if(a==="cpmm"){let m=new Pe(100);if(g.lte(m))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),l=this.calculateFee({amount:t,feeRate:d}),w=t.sub(l),g=this.getCurve(r),m=g.buyExactIn({poolInfo:e,amount:w}),f=e.totalSellA.sub(e.realA),y,T,P;if(m.gt(f)){y=f;let k=g.buyExactOut({poolInfo:e,amount:y});T=this.calculatePreFee({postFeeAmount:k,feeRate:d}),P=T.sub(k)}else y=m,T=t,P=l;let x=this.splitFee({totalFee:P,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:cn(y,c,u),amountB:T,splitFee:x}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=e.totalSellA.sub(e.realA),l=ln(t,c,u),w=l.fee?l.amount.add(l.fee):l.amount;t.gt(d)&&(w=d);let m=this.getCurve(r).buyExactOut({poolInfo:e,amount:w}),f=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),y=this.calculatePreFee({postFeeAmount:m,feeRate:f}),T=y.sub(m),P=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:l,amountB:y,splitFee:P}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=this.getCurve(r),l=cn(t,c,u),w=l.fee?l.amount.sub(l.fee):l.amount,g=d.sellExactIn({poolInfo:e,amount:w}),m=this.calculateFee({amount:g,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a})}),f=this.splitFee({totalFee:m,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:l,amountB:g.sub(m),splitFee:f}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:r,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let d=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),l=this.calculatePreFee({postFeeAmount:t,feeRate:d});if(e.realB.lt(l))throw Error("Insufficient liquidity");let w=l.sub(t),m=Ae.getCurve(r).sellExactOut({poolInfo:e,amount:l});if(m.gt(e.realA))throw Error();let f=this.splitFee({totalFee:w,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:ln(m,c,u),amountB:t,splitFee:f}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:r}),a=s.isZero()?new Pe(0):e.mul(n).div(s),c=s.isZero()?new Pe(0):e.mul(i).div(s),u=s.isZero()?new Pe(0):e.mul(r).div(s),d=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:d,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return oi(e,t,Ge)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul(Ge),i=Ge.sub(t);return n.add(i).sub(new Pe(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new Pe(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return _t;case 1:return Gt;case 2:return Ut}throw Error("find curve error")}};import fe from"decimal.js";var He={initPriceX64:new O("515752397214619"),supply:new O(1e15),totalSellA:new O(7931e11),totalFundRaisingB:new O(85e9),totalLockedAmount:new O("0"),cliffPeriod:new O("0"),unlockPeriod:new O("0"),decimals:6,virtualA:new O("1073471847374405"),virtualB:new O("30050573465"),realA:new O(0),realB:new O(0),protocolFee:new O(0),platformId:new Qi("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new O(0),cliffPeriod:new O(0),unlockPeriod:new O(0),startTime:new O(0),totalAllocatedShare:new O(0)}},De=new O(1e4),Dn=class extends et{constructor(e){super(e)}async sayHi(){console.log("hi")}async createLaunchpad(q){var _=q,{programId:e=ie,authProgramId:t,platformId:n=He.platformId,mintA:i,decimals:r=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:d,configId:l,snipers:w,configInfo:g,platformFeeRate:m,txVersion:f,computeBudgetConfig:y,txTipConfig:T,feePayer:P,buyAmount:x,minMintAAmount:k,slippage:b,associatedOnly:A=!0,checkCreateATAOwner:S=!1,extraSigners:B,token2022:K,transferFeeExtensionParams:C}=_,h=We(_,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","snipers","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams"]);var Wn,Vn,_n,qn,Gn,Un,Xn,zn,Hn,jn;let M=this.createTxBuilder(P);t=t!=null?t:Ke(e).publicKey,console.log("snipers: ",w),K=!!C,K&&(d="cpmm");let I=g;if(!I&&l){let he=await this.scope.connection.getAccountInfo(l);he&&(I=Ee.decode(he.data))}I||this.logAndCreateError("config not found");let W=I.mintB,H=I.curveType,{publicKey:j}=ot(e,i,W),{publicKey:z}=Cn(e,j,i),{publicKey:ee}=Cn(e,j,W),{publicKey:ne}=xn(i);this.logDebug(`create token: ${i.toBase58()}, mintB: ${W.toBase58()}, decimals A:${r}/B:${s}, config:${l.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let J=(Wn=h==null?void 0:h.supply)!=null?Wn:He.supply,te=(Vn=h==null?void 0:h.totalSellA)!=null?Vn:He.totalSellA,U=(_n=h==null?void 0:h.totalFundRaisingB)!=null?_n:He.totalFundRaisingB,D=(qn=h==null?void 0:h.totalLockedAmount)!=null?qn:new O(0),re=m;if(!m){let he=await this.scope.connection.getAccountInfo(n);he||this.logAndCreateError("platform id not found:",n.toString()),re=at.decode(he.data).feeRate}let je=Ae.getCurve(I.curveType).getInitParam({supply:J,totalFundRaising:U,totalSell:te,totalLockedAmount:D,migrateFee:I.migrateFee}),ke={epoch:new O(896),bump:254,status:0,mintDecimalsA:r,mintDecimalsB:s,supply:J,totalSellA:te,mintA:new Qi(i),mintB:W,virtualA:je.a,virtualB:je.b,realA:He.realA,realB:He.realB,migrateFee:I.migrateFee,migrateType:d==="amm"?0:1,protocolFee:He.protocolFee,platformFee:re,platformId:n,configId:l,vaultA:z,vaultB:ee,creator:this.scope.ownerPubKey,totalFundRaisingB:U,vestingSchedule:{totalLockedAmount:D,cliffPeriod:new O(0),unlockPeriod:new O(0),startTime:new O(0),totalAllocatedShare:new O(0)},mintProgramFlag:K?1:0},Yi=Ae.getCurve(I.curveType),{c:Ji}=Yi.getInitParam({supply:ke.supply,totalFundRaising:ke.totalFundRaisingB,totalLockedAmount:D,totalSell:I.curveType===0?ke.totalSellA:new O(0),migrateFee:I.migrateFee});try{Ae.checkParam({supply:ke.supply,totalFundRaising:ke.totalFundRaisingB,totalSell:Ji,totalLockedAmount:D,decimals:ke.mintDecimalsA,config:I,migrateType:d}),this.logDebug("check init params success")}catch(he){this.logAndCreateError(`check create mint params failed, ${he.message}`)}M.addInstruction({instructions:[K?Vi(e,P!=null?P:this.scope.ownerPubKey,this.scope.ownerPubKey,l,n,t,j,i,W,z,ee,r,a,c,u||"https://",{type:H===0?"ConstantCurve":H===1?"FixedCurve":H===2?"LinearCurve":"ConstantCurve",totalSellA:te,migrateType:d,supply:J,totalFundRaisingB:U},D,(Gn=h==null?void 0:h.cliffPeriod)!=null?Gn:new O(0),(Un=h==null?void 0:h.unlockPeriod)!=null?Un:new O(0),C):Wi(e,P!=null?P:this.scope.ownerPubKey,this.scope.ownerPubKey,l,n,t,j,i,W,z,ee,ne,r,a,c,u||"https://",{type:H===0?"ConstantCurve":H===1?"FixedCurve":H===2?"LinearCurve":"ConstantCurve",totalSellA:te,migrateType:d,supply:J,totalFundRaisingB:U},D,(Xn=h==null?void 0:h.cliffPeriod)!=null?Xn:new O(0),(zn=h==null?void 0:h.unlockPeriod)!=null?zn:new O(0))]});let Ht=K?await this.scope.connection.getEpochInfo():void 0,be=C?{epoch:BigInt((Ht==null?void 0:Ht.epoch)||0),maximumFee:BigInt((Hn=C==null?void 0:C.maxinumFee.toString())!=null?Hn:0),transferFeeBasisPoints:(jn=C==null?void 0:C.transferFeeBasePoints)!=null?jn:0}:void 0,jt={amountA:{amount:new O(0),fee:void 0,expirationTime:void 0},amountB:new O(0),splitFee:{platformFee:new O(0),shareFee:new O(0),protocolFee:new O(0),creatorFee:new O(0)}},Zt;if(B!=null&&B.length&&M.addInstruction({signers:B}),!h.createOnly){let{builder:he,extInfo:$i}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?Fe:void 0,mintA:i,mintB:W,poolInfo:ke,buyAmount:x,minMintAAmount:k,shareFeeRate:h.shareFeeRate,shareFeeReceiver:h.shareFeeReceiver,configInfo:I,platformFeeRate:re,slippage:b,associatedOnly:A,checkCreateATAOwner:S,skipCheckMintA:!be,transferFeeConfigA:be?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:be,newerTransferFee:be}:void 0}),{builder:wo,extInfo:ko}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?Fe:void 0,mintA:i,mintB:W,poolInfo:ke,buyAmount:x,minMintAAmount:k,shareFeeRate:h.shareFeeRate,shareFeeReceiver:h.shareFeeReceiver,configInfo:I,platformFeeRate:re,slippage:b,associatedOnly:A,checkCreateATAOwner:S,skipCheckMintA:!be,transferFeeConfigA:be?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:be,newerTransferFee:be}:void 0}),{builder:To,extInfo:Bo}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:K?Fe:void 0,mintA:i,mintB:W,poolInfo:ke,buyAmount:x,minMintAAmount:k,shareFeeRate:h.shareFeeRate,shareFeeReceiver:h.shareFeeReceiver,configInfo:I,platformFeeRate:re,slippage:b,associatedOnly:A,checkCreateATAOwner:S,skipCheckMintA:!be,transferFeeConfigA:be?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:be,newerTransferFee:be}:void 0});M.addInstruction(V({},he.AllTxData)),jt=V({},$i),Zt=(this.scope.cluster==="devnet"||f===1)&&h.shareFeeReceiver?[he.allInstructions[0]]:void 0}return M.addTipInstruction(T),f===0?M.sizeCheckBuildV0({computeBudgetConfig:y,swapInfo:jt,splitIns:Zt,address:X(V({},ke),{poolId:j})}):M.sizeCheckBuild({computeBudgetConfig:y,swapInfo:jt,splitIns:Zt,address:X(V({},ke),{poolId:j})})}async buyToken({programId:e=ie,authProgramId:t,mintA:n,mintAProgram:i=$,mintB:r=Le,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:d,txTipConfig:l,feePayer:w,buyAmount:g,minMintAAmount:m,slippage:f,shareFeeRate:y=new O(0),shareFeeReceiver:T,associatedOnly:P=!0,checkCreateATAOwner:x=!1,transferFeeConfigA:k,skipCheckMintA:b=!1}){var U,D,re;g.lte(new O(0))&&this.logAndCreateError("buy amount should gt 0:",g.toString());let A=this.createTxBuilder(w),{publicKey:S}=ot(e,n,r);t=t!=null?t:Ke(e).publicKey;let B=k;if(!b)if(B)i=Fe;else{let oe=await this.scope.connection.getAccountInfo(n);if(oe&&oe.owner.equals(Fe)){i=oe.owner;let je=zt(n,oe,i);B=Xt(je)||void 0}}let K=this.scope.account.getAssociatedTokenAccount(n,i),C=null,h=r.equals(Le);A.addInstruction({instructions:[we(this.scope.ownerPubKey,K,this.scope.ownerPubKey,n,i)]});let{account:q,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:h?{payer:this.scope.ownerPubKey,amount:g}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:P,checkCreateATAOwner:x});q&&(C=q),A.addInstruction(_||{}),C===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let M=s;if(!M){let oe=await this.scope.connection.getAccountInfo(S,{commitment:"processed"});oe||this.logAndCreateError("cannot found pool:",S.toBase58()),M=Be.decode(oe.data)}let I=a,W=await Ce(this.scope.connection,[I?void 0:M.configId,M.platformId].filter(Boolean).map(oe=>({pubkey:oe})));if(!I){let oe=W.find(je=>je.pubkey.equals(M.configId));(!oe||!oe.accountInfo)&&this.logAndCreateError("config not found: ",M.configId.toBase58()),I=Ee.decode(oe.accountInfo.data)}let H=W.find(oe=>oe.pubkey.equals(M.platformId));(!H||!H.accountInfo)&&this.logAndCreateError("platform info not found: ",M.configId.toBase58());let j=at.decode(H.accountInfo.data);c=c||j.feeRate;let z=Ae.buyExactIn({poolInfo:M,amountB:g,protocolFeeRate:I.tradeFeeRate,platformFeeRate:c,curveType:I.curveType,shareFeeRate:y,creatorFeeRate:j.creatorFeeRate,transferFeeConfigA:B,slot:await this.scope.connection.getSlot()}),ee=new fe(z.amountA.amount.toString()).sub((D=(U=z.amountA.fee)==null?void 0:U.toString())!=null?D:0),ne=f?new fe(De.sub(f).toNumber()/De.toNumber()).clampedTo(0,1):new fe(1),J=m!=null?m:f?new O(ee.mul(ne).toFixed(0)):z.amountA.amount.sub((re=z.amountA.fee)!=null?re:new O(0));z.amountB.lt(g)&&console.log(`maximum ${n.toBase58()} amount can buy is ${z.amountA.toString()}, input ${r.toBase58()} amount: ${z.amountB.toString()}`);let te=T?Te(T,r,$).publicKey:void 0;return te&&A.addInstruction({instructions:[we(this.scope.ownerPubKey,te,T,r)]}),A.addInstruction({instructions:[_i(e,this.scope.ownerPubKey,t,M.configId,M.platformId,S,K,C,M.vaultA,M.vaultB,n,r,i,$,Xe(e,M.platformId,r).publicKey,st(e,M.creator,r).publicKey,z.amountB.lt(g)?z.amountB:g,J,y,te)]}),A.addCustomComputeBudget(d),A.addTipInstruction(l),A.versionBuild({txVersion:u,extInfo:X(V({},z),{decimalOutAmount:ee,minDecimalOutAmount:new fe(J.toString())})})}async buyTokenExactOut({programId:e=ie,authProgramId:t,mintA:n,mintAProgram:i=$,mintB:r=Le,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:d,computeBudgetConfig:l,txTipConfig:w,feePayer:g,maxBuyAmount:m,outAmount:f,slippage:y,shareFeeRate:T=new O(0),shareFeeReceiver:P,associatedOnly:x=!0,checkCreateATAOwner:k=!1,skipCheckMintA:b=!1}){f.lte(new O(0))&&this.logAndCreateError("out amount should gt 0:",f.toString());let A=this.createTxBuilder(g),{publicKey:S}=ot(e,n,r);t=t!=null?t:Ke(e).publicKey;let B=s;if(!B){let U=await this.scope.connection.getAccountInfo(S,{commitment:"processed"});U||this.logAndCreateError("cannot found pool:",S.toBase58()),B=Be.decode(U.data)}let K=a,C=await Ce(this.scope.connection,[K?void 0:B.configId,B.platformId].filter(Boolean).map(U=>({pubkey:U})));if(!K){let U=C.find(D=>D.pubkey.equals(B.configId));(!U||!U.accountInfo)&&this.logAndCreateError("config not found: ",B.configId.toBase58()),K=Ee.decode(U.accountInfo.data)}let h=C.find(U=>U.pubkey.equals(B.platformId));(!h||!h.accountInfo)&&this.logAndCreateError("platform info not found: ",B.configId.toBase58());let q=at.decode(h.accountInfo.data);u=u||q.feeRate;let _=c;if(!b)if(_)i=Fe;else{let U=await this.scope.connection.getAccountInfo(n);if(U&&U.owner.equals(Fe)){i=U.owner;let D=zt(n,U,i);_=Xt(D)||void 0}}let M=Ae.buyExactOut({poolInfo:B,amountA:f,protocolFeeRate:K.tradeFeeRate,platformFeeRate:u,curveType:K.curveType,shareFeeRate:T,creatorFeeRate:q.creatorFeeRate,transferFeeConfigA:_,slot:await this.scope.connection.getSlot()}),I=new fe(M.amountB.toString()),W=y?new fe(De.add(y).toNumber()/De.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new fe(1),H=(m!=null?m:y)?new O(I.mul(W).toFixed(0)):M.amountB,j=this.scope.account.getAssociatedTokenAccount(n,i),z=null,ee=r.equals(Le);A.addInstruction({instructions:[we(this.scope.ownerPubKey,j,this.scope.ownerPubKey,n,i)]});let{account:ne,instructionParams:J}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:ee?{payer:this.scope.ownerPubKey,amount:M.amountB}:void 0,skipCloseAccount:!ee,notUseTokenAccount:ee,associatedOnly:ee?!1:x,checkCreateATAOwner:k});ne&&(z=ne),A.addInstruction(J||{}),z===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let te=P?Te(P,r,$).publicKey:void 0;return te&&A.addInstruction({instructions:[we(this.scope.ownerPubKey,te,P,r)]}),A.addInstruction({instructions:[qi(e,this.scope.ownerPubKey,t,B.configId,B.platformId,S,j,z,B.vaultA,B.vaultB,n,r,i,$,Xe(e,B.platformId,r).publicKey,st(e,B.creator,r).publicKey,f,H,T,te)]}),A.addCustomComputeBudget(l),A.addTipInstruction(w),A.versionBuild({txVersion:d,extInfo:{maxSpentAmount:H,outAmount:f}})}async sellToken({programId:e=ie,authProgramId:t,mintAProgram:n=$,mintA:i,mintB:r=Le,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:d,txTipConfig:l,feePayer:w,sellAmount:g,minAmountB:m,slippage:f,shareFeeRate:y=new O(0),shareFeeReceiver:T,associatedOnly:P=!0,checkCreateATAOwner:x=!1,skipCheckMintA:k=!1}){t=t!=null?t:Ke(e).publicKey;let b=this.createTxBuilder(w);g.lte(new O(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:A}=ot(e,i,r),S;if(!k){let D=await this.scope.connection.getAccountInfo(i);if(D&&D.owner.equals(Fe)){n=D.owner;let re=zt(i,D,n);S=Xt(re)||void 0}}let B=null,K=null,C=r.equals(Le),{account:h,instructionParams:q}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:P,checkCreateATAOwner:x});h&&(B=h),b.addInstruction(q||{}),B===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:_,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:P,checkCreateATAOwner:x});_&&(K=_),b.addInstruction(M||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=s;if(!I){let D=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});D||this.logAndCreateError("cannot found pool",A.toBase58()),I=Be.decode(D.data)}let W=a,H=await Ce(this.scope.connection,[W?void 0:I.configId,I.platformId].filter(Boolean).map(D=>({pubkey:D})));if(!W){let D=H.find(re=>re.pubkey.equals(I.configId));(!D||!D.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),W=Ee.decode(D.accountInfo.data)}let j=H.find(D=>D.pubkey.equals(I.platformId));(!j||!j.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58());let z=at.decode(j.accountInfo.data);c=c||z.feeRate;let ee=Ae.sellExactIn({poolInfo:I,amountA:g,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:y,creatorFeeRate:z.creatorFeeRate,transferFeeConfigA:S,slot:await this.scope.connection.getSlot()}),ne=new fe(ee.amountB.toString()),J=f?new fe(De.sub(f).toNumber()/De.toNumber()).clampedTo(0,1):new fe(1),te=m!=null?m:f?new O(ne.mul(J).toFixed(0)):ee.amountB;te.lte(new O(0))&&this.logAndCreateError(`out ${r.toBase58()} amount should be gt 0`);let U=T?Te(T,r,$).publicKey:void 0;return U&&b.addInstruction({instructions:[we(this.scope.ownerPubKey,U,T,r)]}),b.addInstruction({instructions:[Gi(e,this.scope.ownerPubKey,t,I.configId,I.platformId,A,B,K,I.vaultA,I.vaultB,i,r,n,$,Xe(e,I.platformId,r).publicKey,st(e,I.creator,r).publicKey,ee.amountA.amount.lt(g)?ee.amountA.amount:g,te,y,U)]}),b.addCustomComputeBudget(d),b.addTipInstruction(l),b.versionBuild({txVersion:u,extInfo:{outAmount:te}})}async sellTokenExactOut({programId:e=ie,authProgramId:t,mintAProgram:n=$,mintA:i,mintB:r=Le,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:d,txTipConfig:l,feePayer:w,inAmount:g,maxSellAmount:m,slippage:f,shareFeeRate:y=new O(0),shareFeeReceiver:T,associatedOnly:P=!0,checkCreateATAOwner:x=!1,skipCheckMintA:k=!1}){t=t!=null?t:Ke(e).publicKey;let b=this.createTxBuilder(w);m!=null&&m.lte(new O(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:A}=ot(e,i,r),S;if(!k){let D=await this.scope.connection.getAccountInfo(i);if(D&&D.owner.equals(Fe)){n=D.owner;let re=zt(i,D,n);S=Xt(re)||void 0}}let B=null,K=null,C=r.equals(Le),{account:h,instructionParams:q}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:P,checkCreateATAOwner:x});h&&(B=h),b.addInstruction(q||{}),B===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:_,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:C?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!C,notUseTokenAccount:C,associatedOnly:C?!1:P,checkCreateATAOwner:x});_&&(K=_),b.addInstruction(M||{}),K===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=s;if(!I){let D=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});D||this.logAndCreateError("cannot found pool",A.toBase58()),I=Be.decode(D.data)}let W=a,H=await Ce(this.scope.connection,[W?void 0:I.configId,I.platformId].filter(Boolean).map(D=>({pubkey:D})));if(!W){let D=H.find(re=>re.pubkey.equals(I.configId));(!D||!D.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),W=Ee.decode(D.accountInfo.data)}let j=H.find(D=>D.pubkey.equals(I.platformId));(!j||!j.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58());let z=at.decode(j.accountInfo.data);c=c||z.feeRate;let ee=Ae.sellExactOut({poolInfo:I,amountB:g,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:y,creatorFeeRate:z.creatorFeeRate,transferFeeConfigA:S,slot:await this.scope.connection.getSlot()}),ne=new fe(ee.amountA.amount.toString()),J=f?new fe(De.add(f).toNumber()/De.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new fe(1),te=(m!=null?m:f)?new O(ne.mul(J).toFixed(0)):ee.amountA.amount,U=T?Te(T,r,$).publicKey:void 0;return U&&b.addInstruction({instructions:[we(this.scope.ownerPubKey,U,T,r)]}),b.addInstruction({instructions:[Ui(e,this.scope.ownerPubKey,t,I.configId,I.platformId,A,B,K,I.vaultA,I.vaultB,i,r,n,$,Xe(e,I.platformId,r).publicKey,st(e,I.creator,r).publicKey,g,te,y,U)]}),b.addCustomComputeBudget(d),b.addTipInstruction(l),b.versionBuild({txVersion:u,extInfo:{maxSellAmount:te}})}async createPlatformConfig({programId:e=ie,platformAdmin:t,platformClaimFeeWallet:n,platformLockNftWallet:i,cpConfigId:r,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:c,feeRate:u,name:d,web:l,img:w,txVersion:g,computeBudgetConfig:m,txTipConfig:f,feePayer:y}){let T=this.createTxBuilder(y),{publicKey:P}=Nn(e,t);return T.addInstruction({instructions:[Xi(e,t,n,i,P,r,a,s,u,c,d,l,w)]}),T.addCustomComputeBudget(m),T.addTipInstruction(f),T.versionBuild({txVersion:g,extInfo:{platformId:P}})}async updatePlatformConfig({programId:e=ie,platformAdmin:t,platformId:n,updateInfo:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),d=n!=null?n:Nn(e,t).publicKey;return u.addInstruction({instructions:[zi(e,t,d,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async claimPlatformFee({programId:e=ie,authProgramId:t,platformId:n,poolId:i,platformClaimFeeWallet:r,mintB:s,vaultB:a,mintBProgram:c=$,txVersion:u,computeBudgetConfig:d,txTipConfig:l,feePayer:w}){var T;let g=this.createTxBuilder(w);t=t!=null?t:Ke(e).publicKey;let m=s,f=a;if(!m){let P=await this.scope.connection.getAccountInfo(i,{commitment:"processed"});P||this.logAndCreateError("cannot found pool:",i.toBase58());let x=Be.decode(P.data),k=await this.scope.connection.getAccountInfo(x.configId,{commitment:"processed"});k||this.logAndCreateError("cannot found config:",x.configId.toBase58()),m=Ee.decode(k.data).mintB,f=f!=null?f:x.vaultB}(!m||!f)&&this.logAndCreateError("cannot found mint info, mintB: ",m.toBase58(),", vaultB: ",(T=f==null?void 0:f.toBase58())!=null?T:"");let y=Te(this.scope.ownerPubKey,m,$).publicKey;return g.addInstruction({instructions:[we(this.scope.ownerPubKey,y,this.scope.ownerPubKey,m)]}),g.addInstruction({instructions:[On(e,r,t,i,n,f,y,m,c)]}),g.addCustomComputeBudget(d),g.addTipInstruction(l),g.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=ie,authProgramId:t,platformId:n,platformClaimFeeWallet:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:Ke(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Be.span},{memcmp:{offset:Be.offsetOf("platformId"),bytes:n.toString()}}]})).forEach(l=>{let w=Be.decode(l.account.data);if(w.platformFee.lte(new O(0)))return;let g=Te(this.scope.ownerPubKey,w.mintB,$).publicKey;u.addInstruction({instructions:[we(this.scope.ownerPubKey,g,this.scope.ownerPubKey,w.mintB)]}),u.addInstruction({instructions:[On(e,i,t,l.pubkey,n,w.vaultB,g,w.mintB,$)]})}),u.addTipInstruction(a),r===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=ie,poolId:t,beneficiary:n,shareAmount:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),d=await this.getRpcPoolInfo({poolId:t});i.add(d.vestingSchedule.totalAllocatedShare).gt(d.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let l=Tt(e,t,n).publicKey;return u.addInstruction({instructions:[Mn(e,this.scope.ownerPubKey,n,t,l,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async createMultipleVesting({programId:e=ie,poolId:t,beneficiaryList:n,txVersion:i,computeBudgetConfig:r,feePayer:s}){let a=this.createTxBuilder(s);n.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return n.reduce((d,l)=>d.add(l.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),n.forEach(d=>{let l=Tt(e,t,d.wallet).publicKey;a.addInstruction({instructions:[Mn(e,this.scope.ownerPubKey,d.wallet,t,l,d.shareAmount)]})}),i===0?a.sizeCheckBuildV0({computeBudgetConfig:r}):a.sizeCheckBuild({computeBudgetConfig:r})}async claimVesting({programId:e=ie,poolId:t,poolInfo:n,vestingRecord:i,txVersion:r,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),d=Ke(e).publicKey,l=i||Tt(e,t,this.scope.ownerPubKey).publicKey,w=n;if(!w){let m=await this.scope.connection.getAccountInfo(t);m||this.logAndCreateError("pool not found"),w=Be.decode(m.data)}let g=Te(this.scope.ownerPubKey,w.mintA,$).publicKey;return u.addInstruction({instructions:[we(this.scope.ownerPubKey,g,this.scope.ownerPubKey,w.mintA)]}),u.addInstruction({instructions:[Fn(e,this.scope.ownerPubKey,d,t,l,g,w.vaultA,w.mintA,$)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:r})}async claimMultiVesting({programId:e=ie,poolIdList:t,poolsInfo:n={},vestingRecords:i={},txVersion:r,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=V({},n),d=Ke(e).publicKey,l=t.filter(w=>!u[w.toBase58()]);if(l.length){let w=await this.getRpcPoolsInfo({poolIdList:l});u=V(V({},u),w.poolInfoMap)}return t.forEach(w=>{let g=w.toBase58(),m=u[g];m||this.logAndCreateError(`pool info not found: ${g}`);let f=i[g]||Tt(e,w,this.scope.ownerPubKey).publicKey,y=Te(this.scope.ownerPubKey,m.mintA,$).publicKey;c.addInstruction({instructions:[we(this.scope.ownerPubKey,y,this.scope.ownerPubKey,m.mintA)]}),c.addInstruction({instructions:[Fn(e,this.scope.ownerPubKey,d,w,f,y,m.vaultA,m.mintA,$)]})}),r===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=ie,platformId:t,mintB:n,mintBProgram:i=$,claimFeeWallet:r,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let d=this.createTxBuilder(u),l=Xe(e,t,n).publicKey,w=Rn(e).publicKey,g=this.scope.account.getAssociatedTokenAccount(n,i);return d.addInstruction({instructions:[we(this.scope.ownerPubKey,g,this.scope.ownerPubKey,n,i),En(e,t,r!=null?r:this.scope.ownerPubKey,w,l,g,n,i)]}),d.addCustomComputeBudget(a),d.addTipInstruction(c),d.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=ie,platformList:t,unwrapSol:n=!0,txVersion:i,computeBudgetConfig:r,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),d={};return t.forEach(async l=>{var y,T;let w=Rn(e).publicKey,g=Xe(e,l.id,l.mintB).publicKey,m=l.mintB.equals(Le)&&n,f=d[l.mintB.toBase58()];if(!f){let{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({mint:l.mintB,owner:this.scope.ownerPubKey,createInfo:m?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!m,notUseTokenAccount:m,associatedOnly:m?!1:a,checkCreateATAOwner:c});P&&(f=P),u.addInstruction(x||{}),f===void 0&&this.logAndCreateError(`cannot found platform ${l.id.toBase58()} mintB(${l.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[En(e,l.id,(y=l.claimFeeWallet)!=null?y:this.scope.ownerPubKey,g,w,f,l.mintB,(T=l.mintBProgram)!=null?T:$)]})}),i===0?u.sizeCheckBuildV0({computeBudgetConfig:r}):u.sizeCheckBuild({computeBudgetConfig:r})}async claimCreatorFee({programId:e=ie,mintB:t,mintBProgram:n=$,txVersion:i,computeBudgetConfig:r,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=st(e,this.scope.ownerPubKey,t).publicKey,d=Di(e).publicKey,l=this.scope.account.getAssociatedTokenAccount(t,n);return c.addInstruction({instructions:[we(this.scope.ownerPubKey,l,this.scope.ownerPubKey,t,n),Hi(e,this.scope.ownerPubKey,d,u,l,t,n)]}),c.addCustomComputeBudget(r),c.addTipInstruction(s),c.versionBuild({txVersion:i})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let n=await Ce(this.scope.connection,e.map(c=>({pubkey:c})),t),i={},r=[];for(let c=0;c<e.length;c++){let u=n[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let d=Be.decode(u.accountInfo.data);i[e[c].toBase58()]=X(V({},d),{poolId:u.accountInfo.owner}),r.push(d.configId)}let s=await Ce(this.scope.connection,r.map(c=>({pubkey:c})),t),a={};for(let c=0;c<r.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+r[c].toBase58());let d=Ee.decode(u.accountInfo.data);a[r[c].toBase58()]=X(V({},d),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(i).reduce((c,u)=>X(V({},c),{[u]:X(V({},i[u]),{configInfo:a[i[u].configId.toBase58()]})}),{})}}};export{He as LaunchpadPoolInitParam,Dn as default};
//# sourceMappingURL=launchpad.mjs.map