var fo=Object.create;var gt=Object.defineProperty,bo=Object.defineProperties,yo=Object.getOwnPropertyDescriptor,go=Object.getOwnPropertyDescriptors,Po=Object.getOwnPropertyNames,vt=Object.getOwnPropertySymbols,Ao=Object.getPrototypeOf,on=Object.prototype.hasOwnProperty,ui=Object.prototype.propertyIsEnumerable;var ai=(r,e,t)=>e in r?gt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,q=(r,e)=>{for(var t in e||(e={}))on.call(e,t)&&ai(r,t,e[t]);if(vt)for(var t of vt(e))ui.call(e,t)&&ai(r,t,e[t]);return r},$=(r,e)=>bo(r,go(e));var Ve=(r,e)=>{var t={};for(var n in r)on.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&vt)for(var n of vt(r))e.indexOf(n)<0&&ui.call(r,n)&&(t[n]=r[n]);return t};var To=(r,e)=>{for(var t in e)gt(r,t,{get:e[t],enumerable:!0})},ci=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Po(e))!on.call(r,i)&&i!==t&&gt(r,i,{get:()=>e[i],enumerable:!(n=yo(e,i))||n.enumerable});return r};var H=(r,e,t)=>(t=r!=null?fo(Ao(r)):{},ci(e||!r||!r.__esModule?gt(t,"default",{value:r,enumerable:!0}):t,r)),wo=r=>ci(gt({},"__esModule",{value:!0}),r);var Kr={};To(Kr,{LaunchpadPoolInitParam:()=>je,default:()=>$t});module.exports=wo(Kr);var Pt=require("lodash");var rn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},li={},ko={};function de(r){let e=(0,Pt.get)(li,r);if(!e){let t=(0,Pt.get)(ko,r);e=new rn({name:r,logLevel:t}),(0,Pt.set)(li,r,e)}return e}var Y=require("@solana/web3.js"),Ri=H(require("axios"));var Ie=require("@solana/web3.js");var Ci=require("@solana/web3.js");var xe=H(require("bn.js")),Lo=H(require("decimal.js"));var bi=H(require("big.js")),So=H(require("bn.js"));var mi=H(require("toformat")),Bo=mi.default,At=Bo;var Tt=H(require("big.js")),pi=H(require("bn.js")),fi=H(require("decimal.js-light"));var st=H(require("bn.js"));var di=9007199254740991;function Ne(r){let e=de("Raydium_parseBigNumberish");if(r instanceof st.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new st.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=di||r<=-di)&&e.logWithError(`BigNumberish number overflow: ${r}`),new st.default(String(r))):typeof r=="bigint"?new st.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new st.default(0))}var Wt=de("module/fraction"),sn=At(Tt.default),wt=At(fi.default),xo={[0]:wt.ROUND_DOWN,[1]:wt.ROUND_HALF_UP,[2]:wt.ROUND_UP},Io={[0]:Tt.default.roundDown,[1]:Tt.default.roundHalfUp,[2]:Tt.default.roundUp},re=class{constructor(e,t=new pi.default(1)){this.numerator=Ne(e),this.denominator=Ne(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new re(this.denominator,this.numerator)}add(e){let t=e instanceof re?e:new re(Ne(e));return this.denominator.eq(t.denominator)?new re(this.numerator.add(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof re?e:new re(Ne(e));return this.denominator.eq(t.denominator)?new re(this.numerator.sub(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof re?e:new re(Ne(e));return new re(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof re?e:new re(Ne(e));return new re(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Wt.logWithError(`${e} is not an integer.`),e<=0&&Wt.logWithError(`${e} is not positive.`),wt.set({precision:e+1,rounding:xo[n]});let i=new wt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Wt.logWithError(`${e} is not an integer.`),e<0&&Wt.logWithError(`${e} is negative.`),sn.DP=e,sn.RM=Io[n]||1,new sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var jr=de("Raydium_amount"),Zr=At(bi.default);var yi=require("@solana/web3.js"),an=require("@solana/spl-token"),un={chainId:101,address:yi.PublicKey.default.toBase58(),programId:an.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},_e={chainId:101,address:"So11111111111111111111111111111111111111112",programId:an.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Vt=require("@solana/web3.js");var ne=require("@solana/web3.js"),gi=require("@solana/spl-token");function cn({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var es=[cn({pubkey:gi.TOKEN_PROGRAM_ID,isWritable:!1}),cn({pubkey:ne.SystemProgram.programId,isWritable:!1}),cn({pubkey:ne.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Pi({publicKey:r,transformSol:e}){let t=Ai(r.toString());if(t instanceof ne.PublicKey)return e&&t.equals(kt)?Dt:t;if(e&&t.toString()===kt.toBase58())return Dt;if(typeof t=="string"){if(t===ne.PublicKey.default.toBase58())return ne.PublicKey.default;try{return new ne.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ai(r){try{return new ne.PublicKey(r)}catch{return r}}var Co=new ne.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),No=new ne.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ln=new ne.PublicKey("SysvarRent111111111111111111111111111111111"),ts=new ne.PublicKey("SysvarC1ock11111111111111111111111111111111"),at=new ne.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ns=new ne.PublicKey("Sysvar1nstructions1111111111111111111111111"),is=ne.SystemProgram.programId,os=new ne.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),rs=new ne.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ss=new ne.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),as=new ne.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),us=new ne.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),cs=new ne.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ls=new ne.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ms=new ne.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ds=new ne.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ps=new ne.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),fs=new ne.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Dt=new ne.PublicKey("So11111111111111111111111111111111111111112"),kt=ne.PublicKey.default;var mn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===kt.toBase58()||e instanceof Vt.PublicKey&&kt.equals(e)){this.decimals=_e.decimals,this.symbol=_e.symbol,this.name=_e.name,this.mint=new Vt.PublicKey(_e.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Vt.PublicKey.default:Pi({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},qe=mn;qe.WSOL=new mn($(q({},_e),{mint:_e.address}));var dn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},_t=dn;_t.SOL=new dn(un);var Ti=H(require("bn.js"));var hs=new re(new Ti.default(100));var Ns=de("Raydium_price");var Ro=new xe.default(0),na=new xe.default(1),ia=new xe.default(2),oa=new xe.default(3),ra=new xe.default(5),Ko=new xe.default(10),sa=new xe.default(100),aa=new xe.default(1e3),ua=new xe.default(1e4);function wi(r,e,t){return r.mul(e).add(t).sub(new xe.default(1)).div(t)}function bn(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Re=class{constructor(e){this._owner=e}get publicKey(){return Re.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return Re.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return Re.isKeyPair(this._owner)}get isPublicKey(){return Re.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!Re.isKeyPair(e)}};var xi=require("@solana/web3.js"),Ii=require("@solana/spl-token");var pe=require("@solana/web3.js");var Ze={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Bi=require("@solana/spl-token"),ki=de("Raydium_txUtil"),hi=1644;function Bt(r){let e=[],t=[];return r.microLamports&&(e.push(pe.ComputeBudgetProgram.setComputeUnitPrice({microLamports:r.microLamports})),t.push(Ze.SetComputeUnitPrice)),r.units&&(e.push(pe.ComputeBudgetProgram.setComputeUnitLimit({units:r.units})),t.push(Ze.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Qe(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function ht(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,o=>{if(clearTimeout(i),!o.err){t("");return}n(Object.assign(o.err,{txId:e}))},"confirmed")})}function Fo(r,e){r.length<1&&ki.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&ki.logWithError(`no signers provided:, ${e.toString()}`);let t=new pe.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<hi}catch{return!1}}function fe(r,e){let[t,n]=pe.PublicKey.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function xt({instructions:r,payer:e,signers:t}){return Fo(r,[e,...t])}function Ee({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=pe.Keypair.generate().publicKey.toString()}){let o=new pe.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new pe.VersionedTransaction(o).serialize()).toString("base64").length<hi}catch{return!1}}var Mo=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Oo=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof pe.VersionedTransaction&&(e=Mo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Ge(r){let e=[];return r.forEach(t=>{t instanceof pe.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Bi.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=pe.Keypair.generate().publicKey)),e.push(Oo(t))}),console.log("simulate tx string:",e),e}function ke(r,e,t){return fe([r.toBuffer(),(t!=null?t:Ii.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new xi.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var O=require("@solana/web3.js"),ha=new O.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),xa=new O.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ia=new O.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Sa=new O.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ka=new O.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ca=new O.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Na=new O.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ra=new O.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),La=new O.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Fa=new O.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Eo=new O.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),vo=new O.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Wo=new O.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ma=new O.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Oa=new O.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ea=new O.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),va=new O.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Wa=new O.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Da=new O.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Va=new O.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),_a=new O.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),qa=new O.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ga=new O.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ua=new O.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Xa=new O.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ue=new O.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),za=new O.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ha=new O.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Ya=new O.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),ja=new O.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Za=new O.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var Qa={OPEN_BOOK_PROGRAM:new O.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new O.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new O.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new O.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new O.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new O.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new O.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new O.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new O.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new O.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new O.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new O.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:O.PublicKey.default,Router:new O.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new O.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new O.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new O.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new O.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new O.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new O.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new O.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new O.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new O.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new O.PublicKey("Ray1111111111111111111111111111111111111111")};var me=H(require("bn.js")),It=1e4;function yn(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new me.default(0))?t.add(new me.default(1)):t}function Je(r,e){if(r.isZero())return new me.default(0);let t=r.div(e);return t.isZero()?new me.default(1):r.mod(e).gt(new me.default(0))?t.add(new me.default(1)):t}function gn(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new me.default(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=yn(r.mul(new me.default(i.transferFeeBasisPoints)),new me.default(It)),c=a.gt(o)?o:a;return{amount:r,fee:c,expirationTime:s}}function Pn(r,e,t){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let n=Math.floor(t/432e3),i=n<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new me.default(i.maximumFee.toString()),s=n<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(i.transferFeeBasisPoints===It){let a=new me.default(i.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=yn(r.mul(new me.default(It)),new me.default(It-i.transferFeeBasisPoints)),c=new me.default(i.maximumFee.toString()),u=a.sub(r).gt(c)?r.add(c):a,f=yn(u.mul(new me.default(i.transferFeeBasisPoints)),new me.default(It)),m=f.gt(o)?o:f;return{amount:u,fee:m,expirationTime:s}}}var Do=require("@solana/web3.js"),Vo=H(require("bn.js"));var Si=H(require("bn.js")),$e=new Si.default(1e6);var Gt=require("@solana/spl-token"),An=de("Raydium_accountInfo_util");async function St(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=q({batchRequest:!1},t),s=bn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let T=r._buildArgs([m.map(P=>P.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:T}}),u=bn(c,10);a=(await(await Promise.all(u.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&An.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(T=>{if(T){let{data:P,executable:l,lamports:y,owner:b,rentEpoch:x}=T;return P.length!==2&&P[1]!=="base64"&&An.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(P[0],"base64"),executable:l,lamports:y,owner:new Ci.PublicKey(b),rentEpoch:x}}return null})))}else try{a=await Promise.all(s.map(c=>r.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&An.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Le(r,e,t){let n=await St(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>$(q({},i),{accountInfo:n[o]}))}async function Ut({connection:r,address:e,cluster:t="mainnet"}){let n=await St(r,[...new Set(e.map(o=>o.toString()))].map(o=>new Ie.PublicKey(o))),i={};for(let o=0;o<e.length;o++){let s=n[o],a=e[o];if(!s)continue;let c=new Ie.AddressLookupTableAccount({key:a,state:Ie.AddressLookupTableAccount.deserialize(s.data)});i[a.toString()]=c,t==="devnet"?ut[a.toString()]=c:Ue[a.toString()]=c}return i}var Ue={},Tn=async r=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(Ue[e])return Ue;let t=new Ie.PublicKey(e),n=await r.getAccountInfo(t);return n&&(Ue[e]=new Ie.AddressLookupTableAccount({key:t,state:Ie.AddressLookupTableAccount.deserialize(n.data)})),Ue},ut={},Xt=async r=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(ut[e])return ut;let t=new Ie.PublicKey(e),n=await r.getAccountInfo(t);return n&&(ut[e]=new Ie.AddressLookupTableAccount({key:t,state:Ie.AddressLookupTableAccount.deserialize(n.data)})),ut};var Kt=2e3,Ct=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Ri.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Bt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Y.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Y.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Ze.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Y.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(q({},t||{})):this.build(t)}build(e){var n;let t=new Y.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var f;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=i||{},u=o!=null?o:await Qe(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Ge([t]),(f=this.owner)!=null&&f.isKeyPair)return{txId:a?await(0,Y.sendAndConfirmTransaction)(this.connection,t,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let T of m)try{T.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(f=>f.transaction.instructions.length>0),s=[i,...o.map(f=>f.transaction)],a=[this.signers,...o.map(f=>f.signers)],c=[...this.instructionTypes,...o.map(f=>f.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async f=>{var x;let{sequentially:m,onTxUpdate:T,skipTxCount:P=0,recentBlockHash:l,skipPreflight:y=!0}=f||{},b=l!=null?l:await Qe(this.connection,this.blockhashCommitment);if((x=this.owner)!=null&&x.isKeyPair){if(m){let d=[],K=0;for(let w of s){if(++K,K<=P)continue;let p=await(0,Y.sendAndConfirmTransaction)(this.connection,w,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});d.push(p)}return{txIds:d,signedTxs:s}}return{txIds:await await Promise.all(s.map(async d=>(d.recentBlockhash=b,await this.connection.sendRawTransaction(d.serialize(),{skipPreflight:y})))),signedTxs:s}}if(this.signAllTransactions){let d=s.map((w,p)=>(w.recentBlockhash=b,a[p].length&&w.sign(...a[p]),w));Ge(d);let K=await this.signAllTransactions(d);if(m){let w=0,p=[],A=async()=>{if(!K[w])return;let I=await this.connection.sendRawTransaction(K[w].serialize(),{skipPreflight:y});p.push({txId:I,status:"sent",signedTx:K[w]}),T==null||T([...p]),w++;let k=!1,C=null,N=null,F=B=>{C!==null&&clearInterval(C),N!==null&&this.connection.removeSignatureListener(N);let L=p.findIndex(R=>R.txId===I);if(L>-1){if(p[L].status==="error"||p[L].status==="success")return;p[L].status=B.err?"error":"success"}T==null||T([...p]),B.err||A()};this.loopMultiTxStatus&&(C=setInterval(async()=>{var B;if(k){clearInterval(C);return}try{let L=await this.connection.getTransaction(I,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(k=!0,clearInterval(C),F({err:((B=L.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",I))}catch(L){k=!0,clearInterval(C),console.error("getTransaction timeout:",L,I)}},Kt)),N=this.connection.onSignature(I,B=>{if(k){this.connection.removeSignatureListener(N);return}k=!0,F(B)},"confirmed"),this.connection.getSignatureStatus(I)};return await A(),{txIds:p.map(I=>I.txId),signedTxs:K}}else{let w=[];for(let p=0;p<K.length;p+=1){let A=await this.connection.sendRawTransaction(K[p].serialize(),{skipPreflight:y});w.push(A)}return{txIds:w,signedTxs:K}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var y;let l=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:o}=l,s=Ve(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=q(q({},this.cluster==="devnet"?await Xt(this.connection):await Tn(this.connection)),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new Y.PublicKey(b));let f=await Ut({connection:this.connection,address:u});for(let[b,x]of Object.entries(f))a[b]=x;let m=i?Y.PublicKey.default.toBase58():o!=null?o:await Qe(this.connection,this.blockhashCommitment),T=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((y=this.owner)==null?void 0:y.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let P=new Y.VersionedTransaction(T);return P.sign(this.signers),{builder:this,transaction:P,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var w;let{skipPreflight:x=!0,sendAndConfirm:d,notSendToRpc:K}=b||{};if(Ge([P]),(w=this.owner)!=null&&w.isKeyPair){let p=await this.connection.sendTransaction(P,{skipPreflight:x});return d&&await ht(this.connection,p),{txId:p,signedTx:P}}if(this.signAllTransactions){let p=await this.signAllTransactions([P]);if(this.signers.length)for(let A of p)try{A.sign(this.signers)}catch{}return{txId:K?"":await this.connection.sendTransaction(p[0],{skipPreflight:x}),signedTx:p[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(f=>f.builder.instructions.length>0),s=[i,...o.map(f=>f.transaction)],a=[this.signers,...o.map(f=>f.signers)],c=[...this.instructionTypes,...o.map(f=>f.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(f,m)=>{f.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async f=>{var y;let{sequentially:m,onTxUpdate:T,recentBlockHash:P,skipPreflight:l=!0}=f||{};if(P&&s.forEach(b=>b.message.recentBlockhash=P),Ge(s),(y=this.owner)!=null&&y.isKeyPair){if(m){let b=[];for(let x of s){let d=await this.connection.sendTransaction(x,{skipPreflight:l});await ht(this.connection,d),b.push(d)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:l}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(m){let x=0,d=[],K=async()=>{if(!b[x])return;let w=await this.connection.sendTransaction(b[x],{skipPreflight:l});d.push({txId:w,status:"sent",signedTx:b[x]}),T==null||T([...d]),x++;let p=!1,A=null,I=null,k=C=>{A!==null&&clearInterval(A),I!==null&&this.connection.removeSignatureListener(I);let N=d.findIndex(F=>F.txId===w);if(N>-1){if(d[N].status==="error"||d[N].status==="success")return;d[N].status=C.err?"error":"success"}T==null||T([...d]),C.err||K()};this.loopMultiTxStatus&&(A=setInterval(async()=>{var C;if(p){clearInterval(A);return}try{let N=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(p=!0,clearInterval(A),k({err:((C=N.meta)==null?void 0:C.err)||null}),console.log("tx status from getTransaction:",w))}catch(N){p=!0,clearInterval(A),console.error("getTransaction timeout:",N,w)}},Kt)),I=this.connection.onSignature(w,C=>{if(p){this.connection.removeSignatureListener(I);return}p=!0,k(C)},"confirmed"),this.connection.getSignatureStatus(w)};return K(),{txIds:[],signedTxs:b}}else{let x=[];for(let d=0;d<b.length;d+=1){let K=await this.connection.sendTransaction(b[d],{skipPreflight:l});x.push(K)}return{txIds:x,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var T;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=Ve(m,["splitIns","computeBudgetConfig"]),o=n?Bt(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((P,l)=>$(q({},P),{[l.publicKey.toBase58()]:l}),{}),a=[],c=[],u=[],f=0;if(this.allInstructions.forEach(P=>{let l=[...u,P],y=n?[...o.instructions,...l]:l,x=[...new Set(l.map(d=>d.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat()).values()].map(d=>new Y.PublicKey(d));if(P!==t[f]&&u.length<12&&(xt({instructions:y,payer:this.feePayer,signers:x})||xt({instructions:l,payer:this.feePayer,signers:x})))u.push(P);else{if(u.length===0)throw Error("item ins too big");f+=P===t[f]?1:0,xt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:x})?a.push(new Y.Transaction().add(...o.instructions,...u)):a.push(new Y.Transaction().add(...u)),c.push(Array.from(new Set(u.map(d=>d.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(d=>s[d]).filter(d=>d!==void 0)),u=[P]}}),u.length>0){let l=[...new Set(u.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>s[y]).filter(y=>y!==void 0);xt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:l.map(y=>y.publicKey)})?a.push(new Y.Transaction().add(...o.instructions,...u)):a.push(new Y.Transaction().add(...u)),c.push(l)}return a.forEach(P=>P.feePayer=this.feePayer),(T=this.owner)!=null&&T.signer&&c.forEach(P=>{P.some(l=>l.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async P=>{var w;let{sequentially:l,onTxUpdate:y,skipTxCount:b=0,recentBlockHash:x,skipPreflight:d=!0}=P||{},K=x!=null?x:await Qe(this.connection,this.blockhashCommitment);if(a.forEach(async(p,A)=>{p.recentBlockhash=K,c[A].length&&p.sign(...c[A])}),Ge(a),(w=this.owner)!=null&&w.isKeyPair){if(l){let p=0,A=[];for(let I of a){if(++p,p<=b){A.push("tx skipped");continue}let k=await(0,Y.sendAndConfirmTransaction)(this.connection,I,this.signers.find(C=>C.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:d});A.push(k)}return{txIds:A,signedTxs:a}}return{txIds:await Promise.all(a.map(async p=>await this.connection.sendRawTransaction(p.serialize(),{skipPreflight:d}))),signedTxs:a}}if(this.signAllTransactions){let p=await this.signAllTransactions(a.slice(b,a.length)),A=[...a.slice(0,b),...p];if(l){let I=0,k=[],C=async()=>{if(!A[I])return;I<b&&(k.push({txId:"",status:"success",signedTx:A[I]}),y==null||y([...k]),I++,C());let N=await this.connection.sendRawTransaction(A[I].serialize(),{skipPreflight:d});k.push({txId:N,status:"sent",signedTx:A[I]}),y==null||y([...k]),I++;let F=!1,B=null,L=null,R=S=>{B!==null&&clearInterval(B),L!==null&&this.connection.removeSignatureListener(L);let W=k.findIndex(U=>U.txId===N);if(W>-1){if(k[W].status==="error"||k[W].status==="success")return;k[W].status=S.err?"error":"success"}y==null||y([...k]),S.err||C()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var S;if(F){clearInterval(B);return}try{let W=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});W&&(F=!0,clearInterval(B),R({err:((S=W.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",N))}catch(W){F=!0,clearInterval(B),console.error("getTransaction timeout:",W,N)}},Kt)),L=this.connection.onSignature(N,S=>{if(F){this.connection.removeSignatureListener(L);return}F=!0,R(S)},"confirmed"),this.connection.getSignatureStatus(N)};return await C(),{txIds:k.map(N=>N.txId),signedTxs:A}}else{let I=[];for(let k=0;k<A.length;k+=1){let C=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:d});I.push(C)}return{txIds:I,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var K;let d=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:o=[]}=d,s=Ve(d,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=q(q({},this.cluster==="devnet"?await Xt(this.connection):Ue),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let w of c)a[w]===void 0&&u.push(new Y.PublicKey(w));let f=await Ut({connection:this.connection,address:u});for(let[w,p]of Object.entries(f))a[w]=p;let m=t?Bt(t):{instructions:[],instructionTypes:[]},T=await Qe(this.connection,this.blockhashCommitment),P=this.signers.reduce((w,p)=>$(q({},w),{[p.publicKey.toBase58()]:p}),{}),l=[],y=[],b=[],x=0;if(this.allInstructions.forEach(w=>{let p=[...b,w],A=t?[...m.instructions,...p]:p;if(w!==n[x]&&b.length<12&&(Ee({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||Ee({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(w);else{if(b.length===0)throw Error("item ins too big");x+=w===n[x]?1:0;let I={};for(let k of[...new Set(c)])a[k]!==void 0&&(I[k]=a[k]);if(t&&Ee({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(k))}else{let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(k))}y.push(Array.from(new Set(b.map(k=>k.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(k=>P[k]).filter(k=>k!==void 0)),b=[w]}}),b.length>0){let p=[...new Set(b.map(A=>A.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(A=>P[A]).filter(A=>A!==void 0);if(t&&Ee({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let A=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(A))}else{let A=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(A))}y.push(p)}return(K=this.owner)!=null&&K.signer&&y.forEach(w=>{w.some(p=>p.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,p)=>{w.sign(y[p])}),{builder:this,transactions:l,buildProps:e,signers:y,blockHash:T,instructionTypes:this.instructionTypes,execute:async w=>{var N;let{sequentially:p,onTxUpdate:A,skipTxCount:I=0,recentBlockHash:k,skipPreflight:C=!0}=w||{};if(l.map(async(F,B)=>{y[B].length&&F.sign(y[B]),k&&(F.message.recentBlockhash=k)}),Ge(l),(N=this.owner)!=null&&N.isKeyPair){if(p){let F=0,B=[];for(let L of l){if(++F,F<=I){console.log("skip tx: ",F),B.push("tx skipped");continue}let R=await this.connection.sendTransaction(L,{skipPreflight:C});await ht(this.connection,R),B.push(R)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async F=>await this.connection.sendTransaction(F,{skipPreflight:C}))),signedTxs:l}}if(this.signAllTransactions){let F=await this.signAllTransactions(l.slice(I,l.length)),B=[...l.slice(0,I),...F];if(p){let L=0,R=[],S=async()=>{if(!B[L])return;if(L<I){R.push({txId:"",status:"success",signedTx:B[L]}),A==null||A([...R]),L++,S();return}let W=await this.connection.sendTransaction(B[L],{skipPreflight:C});R.push({txId:W,status:"sent",signedTx:B[L]}),A==null||A([...R]),L++;let U=!1,X=null,z=null,j=ee=>{X!==null&&clearInterval(X),z!==null&&this.connection.removeSignatureListener(z);let Q=R.findIndex(ae=>ae.txId===W);if(Q>-1){if(R[Q].status==="error"||R[Q].status==="success")return;R[Q].status=ee.err?"error":"success"}A==null||A([...R]),ee.err||S()};this.loopMultiTxStatus&&(X=setInterval(async()=>{var ee;if(U){clearInterval(X);return}try{let Q=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});Q&&(U=!0,clearInterval(X),j({err:((ee=Q.meta)==null?void 0:ee.err)||null}),console.log("tx status from getTransaction:",W))}catch(Q){U=!0,clearInterval(X),console.error("getTransaction timeout:",Q,W)}},Kt)),z=this.connection.onSignature(W,ee=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,j(ee)},"confirmed"),this.connection.getSignatureStatus(W)};return S(),{txIds:[],signedTxs:B}}else{let L=[];for(let R=0;R<B.length;R+=1){let S=await this.connection.sendTransaction(B[R],{skipPreflight:C});L.push(S)}return{txIds:L,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildSniperTransaction(e){var K;let d=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:o=[]}=d,s=Ve(d,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=q(q({},this.cluster==="devnet"?await Xt(this.connection):await Tn(this.connection)),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let w of c)a[w]===void 0&&u.push(new Y.PublicKey(w));let f=await Ut({connection:this.connection,address:u});for(let[w,p]of Object.entries(f))a[w]=p;let m=t?Bt(t):{instructions:[],instructionTypes:[]},T=await Qe(this.connection,this.blockhashCommitment),P=this.signers.reduce((w,p)=>$(q({},w),{[p.publicKey.toBase58()]:p}),{}),l=[],y=[],b=[],x=0;if(this.allInstructions.forEach(w=>{let p=[...b,w],A=t?[...m.instructions,...p]:p;if(w!==n[x]&&b.length<12&&(Ee({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||Ee({instructions:p,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(w);else{if(b.length===0)throw Error("item ins too big");x+=w===n[x]?1:0;let I={};for(let k of[...new Set(c)])a[k]!==void 0&&(I[k]=a[k]);if(t&&Ee({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(k))}else{let k=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(k))}y.push(Array.from(new Set(b.map(k=>k.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(k=>P[k]).filter(k=>k!==void 0)),b=[w]}}),b.length>0){let p=[...new Set(b.map(A=>A.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(A=>P[A]).filter(A=>A!==void 0);if(t&&Ee({instructions:[...m.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:T})){let A=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...m.instructions,...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(A))}else{let A=new Y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:T,instructions:[...b]}).compileToV0Message(Object.values(a));l.push(new Y.VersionedTransaction(A))}y.push(p)}return(K=this.owner)!=null&&K.signer&&y.forEach(w=>{w.some(p=>p.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),l.forEach((w,p)=>{w.sign(y[p])}),{builder:this,transactions:l,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var N;let{sequentially:p,onTxUpdate:A,skipTxCount:I=0,recentBlockHash:k,skipPreflight:C=!0}=w||{};if(l.map(async(F,B)=>{y[B].length&&F.sign(y[B]),k&&(F.message.recentBlockhash=k)}),Ge(l),(N=this.owner)!=null&&N.isKeyPair){if(p){let F=0,B=[];for(let L of l){if(++F,F<=I){console.log("skip tx: ",F),B.push("tx skipped");continue}let R=await this.connection.sendTransaction(L,{skipPreflight:C});await ht(this.connection,R),B.push(R)}return{txIds:B,signedTxs:l}}return{txIds:await Promise.all(l.map(async F=>await this.connection.sendTransaction(F,{skipPreflight:C}))),signedTxs:l}}if(this.signAllTransactions){let F=await this.signAllTransactions(l.slice(I,l.length)),B=[...l.slice(0,I),...F];if(p){let L=0,R=[],S=async()=>{if(!B[L])return;if(L<I){R.push({txId:"",status:"success",signedTx:B[L]}),A==null||A([...R]),L++,S();return}let W=await this.connection.sendTransaction(B[L],{skipPreflight:C});R.push({txId:W,status:"sent",signedTx:B[L]}),A==null||A([...R]),L++;let U=!1,X=null,z=null,j=ee=>{X!==null&&clearInterval(X),z!==null&&this.connection.removeSignatureListener(z);let Q=R.findIndex(ae=>ae.txId===W);if(Q>-1){if(R[Q].status==="error"||R[Q].status==="success")return;R[Q].status=ee.err?"error":"success"}A==null||A([...R]),ee.err||S()};this.loopMultiTxStatus&&(X=setInterval(async()=>{var ee;if(U){clearInterval(X);return}try{let Q=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});Q&&(U=!0,clearInterval(X),j({err:((ee=Q.meta)==null?void 0:ee.err)||null}),console.log("tx status from getTransaction:",W))}catch(Q){U=!0,clearInterval(X),console.error("getTransaction timeout:",Q,W)}},Kt)),z=this.connection.onSignature(W,ee=>{if(U){this.connection.removeSignatureListener(z);return}U=!0,j(ee)},"confirmed"),this.connection.getSignatureStatus(W)};return S(),{txIds:[],signedTxs:B}}else{let L=[];for(let R=0;R<B.length;R+=1){let S=await this.connection.sendTransaction(B[R],{skipPreflight:C});L.push(S)}return{txIds:L,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var wn=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ct=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=de(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ct({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}createSniperTxBuilder(e,t){let n=new Re(e);return new Ct({connection:this.scope.connection,feePayer:t,cluster:this.scope.cluster,owner:n,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(wn(e))}logInfo(...e){this.logger.info(wn(e))}logAndCreateError(...e){let t=wn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Pr=require("@solana/web3.js"),Ar=H(require("bn.js")),Tr=H(require("decimal.js"));var Yt=require("@solana/spl-token");var _o=require("@solana/web3.js"),Li=require("@solana/spl-token");var Ht=require("@solana/web3.js"),gr=H(require("bn.js"));var En=require("@solana/spl-token");var Ei=require("@solana/web3.js"),lt=H(require("bn.js"));var E=require("@solana/buffer-layout"),kn=E.Layout,Fi=E.Structure;var Bn=E.UInt;var Mi=E.u8,ve=E.u16;var hn=E.u32;var We=E.s32;var Oi=E.seq;var ye=E.blob;var xn=E.offset;var mt=class extends kn{constructor(t,n,i){super(t,i);this.blob=ye(t),this.signed=n}decode(t,n=0){let i=new lt.default(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new lt.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function V(r){return new Bn(1,r)}function dt(r){return new Bn(4,r)}function g(r){return new mt(8,!1,r)}function se(r){return new mt(16,!1,r)}function vi(r){return new mt(8,!0,r)}function Wi(r){return new mt(16,!0,r)}var et=class extends kn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function D(r){return new et(ye(32),e=>new Ei.PublicKey(e),e=>e.toBuffer(),r)}function Sn(r){return new et(Mi(),qo,Go,r)}function qo(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Go(r){return r?1:0}function Di(r,e){let t=hn("length"),n=_([t,J(r,xn(t,-t.span),"values")]);return new et(n,({values:i})=>i,i=>({values:i}),e)}function Uo(r){let e=hn("length"),t=_([e,ye(xn(e,-e.span),"data")]);return new et(t,({data:n})=>n,n=>({data:n}),r)}function ge(r){return new et(Uo(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),r)}var In=class extends Fi{decode(e,t){return super.decode(e,t)}};function _(r,e,t){return new In(r,e,t)}function J(r,e,t){let n,i=typeof e=="number"?e:(0,lt.isBN)(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=(0,lt.isBN)(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Oi(r,i,t)}var rr=H(require("bn.js")),sr=H(require("decimal.js"));var Pe=H(require("bn.js")),Kn=new Pe.default(0),Vi=new Pe.default(1),_i=new Pe.default(-1),Fe=new Pe.default(1).shln(64),qi=new Pe.default(1).shln(128),Cn=Fe.sub(Vi);var Xo=qi.subn(1),pt=-443636,Nt=-pt,Nn=new Pe.default("4295048016"),Rn=new Pe.default("79226673521066979257578248091"),lc=new Pe.default("4295048017"),mc=new Pe.default("79226673521066979257578248090");var zo=new Pe.default(10).pow(new Pe.default(6));var dc=new Pe.default("18446744073700000000");var ir=H(require("bn.js")),or=H(require("decimal.js"));var Pc=Buffer.from("amm_config","utf8"),Gi=Buffer.from("pool","utf8"),Ui=Buffer.from("pool_vault","utf8"),Ac=Buffer.from("pool_reward_vault","utf8"),Tc=Buffer.from("position","utf8"),wc=Buffer.from("tick_array","utf8"),kc=Buffer.from("operation","utf8"),Bc=Buffer.from("pool_tick_array_bitmap_extension","utf8"),hc=Buffer.from("observation","utf8");function Ln(r){return fe([Buffer.from("metadata","utf8"),at.toBuffer(),r.toBuffer()],at)}var xc=Buffer.from("locked_position","utf8");var Ic=Buffer.from("support_mint","utf8");var Jo=require("@solana/web3.js"),$o=require("@solana/spl-token"),er=H(require("bn.js")),tr=H(require("decimal.js"));var Yo=H(require("bn.js")),jo=H(require("decimal.js"));var On=14;var zt=60;var ar=_([ye(8),V("bump"),ve("index"),D(""),dt("protocolFeeRate"),dt("tradeFeeRate"),ve("tickSpacing"),J(g(),8,"")]),ur=_([dt("blockTimestamp"),vi("tickCumulative"),J(g(),4)]),eo=_([ye(8),Sn("initialized"),g("recentEpoch"),ve("observationIndex"),D("poolId"),J(ur,100,"observations"),J(g(),4)]),cr=_([V("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),se("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),D("tokenMint"),D("tokenVault"),D("creator"),se("rewardGrowthGlobalX64")]),Qi=_([ye(8),V("bump"),D("ammConfig"),D("creator"),D("mintA"),D("mintB"),D("vaultA"),D("vaultB"),D("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),ve("tickSpacing"),se("liquidity"),se("sqrtPriceX64"),We("tickCurrent"),dt(),se("feeGrowthGlobalX64A"),se("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),se("swapInAmountTokenA"),se("swapOutAmountTokenB"),se("swapInAmountTokenB"),se("swapOutAmountTokenA"),V("status"),J(V(),7,""),J(cr,3,"rewardInfos"),J(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),J(g(),15*4-3,"padding")]),lr=_([se("growthInsideLastX64"),g("rewardAmountOwed")]),Ji=_([ye(8),V("bump"),D("nftMint"),D("poolId"),We("tickLower"),We("tickUpper"),se("liquidity"),se("feeGrowthInsideLastX64A"),se("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),J(lr,3,"rewardInfos"),J(g(),8,"")]),Vl=_([ye(8),V("bump"),D("poolId"),We("tickLowerIndex"),We("tickUpperIndex"),se("liquidity"),se("feeGrowthInsideLastX64A"),se("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),J(se(),3,"rewardGrowthInside"),J(g(),8,"")]),mr=_([We("tick"),Wi("liquidityNet"),se("liquidityGross"),se("feeGrowthOutsideX64A"),se("feeGrowthOutsideX64B"),J(se(),3,"rewardGrowthsOutsideX64"),J(dt(),13,"")]),Yi=_([ye(8),D("poolId"),We("startTickIndex"),J(mr,zt,"ticks"),V("initializedTickCount"),J(V(),115,"")]),dr=_([ye(329),J(D(),100,"whitelistMints")]),nr=_([ye(8),D("poolId"),J(J(g(),8),On,"positiveTickArrayBitmap"),J(J(g(),8),On,"negativeTickArrayBitmap")]),_l=_([g(),V("bump"),D("owner"),D("poolId"),D("positionId"),D("nftAccount"),J(g(),8)]),pr=_([ye(8),V("bump"),D("lockOwner"),D("poolId"),D("positionId"),D("nftAccount"),D("lockNftMint"),g("recentEpoch"),J(g(),8)]);eo.span;var rm=de("Raydium_Clmm");var wr=Buffer.from("vault_auth_seed","utf8"),$m=Buffer.from("global_config","utf8"),kr=Buffer.from("pool_vesting","utf8"),Br=Buffer.from("platform_config","utf8"),hr=Buffer.from("platform_fee_vault_auth_seed","utf8"),xr=Buffer.from("creator_fee_vault_auth_seed","utf8");function Se(r){return fe([wr],r)}function tt(r,e,t){return fe([Gi,e.toBuffer(),t.toBuffer()],r)}function vn(r,e,t){return fe([Ui,e.toBuffer(),t.toBuffer()],r)}function nt(r){return fe([Buffer.from("__event_authority","utf8")],r)}function Wn(r,e){return fe([Br,e.toBuffer()],r)}function Ft(r,e,t){return fe([kr,e.toBuffer(),t.toBuffer()],r)}function Xe(r,e,t){return fe([e.toBuffer(),t.toBuffer()],r)}function Dn(r){return fe([hr],r)}function ze(r,e,t){return fe([e.toBuffer(),t.toBuffer()],r)}function Vn(r){return fe([xr],r)}var Ke=require("@solana/spl-token"),oe=require("@solana/web3.js"),ot=H(require("bn.js"));var De=_([g(),g("epoch"),V("curveType"),ve("index"),g("migrateFee"),g("tradeFeeRate"),g("maxShareFeeRate"),g("minSupplyA"),g("maxLockRate"),g("minSellRateA"),g("minMigrateRateA"),g("minFundRaisingB"),D("mintB"),D("protocolFeeOwner"),D("migrateFeeOwner"),D("migrateToAmmWallet"),D("migrateToCpmmWallet"),J(g(),16)]),Ir=_([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),g("startTime"),g("totalAllocatedShare")]),Be=_([g(),g("epoch"),V("bump"),V("status"),V("mintDecimalsA"),V("mintDecimalsB"),V("migrateType"),g("supply"),g("totalSellA"),g("virtualA"),g("virtualB"),g("realA"),g("realB"),g("totalFundRaisingB"),g("protocolFee"),g("platformFee"),g("migrateFee"),Ir.replicate("vestingSchedule"),D("configId"),D("platformId"),D("mintA"),D("mintB"),D("vaultA"),D("vaultB"),D("creator"),V("mintProgramFlag"),V("cpmmCreatorFeeOn"),J(V(),62)]),nd=_([g(),g("epoch"),D("poolId"),D("beneficiary"),g("claimedAmount"),g("tokenShareAmount"),J(g(),8)]),to=_([V("migrateType"),V("migrateCpmmFeeOn"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod")]),Sr=_([g("epoch"),V("index"),D("configId"),to.replicate("bondingCurveParam"),J(g(),50)]),it=_([g(),g("epoch"),D("platformClaimFeeWallet"),D("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),J(V(),64,"name"),J(V(),256,"web"),J(V(),256,"img"),D("cpConfigId"),g("creatorFeeRate"),D("transferFeeExtensionAuth"),J(V(),180),Di(Sr,"platformCurve")]);var Ae={initialize:Buffer.from([175,175,109,31,13,152,155,237]),initializeV2:Buffer.from([67,153,175,39,218,16,38,32]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252]),updatePlatformCurveParam:Buffer.from([138,144,138,250,220,128,4,57]),removePlatformCurveParam:Buffer.from([27,30,62,169,93,224,24,145])};function no(r,e,t,n,i,o,s,a,c,u,f,m,T,P,l,y,b,x,d,K,w){let p=_([V("decimals"),ge("name"),ge("symbol"),ge("uri")]),A=_([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),V("cpmmCreatorFeeOn")]),I=_([V("index"),g("supply"),g("totalFundRaisingB"),V("migrateType")]),k=_([V("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),V("migrateType")]),C=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Ke.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ke.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}],N=Buffer.alloc(Buffer.from(P,"utf-8").length+Buffer.from(l,"utf-8").length+Buffer.from(y,"utf-8").length+4*3+1),F=Buffer.alloc(A.span),B=Buffer.alloc(b.type==="ConstantCurve"?k.span:I.span);return p.encode({decimals:T,name:P,symbol:l,uri:y},N),b.type==="ConstantCurve"?k.encode($(q({index:0},b),{migrateType:b.migrateType==="amm"?0:1}),B):b.type==="FixedCurve"?I.encode($(q({index:1},b),{migrateType:b.migrateType==="amm"?0:1}),B):b.type==="LinearCurve"&&I.encode($(q({index:2},b),{migrateType:b.migrateType==="amm"?0:1}),B),A.encode({totalLockedAmount:x,cliffPeriod:d,unlockPeriod:K,cpmmCreatorFeeOn:w},F),new oe.TransactionInstruction({keys:C,programId:r,data:Buffer.from([...Ae.initializeV2,...N,...B,...F])})}function io(r,e,t,n,i,o,s,a,c,u,f,m,T,P,l,y,b,x,d,K,w){let p=_([V("decimals"),ge("name"),ge("symbol"),ge("uri")]),A=_([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),V("cpmmCreatorFeeOn"),V("transferFeeExtensionParamsOption"),_([ve("transferFeeBasePoints"),g("maxinumFee")]).replicate("transferFeeExtensionParams")]),I=_([V("index"),g("supply"),g("totalFundRaisingB"),V("migrateType")]),k=_([V("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),V("migrateType")]),C=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Ke.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ke.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}],N=Buffer.alloc(Buffer.from(T,"utf-8").length+Buffer.from(P,"utf-8").length+Buffer.from(l,"utf-8").length+4*3+1),F=Buffer.alloc(A.span),B=Buffer.alloc(y.type==="ConstantCurve"?k.span:I.span);return p.encode({decimals:m,name:T,symbol:P,uri:l},N),y.type==="ConstantCurve"?k.encode($(q({index:0},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="FixedCurve"?I.encode($(q({index:1},y),{migrateType:y.migrateType==="amm"?0:1}),B):y.type==="LinearCurve"&&I.encode($(q({index:2},y),{migrateType:y.migrateType==="amm"?0:1}),B),A.encode({totalLockedAmount:b,cliffPeriod:x,unlockPeriod:d,cpmmCreatorFeeOn:K,transferFeeExtensionParamsOption:w?1:0,transferFeeExtensionParams:w!=null?w:{transferFeeBasePoints:0,maxinumFee:new ot.default(0)}},F),new oe.TransactionInstruction({keys:C,programId:r,data:Buffer.from([...Ae.initializeWithToken2022,...N,...B,...F])})}function _n(r,e,t,n,i,o,s,a,c,u,f,m,T,P,l,y,b,x,d,K){let w=_([g("amountB"),g("minAmountA"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];K&&p.push({pubkey:K,isSigner:!1,isWritable:!0}),p.push({pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountB:b,minAmountA:x,shareFeeRate:d!=null?d:new ot.default(0)},A),new oe.TransactionInstruction({keys:p,programId:r,data:Buffer.from([...Ae.buyExactIn,...A])})}function oo(r,e,t,n,i,o,s,a,c,u,f,m,T,P,l,y,b,x,d,K){let w=_([g("amountA"),g("maxAmountB"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];K&&p.push({pubkey:K,isSigner:!1,isWritable:!0}),p.push({pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountA:b,maxAmountB:x,shareFeeRate:d!=null?d:new ot.default(0)},A),new oe.TransactionInstruction({keys:p,programId:r,data:Buffer.from([...Ae.buyExactOut,...A])})}function ro(r,e,t,n,i,o,s,a,c,u,f,m,T,P,l,y,b,x,d,K){let w=_([g("amountA"),g("minAmountB"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];K&&p.push({pubkey:K,isSigner:!1,isWritable:!0}),p.push({pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountA:b,minAmountB:x,shareFeeRate:d!=null?d:new ot.default(0)},A),new oe.TransactionInstruction({keys:p,programId:r,data:Buffer.from([...Ae.sellExactIn,...A])})}function so(r,e,t,n,i,o,s,a,c,u,f,m,T,P,l,y,b,x,d,K){let w=_([g("amountB"),g("maxAmountA"),g("shareFeeRate")]),p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:nt(r).publicKey,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}];K&&p.push({pubkey:K,isSigner:!1,isWritable:!0}),p.push({pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1}),p.push({pubkey:l,isSigner:!1,isWritable:!0}),p.push({pubkey:y,isSigner:!1,isWritable:!0});let A=Buffer.alloc(w.span);return w.encode({amountB:b,maxAmountA:x,shareFeeRate:d!=null?d:new ot.default(0)},A),new oe.TransactionInstruction({keys:p,programId:r,data:Buffer.from([...Ae.sellExactOut,...A])})}function qn(r,e,t,n,i,o,s,a,c){let u=_([]),f=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Ke.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new oe.TransactionInstruction({keys:f,programId:r,data:Buffer.from([...Ae.claimVestedToken,...m])})}function Gn(r,e,t,n,i,o){let s=_([g("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:o},c),new oe.TransactionInstruction({keys:a,programId:r,data:Buffer.from([...Ae.createVestingAccount,...c])})}function Un(r,e,t,n,i,o,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!0},{pubkey:Ke.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!0}];return new oe.TransactionInstruction({keys:u,programId:r,data:Ae.claimPlatformFee})}function ao(r,e,t,n,i,o,s,a,c,u,f,m,T){let P=_([g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),ge("name"),ge("web"),ge("img"),g("creatorFeeRate")]),l=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],y=Buffer.alloc(8*5+Buffer.from(f,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(T,"utf-8").length+4*3);return P.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:c,name:f,web:m,img:T,creatorFeeRate:u},y),new oe.TransactionInstruction({keys:l,programId:r,data:Buffer.from([...Ae.createPlatformConfig,...y])})}function uo(r,e,t,n){let i=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],o;if(n.type==="updateClaimFeeWallet"){let s=_([V("index"),D("value")]);o=Buffer.alloc(s.span),s.encode({index:0,value:n.value},o)}else if(n.type==="updateLockNftWallet"){let s=_([V("index"),D("value")]);o=Buffer.alloc(s.span),s.encode({index:1,value:n.value},o)}else if(n.type==="migrateCpLockNftScale"){let s=_([V("index"),g("platformScale"),g("creatorScale"),g("burnScale")]);o=Buffer.alloc(s.span),s.encode(q({index:2},n.value),o)}else if(n.type==="updateFeeRate"){let s=_([V("index"),g("value")]);o=Buffer.alloc(s.span),s.encode({index:3,value:n.value},o)}else if(n.type==="updateImg"||n.type==="updateName"||n.type==="updateWeb"){let s=_([V("index"),ge("value")]);o=Buffer.alloc(Buffer.from(n.value,"utf-8").length+4+1*1),n.type==="updateName"?s.encode({index:4,value:n.value},o):n.type==="updateWeb"?s.encode({index:5,value:n.value},o):n.type==="updateImg"&&s.encode({index:6,value:n.value},o)}else if(n.type==="updateCpConfigId"){i.push({pubkey:n.value,isSigner:!1,isWritable:!1});let s=_([V("index")]);o=Buffer.alloc(s.span),s.encode({index:7},o)}else if(n.type==="updateAll"){i.push({pubkey:n.value.cpConfigId,isSigner:!1,isWritable:!1});let s=_([V("index"),D("platformClaimFeeWallet"),D("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),ge("name"),ge("web"),ge("img"),D("transferFeeExtensionAuth"),g("creatorFeeRate")]);o=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(n.value.name,"utf-8").length+Buffer.from(n.value.web,"utf-8").length+Buffer.from(n.value.img,"utf-8").length+32+8),s.encode({index:8,platformClaimFeeWallet:n.value.platformClaimFeeWallet,platformLockNftWallet:n.value.platformLockNftWallet,platformScale:n.value.migrateCpLockNftScale.platformScale,creatorScale:n.value.migrateCpLockNftScale.creatorScale,burnScale:n.value.migrateCpLockNftScale.burnScale,feeRate:n.value.feeRate,name:n.value.name,web:n.value.web,img:n.value.img,transferFeeExtensionAuth:n.value.transferFeeExtensionAuth,creatorFeeRate:n.value.creatorFeeRate},o)}else throw Error("updateInfo params type error");return new oe.TransactionInstruction({keys:i,programId:r,data:Buffer.from([...Ae.updatePlaformConfig,...o])})}function Xn(r,e,t,n,i,o,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Ke.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}];return new oe.TransactionInstruction({keys:c,programId:r,data:Ae.claimPlatformFeeFromVault})}function zn(r,e,t,n,i,o,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:oe.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Ke.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}];return new oe.TransactionInstruction({keys:a,programId:r,data:Ae.claimCreatorFee})}var md=new ot.default("18446744073709551615");var h=require("@solana/spl-token"),v=H(require("bn.js")),yt=require("@solana/web3.js");var Te=H(require("bn.js")),Yn=H(require("decimal.js"));var Mt=H(require("bn.js")),ft=H(require("decimal.js"));var He=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var jt=class extends He{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new ft.default(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new ft.default(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new ft.default(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){return new ft.default(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new ft.default(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(i)).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){if(e.lte(n))throw Error("supply need gt total sell");let s=e.sub(n).sub(i);if(s.lte(new Mt.default(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(o);if(a.lte(new Mt.default(0)))throw Error("tfMinusMf <= 0");let c=a.mul(n).mul(n).div(s),u=a.mul(n).div(s).sub(t),f=c.div(u),m=t.mul(t).div(u);if(f.lt(new Mt.default(0))||m.lt(new Mt.default(0)))throw Error("invalid input 0");return{a:f,b:m,c:n}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:n}){let i=e.mul(n),o=t.add(e);return i.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:n}){let i=t.mul(e),o=n.sub(e);return Je(i,o)}};var Ot=H(require("bn.js")),bt=H(require("decimal.js"));var Zt=class extends He{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new bt.default(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new bt.default(t.toString()).div(e.toString()).mul(10**(n-i))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new bt.default(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){return new bt.default(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new bt.default(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new Ot.default(0)))throw Error("invalid input 1");let a=new Ot.default(2).mul(t).sub(o),u=t.mul(s).div(a);if(u.lt(new Ot.default(0))||t.lt(new Ot.default(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:n}){return n.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:n}){let i=t.mul(e);return Je(i,n)}};var be=H(require("bn.js")),Ye=H(require("decimal.js"));var Hn=H(require("bn.js")),Qt=H(require("decimal.js")),Et=class{static _multipler(e){return new Qt.default(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:n}){return new Qt.default(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(n))}static getPriceX64({price:e,decimalA:t,decimalB:n}){let i=e.mul(this._multipler(n)).div(this._multipler(t));return new Hn.default(i.mul(this._Q64).toFixed(0))}};Et._Q64=new Qt.default(new Hn.default(1).shln(64).toString());var Jt=class extends He{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n}){return new Ye.default(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i}){return new Ye.default(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:n}){return new Ye.default(e.virtualA.mul(e.realA).toString()).div(Et._Q64).mul(10**(t-n))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:n,totalFundRaising:i,migrateFee:o,decimalA:s,decimalB:a}){return new Ye.default(i.sub(o).toString()).div(e.sub(t).sub(n).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:n}){let i=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new Ye.default(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(i).toString()).mul(10**(t-n))}static getInitParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,migrateFee:o}){let s=e.sub(i);if(s.lte(new be.default(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new be.default(3)).sub(o),u=t.mul(new be.default(2)).mul(s).div(a),f=u.mul(u),m=t.mul(new be.default(2)).mul(Fe).div(f);if(!m.gt(new be.default(0)))throw Error("a need gt 0");if(!Cn.gt(m))throw Error("a need lt u64 max");if(m.lt(new be.default(0))||u.lt(new be.default(0)))throw Error("invalid input 0");return{a:m,b:new be.default(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let n=e.realB.add(t),i=new be.default(2).mul(n).mul(Fe).div(e.virtualA);return new be.default(new Ye.default(i.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let n=e.realA.add(t),i=n.mul(n);return Je(e.virtualA.mul(i),new be.default(2).mul(Fe)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let n=e.realA.sub(t),i=n.mul(n),o=Je(e.virtualA.mul(i),new be.default(2).mul(Fe));return e.realB.sub(o)}static sellExactOut({poolInfo:e,amount:t}){let n=e.realB.sub(t),i=new be.default(2).mul(n).mul(Fe).div(e.virtualA),o=new be.default(new Ye.default(i.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var we=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:n}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n.supply,totalFundRaising:n.totalFundRaisingB,totalSell:n.totalSellA,totalLockedAmount:n.vestingSchedule.totalLockedAmount,migrateFee:n.migrateFee,decimalA:n.mintDecimalsA,decimalB:n.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let f=this.getCurve(e),m=f.getInitParam({supply:n,totalFundRaising:i,totalSell:o,totalLockedAmount:s,migrateFee:a}),T=f.getPoolInitPriceByInit($(q({},m),{decimalA:c,decimalB:u})),P=i.div(new Te.default(t-1)),l=new Te.default(0),y=[{price:T,totalSellSupply:0}],{a:b,b:x}=m,d=l,K=l;for(let w=1;w<t;w++){let p=w!==t-1?P:i.sub(K),A=this.buyExactIn({poolInfo:{virtualA:b,virtualB:x,realA:d,realB:K,totalFundRaisingB:i,totalSellA:o},amountB:p,protocolFeeRate:l,platformFeeRate:l,curveType:e,shareFeeRate:l,creatorFeeRate:l,transferFeeConfigA:void 0,slot:0});d=d.add(A.amountA.amount),K=K.add(A.amountB);let I=this.getPrice({poolInfo:{virtualA:b,virtualB:x,realA:d,realB:K},decimalA:c,decimalB:u,curveType:e});y.push({price:I,totalSellSupply:new Yn.default(d.toString()).div(10**c).toNumber()})}return y}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n,curveType:i}){return this.getCurve(i).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:n})}static getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:n,decimalB:i})}static getPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getEndPrice({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:n,decimalB:i})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:n,decimalB:i}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:n,decimalB:i})}static checkParam({supply:e,totalFundRaising:t,totalSell:n,totalLockedAmount:i,decimals:o,config:s,migrateType:a}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div($e).lt(i))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new Te.default(10**o))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div($e);if(n.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let f=e.sub(n).sub(i),m=e.mul(s.minMigrateRateA).div($e);if(f.lt(m))throw Error("migrate lt min migrate amoount");let T=e.sub(n).sub(i),P=new Te.default(new Yn.default(T.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let l=new Te.default(10).pow(new Te.default(o));if(P.lte(l))throw Error("check migrate lp error")}else if(a==="cpmm"){let l=new Te.default(100);if(P.lte(l))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:f}),T=t.sub(m),P=this.getCurve(o),l=P.buyExactIn({poolInfo:e,amount:T}),y=e.totalSellA.sub(e.realA),b,x,d;if(l.gt(y)){b=y;let w=P.buyExactOut({poolInfo:e,amount:b});x=this.calculatePreFee({postFeeAmount:w,feeRate:f}),d=x.sub(w)}else b=l,x=t,d=m;let K=this.splitFee({totalFee:d,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:gn(b,c,u),amountB:x,splitFee:K}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=e.totalSellA.sub(e.realA),m=Pn(t,c,u),T=m.fee?m.amount.add(m.fee):m.amount;t.gt(f)&&(T=f);let l=this.getCurve(o).buyExactOut({poolInfo:e,amount:T}),y=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),b=this.calculatePreFee({postFeeAmount:l,feeRate:y}),x=b.sub(l),d=this.splitFee({totalFee:x,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:b,splitFee:d}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.getCurve(o),m=gn(t,c,u),T=m.fee?m.amount.sub(m.fee):m.amount,P=f.sellExactIn({poolInfo:e,amount:T}),l=this.calculateFee({amount:P,feeRate:this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a})}),y=this.splitFee({totalFee:l,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:P.sub(l),splitFee:y}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:n,platformFeeRate:i,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let f=this.totalFeeRate({protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:f});if(e.realB.lt(m))throw Error("Insufficient liquidity");let T=m.sub(t),l=we.getCurve(o).sellExactOut({poolInfo:e,amount:m});if(l.gt(e.realA))throw Error();let y=this.splitFee({totalFee:T,protocolFeeRate:n,platformFeeRate:i,shareFeeRate:s,creatorFeeRate:a});return{amountA:Pn(l,c,u),amountB:t,splitFee:y}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:n,shareFeeRate:i,creatorFeeRate:o}),a=s.isZero()?new Te.default(0):e.mul(n).div(s),c=s.isZero()?new Te.default(0):e.mul(i).div(s),u=s.isZero()?new Te.default(0):e.mul(o).div(s),f=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:f,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return wi(e,t,$e)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let n=e.mul($e),i=$e.sub(t);return n.add(i).sub(new Te.default(1)).div(i)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:n,creatorFeeRate:i}){if(e.add(t).add(n).add(i).gt(new Te.default(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(n).add(i)}static getCurve(e){switch(e){case 0:return jt;case 1:return Zt;case 2:return Jt}throw Error("find curve error")}};var le=H(require("decimal.js")),je={initPriceX64:new v.default("515752397214619"),supply:new v.default(1e15),totalSellA:new v.default(7931e11),totalFundRaisingB:new v.default(85e9),totalLockedAmount:new v.default("0"),cliffPeriod:new v.default("0"),unlockPeriod:new v.default("0"),decimals:6,virtualA:new v.default("1073471847374405"),virtualB:new v.default("30050573465"),realA:new v.default(0),realB:new v.default(0),protocolFee:new v.default(0),platformId:new yt.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new v.default(0),cliffPeriod:new v.default(0),unlockPeriod:new v.default(0),startTime:new v.default(0),totalAllocatedShare:new v.default(0)}},Me=new v.default(1e4),$t=class extends ct{constructor(e){super(e)}async sayHello(){console.log("hello")}async createLaunchpad(L){var R=L,{programId:e=ue,authProgramId:t,platformId:n=je.platformId,mintA:i,decimals:o=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:f,configId:m,snipers:T,configInfo:P,platformFeeRate:l,txVersion:y,computeBudgetConfig:b,txTipConfig:x,feePayer:d,buyAmount:K,minMintAAmount:w,slippage:p,associatedOnly:A=!0,checkCreateATAOwner:I=!1,extraSigners:k,token2022:C,transferFeeExtensionParams:N,creatorFeeOn:F=0}=R,B=Ve(R,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","snipers","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams","creatorFeeOn"]);var Zn,Qn,Jn,$n,ei,ti,ni,ii,oi,ri;let S=[],W=this.createTxBuilder(d);t=t!=null?t:Se(e).publicKey,C=!!N,C&&(f="cpmm");let U=P;if(!U&&m){let he=await this.scope.connection.getAccountInfo(m);he&&(U=De.decode(he.data))}U||this.logAndCreateError("config not found");let X=U.mintB,z=U.curveType,{publicKey:j}=tt(e,i,X),{publicKey:ee}=vn(e,j,i),{publicKey:Q}=vn(e,j,X),{publicKey:ae}=Ln(i);console.log(`create token: ${i.toBase58()}, mintB: ${X.toBase58()}, decimals A:${o}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let Z=(Zn=B==null?void 0:B.supply)!=null?Zn:je.supply,G=(Qn=B==null?void 0:B.totalSellA)!=null?Qn:je.totalSellA,ce=(Jn=B==null?void 0:B.totalFundRaisingB)!=null?Jn:je.totalFundRaisingB,ie=($n=B==null?void 0:B.totalLockedAmount)!=null?$n:new v.default(0),te=l;if(!l){let he=await this.scope.connection.getAccountInfo(n);he||this.logAndCreateError("platform id not found:",n.toString()),te=it.decode(he.data).feeRate}let jn=we.getCurve(U.curveType).getInitParam({supply:Z,totalFundRaising:ce,totalSell:G,totalLockedAmount:ie,migrateFee:U.migrateFee}),Ce={epoch:new v.default(896),bump:254,status:0,mintDecimalsA:o,mintDecimalsB:s,supply:Z,totalSellA:G,mintA:new yt.PublicKey(i),mintB:X,virtualA:jn.a,virtualB:jn.b,realA:je.realA,realB:je.realB,migrateFee:U.migrateFee,migrateType:f==="amm"?0:1,protocolFee:je.protocolFee,platformFee:te,platformId:n,configId:m,vaultA:ee,vaultB:Q,creator:this.scope.ownerPubKey,totalFundRaisingB:ce,vestingSchedule:{totalLockedAmount:ie,cliffPeriod:new v.default(0),unlockPeriod:new v.default(0),startTime:new v.default(0),totalAllocatedShare:new v.default(0)},mintProgramFlag:C?1:0,cpmmCreatorFeeOn:F},co=we.getCurve(U.curveType),{c:lo}=co.getInitParam({supply:Ce.supply,totalFundRaising:Ce.totalFundRaisingB,totalLockedAmount:ie,totalSell:U.curveType===0?Ce.totalSellA:new v.default(0),migrateFee:U.migrateFee});try{we.checkParam({supply:Ce.supply,totalFundRaising:Ce.totalFundRaisingB,totalSell:lo,totalLockedAmount:ie,decimals:Ce.mintDecimalsA,config:U,migrateType:f}),this.logDebug("check init params success")}catch(he){this.logAndCreateError(`check create mint params failed, ${he.message}`)}W.addInstruction({instructions:[C?io(e,d!=null?d:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,j,i,X,ee,Q,o,a,c,u||"https://",{type:z===0?"ConstantCurve":z===1?"FixedCurve":z===2?"LinearCurve":"ConstantCurve",totalSellA:G,migrateType:f,supply:Z,totalFundRaisingB:ce},ie,(ei=B==null?void 0:B.cliffPeriod)!=null?ei:new v.default(0),(ti=B==null?void 0:B.unlockPeriod)!=null?ti:new v.default(0),F,N):no(e,d!=null?d:this.scope.ownerPubKey,this.scope.ownerPubKey,m,n,t,j,i,X,ee,Q,ae,o,a,c,u||"https://",{type:z===0?"ConstantCurve":z===1?"FixedCurve":z===2?"LinearCurve":"ConstantCurve",totalSellA:G,migrateType:f,supply:Z,totalFundRaisingB:ce},ie,(ni=B==null?void 0:B.cliffPeriod)!=null?ni:new v.default(0),(ii=B==null?void 0:B.unlockPeriod)!=null?ii:new v.default(0),F)]});let en=C?await this.scope.connection.getEpochInfo():void 0,Oe=N?{epoch:BigInt((en==null?void 0:en.epoch)||0),maximumFee:BigInt((oi=N==null?void 0:N.maxinumFee.toString())!=null?oi:0),transferFeeBasisPoints:(ri=N==null?void 0:N.transferFeeBasePoints)!=null?ri:0}:void 0,tn={amountA:{amount:new v.default(0),fee:void 0,expirationTime:void 0},amountB:new v.default(0),splitFee:{platformFee:new v.default(0),shareFee:new v.default(0),protocolFee:new v.default(0),creatorFee:new v.default(0)}},nn;if(k!=null&&k.length&&W.addInstruction({signers:k}),!B.createOnly){let{builder:he,extInfo:mo}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:C?h.TOKEN_2022_PROGRAM_ID:void 0,mintA:i,mintB:X,poolInfo:Ce,buyAmount:K,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:U,platformFeeRate:te,slippage:p,associatedOnly:A,checkCreateATAOwner:I,skipCheckMintA:!Oe,transferFeeConfigA:Oe?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Oe,newerTransferFee:Oe}:void 0,fromCreate:!0});console.log("FEE: ",Oe),console.log("PREPARING SNIPER TRANSACTIONS");for(let si of T){let{builder:po,extInfo:Nr}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:C?h.TOKEN_2022_PROGRAM_ID:void 0,mintA:i,mintB:X,poolInfo:Ce,buyAmount:si.amount,minMintAAmount:w,shareFeeRate:B.shareFeeRate,shareFeeReceiver:B.shareFeeReceiver,configInfo:U,platformFeeRate:te,slippage:p,sniper:si,associatedOnly:A,checkCreateATAOwner:I,skipCheckMintA:!Oe,transferFeeConfigA:Oe?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Oe,newerTransferFee:Oe}:void 0,fromCreate:!0});S.push($(q({},po.AllTxData),{blockHash:this.scope.blockhashCommitment}))}W.addInstruction(q({},he.AllTxData)),tn=q({},mo),nn=(this.scope.cluster==="devnet"||y===1)&&B.shareFeeReceiver?[he.allInstructions[0]]:void 0}return y===0?(console.log("VERSION V0"),{tx:await W.sizeCheckBuildV0({computeBudgetConfig:b,swapInfo:tn,splitIns:nn,address:$(q({},Ce),{poolId:j})}),txs:S}):(console.log("VERSION PLAIN"),{tx:await W.sizeCheckBuild({computeBudgetConfig:b,swapInfo:tn,splitIns:nn,address:$(q({},Ce),{poolId:j})}),txs:S})}async buyTokenOriginal({programId:e=ue,authProgramId:t,mintA:n,mintAProgram:i=h.TOKEN_PROGRAM_ID,mintB:o=h.NATIVE_MINT,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,buyAmount:P,minMintAAmount:l,slippage:y,sniper:b,shareFeeRate:x=new v.default(0),shareFeeReceiver:d,associatedOnly:K=!0,checkCreateATAOwner:w=!1,fromCreate:p=!1,transferFeeConfigA:A,skipCheckMintA:I=!1}){var Z,G,ce;P.lte(new v.default(0))&&this.logAndCreateError("buy amount should gt 0:",P.toString());let k=b?this.createSniperTxBuilder(b.owner,b.owner.publicKey):this.createTxBuilder(T),{publicKey:C}=tt(e,n,o);t=t!=null?t:Se(e).publicKey;let N=A;if(!I)if(console.log("!skipCheckMintA: ",I),N)console.log("TOKEN_2022_PROGRAM_ID: ",h.TOKEN_2022_PROGRAM_ID),i=h.TOKEN_2022_PROGRAM_ID;else{console.log("!transferFeeConfigA: ",N);let ie=await this.scope.connection.getAccountInfo(n);if(ie&&ie.owner.equals(h.TOKEN_2022_PROGRAM_ID)){console.log("TOKEN_2022_PROGRAM_ID: ",I),i=ie.owner;let te=(0,h.unpackMint)(n,ie,i);N=(0,h.getTransferFeeConfig)(te)||void 0}}let F=this.scope.account.getAssociatedTokenAccount(n,i),B=p?this.scope.account.getAssociatedTokenAccount(o,h.TOKEN_PROGRAM_ID):null,L=o.equals(h.NATIVE_MINT);if(k.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,F,this.scope.ownerPubKey,n,i),...p?[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,B,this.scope.ownerPubKey,o,h.TOKEN_PROGRAM_ID),yt.SystemProgram.transfer({fromPubkey:this.scope.ownerPubKey,toPubkey:B,lamports:BigInt(P.toString())}),(0,h.createSyncNativeInstruction)(B)]:[]]}),!p){let{account:ie,instructionParams:te}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:L?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!L,notUseTokenAccount:L,associatedOnly:L?!1:K,checkCreateATAOwner:w});ie&&(B=ie),k.addInstruction(te||{})}B===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let R=s;if(!R){let ie=await this.scope.connection.getAccountInfo(C,{commitment:"processed"});ie||this.logAndCreateError("cannot found pool:",C.toBase58()),R=Be.decode(ie.data)}let S=a,W=await Le(this.scope.connection,[S?void 0:R.configId,R.platformId].filter(Boolean).map(ie=>({pubkey:ie})));if(!S){let ie=W.find(te=>te.pubkey.equals(R.configId));(!ie||!ie.accountInfo)&&this.logAndCreateError("config not found: ",R.configId.toBase58()),S=De.decode(ie.accountInfo.data)}let U=W.find(ie=>ie.pubkey.equals(R.platformId));(!U||!U.accountInfo)&&this.logAndCreateError("platform info not found: ",R.configId.toBase58());let X=it.decode(U.accountInfo.data);c=c||X.feeRate;let z=we.buyExactIn({poolInfo:R,amountB:P,protocolFeeRate:S.tradeFeeRate,platformFeeRate:c,curveType:S.curveType,shareFeeRate:x,creatorFeeRate:X.creatorFeeRate,transferFeeConfigA:N,slot:await this.scope.connection.getSlot()}),j=new le.default(z.amountA.amount.toString()).sub((G=(Z=z.amountA.fee)==null?void 0:Z.toString())!=null?G:0),ee=y?new le.default(Me.sub(y).toNumber()/Me.toNumber()).clampedTo(0,1):new le.default(1),Q=l!=null?l:y?new v.default(j.mul(ee).toFixed(0)):z.amountA.amount.sub((ce=z.amountA.fee)!=null?ce:new v.default(0));z.amountB.lt(P)&&console.log(`maximum ${n.toBase58()} amount can buy is ${z.amountA.toString()}, input ${o.toBase58()} amount: ${z.amountB.toString()}`);let ae=d?ke(d,o,h.TOKEN_PROGRAM_ID).publicKey:void 0;return ae&&k.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,ae,d,o)]}),k.addInstruction({instructions:[_n(e,this.scope.ownerPubKey,t,R.configId,R.platformId,C,F,B,R.vaultA,R.vaultB,n,o,i,h.TOKEN_PROGRAM_ID,Xe(e,R.platformId,o).publicKey,ze(e,R.creator,o).publicKey,z.amountB.lt(P)?z.amountB:P,Q,x,ae)]}),k.addCustomComputeBudget(f),k.addTipInstruction(m),k.versionBuild({txVersion:u,extInfo:$(q({},z),{decimalOutAmount:j,minDecimalOutAmount:new le.default(Q.toString())})})}async buyToken({programId:e=ue,authProgramId:t,mintA:n,mintAProgram:i=h.TOKEN_PROGRAM_ID,mintB:o=h.NATIVE_MINT,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,buyAmount:P,minMintAAmount:l,slippage:y,shareFeeRate:b=new v.default(0),shareFeeReceiver:x,sniper:d,associatedOnly:K=!0,checkCreateATAOwner:w=!1,fromCreate:p=!1,transferFeeConfigA:A,skipCheckMintA:I=!1}){var G,ce,ie;P.lte(new v.default(0))&&this.logAndCreateError("buy amount should gt 0:",P.toString());let k=d?this.createSniperTxBuilder(d.owner,d.owner.publicKey):this.createTxBuilder(T),{publicKey:C}=tt(e,n,o);t=t!=null?t:Se(e).publicKey;let N=A;if(!I)if(console.log("!skipCheckMintA: ",I),N)console.log("mintAProgram: ",h.TOKEN_2022_PROGRAM_ID),i=h.TOKEN_2022_PROGRAM_ID;else{console.log("!transferFeeConfigA: ",N);let te=await this.scope.connection.getAccountInfo(n);if(te&&te.owner.equals(h.TOKEN_2022_PROGRAM_ID)){console.log("!mintInfo: ",te),i=te.owner;let rt=(0,h.unpackMint)(n,te,i);N=(0,h.getTransferFeeConfig)(rt)||void 0}}let F=d?this.scope.account.getAssociatedTokenAccountByOwner(d.owner.publicKey,n,i):this.scope.account.getAssociatedTokenAccount(n,i),B=p?d?this.scope.account.getAssociatedTokenAccountByOwner(d.owner.publicKey,o,h.TOKEN_PROGRAM_ID):this.scope.account.getAssociatedTokenAccount(o,h.TOKEN_PROGRAM_ID):null,L=o.equals(h.NATIVE_MINT);console.log("userTokenAccountA: ",F),console.log("userTokenAccountB: ",B);let R=[(0,h.createAssociatedTokenAccountIdempotentInstruction)((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,F,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,n,i),...p?[(0,h.createAssociatedTokenAccountIdempotentInstruction)((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,B,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,o,h.TOKEN_PROGRAM_ID),yt.SystemProgram.transfer({fromPubkey:(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,toPubkey:B,lamports:BigInt(P.toString())}),(0,h.createSyncNativeInstruction)(B)]:[]];if(console.log("adding ixs: ",R),k.addInstruction({instructions:R}),!p){let{account:te,instructionParams:rt}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:L?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!L,notUseTokenAccount:L,associatedOnly:L?!1:K,checkCreateATAOwner:w});te&&(B=te),k.addInstruction(rt||{})}B===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let te=await this.scope.connection.getAccountInfo(C,{commitment:"processed"});te||this.logAndCreateError("cannot found pool:",C.toBase58()),S=Be.decode(te.data)}let W=a,U=await Le(this.scope.connection,[W?void 0:S.configId,S.platformId].filter(Boolean).map(te=>({pubkey:te})));if(!W){let te=U.find(rt=>rt.pubkey.equals(S.configId));(!te||!te.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),W=De.decode(te.accountInfo.data)}let X=U.find(te=>te.pubkey.equals(S.platformId));(!X||!X.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let z=it.decode(X.accountInfo.data);c=c||z.feeRate;let j=we.buyExactIn({poolInfo:S,amountB:P,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:b,creatorFeeRate:z.creatorFeeRate,transferFeeConfigA:N,slot:await this.scope.connection.getSlot()}),ee=new le.default(j.amountA.amount.toString()).sub((ce=(G=j.amountA.fee)==null?void 0:G.toString())!=null?ce:0),Q=y?new le.default(Me.sub(y).toNumber()/Me.toNumber()).clampedTo(0,1):new le.default(1),ae=l!=null?l:y?new v.default(ee.mul(Q).toFixed(0)):j.amountA.amount.sub((ie=j.amountA.fee)!=null?ie:new v.default(0));j.amountB.lt(P)&&console.log(`maximum ${n.toBase58()} amount can buy is ${j.amountA.toString()}, input ${o.toBase58()} amount: ${j.amountB.toString()}`);let Z=x?ke(x,o,h.TOKEN_PROGRAM_ID).publicKey:void 0;return Z&&k.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)((d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,Z,x,o)]}),k.addInstruction({instructions:[_n(e,(d==null?void 0:d.owner.publicKey)||this.scope.ownerPubKey,t,S.configId,S.platformId,C,F,B,S.vaultA,S.vaultB,n,o,i,h.TOKEN_PROGRAM_ID,Xe(e,S.platformId,o).publicKey,ze(e,S.creator,o).publicKey,j.amountB.lt(P)?j.amountB:P,ae,b,Z)]}),k.addCustomComputeBudget(f),k.addTipInstruction(m),k.versionBuild({txVersion:u,extInfo:$(q({},j),{decimalOutAmount:ee,minDecimalOutAmount:new le.default(ae.toString())})})}async buyTokenExactOut({programId:e=ue,authProgramId:t,mintA:n,mintAProgram:i=h.TOKEN_PROGRAM_ID,mintB:o=h.NATIVE_MINT,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:f,computeBudgetConfig:m,txTipConfig:T,feePayer:P,maxBuyAmount:l,outAmount:y,slippage:b,shareFeeRate:x=new v.default(0),shareFeeReceiver:d,associatedOnly:K=!0,checkCreateATAOwner:w=!1,skipCheckMintA:p=!1}){y.lte(new v.default(0))&&this.logAndCreateError("out amount should gt 0:",y.toString());let A=this.createTxBuilder(P),{publicKey:I}=tt(e,n,o);t=t!=null?t:Se(e).publicKey;let k=s;if(!k){let Z=await this.scope.connection.getAccountInfo(I,{commitment:"processed"});Z||this.logAndCreateError("cannot found pool:",I.toBase58()),k=Be.decode(Z.data)}let C=a,N=await Le(this.scope.connection,[C?void 0:k.configId,k.platformId].filter(Boolean).map(Z=>({pubkey:Z})));if(!C){let Z=N.find(G=>G.pubkey.equals(k.configId));(!Z||!Z.accountInfo)&&this.logAndCreateError("config not found: ",k.configId.toBase58()),C=De.decode(Z.accountInfo.data)}let F=N.find(Z=>Z.pubkey.equals(k.platformId));(!F||!F.accountInfo)&&this.logAndCreateError("platform info not found: ",k.configId.toBase58());let B=it.decode(F.accountInfo.data);u=u||B.feeRate;let L=c;if(!p)if(L)i=h.TOKEN_2022_PROGRAM_ID;else{let Z=await this.scope.connection.getAccountInfo(n);if(Z&&Z.owner.equals(h.TOKEN_2022_PROGRAM_ID)){i=Z.owner;let G=(0,h.unpackMint)(n,Z,i);L=(0,h.getTransferFeeConfig)(G)||void 0}}let R=we.buyExactOut({poolInfo:k,amountA:y,protocolFeeRate:C.tradeFeeRate,platformFeeRate:u,curveType:C.curveType,shareFeeRate:x,creatorFeeRate:B.creatorFeeRate,transferFeeConfigA:L,slot:await this.scope.connection.getSlot()}),S=new le.default(R.amountB.toString()),W=b?new le.default(Me.add(b).toNumber()/Me.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new le.default(1),U=(l!=null?l:b)?new v.default(S.mul(W).toFixed(0)):R.amountB,X=this.scope.account.getAssociatedTokenAccount(n,i),z=null,j=o.equals(h.NATIVE_MINT);A.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,X,this.scope.ownerPubKey,n,i)]});let{account:ee,instructionParams:Q}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:j?{payer:this.scope.ownerPubKey,amount:R.amountB}:void 0,skipCloseAccount:!j,notUseTokenAccount:j,associatedOnly:j?!1:K,checkCreateATAOwner:w});ee&&(z=ee),A.addInstruction(Q||{}),z===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let ae=d?ke(d,o,h.TOKEN_PROGRAM_ID).publicKey:void 0;return ae&&A.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,ae,d,o)]}),A.addInstruction({instructions:[oo(e,this.scope.ownerPubKey,t,k.configId,k.platformId,I,X,z,k.vaultA,k.vaultB,n,o,i,h.TOKEN_PROGRAM_ID,Xe(e,k.platformId,o).publicKey,ze(e,k.creator,o).publicKey,y,U,x,ae)]}),A.addCustomComputeBudget(m),A.addTipInstruction(T),A.versionBuild({txVersion:f,extInfo:{maxSpentAmount:U,outAmount:y}})}async sellToken({programId:e=ue,authProgramId:t,mintAProgram:n=h.TOKEN_PROGRAM_ID,mintA:i,mintB:o=h.NATIVE_MINT,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,sellAmount:P,minAmountB:l,slippage:y,shareFeeRate:b=new v.default(0),shareFeeReceiver:x,associatedOnly:d=!0,checkCreateATAOwner:K=!1,skipCheckMintA:w=!1}){t=t!=null?t:Se(e).publicKey;let p=this.createTxBuilder(T);P.lte(new v.default(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:A}=tt(e,i,o),I;if(!w){let G=await this.scope.connection.getAccountInfo(i);if(G&&G.owner.equals(h.TOKEN_2022_PROGRAM_ID)){n=G.owner;let ce=(0,h.unpackMint)(i,G,n);I=(0,h.getTransferFeeConfig)(ce)||void 0}}let k=null,C=null,N=o.equals(h.NATIVE_MINT),{account:F,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:d,checkCreateATAOwner:K});F&&(k=F),p.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:N?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!N,notUseTokenAccount:N,associatedOnly:N?!1:d,checkCreateATAOwner:K});L&&(C=L),p.addInstruction(R||{}),C===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let G=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});G||this.logAndCreateError("cannot found pool",A.toBase58()),S=Be.decode(G.data)}let W=a,U=await Le(this.scope.connection,[W?void 0:S.configId,S.platformId].filter(Boolean).map(G=>({pubkey:G})));if(!W){let G=U.find(ce=>ce.pubkey.equals(S.configId));(!G||!G.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),W=De.decode(G.accountInfo.data)}let X=U.find(G=>G.pubkey.equals(S.platformId));(!X||!X.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let z=it.decode(X.accountInfo.data);c=c||z.feeRate;let j=we.sellExactIn({poolInfo:S,amountA:P,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:b,creatorFeeRate:z.creatorFeeRate,transferFeeConfigA:I,slot:await this.scope.connection.getSlot()}),ee=new le.default(j.amountB.toString()),Q=y?new le.default(Me.sub(y).toNumber()/Me.toNumber()).clampedTo(0,1):new le.default(1),ae=l!=null?l:y?new v.default(ee.mul(Q).toFixed(0)):j.amountB;ae.lte(new v.default(0))&&this.logAndCreateError(`out ${o.toBase58()} amount should be gt 0`);let Z=x?ke(x,o,h.TOKEN_PROGRAM_ID).publicKey:void 0;return Z&&p.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,Z,x,o)]}),p.addInstruction({instructions:[ro(e,this.scope.ownerPubKey,t,S.configId,S.platformId,A,k,C,S.vaultA,S.vaultB,i,o,n,h.TOKEN_PROGRAM_ID,Xe(e,S.platformId,o).publicKey,ze(e,S.creator,o).publicKey,j.amountA.amount.lt(P)?j.amountA.amount:P,ae,b,Z)]}),p.addCustomComputeBudget(f),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{outAmount:ae}})}async sellTokenExactOut({programId:e=ue,authProgramId:t,mintAProgram:n=h.TOKEN_PROGRAM_ID,mintA:i,mintB:o=h.NATIVE_MINT,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T,inAmount:P,maxSellAmount:l,slippage:y,shareFeeRate:b=new v.default(0),shareFeeReceiver:x,associatedOnly:d=!0,checkCreateATAOwner:K=!1,skipCheckMintA:w=!1}){t=t!=null?t:Se(e).publicKey;let p=this.createTxBuilder(T);l!=null&&l.lte(new v.default(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:A}=tt(e,i,o),I;if(!w){let G=await this.scope.connection.getAccountInfo(i);if(G&&G.owner.equals(h.TOKEN_2022_PROGRAM_ID)){n=G.owner;let ce=(0,h.unpackMint)(i,G,n);I=(0,h.getTransferFeeConfig)(ce)||void 0}}let k=null,C=null,N=o.equals(h.NATIVE_MINT),{account:F,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n,mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:d,checkCreateATAOwner:K});F&&(k=F),p.addInstruction(B||{}),k===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:L,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:N?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!N,notUseTokenAccount:N,associatedOnly:N?!1:d,checkCreateATAOwner:K});L&&(C=L),p.addInstruction(R||{}),C===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let G=await this.scope.connection.getAccountInfo(A,{commitment:"processed"});G||this.logAndCreateError("cannot found pool",A.toBase58()),S=Be.decode(G.data)}let W=a,U=await Le(this.scope.connection,[W?void 0:S.configId,S.platformId].filter(Boolean).map(G=>({pubkey:G})));if(!W){let G=U.find(ce=>ce.pubkey.equals(S.configId));(!G||!G.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),W=De.decode(G.accountInfo.data)}let X=U.find(G=>G.pubkey.equals(S.platformId));(!X||!X.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let z=it.decode(X.accountInfo.data);c=c||z.feeRate;let j=we.sellExactOut({poolInfo:S,amountB:P,protocolFeeRate:W.tradeFeeRate,platformFeeRate:c,curveType:W.curveType,shareFeeRate:b,creatorFeeRate:z.creatorFeeRate,transferFeeConfigA:I,slot:await this.scope.connection.getSlot()}),ee=new le.default(j.amountA.amount.toString()),Q=y?new le.default(Me.add(y).toNumber()/Me.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new le.default(1),ae=(l!=null?l:y)?new v.default(ee.mul(Q).toFixed(0)):j.amountA.amount,Z=x?ke(x,o,h.TOKEN_PROGRAM_ID).publicKey:void 0;return Z&&p.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,Z,x,o)]}),p.addInstruction({instructions:[so(e,this.scope.ownerPubKey,t,S.configId,S.platformId,A,k,C,S.vaultA,S.vaultB,i,o,n,h.TOKEN_PROGRAM_ID,Xe(e,S.platformId,o).publicKey,ze(e,S.creator,o).publicKey,P,ae,b,Z)]}),p.addCustomComputeBudget(f),p.addTipInstruction(m),p.versionBuild({txVersion:u,extInfo:{maxSellAmount:ae}})}async createPlatformConfig({programId:e=ue,platformAdmin:t,platformClaimFeeWallet:n,platformLockNftWallet:i,cpConfigId:o,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:c,feeRate:u,name:f,web:m,img:T,txVersion:P,computeBudgetConfig:l,txTipConfig:y,feePayer:b}){let x=this.createTxBuilder(b),{publicKey:d}=Wn(e,t);return x.addInstruction({instructions:[ao(e,t,n,i,d,o,a,s,u,c,f,m,T)]}),x.addCustomComputeBudget(l),x.addTipInstruction(y),x.versionBuild({txVersion:P,extInfo:{platformId:d}})}async updatePlatformConfig({programId:e=ue,platformAdmin:t,platformId:n,updateInfo:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=n!=null?n:Wn(e,t).publicKey;return u.addInstruction({instructions:[uo(e,t,f,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimPlatformFee({programId:e=ue,authProgramId:t,platformId:n,poolId:i,platformClaimFeeWallet:o,mintB:s,vaultB:a,mintBProgram:c=h.TOKEN_PROGRAM_ID,txVersion:u,computeBudgetConfig:f,txTipConfig:m,feePayer:T}){var x;let P=this.createTxBuilder(T);t=t!=null?t:Se(e).publicKey;let l=s,y=a;if(!l){let d=await this.scope.connection.getAccountInfo(i,{commitment:"processed"});d||this.logAndCreateError("cannot found pool:",i.toBase58());let K=Be.decode(d.data),w=await this.scope.connection.getAccountInfo(K.configId,{commitment:"processed"});w||this.logAndCreateError("cannot found config:",K.configId.toBase58()),l=De.decode(w.data).mintB,y=y!=null?y:K.vaultB}(!l||!y)&&this.logAndCreateError("cannot found mint info, mintB: ",l.toBase58(),", vaultB: ",(x=y==null?void 0:y.toBase58())!=null?x:"");let b=ke(this.scope.ownerPubKey,l,h.TOKEN_PROGRAM_ID).publicKey;return P.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,b,this.scope.ownerPubKey,l)]}),P.addInstruction({instructions:[Un(e,o,t,i,n,y,b,l,c)]}),P.addCustomComputeBudget(f),P.addTipInstruction(m),P.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=ue,authProgramId:t,platformId:n,platformClaimFeeWallet:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:Se(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Be.span},{memcmp:{offset:Be.offsetOf("platformId"),bytes:n.toString()}}]})).forEach(m=>{let T=Be.decode(m.account.data);if(T.platformFee.lte(new v.default(0)))return;let P=ke(this.scope.ownerPubKey,T.mintB,h.TOKEN_PROGRAM_ID).publicKey;u.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,P,this.scope.ownerPubKey,T.mintB)]}),u.addInstruction({instructions:[Un(e,i,t,m.pubkey,n,T.vaultB,P,T.mintB,h.TOKEN_PROGRAM_ID)]})}),u.addTipInstruction(a),o===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=ue,poolId:t,beneficiary:n,shareAmount:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=await this.getRpcPoolInfo({poolId:t});i.add(f.vestingSchedule.totalAllocatedShare).gt(f.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=Ft(e,t,n).publicKey;return u.addInstruction({instructions:[Gn(e,this.scope.ownerPubKey,n,t,m,i)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async createMultipleVesting({programId:e=ue,poolId:t,beneficiaryList:n,txVersion:i,computeBudgetConfig:o,feePayer:s}){let a=this.createTxBuilder(s);n.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return n.reduce((f,m)=>f.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),n.forEach(f=>{let m=Ft(e,t,f.wallet).publicKey;a.addInstruction({instructions:[Gn(e,this.scope.ownerPubKey,f.wallet,t,m,f.shareAmount)]})}),i===0?a.sizeCheckBuildV0({computeBudgetConfig:o}):a.sizeCheckBuild({computeBudgetConfig:o})}async claimVesting({programId:e=ue,poolId:t,poolInfo:n,vestingRecord:i,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),f=Se(e).publicKey,m=i||Ft(e,t,this.scope.ownerPubKey).publicKey,T=n;if(!T){let l=await this.scope.connection.getAccountInfo(t);l||this.logAndCreateError("pool not found"),T=Be.decode(l.data)}let P=ke(this.scope.ownerPubKey,T.mintA,h.TOKEN_PROGRAM_ID).publicKey;return u.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,P,this.scope.ownerPubKey,T.mintA)]}),u.addInstruction({instructions:[qn(e,this.scope.ownerPubKey,f,t,m,P,T.vaultA,T.mintA,h.TOKEN_PROGRAM_ID)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimMultiVesting({programId:e=ue,poolIdList:t,poolsInfo:n={},vestingRecords:i={},txVersion:o,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=q({},n),f=Se(e).publicKey,m=t.filter(T=>!u[T.toBase58()]);if(m.length){let T=await this.getRpcPoolsInfo({poolIdList:m});u=q(q({},u),T.poolInfoMap)}return t.forEach(T=>{let P=T.toBase58(),l=u[P];l||this.logAndCreateError(`pool info not found: ${P}`);let y=i[P]||Ft(e,T,this.scope.ownerPubKey).publicKey,b=ke(this.scope.ownerPubKey,l.mintA,h.TOKEN_PROGRAM_ID).publicKey;c.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,b,this.scope.ownerPubKey,l.mintA)]}),c.addInstruction({instructions:[qn(e,this.scope.ownerPubKey,f,T,y,b,l.vaultA,l.mintA,h.TOKEN_PROGRAM_ID)]})}),o===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=ue,platformId:t,mintB:n,mintBProgram:i=h.TOKEN_PROGRAM_ID,claimFeeWallet:o,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let f=this.createTxBuilder(u),m=Xe(e,t,n).publicKey,T=Dn(e).publicKey,P=this.scope.account.getAssociatedTokenAccount(n,i);return f.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,P,this.scope.ownerPubKey,n,i),Xn(e,t,o!=null?o:this.scope.ownerPubKey,T,m,P,n,i)]}),f.addCustomComputeBudget(a),f.addTipInstruction(c),f.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=ue,platformList:t,unwrapSol:n=!0,txVersion:i,computeBudgetConfig:o,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),f={};return t.forEach(async m=>{var b,x;let T=Dn(e).publicKey,P=Xe(e,m.id,m.mintB).publicKey,l=m.mintB.equals(h.NATIVE_MINT)&&n,y=f[m.mintB.toBase58()];if(!y){let{account:d,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:l?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!l,notUseTokenAccount:l,associatedOnly:l?!1:a,checkCreateATAOwner:c});d&&(y=d),u.addInstruction(K||{}),y===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[Xn(e,m.id,(b=m.claimFeeWallet)!=null?b:this.scope.ownerPubKey,P,T,y,m.mintB,(x=m.mintBProgram)!=null?x:h.TOKEN_PROGRAM_ID)]})}),i===0?u.sizeCheckBuildV0({computeBudgetConfig:o}):u.sizeCheckBuild({computeBudgetConfig:o})}async claimCreatorFee({programId:e=ue,mintB:t,mintBProgram:n=h.TOKEN_PROGRAM_ID,txVersion:i,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=ze(e,this.scope.ownerPubKey,t).publicKey,f=Vn(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,n);return c.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,n),zn(e,this.scope.ownerPubKey,f,u,m,t,n)]}),c.addCustomComputeBudget(o),c.addTipInstruction(s),c.versionBuild({txVersion:i})}async claimMultipleCreatorFee({programId:e=ue,mintBList:t,txVersion:n,computeBudgetConfig:i,feePayer:o}){let s=this.createTxBuilder(o);return t.forEach(a=>{var P;let c=a.pubKey,u=(P=a.programId)!=null?P:h.TOKEN_PROGRAM_ID,f=ze(e,this.scope.ownerPubKey,c).publicKey,m=Vn(e).publicKey,T=this.scope.account.getAssociatedTokenAccount(c,u);s.addInstruction({instructions:[(0,h.createAssociatedTokenAccountIdempotentInstruction)(this.scope.ownerPubKey,T,this.scope.ownerPubKey,c,u),zn(e,this.scope.ownerPubKey,m,f,T,c,u)]})}),n==0?s.sizeCheckBuildV0({computeBudgetConfig:i}):s.sizeCheckBuild({computeBudgetConfig:i})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let n=await Le(this.scope.connection,e.map(c=>({pubkey:c})),t),i={},o=[];for(let c=0;c<e.length;c++){let u=n[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let f=Be.decode(u.accountInfo.data);i[e[c].toBase58()]=$(q({},f),{poolId:u.accountInfo.owner}),o.push(f.configId)}let s=await Le(this.scope.connection,o.map(c=>({pubkey:c})),t),a={};for(let c=0;c<o.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+o[c].toBase58());let f=De.decode(u.accountInfo.data);a[o[c].toBase58()]=$(q({},f),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(i).reduce((c,u)=>$(q({},c),{[u]:$(q({},i[u]),{configInfo:a[i[u].configId.toBase58()]})}),{})}}};0&&(module.exports={LaunchpadPoolInitParam});
//# sourceMappingURL=launchpad.js.map