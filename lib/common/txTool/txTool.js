var ct=Object.create;var ne=Object.defineProperty,ut=Object.defineProperties,lt=Object.getOwnPropertyDescriptor,mt=Object.getOwnPropertyDescriptors,pt=Object.getOwnPropertyNames,pe=Object.getOwnPropertySymbols,dt=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Oe=(n,e,t)=>e in n?ne(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,W=(n,e)=>{for(var t in e||(e={}))Ae.call(e,t)&&Oe(n,t,e[t]);if(pe)for(var t of pe(e))Ve.call(e,t)&&Oe(n,t,e[t]);return n},j=(n,e)=>ut(n,mt(e));var de=(n,e)=>{var t={};for(var r in n)Ae.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&pe)for(var r of pe(n))e.indexOf(r)<0&&Ve.call(n,r)&&(t[r]=n[r]);return t};var ft=(n,e)=>{for(var t in e)ne(n,t,{get:e[t],enumerable:!0})},We=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let T of pt(e))!Ae.call(n,T)&&T!==t&&ne(n,T,{get:()=>e[T],enumerable:!(r=lt(e,T))||r.enumerable});return n};var _=(n,e,t)=>(t=n!=null?ct(dt(n)):{},We(e||!n||!n.__esModule?ne(t,"default",{value:n,enumerable:!0}):t,n)),gt=n=>We(ne({},"__esModule",{value:!0}),n);var Nt={};ft(Nt,{TxBuilder:()=>Fe});module.exports=gt(Nt);var B=require("@solana/web3.js"),st=_(require("axios"));var U=require("@solana/web3.js");var it=require("@solana/web3.js");var q=_(require("bn.js")),Ct=_(require("decimal.js"));var Ge=_(require("big.js")),xt=_(require("bn.js"));var re=require("lodash");var Pe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},_e={},ht={};function v(n){let e=(0,re.get)(_e,n);if(!e){let t=(0,re.get)(ht,n);e=new Pe({name:n,logLevel:t}),(0,re.set)(_e,n,e)}return e}var Ke=_(require("toformat")),Tt=Ke.default,ie=Tt;var oe=_(require("big.js")),Ue=_(require("bn.js")),qe=_(require("decimal.js-light"));var Q=_(require("bn.js"));var ve=9007199254740991;function H(n){let e=v("Raydium_parseBigNumberish");if(n instanceof Q.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new Q.default(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=ve||n<=-ve)&&e.logWithError(`BigNumberish number overflow: ${n}`),new Q.default(String(n))):typeof n=="bigint"?new Q.default(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new Q.default(0))}var fe=v("module/fraction"),Se=ie(oe.default),se=ie(qe.default),yt={[0]:se.ROUND_DOWN,[1]:se.ROUND_HALF_UP,[2]:se.ROUND_UP},wt={[0]:oe.default.roundDown,[1]:oe.default.roundHalfUp,[2]:oe.default.roundUp},N=class{constructor(e,t=new Ue.default(1)){this.numerator=H(e),this.denominator=H(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(e){let t=e instanceof N?e:new N(H(e));return this.denominator.eq(t.denominator)?new N(this.numerator.add(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof N?e:new N(H(e));return this.denominator.eq(t.denominator)?new N(this.numerator.sub(t.numerator),this.denominator):new N(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof N?e:new N(H(e));return new N(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof N?e:new N(H(e));return new N(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||fe.logWithError(`${e} is not an integer.`),e<=0&&fe.logWithError(`${e} is not positive.`),se.set({precision:e+1,rounding:yt[r]});let T=new se(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return T.toFormat(T.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||fe.logWithError(`${e} is not an integer.`),e<0&&fe.logWithError(`${e} is negative.`),Se.DP=e,Se.RM=wt[r]||1,new Se(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Qt=v("Raydium_amount"),$t=ie(Ge.default);var He=require("@solana/web3.js"),Be=require("@solana/spl-token"),je={chainId:101,address:He.PublicKey.default.toBase58(),programId:Be.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},J={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Be.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ge=require("@solana/web3.js");var I=require("@solana/web3.js"),ze=require("@solana/spl-token");function Ce({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var rn=[Ce({pubkey:ze.TOKEN_PROGRAM_ID,isWritable:!1}),Ce({pubkey:I.SystemProgram.programId,isWritable:!1}),Ce({pubkey:I.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Ze({publicKey:n,transformSol:e}){let t=Je(n.toString());if(t instanceof I.PublicKey)return e&&t.equals(ae)?ke:t;if(e&&t.toString()===ae.toBase58())return ke;if(typeof t=="string"){if(t===I.PublicKey.default.toBase58())return I.PublicKey.default;try{return new I.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Je(n){try{return new I.PublicKey(n)}catch{return n}}var on=new I.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),sn=new I.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),an=new I.PublicKey("SysvarRent111111111111111111111111111111111"),cn=new I.PublicKey("SysvarC1ock11111111111111111111111111111111"),un=new I.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ln=new I.PublicKey("Sysvar1nstructions1111111111111111111111111"),mn=I.SystemProgram.programId,pn=new I.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),dn=new I.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),fn=new I.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),gn=new I.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),hn=new I.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Tn=new I.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),bn=new I.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),yn=new I.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),wn=new I.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),xn=new I.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),An=new I.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ke=new I.PublicKey("So11111111111111111111111111111111111111112"),ae=I.PublicKey.default;var Ie=class{constructor({mint:e,decimals:t,symbol:r,name:T,skipMint:m=!1,isToken2022:f=!1}){if(e===ae.toBase58()||e instanceof ge.PublicKey&&ae.equals(e)){this.decimals=J.decimals,this.symbol=J.symbol,this.name=J.name,this.mint=new ge.PublicKey(J.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=r||e.toString().substring(0,6),this.name=T||e.toString().substring(0,6),this.mint=m?ge.PublicKey.default:Ze({publicKey:e}),this.isToken2022=f}equals(e){return this===e?!0:this.mint.equals(e.mint)}},$=Ie;$.WSOL=new Ie(j(W({},J),{mint:J.address}));var Re=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},he=Re;he.SOL=new Re(je);var Xe=_(require("bn.js"));var Ln=new N(new Xe.default(100));var Wn=v("Raydium_price");var St=require("@solana/web3.js"),Bt=_(require("bn.js"));var Pt=new q.default(0),gr=new q.default(1),hr=new q.default(2),Tr=new q.default(3),br=new q.default(5),At=new q.default(10),yr=new q.default(100),wr=new q.default(1e3),xr=new q.default(1e4);function De(n,e=1,t=[]){let r=[...n];if(e<=0)return t;for(;r.length;)t.push(r.splice(0,e));return t}var Dt=require("@solana/web3.js"),Mt=require("@solana/spl-token");var V=require("@solana/web3.js");var ce={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var tt=require("@solana/spl-token"),et=v("Raydium_txUtil"),nt=1644;function Te(n){let e=[],t=[];return n.microLamports&&(e.push(V.ComputeBudgetProgram.setComputeUnitPrice({microLamports:n.microLamports})),t.push(ce.SetComputeUnitPrice)),n.units&&(e.push(V.ComputeBudgetProgram.setComputeUnitLimit({units:n.units})),t.push(ce.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ee(n,e){var r,T;let t=e!=null?e:"confirmed";return(T=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:t})))==null?void 0:T.blockhash}async function be(n,e){return n.getSignatureStatuses([e]),new Promise((t,r)=>{let T=setTimeout(r,6e4);n.onSignature(e,m=>{if(clearTimeout(T),!m.err){t("");return}r(Object.assign(m.err,{txId:e}))},"confirmed")})}function kt(n,e){n.length<1&&et.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&et.logWithError(`no signers provided:, ${e.toString()}`);let t=new V.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<nt}catch{return!1}}function ue({instructions:n,payer:e,signers:t}){return kt(n,[e,...t])}function le({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:r=V.Keypair.generate().publicKey.toString()}){let m=new V.TransactionMessage({payerKey:e,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new V.VersionedTransaction(m).serialize()).toString("base64").length<nt}catch{return!1}}var It=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Rt=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof V.VersionedTransaction&&(e=It(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function X(n){let e=[];return n.forEach(t=>{t instanceof V.Transaction&&(t.recentBlockhash||(t.recentBlockhash=tt.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=V.Keypair.generate().publicKey)),e.push(Rt(t))}),console.log("simulate tx string:",e),e}var o=require("@solana/web3.js"),Wr=new o.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),_r=new o.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Kr=new o.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),vr=new o.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ur=new o.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),qr=new o.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Gr=new o.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Hr=new o.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),jr=new o.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),zr=new o.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Zr=new o.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Jr=new o.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Xr=new o.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Yr=new o.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Qr=new o.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$r=new o.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ei=new o.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ti=new o.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ni=new o.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ri=new o.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ii=new o.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),oi=new o.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),si=new o.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ai=new o.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ci=new o.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ui=new o.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),li=new o.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),mi=new o.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),pi=new o.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),di=new o.PublicKey("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),fi=new o.PublicKey("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var gi={OPEN_BOOK_PROGRAM:new o.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new o.PublicKey("Ray1111111111111111111111111111111111111111"),AMM_V4:new o.PublicKey("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new o.PublicKey("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new o.PublicKey("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new o.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new o.PublicKey("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new o.PublicKey("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new o.PublicKey("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new o.PublicKey("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new o.PublicKey("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new o.PublicKey("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:o.PublicKey.default,Router:new o.PublicKey("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new o.PublicKey("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new o.PublicKey("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new o.PublicKey("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new o.PublicKey("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new o.PublicKey("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new o.PublicKey("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new o.PublicKey("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new o.PublicKey("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new o.PublicKey("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new o.PublicKey("Ray1111111111111111111111111111111111111111")};var Lt=_(require("bn.js"));var rt=_(require("bn.js")),bi=new rt.default(1e6);var ye=require("@solana/spl-token"),Me=v("Raydium_accountInfo_util");async function ot(n,e,t){let{batchRequest:r,commitment:T="confirmed",chunkCount:m=100}=W({batchRequest:!1},t),f=De(e,m),s=new Array(f.length).fill([]);if(r){let R=f.map(w=>{let x=n._buildArgs([w.map(y=>y.toBase58())],T,"base64");return{methodName:"getMultipleAccounts",args:x}}),A=De(R,10);s=(await(await Promise.all(A.map(async w=>await n._rpcBatchRequest(w)))).flat()).map(w=>(w.error&&Me.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${w.error.message}`),w.result.value.map(x=>{if(x){let{data:y,executable:l,lamports:g,owner:a,rentEpoch:P}=x;return y.length!==2&&y[1]!=="base64"&&Me.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(y[0],"base64"),executable:l,lamports:g,owner:new it.PublicKey(a),rentEpoch:P}}return null})))}else try{s=await Promise.all(f.map(R=>n.getMultipleAccountsInfo(R,T)))}catch(R){R instanceof Error&&Me.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${R.message}`)}return s.flat()}async function Le({connection:n,address:e,cluster:t="mainnet"}){let r=await ot(n,[...new Set(e.map(m=>m.toString()))].map(m=>new U.PublicKey(m))),T={};for(let m=0;m<e.length;m++){let f=r[m],s=e[m];if(!f)continue;let R=new U.AddressLookupTableAccount({key:s,state:U.AddressLookupTableAccount.deserialize(f.data)});T[s.toString()]=R,t==="devnet"?te[s.toString()]=R:we[s.toString()]=R}return T}var we={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new U.AddressLookupTableAccount({key:new U.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:U.AddressLookupTableAccount.deserialize(Buffer.from("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","base64"))})},te={},Ne=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(te[e])return te;let t=new U.PublicKey(e),r=await n.getAccountInfo(t);return r&&(te[e]=new U.AddressLookupTableAccount({key:t,state:U.AddressLookupTableAccount.deserialize(r.data)})),te};var xe=2e3,Fe=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await st.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(r=e==null?void 0:e[15])!=null?r:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:r}=Te(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(B.SystemProgram.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new B.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(ce.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[],instructionTypes:T=[],endInstructionTypes:m=[],lookupTableAddress:f=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this.instructionTypes.push(...T),this.endInstructionTypes.push(...m),this.lookupTableAddress.push(...f.filter(s=>s!==B.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(W({},t||{})):this.build(t)}build(e){var r;let t=new B.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(T=>T.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async T=>{var b;let{recentBlockHash:m,skipPreflight:f=!0,sendAndConfirm:s,notSendToRpc:R}=T||{},A=m!=null?m:await ee(this.connection,this.blockhashCommitment);if(t.recentBlockhash=A,this.signers.length&&t.sign(...this.signers),X([t]),(b=this.owner)!=null&&b.isKeyPair)return{txId:s?await(0,B.sendAndConfirmTransaction)(this.connection,t,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:f}),signedTx:t};if(this.signAllTransactions){let w=await this.signAllTransactions([t]);if(this.signers.length)for(let x of w)try{x.sign(...this.signers)}catch{}return{txId:R?"":await this.connection.sendRawTransaction(w[0].serialize(),{skipPreflight:f}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var A;let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:T}=this.build(r),m=t.filter(b=>b.transaction.instructions.length>0),f=[T,...m.map(b=>b.transaction)],s=[this.signers,...m.map(b=>b.signers)],R=[...this.instructionTypes,...m.map(b=>b.instructionTypes).flat()];return(A=this.owner)!=null&&A.signer&&s.forEach(b=>{b.some(w=>w.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:f,signers:s,instructionTypes:R,execute:async b=>{var P;let{sequentially:w,onTxUpdate:x,skipTxCount:y=0,recentBlockHash:l,skipPreflight:g=!0}=b||{},a=l!=null?l:await ee(this.connection,this.blockhashCommitment);if((P=this.owner)!=null&&P.isKeyPair){if(w){let p=[],C=0;for(let u of f){if(++C,C<=y)continue;let i=await(0,B.sendAndConfirmTransaction)(this.connection,u,this.signers.find(c=>c.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});p.push(i)}return{txIds:p,signedTxs:f}}return{txIds:await await Promise.all(f.map(async p=>(p.recentBlockhash=a,await this.connection.sendRawTransaction(p.serialize(),{skipPreflight:g})))),signedTxs:f}}if(this.signAllTransactions){let p=f.map((u,i)=>(u.recentBlockhash=a,s[i].length&&u.sign(...s[i]),u));X(p);let C=await this.signAllTransactions(p);if(w){let u=0,i=[],c=async()=>{if(!C[u])return;let h=await this.connection.sendRawTransaction(C[u].serialize(),{skipPreflight:g});i.push({txId:h,status:"sent",signedTx:C[u]}),x==null||x([...i]),u++;let d=!1,S=null,D=null,F=k=>{S!==null&&clearInterval(S),D!==null&&this.connection.removeSignatureListener(D);let M=i.findIndex(E=>E.txId===h);if(M>-1){if(i[M].status==="error"||i[M].status==="success")return;i[M].status=k.err?"error":"success"}x==null||x([...i]),k.err||c()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var k;if(d){clearInterval(S);return}try{let M=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(d=!0,clearInterval(S),F({err:((k=M.meta)==null?void 0:k.err)||null}),console.log("tx status from getTransaction:",h))}catch(M){d=!0,clearInterval(S),console.error("getTransaction timeout:",M,h)}},xe)),D=this.connection.onSignature(h,k=>{if(d){this.connection.removeSignatureListener(D);return}d=!0,F(k)},"confirmed"),this.connection.getSignatureStatus(h)};return await c(),{txIds:i.map(h=>h.txId),signedTxs:C}}else{let u=[];for(let i=0;i<C.length;i+=1){let c=await this.connection.sendRawTransaction(C[i].serialize(),{skipPreflight:g});u.push(c)}return{txIds:u,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:r}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){var g;let l=e||{},{lookupTableCache:t={},lookupTableAddress:r=[],forerunCreate:T,recentBlockhash:m}=l,f=de(l,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),s=W(W({},this.cluster==="devnet"?await Ne(this.connection):we),t),R=Array.from(new Set([...r,...this.lookupTableAddress])),A=[];for(let a of R)s[a]===void 0&&A.push(new B.PublicKey(a));let b=await Le({connection:this.connection,address:A});for(let[a,P]of Object.entries(b))s[a]=P;let w=T?B.PublicKey.default.toBase58():m!=null?m:await ee(this.connection,this.blockhashCommitment),x=new B.TransactionMessage({payerKey:this.feePayer,recentBlockhash:w,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(a=>a.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let y=new B.VersionedTransaction(x);return y.sign(this.signers),{builder:this,transaction:y,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async a=>{var u;let{skipPreflight:P=!0,sendAndConfirm:p,notSendToRpc:C}=a||{};if(X([y]),(u=this.owner)!=null&&u.isKeyPair){let i=await this.connection.sendTransaction(y,{skipPreflight:P});return p&&await be(this.connection,i),{txId:i,signedTx:y}}if(this.signAllTransactions){let i=await this.signAllTransactions([y]);if(this.signers.length)for(let c of i)try{c.sign(this.signers)}catch{}return{txId:C?"":await this.connection.sendTransaction(i[0],{skipPreflight:P}),signedTx:i[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}async buildV0MultiTx(e){var A;let{extraPreBuildData:t=[],buildProps:r}=e,{transaction:T}=await this.buildV0(r),m=t.filter(b=>b.builder.instructions.length>0),f=[T,...m.map(b=>b.transaction)],s=[this.signers,...m.map(b=>b.signers)],R=[...this.instructionTypes,...m.map(b=>b.instructionTypes).flat()];return(A=this.owner)!=null&&A.signer&&s.forEach(b=>{b.some(w=>w.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),f.forEach(async(b,w)=>{b.sign(s[w])}),{builder:this,transactions:f,signers:s,instructionTypes:R,buildProps:r,execute:async b=>{var g;let{sequentially:w,onTxUpdate:x,recentBlockHash:y,skipPreflight:l=!0}=b||{};if(y&&f.forEach(a=>a.message.recentBlockhash=y),X(f),(g=this.owner)!=null&&g.isKeyPair){if(w){let a=[];for(let P of f){let p=await this.connection.sendTransaction(P,{skipPreflight:l});await be(this.connection,p),a.push(p)}return{txIds:a,signedTxs:f}}return{txIds:await Promise.all(f.map(async a=>await this.connection.sendTransaction(a,{skipPreflight:l}))),signedTxs:f}}if(this.signAllTransactions){let a=await this.signAllTransactions(f);if(w){let P=0,p=[],C=async()=>{if(!a[P])return;let u=await this.connection.sendTransaction(a[P],{skipPreflight:l});p.push({txId:u,status:"sent",signedTx:a[P]}),x==null||x([...p]),P++;let i=!1,c=null,h=null,d=S=>{c!==null&&clearInterval(c),h!==null&&this.connection.removeSignatureListener(h);let D=p.findIndex(F=>F.txId===u);if(D>-1){if(p[D].status==="error"||p[D].status==="success")return;p[D].status=S.err?"error":"success"}x==null||x([...p]),S.err||C()};this.loopMultiTxStatus&&(c=setInterval(async()=>{var S;if(i){clearInterval(c);return}try{let D=await this.connection.getTransaction(u,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(i=!0,clearInterval(c),d({err:((S=D.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",u))}catch(D){i=!0,clearInterval(c),console.error("getTransaction timeout:",D,u)}},xe)),h=this.connection.onSignature(u,S=>{if(i){this.connection.removeSignatureListener(h);return}i=!0,d(S)},"confirmed"),this.connection.getSignatureStatus(u)};return C(),{txIds:[],signedTxs:a}}else{let P=[];for(let p=0;p<a.length;p+=1){let C=await this.connection.sendTransaction(a[p],{skipPreflight:l});P.push(C)}return{txIds:P,signedTxs:a}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){var x;let w=e||{},{splitIns:t=[],computeBudgetConfig:r}=w,T=de(w,["splitIns","computeBudgetConfig"]),m=r?Te(r):{instructions:[],instructionTypes:[]},f=this.signers.reduce((y,l)=>j(W({},y),{[l.publicKey.toBase58()]:l}),{}),s=[],R=[],A=[],b=0;if(this.allInstructions.forEach(y=>{let l=[...A,y],g=r?[...m.instructions,...l]:l,P=[...new Set(l.map(p=>p.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat()).values()].map(p=>new B.PublicKey(p));if(y!==t[b]&&A.length<12&&(ue({instructions:g,payer:this.feePayer,signers:P})||ue({instructions:l,payer:this.feePayer,signers:P})))A.push(y);else{if(A.length===0)throw Error("item ins too big");b+=y===t[b]?1:0,ue({instructions:r?[...m.instructions,...A]:[...A],payer:this.feePayer,signers:P})?s.push(new B.Transaction().add(...m.instructions,...A)):s.push(new B.Transaction().add(...A)),R.push(Array.from(new Set(A.map(p=>p.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(p=>f[p]).filter(p=>p!==void 0)),A=[y]}}),A.length>0){let l=[...new Set(A.map(g=>g.keys.filter(a=>a.isSigner).map(a=>a.pubkey.toString())).flat()).values()].map(g=>f[g]).filter(g=>g!==void 0);ue({instructions:r?[...m.instructions,...A]:[...A],payer:this.feePayer,signers:l.map(g=>g.publicKey)})?s.push(new B.Transaction().add(...m.instructions,...A)):s.push(new B.Transaction().add(...A)),R.push(l)}return s.forEach(y=>y.feePayer=this.feePayer),(x=this.owner)!=null&&x.signer&&R.forEach(y=>{y.some(l=>l.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:s,signers:R,instructionTypes:this.instructionTypes,execute:async y=>{var u;let{sequentially:l,onTxUpdate:g,skipTxCount:a=0,recentBlockHash:P,skipPreflight:p=!0}=y||{},C=P!=null?P:await ee(this.connection,this.blockhashCommitment);if(s.forEach(async(i,c)=>{i.recentBlockhash=C,R[c].length&&i.sign(...R[c])}),X(s),(u=this.owner)!=null&&u.isKeyPair){if(l){let i=0,c=[];for(let h of s){if(++i,i<=a){c.push("tx skipped");continue}let d=await(0,B.sendAndConfirmTransaction)(this.connection,h,this.signers.find(S=>S.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:p});c.push(d)}return{txIds:c,signedTxs:s}}return{txIds:await Promise.all(s.map(async i=>await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let i=await this.signAllTransactions(s.slice(a,s.length)),c=[...s.slice(0,a),...i];if(l){let h=0,d=[],S=async()=>{if(!c[h])return;h<a&&(d.push({txId:"",status:"success",signedTx:c[h]}),g==null||g([...d]),h++,S());let D=await this.connection.sendRawTransaction(c[h].serialize(),{skipPreflight:p});d.push({txId:D,status:"sent",signedTx:c[h]}),g==null||g([...d]),h++;let F=!1,k=null,M=null,E=K=>{k!==null&&clearInterval(k),M!==null&&this.connection.removeSignatureListener(M);let O=d.findIndex(z=>z.txId===D);if(O>-1){if(d[O].status==="error"||d[O].status==="success")return;d[O].status=K.err?"error":"success"}g==null||g([...d]),K.err||S()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var K;if(F){clearInterval(k);return}try{let O=await this.connection.getTransaction(D,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(F=!0,clearInterval(k),E({err:((K=O.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",D))}catch(O){F=!0,clearInterval(k),console.error("getTransaction timeout:",O,D)}},xe)),M=this.connection.onSignature(D,K=>{if(F){this.connection.removeSignatureListener(M);return}F=!0,E(K)},"confirmed"),this.connection.getSignatureStatus(D)};return await S(),{txIds:d.map(D=>D.txId),signedTxs:c}}else{let h=[];for(let d=0;d<c.length;d+=1){let S=await this.connection.sendRawTransaction(c[d].serialize(),{skipPreflight:p});h.push(S)}return{txIds:h,signedTxs:c}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:T||{}}}async sizeCheckBuildV0(e){var C;let p=e||{},{computeBudgetConfig:t,splitIns:r=[],lookupTableCache:T={},lookupTableAddress:m=[]}=p,f=de(p,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),s=W(W({},this.cluster==="devnet"?await Ne(this.connection):we),T),R=Array.from(new Set([...this.lookupTableAddress,...m])),A=[];for(let u of R)s[u]===void 0&&A.push(new B.PublicKey(u));let b=await Le({connection:this.connection,address:A});for(let[u,i]of Object.entries(b))s[u]=i;let w=t?Te(t):{instructions:[],instructionTypes:[]},x=await ee(this.connection,this.blockhashCommitment),y=this.signers.reduce((u,i)=>j(W({},u),{[i.publicKey.toBase58()]:i}),{}),l=[],g=[],a=[],P=0;if(this.allInstructions.forEach(u=>{let i=[...a,u],c=t?[...w.instructions,...i]:i;if(u!==r[P]&&a.length<12&&(le({instructions:c,payer:this.feePayer,lookupTableAddressAccount:s})||le({instructions:i,payer:this.feePayer,lookupTableAddressAccount:s})))a.push(u);else{if(a.length===0)throw Error("item ins too big");P+=u===r[P]?1:0;let h={};for(let d of[...new Set(R)])s[d]!==void 0&&(h[d]=s[d]);if(t&&le({instructions:[...w.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:x})){let d=new B.TransactionMessage({payerKey:this.feePayer,recentBlockhash:x,instructions:[...w.instructions,...a]}).compileToV0Message(Object.values(s));l.push(new B.VersionedTransaction(d))}else{let d=new B.TransactionMessage({payerKey:this.feePayer,recentBlockhash:x,instructions:[...a]}).compileToV0Message(Object.values(s));l.push(new B.VersionedTransaction(d))}g.push(Array.from(new Set(a.map(d=>d.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(d=>y[d]).filter(d=>d!==void 0)),a=[u]}}),a.length>0){let i=[...new Set(a.map(c=>c.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(c=>y[c]).filter(c=>c!==void 0);if(t&&le({instructions:[...w.instructions,...a],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:x})){let c=new B.TransactionMessage({payerKey:this.feePayer,recentBlockhash:x,instructions:[...w.instructions,...a]}).compileToV0Message(Object.values(s));l.push(new B.VersionedTransaction(c))}else{let c=new B.TransactionMessage({payerKey:this.feePayer,recentBlockhash:x,instructions:[...a]}).compileToV0Message(Object.values(s));l.push(new B.VersionedTransaction(c))}g.push(i)}return(C=this.owner)!=null&&C.signer&&g.forEach(u=>{u.some(i=>i.publicKey.equals(this.owner.publicKey))||u.push(this.owner.signer)}),l.forEach((u,i)=>{u.sign(g[i])}),{builder:this,transactions:l,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async u=>{var D;let{sequentially:i,onTxUpdate:c,skipTxCount:h=0,recentBlockHash:d,skipPreflight:S=!0}=u||{};if(l.map(async(F,k)=>{g[k].length&&F.sign(g[k]),d&&(F.message.recentBlockhash=d)}),X(l),(D=this.owner)!=null&&D.isKeyPair){if(i){let F=0,k=[];for(let M of l){if(++F,F<=h){console.log("skip tx: ",F),k.push("tx skipped");continue}let E=await this.connection.sendTransaction(M,{skipPreflight:S});await be(this.connection,E),k.push(E)}return{txIds:k,signedTxs:l}}return{txIds:await Promise.all(l.map(async F=>await this.connection.sendTransaction(F,{skipPreflight:S}))),signedTxs:l}}if(this.signAllTransactions){let F=await this.signAllTransactions(l.slice(h,l.length)),k=[...l.slice(0,h),...F];if(i){let M=0,E=[],K=async()=>{if(!k[M])return;if(M<h){E.push({txId:"",status:"success",signedTx:k[M]}),c==null||c([...E]),M++,K();return}let O=await this.connection.sendTransaction(k[M],{skipPreflight:S});E.push({txId:O,status:"sent",signedTx:k[M]}),c==null||c([...E]),M++;let z=!1,Y=null,me=null,Ee=Z=>{Y!==null&&clearInterval(Y),me!==null&&this.connection.removeSignatureListener(me);let G=E.findIndex(at=>at.txId===O);if(G>-1){if(E[G].status==="error"||E[G].status==="success")return;E[G].status=Z.err?"error":"success"}c==null||c([...E]),Z.err||K()};this.loopMultiTxStatus&&(Y=setInterval(async()=>{var Z;if(z){clearInterval(Y);return}try{let G=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});G&&(z=!0,clearInterval(Y),Ee({err:((Z=G.meta)==null?void 0:Z.err)||null}),console.log("tx status from getTransaction:",O))}catch(G){z=!0,clearInterval(Y),console.error("getTransaction timeout:",G,O)}},xe)),me=this.connection.onSignature(O,Z=>{if(z){this.connection.removeSignatureListener(me);return}z=!0,Ee(Z)},"confirmed"),this.connection.getSignatureStatus(O)};return K(),{txIds:[],signedTxs:k}}else{let M=[];for(let E=0;E<k.length;E+=1){let K=await this.connection.sendTransaction(k[E],{skipPreflight:S});M.push(K)}return{txIds:M,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:f||{}}}};0&&(module.exports={TxBuilder});
//# sourceMappingURL=txTool.js.map